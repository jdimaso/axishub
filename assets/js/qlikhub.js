/*!
* Copyright(C) 2015
* Qlik International AB
* All Rights Reserved
*/
define("assets/qvangular/qvangular-config",[],function(){var autoBootstrap="false"!==(document.documentElement.getAttribute("qva-bootstrap")||document.body.getAttribute("qva-bootstrap"));return{internalOptimizations:autoBootstrap,autoBootstrap:autoBootstrap}}),define("qlikui/qui",["angular"],function(angular){"use strict";function component(name,configuration,module){if(module=module||window.qvangularGlobal||mod,!name)throw new Error("Name is undefined.");if(!configuration.template)throw new Error("Template is undefined.");var directiveOptions={restrict:"E",replace:!0,transclude:null!=configuration.transclude?configuration.transclude:!0,template:configuration.template,requires:configuration.requires,scope:null!=configuration.scope?configuration.scope:"=",controller:configuration.controller||function(){},link:configuration.link||function(){}};return module.directive(name,function(){return directiveOptions}),directiveOptions}var mod=angular.module("qlik-ui",[]),configuration={treatAsDesktop:function(){return!("ontouchstart"in window)},quiToggleSwitchLink:function(){}},exports={component:component,directive:mod.directive,configure:function(config){configuration=angular.extend(configuration,config)},getConfigOption:function(name){return configuration[name]}};return exports}),define("text!assets/qvangular/qui-toolbar/qui-app-info.ng.html",[],function(){return'<section class="qv-app-info-holder">\r\n	<div class="app-info-click-area"\r\n		 qva-activate="quiModel.onButton()"\r\n		 q-title-translation="{{quiModel.tooltip()}}"\r\n		 ng-class="{\'has-app-details\': quiModel.hasAppDetails()}">\r\n		<span class="app-read-only" ng-if="quiModel.readOnly"><i data-icon="padlock" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span>\r\n\r\n		<h1 class="app-title">{{quiModel.appTitle}}</h1>\r\n\r\n		<h1 class="app-info-icon" data-icon="info" ng-if="quiModel.hasAppDetails()"></h1>\r\n	</div>\r\n</section>'}),define("text!assets/qvangular/qui-toolbar/qui-toolbar-button.ng.html",[],function(){return'<button\r\n		tid="{{quiModel.tid}}"\r\n		qva-activate="onButton($event)"\r\n		qva-outside-ignore-for="{{quiModel.name}}"\r\n		q-title-translation="{{(quiModel.pressed && quiModel.tooltipActive ? quiModel.tooltipActive : quiModel.tooltipInactive)}}"\r\n		ng-disabled="quiModel.isDisabled()"\r\n		ng-hide="quiModel.isHidden()"\r\n		ng-class="{\'qui-button\': !quiModel.qlikuiSmallIconButton, \'qui-smalliconbutton\': quiModel.qlikuiSmallIconButton,\'qui-active\': quiModel.pressed, \'noIcon\': !quiModel.icon, \'{{quiModel.hasStrongActiveColor}}\': true, \'iconToTheRight\': quiModel.iconToTheRight, \'dyn-text\': quiModel.dynamicText, \'{{quiModel.specialStateClass}}\': quiModel.isInSpecialState }">\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && !quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && quiModel.showText()" class="item-title">{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}</span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="quiModel.dynamicText">{{ quiModel.dynamicText() }}</span>\r\n</button>'}),define("assets/qvangular/qui-toolbar/qui-toolbar",["jquery","qlikui/qui","text!./qui-app-info.ng.html","text!./qui-toolbar-button.ng.html"],function($,qui,appInfoTemplate,buttonTemplate){qui.component("quiToolbar",{template:"<div class='qui-toolbar' ng-transclude />"}),qui.component("quiToolbarLeft",{template:"<div class='qui-buttonset-left' ng-transclude />"}),qui.component("quiToolbarRight",{template:"<div class='qui-buttonset-right' ng-transclude />"}),qui.component("quiToolbarButtonGroup",{template:"<div class='qui-buttongroup' ng-transclude />"}),qui.component("quiToolbarAppInfo",{template:appInfoTemplate,scope:{quiModel:"="}}),qui.component("quiToolbarButton",{template:buttonTemplate,scope:{quiModel:"="},controller:["$scope","$timeout",function($scope){$scope.onButton=function($event){$.support.touch&&$event.target.focus(),$scope.quiModel.isToggleButton&&($scope.quiModel.pressed=!$scope.quiModel.pressed),$scope.quiModel.onButtonClicked($scope.quiModel,$event)}}]})}),define("assets/qvangular/qvangular-qui",["touche","qlikui/qui","assets/qvangular/qui-toolbar/qui-toolbar"],function(Touche,qui){var config={quiToggleSwitchLink:function(scope,element){Touche.utils.touch&&(scope.touch=!0,Touche(element.find("label")[0]).swipe({options:{preventDefault:!0},end:function(e,data){scope.readOnly||(("right"===data.swipe.direction&&scope.value||"left"===data.swipe.direction&&!scope.value)&&(scope.value=!scope.value,scope.$apply()),Touche.preventGestures(this.gestureHandler))}}).tap({end:function(){scope.readOnly||(scope.value=!scope.value,scope.$apply(),Touche.preventGestures(this.gestureHandler))}}))}};qui.configure(config)}),define("assets/qvangular/qvangular-core",["jquery","assets/qvangular/qvangular-config","assets/qvangular/qvangular-qui","angular-animate","angular-sanitize","angular","angular-vs-repeat"],function($,settings){function registerApi(name,fn){exports.isBootstrapped?exports[name]=fn:(exportFunctions.push({name:name,fn:fn}),exports[name]=function(){var args=Array.prototype.slice.call(arguments);bootstrapCallbacks.push({fn:fn,args:args})})}function $applyify(fn){return function(){var args=Array.prototype.slice.apply(arguments);exports.$rootScope.$$phase?fn.apply(this,args):exports.$rootScope.$apply(function(){fn.apply(this,args)})}}var injector,rootScope,compile,_$controller,_$provide,_$compileProvider,_$filterProvider,_$timeout,_$q,angular=window.angular,exports={},exportFunctions=[],bootstrapCallbacks=[];if(exports.bootstrap=function(_$injector,_$rootScope,_$compile,__$controller,__$timeout,__$q){rootScope=_$rootScope,compile=_$compile,_$controller=__$controller,_$timeout=__$timeout,_$q=__$q,injector=_$injector,exports.$injector=injector,exports.$rootScope=rootScope,exports.isBootstrapped=!0,exportFunctions.forEach(function(fn){exports[fn.name]=fn.fn}),bootstrapCallbacks.forEach(function(cb){cb.fn.apply(cb.fn,cb.args)}),bootstrapCallbacks.length=exportFunctions.length=0},exports.module=angular.module("qlik-angular",["ngAnimate","ngSanitize","vs-repeat","qlik-ui"],["$provide","$injector","$compileProvider","$filterProvider","$animateProvider",function($provide,$injector,$compileProvider,$filterProvider,$animateProvider){_$provide=$provide,_$compileProvider=$compileProvider,_$filterProvider=$filterProvider,settings.internalOptimizations&&($animateProvider.classNameFilter(/\bqv-animate\b/i),$provide.value("$anchorScroll",function(){}))}]).run(["$injector","$rootScope","$compile","$controller","$timeout","$q",exports.bootstrap]),registerApi("directive",function(name,constructor){_$compileProvider.directive(name,constructor)}),registerApi("filter",function(name,constructor){_$filterProvider.register(name,constructor)}),registerApi("service",function(name,constructor){return _$provide.service(name,constructor),injector.get(name)}),registerApi("provider",function(name,constructor){return _$provide.provider(name,constructor)}),registerApi("injectComponent",function(element,component,input){var controller;if(!component)throw"Trying to show undefined component.";if("function"==typeof component)return component.apply({},[element,input]);if(Array.isArray(component)){var locals={$element:element,input:input};for(var key in input)input.hasOwnProperty(key)&&(locals[key]=input[key]);return injector.invoke(component,{},locals)}if(component.controller){var scope=$(element).scope();return scope||(scope=rootScope),exports.$apply(scope,function(){var childScope=scope.$new();childScope.extractComponent=function(){childScope.$$destroyed||(childScope.$destroy(),element.off(".qvangularcoreshowcomponent"),element.html(""))},childScope.destroyComponent=childScope.extractComponent;var locals={$scope:childScope,$element:element,$transclude:void 0,input:input};for(var key in input)input.hasOwnProperty(key)&&(locals[key]=input[key],childScope[key]=input[key]);element.html(component.template);var linkFn=compile(element.contents());component.controller&&(controller=_$controller(component.controller,locals),element.contents().data("$ngControllerController",controller)),linkFn(childScope),element.on("remove.qvangularcoreshowcomponent",function(){childScope.$$destroyed||childScope.$destroy()})}),controller}}),registerApi("componentDirective",function(name,scopeDef,defaultComponentImpl){var completeScopeDef={};for(var prop in scopeDef)scopeDef.hasOwnProperty(prop)&&(completeScopeDef[prop]=scopeDef[prop]);completeScopeDef[name]="=",completeScopeDef.input="=",completeScopeDef.component="=",exports.directive(name,["$http","$templateCache","$compile","$controller",function($http,$templateCache,$compile,$controller){return{restrict:"EA",replace:!0,terminal:!0,scope:completeScopeDef,link:function(outerScope,element,attrs){var childScope,changeCounter=0;outerScope.$watch("component",function(component){var thisChangeId=++changeCounter;if(component||(component=defaultComponentImpl),component&&component.template){if(thisChangeId!==changeCounter)return;childScope&&childScope.$destroy(),childScope=outerScope.$new(),element.html(component.template);var link=$compile(element.contents()),locals={$scope:childScope,$element:element,$attrs:attrs};if(outerScope.input&&component.scope&&angular.forEach(component.scope,function(definition,inputProp){var childScopeProp;childScopeProp="string"==typeof definition&&"="===definition.charAt(0)&&definition.length>1?definition.substring(1):inputProp,childScope[childScopeProp]=outerScope.input[inputProp];var lastValue=childScope[childScopeProp];childScope.$watch(function(){var valueInInput=outerScope.input[inputProp];return valueInInput!==childScope[childScopeProp]&&(valueInInput!==lastValue?lastValue=childScope[childScopeProp]=valueInInput:outerScope.input[inputProp]=lastValue=childScope[childScopeProp]),valueInInput})}),outerScope.input){for(var key in outerScope.input)outerScope.input.hasOwnProperty(key)&&(locals[key]=outerScope.input[key]);locals.input=outerScope.input}if(component.controller){var controller=$controller(component.controller,locals);element.contents().data("$ngControllerController",controller)}link(childScope)}else childScope&&(childScope.$destroy(),childScope=null),element.html("")})}}}])}),bootstrapCallbacks.push({name:"componentDirective",fn:function(){exports.componentType=exports.componentDirective,exports.componentDirective("qvaInclude",{ngModel:"="})}}),settings.autoBootstrap){var externalModules=Object.keys(window.qvangularNgModules||[]),modulesToLoad=(window.angular.mock?["ngMock","qlik-angular"]:["qlik-angular"]).concat(externalModules);angular.bootstrap(document,modulesToLoad)}return exports.$apply=function($scope,callback){return exports.isBootstrapped?void(callback?$scope.$root.$$phase?callback&&callback():$scope.$apply(callback):(callback=$scope,"function"==typeof callback?exports.$rootScope.$$phase?callback():exports.$rootScope.$apply(callback):callback&&callback.$apply&&(exports.$rootScope.$$phase||$scope.$apply()))):callback&&callback()||null},exports.defer=function(){return _$q.defer()},exports.when=function(value,callback,errback){return _$q.when(value,callback,errback)},exports.promise=function(result){return _$timeout(function(){return result})},exports.getService=function(name){return injector.get(name)},$.fn.showComponent=function(component,input){return"string"==typeof component?exports.injectComponent(this,{template:component,controller:input||function(){}},{}):exports.injectComponent(this,component,input)},exports.$applyify=$applyify,window.qvangularGlobal=exports,exports}),define("assets/qvangular/qvangular-locale",["assets/qvangular/qvangular-core","translator"],function(qvangular,translator){qvangular.directive("qPlaceholder",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){iAttrs.ngDisabled?scope.$watch(iAttrs.ngDisabled,function(value){value?iElement.attr("placeholder",""):iElement.attr("placeholder",translator.get(iAttrs.qPlaceholder))}):iElement.attr("placeholder",translator.get(iAttrs.qPlaceholder))}}}),qvangular.directive("qSimpleTranslation",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){function updateContent(value){iElement.text(translator.get(value))}translator.ready.then(function(){iAttrs.$observe("qTranslation",updateContent)})}}}),qvangular.directive("qTranslation",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){function updateContent(value){var translatedText,id,i,data=value.split(","),htmlTemplates=JSON.parse(iAttrs.qHtmlTranslationIndexes||"null"),insertFn=htmlTemplates?"html":"text",pipeIndex=data[0].indexOf("|");for(id=pipeIndex>=0&&data.length>=2?"1"===data[1]?data[0].substring(0,pipeIndex).trim():data[0].substring(pipeIndex+1).trim():data[0],translatedText=translator.get(id),htmlTemplates&&data.push.apply(data,htmlTemplates),i=1;i<data.length;i++)translatedText=translatedText.replace("{"+(i-1)+"}",data[i]);iElement[insertFn](translatedText)}translator.ready.then(function(){iAttrs.$observe("qTranslation",updateContent),updateContent(iAttrs.qTranslation)})}}}),qvangular.directive("translate",function(){return function(scope,element,attrs){function update(text){text?"string"==typeof text?(element.attr("data-translation",text),element.removeAttr("data-text")):(element.attr("data-translation",text.id),element.data("text",{value:text.value})):(element.removeAttr("data-translation"),element.removeAttr("data-text")),translator.apply(element[0])}scope.$watch(attrs.translate,update)}}),qvangular.directive("qTitleTranslation",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){function updateContent(value){value?iElement.attr("title",translator.get(value)):iElement.removeAttr("title")}translator.ready.then(function(){iAttrs.$observe("qTitleTranslation",updateContent),updateContent(iAttrs.qTitleTranslation)})}}}),qvangular.filter("translate",function(){return function(input){return translator.get(input)}}),qvangular.filter("translatetoupper",function(){return function(input){return translator.get(input).toUpperCase()}})}),define("assets/qvangular/qvangular-filters",["assets/qvangular/qvangular-core"],function(qvangular){qvangular.filter("qvCropString",function(){function cropStr(str,limit){return"undefined"!=typeof limit&&str.length>limit&&(str=str.substr(0,limit)+"..."),str}return cropStr}),qvangular.filter("qvOptStringExpression",function(){function getValue(value){return"object"==typeof value&&(value=value.qStringExpression.qExpr,value.length&&"="===value[0]||(value="="+value)),value}return getValue}),qvangular.filter("qvToArray",function(){return function(object){var array=[];for(var key in object)object.hasOwnProperty(key)&&array.push(object[key]);return array}}),qvangular.filter("qvFirstToUpper",function(){return function(string){return string.substring(0,1).toUpperCase()+string.substring(1)}})}),define("assets/qvangular/qvangular-highlight/highlight",["general.utils/string-normalization","util","encoder"],function(SN,util,encoder){function directive(){return{scope:{text:"@",query:"="},restrict:"EA",replace:!0,link:function(scope,element){scope.$watchCollection("[text, query]",function(){var query=SN.string(scope.query);if(!query)return void element.text(scope.text);var html=directive.highlightMatches(SN.string(scope.text),query,"qui-texthighlight",scope.text);element.html(html)})}}}return directive.highlightMatches=function(text,query,className,originalText){return directive.markMatches(text,query,originalText).map(function(item){return item.match?"<span "+encoder.encodeForAttr("class",className)+">"+encoder.encodeForHTML(item.text)+"</span>":encoder.encodeForHTML(item.text)}).join("")},directive.markMatches=function(text,query,targetText){targetText=text;for(var list=[],index=0,re=new RegExp(util.escapeRegExp(query),"gi");;){var match=re.exec(text);if(!match){index<text.length&&list.push({text:targetText.substring(index),match:!1});break}match.index>index&&list.push({text:targetText.substring(index,match.index),match:!1}),list.push({text:targetText.substring(match.index,re.lastIndex),match:!0}),index=re.lastIndex}return list},directive}),define("general.utils/dom-util",["jquery"],function($){"use strict";var DOMUtil={};return DOMUtil.getParentElementWithAttribute=function(elem,tag,attr){for(var match=!1,limit=0;elem&&elem.parentNode&&100>limit&&!match;){if(limit++,elem.nodeName===tag.toUpperCase()&&elem.hasAttribute(attr))return match=!0,elem;elem=elem.parentNode}return match?void 0:null},DOMUtil.getAncestorsUntil=function(elem,stopFn){var ancestors=[];for(stopFn||(stopFn=function(){return!1});elem&&elem.parentNode&&!stopFn(elem);)ancestors.push(elem),elem=elem.parentNode;return ancestors},DOMUtil.isInput=function(element){return element&&("INPUT"===element.tagName||"SELECT"===element.tagName||"TEXTAREA"===element.tagName||element.isContentEditable)},DOMUtil.elementFromEventPosition=function(event){var doc=document,body=doc.body,clientX=event.pageX+(doc&&doc.clientLeft||body&&body.clientLeft||0)-(doc&&doc.scrollLeft||body&&body.scrollLeft||0),clientY=event.pageY+(doc&&doc.clientTop||body&&body.clientTop||0)-(doc&&doc.scrollTop||body&&body.scrollTop||0);return document.elementFromPoint(clientX,clientY)},DOMUtil.scrollElmentIntoView=function(activeElem,scrollSelector,scrollToMiddle,includeMargin){var winElement;if(activeElem.length&&(winElement=scrollSelector instanceof $?scrollSelector:activeElem.closest(scrollSelector),winElement.length)){var offset,winTop=winElement.offset().top,winBottom=winTop+winElement.height(),elementTop=activeElem.offset().top,elementBottom=elementTop+activeElem.outerHeight(!!includeMargin),elementHeight=elementBottom-elementTop,windowHeight=winBottom-winTop;offset=activeElem[0].getBoundingClientRect().top,scrollToMiddle?(offset-=winElement.height()/2,winElement.scrollTop(winElement.scrollTop()+offset)):elementHeight>windowHeight?(offset=elementTop-winTop,winElement.scrollTop(winElement.scrollTop()+offset)):elementBottom>winBottom?(offset=elementBottom-winBottom,winElement.scrollTop(winElement.scrollTop()+offset)):winTop>elementTop&&(offset=elementTop-winTop,winElement.scrollTop(winElement.scrollTop()+offset))}},DOMUtil.getAction=function(e,scopeSelector,closestIsDataAction){var action,elem,thatScope,parent=(closestIsDataAction?$(e.target).closest("[data-action]"):$(e.target).parent())[0];return e.target.getAttribute("data-action")?(action=e.target.getAttribute("data-action"),elem=$(e.target)):parent&&parent.getAttribute("data-action")&&(action=parent.getAttribute("data-action"),elem=$(parent)),action&&scopeSelector&&(thatScope=$(elem.closest(scopeSelector)).scope()),{action:action,element:elem,scope:thatScope}},DOMUtil.isElementInViewport=function(element,parent){var parentRect,rect=element.getBoundingClientRect(),visible={top:!1,right:!1,bottom:!1,left:!1,inView:!1};return parentRect=(parent?parent:$("body")[0]).getBoundingClientRect(),visible.top=rect.top+rect.height-parentRect.top>=0,visible.right=parentRect.right-(rect.right-rect.width)>=0,visible.bottom=parentRect.bottom+rect.height>=rect.bottom,visible.left=rect.left-parentRect.left+rect.width>=0,visible.inView=visible.top&&visible.right&&visible.bottom&&visible.left,visible},DOMUtil}),define("general.utils/support",["touche"],function(Touche){"use strict";function treatAsDesktop(){return!Touche.utils.msPointer||0!==window.navigator.msMaxTouchPoints&&0!==window.navigator.maxTouchPoints?Touche.utils.msPointer&&(window.navigator.msMaxTouchPoints>0||window.navigator.maxTouchPoints>0)?!1:!Touche.utils.touch:!0}function isMouse(e){return Touche.utils.isMouse(e)}return{treatAsDesktop:treatAsDesktop,isMouse:isMouse}}),define("assets/qvangular/qvangular-directives",["jquery","assets/qvangular/qvangular-core","angular","assets/qvangular/qvangular-highlight/highlight","general.utils/dom-util","touche","general.utils/support"],function($,qvangular,angular,highlight,domUtil,Touche,Support){function registerDelegatedDirective(directiveName,eventName){qvangular.directive(directiveName,["$parse",function($parse){return function(scope,element,attrs){for(var clicks=attrs[directiveName].split(";"),i=0;i<clicks.length;i++){var data=clicks[i].trim().split("#"),selector=data[0],fn=$parse(data[1]);!function(iSelector,iFn){element.on(eventName,selector,function(evt){scope.$apply(function(){iFn(scope,{$event:evt})})})}(selector,fn)}}}])}function getKeydownDirectiveWithKeyCode(directiveName,keycode,overrideElement){return["$parse",function($parse){return{restrict:"A",link:function(scope,elem,attr){var fn=$parse(attr[directiveName]),eventHandler=function(e){keycode&&keycode!==e.which||setTimeout(function(){e.preventDefault(),scope.$apply(function(){fn(scope,{$event:e})})})};$(overrideElement?overrideElement:elem).bind("keydown",eventHandler),scope.$on("$destroy",function(){$(overrideElement?overrideElement:elem).unbind("keydown",eventHandler)})}}}]}qvangular.directive("qvaBlur",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaBlur);element.bind("blur",function(event){qvangular.$apply(scope,function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaDblclick",["$parse",function($parse){return function($scope,$element,$attr){var fn=$parse($attr.qvaDblclick),ns="qva-dblclick"+$scope.$id;Touche($element[0]).doubletap({id:ns,options:{timeThreshold:250,preventDefault:!1},end:function(){$scope.$apply(fn)}}),$scope.$on("$destroy",function(){Touche($element[0]).off("doubletap",ns)})}}]),qvangular.directive("qvaDblclick",["$parse",function($parse){return function($scope,$element,$attr){var fn=$parse($attr.qvaDblclick),ns="qva-dblclick"+$scope.$id;Touche($element[0]).doubletap({id:ns,options:{timeThreshold:250,preventDefault:!1},end:function(){$scope.$apply(fn)}}),$scope.$on("$destroy",function(){Touche($element[0]).off("doubletap",ns)})}}]),qvangular.directive("qvaActivate",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaActivate);element.on("qv-activate keypress",function(event){var isSpaceBar="keypress"===event.type&&32===event.which;("keypress"!==event.type||isSpaceBar&&$(event.target).is(":input"))&&scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaScrollIntoView",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.qvaScrollIntoView,function(val){val.scrollSelector&&val.scroll&&$timeout(function(){domUtil.scrollElmentIntoView(element,val.scrollSelector)})},!0)}}}]),qvangular.directive("qvaPreventDrag",function(){return{restrict:"A",link:function(scope,element){element.on("qv-press",function(e){e.preventDefault()})}}}),qvangular.directive("qvaPress",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaPress);element.on("qv-press",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaStopProp",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaPress);element.on("qv-press",function(event){$(event.target).is(element)&&(event.stopPropagation(),event.preventDefault(),scope.$apply(function(){fn(scope,{$event:event})}))})}}]),qvangular.directive("qvaContextMenu",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaContextMenu);element.bind("qv-contextmenu",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaRadialContextMenu",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaRadialContextMenu);element.bind("qv-radial-contextmenu",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),qvangular.directive("qvaSwipeUpdate",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaSwipeUpdate);element.bind("qv-swipeupdate",function(event){scope.$apply(function(){fn(scope,{$event:event,$element:element})})})}}]),qvangular.directive("qvaSwipe",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaSwipe);element.bind("qv-swipe",function(event){scope.$apply(function(){fn(scope,{$event:event,$element:element})})})}}]),qvangular.directive("qvaLoad",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaLoad);element.on("load",function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}]),registerDelegatedDirective("qvaDelegatedClick","click"),registerDelegatedDirective("qvaDelegatedActivate","qv-activate"),qvangular.directive("qvaIndeterminate",["$parse",function(){return function(scope,element,attrs){var value=attrs.qvaIndeterminate;element.prop("indeterminate",value===!0||"true"===value),scope.$watch(attrs.qvaIndeterminate,function(newValue){element.prop("indeterminate",newValue===!0||"true"===newValue)})}}]),qvangular.directive("qvaOutside",["$parse",function($parse){return function(scope,element,attr){var fn=$parse(attr.qvaOutside),forceIgnore=!1,override=!1;element.bind("qv-outside",function(event){forceIgnore="allOutside"===$(event.target).attr("qva-outside-ignore-for")||$(event.target).closest('[qva-outside-ignore-for="allOutside"]').length,override=$(event.target).data("overrideignore"),(!forceIgnore||override)&&(attr.qvaOutsideIgnoreFor&&attr.qvaOutsideIgnoreFor===$(event.target).closest("[qva-outside-ignore-for]").attr("qva-outside-ignore-for")||scope.$apply(function(){fn(scope,{$event:event})}))})}}]),qvangular.directive("qvaOnDragstart",["$parse",function($parse){return function(scope,element,attrs){if("ondragstart"in window){var fn=$parse(attrs.qvaOnDragstart);scope.$watch(attrs.qvaDragDisabled,function(disabled){disabled||element.attr("draggable","true").addClass("draggable").on("dragstart",function(event){$(this).addClass("dragging"),fn(scope,{$event:event})}).on("dragend",function(){$(this).removeClass("dragging")}).on("selectstart",function(e){var target=e.originalEvent.target;target.dragDrop&&target.dragDrop()}).on("mousedown","button",function(e){e.preventDefault()})})}}}]),qvangular.directive("qvaModelOnblur",function(){return{restrict:"A",require:"ngModel",priority:1,link:function(scope,elm,attr,ngModelCtrl){"radio"!==attr.type&&"checkbox"!==attr.type&&(elm.unbind("input keydown change compositionend"),elm.bind("blur",function(){scope.$apply(function(){"undefined"!=typeof attr.qvaCancelEditingOnEmpty&&""===elm.val().trim()?elm.val(ngModelCtrl.$modelValue):ngModelCtrl.$setViewValue(elm.val())})}),elm.bind("keydown",function(e){27===e.which?(e.stopPropagation(),elm.val(ngModelCtrl.$modelValue),elm.closest("*[tabindex]").focus()):13===e.which&&(e.stopPropagation(),elm.closest("*[tabindex]").focus())}))}}}),qvangular.directive("qvaSelect",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,data){(0===data.qvaSelect.length||"true"===data.qvaSelect)&&Support.treatAsDesktop()&&$timeout(function(){element[0].select()},100)}}}]),qvangular.directive("qvaSelectWatch",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.qvaSelectWatch,function(val){(""===attrs.qvaSelectWatch||""!==attrs.qvaSelectWatch&&val===!0)&&Support.treatAsDesktop()&&$timeout(function(){element[0].select()})},!0)}}}]),qvangular.directive("qvaFallbackSrc",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("error",function(){angular.element(this).attr("src",attrs.qvaFallbackSrc)})}}}),qvangular.directive("qvaFocus",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.qvaFocus,function(val){val===!0&&$timeout(function(){element[0].focus()})},!0)}}}]),qvangular.directive("qveHighlight",highlight),qvangular.directive("qvaReportedWindowSize",function(){return{restrict:"A",link:function(scope,elem,attr){function reportSize(){qvangular.$apply(function(){scope[attr.qvaReportedWindowSize]={width:$(window).width(),height:$(window).height()}})}reportSize(),$(window).bind("resize",reportSize),scope.$on("$destroy",function(){$(window).unbind("resize",reportSize)})}}}),qvangular.directive("qvGlobalKeydown",getKeydownDirectiveWithKeyCode("qvGlobalKeydown",void 0,$("body"))),qvangular.directive("qvGlobalEscape",getKeydownDirectiveWithKeyCode("qvGlobalEscape",27,$("body"))),qvangular.directive("qvGlobalEnter",getKeydownDirectiveWithKeyCode("qvGlobalEnter",13,$("body"))),qvangular.directive("qvKeydown",getKeydownDirectiveWithKeyCode("qvKeydown",void 0)),qvangular.directive("qvEscape",getKeydownDirectiveWithKeyCode("qvEscape",27)),qvangular.directive("qvEnter",getKeydownDirectiveWithKeyCode("qvEnter",13))}),define("text!assets/qvangular/qui-popover-button/qui-popover-button.ng.html",[],function(){return'<button\r\n		class="qui-popover-button qui-dropdown"\r\n		tid="{{quiModel.tid}}"\r\n		data-ng-disabled="quiModel.isDisabled()"\r\n		data-ng-class="buttonClasses"\r\n		data-icon="{{quiModel.icon}}"\r\n		q-title-translation="{{currentTitle}}"\r\n		data-qva-activate="onClick()"></button>'}),define("text!assets/qvangular/qui-popover-button/qui-popover-button-menu.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo"\r\n					  smallview="quiModel.menuOptions.smallview"\r\n					  position="quiModel.menuOptions.position"\r\n					  width="quiModel.menuOptions.width"\r\n					  top="quiModel.menuOptions.top"\r\n					  hidepointer="quiModel.menuOptions.hidepointer"\r\n					  on-close-view="onClose(event)">\r\n	<div qva-include-qui-popover-button component=\'quiList\' input="quiModel.menuOptions.content" data-destroy-component="closeFromContent()"></div>\r\n</immidiate-contextual>'}),define("core.utils/deferred",["assets/qvangular/qvangular-core"],function(qvangular){var Deferred;return Deferred=function(){var d=qvangular.getService("$q").defer();return d},Deferred.resolve=function(value){var d=qvangular.getService("$q").defer();return d.resolve(value),d.promise},Deferred.reject=function(){return qvangular.getService("$q").reject.apply(null,arguments)},Deferred.all=function(){return qvangular.getService("$q").all.apply(null,arguments)},Deferred.when=function(){return qvangular.getService("$q").when.apply(null,arguments)},Deferred}),define("general.services/show-service/show-service",["jquery","assets/qvangular/qvangular-core","core.utils/deferred"],function($,qvangular,Deferred){"use strict";function ensureInitialized(){if(!initialized){var elementAtTheEndOfTheBody=$("<div id='show-service-popup-dialog'></div>");$("body").append(elementAtTheEndOfTheBody),elementAtTheEndOfTheBody.showComponent(containerComponent,{views:views}),initialized=!0}}function showNormal(component,input){function destroy(){var index=views.indexOf(view);index>=0&&views.splice(index,1)}ensureInitialized();var deferredResult=new Deferred,view={component:component,input:input,deferredResult:deferredResult,exposedApi:{destroy:destroy,resultPromise:deferredResult.promise}};return views.push(view),view.exposedApi}function showDeferred(component,input){var locals={$element:$("body"),input:input};for(var key in input)input.hasOwnProperty(key)&&(locals[key]=input[key]);return qvangular.$injector.invoke(component,{},locals)}function show(component,input){return"function"==typeof component||Array.isArray(component)?showDeferred(component,input):showNormal(component,input)}function isViewShowing(){return views.length>0}var initialized,views=[];qvangular.componentDirective("qvShowServiceView",{destroyComponent:"&",input:"=",deferredResult:"=",exposedApi:"="});var containerComponent={template:"<div><div ng-repeat='view in views' qv-show-service-view component='view.component' data-input='view.input' data-deferred-result='view.deferredResult' destroy-component='unshow(view)' data-exposed-api='view.exposedApi'></div></div>",
controller:["$scope",function($scope){$scope.unshow=function(view){var index=$scope.views.indexOf(view);index>=0&&$scope.views.splice(index,1)}}]},exports={show:show,isViewShowing:isViewShowing};return exports}),define("text!assets/qlikui/components/qui-list/qui-list.ng.html",[],function(){return'<ul ng-class="menuClasses" tid="{{tid}}">\r\n	<li class="toolbar-menu-li" ng-repeat="menuItem in menuItems" data-icon="{{menuItem.icon}}" ng-disabled="menuItem.disable" qui-click=\'menuItem.fn()\' ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" ng-hide="menuItem.hide">\r\n		<span class="qui-textlist-text"\r\n			  tid="{{menuItem.tid}}"\r\n			  q-title-translation="{{ menuItem.title || menuItem.text}}"\r\n			  ng-class="{\'open-in-new-tab-text-optional\': menuItem.openInNewTab == \'optional\', \'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}"\r\n			  qva-activate="selectMenuItem(menuItem, $event)" q-translation="{{menuItem.text}}" ng-disabled="menuItem.disable">\r\n		</span>\r\n		<span ng-if="menuItem.openInNewTab" class="open-in-new-tab" ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" data-icon="stacked-windows" q-title-translation="{{ menuItem.title || \'Tooltip.OpenInNewTab\'}}" qva-activate="selectMenuItem(menuItem, $event, \'true\')" ng-disabled="menuItem.disable"></span>\r\n	</li>\r\n</ul>'}),define("assets/qlikui/components/qui-list/qui-list",["qlikui/qui","text!./qui-list.ng.html"],function(qui,listTemplate){return qui.component("quiList",{scope:{tid:"=",menuClasses:"=",createMenuItems:"="},template:listTemplate,controller:["$scope",function($scope){$scope.menuClasses=$scope.menuClasses?$scope.menuClasses:"qui-textlist",$scope.createMenuItems().then(function(items){$scope.menuItems=items}),$scope.selectMenuItem=function(menuItem,event,openInNewTab){event&&event.preventDefault&&event.preventDefault(),menuItem.disable||($scope.destroyComponent(),menuItem.selected(event,openInNewTab))}}]})}),define("pubsub",[],function(){function PubSub(){this.topics={},this.wildcards=[]}return PubSub.prototype.getTopics=function(topic,create){var topicArray=this.topics[topic];return"undefined"==typeof topicArray&&create&&(topicArray=this.topics[topic]=[]),topicArray},PubSub.prototype.createMatcher=function(topic){return topic=topic.replace(/\$/g,"\\$"),new RegExp("^"+topic.replace(/\*/g,".+?")+"$","i")},PubSub.prototype.subscribe=function(topic,handler,context){if(topic=topic.toLowerCase().split("."),"function"!=typeof handler)throw"pubsub: Invalid handler";var obj={handler:handler,topic:topic[0],namespace:topic[1],context:context||window};topic[0].indexOf("*")>-1?(obj.matcher=this.createMatcher(topic[0]),this.wildcards.push(obj)):this.getTopics(topic[0],!0).push(obj)},PubSub.prototype.subscribeOnce=function(topic,handler,context){function wrapper(){handler.apply(this,arguments),self.unsubscribe(topic,handler)}var self=this;wrapper.original=handler,this.subscribe(topic,wrapper,context)},PubSub.prototype.unsubscribe=function(topic,handler){topic=topic.toLowerCase(),this["."===topic[0]?"unsubscribeNamespace":"unsubscribeTopic"](topic,handler)},PubSub.prototype.unsubscribeNamespace=function(namespace){function compare(item){return item.namespace!==namespace}namespace=namespace.substr(1);var topic;this.wildcards=this.wildcards.filter(compare);for(topic in this.topics)this.topics[topic]=this.topics[topic].filter(compare),this.topics[topic].length||delete this.topics[topic]},PubSub.prototype.unsubscribeTopic=function(topic,handler){function matcher(item){var result=item.topic!==topic[0];return!result&&handler&&(result=item.handler.original?item.handler.original!==handler:item.handler!==handler),result}topic=topic.split(".");var arr=this.getTopics(topic[0]);this.wildcards=this.wildcards.filter(matcher),arr&&(arr=this.topics[topic[0]]=arr.filter(matcher),arr.length||delete this.topics[topic[0]])},PubSub.prototype.publish=function(topic,data){function callIt(item){(!item.matcher||item.matcher&&item.matcher.test(topic[0]))&&item.handler.call(item.context,data,topic[0])}topic=topic.toLowerCase().split(".");var arr=this.getTopics(topic[0]);this.wildcards.forEach(callIt),arr&&arr.forEach(callIt)},window.pubsub=new PubSub,window.pubsub}),define("general.utils/android-keyboard-fix",[],function(){"use strict";function AndroidKeyboardFix(viewport,_window,_document){this.lastHeight=null,this.document=_document||document,this.window=_window||window,this.viewport=viewport||this.document.querySelector("meta[name=viewport]"),this.viewportContent=this.viewport.getAttribute("content"),this.updateHeight()}return AndroidKeyboardFix.prototype.clearHeight=function(){this.viewport.setAttribute("content",this.viewportContent)},AndroidKeyboardFix.prototype.setHeight=function(height){this.viewport.setAttribute("content",this.viewportContent+", height="+height)},AndroidKeyboardFix.prototype.updateHeight=function(){var w_height=this.window.innerHeight;return this.lastHeight!==w_height?(this.lastHeight=w_height,this.setHeight(w_height),!0):!1},AndroidKeyboardFix.prototype.rotate=function(resize){var update=function(){this.updateHeight()&&resize()}.bind(this);this.document.activeElement&&this.document.activeElement.blur(),this.clearHeight(),this.window.setTimeout(update,500),this.window.setTimeout(update,1e3),this.window.setTimeout(update,1500)},AndroidKeyboardFix.isNeeded=function(){var isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>-1;return isAndroid},AndroidKeyboardFix}),define("core.utils/resize",["touche","pubsub","general.utils/android-keyboard-fix"],function(Touche,pubsub,AndroidKeyboardFix){function start(e){isStarted=!0,publish("/resize/start",e)}function end(e){publish("/resize/end",e),isStarted=!1}function publish(topic,e){pubsub.publish(topic,{width:window.innerWidth,height:window.innerHeight,element:e.target})}function resizeEvt(e){(e.target===window||e.target===document)&&(isStarted||start(e),clearTimeout(timer),publish("/resize/update",e),timer=setTimeout(function(){end(e)},delay))}function orientationEvt(e){keyboardfix?keyboardfix.rotate(function(){start(e),end(e)}):(start(e),end(e))}var timer,delay=250,isStarted=!1,keyboardfix=AndroidKeyboardFix.isNeeded()?new AndroidKeyboardFix:null;return Touche.utils.touch&&"ondeviceorientation"in window&&window.addEventListener("orientationchange",orientationEvt,!1),keyboardfix||window.addEventListener("resize",resizeEvt,!1),{on:function(type,callback){pubsub.subscribe("/resize/"+type,callback)},off:function(type,callback){pubsub.unsubscribe("/resize/"+type,callback)},force:function(type){type=type||"end",pubsub.publish("/resize/"+type)}}}),define("objects.utils/shapes/geometry-math",[],function(){"use strict";var GeometryMath,epsilon=1e-12;return GeometryMath={checkPointsCoincident:function(p1,p2){return p1.x===p2.x&&p1.y===p2.y?!0:!1},checkPointOnLineSegment2:function(p,p1,p2){var dx,dy,t1,t2;return dx=p2.x-p1.x,dy=p2.y-p1.y,0===dx?0===dy?GeometryMath.checkPointsCoincident(p,p1):p.x!==p1.x?!1:(t1=(p.y-p1.y)/dy,t1>=0&&1>=t1?!0:!1):0===dy?p.y!==p1.y?!1:(t1=(p.x-p1.x)/dx,t1>=0&&1>=t1?!0:!1):(t1=(p.x-p1.x)/dx,t2=(p.y-p1.y)/dy,t1>=0&&1>=t1&&Math.abs(t1-t2)<epsilon?!0:!1)},checkPointOnLineSegment:function(p,line){return GeometryMath.checkPointOnLineSegment2(p,line[0],line[1])},checkLineSegmentIntersectingLineSegment2:function(p1,p2,p3,p4){var dx1,dy1,dx2,dy2,dx3,dy3,ua_t,ub_t,u_b,ua,ub,t1,t2;if(dx1=p2.x-p1.x,dy1=p2.y-p1.y,dx2=p4.x-p3.x,dy2=p4.y-p3.y,dx3=p1.x-p3.x,dy3=p1.y-p3.y,u_b=dy2*dx1-dx2*dy1,ua_t=dx2*dy3-dy2*dx3,ub_t=dx1*dy3-dy1*dx3,0===u_b){if(0===ua_t&&0===ub_t){if(0===dx1){if(0===dy1)return GeometryMath.checkPointOnLineSegment2(p1,p3,p4);t1=(p3.y-p1.y)/dy1,t2=(p4.y-p1.y)/dy1}else t1=(p3.x-p1.x)/dx1,t2=(p4.x-p1.x)/dx1;return 0>t1&&0>t2||t1>1&&t2>1?!1:!0}return!1}return ua=ua_t/u_b,ub=ub_t/u_b,ua>=0&&1>=ua&&ub>=0&&1>=ub?!0:!1},checkLineSegmentIntersectingLineSegment:function(line1,line2){return GeometryMath.checkLineSegmentIntersectingLineSegment2(line1[0],line1[1],line2[0],line2[1])},checkPointInsideRectDefinedByMaxMin:function(p,rect){return p.x>rect.minX&&p.x<rect.maxX&&p.y>rect.minY&&p.y<rect.maxY},checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin:function(p,rect){return p.x>=rect.minX&&p.x<=rect.maxX&&p.y>=rect.minY&&p.y<=rect.maxY},checkLineSegmentIntersectingRectDefinedByMaxMin:function(line,rect){return GeometryMath.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(line[0],rect)||GeometryMath.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(line[0],rect)?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.minX,y:rect.minY},{x:rect.minX,y:rect.maxY}])?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.maxX,y:rect.minY},{x:rect.maxX,y:rect.maxY}])?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.minX,y:rect.minY},{x:rect.maxX,y:rect.minY}])?!0:GeometryMath.checkLineSegmentIntersectingLineSegment(line,[{x:rect.minX,y:rect.maxY},{x:rect.maxX,y:rect.maxY}])?!0:!1},checkPolylineIntersectingRectDefinedByMaxMin:function(polyline,rect){var p1,p2,i,minX,maxX,minY,maxY,numPoints=polyline?polyline.length:0;if(0===numPoints)return!1;if(p2=polyline[0],p2.x>rect.maxX)return!1;if(p2.x>=rect.minX&&p2.y>=rect.minY&&p2.y<=rect.maxY)return!0;for(p1=p2,i=1;numPoints>i;i++){if(p2=polyline[i],p2.x>=rect.minX&&p2.x<=rect.maxX&&p2.y>=rect.minY&&p2.y<=rect.maxY)return!0;if(minX=Math.min(p1.x,p2.x),minX>rect.maxX)return!1;if(maxX=Math.max(p1.x,p2.x),maxX<rect.minX)p1=p2;else if(minY=Math.min(p1.y,p2.y),minY>rect.maxY)p1=p2;else if(maxY=Math.max(p1.y,p2.y),maxY<rect.minY)p1=p2;else{if(GeometryMath.checkLineSegmentIntersectingRectDefinedByMaxMin([p1,p2],rect))return!0;p1=p2}}return!1},checkPolylinesIntersectingRectDefinedByMaxMin:function(polylines,rect){var i,numPolylines=polylines?polylines.length:0;for(i=0;numPolylines>i;i++)if(GeometryMath.checkPolylineIntersectingRectDefinedByMaxMin(polylines[i],rect))return!0;return!1},calculateBounds:function(shapes){var shape,rect,i,rectMaxX,rectMaxY,xMin=Number.MAX_VALUE,xMax=-Number.MAX_VALUE,yMin=Number.MAX_VALUE,yMax=-Number.MAX_VALUE,len=shapes?shapes.length:0;if(0===len)return null;for(i=0;len>i;i++)shape=shapes[i],rect=shape?shape.calculateBounds():void 0,rect&&rect.x!==1/0&&(rectMaxX=rect.getRight(),rectMaxY=rect.getBottom(),rectMaxX>xMax&&(xMax=rectMaxX),rect.x<xMin&&(xMin=rect.x),rectMaxY>yMax&&(yMax=rectMaxY),rect.y<yMin&&(yMin=rect.y));return{x:xMin,y:yMin,width:xMax-xMin,height:yMax-yMin}}}}),define("objects.utils/shapes/line",["./geometry-math"],function(GeometryMath){"use strict";function Line(x1,y1,x2,y2){0===arguments.length?this.set(0,0,0,0):2===arguments.length?this.set(x1.x,x1.y,y1.x,y1.y):this.set(x1,y1,x2,y2)}return Line.prototype={toString:function(){return this.x1+" "+this.y1+" "+this.x2+" "+this.y2},clone:function(){return new Line(this.x1,this.y1,this.x2,this.y2)},set:function(x1,y1,x2,y2){this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2},intersectsLine:function(line){return GeometryMath.checkLineSegmentIntersectingLineSegment(this.getPoints(),line.getPoints())},intersectsRect:function(rect){return this.intersectsLine(new Line(rect.x,rect.y,rect.x+rect.width,rect.y))||this.intersectsLine(new Line(rect.x+rect.width,rect.y,rect.x+rect.width,rect.y+rect.height))||this.intersectsLine(new Line(rect.x,rect.y+rect.height,rect.x+rect.width,rect.y+rect.height))||this.intersectsLine(new Line(rect.x,rect.y,rect.x,rect.y+rect.height))},getPoints:function(){var points=[];return points.push({x:this.x1,y:this.y1}),points.push({x:this.x2,y:this.y2}),points}},Line}),define("objects.utils/shapes/rect",["./line"],function(Line){"use strict";function Rect(x,y,width,height){0===arguments.length?this.set(0,0,0,0):this.set(x,y,width,height)}return Rect.prototype={toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},clone:function(){return new Rect(this.x,this.y,this.width,this.height)},set:function(x,y,width,height){width>=0?(this.x=x,this.width=width):(this.x=x+width,this.width=-width),height>=0?(this.y=y,this.height=height):(this.y=y+height,this.height=-height)},setLTRB:function(l,t,r,b){r>=l?(this.x=l,this.width=r-l):(this.x=r,this.width=l-r),b>=t?(this.y=t,this.height=b-t):(this.y=b,this.height=t-b)},equal:function(rect){return rect&&this.x===rect.x&&this.y===rect.y&&this.width===rect.width&&this.height===rect.height},combineWith:function(rect){var x,y,w,h,r=Math.max(rect.getRight(),this.getRight()),b=Math.max(rect.getBottom(),this.getBottom());return x=Math.min(rect.x,this.x),y=Math.min(rect.y,this.y),w=Math.max(0,r-x),h=Math.max(0,b-y),new Rect(x,y,w,h)},intersectsWith:function(rect){return rect&&this.x<=rect.getRight()&&rect.x<=this.getRight()&&this.y<=rect.getBottom()&&rect.y<=this.getBottom()?!0:!1},intersectsRect:function(rect){return this.intersectsWith(rect)},intersection:function(rect,strict){var x,y,r,b;return this.intersectsWith(rect)?(x=Math.max(this.x,rect.x),y=Math.max(this.y,rect.y),r=Math.min(this.getRight(),rect.getRight()),b=Math.min(this.getBottom(),rect.getBottom()),new Rect(x,y,r-x,b-y)):strict?null:new Rect(this.x,this.y,this.width,this.height)},union:function(rect){var x,y,r,b;return x=Math.min(this.x,rect.x),y=Math.min(this.y,rect.y),r=Math.max(this.getRight(),rect.getRight()),b=Math.max(this.getBottom(),rect.getBottom()),new Rect(x,y,r-x,b-y)},pointInside:function(x,y){return x>=this.x&&x<=this.getRight()&&y>=this.y&&y<=this.getBottom()},rectInside:function(rect){var i,points=rect.getPoints();for(i=0;4>i;i++)if(!this.pointInside(points[i].x,points[i].y))return!1;return!0},intersectsLine:function(line){var r=this.getRight(),b=this.getBottom();return this.pointInside(line.x1,line.y1)||this.pointInside(line.x2,line.y2)?!0:line.intersectsLine(new Line(this.x,this.y,r,this.y))||line.intersectsLine(new Line(r,this.y,r,b))||line.intersectsLine(new Line(r,b,this.x,b))||line.intersectsLine(new Line(this.x,b,this.x,this.y))?!0:!1},getPoints:function(){var points=[];return points.push({x:this.x,y:this.y}),points.push({x:this.getRight(),y:this.y}),points.push({x:this.getRight(),y:this.getBottom()}),points.push({x:this.x,y:this.getBottom()}),points},getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenterPoint:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},getBoundingRect:function(){return this},scale:function(s){var d=s-1,dw=d*this.width/2,dh=d*this.height/2;this.x-=dw,this.y-=dh,this.width*=s,this.height*=s},hasNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.width)||isNaN(this.height)}},Rect}),define("general.utils/window-positioner",["jquery","objects.utils/shapes/rect"],function($,Rect){"use strict";function rectRight(dialog,target){var top,left,maxH=$("body").outerHeight();return top=target.y+target.height/2-dialog.height/2,top=0>top?0:top,maxH-top-dialog.height<0&&(top=maxH-dialog.height),left=target.x+target.width,new Rect(left,top,dialog.width,dialog.height)}function rectBottom(dialog,target){var top,left,maxW=$("body").outerWidth();return left=target.x+target.width/2-dialog.width/2,left=0>left?0:left,maxW-left-dialog.width<0&&(left=maxW-dialog.width),top=target.y+target.height,new Rect(left,top,dialog.width,dialog.height)}function rectLeft(dialog,target){var top,left,maxH=$("body").outerHeight();return top=target.y+target.height/2-dialog.height/2,top=0>top?0:top,maxH-top-dialog.height<0&&(top=maxH-dialog.height),left=target.x-dialog.width,new Rect(left,top,dialog.width,dialog.height)}function rectTop(dialog,target){var top,left,maxW=$("body").outerWidth();return left=target.x+target.width/2-dialog.width/2,left=0>left?0:left,maxW-left-dialog.width<0&&(left=maxW-dialog.width),top=target.y-dialog.height,new Rect(left,top,dialog.width,dialog.height)}function getElemRect(elem){var offset=elem[0]===window?{left:0,top:0}:elem.offset();return new Rect(offset.left,offset.top,elem.outerWidth(),elem.outerHeight())}function getPositionRect(dialog,target,position){var func,map={top:rectTop,right:rectRight,bottom:rectBottom,left:rectLeft};return func=map[position]||rectRight,func.call({},dialog,target)}function validatePosition(position){var valid="bottom,bottomLeft,bottomRight,centerLeft,center,centerRight,topLeft,top,topRight,topLeft,left,right".split(",");if(-1===valid.indexOf(position))throw new Error("Not a valid docking position. Try "+valid.join(" ,")+".")}function distanceOutsideWindow(position,dialog,windowRect){return"right"===position?dialog.getRight()-windowRect.getRight():"left"===position?windowRect.x-dialog.x:"top"===position?windowRect.y-dialog.y:"bottom"===position?dialog.getBottom()-windowRect.getBottom():0}function flip(position){var map={top:"bottom",right:"left",bottom:"top",left:"right"};return map[position]}function allowFlip(collision){return"flip"===collision||"flipfit"===collision}function allowFit(collision){return"fit"===collision||"flipfit"===collision}function getPositionAxis(position){var map={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"};return map[position]}function getAxisPositions(axis){var map={vertical:["top","bottom"],horizontal:["left","right"]};return map[axis]}function flipAxis(axis){var map={horizontal:"vertical",vertical:"horizontal"};return map[axis]}function getCollision(options){var values=options.collision.split(" "),collision={horizontal:values[0],vertical:values[1]||values[0]},primaryAxis=getPositionAxis(options.position),secondaryAxis=flipAxis(primaryAxis);return{flipPrimary:allowFlip(collision[primaryAxis]),fitPrimary:allowFit(collision[primaryAxis]),fitSecondary:allowFit(collision[secondaryAxis])}}function fitRect(rect,sides,windowRect){var i,side;for(i=0;i<sides.length;i++){if(side=sides[i],"left"===side&&rect.x<windowRect.x){rect.x=windowRect.x;break}if("right"===side&&rect.getRight()>windowRect.getRight()){rect.x=windowRect.getRight()-rect.width;break}if("top"===side&&rect.y<window.y){rect.y=window.y;break}if("bottom"===side&&rect.getBottom()>windowRect.getBottom()){rect.y=windowRect.getBottom()-rect.height;break}}return rect}function calculatePossiblePositionsAndAligns(aligns,positions,shapeIsArc,cx,cy,d){if(!shapeIsArc)return aligns.map(function(a,index){return{align:a,x:positions[index].x,y:positions[index].y}});var x=positions[0].x,y=positions[0].y,createObjects=function(a){var i,t,x0,y0,len=a?a.length/2:0,positionsAndAligns=new Array(len);for(i=0;len>i;i++)t=a[2*i+1],x0=t*x+(1-t)*cx,y0=t*y+(1-t)*cy,positionsAndAligns[i]={align:a[2*i],x:x0,y:y0};return positionsAndAligns},combinedAligns=aligns[0]+(aligns[1]?"-"+aligns[1]:""),tc1=1,tc2=.7,tc3=.5,tf1=d>.5?0:.5-d,tf2=d>.5?.5:.7-.4*d;switch(combinedAligns){case"top":return createObjects(x>=cx?["top",tc1,"top",tc2,"top",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"bottom",tf1,"bottom",tf2]:["top",tc1,"top",tc2,"top",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"bottom",tf1,"bottom",tf2]);case"top-right":return createObjects(["top",tc1,"top",tc2,"top",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"bottom",tf1,"bottom",tf2]);case"top-left":return createObjects(["top",tc1,"top",tc2,"top",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"bottom",tf1,"bottom",tf2]);case"bottom":return createObjects(x>=cx?["bottom",tc1,"bottom",tc2,"bottom",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"top",tf1,"top",tf2]:["bottom",tc1,"bottom",tc2,"bottom",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"top",tf1,"top",tf2]);case"bottom-right":return createObjects(["bottom",tc1,"bottom",tc2,"bottom",tc3,"right",tc2,"right",tc3,"left",tc3,"left",tc2,"top",tf1,"top",tf2]);case"bottom-left":return createObjects(["bottom",tc1,"bottom",tc2,"bottom",tc3,"left",tc2,"left",tc3,"right",tc3,"right",tc2,"top",tf1,"top",tf2]);case"left":return createObjects(cy>=y?["left",tc1,"left",tc2,"left",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"right",tc3,"right",tc2]:["left",tc1,"left",tc2,"left",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"right",tc3,"right",tc2]);case"left-top":return createObjects(["left",tc1,"left",tc2,"left",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"right",tc3,"right",tc2]);case"left-bottom":return createObjects(["left",tc1,"left",tc2,"left",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"right",tc3,"right",tc2]);case"right":return createObjects(cy>=y?["right",tc1,"right",tc2,"right",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"left",tc3,"left",tc2]:["right",tc1,"right",tc2,"right",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"left",tc3,"left",tc2]);case"right-top":return createObjects(["right",tc1,"right",tc2,"right",tc3,"top",tc2,"top",tc3,"bottom",tc3,"bottom",tc2,"left",tc3,"left",tc2]);case"right-bottom":return createObjects(["right",tc1,"right",tc2,"right",tc3,"bottom",tc2,"bottom",tc3,"top",tc3,"top",tc2,"left",tc3,"left",tc2])}}var positioner={align:function(dialogElement,alignToElement,options){if(options=options||{position:"right",collision:"none"},options.position=options.position||"right",options.collision=options.collision||"none",dialogElement&&alignToElement){var isFlipPositionBetter,windowRect=getElemRect($(window)),dialog=getElemRect(dialogElement),target=getElemRect(alignToElement),collision=getCollision(options),positionRect=getPositionRect(dialog,target,options.position);isFlipPositionBetter=function(rect){var flipRect=getPositionRect(dialog,target,flip(options.position)),distance=distanceOutsideWindow(options.position,rect,windowRect),flipDistance=distanceOutsideWindow(flip(options.position),flipRect,windowRect);return distance>flipDistance},collision.flipPrimary&&distanceOutsideWindow(options.position,positionRect,windowRect)>0&&isFlipPositionBetter(positionRect)&&(positionRect=getPositionRect(dialog,target,flip(options.position)),options.position=flip(options.position)),collision.fitPrimary&&(positionRect=fitRect(positionRect,[options.position],windowRect)),collision.fitSecondary&&(positionRect=fitRect(positionRect,getAxisPositions(flipAxis(getPositionAxis(options.position))),windowRect)),options.limits&&positionRect.y<options.limits.top&&(positionRect.y=options.limits.top),dialogElement.offset({top:positionRect.y,left:positionRect.x})}return options.position},alignToCoordinate:function(dialogElement,x,y,position,secondaryPosition){validatePosition(position);var calculatePosition,point;position=position||"top",calculatePosition=function(pos,x0,y0){var x1=x0,y1=y0;switch(pos){case"topRight":y1=y0-dialogElement.outerHeight();break;case"top":x1=x0-dialogElement.outerWidth()/2,y1=y0-dialogElement.outerHeight();break;case"topLeft":x1=x0-dialogElement.outerWidth(),y1=y0-dialogElement.outerHeight();break;case"right":case"centerRight":y1=y0-dialogElement.outerHeight()/2;break;case"center":x1=x0-dialogElement.outerWidth()/2,y1=y0-dialogElement.outerHeight()/2;break;case"left":case"centerLeft":x1=x0-dialogElement.outerWidth(),y1=y0-dialogElement.outerHeight()/2;break;case"bottom":x1=x0-dialogElement.outerWidth()/2;break;case"bottomLeft":x1=x0-dialogElement.outerWidth();break;case"bottomRight":x1=x0,y1=y0}return{x:x1,y:y1}},point=calculatePosition(position,x,y);var win,padding,xDiff,yDiff,min={},max={};win=$(window),padding=10,max.x=win.outerWidth()-dialogElement.outerWidth()-padding,min.x=padding,max.y=win.outerHeight()-dialogElement.outerHeight()-padding,min.y=padding;var getDiff=function(dir,poi){return poi[dir]>max[dir]?poi[dir]-max[dir]:poi[dir]<min[dir]?min[dir]-poi[dir]:0};if(secondaryPosition){xDiff=getDiff("x",point),yDiff=getDiff("y",point);var newPoint=calculatePosition(secondaryPosition,x,y);(xDiff>getDiff("x",newPoint)||yDiff>getDiff("y",newPoint))&&(point=newPoint,position=secondaryPosition)}return point.x=Math.max(min.x,Math.min(max.x,point.x)),point.y=Math.max(min.y,Math.min(max.y,point.y)),dialogElement.offset({left:point.x,top:point.y}),position},alignToBestCoordinate:function(dialogElement,positions,aligns,target,shapeIsArc,innerPadding,outerPadding){validatePosition(aligns[0]),positions=positions instanceof Array?positions:[positions];var x=positions[0].x,y=positions[0].y;dialogElement.offset({left:0,top:0}),dialogElement.width("auto"),dialogElement.height("auto");var win=$(window),windowWidth=win.outerWidth(),windowHeight=win.outerHeight(),dialogWidth=dialogElement.outerWidth(),dialogHeight=dialogElement.outerHeight(),min={},max={};outerPadding=void 0===outerPadding?5:outerPadding;var padding=(void 0===innerPadding?5:innerPadding)+outerPadding;max.x=windowWidth-dialogWidth-padding,min.x=outerPadding,max.y=windowHeight-dialogHeight-padding,min.y=outerPadding,dialogWidth+2*padding>windowWidth&&(dialogWidth=windowWidth-2*padding,dialogElement.width(dialogWidth),max.x=min.x),dialogHeight+2*padding>windowHeight&&(dialogHeight=windowHeight-2*padding,dialogElement.height(dialogHeight),max.y=min.y),aligns=aligns||["top"];var k,goodAlign,point,cx,cy,r1,r2,d,xDiff,yDiff,possiblePositionsAndAligns,calculatePosition=function(align0,x0,y0){var x1=x0,y1=y0;switch(align0){case"topRight":y1=y0-dialogHeight;break;case"top":x1=x0-dialogWidth/2,y1=y0-dialogHeight;break;case"topLeft":x1=x0-dialogWidth,y1=y0-dialogHeight;break;case"right":case"centerRight":y1=y0-dialogHeight/2;break;case"center":x1=x0-dialogWidth/2,y1=y0-dialogHeight/2;break;case"left":case"centerLeft":x1=x0-dialogWidth,y1=y0-dialogHeight/2;break;case"bottom":x1=x0-dialogWidth/2;break;case"bottomLeft":x1=x0-dialogWidth;break;case"bottomRight":x1=x0,y1=y0}return{x:x1,y:y1}},getDiff=function(axis,p){return p[axis]>max[axis]?p[axis]-max[axis]:p[axis]<min[axis]?p[axis]-min[axis]:0},goodX=x,goodY=y;shapeIsArc&&(cx=target.shape.cx+target.targetToPageTranslation.x,cy=target.shape.cy+target.targetToPageTranslation.y,r1=target.shape.innerRadius,r2=target.shape.radius,d=0,r1>0&&(d=r1/r2,cx+=d*(x-cx),cy+=d*(y-cy))),possiblePositionsAndAligns=calculatePossiblePositionsAndAligns(aligns,positions,shapeIsArc,cx,cy,d);var findGoodPositionAndAlign=function(){for(k=0;k<possiblePositionsAndAligns.length;k++)if(goodAlign=possiblePositionsAndAligns[k].align,goodX=possiblePositionsAndAligns[k].x,goodY=possiblePositionsAndAligns[k].y,point=calculatePosition(goodAlign,goodX,goodY),xDiff=getDiff("x",point),yDiff=getDiff("y",point),(0!==xDiff||0!==yDiff)&&(0!==yDiff||"top"!==goodAlign&&"bottom"!==goodAlign?0!==xDiff||"left"!==goodAlign&&"right"!==goodAlign||(point.y-=yDiff,yDiff=0):(point.x-=xDiff,xDiff=0)),0===xDiff&&0===yDiff)return};return findGoodPositionAndAlign(),point&&dialogElement.offset({left:point.x,top:point.y}),{position:goodAlign,x:goodX,y:goodY}}};return positioner}),define("general.utils/arrow-positioner",[],function(){"use strict";function opposite(position){var map={left:"right",right:"left",top:"bottom",bottom:"top"};return map[position]}function align(dialogElem,alignTo,pos,pointer){var left,top,position=opposite(pos),factors={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},factor=factors[position],parent_width=dialogElem.outerWidth(),parent_height=dialogElem.outerHeight(),pointer_width=pointer.outerWidth(),pointer_height=pointer.outerHeight();"left"===position||"right"===position?(left=factor.width*(parent_width-pointer_height),top=alignTo.offset().top+alignTo.outerHeight()*(1-factor.height)-dialogElem.offset().top-pointer_width*(1-factor.height)):(left=alignTo.offset().left+alignTo.outerWidth()*(1-factor.width)-dialogElem.offset().left-pointer_width*(1-factor.width),top=factor.height*(parent_height-pointer_height)),pointer.css({left:parseInt(left,10),top:parseInt(top,10)})}function alignToCoordinate(dialogElem,x,y,pos,pointer){var left,top,position=opposite(pos),factors={left:{width:0,height:.5,size:-1.5},right:{width:1,height:.5,size:.5},top:{width:.5,height:0,size:-1},bottom:{width:.5,height:1,size:1}},factor=factors[position],parent_width=dialogElem.outerWidth(),parent_height=dialogElem.outerHeight(),pointer_width=pointer.outerWidth(),pointer_height=pointer.outerHeight();"left"===position||"right"===position?(left=factor.width*(parent_width-pointer_height)+pointer_height*factor.size,top=y-dialogElem.offset().top-pointer_height*(1-factor.height)):(left=x-dialogElem.offset().left-pointer_width*(1-factor.width),top=factor.height*(parent_height-pointer_height)+pointer_height*factor.size),pointer.css({left:floor(left),top:floor(top)})}function alignToParent(dialogElement,pos,pointer){var left,top,position=opposite(pos),factors={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},factor=factors[position],parent_width=dialogElement.outerWidth(),parent_height=dialogElement.outerHeight(),pointer_width=pointer.outerWidth(),pointer_height=pointer.outerHeight();"left"===position||"right"===position?(left=factor.width*(parent_width-pointer_height),top=pointer.offset().top-pointer_width*(1-factor.height)):(left=parent_width*(1-factor.width)-pointer_width*(1-factor.width),top=factor.height*(parent_height-pointer_height)+pointer_height),pointer.css({left:left,top:top})}var floor=Math.floor;return{align:align,alignToParent:alignToParent,alignToCoordinate:alignToCoordinate}}),define("text!general.components/immidiate-contextual/immidiate-contextual.ng.html",[],function(){return"<div class='qui-immidiateContextual' qva-outside='onOutsidePopover($event)'>\r\n	<div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n	<div class='content' ng-transclude></div>\r\n</div>\r\n"}),define("text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html",[],function(){return"<div class='qui-immidiateContextual-small' qva-activate='onOutsidePopover($event)' qva-outside='onOutsidePopover($event)'>\r\n    <div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n    <div class='content' ng-transclude></div>\r\n</div>\r\n"}),/*!
 * mqa.js
 * https://github.com/peol/mqa.js/
 * MIT/GPL Dual License, use whatever fits your project.
 * Copyright(C) Andre Hansson (@peolanha) 2013
 */
function(window,document){"use strict";function toArray(arrayLike){return Array.prototype.slice.apply(arrayLike)}function createHandler(alias){return function(mql){var stack=callbacks[alias];stack&&(log("Media query triggered for alias",alias),stack.forEach(function(callback){callback(mql.matches)}))}}function bind(alias){var mql=matchMedia(queries[alias]),cb=unbindCallbacks[alias]=createHandler(alias);cb.mql=mql,log("Binding",alias),mql.addListener(cb)}function unbind(alias){var unbindCallback=unbindCallbacks[alias];unbindCallback&&(log("Unbinding",alias),unbindCallback.mql.removeListener(unbindCallback)),delete callbacks[alias],delete unbindCallbacks[alias]}function log(){if(DEBUG){var args=toArray(arguments);args.unshift("[mqa.js]"),console.log.apply(console,args)}}var DEBUG=!1,callbacks={},unbindCallbacks={},queries={},origin=location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),mqa={};mqa.add=function(alias,query){log("Creating alias",alias,"with query",query),queries[alias]=query},mqa.remove=function(alias){log("Removing alias",alias);var exist=queries.hasOwnProperty(alias);return exist&&(unbind(alias),delete queries[alias]),exist},mqa.parse=function(){log("Parsing CSS rules"),toArray(document.styleSheets).forEach(function(sheet){var isOutsideOfDomain=sheet.href&&0!==sheet.href.indexOf("/")&&0!==sheet.href.indexOf(origin);try{if(isOutsideOfDomain||null===sheet.cssRules)return}catch(e){return}toArray(sheet.cssRules).forEach(function(rule){if(rule&&rule instanceof CSSMediaRule){var alias=/#-mqa-alias-(\w+)\s*?\{/.exec(rule.cssText);alias&&mqa.add(alias[1],rule.media.mediaText)}})})},mqa.on=function(alias,callback){var stack=callbacks[alias];stack||(stack=[],bind(alias)),stack.push(callback),callbacks[alias]=stack,log("Added new listener on",alias,callback)},mqa.off=function(alias,callback){var stack=callbacks[alias];if(stack){var index=stack.indexOf(callback);stack.splice(index,1),stack.length||unbind(alias)}log("Removed listener from",alias,callback)},mqa.match=function(alias){var query=queries[alias],result=!1;return query&&(result=matchMedia(query).matches),result},Object.defineProperty(mqa,"queries",{get:function(){return JSON.parse(JSON.stringify(queries))}}),mqa.parse(),"function"==typeof define&&define.amd?define("mqa",mqa):window.mqa=mqa}(window,document),define("core.utils/notification",[],function(){"use strict";var Notification,NotificationMixin,INSTANTIATING=!1;return Notification=function(receiver,name){if(INSTANTIATING!==!0)throw new Error("This class can't be instantiated directly.");this.observers=[],this.receiver=receiver,Object.defineProperty(this,"name",{get:function(){return name}})},Notification.prototype.bind=function(observer){if("function"!=typeof observer)throw new Error("Observer must be a function.");if(observer===Notification.prototype.emit)throw new Error("Observer cannot be proxied this way. Use a wrapper function.");this.observers.push(observer)},Notification.prototype.once=function(observer){function f(){self.unbind(f),observer.apply(self.receiver,arguments)}var self=this;f.onceObserver=observer,self.bind(f)},Notification.prototype.unbind=function(observer){var index;index=this.observers.reduce(function(foundIndex,o,currIndex){return-1!==foundIndex?foundIndex:o===observer||o.onceObserver===observer?currIndex:-1},-1),-1!==index&&this.observers.splice(index,1)},Notification.prototype.emit=function(){var receiver=this.receiver,args=Array.prototype.slice.call(arguments),observers=this.observers.slice();observers.forEach(function(observer){observer.apply(receiver,args)})},Notification.prototype.release=function(){var receiver=this.receiver;delete receiver[this.name],Object.keys(NotificationMixin.prototype).forEach(function(key){delete receiver[key]}),this.receiver=null,this.observers=null},Notification.create=function(receiver,name){if(!receiver)throw new Error("Not a valid receiver.");if("string"!=typeof name)throw new Error("Nofification name not optional.");if(!/^([A-Z][a-z]+)+$/.test(name))throw new Error("The notification name must be PascalCased.");if(name in receiver)throw new Error("A property named '"+name+"' is already present on the receiver.");return INSTANTIATING=!0,receiver[name]=new Notification(receiver,name),INSTANTIATING=!1,receiver[name]},Notification.mixin=function(receiver){if(!receiver)throw new Error("Not a valid receiver.");Object.keys(NotificationMixin.prototype).forEach(function(property){if(property in receiver)throw new Error("A property named '"+property+"' is already present on the receiver.");receiver[property]=NotificationMixin.prototype[property]})},Notification.release=function(mixinedObject){Object.keys(mixinedObject).forEach(function(key){var prop=mixinedObject[key];prop instanceof Notification&&prop.release()})},NotificationMixin={prototype:{notification:function(name){return Notification.create(this,name)}}},Notification}),define("general.utils/responsive-state",["mqa","core.utils/notification"],function(mqa,Notification){"use strict";var currentIsSmallDevice,currentOrientation,ResponsiveState={};return ResponsiveState.Orientation={portrait:"portrait",landscape:"landscape"},Notification.mixin(ResponsiveState),ResponsiveState.notification("ViewChanged"),ResponsiveState.notification("OrientationChanged"),currentIsSmallDevice=mqa.match("smalldevice"),currentOrientation=mqa.match("portrait")?ResponsiveState.Orientation.portrait:ResponsiveState.Orientation.landscape,mqa.on("smalldevice",function(enabled){currentIsSmallDevice=enabled,ResponsiveState.ViewChanged.emit(currentIsSmallDevice)}),"undefined"==typeof window.orientation?mqa.on("portrait",function(enabled){currentOrientation=enabled?ResponsiveState.Orientation.portrait:ResponsiveState.Orientation.landscape,ResponsiveState.OrientationChanged.emit(currentOrientation)}):window.onorientationchange=function(){currentOrientation=ResponsiveState.Orientation.landscape,(0===window.orientation||180===window.orientation)&&(currentOrientation=ResponsiveState.Orientation.portrait),ResponsiveState.OrientationChanged.emit(currentOrientation),currentIsSmallDevice&&currentOrientation===ResponsiveState.Orientation.landscape&&window.scrollTo&&window.scrollTo(0,0)},Object.defineProperties(ResponsiveState,{isSmallDevice:{get:function(){return currentIsSmallDevice}},orientation:{get:function(){return currentOrientation}}}),document.body.scrollTop=document.documentElement.scrollTop=0,ResponsiveState}),define("general.components/immidiate-contextual/immidiate-contextual",["jquery","general.utils/window-positioner","general.utils/arrow-positioner","text!general.components/immidiate-contextual/immidiate-contextual.ng.html","text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html","assets/qvangular/qvangular-core","core.utils/resize","general.utils/dom-util","general.utils/responsive-state"],function($,windowPositioner,arrowPositioner,template,templateSmall,qvangular,resize,DOMUtil,responsiveState){qvangular.directive("immidiateContextual",function(){return{replace:!0,template:function(elm,attr){var tmp=template;return responsiveState.isSmallDevice&&attr.smallview&&(tmp=templateSmall),tmp},transclude:!0,scope:{onCloseView:"&",hidepointer:"="},restrict:"E",link:function(scope,element,attrs){var realPosition,timeoutId,alignTo=$(scope.$parent.$eval(attrs.alignTo)),offset=$(scope.$parent.$eval(attrs.offset))[0],width=scope.$parent.$eval(attrs.width),top=scope.$parent.$eval(attrs.top),height=scope.$parent.$eval(attrs.height),position=scope.$parent.$eval(attrs.position),limits=scope.$parent.$eval(attrs.limits)||null,collision=scope.$parent.$eval(attrs.collision)||"none";"undefined"!=typeof height&&element.css("height",height||"100"),"undefined"!=typeof width&&element.css("width",width||"100"),scope.onOutsidePopover=function(event){event.stopPropagation(),event.preventDefault(),scope.onCloseView({event:event})},$(document).on("keydown.immediateContextual",function(event){var isInput=DOMUtil.isInput(document.activeElement);!$(".qui-immidiateContextual").length||isInput||9!==event.which&&32!==event.which||(event.preventDefault(),scope.onCloseView({event:event}),scope.$apply(),alignTo.hasClass("qui-button")&&alignTo.hasClass("qui-active")&&alignTo.removeClass("qui-active"))}),scope.positionMap=function(position){var map={topRight:"right",top:"top",topLeft:"left",centerRight:"right",center:"right",centerLeft:"left",bottom:"bottom",bottomLeft:"left",bottomRight:"right"};return map[position]},scope.synchronAlign=function(){scope.hidepointer?scope.$parent.event&&(realPosition=windowPositioner.alignToCoordinate(element,scope.$parent.event.pageX,scope.$parent.event.pageY,attrs.position)):(offset?(realPosition=windowPositioner.alignToCoordinate(element,offset.x,offset.y,position),realPosition=scope.positionMap(realPosition)):realPosition=windowPositioner.align(element,alignTo,{position:position,collision:collision,limits:limits}),element.find("div.immidiate-contextual-arrow").addClass(realPosition),arrowPositioner.align(element,alignTo,realPosition,element.children("div.immidiate-contextual-arrow")))},scope.align=function(){"undefined"!=typeof top&&element.css({top:parseInt(top,10)}),timeoutId=qvangular.getService("$timeout")(scope.synchronAlign)},scope.$on("recalculatePointer",function(){scope.hidepointer||arrowPositioner.align(element,alignTo,realPosition,element.children("div.immidiate-contextual-arrow"))}),scope.$on("$destroy",function(){qvangular.getService("$timeout").cancel(timeoutId),resize.off("end",scope.align),$(document).off("keydown.immediateContextual")}),resize.on("end",scope.align),scope.align()}}})}),define("assets/qvangular/qui-popover-button/qui-popover-button",["assets/qvangular/qvangular-core","jquery","text!./qui-popover-button.ng.html","text!./qui-popover-button-menu.ng.html","general.services/show-service/show-service","assets/qlikui/components/qui-list/qui-list","core.utils/resize","general.components/immidiate-contextual/immidiate-contextual"],function(qvangular,$,template,menuTemplate,showService,quiList,resize){qvangular.componentDirective("qvaIncludeQuiPopoverButton",{ngModel:"=",destroyComponent:"&"});var popoverContainerComponent={template:menuTemplate,scope:{quiModel:"=",alignTo:"=",shared:"="},controller:["$scope",function($scope){$scope.quiList=quiList,$scope.shared.destroyComponent=$scope.destroyComponent,$scope.onClose=function($event){$($event.target).hasClass("qui-popover-button")&&$scope.quiModel.tid===$($event.target).attr("tid")||($scope.destroyComponent(),$scope.shared.pressed=!1)},$scope.closeFromContent=function(){$scope.destroyComponent(),$scope.shared.pressed=!1},$scope.$on("$destroy",function(){resize.off("start",$scope.onClose)}),resize.on("start",$scope.onClose)}]};qvangular.directive("quiPopoverButton",function(){return{template:template,transclude:!0,replace:!0,restrict:"E",scope:{quiModel:"="},controller:["$scope","$element",function($scope,$element){$scope.shared={},$scope.shared.pressed=!1,$scope.buttonClasses={"qui-active":$scope.shared.pressed},$scope.$watch("quiModel.buttonType",function(buttonType){buttonType&&($scope.buttonClasses[buttonType]=!0)}),$scope.$watch("shared.pressed",function(pressed){$scope.buttonClasses["qui-active"]=pressed,$scope.currentTitle=pressed&&$scope.quiModel.tooltipActive?$scope.quiModel.tooltipActive:$scope.quiModel.tooltipInactive}),$scope.onClick=function(){$scope.shared.pressed?($scope.shared.destroyComponent(),$scope.shared.pressed=!1):($scope.shared.pressed=!0,showService.show(popoverContainerComponent,{quiModel:$scope.quiModel,alignTo:$element,shared:$scope.shared}))}}]}})}),define("qvangular",["assets/qvangular/qvangular-core","assets/qvangular/qvangular-locale","assets/qvangular/qvangular-filters","assets/qvangular/qvangular-directives","assets/qvangular/qvangular-qui","assets/qvangular/qui-popover-button/qui-popover-button"],function(qvangularCore){return qvangularCore}),define("hub.files/hub-state",["core.utils/notification","general.utils/responsive-state"],function(Notification,ResponsiveState){"use strict";var currentView,currentState,duplicatingItem,HubState={},currentIsGlobalSearch=!1,currentIsDuplicating=!1,currentIsCreating=!1;return HubState.MobileView={home:"home",instream:"instream"},Notification.mixin(HubState),HubState.notification("ViewChanged"),HubState.notification("GlobalSearchChanged"),HubState.notification("DuplicatingChanged"),HubState.notification("CreatingChanged"),HubState.setGlobalSearch=function(isGlobalSearch){isGlobalSearch!==currentIsGlobalSearch&&(currentIsGlobalSearch=isGlobalSearch,HubState.GlobalSearchChanged.emit(currentIsGlobalSearch))},HubState.setIsDuplicating=function(isDuplicating,itemDuplicate){duplicatingItem=itemDuplicate,isDuplicating!==currentIsDuplicating&&(currentIsDuplicating=isDuplicating,HubState.DuplicatingChanged.emit({currentIsDuplicating:currentIsDuplicating,duplicatingItem:duplicatingItem}))},HubState.setIsCreating=function(isCreating){isCreating!==currentIsCreating&&(currentIsCreating=isCreating,HubState.CreatingChanged.emit(currentIsCreating))},HubState.setView=function(view){if(view)currentView=view,HubState.ViewChanged.emit(currentView);else if(ResponsiveState.isSmallDevice){var urlArray,lastElem,url=window.location.href;url=url.replace(/\/$/,""),urlArray=url.split("/"),"LANGUAGE"===urlArray[urlArray.length-2].toUpperCase()&&urlArray.splice(urlArray.length-2,2),lastElem=urlArray[urlArray.length-1].toUpperCase(),"HUB"===lastElem||"HOME"===lastElem||"ROUTE"===lastElem||"?"===lastElem[0]?(currentView=HubState.MobileView.home,HubState.ViewChanged.emit(currentView)):(currentView=HubState.MobileView.instream,HubState.ViewChanged.emit(currentView))}},ResponsiveState.ViewChanged.bind(function(){HubState.setView()}),Object.defineProperties(HubState,{state:{get:function(){return currentState}},view:{get:function(){return currentView}},isGlobalSearch:{get:function(){return currentIsGlobalSearch}},isDuplicating:{get:function(){return currentIsDuplicating}},duplicatingItem:{get:function(){return duplicatingItem}},isCreating:{get:function(){return currentIsCreating}}}),HubState}),/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener,this._isOnce=isOnce,this.context=listenerContext,this._signal=signal,this._priority=priority||0}function validateListener(listener,fnName){if("function"!=typeof listener)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}function Signal(){this._bindings=[],this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}SignalBinding.prototype={active:!0,params:null,execute:function(paramsArr){var handlerReturn,params;return this.active&&this._listener&&(params=this.params?this.params.concat(paramsArr):paramsArr,handlerReturn=this._listener.apply(this.context,params),this._isOnce&&this.detach()),handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},Signal.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(listener,isOnce,listenerContext,priority){var binding,prevIndex=this._indexOfListener(listener,listenerContext);if(-1!==prevIndex){if(binding=this._bindings[prevIndex],binding.isOnce()!==isOnce)throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(isOnce?"Once":"")+"() the same listener without removing the relationship first.")}else binding=new SignalBinding(this,listener,isOnce,listenerContext,priority),this._addBinding(binding);return this.memorize&&this._prevParams&&binding.execute(this._prevParams),binding},_addBinding:function(binding){var n=this._bindings.length;do--n;while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){for(var cur,n=this._bindings.length;n--;)if(cur=this._bindings[n],cur._listener===listener&&cur.context===context)return n;return-1},has:function(listener,context){return-1!==this._indexOfListener(listener,context)},add:function(listener,listenerContext,priority){return validateListener(listener,"add"),this._registerListener(listener,!1,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){return validateListener(listener,"addOnce"),this._registerListener(listener,!0,listenerContext,priority)},remove:function(listener,context){validateListener(listener,"remove");var i=this._indexOfListener(listener,context);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),listener},removeAll:function(){for(var n=this._bindings.length;n--;)this._bindings[n]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(params){if(this.active){var bindings,paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=paramsArr),n){bindings=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal,"function"==typeof define&&define.amd?define("signals",[],function(){return signals}):"undefined"!=typeof module&&module.exports?module.exports=signals:global.signals=signals}(this),/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
function(){var factory=function(signals){function arrayIndexOf(arr,val){if(arr.indexOf)return arr.indexOf(val);for(var n=arr.length;n--;)if(arr[n]===val)return n;return-1}function arrayRemove(arr,item){var i=arrayIndexOf(arr,item);-1!==i&&arr.splice(i,1)}function isKind(val,kind){return"[object "+kind+"]"===Object.prototype.toString.call(val)}function isRegExp(val){return isKind(val,"RegExp")}function isArray(val){return isKind(val,"Array")}function isFunction(val){return"function"==typeof val}function typecastValue(val){var r;return r=null===val||"null"===val?null:"true"===val?!0:"false"===val?!1:val===UNDEF||"undefined"===val?UNDEF:""===val||isNaN(val)?val:parseFloat(val)}function typecastArrayValues(values){for(var n=values.length,result=[];n--;)result[n]=typecastValue(values[n]);return result}function decodeQueryString(str,shouldTypecast){for(var item,val,queryArr=(str||"").replace("?","").split("&"),n=queryArr.length,obj={};n--;)item=queryArr[n].split("="),val=shouldTypecast?typecastValue(item[1]):item[1],obj[item[0]]="string"==typeof val?decodeURIComponent(val):val;return obj}function Crossroads(){this.bypassed=new signals.Signal,this.routed=new signals.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function Route(pattern,callback,priority,router){var isRegexPattern=isRegExp(pattern),patternLexer=router.patternLexer;this._router=router,this._pattern=pattern,this._paramsIds=isRegexPattern?null:patternLexer.getParamIds(pattern),this._optionalParamsIds=isRegexPattern?null:patternLexer.getOptionalParamsIds(pattern),this._matchRegexp=isRegexPattern?pattern:patternLexer.compilePattern(pattern,router.ignoreCase),this.matched=new signals.Signal,this.switched=new signals.Signal,callback&&this.matched.add(callback),this._priority=priority||0}var crossroads,_hasOptionalGroupBug,UNDEF;return _hasOptionalGroupBug=""===/t(.+)?/.exec("t")[1],Crossroads.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new Crossroads},addRoute:function(pattern,callback,priority){var route=new Route(pattern,callback,priority,this);return this._sortedInsert(route),route},removeRoute:function(route){arrayRemove(this._routes,route),route._destroy()},removeAllRoutes:function(){for(var n=this.getNumRoutes();n--;)this._routes[n]._destroy();this._routes.length=0},parse:function(request,defaultArgs){if(request=request||"",defaultArgs=defaultArgs||[],this.ignoreState||request!==this._prevMatchedRequest&&request!==this._prevBypassedRequest){var cur,routes=this._getMatchedRoutes(request),i=0,n=routes.length;if(n)for(this._prevMatchedRequest=request,this._notifyPrevRoutes(routes,request),this._prevRoutes=routes;n>i;)cur=routes[i],cur.route.matched.dispatch.apply(cur.route.matched,defaultArgs.concat(cur.params)),cur.isFirst=!i,this.routed.dispatch.apply(this.routed,defaultArgs.concat([request,cur])),i+=1;else this._prevBypassedRequest=request,this.bypassed.dispatch.apply(this.bypassed,defaultArgs.concat([request]));this._pipeParse(request,defaultArgs)}},_notifyPrevRoutes:function(matchedRoutes,request){for(var prev,i=0;prev=this._prevRoutes[i++];)prev.route.switched&&this._didSwitch(prev.route,matchedRoutes)&&prev.route.switched.dispatch(request)},_didSwitch:function(route,matchedRoutes){for(var matched,i=0;matched=matchedRoutes[i++];)if(matched.route===route)return!1;return!0},_pipeParse:function(request,defaultArgs){for(var route,i=0;route=this._piped[i++];)route.parse(request,defaultArgs)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(route){var routes=this._routes,n=routes.length;do--n;while(routes[n]&&route._priority<=routes[n]._priority);routes.splice(n+1,0,route)},_getMatchedRoutes:function(request){for(var route,res=[],routes=this._routes,n=routes.length;(route=routes[--n])&&((!res.length||this.greedy||route.greedy)&&route.match(request)&&res.push({route:route,params:route._getParamsArray(request)}),this.greedyEnabled||!res.length););return res},pipe:function(otherRouter){this._piped.push(otherRouter)},unpipe:function(otherRouter){arrayRemove(this._piped,otherRouter)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},crossroads=new Crossroads,crossroads.VERSION="0.12.0",crossroads.NORM_AS_ARRAY=function(req,vals){return[vals.vals_]},crossroads.NORM_AS_OBJECT=function(req,vals){return[vals]},Route.prototype={greedy:!1,rules:void 0,match:function(request){return request=request||"",this._matchRegexp.test(request)&&this._validateParams(request)},_validateParams:function(request){var key,rules=this.rules,values=this._getParamsObject(request);for(key in rules)if("normalize_"!==key&&rules.hasOwnProperty(key)&&!this._isValidParam(request,key,values))return!1;return!0},_isValidParam:function(request,prop,values){var validationRule=this.rules[prop],val=values[prop],isValid=!1,isQuery=0===prop.indexOf("?");return null==val&&this._optionalParamsIds&&-1!==arrayIndexOf(this._optionalParamsIds,prop)?isValid=!0:isRegExp(validationRule)?(isQuery&&(val=values[prop+"_"]),isValid=validationRule.test(val)):isArray(validationRule)?(isQuery&&(val=values[prop+"_"]),isValid=this._isValidArrayRule(validationRule,val)):isFunction(validationRule)&&(isValid=validationRule(val,request,values)),isValid},_isValidArrayRule:function(arr,val){if(!this._router.ignoreCase)return-1!==arrayIndexOf(arr,val);"string"==typeof val&&(val=val.toLowerCase());for(var item,compareVal,n=arr.length;n--;)if(item=arr[n],compareVal="string"==typeof item?item.toLowerCase():item,compareVal===val)return!0;return!1},_getParamsObject:function(request){for(var param,val,shouldTypecast=this._router.shouldTypecast,values=this._router.patternLexer.getParamValues(request,this._matchRegexp,shouldTypecast),o={},n=values.length;n--;)val=values[n],this._paramsIds&&(param=this._paramsIds[n],0===param.indexOf("?")&&val&&(o[param+"_"]=val,val=decodeQueryString(val,shouldTypecast),values[n]=val),_hasOptionalGroupBug&&""===val&&-1!==arrayIndexOf(this._optionalParamsIds,param)&&(val=void 0,values[n]=val),o[param]=val),o[n]=val;return o.request_=shouldTypecast?typecastValue(request):request,o.vals_=values,o},_getParamsArray:function(request){var params,norm=this.rules?this.rules.normalize_:null;return norm=norm||this._router.normalizeFn,params=norm&&isFunction(norm)?norm(request,this._getParamsObject(request)):this._getParamsObject(request).vals_},interpolate:function(replacements){var str=this._router.patternLexer.interpolate(this._pattern,replacements);if(!this._validateParams(str))throw new Error("Generated string doesn't validate against `Route.rules`.");return str},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},Crossroads.prototype.patternLexer=function(){function precompileTokens(){var key,cur;for(key in TOKENS)TOKENS.hasOwnProperty(key)&&(cur=TOKENS[key],cur.id="__CR_"+key+"__",cur.save="save"in cur?cur.save.replace("{{id}}",cur.id):cur.id,cur.rRestore=new RegExp(cur.id,"g"))}function captureVals(regex,pattern){var match,vals=[];for(regex.lastIndex=0;match=regex.exec(pattern);)vals.push(match[1]);return vals}function getParamIds(pattern){return captureVals(PARAMS_REGEXP,pattern)}function getOptionalParamsIds(pattern){return captureVals(TOKENS.OP.rgx,pattern)}function compilePattern(pattern,ignoreCase){return pattern=pattern||"",pattern&&(_slashMode===LOOSE_SLASH?pattern=pattern.replace(LOOSE_SLASHES_REGEXP,""):_slashMode===LEGACY_SLASH&&(pattern=pattern.replace(LEGACY_SLASHES_REGEXP,"")),pattern=replaceTokens(pattern,"rgx","save"),pattern=pattern.replace(ESCAPE_CHARS_REGEXP,"\\$&"),pattern=replaceTokens(pattern,"rRestore","res"),_slashMode===LOOSE_SLASH&&(pattern="\\/?"+pattern)),_slashMode!==STRICT_SLASH&&(pattern+="\\/?"),new RegExp("^"+pattern+"$",ignoreCase?"i":"")}function replaceTokens(pattern,regexpName,replaceName){var cur,key;for(key in TOKENS)TOKENS.hasOwnProperty(key)&&(cur=TOKENS[key],pattern=pattern.replace(cur[regexpName],cur[replaceName]));return pattern}function getParamValues(request,regexp,shouldTypecast){var vals=regexp.exec(request);return vals&&(vals.shift(),shouldTypecast&&(vals=typecastArrayValues(vals))),vals}function interpolate(pattern,replacements){if("string"!=typeof pattern)throw new Error("Route pattern should be a string.");var replaceFn=function(match,prop){var val;if(prop="?"===prop.substr(0,1)?prop.substr(1):prop,null!=replacements[prop]){if("object"==typeof replacements[prop]){var queryParts=[];for(var key in replacements[prop])queryParts.push(encodeURI(key+"="+replacements[prop][key]));val="?"+queryParts.join("&")}else val=String(replacements[prop]);if(-1===match.indexOf("*")&&-1!==val.indexOf("/"))throw new Error('Invalid value "'+val+'" for segment "'+match+'".')}else{if(-1!==match.indexOf("{"))throw new Error("The segment "+match+" is required.");val=""}return val};return TOKENS.OS.trail||(TOKENS.OS.trail=new RegExp("(?:"+TOKENS.OS.id+")+$")),pattern.replace(TOKENS.OS.rgx,TOKENS.OS.save).replace(PARAMS_REGEXP,replaceFn).replace(TOKENS.OS.trail,"").replace(TOKENS.OS.rRestore,"/")}var ESCAPE_CHARS_REGEXP=/[\\.+*?\^$\[\](){}\/'#]/g,LOOSE_SLASHES_REGEXP=/^\/|\/$/g,LEGACY_SLASHES_REGEXP=/\/$/g,PARAMS_REGEXP=/(?:\{|:)([^}:]+)(?:\}|:)/g,TOKENS={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},LOOSE_SLASH=1,STRICT_SLASH=2,LEGACY_SLASH=3,_slashMode=LOOSE_SLASH;return precompileTokens(),{strict:function(){_slashMode=STRICT_SLASH},loose:function(){_slashMode=LOOSE_SLASH},legacy:function(){_slashMode=LEGACY_SLASH},getParamIds:getParamIds,getOptionalParamsIds:getOptionalParamsIds,getParamValues:getParamValues,compilePattern:compilePattern,interpolate:interpolate}}(),crossroads};"function"==typeof define&&define.amd?define("crossroads",["signals"],factory):"undefined"!=typeof module&&module.exports?module.exports=factory(require("signals")):window.crossroads=factory(window.signals)}(),define("general.controllers/route-controller",["crossroads","util"],function(crossroads,util){"use strict";function recompile(){registeredRoutes.forEach(function(route){route.dispose()}),addedRoutes.forEach(function(route){RouteController.addRoute(route)})}function bind(){window.addEventListener("popstate",function(){var newApp=util.getParameterByName("app");return app&&app!==newApp?void(location.href=location.href):void RouteController.parse()},!1)}if(location.pathname.match(/hub$/i))return void(location.href=location.href+"/");location.hash&&history.replaceState(null,null,location.href.replace("#!/",""));var RouteController={},app=util.getParameterByName("app"),lang=util.getParameterByName("language"),theme=util.getParameterByName("theme"),debug=util.getParameterByName("debug"),noData=util.getParameterByName("noData"),_defaultPartialPrefix=[],_defaultPartialSuffix=[],addedRoutes=[],registeredRoutes=[];return app&&_defaultPartialPrefix.push("app",app),lang&&_defaultPartialSuffix.push("language",lang),theme&&_defaultPartialSuffix.push("theme",theme),debug&&_defaultPartialSuffix.push("debug",debug),noData&&_defaultPartialSuffix.push("noData",!0),RouteController.isSuffixInUse=function(key){for(var i=0;i<_defaultPartialSuffix.length;i++)if(_defaultPartialSuffix[i]===key)return!0;return!1},RouteController.removePartialSuffix=function(key){for(var found=!1,i=0;i<_defaultPartialSuffix.length;i++)if(_defaultPartialSuffix[i]===key){_defaultPartialSuffix.splice(i,2),found=!0;break}if(found){var url=location.href,keyValuePattern=new RegExp("/"+key+"/[^/]+","i");recompile(),keyValuePattern.test(url)&&(url=url.replace(keyValuePattern,""),RouteController.setUrl(url))}return found},RouteController.parse=function(url){crossroads.parse(url||location.pathname)},RouteController.addRoute=function(route){var self=this,pattern=route.pattern;addedRoutes.push(route),route.isPartial&&("/"===pattern&&(pattern=""),pattern=self.buildUrl("replaceme").replace(location.protocol+"//"+location.host+"/","").replace("/replaceme",pattern));var registeredRoute=crossroads.addRoute(pattern,function(){self.lastRoute&&self.lastRoute!==route&&self.lastRoute.DeRoute.emit(),self.lastRoute=route,route.Route.emit.apply(route.Route,arguments)});registeredRoutes.push(registeredRoute)},RouteController.setUrl=function(url,replaceHistory,noParse){replaceHistory=!0;var replaceURL=location.href.toLowerCase().indexOf("?x-")>-1;replaceURL&&(url=url.replace(/\?x-.+?=[^&]+/i,"").replace("&","?")),0!==url.indexOf(util.baseURI)?location.href=url:url!==location.href&&(history[replaceHistory?"replaceState":"pushState"](null,null,url),noParse||RouteController.parse())},RouteController.start=function(){this.setUrl(location.href),bind(this),RouteController.parse()},RouteController.buildUrl=function(){var url,args=Array.apply(null,arguments),headRoute="",slug="";if(args[0]===!0?(headRoute=args[1],args=args.slice(2)):args.unshift.apply(args,_defaultPartialPrefix),_defaultPartialSuffix.length&&args.push.apply(args,_defaultPartialSuffix),args=args.map(function(part){return encodeURIComponent(part).replace(/'/g,"%27")}),headRoute){var replaceRoute=new RegExp("([^/])/"+util.project+"/","i");slug=util.baseURI.replace(replaceRoute,"$1/"+headRoute+"/")}else slug=util.baseURI;return url=slug+args.join("/").replace(/[\/]+/g,"/")},RouteController}),define("general.models/route",["core.utils/notification"],function(Notification){"use strict";var Route;return Route=function(opts){this.pattern=opts.pattern,this.isPartial="undefined"==typeof opts.isPartial?!0:opts.isPartial,Notification.create(this,"Route"),Notification.create(this,"DeRoute")}}),define("assets/hub/hub-model",["core.utils/deferred","general.utils/string-normalization"],function(Deferred,StringNormalization){function localeAlphabeticSortByStreamName(list,value){return list.sort(function(a,b){var streamCompare;return!a.qMeta.stream&&b.qMeta.stream&&b.qMeta.stream.hasOwnProperty("name")?-1:!b.qMeta.stream&&a.qMeta.stream&&a.qMeta.stream.hasOwnProperty("name")?1:(streamCompare=b.qMeta.stream||a.qMeta.stream?a.qMeta.stream.name.localeCompare(b.qMeta.stream.name):0,0===streamCompare?value&&a[value]&&b[value]?(a=a[value],b=b[value],a.localeCompare(b)):value&&!a[value]&&b[value]?1:-1:streamCompare)})}function localeAlphabeticSort(list,value,reverseList){list=list?list:[];var sortedList=list.sort(function(a,b){return value&&a[value]&&b[value]?(a=a[value],b=b[value],a.localeCompare(b)):value&&!a[value]&&b[value]?1:-1});return reverseList?sortedList.reverse():sortedList}function dateSort(list,value,reverseList){var sortedList=list.sort(function(a,b){if(value){var aDate=new Date(a.qMeta[value]),bDate=new Date(b.qMeta[value]);return bDate>aDate?1:aDate>bDate?-1:0}});return reverseList?sortedList.reverse():sortedList}function getApps(getList){var dfd=new Deferred;return getList().then(function(list){dfd.resolve(localeAlphabeticSortByStreamName(list.slice(),"qTitle"))}),dfd.promise}function getStreams(getStreamsList){var dfd=new Deferred;return getStreamsList().then(function(list){dfd.resolve(localeAlphabeticSort(list.result.qStreamList,"qName"))}),dfd.promise}function filterApps(item,streamId){var ret=!1;return item.stream&&item.stream.id===streamId?ret=!0:item.published||streamId||(ret=!0),ret}function getMyWorkApps(list){return list.filter(function(item){return filterApps(item.qMeta,null)?item:void 0})}function filterSearchResults(item,search){var normalizedSearch=StringNormalization.string(search.text).toLowerCase(),normalizedTitle=StringNormalization.string(item.qTitle).toLowerCase(),normalizedDesc=item.qMeta.description?StringNormalization.string(item.qMeta.description).toLowerCase():"";return normalizedTitle.indexOf(normalizedSearch)>-1||normalizedDesc.indexOf(normalizedSearch)>-1}function rpcCall(session,method,params){return session.rpc({method:method,handle:-1,params:params||[]})}var SortFilterOptions={alphabetical:0,publishedDate:1};return{SortFilterOptions:SortFilterOptions,getApps:getApps,getStreams:getStreams,getMyWorkApps:getMyWorkApps,alphabeticSort:localeAlphabeticSort,alphabeticSortByStream:localeAlphabeticSortByStreamName,dateSort:dateSort,filterApps:filterApps,filterSearchResults:filterSearchResults,rpcCall:rpcCall}}),define("assets/hub/hub-routing-manager",[],function(){function hasStreams(list){return!!list.length}function hasMyWork(scope,model){var canCreate=scope.allowCreateApp,hasPrivateApps=0!==model.getMyWorkApps(scope.appList).length;return canCreate||hasPrivateApps}function contentToShow(o){return hasStreams(o.$hubScope.streamsList)||hasMyWork(o.$hubScope,o.hubModel)}function showMyWork(key,contentToShow){key=key||"";var isAccessWithoutRoute=!key.length,isNoRouteRoute="no-route"===key,isMyWorkRoute="my-work"===key,isHomeRoute="my-home"===key,isMyWork=!1;return(isAccessWithoutRoute||isMyWorkRoute||isHomeRoute)&&contentToShow?isMyWork=!0:isAccessWithoutRoute?isMyWork=!0:isNoRouteRoute&&(isMyWork=!0),isMyWork}function check(o){var id,streamExists,unitTestVal=null,getId=function(){return id};return o.$hubScope.showMyWorkLi=hasMyWork(o.$hubScope,o.hubModel),contentToShow(o)?o.$hubScope.showMyWorkLi&&showMyWork(o.getActive(),contentToShow(o))?(o.$hubScope.isPersonalMode||!o.isSmallDevice)&&(unitTestVal=o.changeRoute(o.RouteController.buildUrl("my","work"))):hasStreams(o.$hubScope.streamsList)&&(o.isSmallDevice||(id=o.getActive()?o.getActive():o.$hubScope.streamsList[0].qId,streamExists=o.hubFactory.checkIfStreamExist(getId,o.$hubScope.streamsList,noop),streamExists?unitTestVal=o.changeRoute(o.RouteController.buildUrl("stream",id)):o.changeRoute(o.RouteController.buildUrl("stream",o.$hubScope.streamsList[0].qId)))):unitTestVal=o.changeRoute(o.RouteController.buildUrl("no","route")),unitTestVal}var noop=function(){};return{check:check,hasMyWork:hasMyWork,hasStreams:hasStreams,contentToShow:contentToShow}}),define("core.utils/class",[],function(){"use strict";var fnTest=/xyz/.test(function(){})?/\b_super\b/:/.*/,Class=function(){};return Class.extend=function extend(className,proto){var _super=this.prototype;"string"!=typeof className&&(proto=className,className="Class");var prototype=Object.create(this.prototype);for(var name in proto)prototype[name]="function"==typeof proto[name]&&"function"==typeof _super[name]&&fnTest.test(proto[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,proto[name]):proto[name];if(!/^[_a-z][_a-z\d]*$/i.test(className))throw new Error("Invalid subclass name. Alphanumericals only.");var ctor=new Function("return (function "+className+"(){ typeof this.init === 'function' && this.init.apply(this, [].slice.call(arguments)) });")();return ctor.prototype=prototype,ctor.prototype.constructor=ctor,ctor.extend=extend,ctor},Class}),define("core.utils/json-patch",["jquery"],function($){function generateValue(val){return val&&(val=extend({},{val:val}).val),val}function isSpecialProperty(obj,key){return isFunction(obj[key])||"$$"===key.substring(0,2)||"_"===key.substring(0,1)}function getParent(data,str){var numPart,seperator="/",parts=str.substring(1).split(seperator).slice(0,-1);return parts.forEach(function(part,i){i!==parts.length&&(numPart=+part,data=data[numPart||part]=isUndef(data[numPart||part])?isNaN(numPart)?{}:[]:data[part])}),data}function emptyObject(obj){Object.keys(obj).forEach(function(key){var config=Object.getOwnPropertyDescriptor(obj,key);config.configurable&&!isSpecialProperty(obj,key)&&delete obj[key]})}function compare(a,b){var i,l,isIdentical=!0;if(isObject(a)&&isObject(b))return Object.keys(a).length!==Object.keys(b).length?!1:(Object.keys(a).forEach(function(key){return compare(a[key],b[key])?void 0:(isIdentical=!1,!1)}),isIdentical);if(isArray(a)&&isArray(b)){if(a.length!==b.length)return!1;for(i=0,l=a.length;l>i;i++)if(!compare(a[i],b[i]))return!1;return!0}return a===b}function patchArray(original,newA,basePath){function findIndex(a,id,idx){if(a[idx]&&isUndef(a[idx].qInfo))return null;if(a[idx]&&a[idx].qInfo.qId===id)return idx;for(var i=0,l=a.length;l>i;i++)if(a[i]&&a[i].qInfo.qId===id)return i;return-1}var i,l,patches=[],oldA=original.slice(),tmpIdx=-1;if(compare(newA,oldA))return patches;if(!isUndef(newA[0])&&isUndef(newA[0].qInfo))return patches.push({op:"replace",path:basePath,value:newA}),patches;for(i=oldA.length-1;i>=0;--i)tmpIdx=findIndex(newA,oldA[i].qInfo&&oldA[i].qInfo.qId,i),-1===tmpIdx?(patches.push({op:"remove",path:basePath+"/"+i}),oldA.splice(i,1)):patches=patches.concat(JSONPatch.generate(oldA[i],newA[tmpIdx],basePath+"/"+i));for(i=0,l=newA.length;l>i;++i)tmpIdx=findIndex(oldA,newA[i].qInfo&&newA[i].qInfo.qId),-1===tmpIdx?(patches.push({op:"add",path:basePath+"/"+i,value:newA[i]}),oldA.splice(i,0,newA[i])):tmpIdx!==i&&(patches.push({op:"move",path:basePath+"/"+i,from:basePath+"/"+tmpIdx}),oldA.splice(i,0,oldA.splice(tmpIdx,1)[0]));return patches}var JSONPatch={},extend=function(){return $.extend.apply($,[!0].concat(Array.prototype.slice.call(arguments)))},isObject=$.isPlainObject,isArray=Array.isArray,isUndef=function(v){return"undefined"==typeof v},isFunction=function(v){return"function"==typeof v};return JSONPatch.generate=function(original,newData,basePath){basePath=basePath||"";var patches=[];return Object.keys(newData).forEach(function(key){var val=generateValue(newData[key]),oldVal=original[key],tmpPath=basePath+"/"+key;compare(val,oldVal)||isSpecialProperty(newData,key)||(isUndef(oldVal)?patches.push({op:"add",path:tmpPath,value:val}):isObject(val)&&isObject(oldVal)?patches=patches.concat(JSONPatch.generate(oldVal,val,tmpPath)):isArray(val)&&isArray(oldVal)?patches=patches.concat(patchArray(oldVal,val,tmpPath)):patches.push({op:"replace",path:basePath+"/"+key,value:val}))}),Object.keys(original).forEach(function(key){isUndef(newData[key])&&!isSpecialProperty(original,key)&&patches.push({op:"remove",path:basePath+"/"+key})}),patches},JSONPatch.apply=function(original,patches){patches.forEach(function(patch){var parent=getParent(original,patch.path),key=patch.path.split("/").splice(-1)[0],target=key&&isNaN(+key)?parent[key]:parent[+key]||parent,from=patch.from?patch.from.split("/").splice(-1)[0]:null;if("add"===patch.op||"replace"===patch.op)if(isArray(parent))"-"===key&&(key=parent.length),parent.splice(+key,"add"===patch.op?0:1,patch.value);else if(isArray(target)&&isArray(patch.value)){var newValues=patch.value.slice();target.length=0,target.push.apply(target,newValues)}else isObject(target)&&isObject(patch.value)?(emptyObject(target),extend(target,patch.value)):parent[key]=patch.value;else if("move"===patch.op){var oldParent=getParent(original,patch.from);isArray(parent)?parent.splice(+key,0,oldParent.splice(+from,1)[0]):(parent[key]=oldParent[from],delete oldParent[from])}else"remove"===patch.op&&(isArray(parent)?parent.splice(+key,1):delete parent[key])})},JSONPatch.clone=function(obj){return extend({},obj)},JSONPatch.createPatch=function(op,val,path){var patch={op:op.toLowerCase(),path:path};return"move"===patch.op?patch.from=val:"undefined"!=typeof val&&(patch.value=val),patch},JSONPatch.updateObject=function(original,newData){return Object.keys(original).length?void JSONPatch.apply(original,JSONPatch.generate(original,newData)):void extend(original,newData)},JSONPatch}),define("core.utils/debug-flags",["util"],function(util){var isBrowser="undefined"!=typeof window&&"undefined"!=typeof document,urlFlags=(isBrowser&&util.getParameterByName("debug")||"").split("+"),DebugFlags={};return urlFlags.forEach(function(flag){DebugFlags[flag.toUpperCase()]=!0}),DebugFlags}),define("core.utils/permissions",[],function(){function parse(privileges,mapToObj){return privileges.length||(privileges=["update","publish","export","exportdata","changeowner","delete"]),forceReadOnly&&(privileges=[]),mapToObj=mapToObj||{},mapToObj.update=-1!==privileges.indexOf("update"),mapToObj.publish=-1!==privileges.indexOf("publish"),mapToObj["export"]=-1!==privileges.indexOf("export"),mapToObj.exportData=-1!==privileges.indexOf("exportdata"),mapToObj.changeOwner=-1!==privileges.indexOf("changeowner"),mapToObj.remove=-1!==privileges.indexOf("delete"),mapToObj}function parseCreate(creatables,mapToObj){mapToObj=mapToObj||{};for(var key in mapToObj)delete mapToObj[key];return forceReadOnly?mapToObj:(creatables.forEach(function(creatable){creatable.canCreate&&(mapToObj["create"+creatable.resource[0].toUpperCase()+creatable.resource.substring(1)]=!0)}),mapToObj)}function mapToLayout(layout,isApp){var permissions={};return layout.permissions||Object.defineProperty(layout,"permissions",{configurable:!1,enumerable:!1,get:function(){return layout&&(isApp&&(forceReadOnly=layout.qReadOnly,parseCreate(layout.create||CREATABLE_RESOURCES,permissions)),parse(layout.privileges||layout.qMeta&&layout.qMeta.privileges||[],permissions)),permissions}}),layout}var CREATABLE_RESOURCES=[{resource:"sheet",canCreate:!0},{resource:"bookmark",canCreate:!0},{resource:"story",canCreate:!0},{resource:"dimension",canCreate:!0},{resource:"measure",canCreate:!0},{resource:"masterobject",canCreate:!0}],forceReadOnly=!0;return{mapToLayout:mapToLayout,parse:parse,parseCreate:parseCreate}}),define("core.utils/model-garbage-collector",["core.utils/notification","core.utils/debug-flags"],function(Notification,DebugFlags){function _canBeReleased(model){return model.Invalidated&&model.Invalidated.observers&&0===model.Invalidated.observers.length}function _tryToRelease(){for(var model,i=_queue.length;i--;)model=_queue[i],DebugFlags.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Checking model (id, handle, model):",model.id,model.handle,model),_canBeReleased(model)&&(_releaseModel(model),_queue.splice(i,1))}function _releaseModel(model){DebugFlags.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Releasing model (id):",model.id),Notification.release(model);for(var key in model)delete model[key]}function addToQueue(model){_queue.push(model)}var _queue=[];return setInterval(_tryToRelease,1e4),{addToQueue:addToQueue}}),define("autogenerated/qix/engine-enums",[],function(){"use strict";return{NxLocalizedErrorCode:{LOCERR_INTERNAL_ERROR:-128,LOCERR_GENERIC_UNKNOWN:-1,LOCERR_GENERIC_OK:0,LOCERR_GENERIC_NOT_SET:1,LOCERR_GENERIC_NOT_FOUND:2,LOCERR_GENERIC_ALREADY_EXISTS:3,LOCERR_GENERIC_INVALID_PATH:4,LOCERR_GENERIC_ACCESS_DENIED:5,LOCERR_GENERIC_OUT_OF_MEMORY:6,LOCERR_GENERIC_NOT_INITIALIZED:7,LOCERR_GENERIC_INVALID_PARAMETERS:8,LOCERR_GENERIC_EMPTY_PARAMETERS:9,LOCERR_GENERIC_INTERNAL_ERROR:10,LOCERR_GENERIC_CORRUPT_DATA:11,LOCERR_GENERIC_MEMORY_INCONSISTENCY:12,LOCERR_GENERIC_INVISIBLE_OWNER_ABORT:13,LOCERR_GENERIC_PROHIBIT_VALIDATE:14,LOCERR_GENERIC_ABORTED:15,LOCERR_GENERIC_CONNECTION_LOST:16,LOCERR_GENERIC_UNSUPPORTED_IN_PRODUCT_VERSION:17,LOCERR_GENERIC_REST_CONNECTION_FAILURE:18,LOCERR_HTTP_400:400,LOCERR_HTTP_401:401,LOCERR_HTTP_402:402,LOCERR_HTTP_403:403,LOCERR_HTTP_404:404,LOCERR_HTTP_405:405,LOCERR_HTTP_406:406,LOCERR_HTTP_407:407,LOCERR_HTTP_408:408,LOCERR_HTTP_409:409,LOCERR_HTTP_410:410,LOCERR_HTTP_411:411,LOCERR_HTTP_412:412,LOCERR_HTTP_413:413,LOCERR_HTTP_414:414,LOCERR_HTTP_415:415,LOCERR_HTTP_416:416,LOCERR_HTTP_417:417,LOCERR_HTTP_500:500,LOCERR_HTTP_501:501,LOCERR_HTTP_502:502,LOCERR_HTTP_503:503,LOCERR_HTTP_504:504,LOCERR_HTTP_505:505,LOCERR_HTTP_509:509,LOCERR_APP_ALREADY_EXISTS:1e3,LOCERR_APP_INVALID_NAME:1001,LOCERR_APP_ALREADY_OPEN:1002,LOCERR_APP_NOT_FOUND:1003,LOCERR_APP_IMPORT_FAILED:1004,LOCERR_APP_SAVE_FAILED:1005,LOCERR_APP_CREATE_FAILED:1006,LOCERR_APP_INVALID:1007,LOCERR_APP_CONNECT_FAILED:1008,LOCERR_APP_ALREADY_OPEN_IN_DIFFERENT_MODE:1009,LOCERR_APP_MIGRATION_COULD_NOT_CONTACT_MIGRATION_SERVICE:1010,LOCERR_APP_MIGRATION_COULD_NOT_START_MIGRATION:1011,LOCERR_APP_MIGRATION_FAILURE:1012,LOCERR_CONNECTION_ALREADY_EXISTS:2e3,LOCERR_CONNECTION_NOT_FOUND:2001,LOCERR_CONNECTION_FAILED_TO_LOAD:2002,LOCERR_CONNECTION_FAILED_TO_IMPORT:2003,LOCERR_CONNECTION_NAME_IS_INVALID:2004,LOCERR_FILE_ACCESS_DENIED:3e3,LOCERR_FILE_NAME_INVALID:3001,LOCERR_FILE_CORRUPT:3002,LOCERR_FILE_NOT_FOUND:3003,LOCERR_FILE_FORMAT_UNSUPPORTED:3004,LOCERR_FILE_OPENED_IN_UNSUPPORTED_MODE:3005,LOCERR_USER_ACCESS_DENIED:4e3,LOCERR_USER_IMPERSONATION_FAILED:4001,LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS:5e3,LOCERR_SERVER_OUT_OF_SESSION_CALS:5001,LOCERR_SERVER_OUT_OF_USAGE_CALS:5002,LOCERR_SERVER_OUT_OF_CALS:5003,LOCERR_SERVER_OUT_OF_NAMED_CALS:5004,LOCERR_SERVER_OFF_DUTY:5005,LOCERR_SERVER_BUSY:5006,LOCERR_SERVER_LICENSE_EXPIRED:5007,LOCERR_SERVER_AJAX_DISABLED:5008,LOCERR_HC_INVALID_OBJECT:6e3,LOCERR_HC_RESULT_TOO_LARGE:6001,LOCERR_HC_INVALID_OBJECT_STATE:6002,LOCERR_HC_MODAL_OBJECT_ERROR:6003,LOCERR_CALC_INVALID_DEF:7e3,LOCERR_CALC_NOT_IN_LIB:7001,LOCERR_CALC_HEAP_ERROR:7002,LOCERR_CALC_TOO_LARGE:7003,LOCERR_CALC_TIMEOUT:7004,LOCERR_CALC_EVAL_CONDITION_FAILED:7005,LOCERR_CALC_MIXED_LINKED_AGGREGATION:7006,LOCERR_CALC_MISSING_LINKED:7007,LOCERR_CALC_INVALID_COL_SORT:7008,LOCERR_CALC_PAGES_TOO_LARGE:7009,LOCERR_CALC_SEMANTIC_FIELD_NOT_ALLOWED:7010,LOCERR_CALC_VALIDATION_STATE_INVALID:7011,LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS:7012,LOCERR_CALC_MISSING_LINKED_FIELD:7013,LOCERR_LAYOUT_EXTENDS_INVALID_ID:8e3,LOCERR_LAYOUT_LINKED_OBJECT_NOT_FOUND:8001,LOCERR_LAYOUT_LINKED_OBJECT_INVALID:8002,LOCERR_PERSISTENCE_WRITE_FAILED:9e3,LOCERR_PERSISTENCE_READ_FAILED:9001,LOCERR_PERSISTENCE_DELETE_FAILED:9002,LOCERR_PERSISTENCE_NOT_FOUND:9003,LOCERR_PERSISTENCE_UNSUPPORTED_VERSION:9004,LOCERR_PERSISTENCE_MIGRATION_FAILED_READ_ONLY:9005,LOCERR_PERSISTENCE_MIGRATION_CANCELLED:9006,LOCERR_PERSISTENCE_MIGRATION_BACKUP_FAILED:9007,LOCERR_PERSISTENCE_DISK_FULL:9008,LOCERR_PERSISTENCE_NOT_SUPPORTED_FOR_SESSION_APP:9009,LOCERR_PERSISTENCE_SYNC_SET_CHUNK_INVALID_PARAMETERS:9510,LOCERR_PERSISTENCE_SYNC_GET_CHUNK_INVALID_PARAMETERS:9511,LOCERR_SCRIPT_DATASOURCE_ACCESS_DENIED:1e4,LOCERR_RELOAD_IN_PROGRESS:11e3,LOCERR_PERSONAL_NEW_VERSION_AVAILABLE:12e3,LOCERR_PERSONAL_VERSION_EXPIRED:12001,LOCERR_PERSONAL_SECTION_ACCESS_DETECTED:12002,LOCERR_PERSONAL_APP_DELETION_FAILED:12003,LOCERR_EXPORT_OUT_OF_MEMORY:13e3,LOCERR_EXPORT_NO_DATA:13001,LOCERR_SYNC_INVALID_OFFSET:14e3,LOCERR_SEARCH_TIMEOUT:15e3,LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL:16e3,LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW:16001,LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT:16002,LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED:16003,LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED:16004,LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED:16005,LOCERR_DIRECT_DISCOVERY_NOT_SYNTH_CIRCULAR_ALLOWED:16006,LOCERR_DIRECT_DISCOVERY_ONLY_ONE_DD_TABLE_ALLOWED:16007,LOCERR_SMART_LOAD_TABLE_NOT_FOUND:17e3,LOCERR_SMART_LOAD_TABLE_DUPLICATED:17001,LOCERR_VARIABLE_NO_NAME:18e3,LOCERR_VARIABLE_DUPLICATE_NAME:18001,LOCERR_VARIABLE_INCONSISTENCY:18002,LOCERR_MEDIA_LIBRARY_CONTENT_FAILED:19e3,LOCERR_MEDIA_LIBRARY_LIST_FAILED:19001,LOCERR_MEDIA_BUNDLING_FAILED:19002,LOCERR_MEDIA_UNBUNDLING_FAILED:19003,LOCERR_MEDIA_LIBRARY_NOT_FOUND:19004,LOCERR_JSON_RPC_INVALID_REQUEST:-32600,LOCERR_JSON_RPC_METHOD_NOT_FOUND:-32601,LOCERR_JSON_RPC_INVALID_PARAMETERS:-32602,LOCERR_JSON_RPC_INTERNAL_ERROR:-32603,LOCERR_JSON_RPC_PARSE_ERROR:-32700},NxLocalizedWarningCode:{LOCWARN_PERSONAL_RELOAD_REQUIRED:0,LOCWARN_PERSONAL_VERSION_EXPIRES_SOON:1,LOCWARN_EXPORT_DATA_TRUNCATED:1e3,LOCWARN_COULD_NOT_OPEN_ALL_OBJECTS:2e3},NxLocalizedMessageCode:{LOCMSG_SCRIPTEDITOR_EMPTY_MESSAGE:0,LOCMSG_SCRIPTEDITOR_PROGRESS_SAVING_STARTED:1,LOCMSG_SCRIPTEDITOR_PROGRESS_BYTES_LEFT:2,LOCMSG_SCRIPTEDITOR_PROGRESS_STORING_TABLES:3,
LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWS_SO_FAR:4,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTED:5,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTING_TO:6,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECT_FAILED:7,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWISH:8,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_COLUMNAR:9,LOCMSG_SCRIPTEDITOR_ERROR:10,LOCMSG_SCRIPTEDITOR_DONE:11,LOCMSG_SCRIPTEDITOR_LOAD_EXTERNAL_DATA:12,LOCMSG_SCRIPTEDITOR_PROGRESS_OLD_QVD_ISLOADING:13,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_LOADING:14,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_BUFFERED:15,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_PREPARING:16,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_APPENDING:17,LOCMSG_SCRIPTEDITOR_REMOVE_SYNTHETIC:18,LOCMSG_SCRIPTEDITOR_PENDING_LINKEDTABLE_FETCHING:19,LOCMSG_SCRIPTEDITOR_RELOAD:20,LOCMSG_SCRIPTEDITOR_LINES_FETCHED:21}}}),define("core.utils/authentication",["jquery"],function($){"use strict";var userId,userDirectory,logoutUri,loginUri,Authentication={},mustAuthenticate=!1,onDataReceived=$.Deferred();return Authentication.parse=function(data){userId=data.userId,userDirectory=data.userDirectory,mustAuthenticate=data.mustAuthenticate,loginUri=data.loginUri,logoutUri=data.logoutUri,mustAuthenticate===!0&&data.loginUri&&(window.location.href=data.loginUri),onDataReceived.resolve(this)},Authentication.onDataReceived=onDataReceived.promise(),Object.defineProperties(Authentication,{userId:{get:function(){return userId}},userDirectory:{get:function(){return userDirectory}},mustAuthenticate:{get:function(){return mustAuthenticate}},loginUri:{get:function(){return loginUri}},logoutUri:{get:function(){return logoutUri}}}),Authentication}),define("core.models/rpc-base",["core.utils/deferred","core.utils/notification","core.utils/class","core.utils/json-patch","core.utils/debug-flags","core.utils/permissions","core.utils/model-garbage-collector","autogenerated/qix/engine-enums","core.utils/authentication"],function(Deferred,Notification,Class,JSONPatch,DebugFlags,Permissions,ModelGarbageCollector,enums,authentication){"use strict";function patch(model,data){Array.isArray(data)?JSONPatch.apply(model,data):JSONPatch.updateObject(model,data)}var userId,userDirectory,errors=enums.NxLocalizedErrorCode,cacheableMethods=["GetLayout","GetAppLayout","AbortModal","DoSave"];authentication.onDataReceived.then(function(data){"NONE"!==data.userDirectory&&(userId=data.userId,userDirectory=data.userDirectory)});var RPCBase=Class.extend("RPCBase",{init:function(input){var that=this;Notification.mixin(that),that.notification("Validated"),that.notification("Invalidated"),that.notification("Aborted"),that.notification("Validating"),that.notification("Closed"),that.notification("Closing"),that.notification("Cancelled"),that.id=input.id,that.session=input.session,that.handle=input.handle,that.layout={},that._properties={},that.properties={},that.propertyTree={},that.ongoingRequests={},that.needCacheProperties=!0,that._effectiveProperties={},that.effectiveProperties={},that.needCacheEffectiveProperties=!0,that.setState(RPCBase.States.INVALID),Permissions.mapToLayout(that.layout,input.checkCreate),"App"!==that.constructor.name&&that.bindToRPC()},bindToRPC:function(){var that=this;that.session.onChange(that.handle,that.changeHandler.bind(that)),that.Aborted.bind(that.clearPending.bind(that)),that.Cancelled.bind(that.clearPending.bind(that))},changeHandler:function(){var that=this;that.clearPending(),that.needCacheProperties=!0,that.needCacheEffectiveProperties=!0,that.isCancelled||that.setState(RPCBase.States.INVALID)},clearPending:function(){for(var key in this.ongoingRequests)delete this.ongoingRequests[key]},publish:function(){return this.layout.permissions.publish?this.rpc("Publish"):Deferred.reject("permission denied")},unpublish:function(){var that=this,deferred=Deferred();return that.getLayout().then(function(layout){return!layout.qMeta.published||layout.qMeta.approved||layout.qMeta.owner.userId!==userId||layout.qMeta.owner.userDirectory!==userDirectory?deferred.reject("permission denied"):void that.rpc("UnPublish").then(function(data){deferred.resolve(data)})}),deferred.promise},setState:function(state){var that=this,oldState=that.state;delete this.__layoutRPCId,that.state=state,oldState!==that.state&&(state===RPCBase.States.INVALID?that.Invalidated.emit():state===RPCBase.States.VALID?that.Validated.emit():state===RPCBase.States.ABORTED?that.Aborted.emit():state===RPCBase.States.VALIDATING?that.Validating.emit():state===RPCBase.States.CLOSED?that.Closed.emit():state===RPCBase.States.CLOSING?that.Closing.emit():state===RPCBase.States.CANCELLED&&that.Cancelled.emit())},getLayout:function(method,responseProperty){function onLayout(data){return DebugFlags.DELTA&&delta&&window.console.info("[DBGFLG:DELTA] APPLY ["+that.constructor.name+"]:",data),patch(that.layout,data),that.setState(RPCBase.States.VALID),that.layout}function onFail(err){return err.error.code!==errors.LOCERR_GENERIC_ABORTED||that.isCancelled||(that.setState(RPCBase.States.ABORTED),err.isHandled=!0),Deferred.reject(err)}var that=this,delta=!0;if(that.isValid||that.isCancelled)return Deferred.resolve(that.layout);if(method=method||"GetLayout",responseProperty=responseProperty||"qLayout",that.isValidating||that.setState(RPCBase.States.VALIDATING),that.ongoingRequests[method+delta])return that.ongoingRequests[method+delta];var req=that.rpc(method,responseProperty,[],{delta:delta}),promise=req.then(onLayout,onFail);return that.__layoutRPCId=req.rpcId,that.ongoingRequests[method+delta]=promise,promise},getProperties:function(method){var that=this,delta=!1;if(method=method||"GetProperties",that.isValid&&!that.needCacheProperties)return Deferred.resolve(that.properties);if(that.ongoingRequests[method+delta])return that.ongoingRequests[method+delta];var promise=that.rpc(method,"qProp",[],{delta:delta}).then(function(data){var patches=JSONPatch.generate(that._properties,data);return that._properties=data,JSONPatch.apply(that.properties,patches),that.isValid&&(that.needCacheProperties=!1),that.properties});return that.ongoingRequests[method+delta]=promise,promise},getEffectiveProperties:function(){var that=this,delta=!1,method="GetEffectiveProperties";if(that.isValid&&!that.needCacheEffectiveProperties)return Deferred.resolve(that.effectiveProperties);if(that.ongoingRequests[method+delta])return that.ongoingRequests[method+delta];var promise=that.rpc(method,"qProp",[],{delta:delta}).then(function(data){var patches=JSONPatch.generate(that._effectiveProperties,data);return that._effectiveProperties=data,JSONPatch.apply(that.effectiveProperties,patches),that.isValid&&(that.needCacheEffectiveProperties=!1),that.effectiveProperties});return that.ongoingRequests[method+delta]=promise,promise},hasChanges:function(){var patches=JSONPatch.generate(this._properties,this.properties);return patches.length>0},markAsInvalid:function(){this.state=-99,this.setState(RPCBase.States.INVALID)},markAsCancelled:function(){this.setState(RPCBase.States.CANCELLED)},getFullPropertyTree:function(method){var that=this,delta=!1;return method=method||"GetFullPropertyTree",that.rpc(method,"qPropEntry",[],delta).then(function(data){return that._propertyTree=data,patch(that.propertyTree,data),that.propertyTree})},setProperties:function(props,method,delta){var that=this;return method=method||"SetProperties",Array.isArray(props)||(props=[props]),this.rpc(method,null,props,delta).then(function(){JSONPatch.updateObject(that._properties,that.properties)})},setFullPropertyTree:function(props,method,delta){return method=method||"SetFullPropertyTree",Array.isArray(props)||(props=[props]),this.rpc(method,null,props,delta)},save:function(){return this.hasChanges()?this.setProperties(this.properties):Deferred.resolve()},saveTree:function(){return this.setFullPropertyTree(this.propertyTree)},getChildInfos:function(){return this.rpc("GetChildInfos","qInfos",[])},close:function(byServer){var that=this;that.setState(RPCBase.States.CLOSING);var dfd=byServer||"App"===that.constructor.name?Deferred.resolve():that.rpc("Close","qReturn",[]);delete that.session.changeHandlers[that.handle],delete that.session.modelCache[that.id];for(var key in that.ongoingRequests)that.ongoingRequests[key].then&&that.ongoingRequests[key].then(null,function(err){err.isHandled=!0});return dfd.then(function(){that.setState(RPCBase.States.CLOSED),ModelGarbageCollector.addToQueue(that)})},rpc:function(method,responseProperty,params,options){options=options||{delta:!1,raw:!1};var that=this,args=[].slice.call(arguments);if(!that.handle&&"App"===that.constructor.name)return that.waitForOpen.promise.then(function(){return that.rpc.apply(that,args)});var transport={method:method,handle:this.handle,params:params||[]};if(options.delta&&(transport.delta=!0),!that.session||that.isClosing||that.isClosed)return Deferred.reject();var request=that.session.rpc(transport).then(function(data){return responseProperty?data.result[responseProperty]:options.raw?data:data.result},function(err){return err.error.code===errors.LOCERR_HC_MODAL_OBJECT_ERROR?(err.isHandled=!0,that.session.currentApp.abortModal().then(function(){return that.rpc.apply(that,args)})):Deferred.reject(err)});return cacheableMethods.indexOf(method)>-1&&(that.ongoingRequests[method+options.delta]=request,request["finally"](function(){delete that.ongoingRequests[method+options.delta]})),request.rpcId=transport.id,request}});return RPCBase.getModel=function(id,session,getHandle){function failed(data){return delete session.modelCache[id],Deferred.reject({error:{code:data&&data.error&&data.error.code,message:"No object with Id "+id+" found",parameter:id}})}var instance=session.modelCache[id],Model=this;return id?instance?instance:(instance=getHandle().then(function(result){var model=null!==result.qHandle?new Model({id:id,session:session,handle:result.qHandle}):null;return model?model:failed({error:{code:errors.LOCERR_GENERIC_NOT_FOUND}})},failed),session.modelCache[id]=instance,instance):Deferred.reject("No ID given to RPCBase#getModel")},RPCBase.getLayout=function(id,app){return this.get(id,app).then(function(model){return model.getLayout().then(function(layout){return layout})})},RPCBase.getProperties=function(id,app){return this.get(id,app).then(function(model){return model.getProperties().then(function(){return model})})},RPCBase.extend=function(name,proto){var ctor=Class.extend.call(this,name,proto);return ctor.bindLayout=RPCBase.bindLayout,ctor.getLayout=RPCBase.getLayout,ctor.getProperties=RPCBase.getProperties,ctor.getModel=RPCBase.getModel,ctor},Object.defineProperties(RPCBase.prototype,{isValid:{get:function(){return this.state===RPCBase.States.VALID}},isValidating:{get:function(){return this.state===RPCBase.States.VALIDATING}},isInvalid:{get:function(){return this.state===RPCBase.States.INVALID}},isAborted:{get:function(){return this.state===RPCBase.States.ABORTED}},isClosed:{get:function(){return this.state===RPCBase.States.CLOSED}},isClosing:{get:function(){return this.state===RPCBase.States.CLOSING}},isCancelled:{get:function(){return this.state===RPCBase.States.CANCELLED}}}),RPCBase.States={VALID:1,INVALID:2,VALIDATING:3,ABORTED:4,CLOSED:5,CLOSING:6,CANCELLED:7},RPCBase.bindLayout=function($scope,watchString,callback,modelChangedCallback){function unbind(){var model=$scope.$eval(watchString);model&&model.Invalidated&&model.Invalidated.unbind(validateFunc)}watchString=watchString||"model";var validateFunc,unWatchFn,destroyFn,validate=function(){var model=this,req=this.getLayout();$scope.__layoutRPCId=req.rpcId,req.then(function(layout){var currentModel=$scope.$eval(watchString);currentModel===model&&callback&&callback(layout)})};return destroyFn=$scope.$on("$destroy",function(){unbind()}),unWatchFn=$scope.$watch(watchString,function(model,oldModel){oldModel&&oldModel!==model&&oldModel.Invalidated&&oldModel.Invalidated.unbind(validateFunc),!model||model.isClosing&&model.isClosed||(modelChangedCallback&&modelChangedCallback(model),model.getLayout().then(callback),validateFunc=validate.bind(model),model.Invalidated.bind(validateFunc))}),function(){unbind(),unWatchFn(),destroyFn(),callback&&(callback=null),modelChangedCallback&&(modelChangedCallback=null)}},RPCBase}),define("core.utils/websocket",[],function(){if("undefined"!=typeof window&&"undefined"!=typeof document)return window.angular&&window.angular.mock?function(){}:window.WebSocket;var ws=require("ws");return ws}),define("assets/core/models/rpc-session",["core.utils/websocket","core.utils/notification","core.utils/deferred"],function(WebSocket,Notification,Deferred){"use strict";function RPCSession(options){var that=this;Notification.mixin(that),that.notification("Open"),that.notification("Close"),that.notification("Send"),that.notification("Data"),that.notification("Error"),that.notification("ClosedHandles"),that.notification("ChangedHandles"),that.notification("Notification"),that.notification("Warning"),that.changeHandlers=[],that.cacheName=options.cacheName,that.queue=[],that.dfdCache={},that.reqCache={},that.modelCache={},that.options=options}var __expando=1;return RPCSession.prototype={open:function(){var that=this;that.socket=that.socket||RPCSession.createSocket(RPCSession.buildUrl(that.options)),that.socket.onopen=that.onOpen.bind(that),that.socket.onclose=that.onClose.bind(that),that.socket.onerror=that.onError.bind(that),that.socket.onmessage=that.onData.bind(that)},onOpen:function(){var that=this;setTimeout(function(){that.queue.forEach(function(data){that.send(data)}),that.queue.length=0,that.Open.emit()},100)},onError:function(err){var that=this;Object.keys(that.dfdCache).forEach(function(dfdKey){err.error={err:err,isHandled:!0},that.dfdCache[dfdKey].reject(err)}),that.Error.emit(err)},_cleanup:function(){var that=this;if(that.Close){that.Close.emit();for(var id in that.modelCache)that.modelCache[id].then(function(model){"App"!==model.constructor.name&&model.close(!0)});Notification.release(that)}},onClose:function(){var that=this;that._isClosed||(that.queue.length=0,delete RPCSession.__cache[that.cacheName],RPCSession.useTimeoutOnClose?setTimeout(that._cleanup.bind(that),1e3):that._cleanup(),that._isClosed=!0)},onData:function(event){var session=this,data=JSON.parse(event.data),dfd=session.dfdCache[data.id];data.change&&session.handleChanged(data),data.close&&session.handleClosed(data),RPCSession.debounceApply(function(){data.handle&&!session.changeHandlers[data.handle]&&dfd?dfd.reject("No model mapped to handle"):data.result?(session.Data.emit(data),data.warnings&&session.Warning.emit(data),dfd&&dfd.resolve(data)):data.params?(session.Notification.emit(data),dfd&&dfd.resolve(data)):data.suspend?(session.rpc({method:"Resume",params:[],handle:data.suspend[0]}),dfd&&dfd.resolve(data)):data.error&&(dfd&&dfd.reject(data),session.Error.emit(data)),delete session.dfdCache[data.id],delete session.reqCache[data.id]})},handleChanged:function(data){var session=this;data.change.forEach(function(handle){var handlers=session.changeHandlers[handle];handlers&&handlers.forEach(function(handler){handler()})}),session.ChangedHandles.emit(data.change)},handleClosed:function(data){var session=this;Object.keys(session.modelCache).forEach(function(id){session.modelCache[id].then(function(model){data.close.indexOf(model.handle)>-1&&model.close(!0)})}),session.ClosedHandles.emit(data.close)},send:function(data){var that=this,stringified=data;return"string"!=typeof data&&(stringified=JSON.stringify(data)),that.socket&&1===that.socket.readyState?(that.Send.emit(data),void that.socket.send(stringified)):void that.queue.push(data)},close:function(){var that=this;that.socket&&(that.socket.close(),delete that.socket)},rpc:function(data,dfd){return dfd||(dfd=new Deferred),RPCSession.hookIntoDeferred(dfd),"undefined"==typeof data.id&&(data.id=__expando++),data.jsonrpc="2.0",this.send(data),this.dfdCache[data.id]=dfd,this.reqCache[data.id]=data,dfd.id=data.id,dfd.promise},onChange:function(handle,handlerFn){this.changeHandlers[handle]||(this.changeHandlers[handle]=[]),this.changeHandlers[handle].push(handlerFn)},getRequest:function(reqId){return this.reqCache[reqId]||null}},RPCSession.__cache={},Notification.create(RPCSession,"NewSessionCreated"),RPCSession.createSocket=function(url){return new WebSocket(url)},RPCSession.createInput=function(appName,opts){return opts=opts||{},opts.appName=appName,opts.cacheName=RPCSession.buildUrl(opts),opts},RPCSession.debounceApply=function(fn){fn()},RPCSession.get=function(appName,opts){var input=RPCSession.createInput(appName,opts),session=RPCSession.getIfCached(appName,opts);return session||(session=RPCSession.__cache[input.cacheName]=new RPCSession(input),RPCSession.NewSessionCreated.emit(session)),session},RPCSession.getIfCached=function(appName,opts){var input=RPCSession.createInput(appName,opts);return RPCSession.__cache[input.cacheName]},RPCSession.buildUrl=function(options){var connection="",host=options.host,port="string"==typeof options.port?options.port:options.isSecure?443:4848;return connection+=options.isSecure?"wss":"ws",connection+="://",connection+=host||"localhost",options.port&&(connection+=":",connection+=port),connection+=options.prefix||"/",options.subpath&&(connection+=options.subpath+"/"),connection+=options.route?options.route:"app/"+encodeURIComponent(options.appName),options.identity&&(connection+="/identity/"+encodeURIComponent(options.identity)),connection+="?reloadUri="+(options.reloadURI||"")},RPCSession.hookIntoDeferred=function(){},RPCSession}),define("general.enums/qrs-enums",[],function(){"use strict";return{NxLocalizedErrorCode:{LOCERR_JSON_RPC_ENTITY_NOT_FOUND:-32001,LOCERR_JSON_RPC_ACCESS_DENIED:-32002,LOCERR_JSON_RPC_APP_DUPLICATION_FAILED:-32003}}}),define("core.utils/external-urls",["translator"],function(translator){var ExternalUrls={serverHelpBaseUrl:"http://help.qlik.com/sense/2.1/",personalHelpBaseUrl:"http://help.qlik.com/sense/2.1/",cloudBaseUrl:"https://qlikcloud.com/",cloudUploadUrl:"https://qlikcloud.com/upload?",personalUpgradeBase:"qlik.com/QlikSenseDesktopUpgrade",personalUpgradeUrl:"http://qlik.com/QlikSenseDesktopUpgrade"};return Object.defineProperty(ExternalUrls,"gettingStarted",{get:function(){return"http://www.qlik.com/"+translator.language+"-sense-gettingstarted"}}),ExternalUrls}),define("text!client.controllers/expire-dialog.ng.html",[],function(){return"<div>\r\n	<p class='dm-pb' ng-class=\"{'dm-pt': noTitle}\" q-translation=\"{{content}}\"></p>\r\n	<p><upgrade-msg/></p>\r\n</div>"}),define("text!general.services/delayed-modal/delayed-modal.ng.html",[],function(){return'<div class="qui-delayedModal" on-close-view="closeView( $event )" qv-escape="handleEscButton( $event )" ng-style="modalStyle" tid="errorDialog">\r\n	<header class="dm-header" ng-if="title" q-translation="{{title}}"></header>\r\n	<main ng-if="!html" class="dm-main"> <p class="dm-p">{{content | translate}}</p></main>\r\n	<main ng-if="html" class="dm-main qv-appname"></main>\r\n	<footer class="dm-footer">\r\n		<qui-button qv-delayed-dialog-button ng-if="!buttons.length && showDefaultButton" qva-activate="closeModal( $event, true );" qva-focus="true"\r\n					q-translation="Common.OK" tid="confirm"></qui-button>\r\n		<qui-button qv-delayed-dialog-button ng-repeat="button in buttons" qva-focus="button.defaultButton" qva-activate="closeModal( $event );" ng-disabled="button.expression === false"\r\n					q-translation="{{button.name}}" tid="{{button.tid}}"></qui-button>\r\n	</footer>\r\n</div>\r\n'}),define("text!assets/qlikui/components/qui-dialog-default/qui-dialog-default.html",[],function(){return'<div class="qui-delayedModal delayedModal qui-delayedmodal" ng-transclude>\r\n	<!-- This will be replaced by ng-transclude -->\r\n</div>'}),define("assets/qlikui/components/qui-dialog-default/qui-dialog-default",["qlikui/qui","text!./qui-dialog-default.html"],function(qui,template){qui.component("quiDialogDefault",{template:template})}),define("text!assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait.html",[],function(){return'<div>\r\n	<qui-dialog-default>\r\n		<header class="dm-header" q-translation="Common.PleaseWait">#Working#</header>\r\n		<main class="dm-main">\r\n			<p class="qui-pleasewaitdialog-loader-container"><img src="../resources/img/loader.svg"/></p>\r\n\r\n			<p class="qui-pleasewaitdialog-pleasewait" q-translation="Common.PleaseWait"></p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n		</footer>\r\n	</qui-dialog-default>\r\n</div>'}),define("assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait",["qlikui/qui","text!./qui-dialog-pleasewait.html"],function(qui,template){qui.component("quiDialogPleasewait",{template:template})}),define("assets/qlikui/components/qui-input-number/numerical-interval-transformer",[],function(){function removeNonIntegers(value){return Number(String(value).replace(/[^-\d]/g,""))}return{getNumerical:function(value,min,max){return value=removeNonIntegers(value),min=Number(min),max=Number(max),min>value?min:0!==max&&value>max?max:value}}}),define("text!assets/qlikui/components/qui-input-number/qui-input-number.ng.html",[],function(){return'<span>\r\n	<input class="qui-button" type="button" value="-" qva-activate="onChange(-1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n\r\n	<input type="tel" class="qui-input {{quiClass}}" tid="{{quiTid}}" title="{{quiTitle}}" ng-model="quiModel" ng-change="onChange()" ng-disabled="quiDisabled"/>\r\n\r\n	<input class="qui-button" type="button" value="+" qva-activate="onChange(1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n</span>\r\n'}),define("assets/qlikui/components/qui-input-number/qui-input-number",["qlikui/qui","./numerical-interval-transformer","text!./qui-input-number.ng.html"],function(qui,numericalIntervalTransformer,template){qui.component("quiInputNumber",{template:template,scope:{quiModel:"=",quiDisabled:"=",quiTitle:"@",quiMin:"@",quiMax:"@",quiClass:"@",quiSelectTextOnFocus:"@",quiWithButtons:"@",quiTid:"@"},controller:["$scope","$element",function($scope,$element){$scope.quiSelectTextOnFocus&&($scope.selected=!1,$element.click(function(){$scope.selected===!1&&($element.select(),$scope.selected=!0)}),$element.blur(function(){$scope.selected=!1})),$scope.onChange=function(newValue){var valueChange=parseInt(newValue)||0;$scope.quiModel=numericalIntervalTransformer.getNumerical(parseInt($element.find(".qui-input").val())+valueChange,$scope.quiMin,$scope.quiMax)}}]})}),define("text!assets/qlikui/components/qui-modal-default/qui-modal-default.html",[],function(){return'<div class="qui-modalbackground"></div>'}),define("assets/qlikui/components/qui-modal-default/qui-modal-default",["qlikui/qui","text!./qui-modal-default.html"],function(qui,template){qui.component("quiModalDefault",{template:template})}),define("text!assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup.html",[],function(){return'<div>\r\n	<label class="qui-radiobutton" ng-repeat="option in options" ng-class="{ \'qui-checked\' : option.value === quiSelectedValue, \'qui-disabled\': quiDisabled }">\r\n		<input type="radio" name="{{quiGroupName}}" value="{{option.value}}" ng-disabled="quiDisabled">\r\n		<div class="radio-wrap" ng-click="selected(option.value)">\r\n			<span class="radio"></span>\r\n			<span class="radio-text">{{option.label}}</span>\r\n			<div></div>\r\n		</div>\r\n	</label>\r\n</div>'}),define("assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup",["qlikui/qui","text!./qui-radiobuttongroup.html"],function(qui,template){"use strict";qui.component("quiRadiobuttongroup",{template:template,scope:{quiGroupName:"@",quiOptions:"@",quiSelectedValue:"=",quiDisabled:"="},controller:["$scope",function($scope){function createSortableOptions(){for(var parsedOptions=JSON.parse($scope.quiOptions),sortedOptions=[],i=0;i<Object.keys(parsedOptions).length;i++){var key=Object.keys(parsedOptions)[i],value=parsedOptions[key];sortedOptions.push({label:key,value:value})}$scope.options=sortedOptions}$scope.selected=function(option){$scope.quiSelectedValue=option},$scope.isChecked=function(value){return $scope.quiSelectedValue===value?"checked":""},createSortableOptions()}]})}),define("text!assets/qlikui/components/qui-checkbox/qui-checkbox.html",[],function(){return'<label class="qui-checkboxicon" title="{{quiTitle}}" ng-class="{ \'qui-hover\': hover }" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n	<input type="checkbox" ng-model="quiModel" ng-disabled="quiDisabled">\r\n		<div class="check-wrap">\r\n			<span class="check"></span>\r\n			<span class="check-text">{{quiLabel}}</span>\r\n		</div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-checkbox/qui-checkbox",["qlikui/qui","text!./qui-checkbox.html"],function(qui,template){qui.component("quiCheckbox",{template:template,scope:{quiModel:"=",quiDisabled:"=",quiLabel:"@",quiTitle:"@"}})}),define("text!assets/qlikui/components/qui-radiobutton/qui-radiobutton.html",[],function(){return'<label class="qui-radiobutton" ng-class="{ \'qui-disabled\': quiDisabled, \'qui-hover\': hover }" title="{{quiTitle}}" qva-activate="focus()" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n    <input type="radio" value="{{quiValue}}" ng-model="quiModel" ng-disabled="quiDisabled" ng-change="quiChange" name="{{quiName}}" tid="{{quiTid}}">\r\n    <div class="radio-wrap" qui-tabindex="{{tabindex}}">\r\n        <span class="radio"></span>\r\n        <span class="radio-text">{{quiLabel}}</span>\r\n    </div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton-logic-factory",[],function(){"use strict";function RadioButtonLogic($scope){function updateTabindex(){$scope.tabindex=$scope.quiDisabled?-1:$scope.quiTabindex}function select(event){$scope.quiDiasabled||32===event.keyCode&&($scope.quiModel=$scope.quiValue,$scope.$apply())}return $scope.quiTabindex||($scope.quiTabindex=0),updateTabindex(),{select:select,updateTabindex:updateTabindex}}return{createRadioButtonLogic:function(scope){return new RadioButtonLogic(scope)}}}),define("assets/qlikui/directives/qui-tabindex/qui-tabindex-logic",[],function(){"use strict";function updateTabindex(tabindex,$element){0>tabindex?$element[0].removeAttribute("tabindex"):$element[0].setAttribute("tabindex",tabindex)}return{updateTabindex:updateTabindex}}),define("assets/qlikui/directives/qui-tabindex/qui-tabindex",["qlikui/qui","./qui-tabindex-logic"],function(factory,tabindexLogic){"use strict";factory.directive("quiTabindex",function(){return{restrict:"A",scope:{qvaTabindex:"@"},controller:["$scope","$element",function($scope,$element){$scope.$watch("qvaTabindex",function(tabindex){tabindexLogic.updateTabindex(tabindex,$element)})}]}})}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton",["qlikui/qui","text!./qui-radiobutton.html","./qui-radiobutton-logic-factory","../../directives/qui-tabindex/qui-tabindex"],function(qui,template,radioButtonLogicFactory){"use strict";qui.component("quiRadiobutton",{template:template,scope:{quiLabel:"@",quiTitle:"@",quiValue:"@",quiName:"@",quiTabindex:"@",quiModel:"=",quiDisabled:"=",quiChange:"=",quiTid:"@"},controller:["$scope","$element","$timeout",function($scope,$element,$timeout){$timeout(function(){function onKeyDown(event){radioButtonLogic.select(event)}var radioButtonLogic=radioButtonLogicFactory.createRadioButtonLogic($scope);$scope.$watch("quiDisabled",radioButtonLogic.updateTabindex),$scope.focus=function(){$element[0].querySelector(".radio-wrap").focus()},$element.on("keydown",onKeyDown)})}]})}),define("text!assets/qlikui/components/qui-float/qui-float.html",[],function(){return'<div class="qui-float" ng-style="{top:top, left:left}" ng-show="visible" qva-reported-window-size="reportedWindowSize">\r\n	<div ng-transclude></div>\r\n</div>'}),define("assets/qlikui/components/qui-float/qui-float",["qlikui/qui","text!./qui-float.html"],function(qui,template){qui.component("quiFloat",{template:template,replace:!0,scope:{quiOffset:"=",quiResizeOnChange:"="},transclude:!0,controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function update(){$scope.quiOffset&&$scope.reportedSize&&$scope.reportedWindowSize?($scope.quiOffset.left+$scope.reportedSize.width<$scope.reportedWindowSize.width?$scope.left=$scope.quiOffset.left:$scope.left=$scope.reportedWindowSize.width-$scope.reportedSize.width,$scope.quiOffset.top+$scope.reportedSize.height<$scope.reportedWindowSize.height?$scope.top=$scope.quiOffset.top:$scope.top=$scope.reportedWindowSize.height-$scope.reportedSize.height,$scope.visible=!0):$scope.visible=!1}function contentSizeMaybeChanged(){$timeout(function(){$scope.reportedSize={width:$element.outerWidth(),height:$element.outerHeight()}})}$scope.$watch("quiResizeOnChange",contentSizeMaybeChanged,!0),$scope.$watch("[quiOffset, reportedSize, reportedWindowSize]",update,!0)}]})}),define("text!assets/qlikui/components/qui-button/qui-button.html",[],function(){return'<button class="{{className}}" ng-transclude></button>'}),define("assets/qlikui/components/qui-button/qui-button",["qlikui/qui","text!./qui-button.html"],function(qui,template){function setClassName(scope,outline,type,round,light){var a=["qui"];a.push(type||(outline?"outlinebutton":"button")),scope.className=a.join("-"),round&&(scope.className+=" round"),light&&(scope.className+="-light")}var ENTER=13;qui.component("quiButton",{template:template,scope:{theme:"@"},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){setClassName($scope,$attrs.hasOwnProperty("outline"),$attrs.buttonType,$attrs.hasOwnProperty("round"),$attrs.hasOwnProperty("light")),$element.on("keypress",function(e){e.keyCode===ENTER&&$element.trigger("qv-activate")})}]})}),define("text!assets/qlikui/components/qui-toggle-switch/qui-toggle-switch.ng.html",[],function(){return'<div class="switch qui-onoffswitch" ng-class="{ \'qui-focus\': focus, \'qui-checked\': value }" ng-disabled="readOnly">\r\n	<label class="onoffswitch-label" >\r\n		<input type="checkbox" ng-model="value" class="onoffswitch-checkbox" ng-disabled="readOnly || touch">\r\n		<span class="onoffswitch-span">\r\n			<div class="onoffswitch-inner"></div>\r\n			<div class="onoffswitch-switch" ></div>\r\n		</span>\r\n	</label>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-toggle-switch/qui-toggle-switch",["qlikui/qui","text!./qui-toggle-switch.ng.html"],function(qui,template){qui.component("quiToggleSwitch",{scope:{readOnly:"=",value:"=",isFocused:"=?"},template:template,controller:["$scope","$element",function($scope,$element){var linkFn=qui.getConfigOption("quiToggleSwitchLink");"function"==typeof linkFn&&linkFn($scope,$element)}]})}),define("text!assets/qlikui/components/qui-search-field/qui-search-field.ng.html",[],function(){return'<div class="qui-searchfield"  ng-class="{ \'qui-focus\': focus }" ng-disabled="disabled">\r\n	<span class="magnifying-glass"></span>\r\n	<span q-title-translation="Common.Clear" class="clear-button" ng-show="query.length" qva-activate="clearSearch($event)"></span>\r\n	<input maxlength="{{maxlength || 255}}" q-placeholder="{{placeholder}}" ng-model="query" ng-disabled="disabled" autocomplete="{{autocomplete}}" spellcheck="false" ng-trim="false" type="text" qva-blur="blurred()"\r\n			qva-focus="autoFocus" qv-escape="escape($event)" qv-enter="enter($event)"/>\r\n</div>'}),define("assets/qlikui/components/qui-search-field/qui-search-field",["qlikui/qui","text!./qui-search-field.ng.html"],function(qui,template){qui.component("quiSearchField",{scope:{query:"=",disabled:"=",autocomplete:"=",placeholder:"@",autoFocus:"=?",isFocused:"=?",focuscallback:"&",maxlength:"=",onEscape:"&",onEnter:"&"},template:template,link:function(scope,element){var clearButton=element.find("span.clear-button"),input=element.find("input");scope.focus=!1,input.on("focus.quiSearchField",function(){scope.$root.$$phase?scope.focused():scope.$apply(function(){scope.focused()})}),scope.focused=function(){scope.focuscallback(),scope.focus=!0,scope.isFocused=!0},scope.blurred=function(){scope.focus=!1,scope.isFocused=!1},scope.escape=function(event){
scope.onEscape&&scope.onEscape({$event:event})},scope.enter=function(event){scope.onEnter&&scope.onEnter({$event:event})},scope.clearSearch=function(event){event.preventDefault(),scope.query="",input[0]&&qui.getConfigOption("treatAsDesktop")&&input[0].focus()},scope.$on("$destroy",function(){input.off(".quiSearchField"),clearButton.off(".quiSearchField")})}})}),define("text!assets/qlikui/components/qui-filter/qui-filter.ng.html",[],function(){return'<div class="button-div qui-filter qui-buttongroup">\r\n	<qui-button light\r\n				qva-activate="toggleAscDesc()"\r\n				class="asc-desc"\r\n				title="{{sortTitle | translate}}"\r\n				data-icon="{{isAscending ? \'ascending\' : \'descending\'}}"></qui-button>\r\n\r\n	<qui-button light\r\n				disabled="disabled"\r\n				ng-if="sections.length <= 1"\r\n				class="sort-filter qui-dropdown"\r\n				title="{{ sortOptTitle | translate }}">\r\n		{{ $parent.sections[0].text || "Common.SortByAlphabetical" | translate }}\r\n	</qui-button>\r\n\r\n	<qui-select ng-if="sections.length > 1"\r\n				class="sort-filter light"\r\n				qui-model="$parent.selectedFltr"\r\n				qui-options="option.value as option.text | translate for option in sections"\r\n				title="{{sortOptTitle | translate}}"></qui-select>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-filter/qui-filter",["qlikui/qui","text!./qui-filter.ng.html"],function(qui,template){qui.component("quiFilter",{restrict:"E",replace:!0,scope:{isAscending:"=",sections:"=",selectedFltr:"=",toggleAscDesc:"&",sortTitle:"@",sortOptTitle:"@"},template:template})}),define("text!assets/qlikui/components/qui-select/qui-select.html",[],function(){return'<div class="qui-select">\r\n	<select class="select" %attrs%>\r\n		%options%\r\n	</select>\r\n	<div class="arrow"></div>\r\n	<div class="border"></div>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-select/qui-select",["qlikui/qui","text!./qui-select.html"],function(qui,template){qui.component("quiSelect",{transclude:!1,template:function($element,$attrs){var attrs='ng-model="'+$attrs.quiModel+'"';$attrs.quiDisabled&&(attrs+=' ng-disabled="'+$attrs.quiDisabled+'"'),$attrs.quiOptions&&(attrs+=' ng-options="'+$attrs.quiOptions+'"'),$attrs.quiChange&&(attrs+=' ng-change="'+$attrs.quiChange+'"'),$attrs.quiTid&&(attrs+=' tid="'+$attrs.quiTid+'"');var result=template.replace("%attrs%",attrs).replace("%options%",$element.html());return result},link:function($scope,$element){var select=$element.find(".select");select.on("mouseenter",function(){select.addClass("qui-hover")}),select.on("mouseleave",function(){select.removeClass("qui-hover")})},scope:!1})}),define("text!assets/qlikui/components/qui-button-outline-round/qui-button-outline-round.html",[],function(){return'<button class="qv-btn-outline-round" ng-class="{\'qv-btn-outline-round-no-text\': !qvaButtonText && !qvaButtonPreIconText, \'qv-btn-outline-round-with-text\':  qvaButtonText || qvaButtonPreIconText}">\r\n	<div class="qv-btn-outline-round-flex">\r\n		<div ng-if="qvaButtonPreIconText" ng-class="{\'qv-btn-outline-round-icon-right\': classIcon}" class="qv-btn-outline-round-text">{{qvaButtonPreIconText}}</div>\r\n		<i class="outline-icon {{ classIcon }}"></i>\r\n		<div ng-if="qvaButtonText" ng-class="{\'qv-btn-outline-round-icon-left\': classIcon}" class="qv-btn-outline-round-text" q-translation="{{qvaButtonText}}"></div>\r\n	</div>\r\n</button>'}),define("assets/qlikui/components/qui-button-outline-round/qui-button-outline-round",["qlikui/qui","text!./qui-button-outline-round.html"],function(qui,template){qui.component("quiButtonOutlineRound",{template:template,replace:!0,scope:{"class":"@",classIcon:"@",qvaButtonText:"@",qvaButtonPreIconText:"="},link:function($scope){$scope.$watch("classIcon",function(newIcon){$scope.classIcon=newIcon})}})}),define("text!assets/qlikui/components/qui-button-icon/qui-button-icon.html",[],function(){return'<button class="{{className}}" ng-class="classes" ng-transclude></button>'}),define("assets/qlikui/components/qui-button-icon/qui-button-icon",["qlikui/qui","text!./qui-button-icon.html"],function(qui,template){function setClassName(scope,toggleButton,active){var string="qui-btn-icn";scope.className=string+(toggleButton?"-tgl":""),active&&(scope.className+=" qui-active")}var ENTER=13;qui.component("quiButtonIcon",{template:template,scope:{icon:"@",active:"="},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){function setClassNameWatcher(){setClassName($scope,$attrs.hasOwnProperty("toggle"),$scope.active)}function keyPress(e){e.keyCode===ENTER&&$element.trigger("qv-activate")}$scope.$watch("active",setClassNameWatcher),$element.on("keypress",keyPress)}]})}),define("qlikui/components",["assets/qlikui/components/qui-dialog-default/qui-dialog-default","assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait","assets/qlikui/components/qui-input-number/qui-input-number","assets/qlikui/components/qui-modal-default/qui-modal-default","assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup","assets/qlikui/components/qui-checkbox/qui-checkbox","assets/qlikui/components/qui-radiobutton/qui-radiobutton","assets/qlikui/components/qui-float/qui-float","assets/qlikui/components/qui-button/qui-button","assets/qlikui/components/qui-list/qui-list","assets/qlikui/components/qui-toggle-switch/qui-toggle-switch","assets/qlikui/components/qui-search-field/qui-search-field","assets/qlikui/components/qui-filter/qui-filter","assets/qlikui/components/qui-select/qui-select","assets/qlikui/components/qui-button-outline-round/qui-button-outline-round","assets/qlikui/components/qui-button-icon/qui-button-icon"],function(){}),define("general.services/delayed-modal/delayed-modal",["jquery","core.utils/deferred","qvangular","text!general.services/delayed-modal/delayed-modal.ng.html","angular","qlikui/components"],function($,Deferred,qvangular,modalTemplate){var defaultEscButton,angular=window.angular,modalDefault={"max-height":"90%","max-width":"90%","min-height":"180px",width:"400px"},isOpened=!1,isLocked=!1;qvangular.directive("qvDelayedDialogButton",function(){return{replace:!0,restrict:"A",link:function($scope){$scope.button&&$scope.button.defaultEscButton&&(defaultEscButton=$scope),$scope.closeModal=function(e,close){e&&(e.preventDefault(),e.stopPropagation()),$scope.button&&$scope.button.callback&&("undefined"==typeof $scope.button.expression||$scope.button.expression)&&$scope.button.callback(),(close||$scope.autoClose||$scope.button&&!$scope.button.callback)&&$scope.destroyModal()}}}}),qvangular.service("$delayedModal",["$compile","$rootScope","$document",function($compile,$rootScope,$document){var $scope,$previousScope,$container,$previousContainer,o={},template=modalTemplate,exports={open:function(options){var unWatchElement,dfr=new Deferred;$scope&&($previousScope=$scope,$previousContainer=$container),$scope=$rootScope.$new(),$container=angular.element('<div class="qv-modal-container qui-modalbackground-centered" qva-outside-ignore-for="allOutside" ng-style="containerStyle" ng-class="classes"></div>'),$scope.containerStyle={content:" "},$scope.classes={},$scope.modalStyle={};for(var k in modalDefault)$scope.modalStyle[k]=modalDefault[k];$scope.wasDisabled=[],$scope.showDefaultButton=!0,isOpened=!0,isLocked=!1,o=options,$scope.failed=!1,$scope.autoClose=!0;for(k in o)$scope[k]=o[k];return $container.html(template).appendTo($document.find("body")),$scope.html&&$container.find("main").append($scope.html),unWatchElement=$scope.$watch("element",function(){dfr.resolve(),unWatchElement()}),$scope.element=$compile($container)($scope),$scope.destroyModal=this.close.bind(this),$scope.handleEscButton=function(e){e&&(e.preventDefault(),e.stopPropagation()),$scope.buttons&&defaultEscButton?defaultEscButton&&defaultEscButton.closeModal():$scope.destroyModal()},$scope.$broadcast("delayed-modal-opened"),$scope.$watchCollection("[width, height]",function(){$scope.width&&($scope.modalStyle.width=$scope.width),$scope.height&&($scope.modalStyle.height=$scope.height)}),dfr.promise},update:function(options){if(isOpened){for(var i in options)$scope[i]=options[i],o[i]=options[i];(options.html||options.buttons)&&($container.html(template),$container.find("main").html(options.html),$document.find("body").find(".qui-delayedModal").replaceWith($container.html()),$scope.element=$compile($container)($scope))}},close:function(){$scope&&$container&&($container.remove(),$scope.$destroy(),$scope.$broadcast("delayed-modal-closed"),$scope=$previousScope||null,$container=$previousContainer||null,$previousScope=$previousContainer=null),isOpened=!1,isLocked=!1},lock:function(){isLocked=!0,$scope.wasDisabled.length=0,$scope.element.find("button, input, textarea, select").each(function(){var $elem=$(this);$elem.prop("disabled")?$scope.wasDisabled.push(this):$elem.prop("disabled",!0)})},unlock:function(){isLocked=!1,$scope.element.find("button, input, textarea, select").each(function(){-1===$scope.wasDisabled.indexOf(this)&&$(this).prop("disabled",!1)}),$scope.wasDisabled.length=0}};return Object.defineProperty(exports,"isOpened",{get:function(){return isOpened}}),Object.defineProperty(exports,"isLocked",{get:function(){return isLocked}}),Object.defineProperty(exports,"scope",{get:function(){return $scope}}),exports}])}),define("client.controllers/error-handler-controller",["jquery","qvangular","translator","autogenerated/qix/engine-enums","general.enums/qrs-enums","general.controllers/route-controller","core.utils/external-urls","text!client.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function($,qvangular,translator,engineEnums,qrsEnums,RouteController,externalUrl,expireTemplate){"use strict";function showDialog(error){if(!modalOpen){var delayedDialog=qvangular.getService("$delayedModal");if(modalOpen=!0,"OnSessionLoggedOut"===error)return options={title:"Hub.OnSessionLoggedOut.title",content:"Hub.OnSessionLoggedOut.message",buttons:[{name:"Hub.OnSessionLoggedOut.button",defaultButton:!0,callback:function(){location.href=RouteController.buildUrl(!0,"hub")}}],showDefaultButton:!1,classes:{"qs-e-dim":!0}},void translator.ready.then(function(){qvangular.getService("$delayedModal").open(options),qvangular.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){modalOpen=!1})});if(error.code===errors.LOCERR_JSON_RPC_INVALID_PARAMETERS)return void(modalOpen=!1);var buttons=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0,callback:function(){var secondButton=null;2===options.buttons.length&&(secondButton=options.buttons[1]),delayedDialog.scope.$root.$broadcast("errorHandlerClosed",options.content,secondButton)}}];error.buttons?buttons=error.buttons:error.method&&"OnEngineWebsocketFailed"===error.method||error.code===errors.LOCERR_APP_NOT_FOUND||error.code===errors.LOCERR_APP_CONNECT_FAILED?buttons=[{name:"Common.Refresh",callback:function(){qvangular.getService("$timeout")(function(){location.reload(!0)})}},{name:"ErrorDialog.GoToHub",defaultButton:!0,callback:function(){location.href=RouteController.buildUrl(!0,"hub")}}]:(error.code===errors.LOCERR_SERVER_LICENSE_EXPIRED||error.code===errors.LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_SESSION_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_USAGE_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_CALS||error.code===errors.LOCERR_SERVER_OUT_OF_NAMED_CALS||error.code===errors.LOCERR_GENERIC_CONNECTION_LOST)&&(buttons[0].defaultButton=!1,buttons.push({name:"Common.Refresh",defaultButton:!0,callback:function(){qvangular.getService("$timeout")(function(){location.reload(!0)});var secondButton=null;2===options.buttons.length&&(secondButton=options.buttons[1]),qvangular.$rootScope.$broadcast("errorHandlerRefresh",options.content,secondButton)}})),translator.ready.then(function(){if(options=$.extend(!0,{},error,{title:"ErrorDialog.Title",content:error.code?"ErrorCode."+error.code:error.message,buttons:buttons,showDefaultButton:!1,classes:{"qs-e-dim":!0}}),error.code===errors.LOCERR_PERSONAL_VERSION_EXPIRED){var upgradeMsg=translator.get("Info.QlikView.Personal.Upgrade",["<a href='"+externalUrl.personalUpgradeUrl+"' target='_blank'>"+externalUrl.personalUpgradeBase+"</a>"]),htmlTemplate=expireTemplate.replace("<upgrade-msg/>",upgradeMsg);options.html=htmlTemplate,options.title="ErrorCode.12001.Sense.Desktop.Expired"}delayedDialog.open(options),delayedDialog.scope.$on("delayed-modal-closed",function(){modalOpen=!1}),delayedDialog.scope.$root.$broadcast("errorHandlerOpen")}),document.activeElement&&$(document.activeElement).blur()}}var modalOpen=!1,errors=$.extend({},engineEnums.NxLocalizedErrorCode,qrsEnums.NxLocalizedErrorCode),options={};return{showDialog:showDialog,isOpen:function(){return modalOpen}}}),define("client.controllers/warning-handler-controller",["jquery","qvangular","autogenerated/qix/engine-enums","core.utils/external-urls","text!client.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function($,qvangular,enums,externalUrl,expireTemplate){"use strict";function listenToDialogCloseEvent(){qvangular.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){warningQueue.length&&qvangular.getService("$timeout")(function(){showDelayedModal(warningQueue.shift())})})}function findExpiryWarningIndex(warnings){for(var index=-1,i=0;i<warnings.length;i++)if("undefined"!=typeof warnings[i].code&&warnings[i].code===warningCodes.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON){index=i;break}return index}function showDelayedModal(warning){var options={};translator.ready.then(function(){if(options=$.extend(!0,{},warning,{title:"WarningDialog.Title",content:"undefined"!=typeof warning.code?"WarningCode."+warning.code:warning.message,buttons:buttons,showDefaultButton:!1}),"undefined"!=typeof warning.code&&warning.code===warningCodes.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON){var upgradeMsg=translator.get("Info.QlikView.Personal.Upgrade",["<a href='"+externalUrl.personalUpgradeUrl+"' target='_blank'>"+externalUrl.personalUpgradeBase+"</a>"]);options.html=expireTemplate.replace("<upgrade-msg/>",upgradeMsg)}qvangular.getService("$delayedModal").open(options),listenToDialogCloseEvent()}),document.activeElement&&$(document.activeElement).blur()}function showDialog(warnings,theTranslator){var warningsClone=$.extend(!0,[],warnings);if(translator||(translator=theTranslator),expireWarningAlreadyShown){var index=findExpiryWarningIndex(warningsClone);-1!==index&&warningsClone.splice(index,1)}else-1!==findExpiryWarningIndex(warningsClone)&&(expireWarningAlreadyShown=!0,sessionStorage.setItem("ExpireWarningShown",!0));warningsClone.length>0&&(warningQueue.push.apply(warningQueue,warningsClone),qvangular.getService("$delayedModal").isOpened?listenToDialogCloseEvent():showDelayedModal(warningQueue.shift()))}var translator,warningCodes=enums.NxLocalizedWarningCode,buttons=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0}],warningQueue=[],expireWarningAlreadyShown=sessionStorage.ExpireWarningShown;return{showDialog:showDialog}}),define("client.models/rpc-session",["assets/core/models/rpc-session","core.utils/websocket","core.utils/deferred","core.utils/authentication","core.utils/debug-flags","translator","client.controllers/error-handler-controller","client.controllers/warning-handler-controller","autogenerated/qix/engine-enums","qvangular"],function(RPCSession,WebSocket,Deferred,Authentication,DebugFlags,translator,ErrorDialog,WarningDialog,enums,qvangular){function onNotification(data){var proxyNotifications=["OnLicenseAccessDenied","OnSessionClosed","OnEngineWebsocketFailed","OnNoEngineAvailable","OnSessionTimedOut","OnSessionClosed","OnNoDataPrepServiceAvailable","OnDataPrepServiceWebsocketFailed"];"OnSessionLoggedOut"===data.method?ErrorDialog.showDialog(data.method):"OnEngineWebsocketFailed"===data.method?ErrorDialog.showDialog({method:data.method,message:translator.get("ProxyError."+data.method)}):proxyNotifications.indexOf(data.method)>-1?ErrorDialog.showDialog({message:translator.get("ProxyError."+data.method)}):"OnAuthenticationInformation"===data.method&&Authentication.parse(data.params)}function logTraffic(data){var direction="string"==typeof data?"SENT":"RECV";window.console.info("[DBGFLG:SOCKET]",direction,":",data)}function onWarning(data){var warnings=[];if("ExportData"!==this.reqCache[data.id].method){for(var i=0;i<data.warnings.length;i++)warnings.push({code:data.warnings[i]});WarningDialog.showDialog(warnings,translator)}}var debounceTimer,Errors=enums.NxLocalizedErrorCode,debouncedFns=[];return RPCSession.createSocket=function(url){var ws;try{ws=new WebSocket(url)}catch(err){ErrorDialog.showDialog({message:"ErrorDialog.NoConnectionCreated"})}return ws},RPCSession.hookIntoDeferred=function(dfd){dfd.promise.then(null,function(err){return qvangular.getService("$timeout")(function(){err||(err={isHandled:!1}),err.isHandled||err.error.isHandled||err.error.code===Errors.LOCERR_GENERIC_ABORTED||ErrorDialog.showDialog(err.error)},1e3),Deferred.reject(err)})},RPCSession.debounceApply=function(fn){clearTimeout(debounceTimer),debouncedFns.push(fn),debounceTimer=setTimeout(function(){qvangular.$apply(qvangular.$rootScope,function(){for(var i=0;i<debouncedFns.length;i++)try{debouncedFns[i]()}catch(e){}debouncedFns.length=0})})},RPCSession.NewSessionCreated.bind(function(session){session.Notification.bind(onNotification),session.Warning.bind(onWarning),DebugFlags.SOCKET&&(session.Data.bind(logTraffic),session.Error.bind(logTraffic),session.Send.bind(logTraffic))}),RPCSession}),define("autogenerated/qix/engine-api-def",[],function(){"use strict";var definition={Field:{GetCardinal:{In:[],Out:[]},GetAndMode:{In:[],Out:[]},SelectValues:{In:[{Name:"qFieldValues",DefaultValue:[{qText:"",qIsNumeric:!1,qNumber:0}]},{Name:"qToggleMode",DefaultValue:!1,Optional:!0},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Select:{In:[{Name:"qMatch",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qExcludedValuesMode",DefaultValue:0,Optional:!0}],Out:[]},ToggleSelect:{In:[{Name:"qMatch",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qExcludedValuesMode",DefaultValue:0,Optional:!0}],Out:[]},ClearAllButThis:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectPossible:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectExcluded:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectAll:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Lock:{In:[],Out:[]},Unlock:{In:[],Out:[]},GetNxProperties:{In:[],Out:[{Name:"qProperties"}]},SetNxProperties:{In:[{Name:"qProperties",DefaultValue:{qOneAndOnlyOne:!1}}],Out:[]},SetAndMode:{In:[{Name:"qAndMode",DefaultValue:!1}],Out:[]},SelectAlternative:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},LowLevelSelect:{In:[{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Clear:{In:[],Out:[]}},Variable:{GetContent:{In:[],Out:[{Name:"qContent"}]},GetRawContent:{In:[],Out:[]},SetContent:{In:[{Name:"qContent",DefaultValue:""},{Name:"qUpdateMRU",DefaultValue:!1}],Out:[]},ForceContent:{In:[{Name:"qs",DefaultValue:""},{Name:"qd",DefaultValue:0}],Out:[]},GetNxProperties:{In:[],Out:[{Name:"qProperties"}]},SetNxProperties:{In:[{Name:"qProperties",DefaultValue:{qName:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qUsePredefListedValues:!1,qPreDefinedList:[""]}}],Out:[]}},GenericObject:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},GetListObjectData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeReducedData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qZoomFactor",DefaultValue:0},{Name:"qReductionMode",DefaultValue:0}],Out:[{Name:"qDataPages"}]},GetHyperCubePivotData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeStackData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qMaxNbrCells",DefaultValue:0,Optional:!0}],Out:[{Name:"qDataPages"}]},GetHyperCubeBinnedData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qViewport",DefaultValue:{qWidth:0,qHeight:0,qZoomLevel:0}},{Name:"qDataRanges",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qMaxNbrCells",DefaultValue:0},{Name:"qQueryLevel",DefaultValue:0},{Name:"qBinningMethod",DefaultValue:0}],Out:[{Name:"qDataPages"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]},{Name:"qSoftPatch",DefaultValue:!1,Optional:!0}],Out:[]},ClearSoftPatches:{In:[],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetEffectiveProperties:{In:[],Out:[{Name:"qProp"}]},SetFullPropertyTree:{In:[{Name:"qPropEntry",DefaultValue:{qProperty:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}},qChildren:[],qEmbeddedSnapshotRef:null}}],Out:[]},GetFullPropertyTree:{In:[],Out:[{Name:"qPropEntry"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},ClearSelections:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},ExportData:{In:[{Name:"qFileType",DefaultValue:0},{Name:"qPath",DefaultValue:"",Optional:!0},{Name:"qFileName",DefaultValue:"",Optional:!0},{Name:"qExportState",DefaultValue:0,Optional:!0}],Out:[{Name:"qUrl"}]},SelectListObjectValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectPossible:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectExcluded:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectAlternative:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectAll:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SearchListObjectFor:{In:[{Name:"qPath",DefaultValue:""},{Name:"qMatch",DefaultValue:""}],Out:[{Name:"qSuccess"}]},AbortListObjectSearch:{In:[{Name:"qPath",DefaultValue:""}],Out:[]},AcceptListObjectSearch:{In:[{Name:"qPath",DefaultValue:""},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},ExpandLeft:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},ExpandTop:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},CollapseLeft:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},CollapseTop:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},DrillUp:{In:[{Name:"qPath",DefaultValue:""},{Name:"qDimNo",DefaultValue:0},{Name:"qNbrSteps",DefaultValue:0}],Out:[]},Lock:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},Unlock:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},SelectHyperCubeValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qDimNo",DefaultValue:0},{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1}],Out:[{Name:"qSuccess"}]},SelectHyperCubeCells:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRowIndices",DefaultValue:[0]},{Name:"qColIndices",DefaultValue:[0]},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectPivotCells:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSelections",DefaultValue:[{qType:0,qCol:0,qRow:0}]},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},RangeSelectHyperCubeValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRanges",DefaultValue:[{qRange:{qMin:0,qMax:0,qMinInclEq:!1,qMaxInclEq:!1},qMeasureIx:0}]},{Name:"qColumnsToSelect",DefaultValue:[0],Optional:!0},{Name:"qOrMode",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},GetChild:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetChildInfos:{In:[],Out:[{Name:"qInfos"}]},CreateChild:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}},{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[{Name:"qInfo"}]},DestroyChild:{In:[{Name:"qId",DefaultValue:""},{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[{Name:"qSuccess"}]},DestroyAllChildren:{In:[{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[]},SetChildArrayOrder:{In:[{Name:"qIds",DefaultValue:[""]}],Out:[]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},CopyFrom:{In:[{Name:"qFromId",DefaultValue:""}],Out:[]},BeginSelections:{In:[{Name:"qPaths",DefaultValue:[""]}],Out:[]},EndSelections:{In:[{Name:"qAccept",DefaultValue:!1}],Out:[]},ResetMadeSelections:{In:[],Out:[]},EmbedSnapshotObject:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetSnapshotObject:{In:[],Out:[]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericDimension:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDimension:{In:[],Out:[{Name:"qDim"}]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericBookmark:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},Apply:{In:[],Out:[{Name:"qSuccess"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericVariable:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{},qName:"",qComment:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qDefinition:""}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},SetStringValue:{In:[{Name:"qVal",DefaultValue:""}],Out:[]},SetNumValue:{In:[{Name:"qVal",DefaultValue:0}],Out:[]},SetDualValue:{In:[{Name:"qText",DefaultValue:""},{Name:"qNum",DefaultValue:0}],Out:[]}},GenericMeasure:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetMeasure:{In:[],Out:[{Name:"qMeasure"}]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericDerivedDefinition:{SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},MatchTags:{In:[{Name:"qTags",DefaultValue:[""]}],Out:[]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDerivedDefinitionData:{In:[],Out:[{Name:"qData"}]},GetExpression:{In:[{Name:"qExpressionName",DefaultValue:""},{Name:"qParameters",DefaultValue:[""]}],Out:[]}},GenericDerivedFields:{SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDerivedFieldData:{In:[],Out:[{Name:"qData"}]},GetDerivedField:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qFields"}]},GetListData:{In:[],Out:[{Name:"qListData"}]},GetDerivedFields:{In:[],Out:[{Name:"qFields"}]},GetDerivedGroups:{In:[],Out:[{Name:"qGroups"}]}},InternalTest:{Initialised:{In:[],Out:[]},TestMemoryManagement:{In:[],Out:[]},TestNextFileFormat:{In:[],Out:[]},BombQRS:{In:[],Out:[]},BombQRSParallel:{In:[{Name:"qNThreads",DefaultValue:0}],Out:[]},TestLogging:{In:[{Name:"qLogger",DefaultValue:""},{Name:"qVerbosity",DefaultValue:0},{Name:"qSteps",DefaultValue:0,Optional:!0}],Out:[]},TestRepositoryLogging:{In:[{Name:"qLogger",DefaultValue:""},{Name:"qVerbosity",DefaultValue:0},{Name:"qMessage",DefaultValue:""}],Out:[]},GetQixCounters:{In:[],Out:[{Name:"qCounters"}]},ResetQixCounters:{In:[],Out:[]}},Doc:{GetProperties:{In:[],Out:[]},GetField:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},GetFieldDescription:{In:[{Name:"qFieldName",DefaultValue:""}],Out:[]},GetVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},GetLooselyCoupledVector:{In:[],Out:[{Name:"qv"}]},SetLooselyCoupledVector:{In:[{Name:"qv",DefaultValue:[0]}],Out:[]},Evaluate:{In:[{Name:"qExpression",DefaultValue:""}],Out:[]},EvaluateEx:{In:[{Name:"qExpression",DefaultValue:""}],Out:[{Name:"qValue"}]},ClearAll:{In:[{Name:"qLockedAlso",DefaultValue:!1,Optional:!0},{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},LockAll:{In:[{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},UnlockAll:{In:[{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},Back:{In:[],Out:[]},Forward:{In:[],Out:[]},ReduceData:{In:[{Name:"qConfirm",DefaultValue:!1,Optional:!0},{Name:"qDropFieldNames",DefaultValue:[""],Optional:!0}],Out:[]},RemoveAllData:{In:[{Name:"qConfirm",DefaultValue:!1,Optional:!0}],Out:[]},CreateVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},RemoveVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},GetLocaleInfo:{In:[],Out:[]},GetTablesAndKeys:{In:[{Name:"qWindowSize",DefaultValue:{qcx:0,qcy:0}},{Name:"qNullSize",DefaultValue:{qcx:0,qcy:0}},{Name:"qCellHeight",DefaultValue:0},{Name:"qSyntheticMode",DefaultValue:!1},{Name:"qIncludeSysVars",DefaultValue:!1}],Out:[{Name:"qtr"},{Name:"qk"}]},GetViewDlgSaveInfo:{In:[],Out:[]},SetViewDlgSaveInfo:{In:[{Name:"qInfo",DefaultValue:{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCtlInfo:{qInternalView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0},qSourceView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0}},qMode:0}}],Out:[]},GetEmptyScript:{In:[{Name:"qLocalizedMainSection",DefaultValue:"",Optional:!0}],Out:[]},DoReload:{In:[{Name:"qMode",DefaultValue:0,Optional:!0},{Name:"qPartial",DefaultValue:!1,Optional:!0},{Name:"qDebug",DefaultValue:!1,Optional:!0}],Out:[]},GetScriptBreakpoints:{In:[],Out:[{Name:"qBreakpoints"}]},SetScriptBreakpoints:{In:[{Name:"qBreakpoints",DefaultValue:[{qbufferName:"",qlineIx:0,qEnabled:!1}]}],Out:[]},
GetScript:{In:[],Out:[{Name:"qScript"}]},GetTextMacros:{In:[],Out:[{Name:"qMacros"}]},SetFetchLimit:{In:[{Name:"qLimit",DefaultValue:0}],Out:[]},DoSave:{In:[{Name:"qFileName",DefaultValue:"",Optional:!0}],Out:[]},GetTableData:{In:[{Name:"qOffset",DefaultValue:0},{Name:"qRows",DefaultValue:0},{Name:"qSyntheticMode",DefaultValue:!1},{Name:"qTableName",DefaultValue:""}],Out:[{Name:"qData"}]},GetAppLayout:{In:[],Out:[{Name:"qLayout"}]},SetAppProperties:{In:[{Name:"qProp",DefaultValue:{qTitle:"",qLastReloadTime:"",qMigrationHash:"",qSavedInProductVersion:"",qThumbnail:{qUrl:""}}}],Out:[]},GetAppProperties:{In:[],Out:[{Name:"qProp"}]},CreateSessionObject:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[]},DestroySessionObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CreateObject:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetObject:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateDraft:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qDraftId"}]},CommitDraft:{In:[{Name:"qId",DefaultValue:""}],Out:[]},DestroyDraft:{In:[{Name:"qId",DefaultValue:""},{Name:"qSourceId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},Undo:{In:[],Out:[{Name:"qSuccess"}]},Redo:{In:[],Out:[{Name:"qSuccess"}]},ClearUndoBuffer:{In:[],Out:[]},CreateDimension:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateMeasure:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateSessionVariable:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{},qName:"",qComment:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qDefinition:""}}],Out:[]},DestroySessionVariable:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CreateVariableEx:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{},qName:"",qComment:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qDefinition:""}}],Out:[{Name:"qInfo"}]},DestroyVariableById:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},DestroyVariableByName:{In:[{Name:"qName",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetVariableById:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetVariableByName:{In:[{Name:"qName",DefaultValue:""}],Out:[]},MigrateVariables:{In:[],Out:[]},CreateDerivedDefinition:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetDerivedDefinitionByName:{In:[{Name:"qName",DefaultValue:""}],Out:[]},CloneDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},GetDerivedDefinitionsForTags:{In:[{Name:"qTags",DefaultValue:[""]}],Out:[{Name:"qInstanceName"}]},AssignDerivedFieldFor:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qDerivedDefinitionNames",DefaultValue:[""]}],Out:[]},CreateDerivedFields:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDerivedFields:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDerivedFields:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetAllDerivedFields_INTERNAL:{In:[],Out:[{Name:"qDerivedFields"}]},GetDerivedFieldDimensionDef:{In:[{Name:"qLibraryId",DefaultValue:""}],Out:[{Name:"qDimensionDef"}]},GetDerivedFieldFor:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qGetDerivedDefinitionsForTags",DefaultValue:""}],Out:[]},GetAllDerivedFieldsFor:{In:[{Name:"qFieldName",DefaultValue:""}],Out:[{Name:"qDerivedFields"}]},MigrateDerivedFields:{In:[],Out:[]},CheckExpression:{In:[{Name:"qExpr",DefaultValue:""},{Name:"qLabels",DefaultValue:[""],Optional:!0}],Out:[{Name:"qErrorMsg"},{Name:"qBadFieldNames"},{Name:"qDangerousFieldNames"}]},CheckNumberOrExpression:{In:[{Name:"qExpr",DefaultValue:""}],Out:[{Name:"qErrorMsg"},{Name:"qBadFieldNames"}]},AddAlternateState:{In:[{Name:"qStateName",DefaultValue:""}],Out:[]},RemoveAlternateState:{In:[{Name:"qStateName",DefaultValue:""}],Out:[]},CreateBookmark:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[]},ApplyBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CloneBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},AddFieldFromExpression:{In:[{Name:"qName",DefaultValue:""},{Name:"qExpr",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetAllInfos:{In:[],Out:[{Name:"qInfos"}]},Resume:{In:[],Out:[]},AbortModal:{In:[{Name:"qAccept",DefaultValue:!1}],Out:[]},Publish:{In:[{Name:"qStreamId",DefaultValue:""},{Name:"qName",DefaultValue:"",Optional:!0}],Out:[]},UnPublish:{In:[],Out:[]},GetMatchingFields:{In:[{Name:"qTags",DefaultValue:[""]},{Name:"qMatchingFieldMode",DefaultValue:0,Optional:!0}],Out:[{Name:"qFieldNames"}]},FindMatchingFields:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qTags",DefaultValue:[""]}],Out:[{Name:"qFieldNames"}]},SearchSuggest:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]}],Out:[{Name:"qResult"}]},SearchAssociations:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]},{Name:"qPage",DefaultValue:{qOffset:0,qCount:0,qMaxNbrFieldMatches:0}}],Out:[{Name:"qResults"}]},SelectAssociations:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]},{Name:"qMatchIx",DefaultValue:0},{Name:"qSoftLock",DefaultValue:null,Optional:!0}],Out:[]},SaveObjects:{In:[],Out:[]},GetAssociationScores:{In:[{Name:"qTable1",DefaultValue:""},{Name:"qTable2",DefaultValue:""}],Out:[{Name:"qScore"}]},GetMediaList:{In:[],Out:[{Name:"qList"}]},GetContentLibraries:{In:[],Out:[{Name:"qList"}]},GetLibraryContent:{In:[{Name:"qName",DefaultValue:""}],Out:[{Name:"qList"}]},DoReloadEx:{In:[{Name:"qParams",DefaultValue:{qMode:0,qPartial:!1,qDebug:!1},Optional:!0}],Out:[{Name:"qResult"}]},BackCount:{In:[],Out:[]},ForwardCount:{In:[],Out:[]},SetScript:{In:[{Name:"qScript",DefaultValue:""}],Out:[]},CheckScriptSyntax:{In:[],Out:[{Name:"qErrors"}]},GetFavoriteVariables:{In:[],Out:[{Name:"qNames"}]},SetFavoriteVariables:{In:[{Name:"qNames",DefaultValue:[""]}],Out:[]},GetIncludeFileContent:{In:[{Name:"qPath",DefaultValue:""}],Out:[{Name:"qContent"}]},CreateConnection:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[{Name:"qConnectionId"}]},ModifyConnection:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}},{Name:"qOverrideCredentials",DefaultValue:!1,Optional:!0}],Out:[]},DeleteConnection:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[]},GetConnection:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qConnection"}]},GetConnections:{In:[],Out:[{Name:"qConnections"}]},GetDatabaseInfo:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qInfo"}]},GetDatabases:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qDatabases"}]},GetDatabaseOwners:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0}],Out:[{Name:"qOwners"}]},GetDatabaseTables:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0}],Out:[{Name:"qTables"}]},GetDatabaseTableFields:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qFields"}]},GetDatabaseTablePreview:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qPreview"}]},GetFolderItemsForConnection:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0}],Out:[{Name:"qFolderItems"}]},GuessFileType:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0}],Out:[{Name:"qDataFormat"}]},GetFileTables:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}}],Out:[{Name:"qTables"}]},GetFileTableFields:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qFields"},{Name:"qFormatSpec"}]},GetFileTablePreview:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qPreview"},{Name:"qFormatSpec"}]},GetFileTablesEx:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}}],Out:[{Name:"qTables"}]},SendGenericCommandToCustomConnector:{In:[{Name:"qProvider",DefaultValue:""},{Name:"qCommand",DefaultValue:""},{Name:"qMethod",DefaultValue:""},{Name:"qParameters",DefaultValue:[""]},{Name:"qAppendConnection",DefaultValue:""}],Out:[{Name:"qResult"}]}},Global:{AbortRequest:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[]},AbortAll:{In:[],Out:[]},GetProgress:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[{Name:"qProgressData"}]},QvVersion:{In:[],Out:[]},OSVersion:{In:[],Out:[]},OSName:{In:[],Out:[]},QTProduct:{In:[],Out:[]},GetDocList:{In:[],Out:[{Name:"qDocList"}]},GetInteract:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[{Name:"qDef"}]},InteractDone:{In:[{Name:"qRequestId",DefaultValue:0},{Name:"qDef",DefaultValue:{qType:0,qTitle:"",qMsg:"",qButtons:0,qLine:"",qOldLineNr:0,qNewLineNr:0,qPath:"",qHidden:!1,qResult:0,qInput:""}}],Out:[]},GetAuthenticatedUser:{In:[],Out:[]},GetStreamList:{In:[],Out:[{Name:"qStreamList"}]},CreateDocEx:{In:[{Name:"qDocName",DefaultValue:""},{Name:"qUserName",DefaultValue:"",Optional:!0},{Name:"qPassword",DefaultValue:"",Optional:!0},{Name:"qSerial",DefaultValue:"",Optional:!0},{Name:"qLocalizedScriptMainSection",DefaultValue:"",Optional:!0}],Out:[{Name:"qDocId"}]},GetActiveDoc:{In:[],Out:[]},AllowCreateApp:{In:[],Out:[]},CreateApp:{In:[{Name:"qAppName",DefaultValue:""},{Name:"qLocalizedScriptMainSection",DefaultValue:"",Optional:!0}],Out:[{Name:"qSuccess"},{Name:"qAppId"}]},DeleteApp:{In:[{Name:"qAppId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},IsDesktopMode:{In:[],Out:[]},GetConfiguration:{In:[],Out:[{Name:"qConfig"}]},CancelRequest:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[]},GetInternalTest:{In:[{Name:"qKey",DefaultValue:""}],Out:[]},ShutdownProcess:{In:[],Out:[]},ReloadExtensionList:{In:[],Out:[]},ReplaceAppFromID:{In:[{Name:"qTargetAppId",DefaultValue:""},{Name:"qSrcAppID",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},CopyApp:{In:[{Name:"qTargetAppId",DefaultValue:""},{Name:"qSrcAppId",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},ImportApp:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qSrcPath",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},ImportAppEx:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qSrcPath",DefaultValue:""},{Name:"qIds",DefaultValue:[""]},{Name:"qExcludeConnections",DefaultValue:!1}],Out:[]},ExportApp:{In:[{Name:"qTargetPath",DefaultValue:""},{Name:"qSrcAppId",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},PublishApp:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qStreamId",DefaultValue:""},{Name:"qCopy",DefaultValue:!1},{Name:"qReplaceId",DefaultValue:"",Optional:!0}],Out:[{Name:"qSuccess"}]},IsPersonalMode:{In:[],Out:[]},GetUniqueID:{In:[],Out:[{Name:"qUniqueID"}]},OpenDoc:{In:[{Name:"qDocName",DefaultValue:""},{Name:"qUserName",DefaultValue:"",Optional:!0},{Name:"qPassword",DefaultValue:"",Optional:!0},{Name:"qSerial",DefaultValue:"",Optional:!0},{Name:"qNoData",DefaultValue:!1,Optional:!0}],Out:[]},CreateSessionApp:{In:[],Out:[{Name:"qSessionAppId"}]},CreateSessionAppFromApp:{In:[{Name:"qSrcAppId",DefaultValue:""}],Out:[{Name:"qSessionAppId"}]},ProductVersion:{In:[],Out:[]},GetAppEntry:{In:[{Name:"qAppID",DefaultValue:""}],Out:[{Name:"qEntry"}]},ConfigureReload:{In:[{Name:"qCancelOnScriptError",DefaultValue:!1},{Name:"qUseErrorData",DefaultValue:!1},{Name:"qInteractOnError",DefaultValue:!1}],Out:[]},CancelReload:{In:[],Out:[]},GetBNF:{In:[{Name:"qBnfType",DefaultValue:0}],Out:[{Name:"qBnfDefs"}]},GetFunctions:{In:[{Name:"qGroup",DefaultValue:0,Optional:!0}],Out:[{Name:"qFunctions"}]},GetOdbcDsns:{In:[],Out:[{Name:"qOdbcDsns"}]},GetOleDbProviders:{In:[],Out:[{Name:"qOleDbProviders"}]},GetDatabasesFromConnectionString:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[{Name:"qDatabases"}]},IsValidConnectionString:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[]},GetDefaultAppFolder:{In:[],Out:[{Name:"qPath"}]},GetMyDocumentsFolder:{In:[],Out:[{Name:"qFolder"}]},GetLogicalDriveStrings:{In:[],Out:[{Name:"qDrives"}]},GetFolderItemsForPath:{In:[{Name:"qPath",DefaultValue:""}],Out:[{Name:"qFolderItems"}]},GetSupportedCodePages:{In:[],Out:[{Name:"qCodePages"}]},GetCustomConnectors:{In:[{Name:"qReloadList",DefaultValue:!1,Optional:!0}],Out:[{Name:"qConnectors"}]}}};return definition}),define("core.models/engine",["client.models/rpc-session","autogenerated/qix/engine-api-def","core.utils/deferred"],function(RPCSession,engineApiDef,Deferred){"use strict";function addOpenDoc(name,doc){engineModule.openApps[name]=doc}function SessionWrapper(session){this._session=session}function createSession(self,appId,rpcOptions){var rpcSession=RPCSession.get(appId,rpcOptions);return rpcSession.Close.bind(function(){delete self._session,delete engineModule.openApps[appId]}),rpcSession.open(),new SessionWrapper(rpcSession)}function javascriptifyName(name){return name.substring(0,1).toLowerCase()+name.substring(1)}function createType(typeName,typeDef){var EngineProxy=function(result,session){this._cache={},this._handle=!!result&&!!result.qReturn&&result.qReturn.qHandle,this._session=session,this.__engineTypeName=typeName};for(var methodName in typeDef){var methodDef=typeDef[methodName];EngineProxy.prototype[javascriptifyName(methodName)]=createMethod(methodName,methodDef)}return function(result,session){return new EngineProxy(result,session)}}function obtainSession(self,methodName,appId){var sessionToUse;return self._session?sessionToUse="OpenDoc"!==methodName&&"OpenApp"!==methodName||!self._session.isAssignToApp()&&appId===self._session.getAppName()?self._session:createSession(self,appId,self._rpcOptions):(self._session=createSession(self,appId,self._rpcOptions),sessionToUse=self._session),sessionToUse}function singleObjectMatchesMethodArgs(object,signatureParameters){var sentParametersNames=Object.keys(object),methodParametersNames=signatureParameters.In.map(function(param){return param.Name});return 0!==sentParametersNames.filter(function(v,i){return v===methodParametersNames[i]}).length}function createMethod(methodName,methodDef){var methodFunction=function(){var self=this,params=Array.prototype.slice.apply(arguments);1===params.length&&"object"==typeof params[0]&&singleObjectMatchesMethodArgs(params[0],methodDef)&&(params=params[0]);var sessionToUse;"OpenDoc"===methodName||"OpenApp"===methodName?(sessionToUse=obtainSession(self,methodName,params[0]),delete self._rpcOptions):!self._session&&"Global"===self.__engineTypeName&&Object.keys(engineModule.openApps).length?(self._session=Object.keys(engineModule.openApps).map(function(key){return engineModule.openApps[key]._session})[0],sessionToUse=self._session):sessionToUse=obtainSession(self,methodName);var dataToSend={method:methodName,params:params,handle:this._handle||-1},promise=sessionToUse.rpc(dataToSend).then(function(result){var wrappedResult;if(result){if(result.qReturn&&result.qReturn.qHandle&&result.qReturn.qType){var createEngineProxy=engineObjectTypes[result.qReturn.qType];wrappedResult=createEngineProxy(result,sessionToUse)}else if(result.hasOwnProperty("qResult"))wrappedResult=result.qResult,self["current"+methodName]=result.qResult;else if(result.hasOwnProperty("qReturn")&&1===Object.keys(result).length)wrappedResult=result.qReturn,self["current"+methodName]=result.qReturn;else{for(var resultName in result)result.hasOwnProperty(resultName)&&(self[resultName]=result[resultName]);wrappedResult=result}return("OpenDoc"===methodName||"OpenApp"===methodName)&&(sessionToUse._session.connectedAppHandle=result.qReturn.qHandle,wrappedResult.name=params[0],wrappedResult.selectAsCurrentApp=function(){engineModule.currentApp=wrappedResult},addOpenDoc(params[0],wrappedResult)),wrappedResult&&"object"==typeof wrappedResult&&(wrappedResult.__protocolRequestId=dataToSend.id),wrappedResult}return void 0},function(error){return Deferred.reject(error.error)});return promise.__protocolRequestId=dataToSend.id,promise};return methodFunction}function createApi(){var _engineObjectTypes={};for(var rootTypeName in engineApiDef){var rootTypeDef=engineApiDef[rootTypeName];_engineObjectTypes[rootTypeName]=createType(rootTypeName,rootTypeDef)}return _engineObjectTypes}var engineObjectTypes={},engineModule={global:void 0,openApps:{},currentApp:void 0};return SessionWrapper.prototype.rpc=function(obj){return this._session.rpc(obj).then(function(payload){return payload.result})},SessionWrapper.prototype.getAppName=function(){return this._session.options.appName},SessionWrapper.prototype.isAssignToApp=function(){return!!this.appName},engineObjectTypes=createApi(),engineModule.global=engineObjectTypes.Global(),engineModule.types=engineObjectTypes,engineModule.getCurrentApp=function(){return engineModule.currentApp},engineModule.openApp=function(appId,rpcOptions){var global=engineModule.global,noData=rpcOptions&&rpcOptions.openWithoutData?rpcOptions.openWithoutData:!1;return global._rpcOptions=rpcOptions,global._session&&(global._session=new SessionWrapper(RPCSession.get(appId,rpcOptions))),global.openDoc(appId,"","","",noData)},"undefined"!=typeof window&&(window.engineModuleGlobal=engineModule),engineModule}),define("core.models/app",["core.models/rpc-base","client.models/rpc-session","core.models/engine","core.utils/deferred","util","qvangular","client.controllers/error-handler-controller","autogenerated/qix/engine-enums"],function(RPCBase,RPCSession,Engine,Deferred,Util,qvangular,ErrorHandler,enums){"use strict";function connectionLostError(){qvangular.getService("$timeout")(function(){ErrorHandler.showDialog({code:enums.NxLocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST})},1e3)}var App,_current,_cache={};return App=RPCBase.extend("App",{init:function(appName,rpcOptions,keepCurrent){var that=this;keepCurrent&&_current||(_current=that);var session=RPCSession.get(appName,rpcOptions);if(session.Close.bind(connectionLostError),session.modelCache[appName]=Deferred.resolve(that),that.waitForOpen=new Deferred,that.rpcOptions=rpcOptions,that._super({id:appName,session:session,checkCreate:!0}),that.session.connectedAppHandle)that.handle=that.session.connectedAppHandle,that.bindToRPC(),that.waitForOpen.resolve(that);else try{that.session.open(),that.open().then(function(){that.waitForOpen.resolve(that)},function(e){that.waitForOpen.reject({error:e})})}catch(error){that.waitForOpen.reject({isHandled:!1,error:error})}that.session.currentApp=that},open:function(){function getDataFromEngineApp(engineApp){engineApp.selectAsCurrentApp(),that.session.connectedAppHandle=that.handle=engineApp._handle,that.engineApp=engineApp,that.bindToRPC()}var that=this;return that.rpcOptions||(that.rpcOptions={}),that.session.Error.bind(function(err){window.console.log("Error from Engine:",err)}),that.rpcOptions||(that.rpcOptions={}),"true"===Util.getParameterByName("noData")&&(that.rpcOptions.openWithoutData=!0),Engine.openApp(that.id,that.rpcOptions).then(getDataFromEngineApp)},close:function(fromEngine){return fromEngine?ErrorHandler.showDialog({message:"ErrorDialog.AppClosed"}):this.session.Close.unbind(connectionLostError),this.session.close(),this._super()},createSessionObject:function(data){return this.rpc("CreateSessionObject","qReturn",[data])},createSessionVariable:function(data){return this.rpc("CreateSessionVariable","qReturn",[data])},doSave:function(){return this.rpc("DoSave",null)},getLayout:function(){return this._super("GetAppLayout")},getProperties:function(){return this._super("GetAppProperties")},setProperties:function(props){return this._super(props,"SetAppProperties")},checkExpression:function(expr,labels){var params=[expr];return labels&&params.push(labels),this.rpc("CheckExpression",null,params)},checkNumberOrExpression:function(expr){return this.rpc("CheckNumberOrExpression",null,[expr])},evaluateExpression:function(expr){return this.rpc("Evaluate","qReturn",[expr])},getConfiguration:function(){return this.session.rpc({method:"GetConfiguration",handle:-1,params:[]}).then(function(data){return data.result.qConfig})},getVersion:function(){return this.session.rpc({method:"QvVersion",handle:-1,params:[]}).then(function(data){return data.result.qReturn})},getListOfFunctions:function(){return this.session.rpc({method:"GetFunctions",handle:-1,params:[]}).then(function(data){return data.result.qFunctions})},getLocaleInfo:function(){return this.rpc("GetLocaleInfo","qReturn")},getExpressions:function(){return this.rpc("GetExpressions","qExpressions")},getStreams:function(){var that=this;return that.streamsList?Deferred.resolve(that.streamsList):this.session.rpc({method:"GetStreamList",handle:-1,params:[]}).then(function(res){return that.streamsList=res.result.qStreamList,that.streamsList})},getPublishableStreams:function(){var layout=this.getLayout(),streams=this.getStreams(),dfd=new Deferred;return Deferred.all({layout:layout,streams:streams}).then(function(res){var streams=res.streams.filter(function(stream){return res.layout.stream?stream.qId===res.layout.stream.id&&-1!==stream.privileges.indexOf("publish"):-1!==stream.privileges.indexOf("publish")});dfd.resolve(streams)}),dfd.promise},getMatchingFields:function(tags){return this.rpc("GetMatchingFields",null,[tags])},getContentLibraries:function(){return this.rpc("GetContentLibraries").then(function(list){return list.qList.qItems})},getLibraryContent:function(libraryId){return this.rpc("GetLibraryContent",null,[libraryId]).then(function(list){return list.qList.qItems})},getMediaList:function(){return this.rpc("GetMediaList").then(function(list){return list.qList.qItems})},findMatchingFields:function(fieldName,tags){return this.rpc("FindMatchingFields",null,[fieldName,tags])},abortModal:function(accept){return accept=void 0!==accept?accept:!0,this.setModal(null),this.rpc("AbortModal",null,[accept])},switchModal:function(object,path,accept){var pathArray,that=this;return object=object||null,path=path||"",pathArray=Array.isArray(path)?path:[path],accept=void 0!==accept?accept:!0,that.modalObject&&!that.modalObject.isClosed&&that.modalObject.rpc("EndSelections",null,[accept]),object&&!object.isClosed?(that.modalObject=object,object.rpc("BeginSelections",null,[pathArray])):(that.setModal(null),Deferred.resolve())},setModal:function(obj){this.modalObject=obj},isModal:function(){return null!=this.modalObject},publish:function(streamId){return this.rpc("Publish",null,[streamId])}}),Object.defineProperty(App,"current",{get:function(){return _current}}),App.makeCacheId=function(appName,opts){var id=appName.toLowerCase();return opts&&(id+=opts.host?"/"+opts.host:"/",id+=opts.identity?"/"+opts.identity:"/",id+=opts.openWithoutData?"/openWithoutData":"/"),id},App.get=function(appName,opts,keepCurrent){var app=App.getSync(appName,opts,keepCurrent);return app.waitForOpen.promise},App.getSync=function(appName,opts,keepCurrent){appName=appName||Util.getParameterByName("app")||"?transient=","undefined"==typeof opts&&(opts={}),"string"!=typeof opts.host&&(opts.host=Util.hostname),"string"!=typeof opts.port&&(opts.port=Util.port),"string"!=typeof opts.prefix&&(opts.prefix=Util.basePath),"boolean"!=typeof opts.isSecure&&(opts.isSecure=Util.isSecure),"string"!=typeof opts.reloadURI&&(opts.reloadURI=Util.reloadURI);var cacheId=App.makeCacheId(appName,opts),app=_cache[cacheId]=_cache[cacheId]||new App(appName,opts,keepCurrent);return app},App.create=function(appId,session){return session.rpc({method:"CreateApp",handle:-1,params:[appId]}).then(function(data){return data.result})},App.remove=function(appId,session){return session.rpc({method:"DeleteApp",handle:-1,params:[appId]}).then(function(data){return data.result})},App.getList=function(session){return session.rpc({method:"GetDocList",handle:-1,params:[]}).then(function(data){return data.result.qDocList})},App}),define("assets/hub/hub-hack",[],function(){function timeFetchApps(callback,scope,reActivate){clearTimeout(timerIdApps),reActivate&&callback(scope),timerIdApps=setTimeout(function(){callback(scope),timeFetchApps(callback,scope)},time)}function stopTimers(){clearTimeout(timerIdApps)}var timerIdApps,time=3e4;return{timeFetchApps:timeFetchApps,stop:stopTimers}}),define("assets/hub/common/hub-session",["client.models/rpc-session","util"],function(RPCSession,Util){function getQRSSession(){return _qrsSession&&_qrsSession.socket||(_qrsSession=RPCSession.get(null,{route:"hub/qrsData",host:Util.hostname,port:Util.port,isSecure:Util.isSecure,reloadURI:Util.reloadURI,prefix:Util.basePath}),_qrsSession.open()),_qrsSession}function getEngineSession(){return _engineSession&&_engineSession.socket||(_engineSession=RPCSession.get(null,{route:"app/engineData",host:Util.hostname,port:Util.port,isSecure:Util.isSecure,reloadURI:Util.reloadURI,prefix:Util.basePath}),_engineSession.open()),_engineSession}var _engineSession,_qrsSession;return{getQRSSession:getQRSSession,getEngineSession:getEngineSession}}),define("core.utils/help-url",["core.utils/external-urls"],function(externalUrls){function adaptUrl(){var part=location.pathname.split("/").slice(-2,-1)[0];location.pathname.toLowerCase().indexOf("/workbench/")>-1?part="workbench":location.pathname.toLowerCase().indexOf("/dev-hub/")>-1?part="dev-hub":"qmc"!==part.toLowerCase()&&(part="client"),baseUrl+=part+"/"}var HelpUrl={},baseUrl=externalUrls.serverHelpBaseUrl;return HelpUrl.setBaseUrl=function(isPersonalMode){baseUrl=isPersonalMode?externalUrls.personalHelpBaseUrl:externalUrls.serverHelpBaseUrl,adaptUrl()},Object.defineProperty(HelpUrl,"path",{get:function(){return baseUrl}}),adaptUrl(),HelpUrl}),define("text!general.services/expandable/expandable.ng.html",[],function(){return'<div class="arrowtip-up" ng-style="{left: indexes.arrowLeftPos}">\r\n	<div class="inner-arrow" />\r\n</div>'}),define("client.views/app-overview/ao-hub-gestures",["touche","jquery","general.utils/support","angular"],function(Touche,$,support){"use strict";function isClickOnScrollbar(e,scrollSelector){var targetDivRight,target=$(e.target),clickTarget=e.clientX;return target.is(scrollSelector)?(targetDivRight=target.offset().left+$(e.target).width(),clickTarget>targetDivRight-15):!1}var myEvent={clientX:0,clientY:0,target:null,isSwipeing:!1};return{setup:function($element,elemInScrollSelector){var self=this;self.timer=null,self.$elm=$element,self.$divParrent=$(),myEvent.isTouchDevice=!support.treatAsDesktop(),myEvent.target=self.$elm[0],Touche(self.$elm[0]).tap({id:".ao-hub-gestures",options:{preventDefault:!1},start:function(e){myEvent.target=e.target,myEvent.clientX=e.pageX,myEvent.clientY=e.pageY,myEvent.isSwipeing=!1,elemInScrollSelector&&(self.$divParrent=self.$elm.find(elemInScrollSelector),self.$divParrent.each(function(){var t=$(this);t.css("min-height",t.height())}))},end:function(){elemInScrollSelector&&self.removeUlHeights()},cancel:function(){elemInScrollSelector&&self.removeUlHeights()}}),myEvent.isTouchDevice&&Touche(self.$elm[0]).swipe({id:".ao-hub-gestures",options:{preventDefault:!1},start:function(){clearTimeout(self.timer),myEvent.isSwipeing=!0},end:function(){self.timer=setTimeout(function(){myEvent.isSwipeing=!1},100),elemInScrollSelector&&self.removeUlHeights()}})},destroy:function(){var self=this;Touche(self.$elm[0]).off("*",".ao-hub-gestures"),self.$elm=null,self.$divParrent=null,self.timer=null,myEvent=null,myEvent={clientX:0,clientY:0,target:null,isSwipeing:!1,isTouchDevice:!1}},isClickOnScrollbar:function(scrollSelector){return isClickOnScrollbar(myEvent,scrollSelector)},event:myEvent,removeUlHeights:function(){var self=this;self.$divParrent&&self.$divParrent.length&&(self.$divParrent.css("min-height",""),self.$divParrent.each(function(){var t=$(this);t.css("min-height","")}))}}}),define("core.models/base-object",["core.models/rpc-base","core.models/app","core.utils/deferred","core.utils/permissions","util"],function(RPCBase,App,Deferred,Permissions,util){"use strict";function createListModel(ctor,props){var listDfd,List,name=ctor.name+"List",listDef=Object.keys(props).filter(function(key){return key.indexOf("ListDef")>-1?key:void 0})[0].replace(/Def$/g,"");if(!listDef)throw new Error("BaseObject: Tried to create a model without a ListDef in properties");List=RPCBase.extend(name,{strippedLayout:{},getLayout:function(){var that=this;return this._super().then(function(layout){return that.strippedLayout=layout[listDef].qItems,that.strippedLayout.forEach(function(item){"object"==typeof item&&Permissions.mapToLayout(item)}),that.strippedLayout})}}),props.qInfo={qId:name,qType:name},ctor.getList=function(app){return app=app||App.current,listDfd?listDfd:listDfd=app.createSessionObject(props).then(function(result){return new List({id:name,handle:result.qHandle,session:app.session})})},ctor.getListLayout=function(app){return this.getList(app).then(function(model){return model.getLayout()})}}var BaseObject;return BaseObject=RPCBase.extend("BaseObject",{getInfo:function(){return this.rpc("GetInfo","qInfo");
},clone:function(method,app){var that=this;return app=app||App.current,app.rpc(method||"CloneObject","qCloneId",[that.id]).then(function(id){return that.constructor.get(id)})}}),BaseObject.get=function(id,app){function getHandle(){return app.rpc("GetObject","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},BaseObject.create=function(props,method,parent){var Model=this;return props.qInfo=props.qInfo||{},props.qInfo.qId=props.qInfo.qId||util.generateId(),props.qInfo.qType=props.qInfo.qType||this.name.toLowerCase(),method=method||"CreateObject",parent=parent||App.current,parent.rpc(method,null,[props]).then(function(result){return Model.getModel(result.qInfo&&result.qInfo.qId||props.qInfo.qId,parent.session,function(){return Deferred.resolve(result.qReturn)})})},BaseObject.remove=function(id,method,parent,propForThis){var params=[id];return propForThis&&params.push(propForThis),parent=parent||App.current,method=method||"DestroyObject",parent.rpc(method,"qReturn",params)},BaseObject.States=RPCBase.States,BaseObject.extend=function(name,proto,opts){var ctor=RPCBase.extend.call(this,name,proto);return ctor.extend=BaseObject.extend,ctor.get=BaseObject.get,ctor.create=BaseObject.create,ctor.remove=BaseObject.remove,ctor.States=BaseObject.States,opts&&opts.listProperties&&createListModel(ctor,opts.listProperties),ctor},BaseObject}),define("general.models/media-library",["core.models/base-object","util"],function(BaseObject,util){"use strict";function createDirectoryEntry(name,type,paths){var entry={name:name,type:type};return paths&&(entry.path=paths.qUrl,entry.pathDef=paths.qUrlDef),"folder"===type&&(entry.children=[]),entry}function getDirectoryEntry(path,root){path=path.substring(1).split("/").reverse().slice(1).reverse();var parent=root;return path.forEach(function(part){var found=!1;if(parent.children.forEach(function(child){return child.name===part?(parent=child,void(found=!0)):void 0}),!found){var child=createDirectoryEntry(part,"folder");parent.children.push(child),parent=child}}),parent}function sortTree(children){children.sort(function(a,b){return a.name.localeCompare(b.name)}).reverse(),children.sort(function(a,b){return"folder"===a.type&&"folder"!==b.type?-1:"folder"===a.type&&"folder"===b.type?a.name.localeCompare(b.name):"folder"!==a.type&&"folder"!==b.type?a.name.localeCompare(b.name):1}),children.forEach(function(child){"undefined"!=typeof child.children&&sortTree(child.children)})}var MediaLibrary;return MediaLibrary=BaseObject.extend("MediaLibrary",{},{listProperties:{qMediaListDef:{}}}),MediaLibrary.addBasePath=function(path){return util.baseURI+".."+path},MediaLibrary.stripBasePath=function(path){return path=path.replace(util.baseURI,"").replace(/^\.\.\//i,"/"),path=path.replace(location.protocol+"//"+location.host,"")},MediaLibrary.createTree=function(files,fileTypes,flat){fileTypes=(fileTypes||[]).join("|")||".+?";var root=createDirectoryEntry("/","folder"),fileTypeRegex=new RegExp("\\.("+fileTypes+")$","i");return files.forEach(function(obj){var name,paths=obj,path=paths.qUrl;if(path=MediaLibrary.stripBasePath(path),name=decodeURIComponent((path+"").replace(/\+/g,"%20")),name=name.split("/").splice(-1)[0],name.match(fileTypeRegex)){var pathName,parent=root;flat||(pathName=decodeURIComponent(path).replace(/^(\/content\/default)|(\/content\/Default)/,"").replace(/^(^\/media\/([a-z0-9-])+\/([a-z0-9-])+\/)/,"/media/"),parent=getDirectoryEntry(pathName,root)),parent.children.push(createDirectoryEntry(name,"file",paths))}}),sortTree(root.children),root},MediaLibrary.filterList=function(listItem){var i,itm,filtered=[],sortedList=listItem.sort(function(a,b){var aName=a.qName.toLowerCase(),bName=b.qName.toLowerCase();return aName.localeCompare(bName)});for(i=0;i<listItem.length;i++)if(itm=listItem[i],itm.qAppSpecific){filtered.push(itm),itm.qMeta&&-1!==itm.qMeta.privileges.indexOf("update")&&(MediaLibrary.canUpdate=!0);break}for(i=0;i<sortedList.length;i++)itm=listItem[i],itm.qAppSpecific||filtered.push(itm);return filtered},MediaLibrary.getRemainingSpace=function(listItem){for(var remainingSpace=0,i=0;i<listItem.length;i++)if(listItem[i].qAppSpecific){remainingSpace=parseInt(listItem[i].qMeta.remainingLibrarySpace||0,10);break}return remainingSpace},MediaLibrary}),define("text!general.components/media-library/media-library.ng.html",[],function(){return'<qv-modal-dialog qv-id="media-library-modal" tid="media-library" qv-cancel="cancel()" qv-confirm="confirm()" qva-stop-prop>\r\n	<header class="dm-head">\r\n		<span class="dm-title" q-translation="MediaLibrary.Header"></span>\r\n	</header>\r\n	<main class="dm-main medialib">\r\n		<div class="q-section-list" ng-if="lists.length">\r\n			<ul class="qui-menu" tid="menu-list">\r\n				<li ng-repeat="list in lists track by list.qName"\r\n					ng-class="{\'qui-menu-item\': true, \'selected\': !isUpload && view === list.qName}"\r\n					qva-activate="goTo(list.qName, false)">\r\n					<span ng-if="list.qAppSpecific" q-translation="MediaLibrary.InApp" tid="goto-inapp"></span>\r\n					<span ng-if="!list.qAppSpecific" tid="goto-library">{{ list.qName }}</span>\r\n				</li>\r\n			</ul>\r\n			<div class="q-section-upload qui-menu-item"\r\n				ng-if="canUpdate"\r\n				ng-class="{\'selected\': isUpload}"\r\n				tid="goto-upload"\r\n				qva-activate="goTo(\'\', true)"\r\n				q-translation="MediaLibrary.UploadMedia">\r\n			</div>\r\n		</div>\r\n		<div class="q-empty" ng-if="!hasFiles && !isUpload">\r\n			<p q-translation="MediaLibrary.NoFilesFound" class="nff"></p>\r\n		</div>\r\n		<qve-media-list ng-if="hasFiles && !isUpload" ng-class="{\'q-image-library\': !isUpload}" class="q-images-cont" tid="media-lib-items-list"></qve-media-list>\r\n		<div class="q-media-preview" ng-if="selectedFile && !isUpload">\r\n			<div class="q-media-preview-toolbar" ng-if="canDeleteInView()">\r\n				<qui-button-outline-round\r\n					tid="delete"\r\n					class-icon="icon-bin"\r\n					data-name="delete"\r\n					q-title-translation="Common.Delete"\r\n					qva-activate="onDelete($event)">\r\n				</qui-button-outline-round>\r\n			</div>\r\n			<div class="q-media-preview-img-wrapper">\r\n				<img ng-src="{{ getSrc(selectedFile) }}" class="q-media-img-list"/>\r\n			</div>\r\n		</div>\r\n		<div class="q-images-cont" ng-if="canUpdate" ng-show="isUpload">\r\n			<qv-media-update update-exp="updateExp" select-file="selectFile" selected-file="selectedFile"></qv-media-update>\r\n		</div>\r\n	</main>\r\n	<div class="q-media-zoomed" ng-if="inZoom" qva-stop-prop>\r\n		<div class="q-media-z-wrapper">\r\n			<div class="q-media-z-cont">\r\n				<img class="q-media-z-img" ng-src="{{ getSrc(zoomSrc) }}">\r\n			</div>\r\n\r\n			<div class="q-media-zoom-footer">\r\n				<qv-confirm-cancel-footer light qv-confirm="confirm()" qv-cancel="closeZoom()" qv-confirm-label="Common.Apply" qv-confirm-disabled="updateExp.isUploading"></qv-confirm-cancel-footer>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()"\r\n							  qv-cancel="cancel()"\r\n							  qv-cancel-disabled="updateExp.isUploading"\r\n							  qv-confirm-label="MediaLibrary.Insert"\r\n							  qv-confirm-disabled="!selectedFile || updateExp.isUploading">\r\n	</qv-confirm-cancel-footer>\r\n</qv-modal-dialog>'}),define("text!general.components/media-library/media-library-grid.ng.html",[],function(){return'<div>\r\n	<qv-bouncy-grid min-width="140" padding="15" selector=".q-media-grid" list-len="rootEntry.children.length">\r\n		<div ng-repeat="entry in rootEntry.children"\r\n			 title="{{entry.name}}"\r\n			 tid="media-item"\r\n			 ng-class="{\'q-media-grid\': true, \'selected-img\': isSelectedImg(entry, $last, \'.q-media-inuse\')}"\r\n			 qva-activate="selectFile($event, entry.path, entry.pathDef)">\r\n			<div class="q-media-wrap-img">\r\n				<img ng-src="{{staticSrc}}" class="q-media-img" width="100%" height="100%"/>\r\n\r\n				<div class="overlay"></div>\r\n				<div class="q-media-inuse" ng-if="input.selectedFile === entry.path">\r\n					<i class="icon-tick"></i>\r\n				</div>\r\n				<div class="q-media-buttons" ng-if="selectedFile === entry.path">\r\n					<qui-button-outline-round small\r\n											  tid="media-view"\r\n											  class-icon="icon-hub-view"\r\n											  data-name="view"\r\n											  q-title-translation="Common.View"\r\n											  qva-activate="zoomImage($event, entry)"\r\n							></qui-button-outline-round>\r\n				</div>\r\n			</div>\r\n			<div class="q-media-name">{{entry.name}}</div>\r\n		</div>\r\n	</qv-bouncy-grid>\r\n</div>'}),define("text!general.components/media-library/media-library-list.ng.html",[],function(){return'<div>\r\n	<!--\r\n		<img ng-src="{{staticSrc}}" class="q-media-img" width="100%" height="100%"/>\r\n	-->\r\n	<div class="q-media-list-cont" qva-context-menu="onContextMenu($event)">\r\n		<div ng-repeat="entry in rootEntry.children"\r\n			 ng-class="{\'qui-menu-item\': true, \'selected\': isSelectedImg(entry, $last, \'.selected\')}"\r\n			 tid="media-item" title="{{entry.name}}"\r\n			 qva-activate="selectFile($event, entry.path, entry.pathDef)">\r\n			<div class="list-name">{{entry.name}}</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("general.views/bouncy-grid/bouncy-grid",["jquery","qvangular","core.utils/resize"],function($,qvangular,Resize){function parse(string){return parseInt(string||0,10)}qvangular.directive("qvBouncyGrid",[function(){return{restrict:"E",template:'<div class="qv-bouncy" ng-transclude></div>',transclude:!0,replace:!0,scope:{minWidth:"@",maxWidth:"@",padding:"@",selector:"@",listLen:"="},controller:["$scope","$element",function($scope,$element){function timerReCalc(time){clearTimeout(attempsTimer),attempsTimer=setTimeout(calculateBouncyItemDimensions,time||50)}function calculateBouncyItemDimensions(){var width,itemPerRow,itemWidth,bouncyDimension,padding=parse($scope.padding);maxWidth?(width=maxWidth,itemPerRow=Math.ceil($element.width()/width),itemWidth=Math.floor($element.width()/itemPerRow),bouncyDimension=(itemPerRow>$scope.listLen?width:itemWidth)-padding+"px!important;"):(width=minWidth,itemPerRow=Math.floor($element.width()/width),itemWidth=Math.ceil($element.width()/itemPerRow),bouncyDimension=(itemPerRow>$scope.listLen?width:itemWidth)-padding+"px!important;"),isNaN(itemWidth-padding)&&20>attemps?(attemps++,timerReCalc()):style&&style.length&&style.text($scope.selector+" { width: "+bouncyDimension+"height: "+bouncyDimension+"}")}var attempsTimer,style=$("<style></style>").appendTo("body"),attemps=0,minWidth=parse($scope.minWidth),maxWidth=parse($scope.maxWidth);Resize.on("end",timerReCalc),timerReCalc(0),$scope.$watch("listLen",timerReCalc),$scope.$on("$destroy",function(){clearTimeout(attempsTimer),style&&style.remove(),attempsTimer=null,style=null,Resize.off("end",timerReCalc)})}]}}])}),define("text!general.components/media-library/update/media-update.ng.html",[],function(){return'<div id="media-library-upload">\r\n	<div class="bouncy-wrap" ng-class="{\'empty\' : isEmpty}">\r\n		<qv-bouncy-grid min-width="140" padding="15" selector=".preview-media-grid" list-len="previewCounter">\r\n			<div class="media-library-preview-container" ng-hide="isEmpty"></div>\r\n		</qv-bouncy-grid>\r\n	</div>\r\n	<div id="media-library-dropzone" class="dropzone" ng-class="{\'empty\' : isEmpty}">\r\n		<div class="dz-message">\r\n			<div class="upload-drop-text" q-translation="MediaLibrary.ClickOrDropHere"></div>\r\n			<div class="upload-drop-icon" data-icon="upload"></div>\r\n			<div class="upload-drop-quota">{{quotaInfo}}</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("text!general.components/media-library/update/preview-item.ng.html",[],function(){return'<div tid="preview-item" class="q-media-grid preview-media-grid" ng-class="{\'selected-img\': selectedFile === file.qUrl}" qva-activate="onSelectImage( $event, file )">\r\n	<div class="q-media-wrap-img">\r\n		<img class="q-media-img" width="100%" height="100%" data-dz-thumbnail />\r\n		<div class="overlay"></div>\r\n		<div class="preview-edit-area">\r\n			<div class="touch-area cancel-upload-area" q-title-translation="Common.Cancel" data-dz-remove qva-activate="onCancelUpload( $event, file )">\r\n				<button class="qui-btn-overlay-action-small cancel-upload" data-icon="abort"></button>\r\n			</div>\r\n			<div ng-if="selectedFile === file.qUrl" class="touch-area delete-image-area" q-title-translation="Common.Delete" qva-activate="onDelete( $event, file, file.name, file.qUrl )">\r\n				<button class="qui-btn-overlay-action-small delete-image" data-icon="bin"></button>\r\n			</div>\r\n		</div>\r\n		<div class="error-wrapper" ng-if="showError">\r\n			<div class="error-icon" data-icon="warning-triangle"></div>\r\n			<div class="error-text">{{errorMsg}}</div>\r\n		</div>\r\n		<div class="preview-progress">\r\n			<div class="preview-progressbar-wrapper">\r\n				<span class="preview-progressbar" data-dz-uploadprogress></span>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="q-media-name" q-title-translation="{{file.name}}">{{file.name}}</div>\r\n</div>'}),function(){"use strict";define("xsrfplugin",["jquery"],function($){function getRandomString(keyLength){var i,j,result="";for(i=0;keyLength>i;i++)j=Math.floor(62*Math.random()),result+=10>j?j:j>9&&36>j?String.fromCharCode(j+55):String.fromCharCode(j+61);return result}function setupXsrfPlugin(){var xsrfKey,oldajax;hasBeenSetup||(hasBeenSetup=!0,xsrfKey=getRandomString(16),oldajax=$.ajax,$.extend({ajax:function(o){if(o.headers||(o.headers={}),o.headers["X-Qlik-XrfKey"]=xsrfKey,"GET"===o.type)void 0===o.data&&(o.data={}),o.data.xrfkey=xsrfKey;else if(o.url){var separator=-1===o.url.indexOf("?")?"?":"&";o.url+=separator+"xrfkey="+xsrfKey}return oldajax.call(this,o)}}))}function resetHasBeenSetup(){hasBeenSetup=!1}var hasBeenSetup=!1;return{getRandomString:getRandomString,setupXsrfPlugin:setupXsrfPlugin,resetHasBeenSetup:resetHasBeenSetup}})}(),function(){var Dropzone,Emitter,camelize,contentLoaded,detectVerticalSquash,drawImageIOSFix,noop,without,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};noop=function(){},Emitter=function(){function Emitter(){}return Emitter.prototype.addEventListener=Emitter.prototype.on,Emitter.prototype.on=function(event,fn){return this._callbacks=this._callbacks||{},this._callbacks[event]||(this._callbacks[event]=[]),this._callbacks[event].push(fn),this},Emitter.prototype.emit=function(){var args,callback,callbacks,event,_i,_len;if(event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],this._callbacks=this._callbacks||{},callbacks=this._callbacks[event])for(_i=0,_len=callbacks.length;_len>_i;_i++)callback=callbacks[_i],callback.apply(this,args);return this},Emitter.prototype.removeListener=Emitter.prototype.off,Emitter.prototype.removeAllListeners=Emitter.prototype.off,Emitter.prototype.removeEventListener=Emitter.prototype.off,Emitter.prototype.off=function(event,fn){var callback,callbacks,i,_i,_len;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(callbacks=this._callbacks[event],!callbacks)return this;if(1===arguments.length)return delete this._callbacks[event],this;for(i=_i=0,_len=callbacks.length;_len>_i;i=++_i)if(callback=callbacks[i],callback===fn){callbacks.splice(i,1);break}return this},Emitter}(),Dropzone=function(_super){function Dropzone(element,options){var elementOptions,fallback,_ref;if(this.element=element,this.version=Dropzone.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(Dropzone.instances.push(this),this.element.dropzone=this,elementOptions=null!=(_ref=Dropzone.optionsForElement(this.element))?_ref:{},this.options=extend({},this.defaultOptions,elementOptions,null!=options?options:{}),this.options.forceFallback||!Dropzone.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(fallback=this.getExistingFallback())&&fallback.parentNode&&fallback.parentNode.removeChild(fallback),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=Dropzone.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=Dropzone.getElements(this.options.clickable,"clickable")),this.init()}var extend,resolveOption;return __extends(Dropzone,_super),Dropzone.prototype.Emitter=Emitter,Dropzone.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],Dropzone.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(file,done){return done()},init:function(){return noop},forceFallback:!1,fallback:function(){var child,messageElement,span,_i,_len,_ref;for(this.element.className=""+this.element.className+" dz-browser-not-supported",_ref=this.element.getElementsByTagName("div"),_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],/(^| )dz-message($| )/.test(child.className)&&(messageElement=child,child.className="dz-message");return messageElement||(messageElement=Dropzone.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(messageElement)),span=messageElement.getElementsByTagName("span")[0],span&&(span.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(file){var info,srcRatio,trgRatio;return info={srcX:0,srcY:0,srcWidth:file.width,srcHeight:file.height},srcRatio=file.width/file.height,info.optWidth=this.options.thumbnailWidth,info.optHeight=this.options.thumbnailHeight,null==info.optWidth&&null==info.optHeight?(info.optWidth=info.srcWidth,info.optHeight=info.srcHeight):null==info.optWidth?info.optWidth=srcRatio*info.optHeight:null==info.optHeight&&(info.optHeight=1/srcRatio*info.optWidth),trgRatio=info.optWidth/info.optHeight,file.height<info.optHeight||file.width<info.optWidth?(info.trgHeight=info.srcHeight,info.trgWidth=info.srcWidth):srcRatio>trgRatio?(info.srcHeight=file.height,info.srcWidth=info.srcHeight*trgRatio):(info.srcWidth=file.width,info.srcHeight=info.srcWidth/trgRatio),info.srcX=(file.width-info.srcWidth)/2,info.srcY=(file.height-info.srcHeight)/2,info},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:noop,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:noop,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(file){var node,removeFileEvent,removeLink,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2,_results;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(file.previewElement=Dropzone.createElement(this.options.previewTemplate.trim()),file.previewTemplate=file.previewElement,this.previewsContainer.appendChild(file.previewElement),_ref=file.previewElement.querySelectorAll("[data-dz-name]"),_i=0,_len=_ref.length;_len>_i;_i++)node=_ref[_i],node.textContent=file.name;for(_ref1=file.previewElement.querySelectorAll("[data-dz-size]"),_j=0,_len1=_ref1.length;_len1>_j;_j++)node=_ref1[_j],node.innerHTML=this.filesize(file.size);for(this.options.addRemoveLinks&&(file._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),file.previewElement.appendChild(file._removeLink)),removeFileEvent=function(_this){return function(e){return e.preventDefault(),e.stopPropagation(),file.status===Dropzone.UPLOADING?Dropzone.confirm(_this.options.dictCancelUploadConfirmation,function(){return _this.removeFile(file)}):_this.options.dictRemoveFileConfirmation?Dropzone.confirm(_this.options.dictRemoveFileConfirmation,function(){return _this.removeFile(file)}):_this.removeFile(file)}}(this),_ref2=file.previewElement.querySelectorAll("[data-dz-remove]"),_results=[],_k=0,_len2=_ref2.length;_len2>_k;_k++)removeLink=_ref2[_k],_results.push(removeLink.addEventListener("click",removeFileEvent));return _results}},removedfile:function(file){var _ref;return file.previewElement&&null!=(_ref=file.previewElement)&&_ref.parentNode.removeChild(file.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(file,dataUrl){var thumbnailElement,_i,_len,_ref;if(file.previewElement){for(file.previewElement.classList.remove("dz-file-preview"),_ref=file.previewElement.querySelectorAll("[data-dz-thumbnail]"),_i=0,_len=_ref.length;_len>_i;_i++)thumbnailElement=_ref[_i],thumbnailElement.alt=file.name,thumbnailElement.src=dataUrl;return setTimeout(function(_this){return function(){return file.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(file,message){var node,_i,_len,_ref,_results;if(file.previewElement){for(file.previewElement.classList.add("dz-error"),"String"!=typeof message&&message.error&&(message=message.error),_ref=file.previewElement.querySelectorAll("[data-dz-errormessage]"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)node=_ref[_i],_results.push(node.textContent=message);return _results}},errormultiple:noop,processing:function(file){return file.previewElement&&(file.previewElement.classList.add("dz-processing"),file._removeLink)?file._removeLink.textContent=this.options.dictCancelUpload:void 0},processingmultiple:noop,uploadprogress:function(file,progress,bytesSent){var node,_i,_len,_ref,_results;if(file.previewElement){for(_ref=file.previewElement.querySelectorAll("[data-dz-uploadprogress]"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)node=_ref[_i],"PROGRESS"===node.nodeName?_results.push(node.value=progress):_results.push(node.style.width=""+progress+"%");return _results}},totaluploadprogress:noop,sending:noop,sendingmultiple:noop,success:function(file){return file.previewElement?file.previewElement.classList.add("dz-success"):void 0},successmultiple:noop,canceled:function(file){return this.emit("error",file,"Upload canceled.")},canceledmultiple:noop,complete:function(file){return file._removeLink&&(file._removeLink.textContent=this.options.dictRemoveFile),file.previewElement?file.previewElement.classList.add("dz-complete"):void 0},completemultiple:noop,maxfilesexceeded:noop,maxfilesreached:noop,queuecomplete:noop,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},extend=function(){var key,object,objects,target,val,_i,_len;for(target=arguments[0],objects=2<=arguments.length?__slice.call(arguments,1):[],_i=0,_len=objects.length;_len>_i;_i++){object=objects[_i];for(key in object)val=object[key],target[key]=val}return target},Dropzone.prototype.getAcceptedFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.accepted&&_results.push(file);return _results},Dropzone.prototype.getRejectedFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.accepted||_results.push(file);return _results},Dropzone.prototype.getFilesWithStatus=function(status){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.status===status&&_results.push(file);return _results},Dropzone.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(Dropzone.QUEUED)},Dropzone.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(Dropzone.UPLOADING)},Dropzone.prototype.getActiveFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],(file.status===Dropzone.UPLOADING||file.status===Dropzone.QUEUED)&&_results.push(file);return _results},Dropzone.prototype.init=function(){var eventName,noPropagation,setupHiddenFileInput,_i,_len,_ref,_ref1;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(setupHiddenFileInput=function(_this){return function(){return _this.hiddenFileInput&&document.body.removeChild(_this.hiddenFileInput),_this.hiddenFileInput=document.createElement("input"),_this.hiddenFileInput.setAttribute("type","file"),(null==_this.options.maxFiles||_this.options.maxFiles>1)&&_this.hiddenFileInput.setAttribute("multiple","multiple"),_this.hiddenFileInput.className="dz-hidden-input",null!=_this.options.acceptedFiles&&_this.hiddenFileInput.setAttribute("accept",_this.options.acceptedFiles),null!=_this.options.capture&&_this.hiddenFileInput.setAttribute("capture",_this.options.capture),_this.hiddenFileInput.style.visibility="hidden",_this.hiddenFileInput.style.position="absolute",_this.hiddenFileInput.style.top="0",_this.hiddenFileInput.style.left="0",_this.hiddenFileInput.style.height="0",_this.hiddenFileInput.style.width="0",document.body.appendChild(_this.hiddenFileInput),_this.hiddenFileInput.addEventListener("change",function(){var file,files,_i,_len;if(files=_this.hiddenFileInput.files,files.length)for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],_this.addFile(file);return setupHiddenFileInput()})}}(this))(),this.URL=null!=(_ref=window.URL)?_ref:window.webkitURL,_ref1=this.events,_i=0,_len=_ref1.length;_len>_i;_i++)eventName=_ref1[_i],this.on(eventName,this.options[eventName]);return this.on("uploadprogress",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("canceled",function(_this){return function(file){return _this.emit("complete",file)}}(this)),this.on("complete",function(_this){return function(file){return 0===_this.getUploadingFiles().length&&0===_this.getQueuedFiles().length?setTimeout(function(){return _this.emit("queuecomplete")},0):void 0}}(this)),noPropagation=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(_this){return function(e){return _this.emit("dragstart",e)}}(this),dragenter:function(_this){return function(e){return noPropagation(e),_this.emit("dragenter",e)}}(this),dragover:function(_this){return function(e){var efct;
try{efct=e.dataTransfer.effectAllowed}catch(_error){}return e.dataTransfer.dropEffect="move"===efct||"linkMove"===efct?"move":"copy",noPropagation(e),_this.emit("dragover",e)}}(this),dragleave:function(_this){return function(e){return _this.emit("dragleave",e)}}(this),drop:function(_this){return function(e){return noPropagation(e),_this.drop(e)}}(this),dragend:function(_this){return function(e){return _this.emit("dragend",e)}}(this)}}],this.clickableElements.forEach(function(_this){return function(clickableElement){return _this.listeners.push({element:clickableElement,events:{click:function(evt){return clickableElement!==_this.element||evt.target===_this.element||Dropzone.elementInside(evt.target,_this.element.querySelector(".dz-message"))?_this.hiddenFileInput.click():void 0}}})}}(this)),this.enable(),this.options.init.call(this)},Dropzone.prototype.destroy=function(){var _ref;return this.disable(),this.removeAllFiles(!0),(null!=(_ref=this.hiddenFileInput)?_ref.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,Dropzone.instances.splice(Dropzone.instances.indexOf(this),1)},Dropzone.prototype.updateTotalUploadProgress=function(){var activeFiles,file,totalBytes,totalBytesSent,totalUploadProgress,_i,_len,_ref;if(totalBytesSent=0,totalBytes=0,activeFiles=this.getActiveFiles(),activeFiles.length){for(_ref=this.getActiveFiles(),_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],totalBytesSent+=file.upload.bytesSent,totalBytes+=file.upload.total;totalUploadProgress=100*totalBytesSent/totalBytes}else totalUploadProgress=100;return this.emit("totaluploadprogress",totalUploadProgress,totalBytes,totalBytesSent)},Dropzone.prototype._getParamName=function(n){return"function"==typeof this.options.paramName?this.options.paramName(n):""+this.options.paramName+(this.options.uploadMultiple?"["+n+"]":"")},Dropzone.prototype.getFallbackForm=function(){var existingFallback,fields,fieldsString,form;return(existingFallback=this.getExistingFallback())?existingFallback:(fieldsString='<div class="dz-fallback">',this.options.dictFallbackText&&(fieldsString+="<p>"+this.options.dictFallbackText+"</p>"),fieldsString+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',fields=Dropzone.createElement(fieldsString),"FORM"!==this.element.tagName?(form=Dropzone.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),form.appendChild(fields)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=form?form:fields)},Dropzone.prototype.getExistingFallback=function(){var fallback,getFallback,tagName,_i,_len,_ref;for(getFallback=function(elements){var el,_i,_len;for(_i=0,_len=elements.length;_len>_i;_i++)if(el=elements[_i],/(^| )fallback($| )/.test(el.className))return el},_ref=["div","form"],_i=0,_len=_ref.length;_len>_i;_i++)if(tagName=_ref[_i],fallback=getFallback(this.element.getElementsByTagName(tagName)))return fallback},Dropzone.prototype.setupEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;for(_ref=this.listeners,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)elementListeners=_ref[_i],_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events,_results1=[];for(event in _ref1)listener=_ref1[event],_results1.push(elementListeners.element.addEventListener(event,listener,!1));return _results1}());return _results},Dropzone.prototype.removeEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;for(_ref=this.listeners,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)elementListeners=_ref[_i],_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events,_results1=[];for(event in _ref1)listener=_ref1[event],_results1.push(elementListeners.element.removeEventListener(event,listener,!1));return _results1}());return _results},Dropzone.prototype.disable=function(){var file,_i,_len,_ref,_results;for(this.clickableElements.forEach(function(element){return element.classList.remove("dz-clickable")}),this.removeEventListeners(),_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],_results.push(this.cancelUpload(file));return _results},Dropzone.prototype.enable=function(){return this.clickableElements.forEach(function(element){return element.classList.add("dz-clickable")}),this.setupEventListeners()},Dropzone.prototype.filesize=function(size){var cutoff,i,selectedSize,selectedUnit,unit,units,_i,_len;for(units=["TB","GB","MB","KB","b"],selectedSize=selectedUnit=null,i=_i=0,_len=units.length;_len>_i;i=++_i)if(unit=units[i],cutoff=Math.pow(this.options.filesizeBase,4-i)/10,size>=cutoff){selectedSize=size/Math.pow(this.options.filesizeBase,4-i),selectedUnit=unit;break}return selectedSize=Math.round(10*selectedSize)/10,"<strong>"+selectedSize+"</strong> "+selectedUnit},Dropzone.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},Dropzone.prototype.drop=function(e){var files,items;e.dataTransfer&&(this.emit("drop",e),files=e.dataTransfer.files,files.length&&(items=e.dataTransfer.items,items&&items.length&&null!=items[0].webkitGetAsEntry?this._addFilesFromItems(items):this.handleFiles(files)))},Dropzone.prototype.paste=function(e){var items,_ref;if(null!=(null!=e&&null!=(_ref=e.clipboardData)?_ref.items:void 0))return this.emit("paste",e),items=e.clipboardData.items,items.length?this._addFilesFromItems(items):void 0},Dropzone.prototype.handleFiles=function(files){var file,_i,_len,_results;for(_results=[],_i=0,_len=files.length;_len>_i;_i++)file=files[_i],_results.push(this.addFile(file));return _results},Dropzone.prototype._addFilesFromItems=function(items){var entry,item,_i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],null!=item.webkitGetAsEntry&&(entry=item.webkitGetAsEntry())?entry.isFile?_results.push(this.addFile(item.getAsFile())):entry.isDirectory?_results.push(this._addFilesFromDirectory(entry,entry.name)):_results.push(void 0):null!=item.getAsFile&&(null==item.kind||"file"===item.kind)?_results.push(this.addFile(item.getAsFile())):_results.push(void 0);return _results},Dropzone.prototype._addFilesFromDirectory=function(directory,path){var dirReader,entriesReader;return dirReader=directory.createReader(),entriesReader=function(_this){return function(entries){var entry,_i,_len;for(_i=0,_len=entries.length;_len>_i;_i++)entry=entries[_i],entry.isFile?entry.file(function(file){return _this.options.ignoreHiddenFiles&&"."===file.name.substring(0,1)?void 0:(file.fullPath=""+path+"/"+file.name,_this.addFile(file))}):entry.isDirectory&&_this._addFilesFromDirectory(entry,""+path+"/"+entry.name)}}(this),dirReader.readEntries(entriesReader,function(error){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(error):void 0})},Dropzone.prototype.accept=function(file,done){return file.size>1024*this.options.maxFilesize*1024?done(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(file.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):Dropzone.isValidFile(file,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",file)):this.options.accept.call(this,file,done):done(this.options.dictInvalidFileType)},Dropzone.prototype.addFile=function(file){return file.upload={progress:0,total:file.size,bytesSent:0},this.files.push(file),file.status=Dropzone.ADDED,this.emit("addedfile",file),this._enqueueThumbnail(file),this.accept(file,function(_this){return function(error){return error?(file.accepted=!1,_this._errorProcessing([file],error)):(file.accepted=!0,_this.options.autoQueue&&_this.enqueueFile(file)),_this._updateMaxFilesReachedClass()}}(this))},Dropzone.prototype.enqueueFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],this.enqueueFile(file);return null},Dropzone.prototype.enqueueFile=function(file){if(file.status!==Dropzone.ADDED||file.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return file.status=Dropzone.QUEUED,this.options.autoProcessQueue?setTimeout(function(_this){return function(){return _this.processQueue()}}(this),0):void 0},Dropzone.prototype._thumbnailQueue=[],Dropzone.prototype._processingThumbnail=!1,Dropzone.prototype._enqueueThumbnail=function(file){return this.options.createImageThumbnails&&file.type.match(/image.*/)&&file.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(file),setTimeout(function(_this){return function(){return _this._processThumbnailQueue()}}(this),0)):void 0},Dropzone.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(_this){return function(){return _this._processingThumbnail=!1,_this._processThumbnailQueue()}}(this)))},Dropzone.prototype.removeFile=function(file){return file.status===Dropzone.UPLOADING&&this.cancelUpload(file),this.files=without(this.files,file),this.emit("removedfile",file),0===this.files.length?this.emit("reset"):void 0},Dropzone.prototype.removeAllFiles=function(cancelIfNecessary){var file,_i,_len,_ref;for(null==cancelIfNecessary&&(cancelIfNecessary=!1),_ref=this.files.slice(),_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],(file.status!==Dropzone.UPLOADING||cancelIfNecessary)&&this.removeFile(file);return null},Dropzone.prototype.createThumbnail=function(file,callback){var fileReader;return fileReader=new FileReader,fileReader.onload=function(_this){return function(){return"image/svg+xml"===file.type?(_this.emit("thumbnail",file,fileReader.result),void(null!=callback&&callback())):_this.createThumbnailFromUrl(file,fileReader.result,callback)}}(this),fileReader.readAsDataURL(file)},Dropzone.prototype.createThumbnailFromUrl=function(file,imageUrl,callback){var img;return img=document.createElement("img"),img.onload=function(_this){return function(){var canvas,ctx,resizeInfo,thumbnail,_ref,_ref1,_ref2,_ref3;return file.width=img.width,file.height=img.height,resizeInfo=_this.options.resize.call(_this,file),null==resizeInfo.trgWidth&&(resizeInfo.trgWidth=resizeInfo.optWidth),null==resizeInfo.trgHeight&&(resizeInfo.trgHeight=resizeInfo.optHeight),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),canvas.width=resizeInfo.trgWidth,canvas.height=resizeInfo.trgHeight,drawImageIOSFix(ctx,img,null!=(_ref=resizeInfo.srcX)?_ref:0,null!=(_ref1=resizeInfo.srcY)?_ref1:0,resizeInfo.srcWidth,resizeInfo.srcHeight,null!=(_ref2=resizeInfo.trgX)?_ref2:0,null!=(_ref3=resizeInfo.trgY)?_ref3:0,resizeInfo.trgWidth,resizeInfo.trgHeight),thumbnail=canvas.toDataURL("image/png"),_this.emit("thumbnail",file,thumbnail),null!=callback?callback():void 0}}(this),null!=callback&&(img.onerror=callback),img.src=imageUrl},Dropzone.prototype.processQueue=function(){var i,parallelUploads,processingLength,queuedFiles;if(parallelUploads=this.options.parallelUploads,processingLength=this.getUploadingFiles().length,i=processingLength,!(processingLength>=parallelUploads)&&(queuedFiles=this.getQueuedFiles(),queuedFiles.length>0)){if(this.options.uploadMultiple)return this.processFiles(queuedFiles.slice(0,parallelUploads-processingLength));for(;parallelUploads>i;){if(!queuedFiles.length)return;this.processFile(queuedFiles.shift()),i++}}},Dropzone.prototype.processFile=function(file){return this.processFiles([file])},Dropzone.prototype.processFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.processing=!0,file.status=Dropzone.UPLOADING,this.emit("processing",file);return this.options.uploadMultiple&&this.emit("processingmultiple",files),this.uploadFiles(files)},Dropzone.prototype._getFilesWithXhr=function(xhr){var file,files;return files=function(){var _i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)file=_ref[_i],file.xhr===xhr&&_results.push(file);return _results}.call(this)},Dropzone.prototype.cancelUpload=function(file){var groupedFile,groupedFiles,_i,_j,_len,_len1,_ref;if(file.status===Dropzone.UPLOADING){for(groupedFiles=this._getFilesWithXhr(file.xhr),_i=0,_len=groupedFiles.length;_len>_i;_i++)groupedFile=groupedFiles[_i],groupedFile.status=Dropzone.CANCELED;for(file.xhr.abort(),_j=0,_len1=groupedFiles.length;_len1>_j;_j++)groupedFile=groupedFiles[_j],this.emit("canceled",groupedFile);this.options.uploadMultiple&&this.emit("canceledmultiple",groupedFiles)}else((_ref=file.status)===Dropzone.ADDED||_ref===Dropzone.QUEUED)&&(file.status=Dropzone.CANCELED,this.emit("canceled",file),this.options.uploadMultiple&&this.emit("canceledmultiple",[file]));return this.options.autoProcessQueue?this.processQueue():void 0},resolveOption=function(){var args,option;return option=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],"function"==typeof option?option.apply(this,args):option},Dropzone.prototype.uploadFile=function(file){return this.uploadFiles([file])},Dropzone.prototype.uploadFiles=function(files){var file,formData,handleError,headerName,headerValue,headers,i,input,inputName,inputType,key,method,option,progressObj,response,updateProgress,url,value,xhr,_i,_j,_k,_l,_len,_len1,_len2,_len3,_m,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;for(xhr=new XMLHttpRequest,_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.xhr=xhr;method=resolveOption(this.options.method,files),url=resolveOption(this.options.url,files),xhr.open(method,url,!0),xhr.withCredentials=!!this.options.withCredentials,response=null,handleError=function(_this){return function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=files.length;_len1>_j;_j++)file=files[_j],_results.push(_this._errorProcessing(files,response||_this.options.dictResponseError.replace("{{statusCode}}",xhr.status),xhr));return _results}}(this),updateProgress=function(_this){return function(e){var allFilesFinished,progress,_j,_k,_l,_len1,_len2,_len3,_results;if(null!=e)for(progress=100*e.loaded/e.total,_j=0,_len1=files.length;_len1>_j;_j++)file=files[_j],file.upload={progress:progress,total:e.total,bytesSent:e.loaded};else{for(allFilesFinished=!0,progress=100,_k=0,_len2=files.length;_len2>_k;_k++)file=files[_k],(100!==file.upload.progress||file.upload.bytesSent!==file.upload.total)&&(allFilesFinished=!1),file.upload.progress=progress,file.upload.bytesSent=file.upload.total;if(allFilesFinished)return}for(_results=[],_l=0,_len3=files.length;_len3>_l;_l++)file=files[_l],_results.push(_this.emit("uploadprogress",file,progress,file.upload.bytesSent));return _results}}(this),xhr.onload=function(_this){return function(e){var _ref;if(files[0].status!==Dropzone.CANCELED&&4===xhr.readyState){if(response=xhr.responseText,xhr.getResponseHeader("content-type")&&~xhr.getResponseHeader("content-type").indexOf("application/json"))try{response=JSON.parse(response)}catch(_error){e=_error,response="Invalid JSON response from server."}return updateProgress(),200<=(_ref=xhr.status)&&300>_ref?_this._finished(files,response,e):handleError()}}}(this),xhr.onerror=function(_this){return function(){return files[0].status!==Dropzone.CANCELED?handleError():void 0}}(this),progressObj=null!=(_ref=xhr.upload)?_ref:xhr,progressObj.onprogress=updateProgress,headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&extend(headers,this.options.headers);for(headerName in headers)headerValue=headers[headerName],xhr.setRequestHeader(headerName,headerValue);if(formData=new FormData,this.options.params){_ref1=this.options.params;for(key in _ref1)value=_ref1[key],formData.append(key,value)}for(_j=0,_len1=files.length;_len1>_j;_j++)file=files[_j],this.emit("sending",file,xhr,formData);if(this.options.uploadMultiple&&this.emit("sendingmultiple",files,xhr,formData),"FORM"===this.element.tagName)for(_ref2=this.element.querySelectorAll("input, textarea, select, button"),_k=0,_len2=_ref2.length;_len2>_k;_k++)if(input=_ref2[_k],inputName=input.getAttribute("name"),inputType=input.getAttribute("type"),"SELECT"===input.tagName&&input.hasAttribute("multiple"))for(_ref3=input.options,_l=0,_len3=_ref3.length;_len3>_l;_l++)option=_ref3[_l],option.selected&&formData.append(inputName,option.value);else(!inputType||"checkbox"!==(_ref4=inputType.toLowerCase())&&"radio"!==_ref4||input.checked)&&formData.append(inputName,input.value);for(i=_m=0,_ref5=files.length-1;_ref5>=0?_ref5>=_m:_m>=_ref5;i=_ref5>=0?++_m:--_m)formData.append(this._getParamName(i),files[i],files[i].name);return xhr.send(formData)},Dropzone.prototype._finished=function(files,responseText,e){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.status=Dropzone.SUCCESS,this.emit("success",file,responseText,e),this.emit("complete",file);return this.options.uploadMultiple&&(this.emit("successmultiple",files,responseText,e),this.emit("completemultiple",files)),this.options.autoProcessQueue?this.processQueue():void 0},Dropzone.prototype._errorProcessing=function(files,message,xhr){var file,_i,_len;for(_i=0,_len=files.length;_len>_i;_i++)file=files[_i],file.status=Dropzone.ERROR,this.emit("error",file,message,xhr),this.emit("complete",file);return this.options.uploadMultiple&&(this.emit("errormultiple",files,message,xhr),this.emit("completemultiple",files)),this.options.autoProcessQueue?this.processQueue():void 0},Dropzone}(Emitter),Dropzone.version="4.0.1",Dropzone.options={},Dropzone.optionsForElement=function(element){return element.getAttribute("id")?Dropzone.options[camelize(element.getAttribute("id"))]:void 0},Dropzone.instances=[],Dropzone.forElement=function(element){if("string"==typeof element&&(element=document.querySelector(element)),null==(null!=element?element.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return element.dropzone},Dropzone.autoDiscover=!0,Dropzone.discover=function(){var checkElements,dropzone,dropzones,_i,_len,_results;for(document.querySelectorAll?dropzones=document.querySelectorAll(".dropzone"):(dropzones=[],checkElements=function(elements){var el,_i,_len,_results;for(_results=[],_i=0,_len=elements.length;_len>_i;_i++)el=elements[_i],/(^| )dropzone($| )/.test(el.className)?_results.push(dropzones.push(el)):_results.push(void 0);return _results},checkElements(document.getElementsByTagName("div")),checkElements(document.getElementsByTagName("form"))),_results=[],_i=0,_len=dropzones.length;_len>_i;_i++)dropzone=dropzones[_i],Dropzone.optionsForElement(dropzone)!==!1?_results.push(new Dropzone(dropzone)):_results.push(void 0);return _results},Dropzone.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],Dropzone.isBrowserSupported=function(){var capableBrowser,regex,_i,_len,_ref;if(capableBrowser=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(_ref=Dropzone.blacklistedBrowsers,_i=0,_len=_ref.length;_len>_i;_i++)regex=_ref[_i],regex.test(navigator.userAgent)&&(capableBrowser=!1);else capableBrowser=!1;else capableBrowser=!1;return capableBrowser},without=function(list,rejectedItem){var item,_i,_len,_results;for(_results=[],_i=0,_len=list.length;_len>_i;_i++)item=list[_i],item!==rejectedItem&&_results.push(item);return _results},camelize=function(str){return str.replace(/[\-_](\w)/g,function(match){return match.charAt(1).toUpperCase()})},Dropzone.createElement=function(string){var div;return div=document.createElement("div"),div.innerHTML=string,div.childNodes[0]},Dropzone.elementInside=function(element,container){if(element===container)return!0;for(;element=element.parentNode;)if(element===container)return!0;return!1},Dropzone.getElement=function(el,name){var element;if("string"==typeof el?element=document.querySelector(el):null!=el.nodeType&&(element=el),null==element)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector or a plain HTML element.");return element},Dropzone.getElements=function(els,name){var e,el,elements,_i,_j,_len,_len1,_ref;if(els instanceof Array){elements=[];try{for(_i=0,_len=els.length;_len>_i;_i++)el=els[_i],elements.push(this.getElement(el,name))}catch(_error){e=_error,elements=null}}else if("string"==typeof els)for(elements=[],_ref=document.querySelectorAll(els),_j=0,_len1=_ref.length;_len1>_j;_j++)el=_ref[_j],elements.push(el);else null!=els.nodeType&&(elements=[els]);if(null==elements||!elements.length)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return elements},Dropzone.confirm=function(question,accepted,rejected){return window.confirm(question)?accepted():null!=rejected?rejected():void 0},Dropzone.isValidFile=function(file,acceptedFiles){var baseMimeType,mimeType,validType,_i,_len;if(!acceptedFiles)return!0;for(acceptedFiles=acceptedFiles.split(","),mimeType=file.type,baseMimeType=mimeType.replace(/\/.*$/,""),_i=0,_len=acceptedFiles.length;_len>_i;_i++)if(validType=acceptedFiles[_i],validType=validType.trim(),"."===validType.charAt(0)){if(-1!==file.name.toLowerCase().indexOf(validType.toLowerCase(),file.name.length-validType.length))return!0}else if(/\/\*$/.test(validType)){if(baseMimeType===validType.replace(/\/.*$/,""))return!0}else if(mimeType===validType)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(options){return this.each(function(){return new Dropzone(this,options)})}),"undefined"!=typeof module&&null!==module?module.exports=Dropzone:window.Dropzone=Dropzone,Dropzone.ADDED="added",Dropzone.QUEUED="queued",Dropzone.ACCEPTED=Dropzone.QUEUED,Dropzone.UPLOADING="uploading",Dropzone.PROCESSING=Dropzone.UPLOADING,Dropzone.CANCELED="canceled",Dropzone.ERROR="error",Dropzone.SUCCESS="success",detectVerticalSquash=function(img){var alpha,canvas,ctx,data,ey,ih,iw,py,ratio,sy;for(iw=img.naturalWidth,ih=img.naturalHeight,canvas=document.createElement("canvas"),canvas.width=1,canvas.height=ih,ctx=canvas.getContext("2d"),ctx.drawImage(img,0,0),data=ctx.getImageData(0,0,1,ih).data,sy=0,ey=ih,py=ih;py>sy;)alpha=data[4*(py-1)+3],0===alpha?ey=py:sy=py,py=ey+sy>>1;return ratio=py/ih,0===ratio?1:ratio},drawImageIOSFix=function(ctx,img,sx,sy,sw,sh,dx,dy,dw,dh){var vertSquashRatio;return vertSquashRatio=detectVerticalSquash(img),ctx.drawImage(img,sx,sy,sw,sh,dx,dy,dw,dh/vertSquashRatio)},contentLoaded=function(win,fn){var add,doc,done,init,poll,pre,rem,root,top;if(done=!1,top=!0,doc=win.document,root=doc.documentElement,add=doc.addEventListener?"addEventListener":"attachEvent",rem=doc.addEventListener?"removeEventListener":"detachEvent",pre=doc.addEventListener?"":"on",init=function(e){return"readystatechange"!==e.type||"complete"===doc.readyState?(("load"===e.type?win:doc)[rem](pre+e.type,init,!1),!done&&(done=!0)?fn.call(win,e.type||e):void 0):void 0},poll=function(){var e;try{root.doScroll("left")}catch(_error){return e=_error,void setTimeout(poll,50)}return init("poll")},"complete"!==doc.readyState){if(doc.createEventObject&&root.doScroll){try{top=!win.frameElement}catch(_error){}top&&poll()}return doc[add](pre+"DOMContentLoaded",init,!1),doc[add](pre+"readystatechange",init,!1),win[add](pre+"load",init,!1)}},Dropzone._autoDiscoverFunction=function(){return Dropzone.autoDiscover?Dropzone.discover():void 0},contentLoaded(window,Dropzone._autoDiscoverFunction)}.call(this),define("dropzone",function(global){return function(){var ret;return ret||global.Dropzone}}(this)),define("general.components/media-library/update/media-update",["jquery","qvangular","translator","text!general.components/media-library/update/media-update.ng.html","text!general.components/media-library/update/preview-item.ng.html","general.models/media-library","core.models/app","xsrfplugin","general.utils/dom-util","client.controllers/error-handler-controller","dropzone","core.utils/deferred","util"],function($,qvangular,translator,template,previewItemTemplate,MediaLibrary,App,xsrfplugin,domUtil,ErrorHandler,Dropzone,Deferred,Util){"use strict";function updateQuotaInfo($scope,app){app.getContentLibraries().then(function(list){var quotaLeft=MediaLibrary.getRemainingSpace(list)/1024/1024;quotaLeft=quotaLeft.toString().split("e"),quotaLeft=Math.floor(+(quotaLeft[0]+"e"+(quotaLeft[1]?+quotaLeft[1]+1:1))),quotaLeft=quotaLeft.toString().split("e"),quotaLeft=+(quotaLeft[0]+"e"+(quotaLeft[1]?+quotaLeft[1]-1:-1)),$scope.quotaInfo=translator.get("MediaLibrary.QuotaInfo",[quotaLeft])})}function deleteFileInServer($scope,$http,filename){return App.get().then(function(app){var config={params:{externalpath:filename,xrfkey:xrfKey},headers:{"X-Qlik-XrfKey":xrfKey}},url=Util.basePath+"qrs/appcontent/"+app.id+"/deletecontent";return $http["delete"](url,config).success(function(){updateQuotaInfo($scope,app)}).error(function(data,status){var statusCode=status;0===status&&(statusCode=500),ErrorHandler.showDialog({code:statusCode})})})}var xrfKey=xsrfplugin.getRandomString(16);qvangular.directive("qvMediaUpdate",function(){return{restrict:"E",replace:!0,scope:{updateExp:"=",selectedFile:"=",selectFile:"&"},template:template,controller:["$scope","$element","$compile","$timeout","$http","$delayedModal",function($scope,$element,$compile,$timeout,$http,$delayedModal){function createChildScope(elem,file){var childScope=$scope.$new();childScope.file=file,$compile($(elem))(childScope)}function deleteFile(file,filename,filepath){var deferred=new Deferred;return $scope.updateExp.deleteDialogShown=!0,$delayedModal.open({title:"MediaLibrary.Confirm.Delete.Title",content:translator.get("MediaLibrary.Confirm.Delete.Description",[filename]),buttons:[{name:"Common.Cancel",callback:function(){$scope.updateExp.deleteDialogShown=!1,deferred.reject()}},{name:"Common.Delete",defaultButton:!0,callback:function(){deleteFileInServer($scope,$http,filename).then(function(){$scope.selectedFile===filepath&&$scope.selectFile()(event,null,null),file&&dropzone.removeFile(file),deferred.resolve()},function(){deferred.reject()}),$scope.updateExp.deleteDialogShown=!1}}]}),deferred.promise}var dropzone;$scope.isEmpty=!0,$scope.previewCounter=0,Dropzone.autoDiscover=!1,Dropzone.confirm=function(question,accepted,rejected){return null!=rejected?rejected():void 0},$scope.updateExp.deleteFile=function(filename,filepath){for(var list=dropzone.getFilesWithStatus(Dropzone.SUCCESS),file=null,i=0;i<list.length;i++)if(filename===list[i].name){file=list[i];break}return deleteFile(file,filename,filepath)},$scope.onCancelUpload=function(event,file){event.preventDefault(),event.stopPropagation(),dropzone.cancelUpload(file)},$scope.onDelete=function(event,file,filename,filepath){event.preventDefault(),event.stopPropagation(),deleteFile(file,filename,filepath)},$scope.onSelectImage=function(event,file){return domUtil.scrollElmentIntoView($(file.previewElement),".media-library-preview-container",!1,!0),$(event.currentTarget).hasClass("dz-success")?void $scope.selectFile()(event,file.qUrl,file.qUrlDef):(event.preventDefault(),void event.stopPropagation())},App.get().then(function(app){var url=Util.basePath+"qrs/appcontent/"+app.id+"/uploadfile?",appcontentDefaultUrl="/appcontent/"+app.id+"/";updateQuotaInfo($scope,app),dropzone=new Dropzone("#media-library-dropzone",{url:url,headers:{"X-Qlik-XrfKey":xrfKey},acceptedFiles:".png,.gif,.jpg,.jpeg",maxFilesize:5,parallelUploads:4,filesizeBase:1024,thumbnailWidth:200,thumbnailHeight:200,previewTemplate:previewItemTemplate,previewsContainer:".media-library-preview-container",dictInvalidFileType:translator.get("ErrorCode.3004"),dictFileTooBig:translator.get("MediaLibrary.Error.MaxFileSizeExceeded"),dictResponseError:translator.get("ErrorCode.500")}),dropzone.on("processing",function(file){this.options.url=url+"externalpath="+encodeURIComponent(file.name)+"&overwrite=false&xrfkey="+xrfKey}),dropzone.on("addedfile",function(file){createChildScope(file.previewElement,file),$timeout(function(){$scope.isEmpty=!1,$scope.previewCounter++,$scope.updateExp.isUploading=!0,domUtil.scrollElmentIntoView($(file.previewElement),".media-library-preview-container",!1,!0)})}),dropzone.on("removedfile",function(){$timeout(function(){$scope.previewCounter--,0===$scope.previewCounter&&($scope.isEmpty=!0)})}),dropzone.on("success",function(file){file.qUrl=appcontentDefaultUrl+encodeURIComponent(file.name).replace(/[!'()*]/g,function(c){return"%"+c.charCodeAt(0).toString(16).toUpperCase()}),file.qUrlDef=appcontentDefaultUrl+file.name,updateQuotaInfo($scope,app)}),dropzone.on("queuecomplete",function(){$timeout(function(){$scope.updateExp.isUploading=!1})}),dropzone.on("error",function(file,errorMessage,xhr){var elemScope=$(file.previewElement).scope();elemScope.showError=!0,xhr&&xhr.status?409===xhr.status?elemScope.errorMsg=translator.get("MediaLibrary.Error.FileAlreadyExists"):413===xhr.status?elemScope.errorMsg=translator.get("MediaLibrary.Error.MaxFileSizeExceeded"):elemScope.errorMsg=translator.get("ErrorCode."+xhr.status):elemScope.errorMsg=translator.get(errorMessage)})}),$scope.$on("$destroy",function(){dropzone.destroy(),$scope.updateExp.deleteDialogShown&&$delayedModal.close()})}]}})}),define("text!general.components/context-menu/context-menu.ng.html",[],function(){return'<div class="qui-immidiateContextual qv-contextmenu" tid="context-menu" qva-outside="close($event)">\r\n	<div class="content">\r\n		<ul class="qui-textlist">\r\n			<li ng-if="levels.length" class="qv-contextmenu-item-container back">\r\n				<div class="qv-contextmenu-item" qva-activate="goBack();" tcl="context-menu-item">\r\n					<i class="icon-triangle-left back-icon"></i>\r\n					<span class="qui-textlist-text" q-translation="Common.Back" tid="context-menu-back"></span>\r\n				</div>\r\n			</li>\r\n			<li ng-repeat="item in currentItems" class="qv-contextmenu-item-container">\r\n				<div class="qv-contextmenu-item" ng-class="{ \'qv-contextmenu-has-submenu\': item.hasSubmenu(), \'has-icon\': item.hasIcon() }"\r\n					 qva-activate="selectItem($event,item)" tcl="context-menu-item">\r\n					<i class="item-icon {{item.icon}}" ng-if="item.hasIcon()"></i>\r\n					<span class="qui-textlist-text" title="{{item.getLabel()}}" tid="{{item.tid}}">{{item.getLabel()}}</span>\r\n					<i ng-show="item.hasSubmenu()" class="icon-triangle-right"></i>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("general.components/context-menu/context-menu",["jquery","general.utils/window-positioner","core.utils/resize","text!./context-menu.ng.html"],function($,windowPositioner,Resize,template){"use strict";function dock(element,docking,x,y){switch(docking){case"BottomLeft":x-=element.outerWidth();break;case"Bottom":x-=element.outerWidth()/2;break;case"BottomRight":break;case"Left":x-=element.outerWidth(),y-=element.outerHeight()/2;break;case"Center":x-=element.outerWidth()/2,y-=element.outerHeight()/2;break;case"Right":y-=element.outerHeight()/2;break;case"Top":y-=element.outerHeight(),x-=element.outerWidth()/2;break;case"TopRight":default:y-=element.outerHeight()}return{left:x,top:y}}function limit(element,offset){var win=$(window),padding=10,min_x=padding,max_x=win.outerWidth()-element.outerWidth()-padding,x=Math.max(min_x,Math.min(max_x,offset.left)),min_y=padding,max_y=win.outerHeight()-element.outerHeight()-padding,y=Math.max(min_y,Math.min(max_y,offset.top));
return{left:x,top:y}}function position(element,docking,position){var offset=dock(element,docking,position.x,position.y);return offset=limit(element,offset),element.offset(offset),offset}function reposition(element,offset){return offset=limit(element,offset),element.offset(offset),offset}function afterDOMUpdate($scope,callback){$scope.$$postDigest(function(){$scope.$$postDigest(callback)})}var contextMenuComponent={template:template,scope:{menu:"=",options:"="},controller:["$scope","$element","$timeout",function($scope,$element){function refreshPosition(offset){afterDOMUpdate($scope,function(){$scope.options.alignTo?windowPositioner.align(getElement(),$scope.options.alignTo,{collision:$scope.options.collision||"flip",position:$scope.options.docking||"top"}):(offset=offset||currentOffset,currentOffset=offset?reposition(getElement(),offset):position(getElement(),$scope.options.docking,$scope.options.position))})}function stepOut(){if($scope.levels.length){var level=$scope.levels.pop();$scope.currentItems=level.items,refreshPosition(level.offset)}}function stepInto(item){var items=item.items;$scope.levels.push({items:$scope.currentItems,offset:currentOffset}),$scope.currentItems=items,refreshPosition()}function getElement(){return $element.children().first()}var currentOffset=null;$scope.levels=[],$scope.currentItems=$scope.menu.items,$scope.goBack=function(){stepOut()},$scope.selectItem=function(event,item){event.stopPropagation(),item.hasSubmenu()?stepInto(item):(item.select(item.args),$scope.close())},$scope.close=function(){"function"==typeof $scope.menu.onClosing&&$scope.menu.onClosing.call(null),$scope.destroyComponent(),Resize.off("start",$scope.close)},Resize.on("start",$scope.close),$element.find(".content").css("max-height",$(window).outerHeight()-40),refreshPosition(),"function"==typeof $scope.menu.onOpen&&$scope.menu.onOpen.call(null)}]};return contextMenuComponent}),define("general.components/context-menu/context-menu-service",["qvangular","general.components/context-menu/context-menu","general.services/show-service/show-service","translator"],function(qvangular,contextMenuComponent,showService,translator){"use strict";var Item=function(item){var self=this;Object.keys(item||{}).forEach(function(key){self[key]=item[key]}),this.items=[]};Item.prototype.addItem=function(options){var item=new Item(options);return this.items.push(item),item},Item.prototype.hasSubmenu=function(){return this.items.length>0},Item.prototype.hasIcon=function(){return!!this.icon},Item.prototype.getLabel=function(){function getTranslationString(value){return Array.isArray(value)?translator.get(value[0],value.slice(1).join(",")):translator.get(value)}return"function"==typeof this.translation?getTranslationString(this.translation()):this.translation?getTranslationString(this.translation):"function"==typeof this.label?this.label():this.label?this.label:"Missing translation/label"},qvangular.service("qvContextMenu",function(){var currentComponent,service={};return service.show=function(menu,options){if(service.close(),0!==menu.items.length){var component=options.component||contextMenuComponent;return currentComponent=showService.show(component,{menu:menu,options:options})}},service.close=function(){currentComponent&&(currentComponent.destroy(),currentComponent=null)},service.menu=function(){var root=new Item,menu={addItem:function(item){return root.addItem(item)}};return Object.defineProperty(menu,"items",{get:function(){return root.items}}),menu},service})}),define("general.components/media-library/media-library",["jquery","qvangular","require","core.models/app","general.models/media-library","text!./media-library.ng.html","text!./media-library-grid.ng.html","text!./media-library-list.ng.html","general.services/show-service/show-service","general.utils/dom-util","general.views/bouncy-grid/bouncy-grid","general.components/media-library/update/media-update","general.components/context-menu/context-menu-service"],function($,qvangular,require,App,MediaLibrary,template,templateGrid,templateList,showService,domUtil){function show(opts){var input={onCancel:opts.onCancel,onConfirm:opts.onConfirm,selectedFile:opts.selectedFile,filter:["png","gif","jpg","jpeg"]};showService.show(component,input),state.isShown=!0}function hide(){if(state.isShown){var $mediaLibElem=$('[qv-id="media-library-modal"]');$mediaLibElem.length&&$mediaLibElem.scope().cancel(!0)}}function isShown(){return state.isShown}var state={isShown:!1};qvangular.directive("qveMediaList",function(){return{replace:!0,restrict:"E",template:templateList}}),qvangular.directive("qveMediaGrid",function(){return{replace:!0,restrict:"E",template:templateGrid}});var component={template:template,controller:["$scope","$element","qvContextMenu",function($scope,$element,$qvContextMenu){function setSelected(file,fileDef){file=file||null,fileDef=fileDef||null,$scope.selectedFile=file,$scope.selectedFileDef=fileDef}function getLibraryItems(){App.get().then(function(app){app.getLibraryContent($scope.view).then(function(list){var tree=MediaLibrary.createTree(list,$scope.input.filter,!0);$scope.rootEntry=tree,$scope.hasFiles=tree.children.length>0})})}function updateAfterDelete(deletedFile){getLibraryItems(),$scope.input.selectedFile&&deletedFile===$scope.input.selectedFile&&(inUseFileDeleted=!0)}var link=require.toUrl("img/medialibrary/thumb.png"),inUseFileDeleted=!1;$scope.inZoom=!1,$scope.firstTimeRenderCheck=!0,$scope.lists=[],$scope.selectedFile=null,$scope.hasFiles=!1,$scope.view=null,link=MediaLibrary.stripBasePath(link),link=MediaLibrary.addBasePath(link),$scope.staticSrc=link,$scope.updateExp={isUploading:!1,deleteDialogShown:!1,deleteFile:null},$scope.getSrc=function(url){return url=MediaLibrary.stripBasePath(url),url=MediaLibrary.addBasePath(url)},$scope.zoomImage=function(e,item){e.preventDefault(),e.stopPropagation(),$scope.zoomSrc=item.path,$scope.inZoom=!0},$scope.closeZoom=function(){$scope.inZoom=!1,$scope.zoomSrc=null},$scope.goTo=function(newView,isUpload){var topScroll;$scope.view!==newView&&(setSelected(null,null),$scope.isUpload=isUpload,$scope.view=newView,isUpload||(topScroll=$element.find(".q-images-cont"),topScroll.length&&(topScroll[0].scrollTop=0),getLibraryItems(),$scope.firstTimeRenderCheck=!0,topScroll=null))},$scope.isSelectedImg=function(file,last,selector){return last&&$scope.firstTimeRenderCheck&&selector&&setTimeout(function(){var selectedImg=$element.find(selector);$scope.firstTimeRenderCheck=!1,selectedImg.length&&domUtil.scrollElmentIntoView(selectedImg,".q-images-cont",!0),selectedImg=null},250),$scope.selectedFile===file.path},$scope.selectFile=function(evt,file,fileDef){var selectedImg=$(evt.target).closest(".q-media-grid, .qui-menu-item");evt.preventDefault(),evt.stopPropagation(),domUtil.scrollElmentIntoView(selectedImg,".q-images-cont",!1),$scope.selectedFile===file&&(file=null,fileDef=null),selectedImg=null,setSelected(file,fileDef)},$scope.confirm=function(){$scope.selectedFile&&!$scope.updateExp.isUploading&&($scope.input.onConfirm($scope.selectedFile,$scope.selectedFileDef),$scope.destroyComponent())},$scope.canDeleteInView=function(){return $scope.view===$scope.lists[0].qName&&$scope.canUpdate},$scope.onDelete=function(evt){var fileToDelete=$scope.selectedFile;evt.preventDefault(),evt.stopPropagation();var name=$scope.selectedFileDef.split("/").splice(-1)[0];$scope.updateExp.deleteFile(name,$scope.selectedFile).then(function(){updateAfterDelete(fileToDelete)})},$scope.onContextMenu=function(evt){if(evt.preventDefault(),evt.stopPropagation(),$scope.canDeleteInView()){var menu=$qvContextMenu.menu();menu.addItem({translation:"Common.Delete",tid:"delete",select:function(){var entry=$(evt.target).closest(".qui-menu-item").scope().entry,fileToDelete=entry.path;$scope.updateExp.deleteFile(entry.name,entry.path).then(function(){updateAfterDelete(fileToDelete)})}}),$qvContextMenu.show(menu,{position:{x:evt.pageX,y:evt.pageY},docking:"BottomRight"})}},$scope.cancel=function(force){if(!force){if($scope.inZoom)return void $scope.closeZoom();if($scope.updateExp.deleteDialogShown)return void($scope.updateExp.deleteDialogShown=!1)}(force||!$scope.updateExp.isUploading)&&($scope.input.onCancel(inUseFileDeleted),$scope.destroyComponent())},App.get().then(function(app){app.getContentLibraries().then(function(list){$scope.lists=MediaLibrary.filterList(list),!$scope.view&&$scope.lists.length&&($scope.view=$scope.lists[0].qName,getLibraryItems()),$scope.canUpdate=!$scope.$root.isPersonalMode&&!!MediaLibrary.canUpdate})}),$scope.$on("$destroy",function(){state.isShown=!1,$scope.closeZoom()})}]};return{show:show,hide:hide,isShown:isShown}}),define("general.services/media-library/media-library",["general.components/media-library/media-library"],function(mediaLibraryComponent){function show(opts){mediaLibraryComponent.show(opts)}function hide(){mediaLibraryComponent.hide()}function isShown(){return mediaLibraryComponent.isShown()}return{show:show,hide:hide,isShown:isShown}}),define("general.services/expandable/expandable",["qvangular","angular","jquery","core.utils/deferred","text!general.services/expandable/expandable.ng.html","client.views/app-overview/ao-hub-gestures","general.utils/dom-util","general.services/media-library/media-library","general.services/delayed-modal/delayed-modal","angular"],function(qvangular,angular,$,Deferred,template,aoGestures,domUtil,MediaLibraryService){function getIndexes(data){var itemWidth,listItems,nbrOfItemsPerRow,rowIndex,columnIndex,indexToAppendTo,lastRowIndex,arrowLeftPos,offset,$ul=data.parent;return offset=data.pointerOffset?data.pointerOffset:0,itemWidth=$ul.find("li:not(.qv-expandable)").first().outerWidth(!0),listItems=$ul.find("li:visible:not(.qv-expandable)"),nbrOfItemsPerRow=Math.floor($ul.width()/itemWidth),rowIndex=Math.ceil((data.index+1)/nbrOfItemsPerRow),lastRowIndex=Math.ceil(listItems.length/nbrOfItemsPerRow),indexToAppendTo=rowIndex===lastRowIndex?listItems.length-1:rowIndex*nbrOfItemsPerRow-1,columnIndex=1===rowIndex?data.index:data.index-(rowIndex-1)*nbrOfItemsPerRow,arrowLeftPos=(columnIndex+.5)*itemWidth+offset,{listItems:listItems,itemWidth:itemWidth,sectionUl:$ul,indexToAppendTo:indexToAppendTo,rowIndex:rowIndex,arrowLeftPos:arrowLeftPos}}function isIgnoreOutsideEvent(e,scrollSelector){var ignore=!1;return qvangular.getService("$delayedModal").isOpened?ignore=!0:aoGestures.isClickOnScrollbar(scrollSelector)?ignore=!0:$(e.target).closest('[qva-outside-ignore-for="expandable"]').length?ignore=!0:$(e.target).closest("li").hasClass("qv-add")?ignore=!0:MediaLibraryService.isShown()&&(ignore=!0),ignore}function savedataBeforeNextAction(options){options.saveDataCallback&&options.saveDataCallback(options.currentItem,options.currentItem.qData.rank)}var activeItemId,oldRow,parent,isOpened=!1;qvangular.service("$$expandable",["$compile","$timeout",function($compile,$timeout){function updateThumbLayout(){$scope.modelItem.getLayout().then(function(layout){$scope.thumbLayout=layout.thumbnail})}function close(){for(var k in o)$scope[k]=null,delete $scope[k];$scope.isSmallDevice=!1,isOpened=!1,$scope.currentItem=null,$scope.indexes=null,activeItemId=null,oldRow=null,parent=!1,$scope.modelItem&&$scope.modelItem.Invalidated.unbind(updateThumbLayout),$scope.$root.$emit("expandableDestroyed"),$container.off(".outside"),$container.remove()}var closeTimer,$scope,o={},$container=angular.element('<li class="av-li qv-expandable"></li>'),exports={getIndexes:getIndexes,open:function(options,$parentscope,model,scrollSelector,isSmallDevice){function show(){var lastNode=o.parent.find("li").eq($scope.indexes.indexToAppendTo);lastNode.hasClass("qv-add")?lastNode.parent().append($container.html(template)):lastNode.after($container.html(template)),$container[0].style.background="",$container.find(".inner-arrow")[0].style["border-bottom-color"]="",$scope.dynamicColor&&($container[0].style.background=$scope.dynamicColor,$container.find(".inner-arrow")[0].style["border-bottom-color"]=$scope.dynamicColor),$compile($container.append(o.template))($scope),$container.on("qv-outside.outside",function(e){qvangular.getService("$delayedModal").isOpened||savedataBeforeNextAction(o);var ignore=isIgnoreOutsideEvent(e,scrollSelector);ignore||close()}),that.alignToBottom($container,null,scrollSelector)}var newRow,close=this.close.bind(this),that=this;if(parent&&parent[0]!==options.parent[0]&&(oldRow=null),parent=options.parent,$scope&&$scope===$parentscope||($scope=$parentscope),activeItemId===options.currentId)return savedataBeforeNextAction(o),void close();$scope.indexes=getIndexes(options),newRow=oldRow!==$scope.indexes.rowIndex,oldRow&&newRow&&oldRow<$scope.indexes.rowIndex&&$scope.indexes.indexToAppendTo++,oldRow=$scope.indexes.rowIndex,activeItemId=options.currentId,isOpened=!0,o=options,$scope.isSmallDevice=isSmallDevice;for(var k in o)$scope[k]=o[k];model?model.get($scope.currentId).then(function(item){$scope.modelItem=item,$scope.modelItem.Invalidated.bind(updateThumbLayout),Deferred.all({properties:item.getProperties(),layout:item.getLayout()}).then(function(args){$scope.qMetaDef=args.properties.qMetaDef,$scope.thumbProps=args.properties.thumbnail,$scope.thumbLayout=args.layout.thumbnail,show()})}):show(),$scope.$on("$destroy",function(){qvangular.getService("$delayedModal").isOpened||savedataBeforeNextAction(o)})},close:function(){isOpened&&(closeTimer=$timeout(function(){aoGestures.event.isSwipeing||close()},150))},forceClose:function(){isOpened&&(exports.stopCloseTimer(),isOpened=!1,close())},stopCloseTimer:function(){closeTimer&&($timeout.cancel(closeTimer),closeTimer=null)},alignToBottom:function(element,time,scrollSelector){$timeout(function(){domUtil.scrollElmentIntoView(element||$container,scrollSelector)},time||100)}};return Object.defineProperty(exports,"isOpened",{get:function(){return isOpened}}),Object.defineProperty(exports,"activeItem",{get:function(){return activeItemId}}),exports}])}),define("text!client.views/app-overview/directives/expandable/expandable.ng.html",[],function(){return'<div class="qv-item-expandable" data-name="{{currentItem.qInfo.qId}}" qva-outside-ignore-for="addSheet">\r\n	<div tid="dw" class="e-dw non-edit-mode" ng-if="!isEditMode" qva-activate="goToItemExpandable( $event )">\r\n		<div class="ao-mw">\r\n			<div class="qv-expand-title">\r\n				<span ng-if="currentItem.qReadOnly"><i class="icon-toolbar-locked" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span><span class="title">{{ currentTitle || qMetaDef.title }}</span>\r\n			</div>\r\n			<div ng-if="isPersonalMode && isHub" class="details">\r\n				<span q-translation="AppDetails.FileName"></span><span style="margin-left:7px;">{{ currentId }}</span>\r\n			</div>\r\n			<div ng-if="currentItem.qReadOnly" class="details" q-translation="Hub.App.ReadOnly"></div>\r\n			<div class="details" ng-if="currentItem.qMeta.published">\r\n				<span q-translation="Appoverview.Published"></span>\r\n				<qve-formate-date date="currentItem.qMeta.publishTime" format="LLL"></qve-formate-date>\r\n			</div>\r\n			<div class="details" ng-if="currentItem.qMeta.published && !isHub">\r\n				<span q-translation="Appoverview.PublishedBy"></span>\r\n				<span>{{ currentItem.qMeta.owner.name }} ({{ currentItem.qMeta.owner.userDirectory }})</span>\r\n			</div>\r\n			<div class="description">{{ currentDescription || qMetaDef.description }}</div>\r\n		</div>\r\n	</div>\r\n	<div tid="dw" class="e-dw" ng-if="isEditMode">\r\n		<div class="item-thumbnail-flex-wrapper">\r\n			<div qv-ao-thumb\r\n				 item="currentItem"\r\n				 issheet="is.sheet"\r\n				 thumbprop="thumbProps"\r\n				 thumblayout="thumbLayout"\r\n				 editmode="true"></div>\r\n		</div>\r\n		<div class="edit-details-flex-wrapper ao-mw">\r\n			<div class="title-text" q-translation="Common.Title"></div>\r\n			<input qv-enter="toggleEditMode()" ng-disabled="currentItem.qMeta.sourceObject.length" qva-select={{!currentItem.qMeta.sourceObject.length}} type="text" maxlength="255" class="qui-input av-input" ng-model="qMetaDef.title">\r\n\r\n			<div class="description-text" q-translation="Common.Description"></div>\r\n			<qve-textarea min-rows="4"\r\n						  max-rows="10"\r\n						  maxlength="512" model="qMetaDef.description"></qve-textarea>\r\n		</div>\r\n	</div>\r\n	<div ng-if="currentItem.permissions.update && !isSmallDevice"\r\n		 class="buttons"\r\n		 ng-class="{\'new-item\': !showEdit}">\r\n		<qui-button-outline-round\r\n				tid="exp-edit"\r\n				qva-focus="!isEditMode && focusEditBtn"\r\n				ng-if="showEdit"\r\n				data-name="edit"\r\n				q-title-translation="{{ isEditMode ? \'Tooltip.StopEdit\' : \'Common.Edit\' }}"\r\n				qva-activate="toggleEditMode()"\r\n				qv-enter="toggleEditMode()"\r\n				class-icon="{{isEditMode ? \'icon-tick\' : \'icon-toolbar-edit\'}}">\r\n		</qui-button-outline-round>\r\n		<qui-button-outline-round\r\n				tid="exp-del"\r\n				ng-if="currentItem.permissions.remove && isEditMode"\r\n				data-name="remove"\r\n				q-title-translation="Common.Delete"\r\n				qva-activate="removeItemExpandable( $event )"\r\n				qv-enter="removeItemExpandable( $event )"\r\n				class-icon="icon-bin">\r\n		</qui-button-outline-round>\r\n	</div>\r\n</div>'}),define("client.views/app-overview/directives/expandable/expandable",["qvangular","jquery","text!client.views/app-overview/directives/expandable/expandable.ng.html","pubsub"],function(qvangular,$,template,pubsub){"use strict";function unsubscribe(){pubsub.unsubscribe(".expandable")}function isClickOnScrollbar(e){var targetDivRight=$(e.target).offset().left+$(e.target).width(),clickTarget=e.pageX;return clickTarget>targetDivRight-10?!0:!1}qvangular.directive("qvExpandableRead",function(){return{restrict:"E",replace:!0,template:template,controller:["$scope","$$expandable",function($scope,$$expandable){function setDetails(close){$scope.isEditMode&&$scope.thatScope.$emit("newDetails",$scope.currentItem,$scope.currentItem.qData.rank),close&&($$expandable.close(),unsubscribe())}$scope.focusEditBtn=!0,$scope.showEdit=$scope.showEditBtn,unsubscribe(),$scope.goToItemExpandable=function(event){$scope.inEdit||isClickOnScrollbar(event)||$scope.thatScope.performAction({$fakeScope:$scope.thatScope,target:{getAttribute:function(){return"goToItem"}}})},$scope.toggleEditMode=function(option){setDetails(!1),option?($scope.isEditMode=option.open,$scope.showEdit=option.open?!1:!0):($scope.isEditMode=!$scope.isEditMode,$scope.showEdit=!0),$scope.isEditMode&&$$expandable.alignToBottom(null,null,".av-content-container")},$scope.removeItemExpandable=function(e){e.target.blur(),$scope.thatScope.$emit("removeItem")},pubsub.subscribe("/resize/start.expandable",function(){setDetails(!0),$scope.isEditMode=!1})}]}})}),define("assets/hub/hub-factory",["jquery","core.utils/deferred","core.models/app","assets/hub/hub-hack","assets/hub/hub-model","hub.files/hub-state","assets/hub/common/hub-session","qvangular","util","core.utils/help-url","client.controllers/error-handler-controller","autogenerated/qix/engine-enums","general.utils/dom-util","core.utils/authentication","general.services/expandable/expandable","client.views/app-overview/directives/expandable/expandable"],function($,Deferred,App,hack,hubModel,HubState,hubSession,qvangular,util,helpUrl,ErrorHandler,EngineEnums,domUtil,authentication){"use strict";function getResult(o){return o.result.qReturn}function getList(){return App.getList(engineSession)}function mapAppData(data){var item={qDocId:data.id,qDocName:data.name,qTitle:data.name,qThumbnail:{qUrl:data.thumbnail},qMeta:{published:data.published,publishTime:data.publishTime,description:data.description,userId:data.owner.userId,userDir:data.owner.userDirectory,dynamicColor:data.dynamicColor||""},privileges:data.privileges,isDisabled:data.isDisabled||!1,animation:data.animation||!1};return data.stream&&data.stream.name&&(item.qMeta.stream={name:data.stream&&data.stream.name,id:data.stream&&data.stream.id}),item}function mapStreamData(data){return{qId:data.id,qName:data.name}}function setupQRSNotifications($scope){for(var streamIds="",i=0;i<$scope.streamsList.length;i++)streamIds+="stream.id eq "+$scope.streamsList[i].qId,i!==$scope.streamsList.length-1&&(streamIds+=" or ");Deferred.all({"App.add":hubModel.rpcCall(qrsSession,"Notification.Register",[{type:"App",changeType:["Add"],filter:"owner.userId eq '"+authentication.userId+"'"}]),"App.update":hubModel.rpcCall(qrsSession,"Notification.Register",[{type:"App",changeType:["Update"],propertyName:["name","description","thumbnail","dynamicColor"],filter:"owner.userId eq '"+authentication.userId+"'"}]),"App.updatePublish":hubModel.rpcCall(qrsSession,"Notification.Register",[{type:"App",changeType:["Update"],propertyName:["published"],filter:streamIds}]),"App.delete":hubModel.rpcCall(qrsSession,"Notification.Register",[{type:"App",changeType:["Delete"]}]),"Stream.update":hubModel.rpcCall(qrsSession,"Notification.Register",[{type:"Stream",changeType:["Update"],propertyName:["name"]}]),"Stream.addDelete":hubModel.rpcCall(qrsSession,"Notification.Register",[{type:"Stream",changeType:["Add","Delete"]}])})}function getAppIndexFromApplist(id,scope){for(var i=0;i<scope.appList.length;i++)if(scope.appList[i].qDocId===id)return i;return-1}function getIndexFromIsOutdatedApps(id){for(var i=0;i<isOutdated.apps.length;i++)if(isOutdated.apps[i].id===id)return i;return-1}function matchAppTitle(baseAppTitle,appTitle){var re=new RegExp("^"+util.escapeRegExp(baseAppTitle)+"\\s*\\(\\d+\\)$");return re.test(appTitle)}function iterateQRSNotifications(value,qrsData,scope){if(expandable.isOpened||HubState.isCreating)if("App"===value.objectType){var isOutdatedAppId=value.objectID,isOutdatedAppIndex=getIndexFromIsOutdatedApps(isOutdatedAppId),notificationMethod=qrsData.method;-1===isOutdatedAppIndex?isOutdated.apps.push({id:isOutdatedAppId,method:notificationMethod}):("Delete"===notificationMethod||"Add"===notificationMethod&&"Delete"!==isOutdated.apps[isOutdatedAppIndex].method)&&(isOutdated.apps[isOutdatedAppIndex]={id:isOutdatedAppId,method:notificationMethod})}else"Stream"===value.objectType&&(isOutdated.streams=!0);else if("App"===value.objectType){var appId=value.objectID;if("Add"===qrsData.method&&-1===getAppIndexFromApplist(appId,scope))hubModel.rpcCall(qrsSession,"App.Get",[{id:appId,appendPrivileges:!1}]).then(function(app){if(-1===getAppIndexFromApplist(app.result.value.id,scope)&&(scope.appList.push(mapAppData(app.result.value)),scope.$broadcast("newListReady")),HubState.isDuplicating&&!app.result.value.stream&&matchAppTitle(HubState.duplicatingItem.qTitle,app.result.value.name)){var index=getAppIndexFromApplist(app.result.value.id,scope);scope.appList[index].isDisabled=!0,scroll(scope,index)}else hubModel.rpcCall(qrsSession,"App.Get",[{id:appId,appendPrivileges:!0}]).then(function(app){var index=getAppIndexFromApplist(app.result.value.id,scope);-1!==index&&(scope.appList[index]=mapAppData(app.result.value),scope.$broadcast("newListReady"))})});else if("Update"===qrsData.method)hubModel.rpcCall(qrsSession,"App.Get",[{id:appId,appendPrivileges:!0}]).then(function(app){var itemIndex=getAppIndexFromApplist(app.result.value.id,scope);-1!==itemIndex?scope.appList[itemIndex]=mapAppData(app.result.value):scope.appList.push(mapAppData(app.result.value)),scope.$broadcast("newListReady")});else if("Delete"===qrsData.method){var deleteIndex=getAppIndexFromApplist(appId,scope);-1!==deleteIndex&&(scope.appList.splice(deleteIndex,1),scope.$broadcast("newListReady"))}}else"Stream"===value.objectType&&hubModel.rpcCall(qrsSession,"Stream.GetAllCondensed").then(function(streams){scope.streamsList=streams.result.value.map(mapStreamData),hubModel.alphabeticSort(scope.streamsList,"qName"),scope.$broadcast("newListReady")})}function handleQRSNotifications(scope){qrsSession.Notification.bind(function(data){data.params[0].value.forEach(function(iterationValue){iterateQRSNotifications(iterationValue,data,scope)})})}function getBackendData(scope,getAllow,getApps,getStreams){var dfd=new Deferred;return scope.isPersonalMode?hubModel.getApps(getList).then(function(apps){scope.allowCreateApp=!0,scope.appList=apps.map(function(app){return util.hasFileExtension(app.qDocName,"qvw")&&(app.qTitle=app.qTitle+" (qvw)"),app}),scope.streamsList=[],dfd.resolve()}):(qrsSession=hubSession.getQRSSession(),getApps&&(scope.appList=[]),getStreams&&(scope.streamsList=[]),Deferred.all({allow:getAllow?hubModel.rpcCall(qrsSession,"User.AllowCreateApp"):null,apps:getApps?hubModel.rpcCall(qrsSession,"App.GetAll"):null,streams:getStreams?hubModel.rpcCall(qrsSession,"Stream.GetAllCondensed"):null}).then(function(data){data.allow&&(scope.allowCreateApp=data.allow.result.value,exports.allowCreateApp=scope.allowCreateApp),data.apps&&(scope.appList=data.apps.result.value.map(mapAppData),hubModel.alphabeticSortByStream(scope.appList,"qTitle")),data.streams&&(scope.streamsList=data.streams.result.value.map(mapStreamData),hubModel.alphabeticSort(scope.streamsList,"qName")),dfd.resolve()})),dfd.promise}function haxx(scope){$(window).on("blur focus",function(e){var me=$(this);me.data("lastEventTypeOnWindow")!==e.type&&("blur"===e.type?hack.stop():"focus"===e.type&&(clearTimeout(hackTimer),hackTimer=setTimeout(function(){hack.timeFetchApps(function(){getBackendData(scope).then(function(){expandable.isOpened||scope.$broadcast("newListReady")})},scope,!0)},500))),me.data("lastEventTypeOnWindow",e.type)}),hack.timeFetchApps(function(){expandable.isOpened||getBackendData(scope)},scope),scope.$on("errorHandlerOpen",function(){hack.stop()}),scope.$on("appListModified",function(event,appAdded){hack.timeFetchApps(function(){getBackendData(scope).then(function(){appAdded&&expandable.isOpened||scope.$broadcast("newListReady")})},scope,!0)})}function checkIfStreamExist(getSid,streamList,reRouteClient){var sId=getSid(),exist=!1;return sId&&(streamList.forEach(function(o){o.qId===sId&&(exist=!0)}),exist||reRouteClient()),exist}function setScopeDefaults(scope){scope.setGridListView=function(){HubState.isGlobalSearch?scope.isGrid=!1:scope.isGrid=!scope.isSmallDevice||scope.isSmallDevice&&scope.isPortrait},scope.createHubItem=function(title){return HubState.setIsCreating(!0),App.create(title,engineSession)},scope.hideGettingStarted=!!localStorage.getItem("qvHideHubGettingStarted"),scope.route="",scope.streamId=null,scope.removeLoader=!1,scope.setGridListView(),scope.exp.selectedFilter=hubModel.SortFilterOptions.alphabetical,scope.exp.sections=[],scope.exp.isAscending=!0,scope.savedIsAscending=!0,scope.updatedByUser=!0,scope.isPersonalMode=!1}function getInitialData(){return Deferred.all({QvVersion:hubModel.rpcCall(engineSession,"QvVersion"),IsPersonalMode:hubModel.rpcCall(engineSession,"IsPersonalMode")})}function scroll($scope,index){expandable.isOpened||$timeout(function(){var scrollItem=$(".qv-content-li").find("*:contains("+$scope.appList[index].qTitle+")");scrollItem.length&&domUtil.scrollElmentIntoView($(scrollItem[0]),$(".hub-as")),scrollItem=null})}function duplicateAnimation($scope,index){var app=$scope.appList[index],appId=app.qDocId;app.animation=!0,$timeout(function(){var listIndex=getAppIndexFromApplist(appId,$scope);-1!==listIndex&&($scope.appList[listIndex].animation=!1)},2e3)}function setup($scope){function handleOutdated(){function getApp(app){var itemIndex=getAppIndexFromApplist(app.result.value.id,$scope);-1===itemIndex?$scope.appList.push(mapAppData(app.result.value)):$scope.appList[itemIndex]=mapAppData(app.result.value),rpcResponseCounter++,rpcCallCounter===rpcResponseCounter&&($scope.$broadcast("newListReady"),isOutdated.apps=[])}var rpcCallCounter=0,rpcResponseCounter=0;if(isOutdated.apps.length){for(var hasDeleted=!1,i=0;i<isOutdated.apps.length;i++)"Delete"!==isOutdated.apps[i].method&&rpcCallCounter++;hasDeleted=rpcCallCounter<isOutdated.apps.length;for(var index=0;index<isOutdated.apps.length;index++)"Delete"!==isOutdated.apps[index].method?hubModel.rpcCall(qrsSession,"App.Get",[{id:isOutdated.apps[index].id,appendPrivileges:!0}]).then(getApp):$scope.appList.splice(getAppIndexFromApplist(isOutdated.apps[index].id,$scope),1);hasDeleted&&$scope.$broadcast("newListReady"),0===rpcCallCounter&&hasDeleted&&(isOutdated.apps=[])}isOutdated.streams&&getBackendData($scope,!1,!1,!0).then(function(){isOutdated.streams=!1,$scope.$broadcast("newListReady")})}var dfd=new Deferred;return engineSession=hubSession.getEngineSession(),engineSession.Close.bind(function(){$timeout(function(){ErrorHandler.showDialog({code:EngineEnums.NxLocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST})},1e3)}),setScopeDefaults($scope),getInitialData().then(function(args){$scope.qvVersion=getResult(args.QvVersion),$scope.isPersonalMode=getResult(args.IsPersonalMode),$scope.$root.isPersonalMode=$scope.isPersonalMode,helpUrl.setBaseUrl($scope.$root.isPersonalMode),$scope.hideSidebar=$scope.isPersonalMode,getBackendData($scope,!0,!0,!0).then(function(){dfd.resolve(),$scope.isPersonalMode?haxx($scope):(setupQRSNotifications($scope),handleQRSNotifications($scope))}),$scope.isPersonalMode||$scope.$root.$on("expandableDestroyed",handleOutdated)}),HubState.CreatingChanged.bind(function(){HubState.isCreating||handleOutdated()}),HubState.DuplicatingChanged.bind(function(obj){if(!HubState.isDuplicating){var index=getAppIndexFromApplist(obj.duplicatingItem.id,$scope);if(expandable.isOpened){var isOutdatedAppIndex=getIndexFromIsOutdatedApps(obj.duplicatingItem.id);return void(-1!==index?($scope.appList[index].isDisabled=!1,-1===isOutdatedAppIndex&&isOutdated.apps.push({id:obj.duplicatingItem.id,method:"Update"})):-1===isOutdatedAppIndex?isOutdated.apps.push({id:obj.duplicatingItem.id,method:"Add"}):"Delete"!==isOutdated.apps[isOutdatedAppIndex].method&&(isOutdated.apps[isOutdatedAppIndex]={id:obj.duplicatingItem.id,method:"Add"}))}hubModel.rpcCall(qrsSession,"App.Get",[{id:obj.duplicatingItem.id,appendPrivileges:!0}]).then(function(app){index=getAppIndexFromApplist(obj.duplicatingItem.id,$scope),-1===index?($scope.appList.push(mapAppData(app.result.value)),$scope.$broadcast("newListReady"),index=getAppIndexFromApplist(obj.duplicatingItem.id,$scope),scroll($scope,index),duplicateAnimation($scope,index)):($scope.appList[index].isDisabled=!1,$scope.appList[index]=mapAppData(app.result.value),duplicateAnimation($scope,index),$scope.$broadcast("newListReady"))})}}),dfd.promise}var hackTimer,engineSession,qrsSession,isOutdated={apps:[],streams:!1},expandable=qvangular.getService("$$expandable"),exports={},$timeout=qvangular.getService("$timeout");return{setup:setup,checkIfStreamExist:checkIfStreamExist,exports:exports}}),define("assets/hub/hub-routing",["general.controllers/route-controller","general.models/route","qvangular","assets/hub/hub-model","assets/hub/hub-routing-manager","assets/hub/hub-factory","general.utils/responsive-state","hub.files/hub-state"],function(RouteController,Route,qvangular,hubModel,hubRouteManager,hubFactory,ResponsiveState,HubState){function goTo(route){$hubScope.route=route,activeKey=route,_newRouteBcast()}function _setup(scope){$hubScope=scope,_createRoutes()}function _newRouteBcast(){$hubScope.$broadcast("newRoute"),qvangular.$apply($hubScope)}function _createRoutes(){var stream=new Route({name:"stream",pattern:"/stream/{name}"}),my=new Route({name:"myWork",pattern:"/my/{name}"}),noRoute=new Route({name:"noRoute",pattern:"/no/route"});my.Route.bind(function(name){return hubRouteManager.hasMyWork($hubScope,hubModel)?"HOME"===name.toUpperCase()?void goTo("my-home"):void goTo("my-work"):void 0}),noRoute.Route.bind(function(){$hubScope.noRoute=!0,goTo("no-route")}),noRoute.DeRoute.bind(function(){$hubScope.noRoute=!1}),stream.Route.bind(function(streamId){$hubScope.route="stream",$hubScope.streamId=streamId,activeKey=streamId,_newRouteBcast()}),stream.DeRoute.bind(function(){$hubScope.streamId=null}),RouteController.addRoute(stream),RouteController.addRoute(my),RouteController.addRoute(noRoute),RouteController.start(),hubRouteManager.check({getActive:_getActive,changeRoute:_changeRoute,RouteController:RouteController,$hubScope:$hubScope,
hubModel:hubModel,hubFactory:hubFactory,isSmallDevice:ResponsiveState.isSmallDevice}),HubState.setView()}function _getActive(){return activeKey}function _changeRoute(url){RouteController.setUrl(url)}var $hubScope,activeKey;return{init:_setup,changeUrl:_changeRoute,getActiveKey:_getActive}}),define("text!assets/hub/hub.ng.html",[],function(){return'<qve-hub-toolbar></qve-hub-toolbar>\r\n<div class=\'qui-toolbar-footer\'></div>\r\n<div class="hub-content-wrapper" ng-class="{\'noScroll\': !hideSidebar && isSmallDevice}">\r\n	<qve-mobile-search></qve-mobile-search>\r\n	<div class="hub-content" ng-class="{\'hub-global-search\': isGlobalSearch}">\r\n		<qve-side-menu ng-if="!hideSidebar" ng-hide="noRoute"></qve-side-menu>\r\n		<div class="hub-top-and-content" ng-show="(hideSidebar || !isSmallDevice) && !noRoute">\r\n			<qve-toolbar></qve-toolbar>\r\n			<qve-content></qve-content>\r\n		</div>\r\n		<div class="hub-noRoute-wrapper">\r\n			<div class="hub-noRoute" ng-if="noRoute" q-translation="Hub.NoRoute"></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n<qve-hub-getting-started ng-if="!hideGettingStarted && isPersonalMode" create-app="createApp()"></qve-hub-getting-started>\r\n<qve-marketing-placeholder ng-if="isPersonalMode"></qve-marketing-placeholder>'}),define("text!general.services/fullscreen-message/fullscreen-message.ng.html",[],function(){return'<div class="qv-block-ui fullscreen-message">\r\n	<div>\r\n		<div class="msg-text" q-translation="{{message}}"></div>\r\n		<button\r\n			ng-if="button"\r\n			qva-activate="button.callback()"\r\n			qv-enter="button.callback()"\r\n			class="qui-button"\r\n			q-translation="{{button.name}}"\r\n			></button>\r\n	</div>\r\n</div>'}),define("text!general.services/loader/rain/rain-loader.ng.html",[],function(){return'<div class="rain rain-loader qv-block-ui" ng-class="{\'qv-fade-out\': fadeOut, \'qv-transparent-background\': transparentBackground}" tid="3e1f54">\r\n	<div class="qv-animate progress-loader qv-loader-container" ng-class="ngClasses">\r\n		<div class="one">\r\n			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\r\n				<g>\r\n					<path class="path"\r\n						  d="M105,205c-26.7,0-51.8-10.4-70.7-29.3C15.4,156.8,5,131.7,5,105s10.4-51.8,29.3-70.7C53.2,15.4,78.3,5,105,5 c55.1,0,100,44.9,100,100S160.1,205,105,205z M105,23.7c-44.8,0-81.3,36.5-81.3,81.3c0,44.8,36.5,81.3,81.3,81.3 c44.8,0,81.3-36.5,81.3-81.3C186.3,60.2,149.8,23.7,105,23.7z"/>\r\n				</g>\r\n			</svg>\r\n		</div>\r\n		<div class="two">\r\n			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\r\n				<g>\r\n					<path class="path"\r\n						  d="M105,205C49.9,205,5,160.1,5,105C5,49.9,49.9,5,105,5c55.1,0,100,44.9,100,100C205,160.1,160.1,205,105,205z M105,19.4c-47.2,0-85.6,38.4-85.6,85.6c0,47.2,38.4,85.6,85.6,85.6c47.2,0,85.6-38.4,85.6-85.6C190.6,57.8,152.2,19.4,105,19.4z"/>\r\n				</g>\r\n			</svg>\r\n		</div>\r\n		<div class="three">\r\n			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\r\n				<g>\r\n					<path class="path"\r\n						  d="M105,205c-26.7,0-51.8-10.4-70.7-29.3C15.4,156.8,5,131.7,5,105s10.4-51.8,29.3-70.7C53.2,15.4,78.3,5,105,5 c55.1,0,100,44.9,100,100S160.1,205,105,205z"/>\r\n				</g>\r\n			</svg>\r\n		</div>\r\n		<div class="four">\r\n			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\r\n				<g>\r\n					<path class="path"\r\n						  d="M105,205C49.9,205,5,160.1,5,105C5,49.9,49.9,5,105,5c55.1,0,100,44.9,100,100C205,160.1,160.1,205,105,205z M105,19.4c-47.2,0-85.6,38.4-85.6,85.6c0,47.2,38.4,85.6,85.6,85.6c47.2,0,85.6-38.4,85.6-85.6C190.6,57.8,152.2,19.4,105,19.4z"/>\r\n				</g>\r\n			</svg>\r\n		</div>\r\n		<div class="five">\r\n			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\r\n				<g>\r\n					<path class="path"\r\n						  d="M105 205C49.9 205 5 160.1 5 105C5 49.9 49.9 5 105 5c55.1 0 100 44.9 100 100C205 160.1 160.1 205 105 205z M105 10.5c-52.1 0-94.5 42.4-94.5 94.5c0 52.1 42.4 94.5 94.5 94.5c52.1 0 94.5-42.4 94.5-94.5C199.5 52.9 157.1 10.5 105 10.5z"/>\r\n				</g>\r\n			</svg>\r\n		</div>\r\n		<div class="six">\r\n			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\r\n				<g>\r\n					<path class="path"\r\n						  d="M105,205c-26.7,0-51.8-10.4-70.7-29.3C15.4,156.8,5,131.7,5,105s10.4-51.8,29.3-70.7C53.2,15.4,78.3,5,105,5 c55.1,0,100,44.9,100,100S160.1,205,105,205z"/>\r\n				</g>\r\n			</svg>\r\n		</div>\r\n		<div class="seven">\r\n			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\r\n				<g>\r\n					<path class="path"\r\n						  d="M105,205C49.9,205,5,160.1,5,105C5,49.9,49.9,5,105,5c55.1,0,100,44.9,100,100C205,160.1,160.1,205,105,205z M105,19.4c-47.2,0-85.6,38.4-85.6,85.6c0,47.2,38.4,85.6,85.6,85.6c47.2,0,85.6-38.4,85.6-85.6C190.6,57.8,152.2,19.4,105,19.4z"/>\r\n				</g>\r\n			</svg>\r\n		</div>\r\n	</div>\r\n	<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\r\n		<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\r\n		<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\r\n	</div>\r\n</div>\r\n'}),define("general.services/loader/loader",["qvangular","text!general.services/loader/rain/rain-loader.ng.html","core.utils/deferred","angular"],function(qvangular,defaultTemplate,Deferred){qvangular.service("qvLoader",["$compile","$rootScope","$document","$timeout",function($compile,$rootScope,$document,$timeout){function reset(){$scope.template=defaultTemplate,$scope.hugeLoader=!0,$scope.bigLoader=!1,$scope.mediumLoader=!1,$scope.normalLoader=!1,$scope.smallLoader=!1,$scope.tinyLoader=!1}function cleanup(){reset();for(var k in options)$scope[k]=null,delete $scope[k];$scope.ngClasses["qv-fade-in"]=!1,element&&element.off().remove(),element=null,$container=null,dummyLoad&&(dummyLoad.remove(),dummyLoad=null)}var element,$container,dummyLoad,timer,$scope=$rootScope.$new(),$body=$document.find("body"),options={};return reset(),dummyLoad=$body.find("#qv-init-ui-blocker"),{show:function(o){var appendTo;$scope.fadeOut=!1,$timeout.cancel(timer),options=o||{};for(var k in o)$scope[k]=o[k];$scope.ngClasses={"qv-loader-huge":$scope.hugeLoader,"qv-loader-big":$scope.bigLoader,"qv-loader-medium":$scope.mediumLoader,"qv-loader-normal":$scope.normalLoader,"qv-loader-small":$scope.smallLoader,"qv-loader-tiny":$scope.tinyLoader,"qv-fade-in":!1},appendTo=$scope.appendTo?$scope.appendTo:$body,$container=angular.element($scope.template),element=$compile($container)($scope).appendTo(appendTo),$scope.appendTo=null,delete $scope.appendTo,timer=$timeout(function(){$scope.ngClasses["qv-fade-in"]=!0}),dummyLoad&&dummyLoad.length>0&&dummyLoad.fadeOut(800,function(){dummyLoad=null})},setMessageObj:function(msg){$scope.messageObj.task=msg},close:function(immediately){var deferred=new Deferred,time=750;return $timeout.cancel(timer),immediately?($scope.fadeOut=!0,cleanup(),deferred.resolve()):$timeout(function(){$scope.fadeOut=!0,timer=$timeout(function(){return cleanup(),deferred.resolve()},time+200)},time),deferred.promise}}}])}),define("general.services/fullscreen-message/fullscreen-message",["qvangular","text!general.services/fullscreen-message/fullscreen-message.ng.html","general.services/loader/loader"],function(qvangular,template){function show(args){$qvLoader.show({template:template,message:args.message,button:args.button,mode:args.mode})}function close(args){$qvLoader.close(args)}var $qvLoader=qvangular.getService("qvLoader");return{show:show,close:close}}),define("general.utils/touch-configuration-util",["jquery","general.utils/support"],function($,Support){"use strict";return{configureTouchSupport:function(){$(document.body.parentElement).addClass("touch-"+(Support.treatAsDesktop()?"off":"on"))}}}),
//! moment.js
//! version : 2.4.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
function(undefined){function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function ordinalizeToken(func,period){return function(a){return this.lang().ordinal(func.call(this,a),period)}}function Language(){}function Moment(config){checkOverflow(config),extend(this,config)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._input=duration,this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+36e5*hours,this._days=+days+7*weeks,this._months=+months+12*years,this._data={},this._bubble()}function extend(a,b){for(var i in b)b.hasOwnProperty(i)&&(a[i]=b[i]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function absRound(number){return 0>number?Math.ceil(number):Math.floor(number)}function leftZeroFill(number,targetLength){for(var output=number+"";output.length<targetLength;)output="0"+output;return output}function addOrSubtractDurationFromMoment(mom,duration,isAdding,ignoreUpdateOffset){var minutes,hours,milliseconds=duration._milliseconds,days=duration._days,months=duration._months;milliseconds&&mom._d.setTime(+mom._d+milliseconds*isAdding),(days||months)&&(minutes=mom.minute(),hours=mom.hour()),days&&mom.date(mom.date()+days*isAdding),months&&mom.month(mom.month()+months*isAdding),milliseconds&&!ignoreUpdateOffset&&moment.updateOffset(mom),(days||months)&&(mom.minute(minutes),mom.hour(hours))}function isArray(input){return"[object Array]"===Object.prototype.toString.call(input)}function isDate(input){return"[object Date]"===Object.prototype.toString.call(input)||input instanceof Date}function compareArrays(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;len>i;i++)(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i]))&&diffs++;return diffs+lengthDiff}function normalizeUnits(units){if(units){var lowered=units.toLowerCase().replace(/(.)s$/,"$1");units=unitAliases[units]||camelFunctions[lowered]||lowered}return units}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)inputObject.hasOwnProperty(prop)&&(normalizedProp=normalizeUnits(prop),normalizedProp&&(normalizedInput[normalizedProp]=inputObject[prop]));return normalizedInput}function makeList(field){var count,setter;if(0===field.indexOf("week"))count=7,setter="day";else{if(0!==field.indexOf("month"))return;count=12,setter="month"}moment[field]=function(format,index){var i,getter,method=moment.fn._lang[field],results=[];if("number"==typeof format&&(index=format,format=undefined),getter=function(i){var m=moment().utc().set(setter,i);return method.call(moment.fn._lang,m,format||"")},null!=index)return getter(index);for(i=0;count>i;i++)results.push(getter(i));return results}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=coercedNumber>=0?Math.floor(coercedNumber):Math.ceil(coercedNumber)),value}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}function checkOverflow(m){var overflow;m._a&&-2===m._pf.overflow&&(overflow=m._a[MONTH]<0||m._a[MONTH]>11?MONTH:m._a[DATE]<1||m._a[DATE]>daysInMonth(m._a[YEAR],m._a[MONTH])?DATE:m._a[HOUR]<0||m._a[HOUR]>23?HOUR:m._a[MINUTE]<0||m._a[MINUTE]>59?MINUTE:m._a[SECOND]<0||m._a[SECOND]>59?SECOND:m._a[MILLISECOND]<0||m._a[MILLISECOND]>999?MILLISECOND:-1,m._pf._overflowDayOfYear&&(YEAR>overflow||overflow>DATE)&&(overflow=DATE),m._pf.overflow=overflow)}function initializeParsingFlags(config){config._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function isValid(m){return null==m._isValid&&(m._isValid=!isNaN(m._d.getTime())&&m._pf.overflow<0&&!m._pf.empty&&!m._pf.invalidMonth&&!m._pf.nullInput&&!m._pf.invalidFormat&&!m._pf.userInvalidated,m._strict&&(m._isValid=m._isValid&&0===m._pf.charsLeftOver&&0===m._pf.unusedTokens.length)),m._isValid}function normalizeLanguage(key){return key?key.toLowerCase().replace("_","-"):key}function loadLang(key,values){return values.abbr=key,languages[key]||(languages[key]=new Language),languages[key].set(values),languages[key]}function unloadLang(key){delete languages[key]}function getLangDefinition(key){var j,lang,next,split,i=0,get=function(k){if(!languages[k]&&hasModule)try{require("./lang/"+k)}catch(e){}return languages[k]};if(!key)return moment.fn._lang;if(!isArray(key)){if(lang=get(key))return lang;key=[key]}for(;i<key.length;){for(split=normalizeLanguage(key[i]).split("-"),j=split.length,next=normalizeLanguage(key[i+1]),next=next?next.split("-"):null;j>0;){if(lang=get(split.slice(0,j).join("-")))return lang;if(next&&next.length>=j&&compareArrays(split,next,!0)>=j-1)break;j--}i++}return moment.fn._lang}function removeFormattingTokens(input){return input.match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;length>i;i++)formatTokenFunctions[array[i]]?array[i]=formatTokenFunctions[array[i]]:array[i]=removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;length>i;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.lang()),formatFunctions[format]||(formatFunctions[format]=makeFormatFunction(format)),formatFunctions[format](m)):m.lang().invalidDate()}function expandFormat(format,lang){function replaceLongDateFormatTokens(input){return lang.longDateFormat(input)||input}var i=5;for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens),localFormattingTokens.lastIndex=0,i-=1;return format}function getParseRegexForToken(token,config){var a;switch(token){case"DDDD":return parseTokenThreeDigits;case"YYYY":case"GGGG":case"gggg":return parseTokenFourDigits;case"YYYYY":case"GGGGG":case"ggggg":return parseTokenSixDigits;case"S":case"SS":case"SSS":case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return parseTokenWord;case"a":case"A":return getLangDefinition(config._l)._meridiemParse;case"X":return parseTokenTimestampMs;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"SSSS":return parseTokenDigits;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"ww":case"W":case"WW":case"e":case"E":return parseTokenOneOrTwoDigits;default:return a=new RegExp(regexpEscape(unescapeFormat(token.replace("\\","")),"i"))}}function timezoneMinutesFromString(string){var tzchunk=(parseTokenTimezone.exec(string)||[])[0],parts=(tzchunk+"").match(parseTimezoneChunker)||["-",0,0],minutes=+(60*parts[1])+toInt(parts[2]);return"+"===parts[0]?-minutes:minutes}function addTimeToArrayFromToken(token,input,config){var a,datePartArray=config._a;switch(token){case"M":case"MM":null!=input&&(datePartArray[MONTH]=toInt(input)-1);break;case"MMM":case"MMMM":a=getLangDefinition(config._l).monthsParse(input),null!=a?datePartArray[MONTH]=a:config._pf.invalidMonth=input;break;case"D":case"DD":null!=input&&(datePartArray[DATE]=toInt(input));break;case"DDD":case"DDDD":null!=input&&(config._dayOfYear=toInt(input));break;case"YY":datePartArray[YEAR]=toInt(input)+(toInt(input)>68?1900:2e3);break;case"YYYY":case"YYYYY":datePartArray[YEAR]=toInt(input);break;case"a":case"A":config._isPm=getLangDefinition(config._l).isPM(input);break;case"H":case"HH":case"h":case"hh":datePartArray[HOUR]=toInt(input);break;case"m":case"mm":datePartArray[MINUTE]=toInt(input);break;case"s":case"ss":datePartArray[SECOND]=toInt(input);break;case"S":case"SS":case"SSS":case"SSSS":datePartArray[MILLISECOND]=toInt(1e3*("0."+input));break;case"X":config._d=new Date(1e3*parseFloat(input));break;case"Z":case"ZZ":config._useUTC=!0,config._tzm=timezoneMinutesFromString(input);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":token=token.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":token=token.substr(0,2),input&&(config._w=config._w||{},config._w[token]=input)}}function dateFromConfig(config){var i,date,currentDate,yearToUse,fixYear,w,temp,lang,weekday,week,input=[];if(!config._d){for(currentDate=currentDateArray(config),config._w&&null==config._a[DATE]&&null==config._a[MONTH]&&(fixYear=function(val){return val?val.length<3?parseInt(val,10)>68?"19"+val:"20"+val:val:null==config._a[YEAR]?moment().weekYear():config._a[YEAR]},w=config._w,null!=w.GG||null!=w.W||null!=w.E?temp=dayOfYearFromWeeks(fixYear(w.GG),w.W||1,w.E,4,1):(lang=getLangDefinition(config._l),weekday=null!=w.d?parseWeekday(w.d,lang):null!=w.e?parseInt(w.e,10)+lang._week.dow:0,week=parseInt(w.w,10)||1,null!=w.d&&weekday<lang._week.dow&&week++,temp=dayOfYearFromWeeks(fixYear(w.gg),week,weekday,lang._week.doy,lang._week.dow)),config._a[YEAR]=temp.year,config._dayOfYear=temp.dayOfYear),config._dayOfYear&&(yearToUse=null==config._a[YEAR]?currentDate[YEAR]:config._a[YEAR],config._dayOfYear>daysInYear(yearToUse)&&(config._pf._overflowDayOfYear=!0),date=makeUTCDate(yearToUse,0,config._dayOfYear),config._a[MONTH]=date.getUTCMonth(),config._a[DATE]=date.getUTCDate()),i=0;3>i&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;7>i;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];input[HOUR]+=toInt((config._tzm||0)/60),input[MINUTE]+=toInt((config._tzm||0)%60),config._d=(config._useUTC?makeUTCDate:makeDate).apply(null,input)}}function dateFromObject(config){var normalizedInput;config._d||(normalizedInput=normalizeObjectUnits(config._i),config._a=[normalizedInput.year,normalizedInput.month,normalizedInput.day,normalizedInput.hour,normalizedInput.minute,normalizedInput.second,normalizedInput.millisecond],dateFromConfig(config))}function currentDateArray(config){var now=new Date;return config._useUTC?[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]:[now.getFullYear(),now.getMonth(),now.getDate()]}function makeDateFromStringAndFormat(config){config._a=[],config._pf.empty=!0;var i,parsedInput,tokens,token,skipped,lang=getLangDefinition(config._l),string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,lang).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],parsedInput=(getParseRegexForToken(token,config).exec(string)||[])[0],parsedInput&&(skipped=string.substr(0,string.indexOf(parsedInput)),skipped.length>0&&config._pf.unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?config._pf.empty=!1:config._pf.unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&config._pf.unusedTokens.push(token);config._pf.charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&config._pf.unusedInput.push(string),config._isPm&&config._a[HOUR]<12&&(config._a[HOUR]+=12),config._isPm===!1&&12===config._a[HOUR]&&(config._a[HOUR]=0),dateFromConfig(config),checkOverflow(config)}function unescapeFormat(s){return s.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4})}function regexpEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function makeDateFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(0===config._f.length)return config._pf.invalidFormat=!0,void(config._d=new Date(NaN));for(i=0;i<config._f.length;i++)currentScore=0,tempConfig=extend({},config),initializeParsingFlags(tempConfig),tempConfig._f=config._f[i],makeDateFromStringAndFormat(tempConfig),isValid(tempConfig)&&(currentScore+=tempConfig._pf.charsLeftOver,currentScore+=10*tempConfig._pf.unusedTokens.length,tempConfig._pf.score=currentScore,(null==scoreToBeat||scoreToBeat>currentScore)&&(scoreToBeat=currentScore,bestMoment=tempConfig));extend(config,bestMoment||tempConfig)}function makeDateFromString(config){var i,string=config._i,match=isoRegex.exec(string);if(match){for(config._pf.iso=!0,i=4;i>0;i--)if(match[i]){config._f=isoDates[i-1]+(match[6]||" ");break}for(i=0;4>i;i++)if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}parseTokenTimezone.exec(string)&&(config._f+="Z"),makeDateFromStringAndFormat(config)}else config._d=new Date(string)}function makeDateFromInput(config){var input=config._i,matched=aspNetJsonRegex.exec(input);input===undefined?config._d=new Date:matched?config._d=new Date(+matched[1]):"string"==typeof input?makeDateFromString(config):isArray(input)?(config._a=input.slice(0),dateFromConfig(config)):isDate(input)?config._d=new Date(+input):"object"==typeof input?dateFromObject(config):config._d=new Date(input)}function makeDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);return 1970>y&&date.setFullYear(y),date}function makeUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));return 1970>y&&date.setUTCFullYear(y),date}function parseWeekday(input,language){if("string"==typeof input)if(isNaN(input)){if(input=language.weekdaysParse(input),"number"!=typeof input)return null}else input=parseInt(input,10);return input}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){return lang.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1e3),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=45>seconds&&["s",seconds]||1===minutes&&["m"]||45>minutes&&["mm",minutes]||1===hours&&["h"]||22>hours&&["hh",hours]||1===days&&["d"]||25>=days&&["dd",days]||45>=days&&["M"]||345>days&&["MM",round(days/30)]||1===years&&["y"]||["yy",years];return args[2]=withoutSuffix,args[3]=milliseconds>0,args[4]=lang,substituteTimeAgo.apply({},args)}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var adjustedMoment,end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();return daysToDayOfWeek>end&&(daysToDayOfWeek-=7),end-7>daysToDayOfWeek&&(daysToDayOfWeek+=7),adjustedMoment=moment(mom).add("d",daysToDayOfWeek),{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var daysToAdd,dayOfYear,d=new Date(Date.UTC(year,0)).getUTCDay();return weekday=null!=weekday?weekday:firstDayOfWeek,daysToAdd=firstDayOfWeek-d+(d>firstDayOfWeekOfYear?7:0),dayOfYear=7*(week-1)+(weekday-firstDayOfWeek)+daysToAdd+1,{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function makeMoment(config){var input=config._i,format=config._f;return"undefined"==typeof config._pf&&initializeParsingFlags(config),null===input?moment.invalid({nullInput:!0}):("string"==typeof input&&(config._i=input=getLangDefinition().preparse(input)),moment.isMoment(input)?(config=extend({},input),config._d=new Date(+input._d)):format?isArray(format)?makeDateFromStringAndArray(config):makeDateFromStringAndFormat(config):makeDateFromInput(config),new Moment(config))}function makeGetterAndSetter(name,key){moment.fn[name]=moment.fn[name+"s"]=function(input){var utc=this._isUTC?"UTC":"";return null!=input?(this._d["set"+utc+key](input),moment.updateOffset(this),this):this._d["get"+utc+key]()}}function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name]}}function makeDurationAsGetter(name,factor){moment.duration.fn["as"+name]=function(){return+this/factor}}function makeGlobal(deprecate){var warned=!1,local_moment=moment;"undefined"==typeof ender&&(deprecate?this.moment=function(){return!warned&&console&&console.warn&&(warned=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),local_moment.apply(null,arguments)}:this.moment=moment)}for(var moment,i,VERSION="2.4.0",round=Math.round,YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6,languages={},hasModule="undefined"!=typeof module&&module.exports,aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,aspNetTimeSpanJsonRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,isoDurationRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{1,4}/,parseTokenSixDigits=/[+\-]?\d{1,6}/,parseTokenDigits=/\d+/,parseTokenWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/i,parseTokenT=/T/i,parseTokenTimestampMs=/[\+\-]?\d+(\.\d{1,3})?/,isoRegex=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d:?\d\d|Z)?)?$/,isoFormat="YYYY-MM-DDTHH:mm:ssZ",isoDates=["YYYY-MM-DD","GGGG-[W]WW","GGGG-[W]WW-E","YYYY-DDD"],isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),unitMillisecondFactors={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},unitAliases={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},camelFunctions={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},formatFunctions={},ordinalizeTokens="DDD w W M D d".split(" "),paddedTokens="M D H h m s w W".split(" "),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return this.lang().monthsShort(this,format)},MMMM:function(format){return this.lang().months(this,format)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(format){return this.lang().weekdaysMin(this,format)},ddd:function(format){return this.lang().weekdaysShort(this,format)},dddd:function(format){return this.lang().weekdays(this,format)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},YYYYY:function(){return leftZeroFill(this.year(),5)},gg:function(){return leftZeroFill(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return leftZeroFill(this.weekYear(),5)},GG:function(){return leftZeroFill(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return leftZeroFill(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return toInt(this.milliseconds()/100)},SS:function(){return leftZeroFill(toInt(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},SSSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+leftZeroFill(toInt(a/60),2)+":"+leftZeroFill(toInt(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+leftZeroFill(toInt(10*a/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}},lists=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ordinalizeTokens.length;)i=ordinalizeTokens.pop(),formatTokenFunctions[i+"o"]=ordinalizeToken(formatTokenFunctions[i],i);for(;paddedTokens.length;)i=paddedTokens.pop(),formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2);for(formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3),extend(Language.prototype,{set:function(config){var prop,i;for(i in config)prop=config[i],"function"==typeof prop?this[i]=prop:this["_"+i]=prop},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(m){return this._months[m.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(m){return this._monthsShort[m.month()]},monthsParse:function(monthName){var i,mom,regex;for(this._monthsParse||(this._monthsParse=[]),i=0;12>i;i++)if(this._monthsParse[i]||(mom=moment.utc([2e3,i]),regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),this._monthsParse[i].test(monthName))return i},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(m){return this._weekdays[m.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(m){return this._weekdaysShort[m.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(m){return this._weekdaysMin[m.day()]},weekdaysParse:function(weekdayName){var i,mom,regex;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;7>i;i++)if(this._weekdaysParse[i]||(mom=moment([2e3,1]).day(i),regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),this._weekdaysParse[i].test(weekdayName))return i},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(key){var output=this._longDateFormat[key];return!output&&this._longDateFormat[key.toUpperCase()]&&(output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)}),this._longDateFormat[key]=output),output},isPM:function(input){return"p"===(input+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(key,mom){var output=this._calendar[key];return"function"==typeof output?output.apply(mom):output},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},pastFuture:function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return"function"==typeof format?format(output):format.replace(/%s/i,output)},ordinal:function(number){return this._ordinal.replace("%d",number)},_ordinal:"%d",preparse:function(string){return string},postformat:function(string){return string},week:function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),moment=function(input,format,lang,strict){return"boolean"==typeof lang&&(strict=lang,lang=undefined),makeMoment({_i:input,_f:format,_l:lang,_strict:strict,_isUTC:!1})},moment.utc=function(input,format,lang,strict){var m;return"boolean"==typeof lang&&(strict=lang,lang=undefined),m=makeMoment({_useUTC:!0,_isUTC:!0,_l:lang,_i:input,_f:format,_strict:strict}).utc()},moment.unix=function(input){return moment(1e3*input)},moment.duration=function(input,key){var sign,ret,parseIso,isDuration=moment.isDuration(input),isNumber="number"==typeof input,duration=isDuration?input._input:isNumber?{}:input,match=null;return isNumber?key?duration[key]=input:duration.milliseconds=input:(match=aspNetTimeSpanJsonRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}):(match=isoDurationRegex.exec(input))&&(sign="-"===match[1]?-1:1,parseIso=function(inp){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign},duration={y:parseIso(match[2]),M:parseIso(match[3]),d:parseIso(match[4]),h:parseIso(match[5]),m:parseIso(match[6]),s:parseIso(match[7]),w:parseIso(match[8])}),ret=new Duration(duration),isDuration&&input.hasOwnProperty("_lang")&&(ret._lang=input._lang),ret},moment.version=VERSION,moment.defaultFormat=isoFormat,moment.updateOffset=function(){},moment.lang=function(key,values){var r;return key?(values?loadLang(normalizeLanguage(key),values):null===values?(unloadLang(key),key="en"):languages[key]||getLangDefinition(key),r=moment.duration.fn._lang=moment.fn._lang=getLangDefinition(key),r._abbr):moment.fn._lang._abbr},moment.langData=function(key){return key&&key._lang&&key._lang._abbr&&(key=key._lang._abbr),getLangDefinition(key)},moment.isMoment=function(obj){return obj instanceof Moment},moment.isDuration=function(obj){return obj instanceof Duration},i=lists.length-1;i>=0;--i)makeList(lists[i]);for(moment.normalizeUnits=function(units){return normalizeUnits(units)},moment.invalid=function(flags){var m=moment.utc(NaN);return null!=flags?extend(m._pf,flags):m._pf.userInvalidated=!0,m},moment.parseZone=function(input){return moment(input).parseZone()},extend(moment.fn=Moment.prototype,{clone:function(){return moment(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return formatMoment(moment(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds()]},isValid:function(){return isValid(this)},isDSTShifted:function(){return this._a?this.isValid()&&compareArrays(this._a,(this._isUTC?moment.utc(this._a):moment(this._a)).toArray())>0:!1},parsingFlags:function(){return extend({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(inputString){var output=formatMoment(this,inputString||moment.defaultFormat);return this.lang().postformat(output)},add:function(input,val){var dur;return dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val),addOrSubtractDurationFromMoment(this,dur,1),this},subtract:function(input,val){var dur;return dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val),addOrSubtractDurationFromMoment(this,dur,-1),this},diff:function(input,units,asFloat){var diff,output,that=this._isUTC?moment(input).zone(this._offset||0):moment(input).local(),zoneDiff=6e4*(this.zone()-that.zone());return units=normalizeUnits(units),"year"===units||"month"===units?(diff=432e5*(this.daysInMonth()+that.daysInMonth()),output=12*(this.year()-that.year())+(this.month()-that.month()),output+=(this-moment(this).startOf("month")-(that-moment(that).startOf("month")))/diff,output-=6e4*(this.zone()-moment(this).startOf("month").zone()-(that.zone()-moment(that).startOf("month").zone()))/diff,"year"===units&&(output/=12)):(diff=this-that,output="second"===units?diff/1e3:"minute"===units?diff/6e4:"hour"===units?diff/36e5:"day"===units?(diff-zoneDiff)/864e5:"week"===units?(diff-zoneDiff)/6048e5:diff),asFloat?output:absRound(output)},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this.lang()._abbr).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(){var diff=this.diff(moment().zone(this.zone()).startOf("day"),"days",!0),format=-6>diff?"sameElse":-1>diff?"lastWeek":0>diff?"lastDay":1>diff?"sameDay":2>diff?"nextDay":7>diff?"nextWeek":"sameElse";return this.format(this.lang().calendar(format,this))},isLeapYear:function(){return isLeapYear(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=parseWeekday(input,this.lang()),this.add({d:input-day})):day},month:function(input){var dayOfMonth,utc=this._isUTC?"UTC":"";return null!=input?"string"==typeof input&&(input=this.lang().monthsParse(input),"number"!=typeof input)?this:(dayOfMonth=this.date(),this.date(1),this._d["set"+utc+"Month"](input),this.date(Math.min(dayOfMonth,this.daysInMonth())),moment.updateOffset(this),this):this._d["get"+utc+"Month"]()},startOf:function(units){switch(units=normalizeUnits(units)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===units?this.weekday(0):"isoWeek"===units&&this.isoWeekday(1),this},endOf:function(units){return units=normalizeUnits(units),this.startOf(units).add("isoWeek"===units?"week":units,1).subtract("ms",1)},isAfter:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)>+moment(input).startOf(units)},isBefore:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)<+moment(input).startOf(units)},isSame:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)===+moment(input).startOf(units)},min:function(other){return other=moment.apply(null,arguments),this>other?this:other},max:function(other){return other=moment.apply(null,arguments),other>this?this:other},zone:function(input){var offset=this._offset||0;return null==input?this._isUTC?offset:this._d.getTimezoneOffset():("string"==typeof input&&(input=timezoneMinutesFromString(input)),Math.abs(input)<16&&(input=60*input),this._offset=input,this._isUTC=!0,offset!==input&&addOrSubtractDurationFromMoment(this,moment.duration(offset-input,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(input){return input=input?moment(input).zone():0,(this.zone()-input)%60===0},daysInMonth:function(){return daysInMonth(this.year(),this.month())},dayOfYear:function(input){var dayOfYear=round((moment(this).startOf("day")-moment(this).startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add("d",input-dayOfYear)},weekYear:function(input){var year=weekOfYear(this,this.lang()._week.dow,this.lang()._week.doy).year;
return null==input?year:this.add("y",input-year)},isoWeekYear:function(input){var year=weekOfYear(this,1,4).year;return null==input?year:this.add("y",input-year)},week:function(input){var week=this.lang().week(this);return null==input?week:this.add("d",7*(input-week))},isoWeek:function(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add("d",7*(input-week))},weekday:function(input){var weekday=(this.day()+7-this.lang()._week.dow)%7;return null==input?weekday:this.add("d",input-weekday)},isoWeekday:function(input){return null==input?this.day()||7:this.day(this.day()%7?input:input-7)},get:function(units){return units=normalizeUnits(units),this[units]()},set:function(units,value){return units=normalizeUnits(units),"function"==typeof this[units]&&this[units](value),this},lang:function(key){return key===undefined?this._lang:(this._lang=getLangDefinition(key),this)}}),i=0;i<proxyGettersAndSetters.length;i++)makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase().replace(/s$/,""),proxyGettersAndSetters[i]);makeGetterAndSetter("year","FullYear"),moment.fn.days=moment.fn.day,moment.fn.months=moment.fn.month,moment.fn.weeks=moment.fn.week,moment.fn.isoWeeks=moment.fn.isoWeek,moment.fn.toJSON=moment.fn.toISOString,extend(moment.duration.fn=Duration.prototype,{_bubble:function(){var seconds,minutes,hours,years,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data;data.milliseconds=milliseconds%1e3,seconds=absRound(milliseconds/1e3),data.seconds=seconds%60,minutes=absRound(seconds/60),data.minutes=minutes%60,hours=absRound(minutes/60),data.hours=hours%24,days+=absRound(hours/24),data.days=days%30,months+=absRound(days/30),data.months=months%12,years=absRound(months/12),data.years=years},weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12)},humanize:function(withSuffix){var difference=+this,output=relativeTime(difference,!withSuffix,this.lang());return withSuffix&&(output=this.lang().pastFuture(difference,output)),this.lang().postformat(output)},add:function(input,val){var dur=moment.duration(input,val);return this._milliseconds+=dur._milliseconds,this._days+=dur._days,this._months+=dur._months,this._bubble(),this},subtract:function(input,val){var dur=moment.duration(input,val);return this._milliseconds-=dur._milliseconds,this._days-=dur._days,this._months-=dur._months,this._bubble(),this},get:function(units){return units=normalizeUnits(units),this[units.toLowerCase()+"s"]()},as:function(units){return units=normalizeUnits(units),this["as"+units.charAt(0).toUpperCase()+units.slice(1)+"s"]()},lang:moment.fn.lang,toIsoString:function(){var years=Math.abs(this.years()),months=Math.abs(this.months()),days=Math.abs(this.days()),hours=Math.abs(this.hours()),minutes=Math.abs(this.minutes()),seconds=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(years?years+"Y":"")+(months?months+"M":"")+(days?days+"D":"")+(hours||minutes||seconds?"T":"")+(hours?hours+"H":"")+(minutes?minutes+"M":"")+(seconds?seconds+"S":""):"P0D"}});for(i in unitMillisecondFactors)unitMillisecondFactors.hasOwnProperty(i)&&(makeDurationAsGetter(i,unitMillisecondFactors[i]),makeDurationGetter(i.toLowerCase()));makeDurationAsGetter("Weeks",6048e5),moment.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},moment.lang("en",{ordinal:function(number){var b=number%10,output=1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output}}),function(factory){factory(moment)}(function(moment){return moment.lang("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(factory){factory(moment)}(function(moment){return moment.lang("ar",{months:"/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),monthsShort:"/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(factory){factory(moment)}(function(moment){return moment.lang("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(number){var lastDigit=number%10,last2Digits=number%100;return 0===number?number+"-":0===last2Digits?number+"-":last2Digits>10&&20>last2Digits?number+"-":1===lastDigit?number+"-":2===lastDigit?number+"-":7===lastDigit||8===lastDigit?number+"-":number+"-"},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){function relativeTimeWithMutation(number,withoutSuffix,key){var format={mm:"munutenn",MM:"miz",dd:"devezh"};return number+" "+mutation(format[key],number)}function specialMutationForYears(number){switch(lastNumber(number)){case 1:case 3:case 4:case 5:case 9:return number+" bloaz";default:return number+" vloaz"}}function lastNumber(number){return number>9?lastNumber(number%10):number}function mutation(text,number){return 2===number?softMutation(text):text}function softMutation(text){var mutationTable={m:"v",b:"v",d:"z"};return mutationTable[text.charAt(0)]===undefined?text:mutationTable[text.charAt(0)]+text.substring(1)}return moment.lang("br",{months:"Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),longDateFormat:{LT:"h[e]mm A",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY LT",LLLL:"dddd, D [a viz] MMMM YYYY LT"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc'hoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec'h da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s 'zo",s:"un nebeud segondenno",m:"ur vunutenn",mm:relativeTimeWithMutation,h:"un eur",hh:"%d eur",d:"un devezh",dd:relativeTimeWithMutation,M:"ur miz",MM:relativeTimeWithMutation,y:"ur bloaz",yy:specialMutationForYears},ordinal:function(number){var output=1===number?"a":"vet";return number+output},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){function translate(number,withoutSuffix,key){var result=number+" ";switch(key){case"m":return withoutSuffix?"jedna minuta":"jedne minute";case"mm":return result+=1===number?"minuta":2===number||3===number||4===number?"minute":"minuta";case"h":return withoutSuffix?"jedan sat":"jednog sata";case"hh":return result+=1===number?"sat":2===number||3===number||4===number?"sata":"sati";case"dd":return result+=1===number?"dan":"dana";case"MM":return result+=1===number?"mjesec":2===number||3===number||4===number?"mjeseca":"mjeseci";case"yy":return result+=1===number?"godina":2===number||3===number||4===number?"godine":"godina"}}return moment.lang("bs",{months:"januar_februar_mart_april_maj_juni_juli_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},ordinal:"%d.",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("ca",{months:"Gener_Febrer_Mar_Abril_Maig_Juny_Juliol_Agost_Setembre_Octubre_Novembre_Desembre".split("_"),monthsShort:"Gen._Febr._Mar._Abr._Mai._Jun._Jul._Ag._Set._Oct._Nov._Des.".split("_"),weekdays:"Diumenge_Dilluns_Dimarts_Dimecres_Dijous_Divendres_Dissabte".split("_"),weekdaysShort:"Dg._Dl._Dt._Dc._Dj._Dv._Ds.".split("_"),weekdaysMin:"Dg_Dl_Dt_Dc_Dj_Dv_Ds".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"fa %s",s:"uns segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},ordinal:"%d",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){function plural(n){return n>1&&5>n&&1!==~~(n/10)}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";switch(key){case"s":return withoutSuffix||isFuture?"pr vtein":"pr vteinami";case"m":return withoutSuffix?"minuta":isFuture?"minutu":"minutou";case"mm":return withoutSuffix||isFuture?result+(plural(number)?"minuty":"minut"):result+"minutami";case"h":return withoutSuffix?"hodina":isFuture?"hodinu":"hodinou";case"hh":return withoutSuffix||isFuture?result+(plural(number)?"hodiny":"hodin"):result+"hodinami";case"d":return withoutSuffix||isFuture?"den":"dnem";case"dd":return withoutSuffix||isFuture?result+(plural(number)?"dny":"dn"):result+"dny";case"M":return withoutSuffix||isFuture?"msc":"mscem";case"MM":return withoutSuffix||isFuture?result+(plural(number)?"msce":"msc"):result+"msci";case"y":return withoutSuffix||isFuture?"rok":"rokem";case"yy":return withoutSuffix||isFuture?result+(plural(number)?"roky":"let"):result+"lety"}}var months="leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),monthsShort="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_");return moment.lang("cs",{months:months,monthsShort:monthsShort,monthsParse:function(months,monthsShort){var i,_monthsParse=[];for(i=0;12>i;i++)_monthsParse[i]=new RegExp("^"+months[i]+"$|^"+monthsShort[i]+"$","i");return _monthsParse}(months,monthsShort),weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], LT",LLLL:"dddd, YYYY [] MMMM [] D[-], LT"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(output){var affix=/$/i.exec(output)?"":/$/i.exec(output)?"":"";return output+affix},past:"%s ",s:"- ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:"%d-",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn &#244;l",s:"ychydig eiliadau",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},ordinal:function(number){var b=number,output="",lookup=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"];return b>20?output=40===b||50===b||60===b||80===b||100===b?"fed":"ain":b>0&&(output=lookup[b]),number+output},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I gr kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){function processRelativeTime(number,withoutSuffix,key,isFuture){var format={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[number+" Tage",number+" Tagen"],M:["ein Monat","einem Monat"],MM:[number+" Monate",number+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[number+" Jahre",number+" Jahren"]};return withoutSuffix?format[key][0]:format[key][1]}return moment.lang("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(momentToFormat,format){return/D/.test(format.substring(0,format.indexOf("MMMM")))?this._monthsGenitiveEl[momentToFormat.month()]:this._monthsNominativeEl[momentToFormat.month()]},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(hours,minutes,isLower){return hours>11?isLower?"":"":isLower?"":""},longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:"[ ] dddd [{}] LT",sameElse:"L"},calendar:function(key,mom){var output=this._calendarEl[key],hours=mom&&mom.hours();return output.replace("{}",hours%12===1?"":"")},relativeTime:{future:" %s",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:function(number){return number+""},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(number){var b=number%10,output=1===~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"YYYY-MM-DD",LL:"D MMMM, YYYY",LLL:"D MMMM, YYYY LT",LLLL:"dddd, D MMMM, YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(number){var b=number%10,output=1===~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output}})}),function(factory){factory(moment)}(function(moment){return moment.lang("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(number){var b=number%10,output=1===~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_ag_sep_okt_nov_dec".split("_"),weekdays:"Dimano_Lundo_Mardo_Merkredo_ado_Vendredo_Sabato".split("_"),weekdaysShort:"Dim_Lun_Mard_Merk_a_Ven_Sab".split("_"),weekdaysMin:"Di_Lu_Ma_Me_a_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D[-an de] MMMM, YYYY",LLL:"D[-an de] MMMM, YYYY LT",LLLL:"dddd, [la] D[-an de] MMMM, YYYY LT"},meridiem:function(hours,minutes,isLower){return hours>11?isLower?"p.t.m.":"P.T.M.":isLower?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd [je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasinta] dddd [je] LT",sameElse:"L"},relativeTime:{future:"je %s",past:"anta %s",s:"sekundoj",m:"minuto",mm:"%d minutoj",h:"horo",hh:"%d horoj",d:"tago",dd:"%d tagoj",M:"monato",MM:"%d monatoj",y:"jaro",yy:"%d jaroj"},ordinal:"%da",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:"ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){function translateSeconds(number,withoutSuffix,key,isFuture){return isFuture||withoutSuffix?"paari sekundi":"paar sekundit"}return moment.lang("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:translateSeconds,m:"minut",mm:"%d minutit",h:"tund",hh:"%d tundi",d:"pev",dd:"%d peva",M:"kuu",MM:"%d kuud",y:"aasta",yy:"%d aastat"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] LT",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] LT",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] LT",llll:"ddd, YYYY[ko] MMM D[a] LT"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},ordinal:"%d.",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){var symbolMap={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},numberMap={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return moment.lang("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},meridiem:function(hour,minute,isLower){return 12>hour?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(string){return string.replace(/[-]/g,function(match){return numberMap[match]}).replace(//g,",")},postformat:function(string){return string.replace(/\d/g,function(match){return symbolMap[match]}).replace(/,/g,"")},ordinal:"%d",week:{dow:6,doy:12}})}),function(factory){factory(moment)}(function(moment){function translate(number,withoutSuffix,key,isFuture){var result="";switch(key){case"s":return isFuture?"muutaman sekunnin":"muutama sekunti";case"m":return isFuture?"minuutin":"minuutti";case"mm":result=isFuture?"minuutin":"minuuttia";break;case"h":return isFuture?"tunnin":"tunti";case"hh":result=isFuture?"tunnin":"tuntia";break;case"d":return isFuture?"pivn":"piv";case"dd":result=isFuture?"pivn":"piv";break;case"M":return isFuture?"kuukauden":"kuukausi";case"MM":result=isFuture?"kuukauden":"kuukautta";break;case"y":return isFuture?"vuoden":"vuosi";case"yy":result=isFuture?"vuoden":"vuotta"}return result=verbal_number(number,isFuture)+" "+result}function verbal_number(number,isFuture){return 10>number?isFuture?numbers_future[number]:numbers_past[number]:number}var numbers_past="nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" "),numbers_future=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",numbers_past[7],numbers_past[8],numbers_past[9]];return moment.lang("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] LT",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] LT",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] LT",llll:"ddd, Do MMM YYYY, [klo] LT"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),
weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",m:"ein minutt",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnai",MM:"%d mnair",y:"eitt r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(number){return number+(1===number?"er":"")}})}),function(factory){factory(moment)}(function(moment){return moment.lang("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(number){return number+(1===number?"er":"")},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("gl",{months:"Xaneiro_Febreiro_Marzo_Abril_Maio_Xuo_Xullo_Agosto_Setembro_Outubro_Novembro_Decembro".split("_"),monthsShort:"Xan._Feb._Mar._Abr._Mai._Xu._Xul._Ago._Set._Out._Nov._Dec.".split("_"),weekdays:"Domingo_Luns_Martes_Mrcores_Xoves_Venres_Sbado".split("_"),weekdaysShort:"Dom._Lun._Mar._Mr._Xov._Ven._Sb.".split("_"),weekdaysMin:"Do_Lu_Ma_M_Xo_Ve_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(str){return"uns segundos"===str?"nuns segundos":"en "+str},past:"hai %s",s:"uns segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY LT",LLLL:"dddd, D []MMMM YYYY LT",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:function(number){return 2===number?"":number+" "},d:"",dd:function(number){return 2===number?"":number+" "},M:"",MM:function(number){return 2===number?"":number+" "},y:"",yy:function(number){return 2===number?"":number+" "}}})}),function(factory){factory(moment)}(function(moment){var symbolMap={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},numberMap={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return moment.lang("hi",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(string){return string.replace(/[]/g,function(match){return numberMap[match]})},postformat:function(string){return string.replace(/\d/g,function(match){return symbolMap[match]})},meridiem:function(hour,minute,isLower){return 4>hour?"":10>hour?"":17>hour?"":20>hour?"":""},week:{dow:0,doy:6}})}),function(factory){factory(moment)}(function(moment){function translate(number,withoutSuffix,key){var result=number+" ";switch(key){case"m":return withoutSuffix?"jedna minuta":"jedne minute";case"mm":return result+=1===number?"minuta":2===number||3===number||4===number?"minute":"minuta";case"h":return withoutSuffix?"jedan sat":"jednog sata";case"hh":return result+=1===number?"sat":2===number||3===number||4===number?"sata":"sati";case"dd":return result+=1===number?"dan":"dana";case"MM":return result+=1===number?"mjesec":2===number||3===number||4===number?"mjeseca":"mjeseci";case"yy":return result+=1===number?"godina":2===number||3===number||4===number?"godine":"godina"}}return moment.lang("hr",{months:"sjeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_"),monthsShort:"sje._vel._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},ordinal:"%d.",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){function translate(number,withoutSuffix,key,isFuture){var num=number;switch(key){case"s":return isFuture||withoutSuffix?"nhny msodperc":"nhny msodperce";case"m":return"egy"+(isFuture||withoutSuffix?" perc":" perce");case"mm":return num+(isFuture||withoutSuffix?" perc":" perce");case"h":return"egy"+(isFuture||withoutSuffix?" ra":" rja");case"hh":return num+(isFuture||withoutSuffix?" ra":" rja");case"d":return"egy"+(isFuture||withoutSuffix?" nap":" napja");case"dd":return num+(isFuture||withoutSuffix?" nap":" napja");case"M":return"egy"+(isFuture||withoutSuffix?" hnap":" hnapja");case"MM":return num+(isFuture||withoutSuffix?" hnap":" hnapja");case"y":return"egy"+(isFuture||withoutSuffix?" v":" ve");case"yy":return num+(isFuture||withoutSuffix?" v":" ve")}return""}function week(isFuture){return(isFuture?"":"[mlt] ")+"["+weekEndings[this.day()]+"] LT[-kor]"}var weekEndings="vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ");return moment.lang("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D., LT",LLLL:"YYYY. MMMM D., dddd LT"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return week.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return week.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},ordinal:"%d.",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(hours,minutes,isLower){return 11>hours?"pagi":15>hours?"siang":19>hours?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){function plural(n){return n%100===11?!0:n%10===1?!1:!0}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";switch(key){case"s":return withoutSuffix||isFuture?"nokkrar sekndur":"nokkrum sekndum";case"m":return withoutSuffix?"mnta":"mntu";case"mm":return plural(number)?result+(withoutSuffix||isFuture?"mntur":"mntum"):withoutSuffix?result+"mnta":result+"mntu";case"hh":return plural(number)?result+(withoutSuffix||isFuture?"klukkustundir":"klukkustundum"):result+"klukkustund";case"d":return withoutSuffix?"dagur":isFuture?"dag":"degi";case"dd":return plural(number)?withoutSuffix?result+"dagar":result+(isFuture?"daga":"dgum"):withoutSuffix?result+"dagur":result+(isFuture?"dag":"degi");case"M":return withoutSuffix?"mnuur":isFuture?"mnu":"mnui";case"MM":return plural(number)?withoutSuffix?result+"mnuir":result+(isFuture?"mnui":"mnuum"):withoutSuffix?result+"mnuur":result+(isFuture?"mnu":"mnui");case"y":return withoutSuffix||isFuture?"r":"ri";case"yy":return plural(number)?result+(withoutSuffix||isFuture?"r":"rum"):result+(withoutSuffix||isFuture?"r":"ri")}}return moment.lang("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd, D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:translate,m:translate,mm:translate,h:"klukkustund",hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("it",{months:"Gennaio_Febbraio_Marzo_Aprile_Maggio_Giugno_Luglio_Agosto_Settembre_Ottobre_Novembre_Dicembre".split("_"),monthsShort:"Gen_Feb_Mar_Apr_Mag_Giu_Lug_Ago_Set_Ott_Nov_Dic".split("_"),weekdays:"Domenica_Luned_Marted_Mercoled_Gioved_Venerd_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"D_L_Ma_Me_G_V_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:"[lo scorso] dddd [alle] LT",sameElse:"L"},relativeTime:{future:function(s){return(/^[0-9].+$/.test(s)?"tra":"in")+" "+s},past:"%s fa",s:"secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinal:"%d",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("ja",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahm",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDLT",LLLL:"YYYYMDLT dddd"},meridiem:function(hour,minute,isLower){return 12>hour?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}})}),function(factory){factory(moment)}(function(moment){function monthsCaseReplace(m,format){var months={nominative:"___________".split("_"),accusative:"___________".split("_")},nounCase=/D[oD] *MMMM?/.test(format)?"accusative":"nominative";return months[nounCase][m.month()]}function weekdaysCaseReplace(m,format){var weekdays={nominative:"______".split("_"),accusative:"______".split("_")},nounCase=/(|)/.test(format)?"accusative":"nominative";return weekdays[nounCase][m.day()]}return moment.lang("ka",{months:monthsCaseReplace,monthsShort:"___________".split("_"),weekdays:weekdaysCaseReplace,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(s){return/(|||)/.test(s)?s.replace(/$/,""):s+""},past:function(s){return/(||||)/.test(s)?s.replace(/(|)$/," ")://.test(s)?s.replace(/$/," "):void 0},s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(number){return 0===number?number:1===number?number+"-":20>number||100>=number&&number%20===0||number%100===0?"-"+number:number+"-"},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h mm",L:"YYYY.MM.DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D LT",LLLL:"YYYY MMMM D dddd LT"},meridiem:function(hour,minute,isUpper){return 12>hour?"":""},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"},ordinal:"%d"})}),function(factory){factory(moment)}(function(moment){function translateSeconds(number,withoutSuffix,key,isFuture){return withoutSuffix?"kelios sekunds":isFuture?"keli sekundi":"kelias sekundes"}function translateSingular(number,withoutSuffix,key,isFuture){return withoutSuffix?forms(key)[0]:isFuture?forms(key)[1]:forms(key)[2]}function special(number){return number%10===0||number>10&&20>number}function forms(key){return units[key].split("_")}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";return 1===number?result+translateSingular(number,withoutSuffix,key[0],isFuture):withoutSuffix?result+(special(number)?forms(key)[1]:forms(key)[0]):isFuture?result+forms(key)[1]:result+(special(number)?forms(key)[1]:forms(key)[2])}function relativeWeekDay(moment,format){var nominative=-1===format.indexOf("dddd LT"),weekDay=weekDays[moment.weekday()];return nominative?weekDay:weekDay.substring(0,weekDay.length-2)+""}var units={m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"},weekDays="pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis_sekmadienis".split("_");return moment.lang("lt",{months:"sausio_vasario_kovo_balandio_gegus_birlio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:relativeWeekDay,weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], LT [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, LT [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], LT [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, LT [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:translateSeconds,m:translateSingular,mm:translate,h:translateSingular,hh:translate,d:translateSingular,dd:translate,M:translateSingular,MM:translate,y:translateSingular,yy:translate},ordinal:function(number){return number+"-oji"},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){function format(word,number,withoutSuffix){var forms=word.split("_");return withoutSuffix?number%10===1&&11!==number?forms[2]:forms[3]:number%10===1&&11!==number?forms[0]:forms[1]}function relativeTimeWithPlural(number,withoutSuffix,key){return number+" "+format(units[key],number,withoutSuffix)}var units={mm:"minti_mintes_minte_mintes",hh:"stundu_stundas_stunda_stundas",dd:"dienu_dienas_diena_dienas",MM:"mnesi_mneus_mnesis_mnei",yy:"gadu_gadus_gads_gadi"};return moment.lang("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, LT",LLLL:"YYYY. [gada] D. MMMM, dddd, LT"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"%s vlk",past:"%s agrk",s:"daas sekundes",m:"minti",mm:relativeTimeWithPlural,h:"stundu",hh:relativeTimeWithPlural,d:"dienu",dd:relativeTimeWithPlural,M:"mnesi",MM:relativeTimeWithPlural,y:"gadu",yy:relativeTimeWithPlural},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiem:function(hour,minute,isLower){return 4>hour?"":12>hour?"":17>hour?" ":20>hour?"":""}})}),function(factory){factory(moment)}(function(moment){var symbolMap={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},numberMap={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return moment.lang("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(string){return string.replace(/[]/g,function(match){return numberMap[match]})},postformat:function(string){return string.replace(/\d/g,function(match){return symbolMap[match]})},meridiem:function(hour,minute,isLower){return 4>hour?"":10>hour?"":17>hour?"":20>hour?"":""},week:{dow:0,doy:6}})}),function(factory){factory(moment)}(function(moment){return moment.lang("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(hours,minutes,isLower){return 11>hours?"pagi":15>hours?"tengahari":19>hours?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_april_mai_juni_juli_aug._sep._okt._nov._des.".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"s._ma._ti._on._to._fr._l.".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"H.mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){var symbolMap={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},numberMap={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return moment.lang("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._.__._._._.".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},preparse:function(string){return string.replace(/[]/g,function(match){return numberMap[match]})},postformat:function(string){return string.replace(/\d/g,function(match){return symbolMap[match]})},meridiem:function(hour,minute,isLower){return 3>hour?"":10>hour?"":15>hour?"":18>hour?"":20>hour?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){var monthsShortWithDots="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsShortWithoutDots="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_");return moment.lang("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(m,format){return/-MMM-/.test(format)?monthsShortWithoutDots[m.month()]:monthsShortWithDots[m.month()]},weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},ordinal:function(number){return number+(1===number||8===number||number>=20?"ste":"de")},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"sun_mn_tys_ons_tor_fre_lau".split("_"),weekdaysMin:"su_m_ty_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregende] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekund",m:"ett minutt",mm:"%d minutt",h:"en time",hh:"%d timar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){function plural(n){return 5>n%10&&n%10>1&&1!==~~(n/10)}function translate(number,withoutSuffix,key){var result=number+" ";switch(key){case"m":return withoutSuffix?"minuta":"minut";case"mm":return result+(plural(number)?"minuty":"minut");case"h":return withoutSuffix?"godzina":"godzin";case"hh":return result+(plural(number)?"godziny":"godzin");case"MM":return result+(plural(number)?"miesice":"miesicy");case"yy":return result+(plural(number)?"lata":"lat")}}var monthsNominative="stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),monthsSubjective="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_");return moment.lang("pl",{months:function(momentToFormat,format){return/D MMMM/.test(format)?monthsSubjective[momentToFormat.month()]:monthsNominative[momentToFormat.month()]},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"nie_pon_wt_r_czw_pt_sb".split("_"),weekdaysMin:"N_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:translate,mm:translate,h:translate,hh:translate,d:"1 dzie",dd:"%d dni",M:"miesic",MM:translate,y:"rok",yy:translate},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("pt-br",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),
weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d"})}),function(factory){factory(moment)}(function(moment){return moment.lang("pt",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("ro",{months:"Ianuarie_Februarie_Martie_Aprilie_Mai_Iunie_Iulie_August_Septembrie_Octombrie_Noiembrie_Decembrie".split("_"),monthsShort:"Ian_Feb_Mar_Apr_Mai_Iun_Iul_Aug_Sep_Oct_Noi_Dec".split("_"),weekdays:"Duminic_Luni_Mari_Miercuri_Joi_Vineri_Smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",m:"un minut",mm:"%d minute",h:"o or",hh:"%d ore",d:"o zi",dd:"%d zile",M:"o lun",MM:"%d luni",y:"un an",yy:"%d ani"},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){function plural(word,num){var forms=word.split("_");return num%10===1&&num%100!==11?forms[0]:num%10>=2&&4>=num%10&&(10>num%100||num%100>=20)?forms[1]:forms[2]}function relativeTimeWithPlural(number,withoutSuffix,key){var format={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===key?withoutSuffix?"":"":number+" "+plural(format[key],+number)}function monthsCaseReplace(m,format){var months={nominative:"___________".split("_"),accusative:"___________".split("_")},nounCase=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(format)?"accusative":"nominative";return months[nounCase][m.month()]}function monthsShortCaseReplace(m,format){var monthsShort={nominative:"___________".split("_"),accusative:"___________".split("_")},nounCase=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(format)?"accusative":"nominative";return monthsShort[nounCase][m.month()]}function weekdaysCaseReplace(m,format){var weekdays={nominative:"______".split("_"),accusative:"______".split("_")},nounCase=/\[ ?[] ?(?:|)? ?\] ?dddd/.test(format)?"accusative":"nominative";return weekdays[nounCase][m.day()]}return moment.lang("ru",{months:monthsCaseReplace,monthsShort:monthsShortCaseReplace,weekdays:weekdaysCaseReplace,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:[/^/i,/^/i,/^/i,/^/i,/^[|]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return 2===this.day()?"[] dddd [] LT":"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT";case 3:case 5:case 6:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"",hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiem:function(hour,minute,isLower){return 4>hour?"":12>hour?"":17>hour?"":""},ordinal:function(number,period){switch(period){case"M":case"d":case"DDD":return number+"-";case"D":return number+"-";case"w":case"W":return number+"-";default:return number}},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){function plural(n){return n>1&&5>n}function translate(number,withoutSuffix,key,isFuture){var result=number+" ";switch(key){case"s":return withoutSuffix||isFuture?"pr seknd":"pr sekundami";case"m":return withoutSuffix?"minta":isFuture?"mintu":"mintou";case"mm":return withoutSuffix||isFuture?result+(plural(number)?"minty":"mint"):result+"mintami";case"h":return withoutSuffix?"hodina":isFuture?"hodinu":"hodinou";case"hh":return withoutSuffix||isFuture?result+(plural(number)?"hodiny":"hodn"):result+"hodinami";case"d":return withoutSuffix||isFuture?"de":"dom";case"dd":return withoutSuffix||isFuture?result+(plural(number)?"dni":"dn"):result+"dami";case"M":return withoutSuffix||isFuture?"mesiac":"mesiacom";case"MM":return withoutSuffix||isFuture?result+(plural(number)?"mesiace":"mesiacov"):result+"mesiacmi";case"y":return withoutSuffix||isFuture?"rok":"rokom";case"yy":return withoutSuffix||isFuture?result+(plural(number)?"roky":"rokov"):result+"rokmi"}}var months="janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),monthsShort="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_");return moment.lang("sk",{months:months,monthsShort:monthsShort,monthsParse:function(months,monthsShort){var i,_monthsParse=[];for(i=0;12>i;i++)_monthsParse[i]=new RegExp("^"+months[i]+"$|^"+monthsShort[i]+"$","i");return _monthsParse}(months,monthsShort),weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){function translate(number,withoutSuffix,key){var result=number+" ";switch(key){case"m":return withoutSuffix?"ena minuta":"eno minuto";case"mm":return result+=1===number?"minuta":2===number?"minuti":3===number||4===number?"minute":"minut";case"h":return withoutSuffix?"ena ura":"eno uro";case"hh":return result+=1===number?"ura":2===number?"uri":3===number||4===number?"ure":"ur";case"dd":return result+=1===number?"dan":"dni";case"MM":return result+=1===number?"mesec":2===number?"meseca":3===number||4===number?"mesece":"mesecev";case"yy":return result+=1===number?"leto":2===number?"leti":3===number||4===number?"leta":"let"}}return moment.lang("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[prejnja] dddd [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"%s nazaj",s:"nekaj sekund",m:translate,mm:translate,h:translate,hh:translate,d:"en dan",dd:translate,M:"en mesec",MM:translate,y:"eno leto",yy:translate},ordinal:"%d.",week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Marte_E Mrkure_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Neser n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s me par",s:"disa seconda",m:"nj minut",mm:"%d minutea",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"dddd LT",lastWeek:"[Frra] dddd[en] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinal:function(number){var b=number%10,output=1===~~(number%100/10)?"e":1===b?"a":2===b?"a":"e";return number+output},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("th",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),longDateFormat:{LT:"H  m ",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  LT",LLLL:"dddd D MMMM YYYY  LT"},meridiem:function(hour,minute,isLower){return 12>hour?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}),function(factory){factory(moment)}(function(moment){return moment.lang("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM DD, YYYY LT"},calendar:{sameDay:"[Ngayon sa] LT",nextDay:"[Bukas sa] LT",nextWeek:"dddd [sa] LT",lastDay:"[Kahapon sa] LT",lastWeek:"dddd [huling linggo] LT",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},ordinal:function(number){return number},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){var suffixes={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};return moment.lang("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[haftaya] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen hafta] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinal:function(number){if(0===number)return number+"'nc";var a=number%10,b=number%100-a,c=number>=100?100:null;return number+(suffixes[a]||suffixes[b]||suffixes[c])},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("tzm-la",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}),function(factory){factory(moment)}(function(moment){return moment.lang("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(factory){factory(moment)}(function(moment){function plural(word,num){var forms=word.split("_");return num%10===1&&num%100!==11?forms[0]:num%10>=2&&4>=num%10&&(10>num%100||num%100>=20)?forms[1]:forms[2]}function relativeTimeWithPlural(number,withoutSuffix,key){var format={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===key?withoutSuffix?"":"":"h"===key?withoutSuffix?"":"":number+" "+plural(format[key],+number)}function monthsCaseReplace(m,format){var months={nominative:"___________".split("_"),accusative:"___________".split("_")},nounCase=/D[oD]? *MMMM?/.test(format)?"accusative":"nominative";return months[nounCase][m.month()]}function weekdaysCaseReplace(m,format){var weekdays={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")},nounCase=/(\[[]\]) ?dddd/.test(format)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(format)?"genitive":"nominative";return weekdays[nounCase][m.day()]}function processHoursFunction(str){return function(){return str+""+(11===this.hours()?"":"")+"] LT"}}return moment.lang("uk",{months:monthsCaseReplace,monthsShort:"___________".split("_"),weekdays:weekdaysCaseReplace,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:processHoursFunction("[ "),nextDay:processHoursFunction("[ "),lastDay:processHoursFunction("[ "),nextWeek:processHoursFunction("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return processHoursFunction("[] dddd [").call(this);case 1:case 2:case 4:return processHoursFunction("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"",hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiem:function(hour,minute,isLower){return 4>hour?"":12>hour?"":17>hour?"":""},ordinal:function(number,period){switch(period){case"M":case"d":case"DDD":case"w":case"W":return number+"-";case"D":return number+"-";default:return number}},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"D MMMM YYYY, dddd LT"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}),function(factory){factory(moment)}(function(moment){return moment.lang("vn",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY LT",LLLL:"dddd, D MMMM [nm] YYYY LT",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun ri lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},ordinal:function(number){return number},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(hour,minute,isLower){var hm=100*hour+minute;return 600>hm?"":900>hm?"":1130>hm?"":1230>hm?"":1800>hm?"":""},calendar:{sameDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},lastDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextWeek:function(){var startOfWeek,prefix;return startOfWeek=moment().startOf("week"),prefix=this.unix()-startOfWeek.unix()>=604800?"[]":"[]",0===this.minutes()?prefix+"dddAh":prefix+"dddAhmm"},lastWeek:function(){var startOfWeek,prefix;return startOfWeek=moment().startOf("week"),prefix=this.unix()<startOfWeek.unix()?"[]":"[]",0===this.minutes()?prefix+"dddAh":prefix+"dddAhmm"},sameElse:"L"},ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"";case"M":return number+"";case"w":case"W":return number+"";default:return number}},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"},week:{dow:1,doy:4}})}),function(factory){factory(moment)}(function(moment){return moment.lang("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(hour,minute,isLower){var hm=100*hour+minute;return 900>hm?"":1130>hm?"":1230>hm?"":1800>hm?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"";case"M":return number+"";case"w":case"W":return number+"";default:return number}},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"}})}),moment.lang("en"),hasModule?(module.exports=moment,makeGlobal(!0)):"function"==typeof define&&define.amd?define("moment",["require","exports","module"],function(require,exports,module){return module.config().noGlobal!==!0&&makeGlobal(module.config().noGlobal===undefined),moment}):makeGlobal()}.call(this),define("general.utils/qv-moment",["translator","moment","qvangular","general.utils/responsive-state"],function(translator,moment,qvangular,ResponsiveState){function getCorrectFormat(isFallback){var format,locale=langCode;switch(locale.toLowerCase()){case"en":format="YY-MM-DD";break;case"en-us":format="M/D/YY";break;case"en-gb":format="DD/MM/YY";break;case"de-de":case"de":format="DD.MM.YY";break;case"es-es":case"es":format="DD/MM/YY";break;case"fr-fr":case"fr":format="DD/MM/YY";break;case"it-it":case"it":format="DD/MM/YY";break;case"ja-jp":case"ja":format="YY/MM/DD";break;case"nl-nl":case"nl":format="D-M-YY";break;case"pt":langCode="pt-br",format="DD/MM/YY";break;case"pt-br":format="DD/MM/YY";break;case"pt-pt":format="DD-MM-YY";break;case"ru-ru":case"ru":format="DD.MM.YY";break;case"sv-fi":format="D.M.YY";break;case"sv-se":case"sv":format="YY-MM-DD";break;case"zh":langCode="zh-cn",format="YY/M/D";break;case"zh-tw":case"zh-cn":format="YY/M/D";break;default:isFallback&&(!format&&window.console.warn&&window.console.warn("Locale '"+locale+"' not supported, falling back to ISO with English day/month names'"),langCode="en",format=getCorrectFormat()),langCode=langCode.slice(0,2),!format&&window.console.warn&&window.console.warn("Locale '"+locale+"' not supported, falling back to '"+langCode+"'"),format=getCorrectFormat(!0)}if(!isSmallDevice)switch(locale.toLowerCase()){case"en":format="YYYY-MM-DD HH:mm";break;case"en-us":format="M/D/YYYY LT";break;case"ja":case"ja-jp":format="LL H:mm";break;case"zh-tw":case"zh-cn":format="LL H:mm";break;default:format="L LT"}return format}function formatDate(string,format,customLangCode,useUTC){!customLangCode&&translator.localeDetected.length>=translator.language.length&&(customLangCode=translator.localeDetected),langCode=customLangCode||translator.languageCode;var mom=useUTC?moment(string).utc():moment(string);return mom.lang(langCode).format(format||getCorrectFormat())}var langCode,isSmallDevice=ResponsiveState.isSmallDevice,directive={restrict:"E",replace:!0,scope:{date:"=",format:"@",customLangCode:"@",useUTC:"@"},template:'<span class="qv-moment">{{dateToShow}}</span>',link:function($scope){$scope.dateToShow=formatDate($scope.date,$scope.format||"",$scope.customLangCode||"",$scope.useUTC||"")}};return qvangular.directive("qveFormateDate",function(){return directive}),qvangular.filter("formateDate",function(){return formatDate}),{formatDate:formatDate,directive:directive}}),define("text!general.components/action-indicator/action-indicator.ng.html",[],function(){return'<div id="actionIndicator"></div>'}),define("general.components/action-indicator/action-indicator",["qvangular","general.services/show-service/show-service","text!./action-indicator.ng.html"],function(qvangular,ShowService,template){"use strict";var currentComponent=null,component={scope:{position:"="},template:template,controller:["$scope","$element",function($scope,$element){var $container=$element.children(),d=$container.outerWidth();$container.css("top",$scope.position.y-d/2),$container.css("left",$scope.position.x-d/2),$container.addClass("transition")}]},ActionIndicatorService={show:function(x,y){ActionIndicatorService.hide(),qvangular.$apply(function(){currentComponent=ShowService.show(component,{position:{x:x,y:y}})})},hide:function(){qvangular.$apply(function(){currentComponent&&(currentComponent.destroy(),currentComponent=null)})}};return ActionIndicatorService}),define("general.utils/qv-contextmenu",["jquery","general.components/action-indicator/action-indicator","touche"],function($,ActionIndicatorView,Touche){function isInput(elem){return elem.is("input:not([type=radio]):not([type=checkbox]), textarea:not([readonly])")&&!elem.closest(".CodeMirror").length||elem.closest("[contenteditable=true]").length}function trigger(eventType,nativeEvent,target,pageX,pageY){var wrappedEvent;return target=$(target),nativeEvent.ctrlKey&&nativeEvent.shiftKey||isInput(target)?void 0:target.is(".progress")||target.is("select")?void nativeEvent.preventDefault():(nativeEvent.originalType=nativeEvent.type,delete nativeEvent.type,wrappedEvent=$.Event(nativeEvent,{type:eventType,ctrlKey:nativeEvent.ctrlKey,shiftKey:nativeEvent.shiftKey}),wrappedEvent.pageX=pageX,wrappedEvent.pageY=pageY,target.trigger(wrappedEvent),!1)}function originalEventHandler(event){event.ctrlKey&&event.shiftKey||isInput($(event.target))||event.preventDefault()}var targetElement,longtapTimeout=500;$(document.body).on("contextmenu",originalEventHandler),Touche(document.body).tap({options:{preventDefault:!1,which:3},start:function(event){Touche.utils.isMouse(event)&&(this._openContextMenu=!0)},end:function(event){this._openContextMenu&&(trigger("qv-contextmenu",event,event.target,event.pageX,event.pageY),this._openContextMenu=!1)}}),(Touche.utils.msPointer||Touche.utils.touch)&&Touche(document.body).longtap({options:{preventDefault:!1,timeThreshold:longtapTimeout,interval:20},start:function(event){return Touche.utils.isMouse(event)||isInput($(event.target))?void this.cancel():void(targetElement=event.target)},update:function(event,data){100===data.percentage&&(ActionIndicatorView.show(data.pagePoints[0].x,data.pagePoints[0].y),trigger("qv-radial-contextmenu",event,targetElement,data.pagePoints[0].x,data.pagePoints[0].y))},cancel:function(){ActionIndicatorView.hide()},end:function(event,data){ActionIndicatorView.hide(),event.target=targetElement,trigger("qv-contextmenu",event,targetElement,data.pagePoints[0].x,data.pagePoints[0].y),targetElement=null}}),$(document.body).on("MSHoldVisual",function(event){event.preventDefault()}),$(document.body).on("MSGestureHold",function(event){event.preventDefault()})}),define("general.utils/qv-activate",["jquery","jqueryoutside","touche"],function($){function createEvent(type,nativeEvent,data){return $.Event(type,{pageX:data.pagePoints[0].x,pageY:data.pagePoints[0].y,ctrlKey:nativeEvent.ctrlKey,metaKey:nativeEvent.metaKey,shiftKey:nativeEvent.shiftKey,originalEvent:nativeEvent,gestureData:data})}var originalTarget;Touche(document.body).tap({options:{preventDefault:!1},start:function(nativeEvent){originalTarget=$(nativeEvent.target)},end:function(nativeEvent,data){var wrappedEvent=createEvent("qv-activate",nativeEvent,data);0===originalTarget.closest(":disabled").length&&originalTarget.trigger(wrappedEvent),originalTarget=null}});var Press=Touche.Gesture.augment(function(Gesture){function Press(){Gesture.apply(this,arguments)}return this.defaults={precedence:6},this.start=function(event,data){this.binder.start.call(this,event,data)},Press});Touche.gestures.add("press",Press),Touche(document.body).press({start:function(nativeEvent,data){var wrappedEvent=createEvent("qv-press",nativeEvent,data);$(nativeEvent.target).trigger(wrappedEvent)}}),$.addOutsideEvent("qv-press","qv-outside","touchstart","touchend")}),define("general.utils/qv-swipe",["jquery","touche"],function($){function createEvent(type,nativeEvent,data){return $.Event(type,{pageX:data.pagePoints[0].x,pageY:data.pagePoints[0].y,ctrlKey:nativeEvent.ctrlKey,shiftKey:nativeEvent.shiftKey,originalEvent:nativeEvent,gestureData:data})}function captureMouse(){
function removeCaptureMouse(){document.removeEventListener("mousedown",mousedown,!0),document.removeEventListener("mousemove",mousemove,!0),document.removeEventListener("mouseup",mouseup,!0)}function mousedown(e){e.preventDefault(),e.stopPropagation()}function mousemove(e){e.preventDefault(),e.stopPropagation()}function mouseup(e){e.preventDefault(),e.stopPropagation(),removeCaptureMouse(),clearTimeout(timeoutId)}var timeoutId;document.addEventListener("mousedown",mousedown,!0),document.addEventListener("mousemove",mousemove,!0),document.addEventListener("mouseup",mouseup,!0),timeoutId=setTimeout(removeCaptureMouse,350)}var origTarget;Touche(document.body).tap({options:{preventDefault:!1},start:function(nativeEvent){origTarget=$(nativeEvent.target)}}),Touche(document.body).swipe({options:{preventDefault:!1,radiusThreshold:8},start:function(nativeEvent,data){var wrappedEvent=createEvent("qv-swipestart",nativeEvent,data);origTarget.trigger(wrappedEvent)},update:function(nativeEvent,data){var wrappedEvent=createEvent("qv-swipeupdate",nativeEvent,data);origTarget.trigger(wrappedEvent)},cancel:function(){var wrappedEvent=$.Event("qv-swipecancel");origTarget.trigger(wrappedEvent)},end:function(nativeEvent,data){Touche.utils.isMouse(nativeEvent)||captureMouse();var wrappedEvent=createEvent("qv-swipe",nativeEvent,data);origTarget.trigger(wrappedEvent)}})}),define("general.utils/qv-longtapswipe",["jquery","touche"],function($,Touche){"use strict";var LongtapSwipe=Touche.Gesture.augment(function(Gesture){function LongtapSwipe(){Gesture.apply(this,arguments)}function captureMouse(){function removeCaptureMouse(){document.removeEventListener("mousedown",mousedown,!0),document.removeEventListener("mousemove",mousemove,!0),document.removeEventListener("mouseup",mouseup,!0)}function mousedown(e){e.preventDefault(),e.stopPropagation()}function mousemove(e){e.preventDefault(),e.stopPropagation()}function mouseup(e){e.preventDefault(),e.stopPropagation(),removeCaptureMouse(),clearTimeout(timeoutId)}var timeoutId;document.addEventListener("mousedown",mousedown,!0),document.addEventListener("mousemove",mousemove,!0),document.addEventListener("mouseup",mouseup,!0),timeoutId=setTimeout(removeCaptureMouse,350)}var isLongtapSwipePossible=!1;return this.defaults={radiusThreshold:10,timeThreshold:510,touches:1,precedence:4,preventDefault:!1,which:1,interval:10},this.on=function(elem){this.count=0,Touche(elem).longtap({id:this.id,options:{precedence:this.options.precedence,preventDefault:this.options.preventDefault,touches:this.options.touches,which:this.options.which,areaThreshold:this.options.areaThreshold,timeThreshold:this.options.timeThreshold,interval:this.options.interval},start:this.longtapStart.bind(this),update:this.longtapUpdate.bind(this),cancel:this.longtapCancel.bind(this),end:this.longtapEnd.bind(this)}).swipe({id:this.id,options:{precedence:this.options.precedence+1,preventDefault:this.options.preventDefault,radiusThreshold:this.options.radiusThreshold,touches:this.options.touches},start:this.swipeStart.bind(this),update:this.swipeUpdate.bind(this),end:this.swipeEnd.bind(this),cancel:this.swipeCancel.bind(this)})},this.off=function(elem){Touche(elem).off("longtap",this.id),Touche(elem).off("swipe",this.id)},this.longtapStart=function(){isLongtapSwipePossible=!1},this.longtapUpdate=function(event,data){100===data.percentage&&(isLongtapSwipePossible=!0)},this.longtapEnd=function(){this.binder.cancel()},this.longtapCancel=function(){isLongtapSwipePossible||this.binder.cancel()},this.swipeStart=function(event,data){var stopEvent=$(event.target).is("input, textarea");isLongtapSwipePossible&&!stopEvent?this.binder.start(event,data):isLongtapSwipePossible&&stopEvent&&(isLongtapSwipePossible=!1)},this.swipeUpdate=function(event,data){isLongtapSwipePossible&&this.binder.update(event,data)},this.swipeEnd=function(event,data){isLongtapSwipePossible&&(captureMouse(),this.binder.end(event,data))},this.swipeCancel=function(){isLongtapSwipePossible=!1,this.binder.cancel()},LongtapSwipe});Touche.gestures.add("longtapswipe",LongtapSwipe)}),define("general.utils/qv-events",["general.utils/qv-contextmenu","general.utils/qv-activate","general.utils/qv-swipe","general.utils/qv-longtapswipe"],function(){}),define("ng",[],function(){return{load:function(name,req,onload,config){function getService(){"undefined"!=typeof window&&window.qvangularGlobal?onload(window.qvangularGlobal.getService(name)):setTimeout(getService,5)}config.isBuild||"undefined"==typeof window?onload():getService()}}}),define("dev-hub.lib/utils",["translator","qvangular","jquery"],function(translator,qvangular,jQuery){"use strict";function getURLParameter(href,name){return(RegExp(name+"=(.+?)(&|$)").exec(href)||[null,null])[1]}function getURLParameters(href,name){for(var match,r=new RegExp(name+"=(.+?)(&|$)","g"),result=[];match=r.exec(href);)result.push(decodeURIComponent(match[1]));return result}function setBrowserTitle(name){translator.ready.then(function(){document.title=name+" | Developer Hub - "+translator.get("DevHub.ProductQlikSense"),devHubTitle.html(name+" | Developer Hub"),toggleMarkDirty()})}function toggleMarkDirty(){!qvangular.$rootScope.extensionIsNew&&qvangular.$rootScope.extensionIsDirty?(document.title=-1===document.title.indexOf("*")?"*"+document.title:document.title,titles.html(-1===titles.html().indexOf("*")?"*"+titles.html():titles.html()),devHubTitle.html(-1===titles.html().indexOf("*")?"*"+titles.html():titles.html())):(-1!==document.title.indexOf("*")&&(document.title=document.title.replace("*","")),titles.length>0&&-1!==titles.html().indexOf("*")&&(titles.html(titles.html().replace("*","")),devHubTitle.html(titles.html().replace("*",""))))}function getHashParameter(param){if(location.hash){var regExp=new RegExp(param+"{([-a-zA-Z0-9 .\\%_]*)}",""),value=location.hash.match(regExp);return value&&value.length>1?decodeURIComponent(value[1]):!1}return!1}function getPrefix(){return window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/dev-hub")+1)}function reload(clearHash){if(clearHash){var loc=window.location.href,index=loc.indexOf("#");index>0&&(window.location=loc.substring(0,index))}else window.location.reload()}var titles=jQuery(".extension-title"),devHubTitle=jQuery(".devhub-title");return{getURLParameter:getURLParameter,getURLParameters:getURLParameters,setBrowserTitle:setBrowserTitle,toggleMarkDirty:toggleMarkDirty,getHashParameter:getHashParameter,getPrefix:getPrefix,reload:reload}}),define("apis/qglobal",["qvangular","core.models/app","client.models/rpc-session"],function(qvangular,App,RPCSession){function doIt(me,func,params,callback){return me.session.rpc({method:func,handle:-1,params:params||[]}).then(function(data){return callback&&callback(data.result),data.result})}function QGlobal(param){"function"==typeof param.rpc?this.session=param:(this.session=RPCSession.get("?transient=",param),this.session.open())}return QGlobal.prototype.getAppList=function(callback){var session=this.session;qvangular.$apply(qvangular.$rootScope,function(){App.getList(session).then(function(list){callback(list)})})},QGlobal.prototype.getAuthenticatedUser=function(callback){return doIt(this,"GetAuthenticatedUser",[],callback)},QGlobal.prototype.isPersonalMode=function(callback){return doIt(this,"IsPersonalMode",[],callback)},QGlobal.prototype.getQTProduct=function(callback){return doIt(this,"QTProduct",[],callback)},QGlobal.prototype.getProductVersion=function(callback){return doIt(this,"ProductVersion",[],callback)},QGlobal.prototype.getQvVersion=function(callback){return this.getProductVersion(callback)},QGlobal.prototype.cancelReload=function(){return doIt(this,"CancelReload",[])},QGlobal.prototype.getProgress=function(qRequestId,callback){return doIt(this,"GetProgress",[qRequestId],callback)},QGlobal.prototype.GetProgress=function(qRequestId,callback){return this.getProgress(qRequestId,callback)},QGlobal}),define("core.models/generic-object",["core.models/base-object","core.utils/deferred","util"],function(BaseObject,Deferred,util){"use strict";var GenericObject;return GenericObject=BaseObject.extend("GenericObject",{createChild:function(props,propForThis,Model){var session=this.session,params=[props];return Model=Model||GenericObject,propForThis&&params.push(propForThis),props.qInfo.qId=props.qInfo.qId||util.generateId(),this.rpc("CreateChild",null,params).then(function(result){return Model.getModel(result.qInfo.qId,session,function(){return Deferred.resolve(result.qReturn)})})},removeChild:function(id,propForThis){return GenericObject.remove(id,"DestroyChild",this,propForThis)},setChildArrayOrder:function(childIds){var params=[childIds];return this.rpc("SetChildArrayOrder",null,params)},removeAllChildren:function(propForThis){var params=[];return propForThis&&params.push(propForThis),this.rpc("DestroyAllChildren",null,params)},copyFrom:function(fromId){return this.rpc("CopyFrom",null,[fromId])},applyPatches:function(qPatches,qSoftPatch){return this.rpc("ApplyPatches",null,[qPatches,qSoftPatch])},clearSoftPatches:function(){return this.rpc("ClearSoftPatches")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])},exportData:function(fileType,path,filename,exportState){fileType=fileType||"OOXML",path=path||"",filename=filename||"",exportState=exportState||"P";var params=[fileType,path,filename,exportState];return this.rpc("ExportData",null,params,{raw:!0})},cancelRequest:function(requestId){var that=this,pendingRequest=that.session.getRequest(requestId);return that.session.rpc({method:"CancelRequest",handle:-1,params:[requestId]}).then(function(){pendingRequest&&"GetLayout"===pendingRequest.method&&that.setState(GenericObject.States.CANCELLED)})}})}),define("core.models/session-object",["core.models/generic-object","core.models/app"],function(GenericObject,App){"use strict";var SessionObject;return SessionObject=GenericObject.extend("SessionObject",{remove:function(){return SessionObject.remove(this.id,App.current)}}),SessionObject.get=function(props,app){function getHandle(){return app.createSessionObject(props)}var id=props.qInfo.qId||props.qInfo.qType;if(!id)throw new Error("no id");return props.qInfo.qId=id,app=app||App.current,this.getModel(id,app.session,getHandle)},SessionObject.remove=function(id,parent){return GenericObject.remove(id,"DestroySessionObject",parent)},SessionObject.extend=function(){var ctor=GenericObject.extend.apply(this,arguments);return ctor.get=SessionObject.get,ctor.remove=SessionObject.remove,ctor},SessionObject}),define("general.models/field",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Field;return Field=BaseObject.extend("Field",{clear:function(){return this.rpc("Clear","qReturn")},lock:function(){return this.rpc("Lock","qReturn")},unlock:function(){return this.rpc("Unlock","qReturn")},clearOther:function(softlock){return this.rpc("ClearAllButThis","qReturn",[softlock||!1])},selectPossible:function(softlock){return this.rpc("SelectPossible","qReturn",[softlock||!1])},selectExcluded:function(softlock){return this.rpc("SelectExcluded","qReturn",[softlock||!1])},selectAll:function(softlock){return this.rpc("SelectAll","qReturn",[softlock||!1])},selectAlternative:function(softLock){return this.rpc("SelectAlternative",null,[softLock||!1])},selectMatch:function(match,softlock){return this.rpc("Select","qReturn",[match||"",softlock||!1])},toggleSelect:function(match,softlock){return this.rpc("ToggleSelect","qReturn",[match||"",softlock||!1])},select:function(values,toggle,softlock){return this.rpc("LowLevelSelect","qReturn",[values,toggle||!1,softlock||!1])},selectValues:function(values,toggle,softlock){return this.rpc("SelectValues","qReturn",[values,toggle||!1,softlock||!1])}},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0}}}),Field.get=function(fieldName,stateName,app){function getHandle(){return app.rpc("GetField","qReturn",[fieldName,stateName])}stateName=stateName||"$";var id="FIELD_"+fieldName+"_"+stateName;return app=app||App.current,this.getModel(id,app.session,getHandle)},Field}),define("client.models/current-selections",["core.models/session-object","core.models/app","general.models/field"],function(SessionObject,App,Field){"use strict";function modifyField(app,fieldName,fnName){Field.get(fieldName,void 0,app).then(function(field){field[fnName]()})}var CurrentSelections;return CurrentSelections=SessionObject.extend("CurrentSelections",{clearField:function(fieldName){modifyField(this.app,fieldName,"clear")},lockField:function(fieldName){modifyField(this.app,fieldName,"lock")},unlockField:function(fieldName){modifyField(this.app,fieldName,"unlock")},clearAll:function(){return this.app.rpc("ClearAll",null)},back:function(){return this.app.rpc("Back",null)},forward:function(){return this.app.rpc("Forward",null)}}),CurrentSelections.get=function(app){return app=app||App.current,SessionObject.get.call(this,{qInfo:{qType:"CurrentSelection"},qSelectionObjectDef:{}},app).then(function(currentSelection){return currentSelection.app=app,currentSelection})},CurrentSelections}),define("objects.models/visualization-object",["core.models/app","core.models/generic-object"],function(App,GenericObject){"use strict";var VisualizationObject;return VisualizationObject=GenericObject.extend("VisualizationObject",{init:function(){this._super.apply(this,Array.prototype.slice.apply(arguments))}}),VisualizationObject.create=function(props,parent,propsForParent){return parent=parent||App.current,parent.createChild?parent.createChild(props,propsForParent,this):GenericObject.create.call(this,props)},VisualizationObject.createTransient=function(props,app){app=app||App.current;var Model=this;return app.createSessionObject(props).then(function(result){return new Model({id:null,handle:result.qHandle,session:app.session})})},VisualizationObject.remove=function(id,parent,propsForParent){var method=null;parent&&parent.removeChild&&(method="DestroyChild"),GenericObject.remove.call(this,id,method,parent,propsForParent)},VisualizationObject.extend=function(){var ctor=GenericObject.extend.apply(this,arguments);return ctor.extend=VisualizationObject.extend,ctor.create=VisualizationObject.create,ctor.createTransient=VisualizationObject.createTransient,ctor.remove=VisualizationObject.remove,ctor},VisualizationObject}),define("client.models/bookmark",["jquery","core.models/base-object","core.models/app"],function($,BaseObject,App){"use strict";var Bookmark;return Bookmark=BaseObject.extend("Bookmark",{clone:function(){return this._super("CloneBookmark")},apply:function(){return Bookmark.apply(this.id,this.app)}},{listProperties:{qBookmarkListDef:{qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}}}),Bookmark.get=function(id,app){function getHandle(){return app.rpc("GetBookmark","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Bookmark.apply=function(id,app){app=app||App.current;var retval=app.rpc("ApplyBookmark","qSuccess",[id]);return retval},Bookmark.create=function(opts,app){var data={qMetaDef:{title:"",description:""},sheetId:opts.sheetId||null,selectionFields:opts.selectionFields,creationDate:(new Date).toISOString()};return BaseObject.create.call(this,$.extend(!0,{},data,opts),"CreateBookmark",app)},Bookmark.remove=function(id,app){return BaseObject.remove(id,"DestroyBookmark",app)},Bookmark.extend=function(name,proto,opts){var ctor=BaseObject.extend.call(this,name,proto,opts);return ctor.extend=Bookmark.extend,ctor.create=Bookmark.create,ctor.remove=Bookmark.remove,ctor.get=Bookmark.get,ctor},Bookmark}),define("client.models/snapshot",["client.models/bookmark","core.utils/deferred"],function(Bookmark,Deferred){"use strict";var Snapshot,maxLimit=500;return Snapshot=Bookmark.extend("Snapshot",{applyEmbeddedSnapshot:function(){return this.rpc("Apply")}},{listProperties:{qBookmarkListDef:{qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}}}),Snapshot.getLibraryContent=function(objectId,update){var filteredSnapshots,deferred=new Deferred;return this.getList().then(function(snapshotModel){snapshotModel.getLayout().then(function(snapshots){filteredSnapshots=snapshots.filter(function(snapshot){var includeInList=!0;return objectId&&(includeInList=objectId===snapshot.qData.sourceObjectId),!snapshot.qData.isClone&&includeInList}),deferred.resolve(filteredSnapshots)}),snapshotModel.Invalidated&&snapshotModel.Invalidated.unbind(),snapshotModel.Invalidated.bind(update)}),deferred.promise},Snapshot.unbindList=function(){this.getList().then(function(snapshotModel){snapshotModel.Invalidated.unbind()})},Snapshot.getSnapshotCount=function(objectId){var i,deferred=new Deferred,snapshotCount=0;return this.getListLayout().then(function(snapshots){for(i=0;i<snapshots.length;i++)snapshots[i].qData.isClone||snapshots[i].qData.sourceObjectId!==objectId||snapshotCount++;deferred.resolve(snapshotCount)}),deferred.promise},Snapshot.create=function(opts,app){var i,belowLimit,deferred=new Deferred,totalCount=0;return this.getListLayout().then(function(snapshots){for(i=0;i<snapshots.length;i++)snapshots[i].qData.isClone||totalCount++;belowLimit=maxLimit>totalCount,belowLimit?Bookmark.create.call(Snapshot,opts,app).then(function(){deferred.resolve(belowLimit)}):deferred.resolve(belowLimit)}),deferred.promise},Snapshot.getEmbedded=function(id,parent){function getHandle(){return parent.rpc("GetSnapshotObject","qReturn",[])}return this.getModel(id,parent.session,getHandle)},{Snapshot:Snapshot}}),define("objects.backend-api/engine-throttle",["jquery","core.utils/class","core.utils/notification","util"],function($,Class,Notification,util){function throttleQueue(q,t){var self=this;this.queuedRequests.push(q),clearTimeout(this._debounceTimer),t>=10?this._debounceTimer=setTimeout(function(){sendLastThrottledRequest.call(self)},t):sendLastThrottledRequest.call(self)}function sendLastThrottledRequest(){if(this.ongoingRequests.length)return void(this.waitingForResponse=!0);var req=this.queuedRequests.pop();for(req&&sendRequest.call(this,req);this.queuedRequests.length;)req=this.queuedRequests.shift(),req.dfd.reject()}function sendRequest(q){this.waitingForResponse=!1,this.ongoingRequests.push(q);var self=this,wrapper=q.wrapper;q.sentAt=Date.now(),wrapper.then(function(){self.ongoingRequests.splice(self.ongoingRequests.indexOf(q),1),q.respondedAt=Date.now(),self.resolvedRequests.push({sentAt:q.sentAt,respondedAt:q.respondedAt,requestedAt:q.requestedAt}),self.resolvedRequests.length>10&&(self.resolvedRequests=self.resolvedRequests.slice(-10)),q.requestedAt>self._latestResolvedRequestedAt?q.dfd.resolve.apply(q.dfd,[].slice.call(arguments)):q.dfd.reject(),self._latestResolvedRequestedAt=q.requestedAt},function(){self.ongoingRequests.splice(self.ongoingRequests.indexOf(q),1),q.respondedAt=Date.now(),q.dfd.reject.apply(q.dfd,[].slice.call(arguments))}).always(function(){self.waitingForResponse&&sendLastThrottledRequest.call(self)}),this.Send.emit(q.data,wrapper)}var Throttle,defaultOptions={enabled:!0,delay:50};return Throttle=Class.extend("Throttle",{init:function(){this.options={},this.ongoingRequests=[],this.queuedRequests=[],this.recentRequests=[],this.resolvedRequests=[],this._debounceTimer=null,this._latestResolvedRequestedAt=-1,Notification.mixin(this),this.notification("Send"),this.notification("Cancel"),this.setOptions({})},destroy:function(){this.clear(),this.recentRequests=[],this.resolvedRequests=[],Notification.release(this)},setOptions:function(opts){this.options=util.extend(!0,{},defaultOptions,this.options,opts),this.enabled=this.options.enabled||!1,this.delay=this.options.delay||-1},clear:function(){clearTimeout(this._debounceTimer);for(var request;this.queuedRequests.length;)request=this.queuedRequests.pop(),request.dfd.reject();for(;this.ongoingRequests.length;)request=this.ongoingRequests.pop(),request.dfd.reject()},queue:function(data){var debounceDelay=this.enabled?this.delay:-1,requestObject={data:data,dfd:new $.Deferred,wrapper:new $.Deferred,requestedAt:Date.now()},avgResponseTime=Math.max(this._getAvgResolutionTime(),debounceDelay);return 1>debounceDelay||this.recentRequests.length<1||Date.now()-this.recentRequests.slice(-1)[0].requestedAt>avgResponseTime?throttleQueue.apply(this,[requestObject,0]):throttleQueue.apply(this,[requestObject,Math.min(debounceDelay,1e3)]),this.recentRequests.push(requestObject),this.recentRequests.length>10&&(this.recentRequests=this.recentRequests.slice(-10)),requestObject.dfd.promise()},updateResolutionTime:function(){this._latestResolvedRequestedAt=Date.now()},_getAvgResolutionTime:function(){var avgResponseTime;return this.resolvedRequests.length&&(avgResponseTime=0,this.resolvedRequests.forEach(function(q){avgResponseTime+=q.respondedAt-q.sentAt}),avgResponseTime/=this.resolvedRequests.length),avgResponseTime}})}),define("objects.backend-api/cube-slicer",["core.utils/class","objects.utils/shapes/rect"],function(Class,Rect){"use strict";var CubeSlicer,areaRect=new Rect(0,0,0,0),pageRect=new Rect(0,0,0,0);return CubeSlicer=Class.extend("CubeSlicer",{init:function(){this.pages=[]},get:function(areas){return areas.map(function(area){return this.getPage(area)}.bind(this))},getPage:function(area){var storage,i,cover,coverage=[];for(i=0;i<this.pages.length;i++)if(storage=this.pages[i].qArea,areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(storage.qLeft,storage.qTop,storage.qWidth,storage.qHeight),cover=pageRect.intersection(areaRect,!0),coverage.push({coverage:cover?cover.clone():new Rect(0,0,0,0),idx:i}),storage.qLeft<=area.qLeft&&storage.qLeft+storage.qWidth>=area.qLeft+area.qWidth&&storage.qTop<=area.qTop&&storage.qTop+storage.qHeight>=area.qTop+area.qHeight)return this._extract(area,this.pages[i]);return coverage.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),coverage[0].coverage.height>0&&coverage[0].coverage.width>0?this._extract(area,this.pages[coverage[0].idx]):{qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0},qMatrix:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(pages){this.pages=pages},containsArea:function(area){for(var a,i=0;i<this.pages.length;i++)if(a=this.pages[i].qArea,a.qLeft<=area.qLeft&&a.qLeft+a.qWidth>=area.qLeft+area.qWidth&&a.qTop<=area.qTop&&a.qTop+a.qHeight>=area.qTop+area.qHeight)return!0;return!1},contains:function(areas){return this.pages&&this.pages.length?0===areas.filter(function(a){return!this.containsArea(a)}.bind(this)).length:!1},_extract:function(area,fromPage){areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(fromPage.qArea.qLeft,fromPage.qArea.qTop,fromPage.qArea.qWidth,fromPage.qArea.qHeight);var matrix,x,y,intersection=areaRect.intersection(pageRect,!0);return intersection?(y=Math.max(0,area.qTop-fromPage.qArea.qTop),x=Math.max(0,area.qLeft-fromPage.qArea.qLeft),matrix=fromPage.qMatrix.slice(y,y+intersection.height).map(function(row){return row.slice(x,x+intersection.width)}),{qArea:{qTop:intersection.y,qLeft:intersection.x,qWidth:intersection.width,qHeight:intersection.height},qMatrix:matrix}):{qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0},qMatrix:[]}}})}),define("objects.backend-api/pivot-cube-slicer",["./cube-slicer","objects.utils/shapes/rect"],function(CubeSlicer,Rect){"use strict";function addNode(node,slicedTrunk){var key,newNode={};for(key in node)"qSubNodes"!==key&&node.hasOwnProperty(key)&&(newNode[key]=node[key]);return slicedTrunk.push(newNode),newNode}function getSlicedTreeRecursive(offset,length,subNodes){var i,qixNode,node,slicedTrunk=[],subSlicedTree=[],up=0,down=0;for(subNodes.length&&(up=subNodes[0].qUp||0,down=subNodes[subNodes.length-1].qDown||0),i=0;i<subNodes.length;++i)if(qixNode=subNodes[i],qixNode.qSubNodes.length>0&&(subSlicedTree=getSlicedTreeRecursive(offset,length,qixNode.qSubNodes)),node=null,(0===qixNode.qSubNodes.length&&deepCount>=offset&&offset+length>=deepCount||subSlicedTree.length>0)&&(node=addNode(qixNode,slicedTrunk),void 0!==node.qUp&&1===slicedTrunk.length&&(node.qUp=up+i),node.qSubNodes=subSlicedTree),0===qixNode.qSubNodes.length&&deepCount++,deepCount===offset+length){node&&void 0!==node.qDown&&(node.qDown=down+(subNodes.length-1-i));break}return slicedTrunk}function getSlicedTree(offset,length,subNodes){return deepCount=0,getSlicedTreeRecursive(offset,length,subNodes)}var deepCount,PivotCubeSlicer,areaRect=new Rect(0,0,0,0),pageRect=new Rect(0,0,0,0);return PivotCubeSlicer=CubeSlicer.extend("PivotCubeSlicer",{init:function(){this._super(),this.requestedAreas=[]},getPage:function(area){var storage,i,cover,coverage=[];for(i=0;i<this.pages.length;i++)if(storage=this.pages[i].qArea,areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(storage.qLeft,storage.qTop,storage.qWidth,storage.qHeight),cover=pageRect.intersection(areaRect,!0),coverage.push({coverage:cover?cover.clone():new Rect(0,0,0,0),idx:i}),storage.qLeft<=area.qLeft&&storage.qLeft+storage.qWidth>=area.qLeft+area.qWidth&&storage.qTop<=area.qTop&&storage.qTop+storage.qHeight>=area.qTop+area.qHeight)return this._extract(area,this.pages[i]);return coverage.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),coverage[0].coverage.height>0&&coverage[0].coverage.width>0?this._extract(area,this.pages[coverage[0].idx]):{qLeft:[],qTop:[],qData:[],qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0}}},_extract:function(area,fromPage){var leftTree,topTree;areaRect.set(area.qLeft,area.qTop,area.qWidth,area.qHeight),pageRect.set(fromPage.qArea.qLeft,fromPage.qArea.qTop,fromPage.qArea.qWidth,fromPage.qArea.qHeight);var matrix,x,y,intersection=areaRect.intersection(pageRect,!0);return intersection?(y=Math.max(0,area.qTop-fromPage.qArea.qTop),x=Math.max(0,area.qLeft-fromPage.qArea.qLeft),matrix=fromPage.qData.slice(y,y+intersection.height).map(function(row){return row.slice(x,x+intersection.width)}),leftTree=getSlicedTree(y,intersection.height,fromPage.qLeft),topTree=getSlicedTree(x,intersection.width,fromPage.qTop),{qLeft:leftTree,qTop:topTree,qData:matrix,qArea:{qTop:intersection.y,qLeft:intersection.x,qWidth:intersection.width,qHeight:intersection.height}}):{qLeft:[],qTop:[],qData:[],qArea:{qTop:area.qTop,qLeft:area.qLeft,qWidth:0,qHeight:0}}}})}),define("objects.backend-api/cache-cube",["jquery","core.utils/class","util","objects.backend-api/engine-throttle","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function($,Class,util,EngineThrottle,CubeSlicer,PivotCubeSlicer){var Cache,defaultOptions={mode:"S",enabled:!0,debouncing:{enabled:!0,delay:50},height:250,width:250};return Cache=Class.extend("CacheCube",{init:function(model,responseProperty,path,opts){this.model=model,this.responseProperty=responseProperty,this.options={},this.cubeHeight=0,this.cubeWidth=0,this.setOptions(opts||{}),this.setPath(path),"P"===this.options.mode?this.cube=new PivotCubeSlicer:this.cube=new CubeSlicer,this.throttle=new EngineThrottle;var self=this;this.throttle.Send.bind(function(areas,dfd){var directions=self._getDirections(self.throttle.recentRequests.map(function(q){return{top:q.data[0].qTop,left:q.data[0].qLeft}})),areasToCache=self._getAreasToCache(areas,directions.vertical,directions.horizontal);self.cacheData(areasToCache,areas).then(function(subset){self.cube?dfd.resolve(subset):dfd.reject()},function(){dfd.reject()})}),this._modelBinding=function(){self.clear()},this.model.Invalidated.bind(this._modelBinding)},destroy:function(){this.cube.destroy(),this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle,delete this.cube},setMethodName:function(s){this.method=s},setPath:function(s){this.path=s},setCubeSize:function(size){this.cubeHeight=size.qcy,this.cubeWidth=size.qcx},setOptions:function(opts){opts&&(this.options=util.extend(!0,{},defaultOptions,this.options,opts),this.cacheHeight=this.options.height,this.cacheWidth=this.options.width,this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1})},clear:function(){this.cube.clear(),this.throttle.clear()},set:function(dataPages){this.clear(),dataPages&&dataPages.length&&this.cube.store(dataPages)},cacheData:function(areasToCache,subset){return this.model.rpc(this.method,this.responseProperty,[this.path,areasToCache]).then(function(pages){return this.cube?(this.cube.store(pages),this.cube.get(subset)):pages}.bind(this))},getData:function(srcAreas){if(!this.enabled||!this.cubeHeight||!this.cubeWidth)return this.model.rpc(this.method,this.responseProperty,[this.path,srcAreas]);var i,area,areas=[];for(i=0;i<srcAreas.length;++i)area=srcAreas[i],areas.push({qTop:Math.max(Math.floor(area.qTop),0),qLeft:Math.max(area.qLeft,0),qHeight:Math.min(area.qHeight,this.cubeHeight-Math.floor(area.qTop)),qWidth:Math.min(area.qWidth,this.cubeWidth-area.qLeft)});return this.cube.contains(areas)?(this.throttle.updateResolutionTime(),$.Deferred().resolve(this.cube.get(areas)).promise()):0===areas[0].qTop&&this.cube.isEmpty()?(this.throttle.updateResolutionTime(),this.cacheData(areas,areas)):this.throttle.queue(areas)},_getDirections:function(lastRequests){if(!lastRequests||lastRequests.length<2)return{vertical:0,horizontal:0};var lastCouple=lastRequests.slice(-2),diffY=lastCouple[1].top-lastCouple[0].top,diffX=lastCouple[1].left-lastCouple[0].left;return{vertical:0>diffY?-1:diffY>0?1:0,horizontal:0>diffX?-1:diffX>0?1:0}},_getAreasToCache:function(areas,h,w){var i,wiggleHeight,wiggleWidth,offsetTop,offsetLeft,height,width,top,left,cacheAreas=[];for("undefined"==typeof h&&(h=0),"undefined"==typeof w&&(w=0),i=0;i<areas.length;++i)wiggleHeight=0!==h?Math.floor(.5*Math.max(0,this.cacheHeight-areas[i].qHeight)):0,wiggleWidth=0!==w?Math.floor(.5*Math.max(0,this.cacheWidth-areas[i].qWidth)):0,offsetTop=wiggleHeight*h-wiggleHeight,offsetLeft=wiggleWidth*w-wiggleWidth,height=0!==h?Math.max(0,Math.min(Math.max(areas[i].qHeight,this.cacheHeight),this.cubeHeight)):areas[i].qHeight,width=0!==w?Math.max(0,Math.min(Math.max(areas[i].qWidth,this.cacheWidth),this.cubeWidth)):areas[i].qWidth,top=Math.max(0,Math.min(areas[i].qTop+offsetTop,this.cubeHeight-height)),left=Math.max(0,Math.min(areas[i].qLeft+offsetLeft,this.cubeWidth-width)),cacheAreas.push({qTop:top,qHeight:height,qLeft:left,qWidth:width});return cacheAreas}})}),define("objects.backend-api/backend-throttle",["core.utils/class","util","objects.backend-api/engine-throttle"],function(Class,util,EngineThrottle){var Cache,defaultOptions={enabled:!0,debouncing:{enabled:!0,delay:50}};return Cache=Class.extend({init:function(model,responseProperty,path){this.model=model,this.responseProperty=responseProperty,this.options={},this.setOptions({}),this.setPath(path),this.throttle=new EngineThrottle,this.throttle.Send.bind(function(areas,dfd){self.model.rpc(self.method,self.responseProperty,[self.path,areas]).then(function(pages){dfd.resolve(pages)},function(){dfd.reject()})});var self=this;this._modelBinding=function(){self.clear()},this.model.Invalidated.bind(this._modelBinding)},setMethodName:function(s){this.method=s},setPath:function(s){this.path=s},setOptions:function(opts){this.options=util.extend(!0,{},defaultOptions,this.options,opts),this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1}},clear:function(){
this.throttle.clear()},destroy:function(){this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle},set:function(){this.clear()},getData:function(areas){return this.enabled?this.throttle.queue(areas):this.model.rpc(this.method,this.responseProperty,[this.path,areas])}})}),define("objects.backend-api/backend-api",["jquery","core.utils/class","core.utils/deferred","./cache-cube","./backend-throttle","core.models/app"],function($,Class,Deferred,CacheCube,BackendThrottle,App){"use strict";var BackendApi;return BackendApi=Class.extend("BackendApi",{init:function(model,path,cacheOpts){this.model=model,this.localeInfo=model.session.currentApp.layout.qLocaleInfo,this.path=path,path&&(this.dataPath=path.slice(1,-3)),this.cacheCube=new CacheCube(model,"qDataPages",this.path,cacheOpts),this.backendStackThrottle=new BackendThrottle(model,"qDataPages",this.path)},setCacheOptions:function(o){this.cacheCube.setOptions(o)},updateCache:function(){},applyPatches:function(replaceParams){return this.model.rpc("ApplyPatches",null,replaceParams)},clearSoftProperties:function(){var self=this;return this.model.getLayout().then(function(layout){return layout.qHasSoftPatches?self.model.rpc("ClearSoftPatches"):Deferred.resolve()})},beginSelections:function(){return App.current.switchModal(this.model,this.path)},endSelections:function(accept){return App.current.switchModal(null,null,accept)},clearSelections:function(dimNo){return dimNo=dimNo||0,this.model.rpc("ClearSelections",null,[this.path,[dimNo]])},getDimensionInfos:function(){return this.model.layout[this.dataPath].qDimensionInfo?Array.isArray(this.model.layout[this.dataPath].qDimensionInfo)?this.model.layout[this.dataPath].qDimensionInfo:[this.model.layout[this.dataPath].qDimensionInfo]:[]},getMeasureInfos:function(){return this.model.layout[this.dataPath].qMeasureInfo},getRowCount:function(){return this.model.layout[this.dataPath].qSize.qcy},eachDataRow:function(callback){var myData=this.model.layout[this.dataPath],cont=!0;myData&&$.each(myData.qDataPages,function(i,page){return $.each(page.qMatrix,function(x,row){return cont=callback(page.qArea.qTop+x,row)}),cont})},drillUp:function(column,steps){return this.model.rpc("DrillUp",null,[this.path,column,steps])},hasSelections:function(){for(var dimensionInfos=this.getDimensionInfos(),i=0;i<dimensionInfos.length;++i)if(dimensionInfos[i].qStateCounts.qSelected>0)return!0;return!1},inSelections:function(){return this.model.layout.qSelectionInfo&&this.model.layout.qSelectionInfo.qInSelections},destroy:function(){this.cacheCube.destroy(),this.backendStackThrottle.destroy()},getSize:function(){return this.model.layout[this.dataPath].qSize}})}),define("objects.backend-api/snapshot-api",["./backend-api","core.utils/deferred","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(BackendApi,Deferred,CubeSlicer,PivotCubeSlicer){"use strict";function sliceDataPages(slicer,layout,rects,responseProperty){if(slicer){layout.snapshotData.object.origDataPages||(layout.snapshotData.object.origDataPages=layout.qHyperCube[responseProperty]);for(var i=0;i<rects.length;i++)rects[i].qHeight=Math.min(layout.qHyperCube.qSize.qcy,rects[i].qHeight),rects[i].qTop=layout.snapshotData.object.origDataPages[i].qArea.qTop;layout.qHyperCube[responseProperty]=slicer.get(rects)}}function prepareCubeSlicer(layout){if("pivot-table"===layout.visualization)this.responseProperty="qPivotDataPages",this.slicer=new PivotCubeSlicer;else{if("table"!==layout.visualization)return;this.slicer=new CubeSlicer}layout.snapshotData.object.origDataPages?this.slicer.store(layout.snapshotData.object.origDataPages):this.slicer.store(layout.qHyperCube[this.responseProperty])}var SnapshotApi;return SnapshotApi=BackendApi.extend("SnapshotAPI",{init:function(model){this.responseProperty="qDataPages",prepareCubeSlicer.call(this,model.layout),this._super(model,model.layout.qListObject?"/qListObjectDef":"/qHyperCubeDef")},getData:function(rects){var defer=Deferred();if("map"===this.model.layout.visualization){var layerIndex=this.dataPath.split("/")[1],arr=this.dataPath.split("/"),dataType=arr[arr.length-1];"polygon"===this.model.layout.layers[layerIndex].type&&"3"===this.model.layout.layers[layerIndex].version?defer.resolve({qDataPages:this.model.layout.layers[layerIndex].geodata.qHyperCube[this.responseProperty]}):defer.resolve({qDataPages:this.model.layout.layers[layerIndex][dataType][this.responseProperty]})}else sliceDataPages(this.slicer,this.model.layout,rects,this.responseProperty),defer.resolve(this.model.layout[this.dataPath][this.responseProperty]);return defer.promise},getHyperCubeBinnedData:function(){return Deferred.resolve(this.model.layout.dataPages)},getSize:function(){return this.model.layout[this.dataPath].qSize},beginSelections:function(){},endSelections:function(){},clearSelections:function(){},isSnapshot:!0})}),define("apis/qfieldvalue",[],function(){function QFieldValue(cell,parent){Object.defineProperties(this,{qText:{value:cell.qText},qElemNumber:{value:cell.qElemNumber},qState:{value:cell.qState},field:{value:parent}}),isNaN(cell.qNum)||Object.defineProperties(this,{qNum:{value:cell.qNum}}),cell.qFrequency&&Object.defineProperties(this,{qFrequency:{value:cell.qFrequency}})}return QFieldValue.prototype.select=function(toggle,softlock){return this.field.select([this.qElemNumber],toggle||!1,softlock||!1)},QFieldValue}),define("apis/qfield",["qvangular","core.utils/deferred","general.models/field","core.utils/notification","apis/qfieldvalue"],function(qvangular,Deferred,Field,Notification,QFieldValue){function doIt(me,func,arg1,arg2,arg3,arg4,arg5){var dfd=new Deferred;return me.waitFor.then(function(){me.field[func](arg1,arg2,arg3,arg4,arg5).then(function(){dfd.resolve()},function(){dfd.reject()})}),dfd.promise}function QField(qapp,fldname,statename){var me=this,dfd=new Deferred;return me.qapp=qapp,me.waitFor=dfd.promise,me.fldname=fldname,me.rows=[],Notification.create(me,"OnData"),"function"==typeof qapp.isMock?(me.field=qapp,void dfd.resolve()):void qvangular.$apply(qvangular.$rootScope,function(){Field.get(fldname,statename||"$",qapp.model).then(function(field){me.field=field,dfd.resolve()},function(){dfd.reject()})})}return QField.prototype.clear=function(){return doIt(this,"clear")},QField.prototype.lock=function(){return doIt(this,"lock")},QField.prototype.unlock=function(){return doIt(this,"unlock")},QField.prototype.clearOther=function(softlock){return doIt(this,"clearOther",softlock||!1)},QField.prototype.selectAll=function(softlock){return doIt(this,"selectAll",softlock||!1)},QField.prototype.selectExcluded=function(softlock){return doIt(this,"selectExcluded",softlock||!1)},QField.prototype.selectAlternative=function(softlock){return doIt(this,"selectAlternative",softlock||!1)},QField.prototype.selectPossible=function(softlock){return doIt(this,"selectPossible",softlock||!1)},QField.prototype.toggleSelect=function(match,softlock){return doIt(this,"toggleSelect",match,softlock||!1)},QField.prototype.selectMatch=function(match,softlock){return doIt(this,"selectMatch",match,softlock||!1)},QField.prototype.select=function(values,toggle,softlock){return doIt(this,"select",values,toggle||!1,softlock||!1)},QField.prototype.selectValues=function(values,toggle,softlock){var val=[];return values.forEach(function(item){"number"==typeof item?val.push({qIsNumeric:!0,qNumber:item}):"string"==typeof item?val.push({qText:item}):val.push(item)}),doIt(this,"selectValues",val,toggle||!1,softlock||!1)},QField.prototype.getData=function(options){if(!this.requestActive){this.requestActive=!0,this.genericObject&&(this.genericObject.close(),delete this.genericObject);var me=this;return this.qapp.createGenericObject({qListObjectDef:{qDef:{qFieldDefs:[this.fldname]},qFrequencyMode:options&&options.rows||"V",qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:options&&options.rows||200,qWidth:1}]}},function(reply){me.rows.length=0,reply.qListObject.qDataPages.forEach(function(page){page.qMatrix.forEach(function(row){me.rows.push(new QFieldValue(row[0],me))})}),me.rowCount=reply.qListObject.qDimensionInfo.qCardinal,me.stateCounts=reply.qListObject.qDimensionInfo.qStateCounts,me.requestActive=!1,me.OnData.emit()}).then(function(go){me.genericObject=go}),this}},QField.prototype.getMoreData=function(){if(!(this.requestActive||this.rowCount<=this.rows.length)){this.requestActive=!0;var me=this,requestPage={qTop:this.rows.length,qLeft:0,qWidth:1,qHeight:50};return me.genericObject.rpc("GetListObjectData",null,["/qListObjectDef",[requestPage]]).then(function(reply){reply.qDataPages[0].qMatrix.forEach(function(row){me.rows.push(new QFieldValue(row[0],me))}),me.requestActive=!1,me.OnData.emit()}),this}},QField}),define("apis/qbookmark",["client.models/bookmark"],function(Bookmark){function QBookmark(app){this.app=app}return QBookmark.prototype.create=function(title,description){return Bookmark.create({qMetaDef:{title:title,description:description}},this.app)},QBookmark.prototype.apply=function(id){return Bookmark.apply(id,this.app)},QBookmark.prototype.remove=function(id){return Bookmark.remove(id,this.app)},QBookmark}),define("core.models/variable",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Variable=BaseObject.extend("Variable",{setStringValue:function(content){return this.rpc("SetStringValue",null,[content])},setNumValue:function(content){return this.rpc("SetNumValue",null,[content])},setDualValue:function(text,num){return this.rpc("SetDualValue",null,[text,num])}},{listProperties:{qVariableListDef:{qType:"variable",qShowReserved:!0,qShowConfig:!0,qData:{tags:"/tags"}}}});return Variable.get=function(id,app){function getHandle(){return app.rpc("GetVariableById","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Variable.getByName=function(name,app){function getHandle(){return app.rpc("GetVariableByName","qReturn",[name])}return app=app||App.current,this.getModel(name,app.session,getHandle)},Variable.create=function(props,app){return app=app||App.current,BaseObject.create.call(Variable,props,"CreateVariableEx",app)},Variable.createTransient=function(props,app){app=app||App.current,props.qInfo=props.qInfo||{},props.qInfo.qType=props.qInfo.qType||this.name.toLowerCase();var Model=this;return app.createSessionVariable(props).then(function(result){return new Model({id:null,handle:result.qHandle,session:app.session})})},Variable.remove=function(id,app){return BaseObject.remove(id,"DestroyVariableById",app)},Variable}),define("apis/qvariable",["core.utils/deferred","core.models/variable"],function(Deferred,Variable){function QVariable(app,qapp){this.app=app,this.qapp=qapp}return QVariable.prototype.create=function(qProp){var props;return props="string"==typeof qProp?{qName:qProp}:qProp,Variable.create(props,this.app)},QVariable.prototype.createSessionVariable=function(qProp){return Variable.createTransient(qProp,this.app)},QVariable.prototype.get=function(qId){return Variable.get(qId,this.app)},QVariable.prototype.getByName=function(qName){return Variable.getByName(qName,this.app)},QVariable.prototype.setStringValue=function(qName,qVal){var dfd=new Deferred;return Variable.getByName(qName,this.app).then(function(model){model.setStringValue(qVal).then(function(reply){dfd.resolve(reply)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QVariable.prototype.setNumValue=function(qName,qVal){var dfd=new Deferred;return Variable.getByName(qName,this.app).then(function(model){model.setNumValue(qVal).then(function(reply){dfd.resolve(reply)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QVariable.prototype.setContent=function(name,content){return this.setStringValue(name,content+"")},QVariable.prototype.getContent=function(name,callback){var dfd=new Deferred,wrapper=this.qapp,okFunc=callback?function(data){callback(data,wrapper)}:function(){};return Variable.getByName(name,this.app).then(function(model){model.getLayout().then(function(layout){var data={qContent:{qString:layout.qText,qIsNum:!isNaN(layout.qNum)}};okFunc(data,wrapper),dfd.resolve(data)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QVariable}),define("apis/qtable",["core.utils/notification"],function(Notification){function QHeader(cell,col,parent){Object.defineProperties(this,{qFallbackTitle:{value:cell.qFallbackTitle},qSortIndicator:{value:cell.qSortIndicator},qReverseSort:{value:cell.qReverseSort||!1},col:{value:col},isOrderedBy:{value:col===parent.qHyperCube.qEffectiveInterColumnSortOrder[0]},isDimension:{value:col<parent.qHyperCube.qDimensionInfo.length},selections:{value:[]},parent:{value:parent}}),cell.qCardinal>0&&Object.defineProperties(this,{qCardinal:{value:cell.qCardinal},qStateCounts:{value:cell.qStateCounts}}),cell.qMax&&Object.defineProperties(this,{qMax:{value:cell.qMax},qMin:{value:cell.qMin}}),cell.qGroupFieldDefs&&cell.qGroupFieldDefs.length>0&&Object.defineProperties(this,{field:{value:parent.app.field(cell.qGroupFieldDefs[cell.qGroupPos])}})}function QDimensionCell(cell,qDimensionInfo,col,parent){Object.defineProperties(this,{qDimensionInfo:{value:qDimensionInfo},qText:{value:cell.qIsOtherCell?qDimensionInfo.othersLabel:cell.qText},qElemNumber:{value:cell.qElemNumber},qState:{value:cell.qState},col:{value:col},selected:{get:function(){return this.header.isSelected(this.qElemNumber)}},header:{get:function(){return this.parent.headers[this.col]}},parent:{value:parent}}),isNaN(cell.qNum)||Object.defineProperties(this,{qNum:{value:cell.qNum}})}function QMeasureCell(cell,qMeasureInfo,qGrandTotal){Object.defineProperties(this,{qMeasureInfo:{value:qMeasureInfo},qGrandTotal:{value:qGrandTotal},qText:{value:cell.qText}}),isNaN(cell.qNum)||Object.defineProperties(this,{qNum:{value:cell.qNum}})}function QRow(row,qHyperCube,parent){var dimensions=[],measures=[],dimcnt=qHyperCube.qDimensionInfo.length;row.forEach(function(cell,col){dimcnt>col?dimensions.push(new QDimensionCell(cell,qHyperCube.qDimensionInfo[col],col,parent)):measures.push(new QMeasureCell(cell,qHyperCube.qMeasureInfo[col-dimcnt],qHyperCube.qGrandTotalRow[col-dimcnt]))}),Object.defineProperties(this,{dimensions:{value:dimensions},measures:{value:measures},cells:{value:dimensions.concat(measures)}})}function QTable(app,obj,path){if(Notification.create(this,"OnData"),Object.defineProperties(this,{app:{value:app},path:{value:path||"qHyperCube"},defPath:{get:function(){return this.path+"Def"}},rows:{value:[]},headers:{value:[]},totals:{value:[]},rowCount:{get:function(){return this.qHyperCube.qSize.qcy}},colCount:{get:function(){return this.qHyperCube.qSize.qcx}}}),"function"==typeof obj.then){var me=this;obj.then(function(model){setModelView(me,model)})}else{var model=obj.backendApi?obj.backendApi.model:obj;setModelView(this,model,obj.backendApi?obj:void 0)}}function setModelView(me,model,view){Object.defineProperties(me,{model:{value:model},view:{value:view}}),refresh(me),me.model.Validated.bind(function(){refresh(me)})}function refresh(me){if(!me.qHyperCube&&me.model.layout&&(me.qHyperCube=me.model.layout[me.path]),!(me.model&&me.model.layout&&me.model.layout.qSelectionInfo&&me.model.layout.qSelectionInfo.qInSelections)){if(me.headers.length=0,me.totals.length=0,me.rows.length=0,me.qHyperCube){var dimcnt=me.qHyperCube.qDimensionInfo?me.qHyperCube.qDimensionInfo.length:0;me.qHyperCube.qDimensionInfo&&me.qHyperCube.qDimensionInfo.forEach(function(dim,col){me.headers.push(new QHeader(dim,col,me))}),me.qHyperCube.qMeasureInfo&&me.qHyperCube.qMeasureInfo.forEach(function(meas,col){me.headers.push(new QHeader(meas,col+dimcnt,me))}),me.qHyperCube.qGrandTotalRow&&me.qHyperCube.qGrandTotalRow.forEach(function(total,col){me.totals.push(new QMeasureCell(total,me.qHyperCube.qMeasureInfo[col]))}),addDataRows(me,me.qHyperCube.qDataPages)}me.OnData.emit()}}function addDataRows(me,pages){pages&&pages.forEach(function(page){page.qMatrix.forEach(function(row){me.rows.push(new QRow(row,me.qHyperCube,me))})})}return QHeader.prototype.orderBy=function(){var sortOrder=[this.col];this.parent.qHyperCube.qEffectiveInterColumnSortOrder.forEach(function(val){val!==sortOrder[0]&&sortOrder.push(val)});var patches=[{qPath:"/"+this.parent.defPath+"/qInterColumnSortOrder",qOp:"replace",qValue:"["+sortOrder.join(",")+"]"}];this.parent.model.applyPatches(patches,!0)},QHeader.prototype.reverseOrder=function(){var isDimension=this.col<this.parent.qHyperCube.qDimensionInfo.length,patches=[{qPath:"/"+this.parent.defPath+(isDimension?"/qDimensions/"+this.col:"/qMeasures/"+(this.col-this.parent.qHyperCube.qDimensionInfo.length))+"/qDef/qReverseSort",qOp:"replace",qValue:(!this.qReverseSort).toString()}];this.parent.model.applyPatches(patches,!0)},QHeader.prototype.isSelected=function(qElemNumber){return this.selections.indexOf(qElemNumber)>-1},QHeader.prototype.toggleSelect=function(qElemNumber){var pos=this.selections.indexOf(qElemNumber);0>pos?this.selections.push(qElemNumber):this.selections.splice(pos,1)},QDimensionCell.prototype.select=function(){this.parent.view&&this.parent.view.selectValues?this.parent.view.selectValues(this.col,[this.qElemNumber],!0):this.header.field.select([this.qElemNumber],!0),this.header.toggleSelect(this.qElemNumber)},QMeasureCell.prototype.getPercentOfMax=function(){return Math.round(100*this.qNum/this.qMeasureInfo.qMax*100)/100},QMeasureCell.prototype.getPercent=function(){return Math.round(100*this.qNum/this.qGrandTotal.qNum*100)/100},QTable.prototype.getMoreData=function(){if(!(this.requestActive||this.rowCount<=this.rows.length)){this.requestActive=!0;var me=this,requestPage={qTop:this.rows.length,qLeft:0,qWidth:this.colCount,qHeight:50};me.view?me.view.backendApi.getData([requestPage]).then(function(pages){addDataRows(me,pages),me.requestActive=!1,me.OnData.emit()}):me.model.getData([requestPage]).then(function(pages){addDataRows(me,pages),me.requestActive=!1,me.OnData.emit()})}},QTable.prototype.getColByName=function(fld){if(fld){var result,strUpper=fld.toUpperCase();return this.headers&&this.headers.forEach(function(head,col){head.qFallbackTitle.toUpperCase()===strUpper&&(result=col)}),result}},QTable.prototype.exportData=function(options,callback){options=options||{},this.model.exportData(options.format||"OOXML","/"+this.defPath,options.filename,options.state||"P").then(function(reply){var link="../.."+reply.result.qUrl;options.download&&window.open(link),callback&&callback(link)})},QTable}),define("apis/qutil",["qvangular","core.utils/deferred"],function(qvangular,Deferred){function createVisualizationHtml(options,appId){var html="";return options&&options.noInteraction&&(html='<div style="width:100%;height:100%;position:relative">'),html+=options&&options.currentSelections?'<qv-stage-current-selections class="qvt-selections" app-name="'+appId+'"></qv-stage-current-selections><div id="qv-global-search-container"></div>':'<qv-object model="model" options="options"></qv-object>',options&&options.noInteraction&&(html+='<div style="position:absolute;top:0;left:0;width:100%;height:100%;overflow: hidden;"></div>',html+="</div>"),html}function appDoIt(app,method,params){var dfd=new Deferred;return qvangular.$apply(qvangular.$rootScope,function(){app.rpc(method,null,params).then(function(){dfd.resolve()})}),dfd.promise}function setDefaultId(param){backendId++,param.qInfo=param.qInfo||{},param.qInfo.qType=param.qInfo.qType||"mashup",param.qInfo.qId=param.qInfo.qId||"MU"+backendId}function getDefaultListParam(type){backendId++;var param={qInfo:{qType:type,qId:"MU"+backendId}};return"BookmarkList"===type?param.qBookmarkListDef={qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description"}}:"SnapshotList"===type?param.qBookmarkListDef={qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}:"CurrentSelections"===type?param.qSelectionObjectDef={}:"DimensionList"===type?param.qDimensionListDef={qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}:"MeasureList"===type?param.qMeasureListDef={qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}:"sheet"===type?param.qAppObjectListDef={qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}:"masterobject"===type?param.qAppObjectListDef={qType:"masterobject",qData:{name:"/metadata/name",visualization:"/visualization",tags:"/metadata/tags"}}:"VariableList"===type?param.qVariableListDef={qType:"variable",qData:{tags:"/tags"}}:"story"===type?param.qAppObjectListDef={qType:"story",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",rank:"/rank"}}:param["q"+type+"Def"]={},param}function createHypercubeDef(dimensions,measures,options){var def={};if(dimensions){var dims=[];dimensions.forEach(function(dim){"string"==typeof dim?dims.push({qDef:{qFieldDefs:[dim]}}):dims.push(dim)}),def.qDimensions=dims}if(measures){var meas=[];measures.forEach(function(m){"string"==typeof m?meas.push({qDef:{qDef:m}}):meas.push(m)}),def.qMeasures=meas}return def.qInitialDataFetch=[{qTop:0,qLeft:0,qHeight:20,qWidth:(def.qDimensions?def.qDimensions.length:0)+(def.qMeasures?def.qMeasures.length:0)}],options&&options.rows&&(def.qInitialDataFetch[0].qHeight=options.rows),def}var backendId=0;return{createVisualizationHtml:createVisualizationHtml,appDoIt:appDoIt,setDefaultId:setDefaultId,getDefaultListParam:getDefaultListParam,createHypercubeDef:createHypercubeDef}}),define("apis/qapp",["jquery","qvangular","core.utils/deferred","core.models/session-object","core.models/generic-object","client.models/current-selections","objects.models/visualization-object","client.models/snapshot","objects.backend-api/snapshot-api","apis/qfield","apis/qbookmark","apis/qvariable","apis/qglobal","apis/qtable","apis/qutil"],function($,qvangular,Deferred,SessionObject,GenericObject,CurrentSelectionsModel,VisualizationObject,SnapshotModel,SnapshotAPI,QField,QBookmark,QVariable,QGlobal,QTable,QUtil){function showVisualization(element,vis,options,appId){var $element=$(element),$scope=qvangular.$rootScope.$new(),html=QUtil.createVisualizationHtml(options,appId);$element.html(html),$scope.model=vis,$scope.options=options||{};var $compile=qvangular.getService("$compile");return $compile($element.contents())($scope),qvangular.$apply($scope),$scope}function QApp(app){this.fieldCache={},Object.defineProperties(this,{id:{value:app.id},model:{value:app},global:{value:new QGlobal(app.session)},bookmark:{value:new QBookmark(app)},variable:{value:new QVariable(app,this)}})}var errorCallback;return QApp.prototype.clearAll=function(lockedAlso,state){return QUtil.appDoIt(this.model,"ClearAll",[lockedAlso||!1,state||"$"])},QApp.prototype.back=function(){return QUtil.appDoIt(this.model,"Back")},QApp.prototype.forward=function(){return QUtil.appDoIt(this.model,"Forward")},QApp.prototype.lockAll=function(state){return QUtil.appDoIt(this.model,"LockAll",[state||"$"])},QApp.prototype.unlockAll=function(state){return QUtil.appDoIt(this.model,"UnlockAll",[state||"$"])},QApp.prototype.getObject=function(element,id,options){var dfd,scope,app=this.model;if(id?"string"==typeof element&&(element=document.getElementById(element)):(id=element,element=void 0),dfd=new Deferred,"CurrentSelections"===id){if(element){var opt=options||{};opt.currentSelections=!0,scope=showVisualization(element,null,opt,this.id)}CurrentSelectionsModel.get(app).then(function(model){model.close=function(){scope&&scope.$destroy()},dfd.resolve(model)})}else qvangular.$apply(qvangular.$rootScope,function(){VisualizationObject.get(id,app).then(function(model){element&&(scope=showVisualization(element,model,options)),model.getLayout().then(function(){model.close=function(){scope&&scope.$destroy()},dfd.resolve(model)})},function(err){errorCallback&&(errorCallback(err.error),err.isHandled=!0),dfd.reject(err.error)})});return dfd.promise},QApp.prototype.getSnapshot=function(element,id){var dfd=new Deferred;return id||(id=element,element=void 0),SnapshotModel.Snapshot.get(id,this.model).then(function(model){element&&("string"==typeof element&&(element=document.getElementById(element)),showVisualization(element,model,{APIType:SnapshotAPI,noInteraction:!0})),model.getLayout().then(function(){dfd.resolve(model)},function(err){dfd.reject(err.error)})},function(err){dfd.reject(err.error)}),dfd.promise},QApp.prototype.getObjectProperties=function(id){return GenericObject.getProperties(id,this.model)},QApp.prototype.getFullPropertyTree=function(id){return GenericObject.get(id,this.model).then(function(obj){return obj.getFullPropertyTree().then(function(){return obj})})},QApp.prototype.createGenericObject=function(param,callback){var wrapper=this,okFunc=callback?function(data){callback(data,wrapper)}:function(){};QUtil.setDefaultId(param);var objectPromise=SessionObject.get(param,this.model);return qvangular.$apply(qvangular.$rootScope,function(){objectPromise.then(function(list){list.getLayout().then(okFunc),list.Invalidated.bind(function(){list.getLayout().then(okFunc)}),list.Aborted.bind(function(){list.getLayout().then(okFunc)})},function(err){errorCallback&&(errorCallback(err.error,wrapper),err.isHandled=!0)})}),objectPromise},QApp.prototype.destroySessionObject=function(id){return this.model.rpc("DestroySessionObject",null,[id])},QApp.prototype.createCube=function(def,callback){return this.createGenericObject({qHyperCubeDef:def},callback)},QApp.prototype.createList=function(def,callback){return this.createGenericObject({qListObjectDef:def},callback)},QApp.prototype.getList=function(type,callback){return this.createGenericObject(QUtil.getDefaultListParam(type),callback)},QApp.prototype.getAppObjectList=function(type,callback){return callback||(callback=type,type="sheet"),this.getList(type,callback)},QApp.prototype.searchSuggest=function(qTerms,qOptions,callback){var promise=this.model.rpc("SearchSuggest",null,[qOptions,qTerms]);return callback&&promise.then(function(reply){callback(reply)}),promise},QApp.prototype.searchAssociations=function(qTerms,qPage,qOptions,callback){var promise=this.model.rpc("SearchAssociations",null,[qOptions||{},qTerms,qPage]);return callback&&promise.then(function(reply){callback(reply)}),promise},QApp.prototype.selectAssociations=function(qMatchIx,qTerms,qOptions,qSoftLock){return this.model.rpc("SelectAssociations",null,[qOptions||{},qTerms,qMatchIx,qSoftLock||!1])},QApp.prototype.getAppLayout=function(callback){var me=this,okFunc=callback?function(data){callback(data,me)}:function(){},promise=me.model.getLayout();return me.model.Invalidated.bind(function(){me.model.getLayout().then(okFunc)}),me.model.Aborted.bind(function(){me.model.getLayout().then(okFunc)}),promise.then(okFunc),promise},QApp.prototype.addAlternateState=function(qStateName){return this.model.rpc("AddAlternateState",null,[qStateName])},QApp.prototype.removeAlternateState=function(qStateName){return this.model.rpc("RemoveAlternateState",null,[qStateName])},QApp.prototype.doReload=function(qMode,qPartial,qDebug){return this.fieldCache={},this.model.rpc("DoReload",null,[qMode||0,qPartial||!1,qDebug||!1])},QApp.prototype.doSave=function(qFileName){return this.model.rpc("DoSave",null,[qFileName])},QApp.prototype.field=function(fld,statename){var cacheId=statename?fld+"/"+statename:fld;return this.fieldCache[cacheId]||(this.fieldCache[cacheId]=new QField(this,fld,statename)),this.fieldCache[cacheId]},QApp.prototype.table=function(ext,path){return new QTable(this,ext,path)},QApp.setErrorCallback=function(callback){errorCallback=callback},QApp.prototype.createTable=function(dimensions,measures,options){var def=QUtil.createHypercubeDef(dimensions,measures,options);return new QTable(this,this.createGenericObject({qHyperCubeDef:def}))},QApp}),define("client.utils/state",["core.utils/notification","general.controllers/route-controller"],function(Notification,RouteController){"use strict";var currentView,currentState,currentModel,currentSlide,previousState,previousView,State={};return State.States={analysis:0,edit:1,snapshot:2,play:3,editstory:4,editwidget:5},State.Views={overview:0,sheet:1,story:2,object:3,masterObject:4,widgetEditor:5,dataSpace:6},Notification.mixin(State),State.notification("StateChanged"),State.notification("SheetChanged"),State.notification("StoryChanged"),State.setState=function(state){state!==currentState&&(previousState=currentState,currentState=state,State.StateChanged.emit(currentView,currentState,previousView,previousState),currentView===State.Views.sheet||currentView===State.Views.object||currentView===State.Views.masterObject?RouteController.setUrl(RouteController.buildUrl("sheet",currentModel.layout.qInfo.qId,"state",Object.keys(State.States)[state])):currentView===State.Views.story&&RouteController.setUrl(RouteController.buildUrl("story",currentModel.layout.qInfo.qId,"state",Object.keys(State.States)[state],"slide",currentSlide)))},State.setView=function(view){view!==currentView&&(previousView=currentView,currentView=view,view===State.Views.overview&&(currentModel=null),State.StateChanged.emit(currentView,currentState,previousView,previousState))},State.setSheet=function(sheet,state){var changedState=!1;sheet!==currentModel&&(currentModel=sheet,previousView=currentView,currentView=State.Views.sheet,State.SheetChanged.emit(sheet),changedState=!0),State.States[state]!==currentState&&(previousState=currentState,currentState=State.States[state]||State.States.analysis,changedState=!0),changedState&&State.StateChanged.emit(currentView,currentState,previousView,previousState)},State.setStory=function(story,state,slideId){var changedState=!1;story!==currentModel&&(currentModel=story,previousView=currentView,currentView=State.Views.story,State.StoryChanged.emit(story),changedState=!0),currentSlide=slideId,State.States[state]!==currentState&&(previousState=currentState,currentState=State.States[state]||State.States.editstory,changedState=!0),changedState&&State.StateChanged.emit(currentView,currentState,previousView,previousState)},State.isInAnalysisMode=function(){return currentState===State.States.analysis},State.isInEditMode=function(){return currentState===State.States.edit},State.isInSnapshotMode=function(){return currentState===State.States.snapshot},State.inStoryPlayState=function(){return State.inStorytelling()&&currentState===State.States.play},State.inStorytelling=function(){return currentView===State.Views.story},State.inAppOverView=function(){return currentView===State.Views.overview},State.inDataSpace=function(){return currentView===State.Views.dataSpace},State.inSheetView=function(){return currentView===State.Views.sheet},State.inObjectView=function(){return currentView===State.Views.object},State.inMasterObjectView=function(){return currentView===State.Views.masterObject},State.isInWidgetEditMode=function(){return currentState===State.States.editwidget},State.getModel=function(){return State.model},Object.defineProperties(State,{state:{get:function(){return currentState}},view:{get:function(){return currentView}},model:{get:function(){return currentModel},set:function(model){currentModel=model}}}),State}),define("client.utils/routing",["general.controllers/route-controller","util"],function(RouteController,Util){"use strict";var Routing={getUrlForSheet:function(id,state,absolute){var defaults=["sheet",id,"state",state];return absolute&&defaults.splice(0,0,!0,"sense","app",Util.getParameterByName("app")),RouteController.buildUrl.apply(RouteController,defaults)},goToOverview:function(){RouteController.setUrl(RouteController.buildUrl())},goToDataSpace:function(){
RouteController.setUrl(RouteController.buildUrl("data"))},goToSheet:function(id,state){RouteController.setUrl(Routing.getUrlForSheet(id,state,!1))},goToStory:function(id,state,slideId){var parts=["story",id,"state",state];slideId&&parts.push("slide",slideId),RouteController.setUrl(RouteController.buildUrl.apply(RouteController,parts))}};return Routing}),define("apis/qnavigation",["qvangular","client.utils/state","client.utils/routing"],function(qvangular,State,Routing){function getSheets(target){var service=qvangular.getService("$navigationService");target.sheets=service.Sheets.all.mashed,target.stories=service.Stories.all.mashed}function getCurrentSheetPos(sheets){var sheetId=State.model.id,pos=-1;return sheets.forEach(function(sheet,index){sheet.qInfo.qId===sheetId&&(pos=index)}),pos}function getSheetForId(sheetId,sheets){var sheet;return sheets.forEach(function(s){s.qInfo.qId===sheetId&&(sheet=s)}),sheet}function getStoryForId(storyId,stories){var story;return stories.forEach(function(s){s.qInfo.qId===storyId&&(story=s)}),story}function goSheet(sheetId){return Routing.goToSheet(sheetId,Object.keys(State.States)[State.state]),{success:!0,sheetId:sheetId}}function goStory(storyId){return Routing.goToStory(storyId,Object.keys(State.States)[State.States.play]),{success:!0,storyId:storyId}}function QNavigation(inClient,sheets,stories){this.inClient=inClient,sheets?(this.sheets=sheets,this.stories=stories):inClient?getSheets(this):(this.sheets=[],this.stories=[]),Object.defineProperties(this,{ANALYSIS:{get:function(){return"analysis"}},EDIT:{get:function(){return"edit"}},SNAPSHOT:{get:function(){return"snapshot"}}})}return QNavigation.prototype.gotoSheet=function(sheetId){var model=getSheetForId(sheetId,this.sheets);return model?goSheet(sheetId):{success:!1,error:"NOSUCHSHEET",errorMsg:"No such sheet"}},QNavigation.prototype.nextSheet=function(){if(State.view===State.Views.sheet&&State.model){var pos=getCurrentSheetPos(this.sheets)+1,newid=this.sheets[pos===this.sheets.length?0:pos].qInfo.qId;return goSheet(newid)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},QNavigation.prototype.prevSheet=function(){if(State.view===State.Views.sheet&&State.model){var pos=getCurrentSheetPos(this.sheets)-1,newid=this.sheets[0>pos?this.sheets.length-1:pos].qInfo.qId;return goSheet(newid)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},QNavigation.prototype.getCurrentSheetId=function(){return State.view===State.Views.sheet&&State.model?{success:!0,sheetId:State.model.id}:{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},QNavigation.prototype.getMode=function(){return Object.keys(State.States)[State.state]},QNavigation.prototype.setMode=function(mode){return this.isModeAllowed(mode)?(State.setState(State.States[mode]),{success:!0,mode:mode}):{success:!1,error:"MODENOTALLOWED",errorMsg:"Mode not allowed"}},QNavigation.prototype.isModeAllowed=function(mode){switch(mode){case this.ANALYSIS:return!0;case this.EDIT:return this.inClient&&State.model.layout&&State.model.layout.permissions&&State.model.layout.permissions.update;case this.SNAPSHOT:return this.inClient}return!1},QNavigation.prototype.gotoStory=function(storyId){var model=getStoryForId(storyId,this.stories);return model?goStory(storyId):{success:!1,error:"NOSUCHSTORY",errorMsg:"No such story"}},QNavigation}),define("apis/qsession",["qvangular","core.utils/deferred","client.models/rpc-session","autogenerated/qix/engine-enums","core.utils/authentication"],function(qvangular,Deferred,RPCSession,enums,Authentication){function setupSocketErrorHandling(onError,onWarning){RPCSession.useTimeoutOnClose=!0,RPCSession.createSocket=function(url){var ws;try{ws=new WebSocket(url)}catch(err){onError(err)}return ws},RPCSession.hookIntoDeferred=function(dfd){dfd.promise.then(null,function(err){return qvangular.getService("$timeout")(function(){err&&(err.isHandled||err.error.isHandled||!err.error||err.error.code===Errors.LOCERR_GENERIC_ABORTED||err.error.code===Errors.LOCERR_APP_NOT_FOUND||onError(err.error))},1e3),Deferred.reject(err)})},RPCSession.NewSessionCreated.observers.forEach(function(obs){RPCSession.NewSessionCreated.unbind(obs)}),RPCSession.NewSessionCreated.bind(function(session){session.Notification.bind(function(reply){"OnAuthenticationInformation"===reply.method&&Authentication.parse(reply.params),reply.error?onError(reply.error):reply.params&&"fatal"===reply.params.severity?onError({message:reply.params.message,method:reply.method}):onWarning&&onWarning(reply)}),onWarning&&session.Warning.bind(onWarning)})}var Errors=enums.NxLocalizedErrorCode;return{setupSocketErrorHandling:setupSocketErrorHandling}}),define("general.services/content-api/content-api",["qvangular","core.utils/deferred","translator","xsrfplugin","require"],function(qvangular,Deferred,translator,xsrfPlugin,require){qvangular.service("$contentApi",["$http",function($http){function ensureHeaders(config){config.headers||(config.headers={})}function ensureParams(config){config.params||(config.params={})}function setXsrf(config){var xsrfKey=xsrfPlugin.getRandomString(16);return config.headers["X-Qlik-XrfKey"]=xsrfKey,config.params.xrfkey=xsrfKey,config}function setVirtualProxy(config){var basePath=require.toUrl(""),pos=basePath.indexOf("/resources");return pos>-1&&(basePath=basePath.substring(0,pos)),config.url=basePath+config.url,config}function setAcceptLanguage(config){var lang=translator.language;return lang&&(config.headers["Accept-Language"]="pseudo"!==lang?lang:"qps-ploc"),config}function request(config){return ensureHeaders(config),ensureParams(config),qvangular.$rootScope.isPersonalMode||setXsrf(config),setVirtualProxy(config),setAcceptLanguage(config),$http(config)}function getExtensions(){var dfd=new Deferred,config={method:"GET",url:"/qrs/extension/schema"};return request(config).then(function(response){var data=response.data;dfd.resolve(data)})["catch"](function(response){var data=response.data;dfd.reject(data)}),dfd.promise}return{getExtensions:getExtensions,request:request}}])}),define("general.models/library/extension-list",["core.utils/deferred","qvangular","general.services/content-api/content-api"],function(Deferred,qvangular){"use strict";var ExtensionList={},dfd=null;return ExtensionList.getList=function(){return null===dfd&&(dfd=new Deferred,qvangular.getService("$contentApi").getExtensions().then(function(result){var arr=[];for(var property in result)result.hasOwnProperty(property)&&arr.push({id:property,data:result[property]});dfd.resolve(arr)},function(){var arr=[];dfd.resolve(arr)})),dfd.promise},ExtensionList}),define("general.utils/visualizations",[],function(){function getType(name){return types[name]}function registerType(name,impl){types[name]=impl}var types={};return{getType:getType,getRegisteredNames:function(){return Object.keys(types)},getLibraryInfo:function(type){return types[type]?types[type].getLibraryInfo():null},getTemplateIconClassName:function(type){return types[type]?types[type].getTemplateIconClassName():null},getIconChar:function(type){return types[type]?types[type].getIconChar():null},registerType:registerType}}),define("objects.utils/layout",[],function(){"use strict";function getLayoutMode(width,height){var i;for(i=0;layoutModeCnt>i;++i)if(width>=layoutModeSizes[i][0]&&height>=layoutModeSizes[i][1])return layoutModeSizes[i][2];return LayoutMode.SPARK}function getVerticalLayoutMode(height){var i;for(i=0;layoutModeCnt>i;++i)if(height>=verticalLayoutModeSizes[i][0])return verticalLayoutModeSizes[i][1];return LayoutMode.SPARK}function getHorizontalLayoutMode(width){var i;for(i=0;layoutModeCnt>i;++i)if(width>=horizontalLayoutModeSizes[i][0])return horizontalLayoutModeSizes[i][1];return LayoutMode.SPARK}function getLayoutModeKey(layoutMode){var str=Object.keys(LayoutMode).filter(function(key){return LayoutMode[key]===layoutMode})[0];return str&&str.toLowerCase()||""}var LayoutMode={SPARK:1,XSMALL:3,SMALL:7,MEDIUM:15,FULL:31},layoutModeSizes=[[550,450,LayoutMode.FULL],[400,220,LayoutMode.MEDIUM],[300,150,LayoutMode.SMALL],[150,75,LayoutMode.XSMALL],[0,0,LayoutMode.SPARK]],verticalLayoutModeSizes=[[450,LayoutMode.FULL],[220,LayoutMode.MEDIUM],[150,LayoutMode.SMALL],[75,LayoutMode.XSMALL],[0,LayoutMode.SPARK]],horizontalLayoutModeSizes=[[550,LayoutMode.FULL],[400,LayoutMode.MEDIUM],[300,LayoutMode.SMALL],[150,LayoutMode.XSMALL],[0,LayoutMode.SPARK]],layoutModeCnt=layoutModeSizes.length;return{LayoutMode:LayoutMode,getLayoutMode:getLayoutMode,getLayoutModeKey:getLayoutModeKey,getHorizontalLayoutMode:getHorizontalLayoutMode,getVerticalLayoutMode:getVerticalLayoutMode}}),define("general.utils/property-resolver",[],function(){function isHierarchical(definition){return"object"==typeof definition.items&&"array"!==definition.type&&("items"===definition.type||"items"===definition.component||"expandable-items"===definition.component||"accordion"===definition.component||!definition.type&&!definition.component)}function setValue(data,reference,value){var i,steps=reference.split("."),dataContainer=data,dataName=steps[steps.length-1];for(i=0;i<steps.length-1;++i)"undefined"==typeof dataContainer[steps[i]]&&(dataContainer[steps[i]]=isNaN(steps[i+1])?{}:[]),dataContainer=dataContainer[steps[i]];"undefined"!=typeof value?dataContainer[dataName]=value:delete dataContainer[dataName]}function getValue(data,reference,defaultValue){var i,steps=reference.split("."),dataContainer=data;for(i=0;i<steps.length;++i){if("undefined"==typeof dataContainer[steps[i]])return defaultValue;dataContainer=dataContainer[steps[i]]}return dataContainer}function getTypeValue(type,value,defaultValue){if("string"!=typeof value)return value;switch(type){case"integer":value=parseInt(value,10),isNaN(value)&&(value=defaultValue);break;case"number":value=parseFloat(value),isNaN(value)&&(value=defaultValue);break;case"boolean":value="true"===value}return value}function getDefaultValue(type,definition){if("function"==typeof definition.defaultValue)return definition.defaultValue();if("undefined"!=typeof definition.defaultValue)return definition.defaultValue;if(Array.isArray(definition.options))return definition.options[0].value;switch(type){case"array":return[];case"string":return"";case"integer":return 0;case"number":return 0;case"boolean":return!1;default:return null}}function getDefaults(rootDefinition){function findDefaults(definition){var keys,item,i;if(!definition.schemaIgnore)if(isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;i++)item=definition.items[keys[i]],item&&findDefaults(item);else definition.ref&&!definition.schemaIgnore&&setValue(defaults,definition.ref,getDefaultValue(definition.type,definition))}var defaults={};return"array"===rootDefinition.type&&rootDefinition.items?(defaults={},findDefaults({type:"items",items:rootDefinition.items})):findDefaults(rootDefinition),defaults}var resolveFunctions={};return resolveFunctions.invertedBoolean={get:function(getFn){return!getFn("boolean")},set:function(value,setFn){setFn("boolean",!value)}},resolveFunctions.booleanToSortInteger={get:function(getFn){return!!getFn("integer")},set:function(value,setFn,definition){var intValue;value?(intValue=definition.defaultSort?definition.defaultSort:1,setFn("integer",intValue)):setFn("integer",0)}},resolveFunctions.enumToSortInteger={get:function(getFn){switch(getFn("integer")){case-1:return"descending";case 1:return"ascending";default:return"disabled"}},set:function(value,setFn){switch(value){case"descending":setFn("integer",-1);break;case"ascending":setFn("integer",1);break;default:setFn("integer",void 0)}}},{getValue:getValue,setValue:setValue,getTypeValue:getTypeValue,getDefaultValue:getDefaultValue,getDefaults:getDefaults,resolveFunctions:resolveFunctions,isHierarchical:isHierarchical}}),define("client.property-panel/default-sorting-properties",["general.utils/property-resolver"],function(propertyResolver){var sortEnumerationOptions=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return{type:"array",component:"sorting",translation:"properties.sorting",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",allowMove:!0,schemaIgnore:!0,items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(itemData,handler){return itemData.qDef.autoSort?handler.autoSortDimension(itemData).then(function(){}):void 0}},dimension:{component:"sorting-dimension",type:"items",ref:"",items:{dimensionDefinition:{type:"items",grouped:!0,items:{expression:{type:"items",items:{expressionToggled:{type:"boolean",ref:"qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",expressionType:"ValueExpr",ref:"qExpression",translation:"Common.Expression",defaultValue:"",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qSortByExpression",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByExpression",0)}}}},frequency:{type:"items",show:!1,items:{frequencyToggled:{type:"boolean",ref:"qSortByFrequency",translation:"properties.sorting.sortByFrequency",resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qSortByFrequency",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByFrequency",0)}}}},numeric:{type:"items",items:{numericToggled:{type:"boolean",ref:"qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortByNumeric",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByNumeric",0)}}}},ascii:{type:"items",items:{asciiToggled:{type:"boolean",ref:"qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortByAscii",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(itemData){return!(itemData.qSortByAscii||itemData.qSortByNumeric||itemData.qSortByExpression||itemData.qSortByFrequency)}}}}}}}},measures:{type:"items",component:"expandable-items",grouped:!0,ref:"qHyperCubeDef.qMeasures",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(itemData,handler){return itemData.qDef.autoSort?handler.autoSortMeasure(itemData).then(function(){}):void 0}},numeric:{type:"items",show:function(itemData){return!itemData.qDef.autoSort},items:{numericToggled:{type:"boolean",ref:"qSortBy.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByNumeric",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortBy.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(itemData){return!itemData.qDef.autoSort},items:{asciiToggled:{type:"boolean",ref:"qSortBy.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByAscii",options:sortEnumerationOptions,resolveFunctions:"enumToSortInteger",show:function(itemData){return 0!==propertyResolver.getValue(itemData,"qSortBy.qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(itemData){var sortings;return itemData.qDef.autoSort?!1:(sortings=propertyResolver.getValue(itemData,"qSortBy",{}),sortings.qSortByAscii||sortings.qSortByNumeric||sortings.qSortByFrequency?!1:!0)}}}}}}}),define("general.utils/number-formatting",["util"],function(util){function getnDecPattern(type,nDec,decimalSep,thousandSep,localeInfo){void 0===decimalSep&&(decimalSep=localeInfo.qDecimalSep),void 0===thousandSep&&(thousandSep=localeInfo.qThousandSep);var start,end,i,n,fmt="";if("F"===type)if(0===nDec)fmt="#"+thousandSep+"##0";else for(fmt="#"+thousandSep+"##0"+decimalSep,i=0;nDec>i;++i)fmt+="0";else{for(i=0;nDec>i;++i)fmt+="#";nDec>3&&(n=fmt.length,start=fmt.substring(0,n-3),end=fmt.substr(n-3),fmt=start+thousandSep+end)}return fmt}var UNDEF;return{setNumFmtPattern:function(ref,numFormat,localeInfo){var separators,attr={type:numFormat.qType||"U",nDec:"qType"===ref?("F"===numFormat.qType,2):"R"===numFormat.qType?numFormat.qnDec||10:"number"==typeof numFormat.qnDec?Math.max(0,numFormat.qnDec):2,thousandSep:numFormat.qThou,decimalSep:numFormat.qDec};separators=this._getSeparators(ref,"M"===numFormat.qType,attr.decimalSep,attr.thousandSep,localeInfo),separators.decimal!==UNDEF&&(attr.decimalSep=separators.decimal),separators.thousand!==UNDEF&&(attr.thousandSep=separators.thousand),numFormat.qType=attr.type,numFormat.qnDec=attr.nDec,numFormat.qDec=attr.decimalSep,numFormat.qThou=attr.thousandSep,numFormat.qFmt=this._getPattern(attr.type,attr.nDec,attr.decimalSep,attr.thousandSep,localeInfo),["D","T","TS","IV"].indexOf(attr.type)>=0&&(numFormat.qDec="",numFormat.qThou="")},_getSeparators:function(ref,isMoney,decimalSep,thousandSep,localeInfo){var dec=decimalSep,thou=thousandSep,sepType="q"+(isMoney?"Money":"");return"qType"===ref?(thou=localeInfo[sepType+"ThousandSep"]||"",dec=localeInfo[sepType+"DecimalSep"]||"."):"qThou"===ref&&void 0===thousandSep?(thou=localeInfo[sepType+"ThousandSep"]||"",dec=decimalSep||"."):"qDec"!==ref||void 0!==decimalSep&&""!==decimalSep||(dec=localeInfo[sepType+"DecimalSep"]||".",thou=thousandSep||""),{decimal:dec||".",thousand:thou||""}},_getPattern:function(type,nDec,decimalSep,thousandSep,localeInfo){var f;switch(type){case"U":return"";case"I":return"#"+thousandSep+"##0";case"R":case"F":return this.getNDecPattern("F",nDec,decimalSep,thousandSep,localeInfo);case"M":return f=localeInfo.qMoneyFmt,localeInfo.qMoneyDecimalSep&&(f=f.replace(new RegExp(util.escapeRegExp(localeInfo.qMoneyDecimalSep),"g"),decimalSep)),localeInfo.qMoneyThousandSep&&(f=f.replace(new RegExp(util.escapeRegExp(localeInfo.qMoneyThousandSep),"g"),thousandSep)),f;case"D":return localeInfo.qDateFmt;case"T":return localeInfo.qTimeFmt;case"TS":return localeInfo.qTimestampFmt;case"IV":return"h:mm:ss";default:return""}},getDefaultNumericFormat:function(fmt,localeInfo){return getnDecPattern("F",2,fmt.qDec,fmt.qThou||"",localeInfo)},getNDecPattern:getnDecPattern,getNormalizedFormat:function(numFormatObject,pattern){var temp=numFormatObject.qDec+numFormatObject.qThou;return/\u00a0/.test(temp)&&!/\u0020/.test(temp)?pattern.replace(/\u0020/g,""):pattern}}}),define("core.utils/theme",["util","core.utils/notification","general.utils/property-resolver","text!themes/sense/theme.json","require"],function(Util,Notification,PropertyResolver,jsonTheme,require){"use strict";function injectStyleNode(themeName){var style=document.createElement("link");return style.setAttribute("rel","stylesheet"),style.setAttribute("href",require.toUrl("themes/"+themeName+"/theme.css")),document.head.appendChild(style),style}function injectJSONStyles(jsonTheme,applyExclusions){jsonTheme=JSON.parse(jsonTheme),Util.extend(!0,themeAPI,defaults,jsonTheme),applyExclusions&&extendExclusions.forEach(function(element){var prop=PropertyResolver.getValue(jsonTheme,element);void 0!==prop&&PropertyResolver.setValue(themeAPI,element,prop)}),currentThemeJSON=jsonTheme}function apply(themeName){var style=injectStyleNode(themeName);return require(["text!themes/"+themeName+"/theme.json"],function(jsonTheme){injectJSONStyles(jsonTheme,!0),themeAPI.ThemeChanged.emit()}),style}function cleanCurrentTheme(){currentThemeNode.parentNode.removeChild(currentThemeNode),Object.keys(currentThemeJSON).forEach(function(key){delete themeAPI[key]})}var defaults=JSON.parse(jsonTheme),defaultTheme="sense",currentTheme=null,currentThemeNode=null,currentThemeJSON={},extendExclusions=["palette","colorSchemes.qualitativeScales","colorSchemes.ordinalScales"],themeAPI={};return Notification.create(themeAPI,"ThemeChanged"),Object.defineProperty(themeAPI,"name",{iterable:!1,get:function(){return currentTheme||defaultTheme}}),themeAPI.set=function(theme){theme.indexOf("/")>-1||theme!==currentTheme&&(currentTheme&&cleanCurrentTheme(),theme&&(currentThemeNode=apply(theme),currentTheme=theme))},injectStyleNode("sense"),injectJSONStyles(jsonTheme),themeAPI}),define("general.utils/string-limits",[],function(){"use strict";var exports={};return Object.defineProperties(exports,{name:{value:255,writable:!1},description:{value:512,writable:!1},expression:{value:8192,writable:!1},script:{value:5e4,writable:!1},textImage:{value:12e3,writable:!1}}),exports}),define("client.utils/property-hypercube-helper",["general.utils/property-resolver"],function(propertyResolver){var hcHelper={getDimensions:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qDimensions",[])},getNumDimensions:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qDimensions.length",0)},getMeasures:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qMeasures",[])},getNumMeasures:function(obj){return propertyResolver.getValue(obj,"qHyperCubeDef.qMeasures.length",0)},getDimensionLayouts:function(layout){return layout&&layout.qHyperCube?layout.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(cId,layout){return this.getDimensionLayouts(layout).filter(function(item){return cId===item.cId})[0]},getMeasureLayouts:function(layout){return layout&&layout.qHyperCube?layout.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(cId,layout){return this.getMeasureLayouts(layout).filter(function(item){return cId===item.cId})[0]}};return hcHelper}),define("client.utils/default-property-logic",["general.utils/property-resolver","client.utils/property-hypercube-helper"],function(propertyResolver,propHcHelper){function schemeIsReverse(data){return propertyResolver.getValue(data,"color.reverseScheme")!==!0}function expressionIsValue(data){return"byExpression"===propertyResolver.getValue(data,"color.mode")&&propertyResolver.getValue(data,"color.expressionIsColor")===!1}function expressionIsColor(data){return"byExpression"===propertyResolver.getValue(data,"color.mode")&&propertyResolver.getValue(data,"color.expressionIsColor")===!0}function showDimensionIdOption(data){var auto=propertyResolver.getValue(data,"color.auto"),mode=propertyResolver.getValue(data,"color.mode"),measures=propHcHelper.getNumMeasures(data),dims=propHcHelper.getNumDimensions(data);return dims>1&&1>=measures&&!auto&&"byDimension"===mode}function showCompressionResolution(layout){var dim=propHcHelper.getDimensionLayouts(layout)[0];return dim&&dim.qCardinal>compressionTreshold}function retriveLogic(chart,collection){var targetPatch=chartMap[chart]||defaultPatch;return targetPatch[collection]||defaultPatch[collection]}var compressionTreshold=1e3,defaultPatch={showLegend:function(data){var auto=propertyResolver.getValue(data,"color.auto"),mode=propertyResolver.getValue(data,"color.mode"),expressionIsColor=propertyResolver.getValue(data,"color.expressionIsColor"),numDim=propHcHelper.getNumDimensions(data),numMea=propHcHelper.getNumMeasures(data);return auto&&(numDim>1||numMea>1)||!auto&&"primary"!==mode&&("byExpression"!==mode||!expressionIsColor)},colorModeOptions:{primary:function(){return!0},dimension:function(data){return propHcHelper.getNumMeasures(data)<=1},multiColor:function(data){return propHcHelper.getNumMeasures(data)>1},measure:function(data){return 1===propHcHelper.getNumMeasures(data)},expression:function(data){return propHcHelper.getNumMeasures(data)>=1}},persistentColorsShow:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byDimension"===propertyResolver.getValue(data,"color.mode")&&propHcHelper.getNumMeasures(data)<=1},expressionLabelChange:function(itemData){var colorAttribs=propertyResolver.getValue(itemData,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),colorProps=propertyResolver.getValue(itemData,"color");colorAttribs&&(colorAttribs.label=propertyResolver.getValue(itemData,"color.expressionLabel"),colorProps&&(colorProps.colorExpression=colorAttribs.qExpression))},attributeExpressionChange:function(itemData){var colorAttribs=propertyResolver.getValue(itemData,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),colorProps=propertyResolver.getValue(itemData,"color");colorAttribs&&(colorAttribs.type="colorByExpression",colorProps&&(colorProps.colorExpression=colorAttribs.qExpression))},attributeExpressionGlobalChange:function(data){var i,index,currentAttribs,measures=propertyResolver.getValue(data,"qHyperCubeDef.qMeasures",[]),disabledMeasures=propertyResolver.getValue(data,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),colorByAttrib=null,elTypeFunc=function(element,j){"colorByExpression"===element.type&&(index=j)};if(measures.length+disabledMeasures.length>1){for(i=disabledMeasures.length-1;i>=0;--i)currentAttribs=disabledMeasures[i].qAttributeExpressions||[],index=-1,currentAttribs.every(elTypeFunc),index>=0&&(colorByAttrib=currentAttribs.splice(index,1)[0]);for(i=measures.length-1;i>=0;--i)currentAttribs=measures[i].qAttributeExpressions||[],index=-1,currentAttribs.every(elTypeFunc),index>=0&&(colorByAttrib=currentAttribs.splice(index,1)[0]);!measures[0].qAttributeExpressions&&colorByAttrib&&(measures[0].qAttributeExpressions=[]),colorByAttrib&&measures[0].qAttributeExpressions.splice(0,0,colorByAttrib)}var exps=propertyResolver.getValue(data,"color.colorExpression");1!==measures.length||measures[0].qAttributeExpressions&&0!==measures[0].qAttributeExpressions.length||!exps||(measures[0].qAttributeExpressions=[{qExpression:exps,type:"colorByExpression"}])}},pieChartPatch={showLegend:function(data){var auto=propertyResolver.getValue(data,"color.auto"),expressionIsColor=propertyResolver.getValue(data,"color.expressionIsColor"),mode=propertyResolver.getValue(data,"color.mode");return!(!auto&&"primary"===mode||!auto&&"byExpression"===mode&&(expressionIsColor||void 0===expressionIsColor))}},scatterPlotPatch={colorModeOptions:{primary:function(){return!0},dimension:function(){return!0},multiColor:function(){return!1},measure:function(){return!1},expression:function(data){return propHcHelper.getNumMeasures(data)>=1}},showLegend:function(data){return"primary"!==propertyResolver.getValue(data,"color.mode")&&!propertyResolver.getValue(data,"color.auto")},persistentColorsShow:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byDimension"===propertyResolver.getValue(data,"color.mode")}},lineChartPatch={colorModeOptions:{primary:function(){return!0},dimension:function(data){return propHcHelper.getNumDimensions(data)>1},multiColor:function(data){return propHcHelper.getNumMeasures(data)>1},measure:function(data){return 1===propHcHelper.getNumMeasures(data)&&propHcHelper.getNumDimensions(data)<=1},expression:function(data){return propHcHelper.getNumMeasures(data)>=1}}},chartMap={scatterplot:scatterPlotPatch,piechart:pieChartPatch,linechart:lineChartPatch},propertyLogic=function(mode,chart){var colorModeOptionsFunc=retriveLogic(chart,"colorModeOptions"),persistentColorsShowFunc=retriveLogic(chart,"persistentColorsShow"),expressionLabelChangeFunc=retriveLogic(chart,"expressionLabelChange"),attributeExpressionChangeFunc=retriveLogic(chart,"attributeExpressionChange"),attributeExpressionGlobalChangeFunc=retriveLogic(chart,"attributeExpressionGlobalChange");this.helpers={schemeIsReverse:schemeIsReverse,showDimensionIdOption:showDimensionIdOption,showCompressionResolution:showCompressionResolution,colorModeOptions:colorModeOptionsFunc},this.color={colorMode:{options:function(data){var options=[];return"explore"===mode&&options.push({value:"auto",translation:"Common.Auto"}),colorModeOptionsFunc.primary(data)&&options.push({value:"primary",translation:"properties.colorMode.primary"}),colorModeOptionsFunc.multiColor(data)&&options.push({value:"byDimension",translation:"properties.colorMode.multicolored"}),colorModeOptionsFunc.dimension(data)&&options.push({value:"byDimension",translation:"properties.colorMode.byDimension"}),colorModeOptionsFunc.measure(data)&&options.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),colorModeOptionsFunc.expression(data)&&"explore"!==mode&&options.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),options},show:function(data){return!propertyResolver.getValue(data,"color.auto")}},singleColor:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"primary"===propertyResolver.getValue(data,"color.mode")}},persistentColors:{show:persistentColorsShowFunc,readOnly:function(data){return propertyResolver.getValue(data,"qHyperCubeDef.qDimensions.length")>1}},attributeExpression:{change:attributeExpressionChangeFunc,globalChange:attributeExpressionGlobalChangeFunc,show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byExpression"===propertyResolver.getValue(data,"color.mode")&&propHcHelper.getNumMeasures(data)>0}},expressionIsColor:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byExpression"===propertyResolver.getValue(data,"color.mode")&&propHcHelper.getNumMeasures(data)>0}},expressionLabel:{change:expressionLabelChangeFunc,show:function(data){return!propertyResolver.getValue(data,"color.auto")&&expressionIsValue(data)&&propHcHelper.getNumMeasures(data)>0}},colorSchemeMeasure:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data))}},reverseScheme:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data))}},colorSchemeDimension:{show:function(data){return!propertyResolver.getValue(data,"color.auto")&&"byDimension"===propertyResolver.getValue(data,"color.mode")}},customRange:{show:function(data){return!propertyResolver.getValue(data,"color.auto")},autoMinMax:{show:function(data){return"byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data)}},min:{show:function(data){return("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data))&&propertyResolver.getValue(data,"color.autoMinMax")===!1},invalid:function(data){return"minMax"===propertyResolver.getValue(data,"color.minMax")?propertyResolver.getValue(data,"color.measureMin")>=propertyResolver.getValue(data,"color.measureMax"):!1}},max:{show:function(data){return("byMeasure"===propertyResolver.getValue(data,"color.mode")||expressionIsValue(data))&&propertyResolver.getValue(data,"color.autoMinMax")===!1},invalid:function(data){return"minMax"===propertyResolver.getValue(data,"color.minMax")?propertyResolver.getValue(data,"color.measureMin")>=propertyResolver.getValue(data,"color.measureMax"):!1}}}};var showLegendFunc=retriveLogic(chart,"showLegend");this.legend={show:showLegendFunc,showTitle:{show:function(data){return propertyResolver.getValue(data,"legend.show")&&showLegendFunc(data)&&!expressionIsColor(data)}},dock:{show:function(data){return propertyResolver.getValue(data,"legend.show")&&showLegendFunc(data);
}}}};return{getLogicFor:function(mode,chart){return new propertyLogic(mode,chart)}}}),define("client.property-panel/default-properties",["general.utils/property-resolver","client.property-panel/default-sorting-properties","general.utils/number-formatting","translator","core.utils/theme","general.utils/string-limits","util","client.utils/default-property-logic"],function(propertyResolver,defaultSortingProperties,numberFormat,translator,theme,stringLimits,util,propertyLogicModule){function isDefaultFormatPattern(itemData,options){return propertyResolver.getValue(itemData,"qDef.qNumFormat.qFmt")===numberFormat.getDefaultNumericFormat(itemData.qDef.qNumFormat,options?options.localeInfo:"")}function isFormatPatternInputVisible(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return["R","M","IV"].contains(type)||"U"!==type&&propertyResolver.getValue(itemData,"qDef.numFormatFromTemplate",!0)===!1}var defaults={sorting:defaultSortingProperties,"dimensions-sorting":defaultSortingProperties.items.dimensions,"measures-sorting":defaultSortingProperties.items.measures},propertyLogic=propertyLogicModule.getLogicFor("hard","default");return defaults.general={type:"items",translation:"properties.general",grouped:!0,items:{showTitles:{translation:"properties.showTitles",type:"boolean",ref:"showTitles",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-showTitles"}},titles:{type:"items",show:function(data){return data.showTitles!==!1},items:{title:{translation:"Common.Title",type:"string",expression:"optional",ref:"title",defaultValue:""},subtitle:{translation:"properties.subtitle",type:"string",expression:"optional",ref:"subtitle",defaultValue:""},footnote:{translation:"properties.footnote",type:"string",expression:"optional",ref:"footnote",defaultValue:""}}}}},defaults.metadata={type:"items",translation:"properties.metadata",schemaIgnore:!0,show:function(data){return"masterobject"===data.qInfo.qType},grouped:!0,items:{name:{translation:"Common.Name",type:"string",ref:"qMetaDef.title",minlength:1,rollbackInvalid:!0,show:function(data){return data.qMetaDef}},description:{translation:"Common.Description",type:"string",component:"textarea",ref:"qMetaDef.description",maxlength:stringLimits.description,show:function(data){return data.qMetaDef}},tags:{translation:"Common.Tags",component:"tags",type:"array",ref:"qMetaDef.tags",show:function(data){return data.qMetaDef}}}},defaults.settings={type:"items",component:"expandable-items",translation:"Common.Appearance",items:{metadata:defaults.metadata,general:defaults.general}},defaults.addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{}},defaults.dimensions={type:"array",component:"dimensions",translation:"Common.Dimensions",ref:"qHyperCubeDef.qDimensions",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qLibraryId",translation:"Common.Dimension",show:function(itemData){return itemData.qLibraryId}},inlineDimension:{component:"inline-dimension",show:function(itemData){return!itemData.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},nullSuppression:{type:"boolean",ref:"qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0},dimensionLimits:{type:"items",items:{otherMode:{type:"string",component:"dropdown",ref:"qOtherTotalSpec.qOtherMode",translation:"properties.dimensionLimits.limitation",options:[{value:"OTHER_OFF",translation:"properties.dimensionLimits.none"},{value:"OTHER_COUNTED",translation:"properties.dimensionLimits.fixedNumber"},{value:"OTHER_ABS_LIMITED",translation:"properties.dimensionLimits.exactValue"},{value:"OTHER_REL_LIMITED",translation:"properties.dimensionLimits.relativeValue"}],defaultValue:"OTHER_OFF",readOnly:function(itemData,handler){return 0===handler.getMeasures().length},change:function(itemData){var limit,otherMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");"OTHER_REL_LIMITED"===otherMode?(limit=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherLimit.qv","0"),limit.length&&"%"!==limit[limit.length-1]&&util.isNumeric(limit)&&(itemData.qOtherTotalSpec.qOtherLimit||propertyResolver.setValue(itemData,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),itemData.qOtherTotalSpec.qOtherLimit.qv=limit+"%")):"OTHER_ABS_LIMITED"===otherMode&&(limit=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherLimit.qv","0"),limit.length&&"%"===limit[limit.length-1]&&(itemData.qOtherTotalSpec.qOtherLimit||propertyResolver.setValue(itemData,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),itemData.qOtherTotalSpec.qOtherLimit.qv=limit.substr(0,limit.length-1)))}},otherSortMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherSortMode",options:[{value:"OTHER_SORT_DESCENDING",translation:"Common.Top"},{value:"OTHER_SORT_ASCENDING",translation:"Common.Bottom"}],defaultValue:"OTHER_SORT_DESCENDING",show:function(itemData,handler){return"OTHER_COUNTED"===propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}},otherCounted:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherCounted",defaultValue:{qv:"10"},show:function(itemData,handler){return"OTHER_COUNTED"===propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}},otherLimitMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherLimitMode",options:[{value:"OTHER_GE_LIMIT",label:">=",tooltipTranslation:"properties.greaterOrEqualTo"},{value:"OTHER_GT_LIMIT",label:">",tooltipTranslation:"properties.greaterThan"},{value:"OTHER_LT_LIMIT",label:"<",tooltipTranslation:"properties.lessThan"},{value:"OTHER_LE_LIMIT",label:"<=",tooltipTranslation:"properties.lessOrEqualTo"}],defaultValue:"OTHER_GE_LIMIT",icon:!0,smallIconFont:!0,show:function(itemData,handler){var limitMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===limitMode||"OTHER_REL_LIMITED"===limitMode)&&handler.getMeasures().length>0}},otherLimit:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherLimit",defaultValue:{qv:"0"},show:function(itemData,handler){var limitMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===limitMode||"OTHER_REL_LIMITED"===limitMode)&&handler.getMeasures().length>0}},calculatedAgainstMessage:{component:"text",label:function(itemData,handler){var measure=handler.getMeasureLayouts()[0];return measure?translator.get("Properties.DimensionLimits.CalculatedAgainst",measure.qFallbackTitle):translator.get("Properties.DimensionLimits.NoMeasure")},show:function(itemData){var limitMode=propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode");return"OTHER_OFF"!==limitMode}}}},others:{type:"items",items:{suppressOther:{type:"boolean",ref:"qOtherTotalSpec.qSuppressOther",translation:"properties.dimensionLimits.showOthers",inverted:!0,defaultValue:!1,show:function(itemData,handler){return"OTHER_OFF"!==propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}},othersLabel:{type:"string",expression:"optional",ref:"qDef.othersLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return translator.get("properties.dimensionLimits.others")},show:function(itemData,handler){return!propertyResolver.getValue(itemData,"qOtherTotalSpec.qSuppressOther")&&"OTHER_OFF"!==propertyResolver.getValue(itemData,"qOtherTotalSpec.qOtherMode")&&handler.getMeasures().length>0}}}}}},defaults.measures={type:"array",component:"measures",translation:"Common.Measures",ref:"qHyperCubeDef.qMeasures",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.measures.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qLibraryId",translation:"Common.Measure",show:function(itemData){return itemData.qLibraryId}},inlineMeasure:{component:"inline-measure",show:function(itemData){return!itemData.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},numberFormatting:{type:"items",items:{numberFormattingType:{type:"string",component:"dropdown",ref:"qDef.qNumFormat.qType",translation:"properties.numberFormatting",defaultValue:"U",options:[{value:"U",translation:"Common.Auto"},{value:"F",translation:"properties.numberFormatting.types.number"},{value:"M",translation:"properties.numberFormatting.types.money"},{value:"D",translation:"properties.numberFormatting.types.date"},{value:"IV",translation:"properties.numberFormatting.types.duration"},{value:"R",translation:"Common.Custom"}],change:function(itemData,handler,properties,options){numberFormat.setNumFmtPattern("qType",itemData.qDef.qNumFormat,options.localeInfo)}},numberFormattingMode:{type:"boolean",component:"switch",ref:"qDef.numFormatFromTemplate",translation:"properties.numberFormatting.formatting",defaultValue:!0,options:[{value:!0,translation:"properties.numberFormatting.simple"},{value:!1,translation:"Common.Custom"}],show:function(data){return["F","D","TS","T"].contains(propertyResolver.getValue(data,"qDef.qNumFormat.qType"))}},numberFormattingTemplates:{type:"string",component:"number-formatter-dropdown",ref:"qDef.qNumFormat.qFmt",defaultValue:"#,##0",show:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return["F","D","TS","T"].contains(type)&&propertyResolver.getValue(itemData,"qDef.numFormatFromTemplate",!0)===!0}},numDecimals:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.nDec",defaultValue:2,min:0,max:14,show:!1},numPrecisionDigits:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.significantFigures",defaultValue:10,min:1,max:14,show:!1},decimalSep:{type:"string",ref:"qDef.qNumFormat.qDec",translation:"properties.numberFormatting.dec",defaultValue:".",show:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return"R"===type},change:function(itemData,handler,properties,options){numberFormat.setNumFmtPattern("qDec",itemData.qDef.qNumFormat,options.localeInfo)},invalid:function(itemData){return propertyResolver.getValue(itemData,"qDef.qNumFormat.qDec")===propertyResolver.getValue(itemData,"qDef.qNumFormat.qThou")},readOnly:function(itemData,handler,properties,options){return!isDefaultFormatPattern(itemData,options)}},thousandSep:{type:"string",ref:"qDef.qNumFormat.qThou",translation:"properties.numberFormatting.thousandSeparator",defaultValue:"",show:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return"R"===type},change:function(itemData,handler,properties,options){numberFormat.setNumFmtPattern("qThou",itemData.qDef.qNumFormat,options.localeInfo)},invalid:function(itemData){var type=propertyResolver.getValue(itemData,"qDef.qNumFormat.qType");return"I"===type?!1:propertyResolver.getValue(itemData,"qDef.qNumFormat.qDec")===propertyResolver.getValue(itemData,"qDef.qNumFormat.qThou")},readOnly:function(itemData,handler,properties,options){return!isDefaultFormatPattern(itemData,options)}},format:{type:"string",component:"number-formatter",ref:"qDef.qNumFormat.qFmt",resetTranslation:"properties.numberFormatting.resetPattern",translation:"properties.numberFormatting.formatPattern",defaultValue:"",show:function(itemData){return isFormatPatternInputVisible(itemData)},change:function(itemData){itemData.qDef.qNumFormat.qFmt=numberFormat.getNormalizedFormat(itemData.qDef.qNumFormat,itemData.qDef.qNumFormat.qFmt)},invalid:function(itemData,props,options){if(["D","T","TS","IV"].contains(itemData.qDef.qNumFormat.qType))return!1;var decimalDelimiter="R"===itemData.qDef.qNumFormat.qType?itemData.qDef.qNumFormat.qDec:options.localeInfo["q"+("M"===itemData.qDef.qNumFormat.qType?"Money":"")+"DecimalSep"],r=new RegExp("(0|#)"+util.escapeRegExp(decimalDelimiter)+"0*#*"),fmt=(itemData.qDef.qNumFormat.qFmt||"").split(";"),posMatch=fmt[0].match(r),posNum=posMatch&&posMatch[0]?posMatch[0].length-2:0,negMatch=fmt[1]?fmt[1].match(r):null,negNum=negMatch&&negMatch[0]?negMatch[0].length-2:0;return posNum>15||negNum>15}}}}}},defaults.measureAxis={type:"items",label:translator.get("properties.yAxis"),grouped:!0,items:{axis:{type:"items",items:{show:{type:"string",component:"dropdown",ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},dock:{type:"string",component:"dropdown",ref:"measureAxis.dock",translation:"Common.Position",defaultValue:"near",options:function(data){var nearStr,farStr;return"horizontal"===data.orientation?(nearStr="Common.Bottom",farStr="Common.Top"):(nearStr="properties.dock.left",farStr="properties.dock.right"),[{value:"near",translation:nearStr},{value:"far",translation:farStr}]},show:function(data){return data.measureAxis&&"none"!==data.measureAxis.show}},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}],show:function(data){return data.measureAxis&&"none"!==data.measureAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxis.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},minMax:{type:"string",component:"dropdown",ref:"measureAxis.minMax",options:[{translation:"properties.axis.min",value:"min"},{translation:"Common.Max",value:"max"},{translation:"properties.axis.minMax",value:"minMax"}],defaultValue:"min",show:function(data){return data.measureAxis&&!data.measureAxis.autoMinMax}},min:{ref:"measureAxis.min",translation:"properties.axis.min",expression:"optional",type:"number",show:function(data){return data.measureAxis&&["min","minMax"].contains(data.measureAxis.minMax)&&!data.measureAxis.autoMinMax},invalid:function(data){return data.measureAxis&&"minMax"===data.measureAxis.minMax?data.measureAxis.min>=data.measureAxis.max:!1}},max:{ref:"measureAxis.max",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(data){return data.measureAxis&&["max","minMax"].contains(data.measureAxis.minMax)&&!data.measureAxis.autoMinMax},invalid:function(data){return data.measureAxis&&"minMax"===data.measureAxis.minMax?data.measureAxis.min>=data.measureAxis.max:!1}}}}}},defaults.reflines={type:"array",ref:"refLine.refLines",translation:"properties.referenceLines",itemTitleRef:"label",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.referenceLines.add",items:{show:{ref:"show",translation:"Common.Show",type:"boolean",defaultValue:!0},label:{ref:"label",translation:"Common.Label",type:"string"},color:{ref:"color",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:2},expressionValue:{ref:"refLineExpr.value",translation:"properties.referenceLines.expression",type:"number",expression:"optional",expressionType:"ValueExpression",defaultValue:0,change:function(itemData){var refLine=itemData.refLineExpr;"object"==typeof refLine.value?refLine.label={qStringExpression:{qExpr:refLine.value.qValueExpression.qExpr}}:refLine.label=""+refLine.value}},expressionLabel:{ref:"refLineExpr.label",translation:"properties.referenceLines.expression",type:"string",expression:"optional",expressionType:"StringExpression",defaultValue:"0",show:!1}}},defaults.dataHandling={type:"items",translation:"properties.dataHandling",grouped:!0,items:{suppressZero:{ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",type:"boolean",inverted:!0},calcCond:{type:"items",items:{expr:{ref:"qHyperCubeDef.qCalcCond",type:"string",component:"expression",expressionType:"ValueExpr",translation:"properties.hyperCube.calcCond"},customErrorMessage:{ref:"qHyperCubeDef.customErrorMessage.calcCond",component:"textarea",defaultValue:"",type:"string",placeholderTranslation:"Object.ErrorMessage.CalculationCondition",translation:"properties.hyperCube.calcCondMessage",show:function(data){var val=propertyResolver.getValue(data,"qHyperCubeDef.qCalcCond");return val.qv&&""!==val.qv}}}}}},defaults.colorsAndLegend={type:"items",translation:"properties.colorsAndLegend",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"color.mode",type:"string",component:"dropdown",options:propertyLogic.color.colorMode.options,defaultValue:"primary",show:propertyLogic.color.colorMode.show},singleColor:{ref:"color.singleColor",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:3,show:propertyLogic.color.singleColor.show},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",defaultValue:!1,show:propertyLogic.color.persistentColors.show,readOnly:propertyLogic.color.persistentColors.readOnly},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:propertyLogic.color.attributeExpression.change,globalChange:propertyLogic.color.attributeExpression.globalChange,translation:"Common.Expression",show:propertyLogic.color.attributeExpression.show},expressionIsColor:{ref:"color.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:propertyLogic.color.expressionIsColor.show},expressionLabel:{type:"string",ref:"color.expressionLabel",translation:"Common.Label",change:propertyLogic.color.expressionLabel.change,show:propertyLogic.color.expressionLabel.show},colorSchemeMeasure:{ref:"color.measureScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"sg",items:[{colors:theme.colorSchemes.ordinalScales[0].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[0].translation||theme.colorSchemes.ordinalScales[0].name,value:"sg"},{colors:theme.colorSchemes.ordinalScales[1].scale[theme.colorSchemes.ordinalScales[1].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[1].translation||theme.colorSchemes.ordinalScales[1].name,value:"sc"},{colors:theme.colorSchemes.ordinalScales[2].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[2].translation||theme.colorSchemes.ordinalScales[2].name,value:"dg"},{colors:theme.colorSchemes.ordinalScales[3].scale[theme.colorSchemes.ordinalScales[3].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[3].translation||theme.colorSchemes.ordinalScales[3].name,value:"dc"}],show:propertyLogic.color.colorSchemeMeasure.show},reverseScheme:{ref:"color.reverseScheme",translation:"properties.reverseColorScheme",type:"boolean",defaultValue:!1,show:propertyLogic.color.reverseScheme.show},colorSchemeDimension:{ref:"color.dimensionScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"12",items:[{colors:theme.colorSchemes.qualitativeScales[0].scale[theme.colorSchemes.qualitativeScales[0].scale.length-1],type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[0].translation||theme.colorSchemes.qualitativeScales[0].name,value:"12"},{colors:theme.colorSchemes.qualitativeScales[1].scale,type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[1].translation||theme.colorSchemes.qualitativeScales[1].name,value:"100"}],show:propertyLogic.color.colorSchemeDimension.show},customRange:{type:"items",items:{autoMinMax:{ref:"color.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:propertyLogic.color.customRange.autoMinMax.show},min:{ref:"color.measureMin",translation:"properties.axis.min",expression:"optional",type:"number",show:propertyLogic.color.customRange.min.show,invalid:propertyLogic.color.customRange.min.invalid},max:{ref:"color.measureMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:propertyLogic.color.customRange.max.show,invalid:propertyLogic.color.customRange.max.invalid}},show:propertyLogic.color.customRange.show}}},legend:{type:"items",items:{show:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:propertyLogic.legend.show},dock:{type:"string",component:"dropdown",ref:"legend.dock",translation:"properties.legend.position",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"bottom",translation:"Common.Bottom"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"Common.Top"}],defaultValue:"auto",show:propertyLogic.legend.dock.show},showTitle:{ref:"legend.showTitle",translation:"properties.legend.showTitle",type:"boolean",defaultValue:!0,show:propertyLogic.legend.showTitle.show}}}}},defaults.data={type:"items",component:"hypercube-data",translation:"Common.Data",addTranslation:"Properties.AddData",allowAdd:!0,items:{dimensions:defaults.dimensions,measures:defaults.measures}},defaults}),define("general.utils/property-mapper",["client.property-panel/default-properties","general.utils/property-resolver","util"],function(defaultDefinition,propertyResolver,util){function findDefinition(definition,ref,deep){var keys,item,i,subdefinition=null;if(definition.ref===ref)return definition;if(propertyResolver.isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;++i){if(item=definition.items[keys[i]],item.ref===ref){subdefinition=item;break}if(deep&&(subdefinition=findDefinition(item,ref,deep),null!==subdefinition))break}return subdefinition}function mapDefinition(definition,type,usesDefinition){var mappedDefinition,items,defaults;if(usesDefinition=usesDefinition||defaultDefinition,definition||(definition=nonExistingDefinition),type&&definitionCache[type])return definitionCache[type];if(definition.uses){if(defaults=usesDefinition[definition.uses],!defaults)throw"No defaults found for: "+definition.uses;definition=util.extend(!0,{},defaults,definition)}return propertyResolver.isHierarchical(definition)?(items={},Object.keys(definition.items).forEach(function(key){definition.items[key]&&(items[key]=mapDefinition(definition.items[key],null,usesDefinition))}),mappedDefinition=util.extend({},definition,{items:items})):"array"===definition.type&&definition.items?(items={},Object.keys(definition.items).forEach(function(key){definition.items[key]&&(items[key]=mapDefinition(definition.items[key],null,usesDefinition))}),mappedDefinition=util.extend({},definition,{items:items})):mappedDefinition=util.extend({},definition),type&&!definitionCache[type]&&(definitionCache[type]=mappedDefinition),mappedDefinition}function mapProperties(definition,properties,type){var mappedDefinition=mapDefinition(definition,type);return properties?util.extend(!0,propertyResolver.getDefaults(mappedDefinition),properties):propertyResolver.getDefaults(mappedDefinition)}function getPropertyHierarchy(mappedDefinition){function getHierarchy(definition){function isArrayRef(ref){return-1!==ref.search(/\.\d/g)}function getLeafDescription(d){var description={type:d.type,defaultValue:propertyResolver.getDefaultValue(d.type,d)};return d.maxlength&&(description.maxlength=d.maxlength),d.min&&(description.min=d.min),d.max&&(description.max=d.max),d.expression&&(description.expression=d.expression),d.options&&"boolean"!==d.type&&(description["enum"]=d.options.map(function(option){return option.value})),description}function traverse(definition){var keys,key,item,listHierarchy,i,description;if(propertyResolver.isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;i++)key=keys[i],item=definition.items[key],traverse(item);else definition.ref&&"array"===definition.type&&definition.items?(listHierarchy=getHierarchy({type:"items",items:definition.items}),description={type:"array",items:listHierarchy},isArrayRef(definition.ref)||propertyResolver.setValue(hierarchy,definition.ref,description)):definition.ref&&(description=getLeafDescription(definition),isArrayRef(definition.ref)||propertyResolver.setValue(hierarchy,definition.ref,description))}var hierarchy={};return traverse(definition),hierarchy}return getHierarchy(mappedDefinition)}function findSnapshotProperties(mappedDefinition){function find(definition){var keys,item,i;if(propertyResolver.isHierarchical(definition))for(keys=Object.keys(definition.items),i=0;i<keys.length;++i)item=definition.items[keys[i]],item.snapshot&&result.push(item),find(item)}var result=[];return find(mappedDefinition),result}function findGlobalListeners(definition,type){function find(def){def.globalChange&&result.push(def.globalChange),"items"!==def.type&&"array"!==def.type||!def.items||Object.keys(def.items).forEach(function(key){def.items[key]&&find(def.items[key])})}if(type&&listenerCache[type])return listenerCache[type];var result=[];return find(definition),type&&!listenerCache[type]&&(listenerCache[type]=result),result}var nonExistingDefinition,definitionCache={},listenerCache={};return nonExistingDefinition={type:"items",component:"accordion",items:{settings:{uses:"settings"}}},{findDefinition:findDefinition,findSnapshotProperties:findSnapshotProperties,findGlobalListeners:findGlobalListeners,mapDefinition:mapDefinition,mapProperties:mapProperties,getPropertyHierarchy:getPropertyHierarchy}}),define("objects.backend-api/generic-api",["./backend-api"],function(BackendApi){"use strict";function getDataPath(layout,path){if(path){if(layout[path]){if(layout[path].qHyperCube)return path+".qHyperCube";if(layout[path].qListObject)return path+".qListObject"}return-1!==path.indexOf("Def",path.length-3)?path.slice(0,path.length-3):path}return layout.qHyperCube?"qHyperCube":"qListObject"}var GenericApi;return GenericApi=BackendApi.extend("GenericApi",{init:function(model,path){var dataPath=getDataPath(model.layout,path);this._super(model,"/"+dataPath+"Def"),this.isHyperCube=-1!==this.dataPath.indexOf("qHyperCube"),this.cacheCube.setMethodName(this.isHyperCube?"GetHyperCubeData":"GetListObjectData")},getBackendApi:function(path){return new GenericApi(this.model,path)},getProperties:function(){return this.model.getProperties()},setProperties:function(props){return this.model.setProperties(props)},applyPatches:function(qPatches,softPatch){return this.model.applyPatches(qPatches,softPatch)},clearSoftPatches:function(){return this.model.clearSoftPatches()},save:function(){return this.model.save()},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},updateCache:function(layout){layout&&layout[this.dataPath]?(this.cacheCube.set(layout[this.dataPath].qDataPages),this.cacheCube.setCubeSize(layout[this.dataPath].qSize)):this.cacheCube.clear()},getData:function(pages){var dfd=this.cacheCube.getData(pages),self=this;return dfd.then(function(dataPages){self.model.layout[self.dataPath].qDataPages.push(dataPages[0])}),dfd},getDataRow:function(rownum){var myData=this.model.layout[this.dataPath];if(myData)for(var len=myData.qDataPages.length,i=0;len>i;i++){var page=myData.qDataPages[i];if(rownum>=page.qArea.qTop&&rownum<page.qArea.qTop+page.qArea.qHeight)return page.qMatrix[rownum-page.qArea.qTop]}return null},selectValues:function(dimNo,values,toggleMode){return this.isHyperCube?this.model.rpc("SelectHyperCubeValues",null,[this.path,dimNo,values,toggleMode]):this.model.rpc("SelectListObjectValues",null,[this.path,values,toggleMode])},select:function(values,dimNo,toggleMode){return this.selectValues(dimNo,values,toggleMode)},getReducedData:function(pages,zoomFactor,reductionMode){return this.isHyperCube?this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,pages,zoomFactor,reductionMode||"D1"]):null},selectRange:function(qRanges,qOrMode,qColumnsToSelect){return qOrMode=!!qOrMode,qColumnsToSelect=qColumnsToSelect||[],this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,qRanges,qColumnsToSelect,qOrMode])},search:function(term){return this.isHyperCube?null:this.model.rpc("SearchListObjectFor",null,[this.path,term])},abortSearch:function(){return this.isHyperCube?null:this.model.rpc("AbortListObjectSearch",null,[this.path])},acceptSearch:function(toggleMode){return this.isHyperCube?null:this.model.rpc("AcceptListObjectSearch",null,[this.path,toggleMode])},getPivotData:function(qPages){return this.isHyperCube?this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,qPages]):null},getStackData:function(qPages,qMaxNbrCells){return this.isHyperCube?this.model.rpc("GetHyperCubeStackData","qDataPages",[this.path,qPages,qMaxNbrCells||1e3]):null},expandTop:function(qRow,qCol,qAll){return this.model.rpc("ExpandTop",null,[this.path,qRow,qCol,qAll||!1])},expandLeft:function(qRow,qCol,qAll){return this.model.rpc("ExpandLeft",null,[this.path,qRow,qCol,qAll||!1])},collapseTop:function(qRow,qCol,qAll){return this.model.rpc("CollapseTop",null,[this.path,qRow,qCol,qAll])},collapseLeft:function(qRow,qCol,qAll){return this.model.rpc("CollapseLeft",null,[this.path,qRow,qCol,qAll])}})}),define("objects.utils/data-properties/data-property-handler",["core.utils/class","util"],function(Class,util){"use strict";var DataPropertyHandler,notSupported;return notSupported="Not supported in this object, need to implement in subclass.",DataPropertyHandler=Class.extend({init:function(dimensionDefinition,measureDefinition,dimensionProperties,measureProperties){this.dimensionDefinition=dimensionDefinition||{max:0},this.measureDefinition=measureDefinition||{max:0},dimensionDefinition&&(this.dimensionProperties=dimensionProperties||{}),measureDefinition&&(this.measureProperties=measureProperties||{})},setProperties:function(properties){this.properties=properties},setLayout:function(layout){this.layout=layout},type:function(){throw"Must override this method"},getDimensions:function(){return[]},getDimension:function(id){var dimensions=this.getDimensions(),i=0;for(i;i<dimensions.length;++i)if(dimensions[i].qDef.cId===id)return dimensions[i];return null},minDimensions:function(){return"function"==typeof this.dimensionDefinition.min?this.dimensionDefinition.min.call(null,this.properties,this):this.dimensionDefinition.min||0},maxDimensions:function(){return"function"==typeof this.dimensionDefinition.max?this.dimensionDefinition.max.call(null,this.getMeasures().length):isNaN(this.dimensionDefinition.max)?1e4:this.dimensionDefinition.max},canAddDimension:function(){return this.getDimensions().length<this.maxDimensions()},minMeasures:function(){return"function"==typeof this.measureDefinition.min?this.measureDefinition.min.call(null,this.properties,this):this.measureDefinition.min||0;
},maxMeasures:function(){return"function"==typeof this.measureDefinition.max?this.measureDefinition.max.call(null,this.getDimensions().length):isNaN(this.measureDefinition.max)?1e4:this.measureDefinition.max},canAddMeasure:function(){return this.getMeasures().length<this.maxMeasures()},getMeasures:function(){return[]},getMeasure:function(id){var measures=this.getMeasures(),i=0;for(i;i<measures.length;++i)if(measures[i].qDef.cId===id)return measures[i];return null},addDimension:function(){throw notSupported},getSorting:function(){throw notSupported},addFieldDimension:function(field,label,defaults){var dimension=this.createFieldDimension(field,label,defaults);return this.addDimension(dimension)},addLibraryDimension:function(id,defaults){var dimension=this.createLibraryDimension(id,defaults);return this.addDimension(dimension)},addMeasure:function(){throw notSupported},addExpressionMeasure:function(expression,label,defaults){var measure=this.createExpressionMeasure(expression,label,defaults);return this.addMeasure(measure)},addLibraryMeasure:function(id,defaults){var measure=this.createLibraryMeasure(id,defaults);return this.addMeasure(measure)},replaceDimension:function(){throw notSupported},replaceMeasure:function(){throw notSupported},autoSortDimension:function(){throw notSupported},autoSortMeasure:function(){throw notSupported},createFieldDimension:function(field,label,defaults){var dimension=util.extend(!0,{},this.dimensionProperties||{},defaults||{});return dimension.qDef||(dimension.qDef={}),dimension.qOtherTotalSpec||(dimension.qOtherTotalSpec={}),field?(dimension.qDef.qFieldDefs=[field],label?dimension.qDef.qFieldLabels=[label]:dimension.qDef.qFieldLabels=[""],dimension.qDef.qSortCriterias=[{qSortByLoadOrder:1}]):(dimension.qDef.qFieldDefs=[],dimension.qDef.qFieldLabels=[],dimension.qDef.qSortCriterias=[]),dimension.qDef.autoSort=!0,dimension},createLibraryDimension:function(id,defaults){var dimension=util.extend(!0,{},this.dimensionProperties||{},defaults||{});return dimension.qDef||(dimension.qDef={}),dimension.qOtherTotalSpec||(dimension.qOtherTotalSpec={}),dimension.qLibraryId=id,dimension.qDef.qSortCriterias=[{qSortByLoadOrder:1}],dimension.qDef.autoSort=!0,delete dimension.qDef.qFieldDefs,delete dimension.qDef.qFieldLabels,dimension},createExpressionMeasure:function(expression,label,defaults){var measure=util.extend(!0,{},this.measureProperties||{},defaults||{});return measure.qDef||(measure.qDef={}),measure.qDef.qNumFormat||(measure.qDef.qNumFormat={}),measure.qDef.qDef=expression,measure.qDef.qLabel=label,measure.qDef.autoSort=!0,measure},createLibraryMeasure:function(id,defaults){var measure=util.extend(!0,{},this.measureProperties||{},defaults||{});return measure.qDef||(measure.qDef={}),measure.qDef.qNumFormat||(measure.qDef.qNumFormat={}),measure.qLibraryId=id,measure.qDef.autoSort=!0,delete measure.qDef.qDef,delete measure.qDef.qLabel,measure},getDimensionLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(cId){return this.getDimensionLayouts().filter(function(item){return cId===item.cId})[0]},getMeasureLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(cId){return this.getMeasureLayouts().filter(function(item){return cId===item.cId})[0]},removeDimension:function(){throw notSupported},removeMeasure:function(){throw notSupported},moveDimension:function(){throw notSupported},moveMeasure:function(){throw notSupported},changeSorting:function(){throw notSupported}})}),define("general.utils/array-util",[],function(){function isArray(array){return array&&"[object Array]"===Object.prototype.toString.call(array)}function isFunction(func){return func&&"function"==typeof func}function forEach(array,actionFunction){var i,keyword;if(!isArray(array))throw"No valid items were specified.";if(!isFunction(actionFunction))throw"No valid action function was specified.";if(Array.prototype.forEach)array.forEach(actionFunction);else for(i in array)keyword=array[i],actionFunction(keyword)}function contains(array,item){if(!isArray(array))throw"No valid items were specified.";if(Array.prototype.indexOf)return-1!==array.indexOf(item);for(var i=array.length;i--;)if(array[i]===item)return!0;return!1}function intersects(array1,array2){if(!(array1&&array2&&array1.length&&array2.length))return!1;var i,len=array2.length;for(i=0;len>i;i++)if(array1.indexOf(array2[i])>-1)return!0;return!1}function move(array,old_index,new_index){if(new_index>=array.length)for(var k=new_index-array.length;k--+1;)array.push(void 0);array.splice(new_index,0,array.splice(old_index,1)[0])}function swap(array,firstIndex,secondIndex){var firstItem=array[firstIndex];array[firstIndex]=array[secondIndex],array[secondIndex]=firstItem}function indexAdded(array,index){var i;for(i=0;i<array.length;++i)array[i]>=0&&array[i]>=index&&++array[i];array.push(index)}function indexRemoved(array,index){var i,removeIndex=0;for(i=0;i<array.length;++i)array[i]>index?--array[i]:array[i]===index&&(removeIndex=i);array.splice(removeIndex,1)}function limit(array,len){return array.length>len?array.slice(0,len):array}function _copy(array){if(!(array instanceof Array))throw new Error("Argument is not an Array.");return array.slice(0)}return{forEach:forEach,contains:contains,move:move,swap:swap,limit:limit,indexAdded:indexAdded,indexRemoved:indexRemoved,intersects:intersects,copy:_copy}}),define("general.models/library/dimension",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Dimension;return Dimension=BaseObject.extend("Dimension",{clone:function(){return this._super("CloneDimension")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qDimensionListDef:{qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}}}),Dimension.get=function(id,app){function getHandle(){return app.rpc("GetDimension","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Dimension.create=function(props,app){return BaseObject.create.call(Dimension,props,"CreateDimension",app)},Dimension.remove=function(id,app){return BaseObject.remove(id,"DestroyDimension",app)},Dimension}),define("general.models/library/measure",["core.models/base-object","core.models/app"],function(BaseObject,App){"use strict";var Measure;return Measure=BaseObject.extend("Measure",{clone:function(){return this._super("CloneMeasure")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qMeasureListDef:{qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}}}),Measure.get=function(id,app){function getHandle(){return app.rpc("GetMeasure","qReturn",[id])}return app=app||App.current,this.getModel(id,app.session,getHandle)},Measure.create=function(props,app){return BaseObject.create.call(Measure,props,"CreateMeasure",app)},Measure.remove=function(id,app){return BaseObject.remove(id,"DestroyMeasure",app)},Measure}),define("objects.utils/data-properties/listobject-util",["util"],function(util){"use strict";return{autoSortDimension:function(dimension,fields){return dimension.qDef.qSortCriterias=[],dimension.qDef.autoSort=!0,fields?fields.forEach(function(field,index){dimension.qDef.qSortCriterias[index]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1}}):dimension.qDef.qSortCriterias[0]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1},dimension},createFieldDimension:function(field){return{qDef:{qFieldDefs:[field],qFieldLabels:[field],qSortCriterias:[]}}},createLibraryDimension:function(id){return{qLibraryId:id,qDef:{qSortCriterias:[]}}},createDefaultListBox:function(dimensionDef,title){var i,listboxDef=util.extend(!0,{},dimensionDef);for(listboxDef.qShowAlternatives=!0,i=0;i<listboxDef.qDef.qSortCriterias.length;++i)listboxDef.qDef.qSortCriterias[i].qSortByState=1;return title=title||(dimensionDef.qDef.qFieldLabels&&dimensionDef.qDef.qFieldLabels.length?dimensionDef.qDef.qFieldLabels[0]:""),{qInfo:{qType:"listbox"},qListObjectDef:listboxDef,title:title,visualization:"listbox"}}}}),define("client.assets/tab-contents/fields/assets-directdiscovery-service",[],function(){"use strict";function isMeasure(field){return!!field.qTags&&-1!==field.qTags.indexOf("$dd_measure")}function isDetails(field){return!!field.qTags&&-1!==field.qTags.indexOf("$dd_details")}function isDimension(field){return!!field.qTags&&-1!==field.qTags.indexOf("$dd_dimension")}function isDirectDiscoveryField(field){return!!field.qTags&&-1!==field.qTags.indexOf("$directdiscovery")}function removeMeasureAndDetailsFields(fields){var filteredFields=fields;return fields&&(filteredFields=fields.filter(function(field){return!isMeasure(field)&&!isDetails(field)})),filteredFields}function getTypeTranslationKey(tags){var translationKey="",field={qTags:tags};return isMeasure(field)?translationKey="DirectDiscovery.Measure":isDetails(field)?translationKey="DirectDiscovery.Details":isDimension(field)&&(translationKey="DirectDiscovery.Dimension"),translationKey}return{isMeasure:isMeasure,isDetails:isDetails,isDimension:isDimension,removeMeasureAndDetailsFields:removeMeasureAndDetailsFields,getTypeTranslationKey:getTypeTranslationKey,isDirectDiscoveryField:isDirectDiscoveryField}}),define("client.assets/tab-contents/fields/assets-field-list-model",["objects.utils/data-properties/listobject-util","client.assets/tab-contents/fields/assets-directdiscovery-service"],function(listObjectUtil,directDiscoveryService){"use strict";function getDropOption(item){var dimDef;return dimDef=listObjectUtil.createFieldDimension(item.qName),listObjectUtil.autoSortDimension(dimDef,[item]),{id:"newObject",args:{template:"filterpane",children:[listObjectUtil.createDefaultListBox(dimDef,item.qName)],init:{}}}}function expand(list){for(var result=[],i=0;i<list.length;++i){var field=list[i];if(result.push(field),field.qDerivedFieldData)for(var j=0;j<field.qDerivedFieldData.qDerivedFieldLists.length;++j)for(var derived=field.qDerivedFieldData.qDerivedFieldLists[j],k=0;k<derived.qFieldDefs.length;++k){var derived_field=derived.qFieldDefs[k];result.push({qName:derived_field.qName,qSrcTables:field.qSrcTables,qTags:derived_field.qTags,isDerived:!0,sourceField:field.qName,derivedDefinitionName:derived.qDerivedDefinitionName})}}return result}var model={create:function(list){return list.map(function(field){return{id:field.qName,name:field.qName,type:"field",srcTables:field.qSrcTables,sourceField:field.sourceField,calendarTemplateName:field.derivedDefinitionName,getDropOption:getDropOption.bind(null,field),tags:field.qTags,icon:directDiscoveryService.isDirectDiscoveryField(field)?"directdiscovery":"",iconTooltip:directDiscoveryService.getTypeTranslationKey(field.qTags),derivedCalendars:field.qDerivedFieldData?field.qDerivedFieldData.qDerivedFieldLists.map(function(cal){return cal.qDerivedDefinitionName}):[]}})},expand:expand,createFromArray:function(array,mappingName){var i,fields=[];for(i=0;i<array.length;i++)mappingName&&(array[i].qName=array[i][mappingName]),fields.push({name:array[i].qName,type:"field",getDropOption:getDropOption.bind(null,array[i])});return fields},getTables:function(list){var i,j,tables,fields=list;for(tables=[],i=0;i<fields.length;++i)for(j=0;j<fields[i].qSrcTables.length;++j)-1===tables.indexOf(fields[i].qSrcTables[j])&&tables.push(fields[i].qSrcTables[j]);return tables}};return model}),define("objects.utils/data-properties/library-utils",["general.utils/array-util","general.models/field","general.models/library/dimension","general.models/library/measure","client.assets/tab-contents/fields/assets-field-list-model"],function(ArrayUtil,FieldModel,DimensionModel,MeasureModel,FieldListModel){"use strict";function findField(name){return FieldModel.getListLayout().then(function(fieldList){fieldList=FieldListModel.expand(fieldList);var i,item;if(fieldList)for(i=0;i<fieldList.length;i++)if(item=fieldList[i],item.qName===name)return item;return null})}function findLibraryMeasure(id){return MeasureModel.getListLayout().then(function(measureList){var i,item;if(measureList)for(i=0;i<measureList.length;i++)if(item=measureList[i],item.qInfo.qId===id)return item;return null})}function findLibraryDimension(id){return DimensionModel.getListLayout().then(function(dimensionList){var i,layout;if(dimensionList)for(i=0;i<dimensionList.length;i++)if(layout=dimensionList[i],layout.qInfo.qId===id)return layout;return null})}function getSortedFields(){return FieldModel.getListLayout().then(function(fields){return FieldListModel.expand(fields).sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())})})}function getSortedDimensions(){return DimensionModel.getListLayout().then(function(dimensions){return ArrayUtil.copy(dimensions).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}function getSortedMeasures(){return MeasureModel.getListLayout().then(function(measures){return ArrayUtil.copy(measures).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}return{findField:findField,findLibraryDimension:findLibraryDimension,findLibraryMeasure:findLibraryMeasure,getSortedFields:getSortedFields,getSortedDimensions:getSortedDimensions,getSortedMeasures:getSortedMeasures}}),define("objects.utils/data-properties/hypercube-handler",["./data-property-handler","core.utils/deferred","objects.utils/data-properties/library-utils","general.utils/array-util","util"],function(DataPropertyHandler,Deferred,libraryUtils,arrayUtils,util){"use strict";var HyperCubeHandler,TOTAL_MAX_DIMENSIONS=1e3,TOTAL_MAX_MEASURES=1e3;return HyperCubeHandler=DataPropertyHandler.extend({init:function(dimensionDefinition,measureDefinition,dimensionProperties,measureProperties){this._super(dimensionDefinition,measureDefinition,dimensionProperties,measureProperties)},setProperties:function(properties){properties.qHyperCubeDef&&(this._super(properties),this.hcProperties=properties.qHyperCubeDef,this.hcProperties.qDimensions||(this.hcProperties.qDimensions=[]),this.hcProperties.qMeasures||(this.hcProperties.qMeasures=[]),this.hcProperties.qInterColumnSortOrder||(this.hcProperties.qInterColumnSortOrder=[]),this.hcProperties.qLayoutExclude||(this.hcProperties.qLayoutExclude={}),this.hcProperties.qLayoutExclude.qHyperCubeDef||(this.hcProperties.qLayoutExclude.qHyperCubeDef={}),this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions=[]),this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures=[]),this.hcProperties.qDimensions.forEach(function(dimension){void 0!==dimension.autoSort&&(dimension.qDef.autoSort=dimension.autoSort,delete dimension.autoSort)}),this.hcProperties.qMeasures.forEach(function(measure){void 0!==measure.autoSort&&(measure.qDef.autoSort=measure.autoSort,delete measure.autoSort)}))},getDimensions:function(){return this.hcProperties?this.hcProperties.qDimensions:[]},getMeasures:function(){return this.hcProperties?this.hcProperties.qMeasures:[]},getSorting:function(){return this.hcProperties.qInterColumnSortOrder},addDimension:function(dimension){var dimensions=this.getDimensions(),self=this;return dimension.qDef.cId||(dimension.qDef.cId=util.generateId()),dimensions.length<this.maxDimensions()?(dimensions.push(dimension),this.autoSortDimension(dimension).then(function(){return arrayUtils.indexAdded(self.hcProperties.qInterColumnSortOrder,dimensions.length-1),"function"==typeof self.dimensionDefinition.add?Deferred.when(self.dimensionDefinition.add.call(self,dimension,self.properties,self)).then(function(){return dimension}):dimension})):dimensions.length<TOTAL_MAX_DIMENSIONS?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.push(dimension),Deferred.resolve(dimension)):void 0},addMeasure:function(measure){var measures=this.getMeasures(),self=this;return measure.qDef.cId||(measure.qDef.cId=util.generateId()),delete measure.qDef.qNumFormat,measures.length<this.maxMeasures()?(measures.push(measure),this.autoSortMeasure(measure).then(function(){return arrayUtils.indexAdded(self.hcProperties.qInterColumnSortOrder,self.getDimensions().length+measures.length-1),"function"==typeof self.measureDefinition.add?Deferred.when(self.measureDefinition.add.call(null,measure,self.properties,self)).then(function(){return measure}):measure})):measures.length<TOTAL_MAX_MEASURES?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(measure),Deferred.resolve(measure)):void 0},replaceDimension:function(index,dimension){var dimensions=this.getDimensions(),oldDimension=dimensions[index],self=this;return this.autoSortDimension(dimension).then(function(){return dimension.qDef.cId=util.generateId(),dimensions[index]=dimension,"function"==typeof self.dimensionDefinition.replace&&self.dimensionDefinition.replace.call(null,dimension,oldDimension,index,self.properties,self),dimension})},replaceMeasure:function(index,measure){var measures=this.getMeasures(),oldMeasure=measures[index],self=this;return this.autoSortMeasure(measure).then(function(){return measure.qDef.cId=util.generateId(),measures[index]=measure,"function"==typeof self.measureDefinition.replace&&self.measureDefinition.replace.call(null,measure,oldMeasure,index,self.properties,self),measure})},autoSortDimension:function(dimension){function setAutoSort(fields){fields.forEach(function(field,index){var tags=field.qTags,sortCriterias={qSortByLoadOrder:1};"function"==typeof self.dimensionDefinition.autoSort?self.dimensionDefinition.autoSort(dimension,self.properties,tags,sortCriterias,self):tags&&(tags.contains("$numeric")?sortCriterias.qSortByNumeric=1:(tags.contains("$text")||tags.contains("$ascii"))&&(sortCriterias.qSortByAscii=1)),dimension.qDef.qSortCriterias[index]=sortCriterias})}var self=this;return dimension.qLibraryId?libraryUtils.findLibraryDimension(dimension.qLibraryId).then(function(libDim){return libDim&&setAutoSort(libDim.qData.info),dimension}):libraryUtils.findField(dimension.qDef.qFieldDefs[0]).then(function(field){return field&&setAutoSort([field]),dimension})},autoSortMeasure:function(measure){return measure.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},Deferred.resolve(measure)},removeDimension:function(idx){var dimension,dimensions=this.getDimensions();if(idx<dimensions.length){if(dimension=this.hcProperties.qDimensions.splice(idx,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length?dimensions.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(0,1)[0]):arrayUtils.indexRemoved(this.hcProperties.qInterColumnSortOrder,idx),"function"==typeof this.dimensionDefinition.remove)return Deferred.when(this.dimensionDefinition.remove.call(null,dimension,this.properties,this,idx))}else dimension=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(idx-dimensions.length,1);return Deferred.resolve(dimension)},removeMeasure:function(idx){var measure,measures=this.getMeasures();if(idx<measures.length){if(measure=this.hcProperties.qMeasures.splice(idx,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length?measures.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(0,1)[0]):arrayUtils.indexRemoved(this.hcProperties.qInterColumnSortOrder,this.getDimensions().length+idx),"function"==typeof this.measureDefinition.remove)return Deferred.when(this.measureDefinition.remove.call(null,measure,this.properties,this,idx))}else measure=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(idx-measures.length,1)[0];return Deferred.resolve(measure)},moveDimension:function(fromIndex,toIndex){var disabledFromIdx,disabledToIdx,dimension,dimensions=this.getDimensions(),disabledDimensions=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;return fromIndex<dimensions.length&&toIndex<dimensions.length?arrayUtils.move(dimensions,fromIndex,toIndex):fromIndex<dimensions.length&&toIndex>=dimensions.length?(disabledToIdx=toIndex-dimensions.length,dimension=disabledDimensions.splice(0,1)[0],dimensions.push(dimension),dimension=dimensions.splice(fromIndex,1)[0],disabledDimensions.splice(disabledToIdx,0,dimension)):fromIndex>=dimensions.length&&toIndex<dimensions.length?(disabledFromIdx=fromIndex-dimensions.length,dimension=dimensions.splice(dimensions.length-1,1)[0],disabledDimensions.splice(0,0,dimension),dimension=disabledDimensions.splice(disabledFromIdx+1,1)[0],dimensions.splice(toIndex,0,dimension)):(disabledFromIdx=fromIndex-dimensions.length,disabledToIdx=toIndex-dimensions.length,arrayUtils.move(disabledDimensions,disabledFromIdx,disabledToIdx)),Deferred.resolve(dimension)},moveMeasure:function(fromIndex,toIndex){var disabledFromIdx,disabledToIdx,measure,measures=this.getMeasures(),disabledMeasures=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;return fromIndex<measures.length&&toIndex<measures.length?arrayUtils.move(measures,fromIndex,toIndex):fromIndex<measures.length&&toIndex>=measures.length?(disabledToIdx=toIndex-measures.length,measure=disabledMeasures.splice(0,1)[0],measures.push(measure),measure=measures.splice(fromIndex,1)[0],disabledMeasures.splice(disabledToIdx,0,measure)):fromIndex>=measures.length&&toIndex<measures.length?(disabledFromIdx=fromIndex-measures.length,measure=measures.splice(measures.length-1,1)[0],disabledMeasures.splice(0,0,measure),measure=disabledMeasures.splice(disabledFromIdx+1,1)[0],measures.splice(toIndex,0,measure)):(disabledFromIdx=fromIndex-measures.length,disabledToIdx=toIndex-measures.length,arrayUtils.move(disabledMeasures,disabledFromIdx,disabledToIdx)),Deferred.resolve(measure)},changeSorting:function(fromIdx,toIdx){arrayUtils.move(this.hcProperties.qInterColumnSortOrder,fromIdx,toIdx)},setSorting:function(ar){ar&&ar.length===this.hcProperties.qInterColumnSortOrder.length&&(this.hcProperties.qInterColumnSortOrder=ar)}})}),define("objects.utils/data-properties/listobject-handler",["core.utils/deferred","./data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util"],function(Deferred,DataPropertyHandler,listObjectUtil,libraryUtils,util){"use strict";var ListObjectHandler=DataPropertyHandler.extend({init:function(dimensionDefinition,dimensionProperties){this._super(dimensionDefinition,null,dimensionProperties,null)},minDimensions:function(){return 1},maxDimensions:function(){return 1},minMeasures:function(){return 0},maxMeasures:function(){return 0},autoSortDimension:function(dimension){return listObjectUtil.autoSortDimension(dimension)},getDimensions:function(){var def=this.properties.qListObjectDef.qDef;return def&&def.qFieldDefs&&def.qFieldDefs.length||this.properties.qListObjectDef.qLibraryId?[this.properties.qListObjectDef]:[]},addDimension:function(dimension){function setDimension(){self.properties.qListObjectDef=util.extend(!0,self.properties.qListObjectDef,dimension),"function"==typeof self.dimensionDefinition.add&&self.dimensionDefinition.add.call(null,dimension,self.properties,self)}var self=this;return dimension.qLibraryId?libraryUtils.findLibraryDimension(dimension.qLibraryId).then(function(libDim){return libDim&&listObjectUtil.autoSortDimension(dimension,libDim.qData.info),setDimension(),dimension}):libraryUtils.findField(dimension.qDef.qFieldDefs[0]).then(function(field){return field&&listObjectUtil.autoSortDimension(dimension,[field]),setDimension(),dimension})},replaceDimension:function(index,dimension){var self=this,newDef=util.extend(!0,this.properties.qListObjectDef,dimension);return listObjectUtil.autoSortDimension(dimension),dimension.qLibraryId?(delete newDef.qDef.qFieldDefs,delete newDef.qDef.qFieldLabels):delete newDef.qLibraryId,self.properties.qListObjectDef=newDef,Deferred.resolve(dimension)},removeDimension:function(){},getDimensionLayouts:function(){return[this.getDimensionLayout()]},getDimensionLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qDimensionInfo?this.layout.qListObject.qDimensionInfo:""},getMeasures:function(){return this.properties.qListObjectDef.qExpressions},getMeasureLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qExpressions&&this.layout.qListObject.qExpressions[0]?this.layout.qListObject.qExpressions[0].qExpr:""}});return ListObjectHandler}),define("text!objects.extension/default-template.ng.html",[],function(){return'<div qv-extension style="height: 100%; position: relative;"></div>\r\n'}),define("client.models/undo-info",["core.models/session-object","core.utils/deferred","core.models/app"],function(SessionObject,Deferred,App){"use strict";var UndoInfo;return UndoInfo=SessionObject.extend("UndoInfo",{getLayout:function(){return this._super().then(function(layout){return layout.qUndoInfo})},undo:function(){return this.layout.qUndoInfo.qUndoCount>0?App.current.rpc("Undo"):Deferred.resolve()},redo:function(){return this.layout.qUndoInfo.qRedoCount>0?App.current.rpc("Redo"):Deferred.resolve()},reset:function(){return this.getLayout().then(function(layout){return layout.qUndoCount||layout.qRedoCount?App.current.rpc("ClearUndoBuffer"):Deferred.resolve()})}}),UndoInfo.get=function(app){return app=app||App.current,SessionObject.get.call(this,{qInfo:{qType:"UndoInfo"},qUndoInfoDef:{}},app).then(function(ui){return ui.app=app,ui})},UndoInfo}),define("objects.snapshot/snapshot-helper",["jquery","util","qvangular","client.models/snapshot","core.utils/deferred","client.utils/state","client.models/undo-info"],function($,util,qvangular,SnapshotModel,Deferred,State,UndoInfoModel){function showLimitReachedDialog(){var dialog=qvangular.getService("$delayedModal"),options=util.extend(!0,{},{},{title:"Storytelling.Snapshot.MaxLimitReached.Title",html:'<p class="dm-p" q-translation="Storytelling.Snapshot.MaxLimitReached.Text"></p>'});dialog.open(options)}function allowSnapshot(objectId){var allowed=!lastSnapshottedObject||lastSnapshottedObject!==objectId;return allowed&&(lastSnapshottedObject=objectId,setTimeout(function(){lastSnapshottedObject=null},snapshotSpeedLimit)),allowed}function createSnapshot($scope,object,event,options){var layout=object.layout,objectId=layout.qInfo.qId;if(allowSnapshot(objectId)){var objectElem=$(event.target).parents(".qv-object");prepSnapshotData(layout,object,!0,options).then(function(snapshotLayout){saveSnapshot($scope,object,objectElem,snapshotLayout)})}}function prepSnapshotData(layout,object,creatingNewSnapshot,options){var def=new Deferred,date=new Date,snapshotLayout=creatingNewSnapshot?util.extend(!0,{},layout):layout;return prepareStaticContent(object,snapshotLayout).then(function(){snapshotLayout.snapshotData={object:{size:object.objectSize}},object.setSnapshotData(snapshotLayout,options||{}).then(function(){if(creatingNewSnapshot){delete snapshotLayout.qInfo,snapshotLayout.visualizationType=layout.qInfo.qType,snapshotLayout.sourceObjectId=layout.qInfo.qId,snapshotLayout.sheetId=State.model.id,snapshotLayout.timestamp=date.getTime(),snapshotLayout.isClone=!1,snapshotLayout.qMetaDef={title:layout.title};var sheetPanel=$(".qv-panel-sheet");snapshotLayout.snapshotData.parent={h:sheetPanel.height(),w:sheetPanel.width()}}else snapshotLayout.snapshotData.object.origDataPages=object.model.layout.snapshotData.object.origDataPages,snapshotLayout.snapshotData.content&&(snapshotLayout.snapshotData.content.chartData=util.extend(!0,{},object.model.layout.snapshotData.content.chartData));def.resolve(snapshotLayout)})}),def.promise}function saveSnapshot($scope,object,objectElem,layout){var snapshotObj=object.ext.snapshot;SnapshotModel.Snapshot.create(layout).then(function(belowLimit){belowLimit?(snapshotObj.animate(objectElem),$scope&&snapshotObj.updateCount($scope)):showLimitReachedDialog(),UndoInfoModel.get().then(function(ui){ui.reset()})})}function prepareStaticContent(object,snapshotLayout){function replaceStaticContentUrls(){layoutUrls.forEach(function(prop,index){util.extend(!0,prop,propertiesUrls[index])})}function prepArray(urlArray,matchProp,obj,removeAndInsert){for(var prop in obj)obj.hasOwnProperty(prop)&&"qHyperCube"!==prop&&"qHyperCubeDef"!==prop&&(prop===matchProp?(removeAndInsert&&(delete obj[prop],obj.qStaticContentUrlDef={}),urlArray.push(obj.qStaticContentUrlDef)):"object"==typeof obj[prop]&&prepArray(urlArray,matchProp,obj[prop],removeAndInsert))}var layoutUrls=[],propertiesUrls=[],def=new Deferred;return object.model.getProperties().then(function(props){prepArray(layoutUrls,"qStaticContentUrl",snapshotLayout,!0),prepArray(propertiesUrls,"qStaticContentUrlDef",props),replaceStaticContentUrls(),def.resolve(snapshotLayout)}),def.promise}var snapshotSpeedLimit=1e3,lastSnapshottedObject=null;return{createSnapshot:createSnapshot,prepSnapshotData:prepSnapshotData,prepareStaticContent:prepareStaticContent}}),define("objects.extension/export-format",[],function(){"use strict";function ExportFormat(nDataGroups){nDataGroups=void 0!==nDataGroups?nDataGroups:1,this.data=[];for(var i=0;nDataGroups>i;++i)this.data.push({dimensions:[],measures:[]});this.properties={}}return ExportFormat}),define("objects.extension/object-conversion",["util","objects.extension/export-format","general.utils/array-util","general.utils/property-resolver","translator"],function(util,ExportFormat,arrayUtils,propertyResolver,translator){function moveDefaultIfExist(propName,source,target){source.hasOwnProperty(propName)&&(target[propName]=source[propName])}function moveOrSetDefault(propName,source,target,defaultValue){source.hasOwnProperty(propName)?target[propName]=source[propName]:target[propName]=defaultValue}function importCommonProperties(newProperties,exportedFmt,initialProperties){"masterobject"===exportedFmt.properties.qInfo.qType?newProperties.qInfo.qType="masterobject":newProperties.qInfo.qType=initialProperties.qInfo.qType,newProperties.visualization=initialProperties.visualization}function changeProperty(propertyPath,newValue,object){var properties=object.qProperty,propExcluded=object.qProperty.qLayoutExclude;return/boolean|number|string/.test(typeof newValue)?(propExcluded&&(propExcluded.changed||(propExcluded.changed={}),propExcluded.changed[propertyPath]={from:propertyResolver.getValue(properties,propertyPath),to:newValue}),void propertyResolver.setValue(properties,propertyPath,newValue)):void propertyResolver.setValue(properties,propertyPath,newValue)}function restoreChangedProperties(tree){for(var propertyPath in tree.qLayoutExclude.changed)tree.qLayoutExclude.changed[propertyPath].to===propertyResolver.getValue(tree,propertyPath)&&propertyResolver.setValue(tree,propertyPath,tree.qLayoutExclude.changed[propertyPath].from)}function quarantineProperty(propertyPath,object,objectType){var stringified,depth,properties=object.properties,propExcluded=object.properties.qLayoutExclude,value=propertyResolver.getValue(properties,propertyPath);if(!/boolean|number|string/.test(typeof value))try{if(stringified=JSON.stringify(value),depth=stringified.match(/:\{/g),depth=depth?depth.length:0,depth>2)return;value=JSON.parse(stringified)}catch(e){return}propExcluded||(object.properties.qLayoutExclude={quarantine:{}},propExcluded=object.properties.qLayoutExclude),propExcluded.quarantine||(propExcluded.quarantine={}),propExcluded.quarantine[objectType]||(propExcluded.quarantine[objectType]={}),propExcluded.quarantine[objectType][propertyPath]=value}function unquarantineObject(tree,id){var p,props=tree.qLayoutExclude?tree.qLayoutExclude.quarantine:{};if(!props[id])return!1;props=props[id];for(p in props)propertyResolver.setValue(tree,p,props[p]);return delete tree.qLayoutExclude.quarantine[id],!0}var hypercube,listbox,colorChart,axisChart,pivotChart,other,MAX_SAFE_INTEGER=Math.pow(2,53)-1;return hypercube={exportProperties:function(propertyTree){var i,key,propName,exportFmt=new ExportFormat,properties=propertyTree.qProperty,hcd=properties.qHyperCubeDef,dataGroup=exportFmt.data[0];
for(i=0;i<hcd.qDimensions.length;++i)dataGroup.dimensions.push(hcd.qDimensions[i]);if(hcd.qLayoutExclude&&hcd.qLayoutExclude.qHyperCubeDef&&hcd.qLayoutExclude.qHyperCubeDef.qDimensions)for(i=0;i<hcd.qLayoutExclude.qHyperCubeDef.qDimensions.length;++i)dataGroup.dimensions.push(hcd.qLayoutExclude.qHyperCubeDef.qDimensions[i]);for(i=0;i<hcd.qMeasures.length;++i)dataGroup.measures.push(hcd.qMeasures[i]);if(hcd.qLayoutExclude&&hcd.qLayoutExclude.qHyperCubeDef&&hcd.qLayoutExclude.qHyperCubeDef.qMeasures)for(i=0;i<hcd.qLayoutExclude.qHyperCubeDef.qMeasures.length;++i)dataGroup.measures.push(hcd.qLayoutExclude.qHyperCubeDef.qMeasures[i]);delete hcd.qLayoutExclude;for(key in properties)exportFmt.properties[key]=properties[key];if(properties.qLayoutExclude||(properties.qLayoutExclude={}),properties.qLayoutExclude.disabled){for(key in properties.qLayoutExclude.disabled)propName=key,exportFmt.properties.hasOwnProperty(propName)||(exportFmt.properties[propName]=properties.qLayoutExclude.disabled[key]);delete properties.qLayoutExclude.disabled}return properties.qLayoutExclude.changed&&(restoreChangedProperties(properties),delete properties.qLayoutExclude.changed),(!properties.qLayoutExclude.quarantine||util.isEmpty(properties.qLayoutExclude.quarantine))&&delete properties.qLayoutExclude,exportFmt},importProperties:function(exportedFmt,initialProperties,ext){var key,i,nCols,newPropertyTree={qChildren:[]},newProperties={},dataGroup=exportedFmt.data[0],measureDef=ext.data&&ext.data.measures;measureDef||(measureDef=ext.definition&&ext.definition.items&&ext.definition.items.measures||{max:0});var maxMeasures="function"==typeof measureDef.max?measureDef.max(dataGroup.dimensions.length):isNaN(measureDef.max)?MAX_SAFE_INTEGER:measureDef.max,dimensionDef=ext.data&&ext.data.dimensions;dimensionDef||(dimensionDef=ext.definition&&ext.definition.items&&ext.definition.items.dimensions||{max:0});var maxDimensions="function"==typeof dimensionDef.max?dimensionDef.max(maxMeasures):isNaN(dimensionDef.max)?MAX_SAFE_INTEGER:dimensionDef.max;newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.disabled={},newProperties.qLayoutExclude.quarantine={};for(key in exportedFmt.properties)"qLayoutExclude"===key?exportedFmt.properties[key].quarantine&&(newProperties.qLayoutExclude.quarantine=util.extend(!0,{},exportedFmt.properties[key].quarantine)):initialProperties.hasOwnProperty(key)||"qMetaDef"===key?newProperties[key]=exportedFmt.properties[key]:newProperties.qLayoutExclude.disabled[key]=exportedFmt.properties[key];for(newProperties=util.extend(!0,{},initialProperties,newProperties),newProperties.qHyperCubeDef.qDimensions.length=0,newProperties.qHyperCubeDef.qMeasures.length=0,(dataGroup.dimensions.length>maxDimensions||dataGroup.measures.length>maxMeasures)&&(newProperties.qHyperCubeDef.qLayoutExclude||(newProperties.qHyperCubeDef.qLayoutExclude={}),newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef||(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef={}),dataGroup.dimensions.length>maxDimensions&&(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions||(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions=[])),dataGroup.measures.length>maxMeasures&&(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures||(newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]))),i=0;i<dataGroup.dimensions.length;++i)dataGroup.dimensions[i].qDef.hasOwnProperty("othersLabel")||(dataGroup.dimensions[i].qDef.othersLabel=translator.get("properties.dimensionLimits.others"));for(i=0;i<dataGroup.dimensions.length;++i)newProperties.qHyperCubeDef.qDimensions.length<maxDimensions?newProperties.qHyperCubeDef.qDimensions.push(dataGroup.dimensions[i]):newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(dataGroup.dimensions[i]);for(i=0;i<dataGroup.measures.length;++i)newProperties.qHyperCubeDef.qMeasures.length<maxMeasures?newProperties.qHyperCubeDef.qMeasures.push(dataGroup.measures[i]):newProperties.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(dataGroup.measures[i]);for(nCols=newProperties.qHyperCubeDef.qDimensions.length+newProperties.qHyperCubeDef.qMeasures.length,newProperties.qHyperCubeDef.qInterColumnSortOrder||(newProperties.qHyperCubeDef.qInterColumnSortOrder=[]),i=newProperties.qHyperCubeDef.qInterColumnSortOrder.length;i!==nCols;)nCols>i?(arrayUtils.indexAdded(newProperties.qHyperCubeDef.qInterColumnSortOrder,i),++i):(--i,arrayUtils.indexRemoved(newProperties.qHyperCubeDef.qInterColumnSortOrder,i));return moveDefaultIfExist("qAlwaysFullyExpanded",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qMaxStackedCells",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qSuppressZero",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qSuppressMissing",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveDefaultIfExist("qNoOfLeftDims",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef),moveOrSetDefault("qInitialDataFetch",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef,[{qTop:0,qLeft:0,qWidth:0,qHeight:0}]),moveOrSetDefault("qMode",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef,"S"),moveOrSetDefault("qReductionMode",initialProperties.qHyperCubeDef,newProperties.qHyperCubeDef,"N"),importCommonProperties(newProperties,exportedFmt,initialProperties),newPropertyTree.qProperty=newProperties,newPropertyTree}},listbox={exportProperties:function(propertyTree){var i,key,propName,exportFmt=new ExportFormat,properties=propertyTree.qProperty,lo=properties.qListObjectDef,dataGroup=exportFmt.data[0];if(dataGroup.dimensions.push({qLibraryId:lo.qLibraryId,qDef:lo.qDef,title:lo.title}),lo.qLayoutExclude&&lo.qLayoutExclude.qHyperCubeDef&&lo.qLayoutExclude.qHyperCubeDef.qDimensions)for(i=0;i<lo.qLayoutExclude.qHyperCubeDef.qDimensions.length;++i)dataGroup.dimensions.push(lo.qLayoutExclude.qHyperCubeDef.qDimensions[i]);if(lo.qLayoutExclude&&lo.qLayoutExclude.qHyperCubeDef&&lo.qLayoutExclude.qHyperCubeDef.qMeasures)for(i=0;i<lo.qLayoutExclude.qHyperCubeDef.qMeasures.length;++i)dataGroup.measures.push(lo.qLayoutExclude.qHyperCubeDef.qMeasures[i]);delete lo.qLayoutExclude;for(key in properties)exportFmt.properties[key]=properties[key];if(properties.qLayoutExclude&&properties.qLayoutExclude._disabled){for(key in properties.qLayoutExclude._disabled)propName="_"===key.substr(0,1)?key.substring(1):key,exportFmt.properties.hasOwnProperty(propName)||(exportFmt.properties[propName]=properties.qLayoutExclude.disabled[key]);delete properties.qLayoutExclude.disabled}for(i=0;i<dataGroup.dimensions[0].qDef.qSortCriterias.length;++i)dataGroup.dimensions[0].qDef.qSortCriterias[i].qSortByFrequency=0;return exportFmt},importProperties:function(exportedFmt,initialProperties){var key,i,newPropertyTree={qChildren:[]},newProperties={},dataGroup=exportedFmt.data[0],maxDimensions=1;newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.disabled={};for(key in exportedFmt.properties)"qLayoutExclude"===key?exportedFmt.properties[key].quarantine&&(newProperties.qLayoutExclude.quarantine=util.extend(!0,{},exportedFmt.properties[key].quarantine)):initialProperties.hasOwnProperty(key)||"qMetaDef"===key?newProperties[key]=exportedFmt.properties[key]:newProperties.qLayoutExclude.disabled[key]=exportedFmt.properties[key];for(newProperties=util.extend(!0,{},initialProperties,newProperties),newProperties.qListObjectDef.qLayoutExclude||(newProperties.qListObjectDef.qLayoutExclude={}),newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef||(newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef={}),newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions||(newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions=[]),newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures||(newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]),i=0;i<dataGroup.dimensions.length;++i)maxDimensions>i?(newProperties.qListObjectDef.qDef=dataGroup.dimensions[i].qDef,newProperties.qListObjectDef.qLibraryId=dataGroup.dimensions[i].qLibraryId):newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(dataGroup.dimensions[i]);for(i=0;i<dataGroup.measures.length;++i)newProperties.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(dataGroup.measures[i]);return newProperties.qListObjectDef.qInitialDataFetch=initialProperties.qListObjectDef.qInitialDataFetch,importCommonProperties(newProperties,exportedFmt,initialProperties),newPropertyTree.qProperty=newProperties,newPropertyTree}},colorChart={importProperties:function(exportedFmt,initialProperties,definition){var propTree=this.hypercube.importProperties(exportedFmt,initialProperties,definition),visualization=propertyResolver.getValue(propTree,"qProperty.visualization"),dimensions=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qDimensions",[]),numMeasures=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qMeasures",[]).length,attributeExps=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]),colorExps=propertyResolver.getValue(propTree,"qProperty.color.colorExpression",""),colorMode=propertyResolver.getValue(propTree,"qProperty.color.mode",""),isPersistent=propertyResolver.getValue(propTree,"qProperty.color.persistent",!1);return numMeasures&&(attributeExps.splice(0,0,{qExpression:colorExps,type:"colorByExpression"}),propertyResolver.setValue(propTree,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",attributeExps)),("scatterplot"===visualization||numMeasures>1)&&"byMeasure"===colorMode&&propertyResolver.setValue(propTree,"qProperty.color.mode","primary"),dimensions.length>1&&!isPersistent&&changeProperty("color.persistent",!0,propTree),dimensions.forEach(function(d){"qTotalMode"in d.qOtherTotalSpec&&delete d.qOtherTotalSpec.qTotalMode,"qGlobalOtherGrouping"in d.qOtherTotalSpec&&delete d.qOtherTotalSpec.qGlobalOtherGrouping}),propTree},exportProperties:function(propertyTree){var expFormat=this.hypercube.exportProperties(propertyTree),index=-1,attributeExps=propertyResolver.getValue(expFormat,"properties.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]);return attributeExps.every(function(element,i){"colorByExpression"===element.type&&(index=i)}),index>=0&&attributeExps.splice(index,1),expFormat}},axisChart={importProperties:function(exportedFmt,initialProperties,definition){var temp,index,propTree=this.colorChart.importProperties.apply(this,[exportedFmt,initialProperties,definition]),props=propTree.qProperty;if(initialProperties.measureAxis&&"undefined"==typeof initialProperties.measureAxis.autoMinMax?unquarantineObject(props,"unsupportedAutoMinMax")||util.extend(props.measureAxis,initialProperties.measureAxis):unquarantineObject(props,"supportedAutoMinMax")||util.extend(props.measureAxis,initialProperties.measureAxis),exportedFmt.properties.measureAxes&&!initialProperties.measureAxes&&initialProperties.measureAxis&&"undefined"!=typeof initialProperties.measureAxis.autoMinMax){var measuresPerAxis=[];if(props.qHyperCubeDef.qMeasures.length>0&&props.qHyperCubeDef.qMeasures.forEach(function(measure){measure.qDef.series&&(measuresPerAxis[measure.qDef.series.axis]||(measuresPerAxis[measure.qDef.series.axis]={axis:measure.qDef.series.axis,type:{line:0,marker:0,bar:0,total:0}}),["bar","marker","line"].contains(measure.qDef.series.type)&&measuresPerAxis[measure.qDef.series.axis].type[measure.qDef.series.type]++,measuresPerAxis[measure.qDef.series.axis].type.total++)}),measuresPerAxis.length){var type="barchart"===initialProperties.visualization?"bar":"linechart"===initialProperties.visualization?"line":"";type&&(temp=measuresPerAxis.filter(function(m){return m.type[type]>0}).sort(function(a,b){return b.type[type]-a.type[type]})),temp&&temp.length||(temp=measuresPerAxis.sort(function(a,b){return b.type.total-a.type.total})),temp&&temp[0]&&util.extend(props.measureAxis,exportedFmt.properties.measureAxes[temp[0].axis])}else util.extend(props.measureAxis,exportedFmt.properties.measureAxes[0])}return props.qHyperCubeDef.qDimensions.length>1&&(index=props.qHyperCubeDef.qInterColumnSortOrder.indexOf(0),0!==index&&(temp=props.qHyperCubeDef.qInterColumnSortOrder[0],props.qHyperCubeDef.qInterColumnSortOrder[0]=0,props.qHyperCubeDef.qInterColumnSortOrder[index]=temp)),propTree},exportProperties:function(propertyTree){var exportedFmt=this.colorChart.exportProperties.apply(this,[propertyTree]);return"gauge"===exportedFmt.properties.visualization?(quarantineProperty("measureAxis.min",exportedFmt,"unsupportedAutoMinMax"),quarantineProperty("measureAxis.max",exportedFmt,"unsupportedAutoMinMax")):(quarantineProperty("measureAxis.min",exportedFmt,"supportedAutoMinMax"),quarantineProperty("measureAxis.max",exportedFmt,"supportedAutoMinMax")),exportedFmt}},pivotChart={importProperties:function(exportedFmt,initialProperties,definition){var i,lastPivotSortOrder,propTree=this.hypercube.importProperties(exportedFmt,initialProperties,definition),dimensions=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qDimensions",[]),numDimensions=dimensions.length,numMeasures=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qMeasures",[]).length,interColSortOrder=propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),restoreNoOfLeftDims=!0;numDimensions+numMeasures===interColSortOrder.length&&propertyResolver.setValue(propTree,"qProperty.qLayoutExclude.quarantine.interColSortOrder",interColSortOrder);var pivotInterColSortOrder=propertyResolver.getValue(propTree,"qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder");if(pivotInterColSortOrder&&(interColSortOrder=pivotInterColSortOrder,lastPivotSortOrder=pivotInterColSortOrder.slice(),propertyResolver.setValue(propTree,"qProperty.qHyperCubeDef.qInterColumnSortOrder",interColSortOrder),delete propTree.qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder),numDimensions>interColSortOrder.length)for(i=interColSortOrder.length;numDimensions>i;i++)interColSortOrder.indexOf(i)<0&&interColSortOrder.push(i);for(i=interColSortOrder.length-1;i>=0;i--)interColSortOrder[i]>=numDimensions&&interColSortOrder.splice(i,1);if(numMeasures>1&&interColSortOrder.indexOf(-1)<0?interColSortOrder.push(-1):2>numMeasures&&interColSortOrder.indexOf(-1)>-1&&interColSortOrder.splice(interColSortOrder.indexOf(-1),1),numDimensions>0&&-1===propertyResolver.getValue(propTree,"qProperty.qHyperCubeDef.qNoOfLeftDims",-1)&&propertyResolver.setValue(propTree,"qProperty.qHyperCubeDef.qNoOfLeftDims",numDimensions),lastPivotSortOrder&&interColSortOrder&&lastPivotSortOrder.length===interColSortOrder.length){for(i=0;i<lastPivotSortOrder.length;i++)if(lastPivotSortOrder[i]!==interColSortOrder[i]){restoreNoOfLeftDims=!1;break}restoreNoOfLeftDims&&unquarantineObject(propTree.qProperty,"noOfLeftDims")}return dimensions.forEach(function(d){"qTotalMode"in d.qOtherTotalSpec||(d.qOtherTotalSpec.qTotalMode="TOTAL_EXPR")}),propTree},exportProperties:function(propertyTree){var expFormat=this.hypercube.exportProperties(propertyTree),hypercube=expFormat.properties.qHyperCubeDef,numDimensions=hypercube.qDimensions.length,numMeasures=hypercube.qMeasures.length,interColSortOrder=hypercube.qInterColumnSortOrder;propertyResolver.setValue(expFormat,"properties.qLayoutExclude.quarantine.pivotInterColSortOrder",interColSortOrder.slice(0)),quarantineProperty("qHyperCubeDef.qNoOfLeftDims",expFormat,"noOfLeftDims");var hypercubeInterColSortOrder=propertyResolver.getValue(expFormat,"properties.qLayoutExclude.quarantine.interColSortOrder");hypercubeInterColSortOrder&&(interColSortOrder=hypercubeInterColSortOrder,propertyResolver.setValue(expFormat,"properties.qHyperCubeDef.qInterColumnSortOrder",interColSortOrder),delete expFormat.properties.qLayoutExclude.quarantine.interColSortOrder);var pseudoIdx=interColSortOrder.indexOf(-1);pseudoIdx>-1&&interColSortOrder.splice(pseudoIdx,1);for(var i=interColSortOrder.length;numDimensions+numMeasures>i;i++)interColSortOrder.length<=i&&interColSortOrder.push(i);return expFormat}},other={importProperties:function(exportedFmt,initialProperties){var key,newPropertyTree={qChildren:[]},newProperties={};newProperties.qLayoutExclude||(newProperties.qLayoutExclude={}),newProperties.qLayoutExclude.disabled={};for(key in exportedFmt.properties)"qLayoutExclude"!==key&&(initialProperties.hasOwnProperty(key)||"qMetaDef"===key?newProperties[key]=exportedFmt.properties[key]:newProperties.qLayoutExclude.disabled[key]=exportedFmt.properties[key]);return newProperties=util.extend(!0,{},initialProperties,newProperties),importCommonProperties(newProperties,exportedFmt,initialProperties),newPropertyTree.qProperty=newProperties,newPropertyTree},exportProperties:function(propertyTree){var key,propName,exportFmt=new ExportFormat,properties=propertyTree.qProperty;for(key in properties)exportFmt.properties[key]=properties[key];if(properties.qLayoutExclude||(properties.qLayoutExclude={}),properties.qLayoutExclude.disabled)for(key in properties.qLayoutExclude.disabled)propName=key,exportFmt.properties.hasOwnProperty(propName)||(exportFmt.properties[propName]=properties.qLayoutExclude.disabled[key]);return delete properties.qLayoutExclude,exportFmt}},{importCommonProperties:importCommonProperties,hypercube:hypercube,listbox:listbox,axisChart:axisChart,colorChart:colorChart,pivotChart:pivotChart,other:other,changeProperty:changeProperty}}),define("client.soft-property-panel/default-explore-properties",["core.utils/theme","general.utils/property-resolver","client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(theme,propertyResolver,propertyLogicModule,hcHelper){var sort,color,colorsAndLegend,presentation,propertyLogic=propertyLogicModule.getLogicFor("explore","default");return sort={translation:"properties.sorting",type:"items",component:"sort",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",icon:"icon-selection-toolbar-selectAlternative",items:{dimensions:{ref:"qHyperCubeDef.qDimensions",type:"items",items:{sortOptions:{component:"radio-list",type:"number",diffs:["qDef.qSortCriterias.0.qSortByExpression","qDef.qSortCriterias.0.qSortByNumeric","qDef.qSortCriterias.0.qSortByAscii"],options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]},setPropertyValue:function(data,value){propertyResolver.setValue(data,"qDef.qSortCriterias.0.qSortByExpression",0),propertyResolver.setValue(data,"qDef.qSortCriterias.0.qSortByNumeric",0),propertyResolver.setValue(data,"qDef.qSortCriterias.0.qSortByAscii",value)},getValue:function(data){return 0===propertyResolver.getValue(data,"qDef.qSortCriterias.0.qSortByExpression",0)&&0===propertyResolver.getValue(data,"qDef.qSortCriterias.0.qSortByNumeric",0)?propertyResolver.getValue(data,"qDef.qSortCriterias.0.qSortByAscii",0):0}}}},measures:{ref:"qHyperCubeDef.qMeasures",type:"items",items:{sortOptions:{component:"radio-list",type:"number",ref:"qSortBy.qSortByNumeric",options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]}}}}}},color={component:"items",translation:"properties.colors",icon:"icon-spray",grouped:!0,items:{mode:{component:"radio-list",type:"string",options:propertyLogic.color.colorMode.options,diffs:["color.mode","color.auto"],setPropertyValue:function(data,v){"auto"===v?data.color.auto=!0:(data.color.auto=!1,data.color.mode=v)},getValue:function(data){return data.color.auto?"auto":data.color.mode}},dimension:{type:"items",show:function(data){return!data.color.auto&&"byDimension"===data.color.mode},items:{colorScheme:{translation:"properties.colorScheme",type:"string",component:"item-selection-list",horizontal:!0,showLabels:!1,ref:"color.dimensionScheme",items:[{colors:theme.colorSchemes.qualitativeScales[0].scale[theme.colorSchemes.qualitativeScales[0].scale.length-1],type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[0].translation||theme.colorSchemes.qualitativeScales[0].name,value:"12"},{colors:theme.colorSchemes.qualitativeScales[1].scale,type:"classes",component:"color-scale",translation:theme.colorSchemes.qualitativeScales[1].translation||theme.colorSchemes.qualitativeScales[1].name,value:"100"}],show:function(data,layout){if(1===hcHelper.getNumDimensions(data)&&hcHelper.getNumMeasures(data)<=1){var dim=hcHelper.getDimensionLayouts(layout)[0];return dim&&dim.qCardinal<=12?!1:!0}return hcHelper.getNumMeasures(data)<=1||hcHelper.getNumMeasures(data)>12}},dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-radio-list",translation:"properties.colorDimensionId",show:!1},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",show:function(data){return hcHelper.getNumMeasures(data)<=1&&hcHelper.getNumDimensions(data)<=1},readOnly:propertyLogic.color.persistentColors.readOnly}}},measure:{type:"items",show:function(data){return!data.color.auto&&"byMeasure"===data.color.mode},items:{sequential:{component:"item-selection-list",translation:"properties.colorScheme",horizontal:!0,showLabels:!1,type:"string",ref:"color.measureScheme",items:[{colors:theme.colorSchemes.ordinalScales[0].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[0].translation||theme.colorSchemes.ordinalScales[0].name,value:"sg"},{colors:theme.colorSchemes.ordinalScales[1].scale[theme.colorSchemes.ordinalScales[1].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[1].translation||theme.colorSchemes.ordinalScales[1].name,value:"sc"},{colors:theme.colorSchemes.ordinalScales[2].scale,type:"gradient",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[2].translation||theme.colorSchemes.ordinalScales[2].name,value:"dg"},{colors:theme.colorSchemes.ordinalScales[3].scale[theme.colorSchemes.ordinalScales[3].scale.length-1],type:"classes",reverse:propertyLogic.helpers.schemeIsReverse,component:"color-scale",translation:theme.colorSchemes.ordinalScales[3].translation||theme.colorSchemes.ordinalScales[3].name,value:"dc"}]}}},legend:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(data,layout){return!data.color.auto&&propertyLogic.legend.show(data,layout)}}}},presentation={translation:"properties.presentation",type:"items",grouped:!0,items:{}},{sort:sort,color:color,colorsAndLegend:colorsAndLegend,presentation:presentation}}),define("objects.extension/default-extension",["jquery","qvangular","core.utils/deferred","objects.backend-api/generic-api","general.utils/property-mapper","objects.utils/data-properties/hypercube-handler","objects.utils/data-properties/listobject-handler","text!./default-template.ng.html","client.models/snapshot","objects.snapshot/snapshot-helper","general.utils/visualizations","objects.utils/data-properties/library-utils","objects.extension/object-conversion","client.soft-property-panel/default-explore-properties"],function($,qvangular,Deferred,GenericApi,propertyMapper,HyperCubeHandler,ListObjectHandler,defaultTemplate,SnapshotModel,SnapshotHelper,visualizations,libraryUtils,objectConversion,defaultSoftProperties){function getDimensionInfo(layout){if(layout.qHyperCube)return layout.qHyperCube.qDimensionInfo||[];if(layout.qChildList){var children=layout.qChildList.qItems||[];return children.map(function(){return{}})}var hasError=!layout.qListObject||!layout.qListObject.qDimensionInfo||layout.qListObject.qDimensionInfo.qError;return hasError?[]:[layout.qListObject.qDimensionInfo]}function getMeasureInfo(layout){return layout.qHyperCube?layout.qHyperCube.qMeasureInfo||[]:[]}function _checkLibraryObjects(exportFormat){var i,j,dim,meas,dfd=Deferred(),dfds=[],changes=[];for(i=0;i<exportFormat.data.length;++i){for(j=0;j<exportFormat.data[i].dimensions.length;++j)dim=exportFormat.data[i].dimensions[j],dim.qLibraryId&&(dfds.push(libraryUtils.findLibraryDimension(dim.qLibraryId)),changes.push(dim));for(j=0;j<exportFormat.data[i].measures.length;++j)meas=exportFormat.data[i].measures[j],meas.qLibraryId&&(dfds.push(libraryUtils.findLibraryDimension(meas.qLibraryId)),changes.push(meas))}return Deferred.all(dfds).then(function(infoArray){for(i=0;i<infoArray.length;++i)infoArray[i]&&(changes[i].title=infoArray[i].qData.title);dfd.resolve()}),dfd.promise}return{BackendApi:GenericApi,template:defaultTemplate,mapProperties:function(){this.mappedDefinition=propertyMapper.mapDefinition(this.definition,this.type),this.globalChangeListeners=propertyMapper.findGlobalListeners(this.mappedDefinition);var dimensionDefinition=this.data&&this.data.dimensions;dimensionDefinition?(dimensionDefinition.min="undefined"!=typeof dimensionDefinition.min?dimensionDefinition.min:1,dimensionDefinition.max="undefined"!=typeof dimensionDefinition.max?dimensionDefinition.max:1e3):this.data||(dimensionDefinition=propertyMapper.findDefinition(this.mappedDefinition,"qHyperCubeDef.qDimensions",!0),dimensionDefinition||(dimensionDefinition=propertyMapper.findDefinition(this.mappedDefinition,"qListObjectDef",!0)),dimensionDefinition&&(dimensionDefinition.obsolete=!0)),this.dimensionDefinition=dimensionDefinition;var measureDefinition=this.data&&this.data.measures;measureDefinition?(measureDefinition.min="undefined"!=typeof measureDefinition.min?measureDefinition.min:1,measureDefinition.max="undefined"!=typeof measureDefinition.max?measureDefinition.max:1):this.data||(measureDefinition=propertyMapper.findDefinition(this.mappedDefinition,"qHyperCubeDef.qMeasures",!0),measureDefinition&&(measureDefinition.obsolete=!0)),this.measureDefinition=measureDefinition},getCreatePropertyHandler:function(){var dimensionProperties,measureProperties,mappedDefinition=this.mappedDefinition;return this.model.layout.qListObject?(dimensionProperties=propertyMapper.mapProperties(this.dimensionDefinition),new ListObjectHandler(this.dimensionDefinition,dimensionProperties)):(this.dimensionDefinition&&this.dimensionDefinition.obsolete?dimensionProperties=propertyMapper.mapProperties(this.dimensionDefinition):this.dimensionDefinition&&(dimensionProperties=propertyMapper.mapProperties(mappedDefinition.items.data.items.dimensions)),this.measureDefinition&&this.measureDefinition.obsolete?measureProperties=propertyMapper.mapProperties(this.measureDefinition):this.measureDefinition&&(measureProperties=propertyMapper.mapProperties(mappedDefinition.items.data.items.measures)),new HyperCubeHandler(this.dimensionDefinition,this.measureDefinition,dimensionProperties,measureProperties))},mapSoftProperties:function(){function collectDiffs(definition){var diffs=[{diffs:definition.ref||definition.sortIndexRef?[definition.ref||definition.sortIndexRef]:definition.diffs||[]}];return definition.items&&Object.keys(definition.items).forEach(function(key){diffs.push({diffs:collectDiffs(definition.items[key])})}),definition._diffs=diffs,diffs}if(this.softDefinition){var mappedDefinition=propertyMapper.mapDefinition(this.softDefinition,null,defaultSoftProperties);collectDiffs(mappedDefinition),this.mappedSoftDefinition=mappedDefinition}},hasError:function(args){var layout=args.layout;return layout.qHyperCube?!!layout.qHyperCube.qError:layout.qListObject?!!layout.qListObject.qError:!1},showRequirements:function(args){var i,minDimensions=args.ext.dimensionDefinition?args.ext.dimensionDefinition.min:0,minMeasures=args.ext.measureDefinition?args.ext.measureDefinition.min:0,dimensions=getDimensionInfo(args.layout),measures=getMeasureInfo(args.layout);if(minDimensions>0&&dimensions.length<minDimensions)return!0;for(i=0;i<dimensions.length;++i)if(dimensions[i].qError)return!0;if(minMeasures>0&&measures.length<minMeasures)return!0;for(i=0;i<measures.length;++i)if(measures[i].qError)return!0;return!1},addFieldDimension:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addFieldDimension(item.value,"").then(function(dimension){qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)})})},addLibraryDimension:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addLibraryDimension(item.libraryId).then(function(dimension){qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)})})},addLibraryMeasure:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addLibraryMeasure(item.libraryId).then(function(measure){qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)})})},addExpressionMeasure:function(item,object){return object.model.getProperties().then(function(props){var handler=object.ext.getCreatePropertyHandler();return handler.setProperties(props),handler.addExpressionMeasure(item.value,"").then(function(measure){qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)})})},getDropFieldOptions:function(builder,propertyHandler,model,showMenu,object){builder.Add(model,propertyHandler,object),builder.ReplaceDimensions(model,propertyHandler,object),builder.AddFieldAsMeasure(model,propertyHandler,object),showMenu()},getDropDimensionOptions:function(builder,propertyHandler,model,showMenu,object){propertyHandler.getDimensions().length<propertyHandler.minDimensions()?propertyHandler.addLibraryDimension(builder.item.id).then(function(dimension){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+dimension.qDef.cId)}):(builder.Add(model,propertyHandler,object),builder.ReplaceDimensions(model,propertyHandler,object),showMenu())},getDropMeasureOptions:function(builder,propertyHandler,model,showMenu,object){propertyHandler.getMeasures().length<propertyHandler.minMeasures()?"expression"===builder.item.type?propertyHandler.addExpressionMeasure(builder.item.name,"").then(function(measure){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)}):propertyHandler.addLibraryMeasure(builder.item.id).then(function(measure){model.save(),qvangular.$rootScope.$broadcast("pp-open-path","data."+measure.qDef.cId)}):(builder.Add(model,propertyHandler,object),builder.ReplaceMeasures(model,propertyHandler,object),showMenu())},getDropTemplateOptions:function(builder,propertyHandler,model,showMenu,object){var that=this,newType=visualizations.getType(builder.item.template),text=["contextMenu.convertTo",builder.item.name];that.type!==newType.type?newType.getExtensionType().then(function(extensionType){!object.isReadonly&&that.exportProperties&&extensionType.importProperties&&builder.menu.addItem({translation:text,tid:"convert",select:function(){that._convert(newType,extensionType,builder.item)}}),showMenu()},function(){showMenu()}):showMenu()},getDropOptions:function(object,builder,showMenu){var item_type,nameMap,fnName,model=object.model,ext=this;return nameMap={field:"getDropFieldOptions",dimension:"getDropDimensionOptions",measure:"getDropMeasureOptions",template:"getDropTemplateOptions",expression:"getDropMeasureOptions"},item_type=builder.item.type,(fnName=nameMap[item_type])?model.getProperties().then(function(props){var propertyHandler=ext.getCreatePropertyHandler();return propertyHandler.setProperties(props),ext[fnName](builder,propertyHandler,model,showMenu,object)}):void showMenu()},_convert:function(newType,extensionType,item){var exported,imported,self=this;Deferred.all({initialProperties:newType.getInitialProperties(item.init),
propertyTree:self.model.getFullPropertyTree()}).then(function(args){try{exported=self.exportProperties(args.propertyTree),_checkLibraryObjects(exported).then(function(){imported=extensionType.importProperties(exported,args.initialProperties,extensionType),self.model.getLayout().then(function(layout){layout.qHasSoftPatches?(self.model.markAsCancelled(),self.model.clearSoftPatches().then(function(){self.model.propertyTree=imported,self.model.saveTree().then(function(){self.model.markAsInvalid()})})):(self.model.propertyTree=imported,self.model.saveTree())})})}catch(e){}})},exportProperties:function(propertyTree){return propertyTree.qProperty.qHyperCubeDef?objectConversion.hypercube.exportProperties(propertyTree):propertyTree.qProperty.qListObjectDef?objectConversion.listbox.exportProperties(propertyTree):objectConversion.other.exportProperties(propertyTree)},importProperties:function(exportedFmt,initialProperties,ext){return initialProperties.qHyperCubeDef?objectConversion.hypercube.importProperties(exportedFmt,initialProperties,ext):initialProperties.qListObjectDef?objectConversion.listbox.importProperties(exportedFmt,initialProperties,ext):objectConversion.other.importProperties(exportedFmt,initialProperties,ext)},snapshot:{canTakeSnapshot:!1,animate:function(elem){elem.append($('<div class="qv-snapshot-tool-flash" />').bind("oanimationend animationend webkitAnimationEnd",function(){$(this).remove()}))},take:function($scope,object,event,options){SnapshotHelper.createSnapshot($scope,object,event,options)},updateCount:function($scope){return SnapshotModel.Snapshot.getSnapshotCount($scope.options.id).then(function(count){return $scope.snapshotCount=count,count})}},options:{},controller:function(){}}}),define("objects.views/selections/cache-item",[],function(){"use strict";function CacheItem(shape,selected,value,parent,index,node,cacheId){if(shape instanceof Array&&!shape[0].pointInside&&!shape.pointInside)throw"The shape must implement a `pointInside` function";this.setShape(shape),this.selected=!!selected,this.value=value,this.parent=parent,this.index=index,this.objectShapes={},node&&(this.parent=node.parent,this.node=node,this.rowIndex=node.data.rowIndex,this.label=node.data.qText,this.id=node.data.qElemNo),cacheId&&shape&&(this.objectShapes[cacheId]=shape instanceof Array?shape:[shape])}return CacheItem.prototype={getShapes:function(id){return(id||0===id)&&this.objectShapes&&this.objectShapes[id]?this.objectShapes[id]:this.shapes?this.shapes:[this.shape]},addShape:function(id,shape){this.objectShapes[id]instanceof Array||(this.objectShapes[id]=[]),this.objectShapes[id].push(shape),this.shapes.push(shape)},setShape:function(shape){this.shape=shape instanceof Array?shape[0]:shape,shape?this.shapes=shape instanceof Array?shape:[shape]:this.shapes=[]},addValue:function(v){void 0===this.value&&(this.value=[]),this.value instanceof Array||(this.value=[this.value]),this.value.push(v)}},CacheItem}),define("objects.extension/default-selection-toolbar",["core.utils/class"],function(Class){"use strict";var SelectionToolbar;return SelectionToolbar=Class.extend("SelectionToolbar",{menuButtons:[],init:function(backendApi,selectionsApi,showMenu,showLock,addBeforeDefaultButtons,menuButtons){this.backendApi=backendApi,this.selectionsApi=selectionsApi,this.showMenu=showMenu,this.showLock=showLock,addBeforeDefaultButtons=addBeforeDefaultButtons||[],this.menuButtons=menuButtons||[];var defaultButtons=[{name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:!0,buttonClass:"clear",iconClass:"icon-toolbar-clearselections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.backendApi.hasSelections()}},{clazz:"sel-toolbar-separator",buttonClass:"sel-toolbar-icon-separator",isDisabled:function(){return!0}}];defaultButtons.push({name:"Tooltip.CancelSelections",tid:"selection-toolbar.undo",isIcon:!1,iconClass:"icon-cancel",buttonClass:"sel-toolbar-cancel",action:function(){this.selectionsApi.cancel()}}),defaultButtons.push({name:"Tooltip.ConfirmSelections",tid:"selection-toolbar.refresh",iconClass:"icon-tick",buttonClass:"sel-toolbar-confirm",action:function(){this.selectionsApi.confirm()},isDisabled:function(){return!this.selectionsApi.selectionsMade}}),this.buttons=addBeforeDefaultButtons.concat(defaultButtons)},hasState:function(states){if(!states)return!0;for(var dimensionInfos=this.backendApi.getDimensionInfos(),i=0;i<dimensionInfos.length;++i)for(var j=0;j<states.length;++j)if(dimensionInfos[i].qStateCounts[states[j]]>0)return!0;return!1}})}),define("objects.extension/default-view",["core.utils/class","qvangular","objects.utils/shapes/rect","objects.views/selections/cache-item","objects.extension/default-selection-toolbar"],function(Class,qvangular,Rect,CacheItem,DefaultSelectionToolbar){"use strict";var DefaultView;return DefaultView=Class.extend("DefaultView",{$scope:null,$element:null,containerRect:null,options:null,selections:null,backendApi:null,activeDimensions:[0],selectedShapes:[],init:function($scope,$element,options,backendApi){this.$scope=$scope,this.$element=$element,this.options=options,this.backendApi=backendApi,this._toggleLasso=!1},on:function(){this.selections&&this.selections.on(),this.selectionsEnabled=!0},off:function(){this.selections&&this.selections.off(),this.selectionsEnabled=!1},prePaint:function(){},suppressOnPaint:function(layout){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):layout.qSelectionInfo&&layout.qSelectionInfo.qInSelections},paint:function(){},updateData:function(){},resize:function($element,layout){return this.paint($element,layout)},destroy:function(){},initialize:function(){this.initSelections()},setSelections:function(selections){this.selections=selections},initSelections:function(){this.selections&&(this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",{rect:new Rect(0,0,this.$element.width(),this.$element.height())}),this.options._disableSelections||(this.selections.Select.bind(function(shapes,toggle){this.onSelect(shapes,toggle)}.bind(this)),this.selections.ToggleShape.bind(function(shape){var index=this.selectedShapes.indexOf(shape);-1!==index?this.selectedShapes.splice(index,1):this.selectedShapes.push(shape),this.onToggleShape(shape)}.bind(this)),this.selections.Deactivated.bind(function(){this.selectedShapes=[]}.bind(this)),this.selections.Clear.bind(function(){this.selectedShapes=[]}.bind(this))))},refreshSelections:function(){this.selections&&(this.containerRect=this.$element[0].getBoundingClientRect(),this.selections.cache.clear())},onToggleShape:function(shape){shape.$element[this.isSelected(shape.value)?"addClass":"removeClass"]("selected")},onSelect:function(shapes,toggle){if(shapes.length){var values=this.selectedShapes.map(function(shape){return shape.value});values.length>0&&this.activeDimensions.length>0?this.backendApi.select(values,this.activeDimensions,toggle):1!==shapes.length||shapes[0].selected||this.backendApi.clearSelections()}},onRangeSelect:function(){},addToSelectionCache:function($element,value){if(this.selections){var cRect=this.containerRect,rect=$element[0].getBoundingClientRect(),item=new CacheItem(new Rect(rect.left-cRect.left,rect.top-cRect.top,rect.right-rect.left,rect.bottom-rect.top),!1,value);item.$element=$element,this.selections.cache.add(item)}},isSelected:function(value){return this.selectedShapes.filter(function(shape){return shape.value===value}).length},getContextMenu:function(){},setSnapshotData:function(){},getViewState:function(){return{}},toggleLasso:function(enabled){qvangular.$apply(function(){this.selections&&(this._toggleLasso=enabled,this.options.lassoEnabled=enabled,this.selections.setLassoEnabled(enabled))}.bind(this))},isLassoing:function(){return this._toggleLasso},getSelectionToolbar:function(){var view=this;return new DefaultSelectionToolbar(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[{name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"icon-toolbar-lasso",action:function(){view.toggleLasso(!view._toggleLasso)},isActive:function(){return this.name=view._toggleLasso?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",view.isLassoing()},isDisabled:function(){return view.isLassoDisabled&&view.isLassoDisabled()?!0:!1}}],[])},setBackendApi:function(backendApi){this.backendApi=backendApi},selectValues:function(qDimNo,qValues,qToggleMode){if(this.selectionsEnabled){if(!this.backendApi.inSelections()){var $scope=this.$scope,self=this;$scope.selectionsApi.confirm=function(){$scope.backendApi.endSelections(!0).then(function(){$scope.selectionsApi.deactivated()})},$scope.selectionsApi.cancel=function(){$scope.backendApi.endSelections(!1),$scope.selectionsApi.deactivated()},$scope.selectionsApi.deactivate=function(){this.deactivated()},$scope.selectionsApi.clear=function(){self.clearSelectedValues(self.$element),$scope.backendApi.clearSelections(),self.selectedArrays={}},this.getSelectionToolbar=function(){return new DefaultSelectionToolbar(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[])},this.backendApi.beginSelections(),$scope.selectionsApi.activated(),$scope.selectionsApi.selectionsMade=!0,this.selectedArrays={}}if(this.selectedArrays[qDimNo]||(this.selectedArrays[qDimNo]=[]),qToggleMode)for(var i=0;i<qValues.length;i++){var pos=this.selectedArrays[qDimNo].indexOf(qValues[i]);-1===pos?this.selectedArrays[qDimNo].push(qValues[i]):this.selectedArrays[qDimNo].splice(pos,1)}else this.selectedArrays[qDimNo]=this.selectedArrays[qDimNo].concat(qValues);this.backendApi.selectValues(qDimNo,this.selectedArrays[qDimNo],!1)}},clearSelectedValues:function($element){$element.find(".selected").removeClass("selected")},onStateChanged:function(){},allowInteraction:function(state){var allow=!1;return state.state!==state.States.analysis&&(state.state!==state.States.play||this.backendApi&&this.backendApi.isSnapshot)||(allow=!0),allow},setInteraction:function(){}})}),define("text!objects/inline-title-edit.ng.html",[],function(){return'<div ng-show="!editing && displayValue == \'\'" class="qv-inline-edit-button">\r\n    <div class="icon-add"></div>\r\n    <div class="add-text" q-translation="{{emptyTranslation}}" q-title-translation="{{emptyTranslation}}"></div>\r\n</div>\r\n<div ng-show="!editing && displayValue != \'\'" class="qv-inline-edit-value">{{displayValue}}</div>\r\n<input ng-show="editing" class="qv-inline-edit-input" type="text" ng-model="titleValue" qv-inline-title-input maxlength="255"/>'}),define("objects/inline-title-edit",["qvangular","angular","core.models/rpc-base","general.utils/property-resolver","text!./inline-title-edit.ng.html"],function(qvangular,angular,RPCBase,propertyResolver,template){"use strict";function getPlainString(value){return"object"==typeof value&&(value=value.qStringExpression.qExpr,"="!==value[0]&&(value="="+value)),value}function getOptStringExpressionObject(value){return value&&0===value.indexOf("=")?{qStringExpression:{qExpr:value}}:value}qvangular.directive("qvInlineTitleInput",[function(){return{priority:1,require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){element.unbind("input keydown change compositionend"),element.bind("blur",function(){scope.$apply(function(){ngModelCtrl.$setViewValue(element.val()),scope.doEdit()})}),element.bind("keydown",function(e){e.stopPropagation(),27===e.which?(element.val(ngModelCtrl.$viewValue),element.trigger("blur")):13===e.which&&"textarea"!==element[0].nodeName.toLowerCase()&&element.trigger("blur")})}}}]),qvangular.directive("qvInlineTitleEdit",["$timeout",function($timeout){return{template:template,restrict:"A",scope:{model:"=",propertyPath:"@",layoutPath:"@",emptyTranslation:"@"},priority:1,link:function($scope,element){var buttonElem=element.children().first(),valueElem=element.children().eq(1),inputElem=element.children().eq(2);$scope.editing=!1,$scope.titleProperty="",$scope.titleValue="",RPCBase.bindLayout($scope,"model",function(layout){$scope.displayValue=propertyResolver.getValue(layout,$scope.layoutPath),$scope.editing=!1}),$scope.doEdit=function(){var newValue=getOptStringExpressionObject($scope.titleValue);$scope.editing&&(angular.equals(oldValue,newValue)?$scope.editing=!1:$scope.model.getProperties().then(function(props){propertyResolver.setValue(props,$scope.propertyPath,newValue),$scope.model.save(),oldValue=newValue}))};var oldValue;buttonElem.add(valueElem).on("qv-activate",function(){$scope.editing||$scope.model.getProperties().then(function(props){var length,nativeInput=inputElem.get(0);$scope.editing=!0,$scope.titleProperty=propertyResolver.getValue(props,$scope.propertyPath),$scope.titleValue=getPlainString($scope.titleProperty),oldValue=$scope.titleProperty,nativeInput.scrollLeft=nativeInput.scrollWidth,length=getPlainString($scope.titleProperty).length,nativeInput.selectionStart=length,nativeInput.selectionEnd=length,$timeout(function(){nativeInput.focus(),nativeInput.setSelectionRange(length,length)})})})}}}])}),define("objects.extension/base-controller",["core.utils/class","objects.extension/default-selection-toolbar"],function(Class,SelectionToolbar){"use strict";var DefaultBaseController;return DefaultBaseController=Class.extend({$scope:null,init:function($scope){this.$scope=$scope},onPaint:function(){},onResize:function(){},onStateChanged:function(){},setInteraction:function(){},setBackendApi:function(){},getContextMenu:function(){},getObjectMenu:function(){},getSelectionToolbar:function(){return new SelectionToolbar(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1)},allowInteraction:function(state){var allow=!1;return state.state!==state.States.analysis&&(state.state!==state.States.play||this.$scope.backendApi&&this.$scope.backendApi.isSnapshot)||(allow=!0),allow}}),DefaultBaseController.$inject=["$scope"],DefaultBaseController}),define("objects.utils/shapes/point",[],function(){"use strict";function Point(x,y){0===arguments.length?this.set(0,0):this.set(x,y)}return Point.prototype={toString:function(){return this.x+" "+this.y},clone:function(){return new Point(this.x,this.y)},set:function(x,y){this.x=x,this.y=y},equal:function(p){return this.x===p.x&&this.y===p.y},closeTo:function(p,d){return p?Math.abs(this.x-p.x)<d&&Math.abs(this.y-p.y)<d:!1},distanceTo:function(point){return point?Math.sqrt(Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2)):NaN}},Point}),define("objects.utils/shapes/polygon",["objects.utils/shapes/rect","objects.utils/shapes/line"],function(Rect,Line){"use strict";function calculateBoundsFromPoints(points){var p,i,xMin=Number.MAX_VALUE,xMax=-Number.MAX_VALUE,yMin=Number.MAX_VALUE,yMax=-Number.MAX_VALUE,numPoints=points?points.length:0;if(!numPoints)return null;for(i=0;numPoints>i;i++)p=points[i],xMax=p.x>xMax?p.x:xMax,xMin=p.x<xMin?p.x:xMin,yMax=p.y>yMax?p.y:yMax,yMin=p.y<yMin?p.y:yMin;return new Rect(xMin,yMin,xMax-xMin,yMax-yMin)}function calculatePolygonFeatures(){this._numPoints=this.points?this.points.length:0,this._closedPolygon=this._numPoints>1&&this.points[0].x===this.points[this._numPoints-1].x&&this.points[0].y===this.points[this._numPoints-1].y,this._closedPolygon?this._numLines=this._numPoints-1:this._numLines=this._numPoints,this._pointsChanged=!0}function Polygon(points){0===arguments.length?this.set([]):this.set(points),this._pointsChanged=!0}return Polygon.prototype={clone:function(){var points=this.points.map(function(point){return point.clone()});return new Polygon(points)},set:function(points){this.points=points,calculatePolygonFeatures.call(this)},getPoints:function(){return this.points},getNumPoints:function(){return this.points?this.points.length:0},addPoint:function(point){this.points.push(point),calculatePolygonFeatures.call(this)},pointInside:function(x,y){if(this.calculateBounds(),!this._bounds)return!1;if(x<this._bounds.x||x>this._bounds.x+this._bounds.width||y<this._bounds.y||y>this._bounds.y+this._bounds.height)return!1;var inside,l,j,i,tx;for(inside=!1,i=-1,l=this.points.length,j=l-1;++i<l;j=i){if(this.points[i].x===x&&this.points[i].y===y)return!0;if(this.points[i].y===this.points[j].y&&this.points[i].y===y&&(x-this.points[i].x)*(x-this.points[j].x)<=0)return!0;if(this.points[i].y<y&&y<=this.points[j].y||this.points[j].y<y&&y<=this.points[i].y){if(tx=(this.points[j].x-this.points[i].x)*(y-this.points[i].y)/(this.points[j].y-this.points[i].y)+this.points[i].x,x===tx)return!0;tx>x&&(inside=!inside)}}return inside},intersectsLine:function(line){if(!line)return!1;if(this.pointInside(line.x1,line.y1)||this.pointInside(line.x2,line.y2))return!0;var i,num;if(0===this._numPoints)return!1;if(1===this._numPoints)return line.intersectsLine(new Line(this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y))?!0:!1;for(num=this._numPoints-1,i=0;num>i;i++)if(line.intersectsLine(new Line(this.points[i].x,this.points[i].y,this.points[i+1].x,this.points[i+1].y)))return!0;return!this._closedPolygon&&line.intersectsLine(new Line(this.points[num].x,this.points[num].y,this.points[0].x,this.points[0].y))?!0:!1},intersectsLines:function(lines){var i,numLines=lines?lines.length:0;for(i=0;numLines>i;i++)if(this.intersectsLine(lines[i]))return!0;return!1},intersectsRect:function(rect){if(!rect)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(rect.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(rect))return!1;var x1,x2,y1,y2,lines;return x1=rect.x,x2=rect.getRight(),y1=rect.y,y2=rect.getBottom(),this.pointInside(x1,y1)||this.pointInside(x2,y1)||this.pointInside(x2,y2)||this.pointInside(x1,y2)?!0:(lines=[new Line(x1,y1,x2,y1),new Line(x1,y2,x2,y2),new Line(x1,y1,x1,y2),new Line(x2,y1,x2,y2)],this.intersectsLines(lines))},calculateBounds:function(){return this._pointsChanged&&(this._bounds=calculateBoundsFromPoints(this.points),this._pointsChanged=!1),this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var i,s="",num1=this._numPoints-1;for(i=0;num1>i;i++)s+=this.points[i].toString()+",";return s+=this.points[num1].toString()}},Polygon}),define("objects.views/charts/utils/tree-iterator",[],function(){var iterator={getLevel:function(){if(this&&this.parent!==this){for(var p=this.parent,level=0;p;)level+=1,p=p.parent;return level}},each:function(fn){var i,children=this.children;if(children)for(i=0;i<children.length;i+=1){if(fn&&fn(children[i],i,children.length-1)===!1)return!1;if(iterator.each.call(children[i],fn)===!1)return!1}},getLeaves:function(){if(!this.children||!this.children)return[];var i,nodes=[];for(i=0;i<this.children.length;i+=1)this.children[i]&&this.children[i].children&&this.children[i].children.length?nodes=nodes.concat(iterator.getLeaves.call(this.children[i])):nodes.push(this.children[i]);return nodes}};return iterator}),define("objects.views/charts/utils/cache-utils",[],function(){function getAllCacheItems(array,cacheItems){return array.forEach(function(item){if(item.isCacheItem)cacheItems.push(item);else if(item.data.cacheItem)cacheItems.push(item.data.cacheItem);else if(item.cacheItem&&(cacheItems.push(item.cacheItem),item.cacheItem.isCacheItem))throw"Using new cache item before its time";item.children&&item.children.length>0&&getAllCacheItems.apply(this,[item.children,cacheItems])}),cacheItems}var cacheUtils={getCacheItems:function(){return this.children&&this.children?getAllCacheItems.apply(this,[this.children,[]]):[]}};return cacheUtils}),define("objects.views/selections/types/base",["core.utils/class","objects.utils/shapes/point","objects.views/charts/utils/tree-iterator","objects.views/charts/utils/cache-utils"],function(Class,Point,treeIterator,cacheUtils){"use strict";function getSelectionID(comp){return comp?comp.selectionIdentifier:null}function isNull(item,selectionIndecies){if(selectionIndecies){var check=!1;return selectionIndecies.contains(0)&&(check=item.parent?-2===item.parent.id:-2===item.id),item.parent&&selectionIndecies.contains(1)&&(check=check||-2===item.id),check}return-2===item.id||item.parent&&-2===item.parent.id}function arrRemove(o){var idx=this.indexOf(o);idx>=0&&this.splice(idx,1)}var Base;return Base=Class.extend({init:function(handler,options){this._selectedShapes=[],this.handler=handler,this.options=options,this.components=options.components||{},this.activeComponent=null},release:function(){this.components={},this._selectedShapes=[],this.handler=null},initComponent:function(){throw new Error("base.js: initComponent has to be implemented in subclass")},resetSelectedShapes:function(){this._selectedShapes.length=0},getSelectedShapes:function(){return this._selectedShapes},toggleSelectedShape:function(shape){var index=this._selectedShapes.indexOf(shape);-1!==index?this._selectedShapes.splice(index,1):this._selectedShapes.push(shape)},setComponent:function(key,component){switch(key){case"x":case"y":case"dataArea":case"colorLegend":this.components[key]=Array.isArray(component)?component:[component];break;default:throw"Key "+key+" not implemented"}},addComponent:function(key,component){switch(key){case"x":case"y":case"dataArea":case"colorLegend":this.components[key]||(this.components[key]=[]),arrRemove.call(this.components[key],component),this.components[key].push(component);break;default:throw"Key "+key+" not implemented"}},removeComponent:function(key,component){switch(key){case"x":case"y":case"dataArea":case"colorLegend":this.components[key]&&component&&arrRemove.call(this.components[key],component),component&&this.components[key]&&this.components[key].length||delete this.components[key];break;default:throw"Key "+key+" not implemented"}},getComponent:function(pageX,pageY){var point=new Point(pageX-this.handler.containerRect.x,pageY-this.handler.containerRect.y);return Object.keys(this.components).map(function(key){return this.components[key]},this).reduce(function(a,b){return a.concat(b)}).filter(function(component){return this.getRect(component).pointInside(point.x,point.y)},this)[0]},getRect:function(component){return component.rect},getComponentKey:function(component){return Object.keys(this.components).filter(function(key){return this.components[key].indexOf(component)>=0},this)[0]},setActiveMode:function(v){this._activeMode=v},getActiveMode:function(){return this._activeMode},getActiveDimensions:function(){return this.activeComponent.getSelectionIndices()},toggle:function(){},toggleRect:function(){},start:function(){},update:function(){},end:function(){},cancel:function(){},move:function(){},leave:function(){},getTransformedPoint:function(pageX,pageY){var rect=this.getRect(this.activeComponent||this.components.dataArea[0]);return new Point(pageX-rect.x-this.handler.containerRect.x,pageY-rect.y-this.handler.containerRect.y)},getPagePoint:function(transformedPointX,transformedPointY,component){var rect=this.getRect(component||this.activeComponent||this.components.dataArea[0]);return new Point(transformedPointX+rect.x+this.handler.containerRect.x,transformedPointY+rect.y+this.handler.containerRect.y)},getInterpolatedPoints:function(start,end,pixelPrecision){pixelPrecision=pixelPrecision||this.options.interpolation.pixelPrecision||2;var progress,point,distance=start.distanceTo(end),precision=1/(distance/(pixelPrecision>0?pixelPrecision:distance)),points=[];for(points.push(start),progress=precision;1-precision>progress;progress+=precision)point=new Point(start.x+(end.x-start.x)*progress,start.y+(end.y-start.y)*progress),points.push(point);return points.push(end),points},shapeFromPoint:function(point){return this.shapesFromPoints([point])[0]},shapesFromPoints:function(points){var point,shapesLen,shapes,shape,item,i,j,k,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,pointsLen=points.length,selectionID=getSelectionID(this.activeComponent),foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(j=0;pointsLen>j;++j)for(point=points[j],shapes=item.getShapes(getSelectionID(this.activeComponent)),"dataArea"===selectionID&&item.toggleShapes&&(shapes=shapes.concat(item.toggleShapes)),shapesLen=shapes.length,k=0;shapesLen>k;++k)if(shape=shapes[k],shape.pointInside(point.x,point.y)){foundItems.push(item);break}return foundItems},shapesFromLines:function(lines){var line,shapesLen,shapes,shape,item,i,j,k,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,linesLen=lines.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(j=0;linesLen>j;++j)for(line=lines[j],shapes=item.getShapes(getSelectionID(this.activeComponent)),shapesLen=shapes.length,k=0;shapesLen>k;++k)if(shape=shapes[k],shape.intersectsLine(line)){foundItems.push(item);break}return foundItems},shapesFromPolygon:function(polygon){var points,point,pointsLen,shapesLen,shapes,item,i,j,k,foundItem,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(foundItem=!1,shapes=item.getShapes(getSelectionID(this.activeComponent)),shapesLen=shapes.length,k=0;shapesLen>k&&!foundItem;++k)for(points=shapes[k].getPoints(),pointsLen=points.length,j=0;pointsLen>j;++j)if(point=points[j],polygon.pointInside(point.x,point.y)){foundItems.push(item),foundItem=!0;break}return foundItems},shapesFromRect:function(rect,componentId){if(!rect)return[];var shapesLen,shapes,shape,item,i,k,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(shapes=item.getShapes(componentId?componentId:getSelectionID(this.activeComponent)),shapesLen=shapes.length,k=0;shapesLen>k;k++)if(shape=shapes[k],shape.intersectsRect){if(shape.intersectsRect(rect)){foundItems.push(item);break}}else if(rect.intersectsWith(shape)){foundItems.push(item);break}return foundItems},shapesFromRectForDirection:function(rect,directionProperty,componentId){var item,shapesLen,shapes,shape,shapeBounds,i,j,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[],min=0,max=0,boundaryFnStr="";switch(directionProperty){case"x":min=rect.x,max=rect.getRight(),boundaryFnStr="getRight";break;case"y":min=rect.y,max=rect.getBottom(),boundaryFnStr="getBottom"}for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(shapes=item.getShapes(componentId?componentId:getSelectionID(this.activeComponent)),shapesLen=shapes.length,j=0;shapesLen>j;++j)if(shape=shapes[j],"cx"in shape){if(shape["c"+directionProperty]>=min&&shape["c"+directionProperty]<=max){foundItems.push(item);break}}else{if(shapeBounds=shape.getBoundingRect(),shapeBounds[directionProperty]>=min&&shapeBounds[directionProperty]<=max){foundItems.push(item);break}if(shapeBounds[boundaryFnStr]()>=min&&shapeBounds[boundaryFnStr]()<=max){foundItems.push(item);break}if(min>=shapeBounds[directionProperty]&&max<=shapeBounds[boundaryFnStr]()){foundItems.push(item);break}}return foundItems},shapesFromRange:function(val1,val2,minInclEq,maxInclEq){var item,values,value,i,j,compareFunction,minVal=Math.min(val1,val2),maxVal=Math.max(val1,val2),items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,indices="function"==typeof this.activeComponent.getType?this.activeComponent.getType().indices:null,foundItems=[];for(minInclEq=minInclEq!==!1,maxInclEq=maxInclEq!==!1,compareFunction=minInclEq&&maxInclEq?function(value){return value>=minVal&&maxVal>=value}:minInclEq?function(value){return value>=minVal&&maxVal>value}:maxInclEq?function(value){return value>minVal&&maxVal>=value}:function(value){return value>minVal&&maxVal>value},i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(values=item.values instanceof Array?item.values:item.value instanceof Array?item.value:[item.value],indices&&indices.length&&(values=values.filter(function(v,idx){return indices.indexOf(idx)>=0})),j=0;j<values.length;j++)if(value=values[j],compareFunction(value)){foundItems.push(item);break}return foundItems},shapesFromDimensionValue:function(values){var item,i,j,items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)if(item=items[i],!isNull(item)||this._allowNullSelect)for(j=0;j<values.length;j++)if(item.id===values[j]){foundItems.push(item);break}return foundItems},groupedItemsFromShapes:function(cacheItems){var activeDimensions,dimIndex,nodeDepth,nodeParent,cParents=[];return activeDimensions=void 0!==this.activeComponent.getSelectionIndices?this.activeComponent.getSelectionIndices():[0],dimIndex=activeDimensions[activeDimensions.length-1],cacheItems.forEach(function(node){nodeParent=node.parent,void 0!==nodeParent&&(nodeDepth=treeIterator.getLevel.call(nodeParent)-(node.isCacheItem?0:1),nodeDepth===dimIndex&&-1===cParents.indexOf(nodeParent)&&cacheItems&&cParents.push(nodeParent))}),cParents.length>0&&(cacheItems=[],cParents.forEach(function(item){cacheItems=cacheItems.concat(cacheUtils.getCacheItems.call(item))})),cacheItems},shapesFromIndex:function(index1,index2){var item,i,startIndex=Math.min(index1,index2),endIndex=Math.max(index1,index2),items=this.handler.cache.data,itemsLen=this.handler.cache.data.length,foundItems=[];for(i=0;itemsLen>i;++i)item=items[i],void 0!==item.index&&item.index>=startIndex&&item.index<=endIndex&&foundItems.push(item);return foundItems},ToggleFlag:{select:1,deselect:2,auto:4,replace:8,tooltip:16},toggleSelection:function(items,toggleFlag){function toggleItem(filterFn){var filteredItems=items.filter(filterFn);filteredItems.forEach(function(item){disableSelections||(item.selected=!item.selected,toggleSelectedShape(item),ToggleShape.emit(item,toggleFlag))}),filteredItems.length>0&&ToggleShapes.emit(items,toggleFlag)}var tempItems,disableSelections=this.handler._disableSelections,ToggleFlag=this.ToggleFlag,ToggleShape=this.handler.ToggleShape,ToggleShapes=this.handler.ToggleShapes,ToggleTooltip=this.handler.ToggleTooltip,toggleSelectedShape=this.toggleSelectedShape.bind(this);toggleFlag=toggleFlag||ToggleFlag.auto,toggleFlag&ToggleFlag.select?toggleItem(function(item){return!item.selected}):toggleFlag&ToggleFlag.deselect?toggleItem(function(item){return item.selected}):toggleFlag&ToggleFlag.auto?toggleItem(function(){return!0}):toggleFlag&ToggleFlag.replace&&(tempItems=items,items=this.handler.cache.data,toggleItem(function(item){return item.selected}),items=tempItems,toggleItem(function(){return!0})),toggleFlag&ToggleFlag.tooltip&&ToggleTooltip.emit(items,disableSelections)},clearSelection:function(){var Clear=this.handler.Clear,items=this.handler.cache.data,toggleFlag=this.ToggleFlag.deselect;this.toggleSelection(items,toggleFlag),Clear.emit()},_isNull:isNull}),Base.defaultOptions={},Base}),define("general.components/framer/framer",["qvangular","general.services/show-service/show-service"],function(qvangular,showService){var flashComponent={template:'<div class ="qv-framer" ng-style="style"></div>',controller:["$scope",function($scope){$scope.style={},$scope.style.top=$scope.top,$scope.style.left=$scope.left,$scope.style.height=$scope.height,$scope.style.width=$scope.width,$scope.closeComponent()}],scope:{top:"=",left:"=",height:"=",width:"=",closeComponent:"="}},Framer={flash:function(point1,point2){var $timeout=qvangular.getService("$timeout"),flashFrame=showService.show(flashComponent,{top:Math.min(point1.y,point2.y)+"px",left:Math.min(point1.x,point2.x)+"px",height:Math.max(point1.y,point2.y)-Math.min(point1.y,point2.y)+"px",width:Math.max(point1.x,point2.x)-Math.min(point1.x,point2.x)+"px",closeComponent:function(){$timeout(function(){flashFrame.destroy(),flashFrame=null},300)}})}};return Framer}),define("objects.views/selections/types/data-area",["jquery","objects.utils/shapes/point","objects.utils/shapes/polygon","objects.utils/shapes/rect","objects.utils/shapes/line","./base","general.components/framer/framer"],function($,Point,Polygon,Rect,Line,Base,Framer){"use strict";function renderCaptureStart(){
ctx.beginPath(),ctx.moveTo(startPoint.x,startPoint.y),ctx.fillStyle="rgba(77, 192, 78, 1)",ctx.arc(startPoint.x,startPoint.y,10,0,2*Math.PI,!0),ctx.fill()}function renderCapture(p1,p2,shiftLockProperty){var cpX,cpY;!shiftLockProperty||"x"!==shiftLockProperty&&"y"!==shiftLockProperty||(p2[shiftLockProperty]=startPoint[shiftLockProperty]),cpX=(p1.x+p2.x)/2,cpY=(p1.y+p2.y)/2,ctx.beginPath(),ctx.moveTo(p1.x,p1.y),ctx.quadraticCurveTo(cpX,cpY,p2.x,p2.y),ctx.stroke()}function renderLineDashTo(c,start,end,dashArray){dashArray=dashArray||[2,4];var dashLength,dashCount=dashArray.length,dx=end.x-start.x,dy=end.y-start.y,n=Math.sqrt(dx*dx+dy*dy),distRemaining=n,dashIndex=0,draw=!0,x=start.x,y=start.y;for(dx/=n,dy/=n,c.moveTo(x,y),dashIndex=0;distRemaining>=.1&&5e3>dashIndex;++dashIndex)dashLength=dashArray[dashIndex%dashCount],0===dashLength&&(dashLength=.001),dashLength>distRemaining&&(dashLength=distRemaining),x+=dashLength*dx,y+=dashLength*dy,c[draw?"lineTo":"moveTo"](x,y),distRemaining-=dashLength,draw=!draw}function renderCaptureAutoCloseLine(start,end){ctxAutoClose.clearRect(0,0,canvasAutoClose.width,canvasAutoClose.height),ctxAutoClose.beginPath(),renderLineDashTo(ctxAutoClose,start,end),ctxAutoClose.stroke()}function hideCapture(){$uiContainer.hide(),$canvas.hide(),$canvasAutoClose.hide()}var DataArea,startPoint,$uiContainer=$("<div />"),uiContainer=$uiContainer[0],$canvas=$("<canvas />"),canvas=$canvas[0],$canvasAutoClose=$("<canvas />"),canvasAutoClose=$canvasAutoClose[0],$canvasFadeOut=$("<canvas />"),canvasFadeOut=$canvasFadeOut[0],ctx=canvas.getContext("2d"),ctxAutoClose=canvasAutoClose.getContext("2d"),ctxFadeOut=canvasFadeOut.getContext("2d"),swipePoints=[],lassoCanAutoClose=!1,lassoIsAutoClosed=!1;return uiContainer.appendChild(canvas),uiContainer.appendChild(canvasAutoClose),uiContainer.appendChild(canvasFadeOut),uiContainer.className="selections-data-area-ui",$uiContainer.hide(),DataArea=Base.extend("DataAreaSelection",{init:function(handler,options){this._super(handler,options),this.setActiveMode("item"),this._startIndex=-1,this._endIndex=-1},initComponent:function(){this.activeComponent=this.components.dataArea[0]},refreshCanvas:function(){this.rect=this.components.dataArea[0].rect;var attrs={position:"absolute",left:this.rect.x+"px",top:this.rect.y+"px",width:this.rect.width+"px",height:this.rect.height+"px","z-index":20};ctx.canvas.width=this.rect.width,ctx.canvas.height=this.rect.height,ctx.lineWidth=2,ctx.lineCap="round",ctx.lineJoin="round",ctx.strokeStyle="rgba(102,102,102,1)",ctx.fillStyle="rgba(102,102,102,1)",$canvas.css(attrs),ctxAutoClose.canvas.width=this.rect.width,ctxAutoClose.canvas.height=this.rect.height,ctxAutoClose.lineWidth=2,ctxAutoClose.lineCap="round",ctxAutoClose.lineJoin="round",ctxAutoClose.strokeStyle="rgba(102,102,102,1)",$canvasAutoClose.css(attrs),ctxFadeOut.canvas.width=this.rect.width,ctxFadeOut.canvas.height=this.rect.height,$canvasFadeOut.css(attrs)},toggle:function(e,currentPoint,toggle){toggle=void 0!==toggle?toggle:this.handler.getKeyAsToggleSelected(e),toggle||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var shapes,point=this.getTransformedPoint(currentPoint.x,currentPoint.y),cb=this.options.toggle.callback||this.toggleSelection,indexSelection=this.options.indexSelection,toggleFlag=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return shapes=indexSelection?this.shapesFromRectForDirection(new Rect(point.x,point.y,0,0),"y"):this.shapesFromPoints([point]),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(c){c.selectionMode="dataArea"}),shapes.forEach(function(c){c.interactPosition=currentPoint}),cb.call(this,shapes,toggleFlag),shapes&&shapes.length>0},toggleRect:function(e,p1,p2){if(p1&&p2){var x,y,w,h,rect,shapes,toggleFlag,indexSelection,cb,framePoint1,framePoint2,dataAreaContainer=$(this.components.dataArea[0].container),dataAreaOffset=dataAreaContainer.offset(),adjustPointInBounds=function(p){return{x:Math.min(Math.max(p.x,dataAreaOffset.left),dataAreaOffset.left+dataAreaContainer.width()),y:Math.min(Math.max(p.y,dataAreaOffset.top),dataAreaOffset.top+dataAreaContainer.height())}};p1=adjustPointInBounds(p1),p2=adjustPointInBounds(p2),framePoint1=p1,framePoint2=p2,this.resetSelectedShapes(),p1=this.getTransformedPoint(p1.x,p1.y),p2=this.getTransformedPoint(p2.x,p2.y),x=Math.min(p1.x,p2.x),y=Math.min(p1.y,p2.y),w=Math.max(1,Math.abs(p2.x-p1.x)),h=Math.max(1,Math.abs(p2.y-p1.y)),rect=new Rect(x,y,w,h),toggleFlag=this.ToggleFlag.select,indexSelection=this.options.indexSelection,cb=this.toggleSelection,this.activeComponent=this.components.dataArea[0],shapes=indexSelection?this.shapesFromRectForDirection(rect,"y"):this.shapesFromRect(rect),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){s.selectionMode="dataArea"}),cb.call(this,shapes,toggleFlag),this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),!0),Framer.flash(framePoint1,framePoint2)}},start:function(e,currentPoint){this.handler.getKeyAsToggleSelected(e)||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var point=this.getTransformedPoint(currentPoint.x,currentPoint.y),captureInput=this.options.captureInput,indexSelection=this.options.indexSelection;if(captureInput&&($canvas.show(),$canvasAutoClose.show(),$uiContainer.appendTo(this.handler.container),$uiContainer.show(),this.refreshCanvas()),swipePoints.length=0,swipePoints.push(point),startPoint=new Point(swipePoints[0].x,swipePoints[0].y),lassoCanAutoClose=!1,lassoIsAutoClosed=!1,indexSelection){var startShape=this.shapesFromRectForDirection(new Rect(startPoint.x,startPoint.y,1,1),"y"),startIndex=startShape.length&&startShape[0].index;void 0!==startIndex&&startIndex>=0&&(this._startIndex=startIndex)}captureInput&&renderCaptureStart()},update:function(e,currentPoint){var lastPoint,shapes,removeShapes,endShape,point=this.getTransformedPoint(currentPoint.x,currentPoint.y),opts=this.options,captureInput=opts.captureInput,lassoAutoCloseDistance=opts.lassoAutoCloseDistance,indexSelection=opts.indexSelection,shiftLockProperty=e.shiftKey&&opts.shiftLockCapture?opts.shiftLockAxis:"",toggleFlag=this.ToggleFlag.select,endIndex=-1,cb=this.toggleSelection;lastPoint=swipePoints[swipePoints.length-1],swipePoints.push(point),captureInput&&renderCapture(lastPoint,point,shiftLockProperty),captureInput&&(lassoCanAutoClose||(lassoCanAutoClose=swipePoints.length>2&&startPoint.distanceTo(point)>=lassoAutoCloseDistance),ctxAutoClose.clearRect(0,0,canvasAutoClose.width,canvasAutoClose.height),lassoCanAutoClose&&(startPoint.distanceTo(point)<=lassoAutoCloseDistance?(renderCaptureAutoCloseLine(point,startPoint),lassoIsAutoClosed=!0):lassoIsAutoClosed=!1)),indexSelection?(endShape=this.shapesFromRectForDirection(new Rect(point.x,point.y,1,1),"y"),endIndex=endShape.length?endShape[0].index:-1,void 0!==endIndex&&endIndex>=0&&(this._endIndex=endIndex),shapes=this.shapesFromIndex(this._startIndex,this._endIndex),removeShapes=this.getSelectedShapes().filter(function(shape){return-1===shapes.indexOf(shape)}),cb.call(this,removeShapes,this.ToggleFlag.deselect),cb.call(this,shapes,toggleFlag)):(shapes=this.shapesFromLines([new Line(lastPoint.x,lastPoint.y,point.x,point.y)]),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){s.selectionMode="dataArea"}),cb.call(this,shapes,toggleFlag))},end:function(e){var shapes,polygon,captureInput=this.options.captureInput,indexSelection=this.options.indexSelection,toggleFlag=this.ToggleFlag.select,cb=this.toggleSelection;indexSelection&&(this._startIndex=-1,this._endIndex=-1),captureInput&&hideCapture(),captureInput&&lassoIsAutoClosed&&(polygon=new Polygon(swipePoints),shapes=this.shapesFromPolygon(polygon),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){s.selectionMode="dataArea"}),cb.call(this,shapes,toggleFlag)),swipePoints.length=0,this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),this.handler.getKeyAsToggleSelected(e))},cancel:function(cancelAndClear){swipePoints.length&&hideCapture(),cancelAndClear&&this.clearSelection(),this.activeComponent=null}}),DataArea.defaultOptions={captureInput:!0,indexSelection:!1,shiftLockCapture:!1,shiftLockAxis:"x",lassoAutoCloseDistance:50,autoConfirm:!1,toggle:{callback:null},interpolation:{pixelPrecision:2}},DataArea}),define("text!objects.views/selections/types/range/range-template.ng.html",[],function(){return'<div class="qvt-range-selection">\r\n\r\n	<div ng-show="vertical" class="range-vertical"\r\n		 ng-class="{\'near\': vOptions.dock == \'left\', \'far\' : vOptions.dock == \'right\'}"\r\n		 ng-style="vRangeStyle">\r\n		<div class="range">\r\n			<div class="axis-cover" ng-style="vRelevantSize" tid="range-vertical-cover" ng-class="{\'active\' : activeOptions.y.cover}"></div>\r\n		</div>\r\n		<div class="far-edge" tid="range-vertical-far" ng-class="{\'active\' : activeOptions.y.near}">\r\n		</div>\r\n		<div class="near-edge" tid="range-vertical-near" ng-class="{\'active\' : activeOptions.y.far}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="vWrappperSize">\r\n            <qva-range-selection-bubble tid="range-vertical-near-bubble" visible="visible" active-component="vComponent" handle-points="vHandlePoints" horizontal="false" far="false" data="vValues.start" active="activeOptions.y.far"> </qva-range-selection-bubble>\r\n            <qva-range-selection-bubble tid="range-vertical-far-bubble" visible="visible" active-component="vComponent" handle-points="vHandlePoints" horizontal="false" far="true" data="vValues.end" active="activeOptions.y.near"> </qva-range-selection-bubble>\r\n		</div>\r\n	</div>\r\n\r\n	<div ng-show="horizontal" class="range-horizontal"\r\n		 ng-class="{\'near\': hOptions.dock == \'bottom\', \'far\' : hOptions.dock == \'top\'}"\r\n		 ng-style="hRangeStyle">\r\n	    <div class="range">\r\n			<div class="axis-cover" ng-style="hRelevantSize" tid="range-horizontal-cover" ng-class="{\'active\' : activeOptions.x.cover}"></div>\r\n	    </div>\r\n\r\n	    <div class="far-edge" tid="range-horizontal-far" ng-class="{\'active\' : activeOptions.x.far}">\r\n	    </div>\r\n		<div class="near-edge" tid="range-horizontal-near" ng-class="{\'active\' : activeOptions.x.near}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="hWrappperSize">\r\n            <qva-range-selection-bubble tid="range-horizontal-near-bubble" visible="visible" active-component="hComponent" handle-points="hHandlePoints" horizontal="true" far="false" data="hValues.start" active="activeOptions.x.near"> </qva-range-selection-bubble>\r\n            <qva-range-selection-bubble tid="range-horizontal-far-bubble" visible="visible" active-component="hComponent" handle-points="hHandlePoints" horizontal="true" far="true" data="hValues.end" active="activeOptions.x.far"> </qva-range-selection-bubble>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!objects.views/selections/types/range/range-bubble.ng.html",[],function(){return'<div class="bubble-wrapper" ng-class="{\'far\' : far, \'near\' : !far}">\r\n	<div ng-show="!editing" class="bubble range-bubble" ng-class="{\'active\' : active}">{{data.text}}</div>\r\n	<input ng-show="editing" type="text" ng-class="{\'active\' : active, \'invalid\': invalid}" class="bubble range-input"/>\r\n</div>'}),define("objects.views/selections/types/range/range-bubble-directive",["jquery","touche","qvangular","text!./range-bubble.ng.html"],function($,Touche,qvangular,template){function onStart($scope){$scope.$emit("rangeStart")}function onEditingChanged($scope,editing){$scope.editing=editing,$scope.$emit("rangeEditChanged",editing)}function onUpdate($scope,points,dir,valueInfo){$scope.$emit("rangeUpdate",points,dir,valueInfo)}function onEnd($scope,points){$scope.$emit("rangeEnd",points)}function onEditInputResize(){$(this).css("width",6*$(this).val().length+50+"px")}var namespace=".rangeselection";qvangular.directive("qvaRangeSelectionBubble",["$timeout",function($timeout){return{template:template,replace:!0,restrict:"E",scope:{data:"=",active:"=",far:"=",horizontal:"=",activeComponent:"=",handlePoints:"=",visible:"="},link:function($scope,$element){var $editInput=$element.find(".range-input"),$rangeBubble=$element.find(".range-bubble"),initialPoints={};$scope.$watch("activeComponent",function(){$scope.editable=$scope.activeComponent&&!$scope.activeComponent.isDiscrete()&&"function"==typeof $scope.activeComponent.getPositionOfValue,$scope.editable?($editInput.removeClass("non-editable"),$rangeBubble.removeClass("non-editable")):($editInput.addClass("non-editable"),$rangeBubble.addClass("non-editable"))}),$scope.endEditing=function(){$scope.invalid=!1,$scope.editing&&(onEditingChanged($scope,!1),$editInput.blur())},$scope.$watch("data.value",function(newValue){return isNaN(newValue)?void(this.invalid=!0):($scope.editing&&$scope.endEditing(),void $editInput.val(newValue))}),$scope.$watch("visible",function(){$scope.visible||$scope.endEditing()}),$scope.$on("off",function(){$scope.endEditing(),Touche($editInput[0]).off("*",namespace),Touche($rangeBubble[0]).off("*",namespace),$element.off("keyup"+namespace,"*")}),$scope.onEditBubble=function(){$scope.editing=!0,$editInput.css("width",$rangeBubble.width()),$scope.$digest(),$editInput.focus(),$editInput[0].setSelectionRange(0,9999),$scope.$digest(),$timeout(function(){onEditInputResize.call($editInput)})},$scope.$on("on",function(){Touche($editInput[0]).tap({id:namespace,options:{preventDefault:!1},start:function(){Touche.preventGestures(this.gestureHandler)}}),Touche($rangeBubble[0]).tap({id:namespace,start:function(){Touche.preventGestures(this.gestureHandler)},end:function(){$scope.editable&&!$scope.editing&&(onEditingChanged($scope,!0),$scope.onEditBubble())}}).swipe({id:namespace,start:function(){$.extend(!0,initialPoints,$scope.handlePoints),Touche.preventGestures(this.gestureHandler),onStart($scope)},update:function(e,data){var delta,dir,otherHandlePoint,newHandlePoint,index=$scope.far?1:0;$scope.horizontal?(delta=data.swipe.deltaX,dir="x"):(delta=data.swipe.deltaY,dir="y"),otherHandlePoint=initialPoints[1^index][dir],newHandlePoint=initialPoints[index][dir]+delta,0===index&&($scope.horizontal&&newHandlePoint>otherHandlePoint||!$scope.horizontal&&otherHandlePoint>newHandlePoint)?(index=1,otherHandlePoint=initialPoints[1][dir]):1===index&&($scope.horizontal&&otherHandlePoint>newHandlePoint||!$scope.horizontal&&newHandlePoint>otherHandlePoint)&&(index=0,otherHandlePoint=initialPoints[0][dir]),$scope.handlePoints[index][dir]=newHandlePoint,$scope.handlePoints[1^index][dir]=otherHandlePoint,$scope.$digest(),onUpdate($scope,$scope.handlePoints,dir)},end:function(){onEnd($scope,$scope.handlePoints)}}),$editInput.keyup(onEditInputResize),$scope.onEditConfirmed=function(){if($scope.editing){var tempPoint,dir,numberString=$editInput.val(),valueInfo={value:parseFloat(numberString),index:$scope.far?1:0,"switch":!1},coord=$scope.activeComponent.getPositionOfValue(valueInfo.value),handlePoints=$scope.handlePoints;isNaN(valueInfo.value)?$scope.invalid=!0:(dir=$scope.horizontal?"x":"y",handlePoints[valueInfo.index][dir]=coord,($scope.horizontal&&handlePoints[1][dir]<handlePoints[0][dir]||!$scope.horizontal&&handlePoints[1][dir]>handlePoints[0][dir])&&(tempPoint=handlePoints[1][dir],handlePoints[1][dir]=handlePoints[0][dir],handlePoints[0][dir]=tempPoint,valueInfo.index=valueInfo.index?0:1,valueInfo["switch"]=!0),$scope.endEditing(),onUpdate($scope,$scope.handlePoints,dir,valueInfo),onEnd($scope,$scope.handlePoints)),$scope.$digest()}},$scope.$on("confirmEdit",$scope.onEditConfirmed)})}}}])}),define("objects.views/selections/types/range/range-directive",["touche","qvangular","objects.utils/shapes/point","text!./range-template.ng.html","./range-bubble-directive"],function(Touche,qvangular,Point,template){function updatePoints(initials,target,orientation,distance){var arr=[];return"y"===orientation?arr[target]=new Point(initials[target].x,initials[target].y+distance):arr[target]=new Point(initials[target].x+distance,initials[target].y),arr[1^target]=initials[1^target],arr}function onStart($scope){$scope.$emit("rangeStart")}function onUpdate($scope,points,dir){$scope.$emit("rangeUpdate",points,dir)}function onEnd($scope,points){$scope.$emit("rangeEnd",points)}function getTargetPoint(points,grt,dir){return grt?points[0][dir]>points[1][dir]?0:1:points[0][dir]<points[1][dir]?0:1}function attachEdgeEvent($scope,targetElement,isHorizontal,grt){var initialPoints,targetPoint,id,scopePointsName=isHorizontal?"hHandlePoints":"vHandlePoints",direction=isHorizontal?"x":"y";Touche(targetElement).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{radiusThreshold:0},start:function(){targetPoint=getTargetPoint($scope[scopePointsName],grt,direction),initialPoints=$scope[scopePointsName],Touche.preventGestures(this.gestureHandler),onStart($scope)},update:function(e,data){$scope[scopePointsName]=updatePoints(initialPoints,targetPoint,direction,isHorizontal?data.swipe.deltaX:data.swipe.deltaY),$scope.$digest(),$scope.activeOptions[direction].near=$scope.activeOptions[direction].far=!1,id=getTargetPoint($scope[scopePointsName],grt,direction)^!isHorizontal?"far":"near",$scope.activeOptions[direction][id]=!0,onUpdate($scope,$scope[scopePointsName],direction)},end:function(){onEnd($scope,$scope[scopePointsName]),$scope.activeOptions[direction].near=$scope.activeOptions[direction].far=!1}})}function on($scope){if(!isOn){isOn=!0;var initialPoints="hey";Touche(vertAxisCover).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{preventDefault:!0},start:function(){initialPoints=$scope.vHandlePoints,Touche.preventGestures(this.gestureHandler),onStart($scope),$scope.activeOptions.y.cover=!0},update:function(e,data){$scope.vHandlePoints=[{x:initialPoints[0].x,y:initialPoints[0].y+data.swipe.deltaY},{x:initialPoints[1].x,y:initialPoints[1].y+data.swipe.deltaY}],$scope.$digest(),onUpdate($scope,$scope.vHandlePoints,"y")},end:function(){onEnd($scope,$scope.vHandlePoints),$scope.activeOptions.y.cover=!1}}),Touche(horiAxisCover).tap({id:namespace,options:{preventDefault:!0},start:function(){Touche.preventGestures(this.gestureHandler)}}).swipe({id:namespace,options:{preventDefault:!0},start:function(){initialPoints=$scope.hHandlePoints,Touche.preventGestures(this.gestureHandler),onStart($scope),$scope.activeOptions.x.cover=!0},update:function(e,data){$scope.hHandlePoints=[{x:initialPoints[0].x+data.swipe.deltaX,y:initialPoints[0].y},{x:initialPoints[1].x+data.swipe.deltaX,y:initialPoints[1].y}],$scope.$digest(),onUpdate($scope,$scope.hHandlePoints,"x")},end:function(){onEnd($scope,$scope.hHandlePoints),$scope.activeOptions.x.cover=!1}}),Touche.utils.touch||(attachEdgeEvent($scope,vertFarEdge,!1,!1,"far"),attachEdgeEvent($scope,vertNearEdge,!1,!0,"near"),attachEdgeEvent($scope,horiFarEdge,!0,!0,"far"),attachEdgeEvent($scope,horiNearEdge,!0,!1,"near"))}}function off(){Touche(vertAxisCover).off("*",namespace),Touche(horiAxisCover).off("*",namespace),Touche(vertFarEdge).off("*",namespace),Touche(vertNearEdge).off("*",namespace),Touche(horiFarEdge).off("*",namespace),Touche(horiNearEdge).off("*",namespace),isOn=!1}var vertAxisCover,horiAxisCover,vertFarEdge,vertNearEdge,horiFarEdge,horiNearEdge,namespace=".rangeselection",isOn=!1;qvangular.directive("qvaRangeSelection",function(){return{template:template,replace:!0,scope:{vertical:"=",horizontal:"=",vOptions:"=",hOptions:"=",vHandlePoints:"=",hHandlePoints:"=",vValues:"=",hValues:"=",activeComponent:"=",hComponent:"=",vComponent:"=",visible:"="},link:function($scope,$element){$scope.vRangeStyle={},$scope.hRangeStyle={},$scope.vRelevantSize=0,$scope.hRelevantSize=0,$scope.activeOptions={y:{far:!1,near:!1,cover:!1},x:{far:!1,near:!1,cover:!1}},$scope.setRangeStyle=function(dir,points,options){if(!points||2!==points.length||!options)return{};var start=points[0],end=points[1];"y"===dir?$scope.vRangeStyle={height:Math.abs(start[dir]-end[dir]),top:Math.min(start[dir],end[dir])+options.offset}:$scope.hRangeStyle={width:Math.abs(start[dir]-end[dir]),left:Math.min(start[dir],end[dir])+options.offset}},$scope.$watchCollection("[vHandlePoints, vOptions]",function(newValues){$scope.setRangeStyle("y",newValues[0],newValues[1])}),$scope.$watchCollection("[hHandlePoints, hOptions]",function(newValues){$scope.setRangeStyle("x",newValues[0],newValues[1])}),$scope.$watch("hOptions",function(newValue){newValue&&$scope.setRelevantSize("x",newValue.rect.height)}),$scope.$watch("vOptions",function(newValue){newValue&&$scope.setRelevantSize("y",newValue.rect.width)}),$scope.setRelevantSize=function(dir,size){"x"===dir?($scope.hRelevantSize={height:size+"px"},$scope.hWrappperSize={height:"calc(100% - "+size+"px)"}):($scope.vRelevantSize={width:size+"px"},$scope.vWrappperSize={width:"calc(100% - "+size+"px)"})},vertAxisCover=$element.find(".range-vertical .axis-cover")[0],horiAxisCover=$element.find(".range-horizontal .axis-cover")[0],vertFarEdge=$element.find(".range-vertical .far-edge")[0],vertNearEdge=$element.find(".range-vertical .near-edge")[0],horiFarEdge=$element.find(".range-horizontal .far-edge")[0],horiNearEdge=$element.find(".range-horizontal .near-edge")[0],on.call(this,$scope),$scope.$on("on",function(){on.call(this,$scope)}),$scope.$on("off",function(){off.call(this)}),$scope.$on("$destroy",function(){off.call(this)})}}})}),define("objects.views/selections/types/range/range-angular",["jquery","qvangular","./../base","objects.utils/shapes/point","objects.utils/shapes/rect","./range-directive"],function($,qvangular,Base,Point,Rect){"use strict";function getLabelFromItem(item){if(item.isCacheItem){var dims=item.getDimensions();return dims[dims.length-1]}return item.parent&&item.parent.data&&item.parent.data.qText?item.parent.data.qText:item.label}function updateRangeObject(start,current,range,valueInfo){var shapes,first,last,outerRect=this.activeComponent.rect,rect=this.getRect(this.activeComponent),dataAreaRect=this.components.dataArea[0].rect,updateRangeFn=function(p1,p2,dir){if(valueInfo){if(valueInfo["switch"]){var temp=range.startVal;range.startVal=range.updateVal,range.updateVal=temp}0===valueInfo.index&&"horizontal"===dir||1===valueInfo.index&&"vertical"===dir?range.startVal=valueInfo.value:range.updateVal=valueInfo.value}else range.startVal=this.activeComponent.getValueOfPosition(p1),range.updateVal=this.activeComponent.getValueOfPosition(p2)},dx=start.x-current.x,dy=start.y-current.y,rdy=rect.y-outerRect.y,rdx=rect.x-outerRect.x,len=0,x1=0,y1=0,x2=0,y2=0;switch(this.activeComponent.dock){case"top":case"bottom":len=0>=dx?rect.width-start.x:start.x,0>dx&&(len+=rdx),current.x<rdx&&(dx-=rdx-current.x),x1=min(rect.width+rdx,max(rdx,min(start.x,current.x))),x2=max(x1,min(rdx+rect.width,max(start.x,current.x))),y1=0,y2=dataAreaRect.height,range.rect.set(x1,y1,x2-x1,y2-y1),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(shapes=this.shapesFromRectForDirection(range.rect,"x","dataArea"),shapes.length?(first=shapes[0],last=shapes[shapes.length-1],range.startVal=getLabelFromItem(first),range.updateVal=getLabelFromItem(last)):(range.startVal="-",range.updateVal="-")):updateRangeFn.call(this,x1,x2,"horizontal");break;case"left":case"right":len=0>=dy?rect.height-start.y:start.y,0>dy&&(len+=rdy),current.y<rdy&&(dy-=rdy-current.y),x1=0,x2=dataAreaRect.width,y1=min(rect.height+rdy,max(rdy,min(start.y,current.y))),y2=max(y1,min(rdy+rect.height,max(start.y,current.y))),range.rect.set(x1,y1,x2-x1,y2-y1),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(shapes=this.shapesFromRectForDirection(range.rect,"y","dataArea"),shapes.length?(first=shapes[0],last=shapes[shapes.length-1],range.startVal=getLabelFromItem(first),range.updateVal=getLabelFromItem(last)):(range.startVal="-",range.updateVal="-")):updateRangeFn.call(this,y1,y2,"vertical")}}function canCombineRanges(){return this.components.x&&this.components.y&&!this.components.x[0].isDiscrete()&&!this.components.y[0].isDiscrete()}function clearCtx(){$scope.y=!1,$scope.x=!1,this._rangeEventWatchers&&(this._rangeEventWatchers.forEach(function(watcher){watcher()}),this._rangeEventWatchers=null),$uiContainer.hide(),$scope.rangeSelectIsVisible=!1,rangeObjects={x:[],y:[]}}function getRangeObject(direction,index){direction||(direction="x"),index||(index=0);var rangeObject=rangeObjects[direction][index];return rangeObject||(rangeObject={rect:new Rect(0,0,0,0),startVal:0,endVal:0},rangeObjects[direction][index]=rangeObject),rangeObject}function updateSelection(direction,cb,toggleFlag){var intersectionRect,shapes=[],shapesToDeselect=this._previousShapes?this._previousShapes.slice():[],rangeObject=getRangeObject(direction),orthogonalRange=rangeObjects["y"===direction?"x":"y"];this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(shapes=this.shapesFromRectForDirection(rangeObject.rect,direction,"dataArea"),shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(s){var idx=shapesToDeselect.indexOf(s);idx>=0&&shapesToDeselect.splice(idx,1),s.selectionMode="range.dimension"}),this.checkActiveMode(["range.dimension","item"],!0),cb.call(this,shapes,toggleFlag),this._clearPrev&&cb.call(this,shapesToDeselect,this.ToggleFlag.deselect),this._shapes=shapes):(canCombineRanges.call(this)?(intersectionRect=orthogonalRange.length?rangeObject.rect.intersection(orthogonalRange[0].rect):rangeObject.rect,shapes=this.shapesFromRect(intersectionRect,"dataArea"),this.components.dataArea&&this.components.dataArea[0].updateRangeSelection&&this.components.dataArea[0].updateRangeSelection(intersectionRect)):shapes=this.shapesFromRange(rangeObject.startVal,rangeObject.updateVal),shapes.forEach(function(s){s.selectionMode="range.measure"}),this.checkActiveMode(["range.measure"],!0),cb.call(this,shapes,toggleFlag),this._shapes=shapes)}function swipeUpdate(currentPoint,valueInfo){var start,end,direction=this.getComponentKey(this.activeComponent),rangeObject=getRangeObject(direction),point=currentPoint,toggleFlag=this.ToggleFlag.select,cb=this.toggleSelection;updateRangeObject.call(this,startPoint,point,rangeObject,valueInfo),start=new Point(rangeObject.rect.x,rangeObject.rect.y),end=new Point(rangeObject.rect.x+rangeObject.rect.width,rangeObject.rect.y+rangeObject.rect.height),"y"===direction?($scope.vHandlePoints=[end,start],$scope.vValues={start:{text:this.activeComponent.getFormatter().format(rangeObject.updateVal),value:rangeObject.updateVal},end:{text:this.activeComponent.getFormatter().format(rangeObject.startVal),value:rangeObject.startVal}}):($scope.hHandlePoints=[start,end],$scope.hValues={start:{text:this.activeComponent.getFormatter().format(rangeObject.startVal),value:rangeObject.startVal},end:{text:this.activeComponent.getFormatter().format(rangeObject.updateVal),value:rangeObject.updateVal}}),$scope.$digest(),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?this._shapes&&cb.call(this,this._shapes,this.ToggleFlag.deselect):this.clearSelection(!0),updateSelection.call(this,direction,cb,toggleFlag)}var Range,$scope,startPoint,compiled=!1,min=Math.min,max=Math.max,$uiContainer=$("<div />"),uiContainer=$uiContainer[0],$rangeElement=$('<div qva-range-selection visible="rangeSelectIsVisible" active-component="activeComponent" v-component="vComponent" h-component="hComponent" v-handle-points="vHandlePoints" h-handle-points="hHandlePoints" horizontal="x" vertical="y" h-options="hOptions" v-options="vOptions" h-values="hValues" v-values="vValues"/>'),rangeObjects={x:[],y:[]};return Range=Base.extend("RangeSelection",{init:function(handler,options){this._super(handler,options),this._shapes=null,this._nrEditing=0,this.setActiveMode("item")},initComponent:function(point){this.previousComponent=this.activeComponent,this.activeComponent=this.getComponent(point.x,point.y),$scope.activeComponent=this.activeComponent,-1!==this.components.x.indexOf($scope.activeComponent)?$scope.hComponent=$scope.activeComponent:-1!==this.components.y.indexOf($scope.activeComponent)&&($scope.vComponent=$scope.activeComponent)},refreshContainer:function(){var offset,dataAreaRect=this.components.dataArea[0].rect,dataAreaOffset=$(this.components.dataArea[0].container).position(),rect=new Rect(dataAreaOffset.left,dataAreaOffset.top,dataAreaRect.width,dataAreaRect.height),components=[];["x","y"].forEach(function(direction){this.components[direction]&&!this.components[direction].contains(this.activeComponent)&&(components=components.concat(this.components[direction]))}.bind(this)),this.activeComponent&&components.push(this.activeComponent),components.forEach(function(c){c.isVisible()&&(offset=$(c.container).position(),rect=rect.combineWith(new Rect(offset.left,offset.top,c.rect.width,c.rect.height)))},this),this._offset={left:dataAreaOffset.left-rect.x,top:dataAreaOffset.top-rect.y},$uiContainer.css({left:rect.x,top:rect.y,width:rect.width,height:rect.height})},resetSelectedShapes:function(){this._previousSelectedShapes=this._selectedShapes.concat(),this._super()},getIsEditing:function(){return this._editing},confirmEdit:function(){$scope.$broadcast("confirmEdit")},getRect:function(component,outer){return component?(outer=outer||!1,component.hasOwnProperty("innerRect")&&!outer?component.innerRect:component.rect):new Rect(0,0,0,0)},getExtendedRect:function(component){return component?component.hasOwnProperty("extendedRect")?component.extendedRect:this.getRect(component):new Rect(0,0,0,0)},getTransformedPoint:function(pageX,pageY){var rect=this.getRect(this.activeComponent||this.components.dataArea[0],!0);return new Point(pageX-rect.x-this.handler.containerRect.x,pageY-rect.y-this.handler.containerRect.y)},getComponent:function(pageX,pageY){var point=new Point(pageX-this.handler.containerRect.x,pageY-this.handler.containerRect.y);return Object.keys(this.components).map(function(key){return this.components[key]},this).reduce(function(a,b){return a.concat(b)}).filter(function(component){return this.getExtendedRect(component).pointInside(point.x,point.y)},this)[0]},checkActiveMode:function(modes,onlySelection){modes.contains(this.handler.getActiveMode())||this.clearSelection(onlySelection),this.setActiveMode(modes[0])},toggleRect:function(e,p1,p2){this.start(e,p1),this.update(e,p2),this.end(e)},toggle:function(e,currentPoint,toggle){if(toggle=void 0!==toggle?toggle:this.handler.getKeyAsToggleSelected(e),toggle||this.clearSelection(),this.resetSelectedShapes(),this.cancel(),!this.activeComponent||!this.activeComponent.isDiscrete())return!1;var point=this.getTransformedPoint(currentPoint.x,currentPoint.y),shapes=this.shapesFromPoints([point]),cb=this.options.toggle.callback||this.toggleSelection,toggleFlag=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return shapes=this.groupedItemsFromShapes(shapes),shapes.forEach(function(c){c.selectionMode="dataArea"}),this.checkActiveMode(["item"]),cb.call(this,shapes,toggleFlag),shapes&&shapes.length>0},start:function(e,currentPoint){if(this.handler._disableSelections)return!0;var direction,dir,rect,rangeObject,offset;if(this.resetSelectedShapes(),this.refreshContainer(),this.activeComponent.isDiscrete?this.checkActiveMode(["range.dimension","item"],!0):this.checkActiveMode(["range.measure"]),direction=this.getComponentKey(this.previousComponent),dir=this.getComponentKey(this.activeComponent),direction&&direction!==dir&&this.previousComponent&&this.previousComponent!==this.activeComponent&&!canCombineRanges.call(this)&&direction in this.components&&($scope[direction]=!1,rangeObject=getRangeObject(direction),rangeObject.rect.set(0,0,0,0)),!this._rangeEventWatchers){var self=this;this._rangeEventWatchers=[],this._rangeEventWatchers.push($scope.$on("rangeStart",function(){self.resetSelectedShapes(),self._shapes=self._previousShapes,self._clearPrev=!0})),
this._rangeEventWatchers.push($scope.$on("rangeUpdate",function(ev,handlePoints,updateDir,valueInfo){startPoint=handlePoints[0],self.components[updateDir].indexOf(self.activeComponent)<0&&(self.activeComponent=self.components[updateDir][0]),swipeUpdate.call(self,handlePoints[1],valueInfo),self._clearPrev=!1})),this._rangeEventWatchers.push($scope.$on("rangeEditChanged",function(ev,editing){self._nrEditing=editing?self._nrEditing+1:self._nrEditing-1,self._nrEditing>1&&(self.confirmEdit(),self._nrEditing=1,ev.targetScope.onEditBubble()),self._editing=self._nrEditing>0})),this._rangeEventWatchers.push($scope.$on("rangeEnd",function(){self.end(),self._clearPrev=!1}))}startPoint=this.getTransformedPoint(currentPoint.x,currentPoint.y),$scope[dir]=!0,rect=this.getRect(this.activeComponent),offset=0,"y"===dir?(offset=this._offset.top,$scope.vOptions={rect:rect.clone(),offset:offset,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},$scope.vHandlePoints=[startPoint,startPoint]):(offset=this._offset.left,$scope.hOptions={rect:rect.clone(),offset:offset,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},$scope.hHandlePoints=[startPoint,startPoint]),this.handler.container.append($uiContainer),$uiContainer.show(),$scope.rangeSelectIsVisible=!0},update:function(e,currentPoint){return this.handler._disableSelections?!0:void swipeUpdate.call(this,this.getTransformedPoint(currentPoint.x,currentPoint.y))},updateShapesState:function(){var direction=this.getComponentKey(this.activeComponent),range=getRangeObject(direction),toggleFlag=this.ToggleFlag.select,shapes=[],cb=this.toggleSelection;this.clearSelection(!0),this.setActiveMode("range.measure"),this.activeComponent.isDiscrete&&!this.activeComponent.isDiscrete()&&(shapes=this.shapesFromRange(range.startVal,range.updateVal),shapes.forEach(function(s){s.selectionMode="range.measure"}),cb.call(this,shapes,toggleFlag)),this._shapes=shapes},end:function(e){return this.handler._disableSelections?!0:(this.selectRange(e),this._previousShapes=this._shapes,void(this._shapes=null))},cancel:function(){return this.handler._disableSelections?!0:("range.dimension"===this.getActiveMode()&&this.setActiveMode("item"),this._shapes=null,void clearCtx.call(this))},clearSelection:function(onlySelection){onlySelection=onlySelection||!1,this._shapes=null,onlySelection?this._super():(this._super(),clearCtx.call(this))},selectRange:function(){var range,SelectRange=this.handler.SelectRange,direction=this.getComponentKey(this.activeComponent),params=[],orMode=!1;if(this.activeComponent){if("dimension"===this.activeComponent.getType().type){var prev=this._previousSelectedShapes,current=this.getSelectedShapes().concat();return prev.forEach(function(item){var idx=current.indexOf(item);-1===idx&&current.push(item)}),void(current.length>0&&this.handler.Select.emit(current))}if(canCombineRanges.call(this))Object.keys(rangeObjects).filter(function(key){return rangeObjects[key][0]&&void 0!==rangeObjects[key][0].startVal&&void 0!==rangeObjects[key][0].updateVal}).forEach(function(key){var measure=this.components[key][0].getType().current[0];range=rangeObjects[key][0],params.push({measure:measure,range:{min:Math.min(range.startVal,range.updateVal),max:Math.max(range.startVal,range.updateVal)}})},this);else{if(range=rangeObjects[direction][0],!range)return;this.activeComponent.getType().current.forEach(function(measureIndex){params.push({measure:measureIndex,range:{min:Math.min(range.startVal,range.updateVal),max:Math.max(range.startVal,range.updateVal)}})}),orMode=!0}params.length&&(this._editing||SelectRange.emit(params,orMode))}},on:function(){if(!compiled){var $compile=qvangular.getService("$compile"),$rootScope=qvangular.getService("$rootScope");$scope=$rootScope.$new(),uiContainer.className="selections-range-ui",$uiContainer.append($rangeElement),$uiContainer.hide(),$compile(uiContainer)($scope),compiled=!0,$scope.rangeSelectIsVisible=!1}$scope.$broadcast("on")},off:function(){this.activeComponent&&($scope.$broadcast("off"),this.activeComponent=null)}}),Range.defaultOptions={toggle:{callback:null}},Range}),define("objects.views/selections/types/dom-base",["./base","objects.utils/shapes/rect"],function(Base,Rect){"use strict";function combineRangeObjects(rObj1,rObj2){var i,o1,o2=rObj2[0],found=!1;for(i=0;i<rObj1.length;i++)o1=rObj1[i],o1.startVal===o2.startVal&&o1.updateVal===o2.updateVal&&(rObj1.splice(i,1),i--,found=!0);return found||(rObj1=rObj1.concat(rObj2)),rObj1}var DomBase;return DomBase=Base.extend({init:function(handler,options){this._super(handler,options),this.internal=!0},release:function(){},initComponent:function(point){this.activeComponent=this.getComponent(point.x,point.y)},getRect:function(component){return component?component.hasOwnProperty("innerRect")?component.innerRect:component.rect:new Rect(0,0,0,0)},setComponent:function(key,component){this._super(key,component),component.selections=this},addComponent:function(key,component){this._super(key,component),component.selections=this},removeComponent:function(key,component){this._super(key,component),component.selections=null,component.off()},updateFromItems:function(e,items){var handler=this.handler,self=this;if(handler._isLocked)return void handler.SelectWhileLocked.emit();if(this.setActiveMode("item"),handler.activate(this),items=items.filter(function(it){return self._allowNullSelect||!self._isNull(it,self.activeComponent.getSelectionIndices())}),items.length){var cb=this.options.toggle.callback||this.toggleSelection;cb.call(this,items),handler.Select.emit(this.getSelectedShapes(),handler.getKeyAsToggleSelected(e))}},rangeStart:function(){var handler=this.handler;return handler._isLocked?void handler.SelectWhileLocked.emit():(this.setActiveMode("range.measure"),handler.activate(this),void this.resetSelectedShapes())},rangeUpdate:function(rangeObjects,combine){var handler=this.handler;if(handler._isLocked)return void handler.SelectWhileLocked.emit();var i,cb=this.options.toggle.callback||this.toggleSelection,shapes=[],toggleFlag=this.ToggleFlag.select;for(this.clearSelection(!0),this._rangeObjects&&combine&&(rangeObjects=combineRangeObjects(this._rangeObjects,rangeObjects)),i=0;i<rangeObjects.length;i++){var ro=rangeObjects[i];shapes=shapes.concat(this.shapesFromRange(ro.startVal,ro.updateVal,!0,ro.isMax))}shapes.forEach(function(s){s.selectionMode="range.measure"}),cb.call(this,shapes,toggleFlag),this._rangeObjects=rangeObjects,this._shapes=shapes},rangeEnd:function(){this.selectRange(),this._shapes=null},toggle:function(){},cancel:function(){this._rangeObjects=null,this.activeComponent.cancelSelection()},clearSelection:function(onlySelection){this._super(),onlySelection||this.activeComponent.clearSelection()},selectRange:function(){var i,range,SelectRange=this.handler.SelectRange,params=[];if(this._rangeObjects){for(i=0;i<this._rangeObjects.length;i++)range=this._rangeObjects[i],params.push({measure:0,range:{min:Math.min(range.startVal,range.updateVal),max:Math.max(range.startVal,range.updateVal)}});SelectRange.emit(params,!0)}}}),DomBase.defaultOptions={},DomBase}),define("objects.views/selections/types/color-legend",["./dom-base"],function(DomBase){"use strict";var ColorLegend;return ColorLegend=DomBase.extend({setIsEditing:function(editing,scope){this._editing=editing,this._scope=scope},getIsEditing:function(){return this._editing},confirmEdit:function(){this._scope.$broadcast("confirmEdit")}}),ColorLegend.defaultOptions={captureInput:!0,toggle:{callback:null}},ColorLegend}),define("text!objects.views/charts/tooltip/chart-tooltip.ng.html",[],function(){return'<div ng-switch on="template">\r\n	<div ng-switch-when="generic" class="qv-tooltip qvt-generic-tooltip">\r\n		<div ng-repeat="item in content">\r\n			<div class="header">\r\n				<strong>{{item.header}}</strong>\r\n			</div>\r\n			<table>\r\n				<tr ng-repeat="row in item.rows" class="row">\r\n					<td class=\'item\'>\r\n						<div class="rowContent fade-out">{{row.content}}</div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n\r\n	<div ng-switch-default class="qv-tooltip qvt-chart-tooltip" qva-press="hideTooltip($event)" tid="qv-chart-tooltip">\r\n		<div class="immidiate-contextual-arrow"></div>\r\n		<div class="qv-chart-tooltip-inner">\r\n			<div ng-repeat="item in content">\r\n				<div class="qv-chart-tooltip-content">\r\n					<div class=\'header\'>\r\n						<strong>{{item.header}}</strong>\r\n					</div>\r\n					<table>\r\n						<tr ng-repeat="row in item.rows" class="row">\r\n							<td class=\'item\'>\r\n								<div class="rowPart">{{row.label + \':&nbsp;\'}}</div>\r\n							</td>\r\n							<td class=\'value\'>\r\n								<div class="rowPart">{{row.value}}</div>\r\n							</td>\r\n						</tr>\r\n					</table>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div class="qv-chart-tooltip-excess" ng-if="numberInExcess > 0" q-translation="Object.ChartTooltip.NMore,{{numberInExcess}}"></div>\r\n	</div>\r\n</div>'}),define("objects.views/charts/tooltip/chart-tooltip-directive",["jquery","touche","qvangular","general.utils/arrow-positioner","general.utils/window-positioner","core.utils/resize","text!./chart-tooltip.ng.html"],function($,Touche,qvangular,ArrowPositioner,WindowPositioner,resize,template){var innerPadding=5,windowPadding=5,totalArrowPadding=25;qvangular.directive("qvaChartTooltip",function(){return{template:template,replace:!0,scope:{content:"=",position:"=",visible:"=",direction:"=",template:"=",numberInExcess:"=",target:"=",hideCallback:"="},link:function($scope,$element){var toggle,timeoutId,invalidPos=!1;toggle=function(visible){var display=visible?"block":"none";$element.css("display",display)},$scope.synchronAlign=function(){var result,$activeTemplateElement=$element.find(".qv-tooltip"),$arrowElement=$element.find(".immidiate-contextual-arrow");toggle($scope.visible);var dir=$scope.direction instanceof Array?$scope.direction:[$scope.direction];result=WindowPositioner.alignToBestCoordinate($activeTemplateElement,$scope.position,dir,$scope.target,!1,innerPadding,windowPadding);var offset=$activeTemplateElement.offset(),win=$(window),windowWidth=win.outerWidth(),windowHeight=win.outerHeight();switch(result.position){case"right":offset.left+=9,result.y=Math.min(windowHeight-totalArrowPadding,Math.max(totalArrowPadding,result.y));break;case"left":offset.left-=9,result.y=Math.min(windowHeight-totalArrowPadding,Math.max(totalArrowPadding,result.y));break;case"bottom":offset.top+=9,result.x=Math.min(windowWidth-totalArrowPadding,Math.max(totalArrowPadding,result.x));break;default:offset.top-=9,result.x=Math.min(windowWidth-totalArrowPadding,Math.max(totalArrowPadding,result.x))}$activeTemplateElement.offset(offset),$arrowElement.removeClass().addClass("immidiate-contextual-arrow").addClass(result.position),ArrowPositioner.alignToCoordinate($activeTemplateElement,result.x,result.y,result.position,$arrowElement),invalidPos=!1},$scope.align=function(){timeoutId=qvangular.getService("$timeout")($scope.synchronAlign)},$scope.$watch("position",function(value){value&&(value instanceof Array||value.x&&value.y)&&(invalidPos=!0,$scope.align())}),$scope.$watch("visible",function(value){invalidPos||toggle(value)}),$scope.$watch("content",function(value){value||($scope.visible=!1)}),$scope.hideTooltip=function(event){$scope.visible=!1,$scope.hideCallback&&$scope.hideCallback(),event&&event.stopPropagation&&(event.stopPropagation(),event.preventDefault(),Touche.preventGestures())},$scope.$on("$destroy",function(){qvangular.getService("$timeout").cancel(timeoutId),resize.off("end",$scope.hideTooltip)}),resize.on("end",$scope.hideTooltip)}}})}),define("objects.views/charts/tooltip/chart-tooltip-component",["./chart-tooltip-directive"],function(){var component;return component={transclude:!0,template:'<div qva-chart-tooltip position="position" content="content" direction="direction" visible="visible" template="template" number-in-excess="numberInExcess" target="target" hide-callback="hideCallback"></div>',controller:["$scope",function($scope){$scope.visible=!1,this.hide=function(){$scope.visible=!1},this.show=function(input){$scope.content=input.content,$scope.position=input.position,$scope.direction=input.direction,$scope.template=input.template,$scope.numberInExcess=input.numberInExcess,$scope.visible=!0,$scope.hideCallback=input.hideCallback,$scope.target=input.target}}]}}),define("objects.views/charts/tooltip/chart-tooltip-service",["qvangular","core.utils/notification","./chart-tooltip-component","angular"],function(qvangular,Notification,component){"use strict";qvangular.service("qvChartTooltipService",["$document",function($document){var service,ctrl,$body=$document.find("body"),$container=angular.element("<div>").appendTo($body);return service={open:function(input){if(!ctrl){var pos=input.position;input.position=void 0,ctrl=$container.showComponent(component,input),input.position=pos}ctrl.show(input)},close:function(){this.Closed.emit(),ctrl&&ctrl.hide()}},Notification.create(service,"Closed"),service}])}),define("objects.views/selections/types/tooltip",["jquery","./base","qvangular","general.utils/support","objects.utils/shapes/rect","objects.views/charts/tooltip/chart-tooltip-service"],function($,Base,qvangular,Support,Rect){"use strict";function shapeIsNaN(shape){var rect=shape.getBoundingRect();return isNaN(rect.x+rect.y+rect.width+rect.height)}function getTooltipHeader(item){return item.getDimensions().join(", ")}function getPositionsAndDirectionsFromRect(rect,transformFunc,component){return{positions:[transformFunc(rect.x+rect.width/2,rect.y,component),transformFunc(rect.x+rect.width,rect.y+rect.height/2,component),transformFunc(rect.x,rect.y+rect.height/2,component),transformFunc(rect.x+rect.width/2,rect.y+rect.height,component)],directions:["top","right","left","bottom"]}}function showTooltip(items,currentPoint){var pagePoint,localPoint,boundingBox,shapes,content,target,direction,directionPositions,closest=[],component=null,item=items[0];if(this._positionAtMouse)pagePoint=currentPoint||item.interactPosition,localPoint=this.getTransformedPoint(pagePoint.x,pagePoint.y),shapes=item.getShapes(),closest=shapes.filter(function(s){return s.pointInside(localPoint.x,localPoint.y)}),target=closest.length?closest[0]:shapes[0],direction=["top","right","left","bottom"],directionPositions=[pagePoint,pagePoint,pagePoint,pagePoint];else if(item.calculateTooltipPosition&&item.tooltipShape)boundingBox=item.getShapeBounds(item.tooltipShapeComponent),boundingBox&&(component=this.components[item.tooltipShapeComponent]?this.components[item.tooltipShapeComponent][0]:void 0,posAndDir=getPositionsAndDirectionsFromRect(boundingBox,this.getPagePoint.bind(this),component),directionPositions=posAndDir.positions,direction=posAndDir.directions);else{shapes=item.getShapes(),item.tooltipShape&&!shapeIsNaN(item.tooltipShape)?(closest=[item.tooltipShape],component=this.components[item.tooltipShapeComponent]?this.components[item.tooltipShapeComponent][0]:void 0):currentPoint&&(localPoint=this.getTransformedPoint(currentPoint.x,currentPoint.y),closest=shapes.filter(function(s){return s.pointInside(localPoint.x,localPoint.y)})),target=closest.length?closest[0]:shapes[0];var posAndDir;target.getRelevantPosition?(boundingBox=target.getRelevantPosition(),boundingBox.pos&&(pagePoint=this.getPagePoint(boundingBox.pos.x,boundingBox.pos.y,component),directionPositions=[pagePoint,pagePoint,pagePoint,pagePoint]),direction=boundingBox.direction):(boundingBox=target.getBoundingRect(),posAndDir=getPositionsAndDirectionsFromRect(boundingBox,this.getPagePoint.bind(this),component),directionPositions=posAndDir.positions,direction=posAndDir.directions)}content=[];for(var numRows=0,index=0,numberInExcess=0,targetToPageTranslation=this.getPagePoint(0,0,component);MAX_ROWS>numRows&&index<items.length;)content.push({header:getTooltipHeader(items[index]),rows:buildTooltipContent.apply(this,[items[index],target])}),numRows+=content[index].rows.length+1,index++;items.length>index&&(numberInExcess=items.length-index),(pagePoint||directionPositions)&&(qvangular.getService("qvChartTooltipService").open({target:{shape:target,targetToPageTranslation:targetToPageTranslation},position:directionPositions||[pagePoint],content:content,direction:direction,numberInExcess:numberInExcess,hideCallback:onTooltipInternalHide.bind(this)}),currentItem=item,currentItemsIdString=items.map(function(it){return it.id}).join(""))}function buildTooltipContent(item,target){var row,l,value,label,measures,measureIndecies,rows=[],i=0,formatters=this.measureFormatters||[];if(item.isCacheItem)for(measures=item.getMeasures(),measureIndecies=item.getMeasuresIndecies(target),l=measureIndecies.length,i;l>i;++i){var mI=measureIndecies[i];value=item.getValue(mI),label=item.getPreformattedLabel(mI),formatters[measureIndecies[i]]&&(value="U"!==formatters[mI].type&&label?label:formatters[mI].format(value)),measures[mI]&&void 0!==value&&rows.push({label:measures[mI],value:value})}else for(l=item.node.children.length,i;l>i;++i)value=item.node.children[i].children[0].data.qNum||item.node.children[i].children[0].data.qValue,label=item.node.children[i].children[0].data.qText,formatters[i]&&(value="U"!==formatters[i].type&&label?label:formatters[i].format(value)),rows.push({label:item.node.children[i].data.qText,value:value});return this.colorMap&&(row=this.colorMap.getTooltipContent(item.getCombinedElementID?item.getCombinedElementID():item.id),row&&rows.push(row)),rows}function getShapes(currentPoint){var point=this.getTransformedPoint(currentPoint.x,currentPoint.y);return this.shapesFromPoints([point])}function getShapesIds(currentPoint){var shapes=getShapes.call(this,currentPoint);return shapes.map(function(it){return it.id}).join("")}function setupTimeOut(currentPoint){var self=this;this.activeComponent=this.getComponent(currentPoint.x,currentPoint.y),this.tooltipComponentId=tooltipComponentId=this.activeComponent.id;var items=getShapes.call(self,currentPoint);clearHideTimeout(),items&&items.length&&(self._positionAtMouse="MapArea"===self.activeComponent.className,timeOut=qvangular.getService("$timeout")(function(){setupHideTimout(),showTooltip.call(self,items,currentPoint),timeOut=null},500))}function setupTouchTimeout(shapes,timeoutMS){var self=this;this.tooltipComponentId=tooltipComponentId=this.activeComponent.id,timeOut=qvangular.getService("$timeout")(function(){shapes&&shapes.length&&(self._positionAtMouse="MapArea"===self.activeComponent.className,showTooltip.call(self,shapes)),timeOut=null},timeoutMS)}function setupHideTimout(){hideTimeOut=qvangular.getService("$timeout")(function(){hideTooltip()},7e3)}function clearHideTimeout(){qvangular.getService("$timeout").cancel(hideTimeOut),hideTimeOut=null}function clearShowTimeout(){this.tooltipComponentId===tooltipComponentId&&(qvangular.getService("$timeout").cancel(timeOut),timeOut=null,this.prevPoint=null)}function onTooltipInternalHide(){currentItem&&(currentItem=null,currentItemsIdString=null),timeOut=null,clearHideTimeout()}function hideTooltip(){currentItem&&(currentItem=null,currentItemsIdString=null,qvangular.getService("$timeout")(function(){qvangular.getService("qvChartTooltipService").close()})),timeOut=null,clearHideTimeout()}function pointInsideShapes(p,shapes){var i,childShape,n=shapes?shapes.length:0;for(i=0;n>i;i++)if(childShape=shapes[i],childShape&&childShape.pointInside&&childShape.pointInside(p.x,p.y))return!0;return!1}function findShapesOfInteraction(shapes){var i,childShapes,p,numShapes=shapes?shapes.length:0,interactedShapes=[];for(i=0;numShapes>i;i++)childShapes=shapes[i]._shapes,p||(p=shapes[i]._interactPosition,p&&(p=this.getTransformedPoint(p.x,p.y))),p&&pointInsideShapes(p,childShapes)&&(interactedShapes[interactedShapes.length]=shapes[i]);return interactedShapes.length||interactedShapes.push(shapes),interactedShapes}var Tooltip,timeOut,hideTimeOut,currentItem,currentItemsIdString,tooltipComponentId,touchOn=!0,MAX_ROWS=7;return Tooltip=Base.extend("ChartTooltip",{init:function(handler,options){this._super(handler,options),currentItem=null,this._positionAtMouse=!1,timeOut=null,this.name="tooltip",touchOn=!Support.treatAsDesktop(),touchOn&&handler.ToggleTooltip.bind(this.updateHighlightedShape.bind(this)),this.enabled=!0,this._allowNullSelect=!0,this.touchTimeout=options.touchTimeout},initComponent:function(point){this.activeComponent=this.getComponent(point.x,point.y)},updateHighlightedShape:function(shapes,disableSelections){if(shapes.length>=1){var interactedShapes,hide=!0,show=!1;if(interactedShapes=findShapesOfInteraction.call(this,shapes),!interactedShapes||!interactedShapes.length)return;touchOn&&(interactedShapes=interactedShapes.filter(function(shape){return disableSelections?!0:shape.selected}),interactedShapes&&interactedShapes.length&&(currentItem||timeOut?(interactedShapes.length>1||interactedShapes[0]!==currentItem)&&(hide=show=!0):(hide=!1,show=!0)),hide&&(clearShowTimeout.call(this),clearHideTimeout(),hideTooltip.call(this)),show&&setupTouchTimeout.call(this,interactedShapes,this.touchTimeout))}else touchOn&&disableSelections&&(clearShowTimeout.call(this),clearHideTimeout(),hideTooltip.call(this))},getRect:function(component){return component?component.hasOwnProperty("innerRect")?component.innerRect:component.rect:new Rect(0,0,0,0)},move:function(e,currentPoint){!touchOn&&this.enabled&&(null!==timeOut?(!this.prevPoint||currentPoint.distanceTo(this.prevPoint)>5)&&(clearShowTimeout.call(this),setupTimeOut.call(this,currentPoint)):(this.prevPoint=currentPoint,currentItem?getShapesIds.call(this,currentPoint)!==currentItemsIdString?(hideTooltip.call(this),setupTimeOut.call(this,currentPoint)):(clearHideTimeout(),setupHideTimout()):setupTimeOut.call(this,currentPoint)))},leave:function(e){var newTarget=e.toElement||e.relatedTarget;$(newTarget).hasClass("qvt-chart-tooltip")||$(newTarget).parents(".qvt-chart-tooltip").length||(clearShowTimeout.call(this),hideTooltip.call(this))},cancel:function(){clearShowTimeout.call(this),hideTooltip.call(this)},clearSelection:function(){clearShowTimeout.call(this),hideTooltip.call(this)}}),Tooltip.defaultOptions={},Tooltip}),define("objects.views/selections/handler",["jquery","core.utils/notification","client.utils/state","core.utils/class","./types/data-area","./types/range/range-angular","./types/color-legend","./types/tooltip","objects.utils/shapes/rect","objects.utils/shapes/point","general.utils/support"],function($,Notification,state,Class,DataArea,Range,ColorLegend,Tooltip,Rect,Point,Support){function createTypes(options){Object.keys(options).forEach(function(key){key in validTypes&&(this.types[key]=new validTypes[key](this,$.extend(!0,{},validTypes[key].defaultOptions,options[key])))},this)}function checkDimensionsOverlap(arr1,arr2){var i;for(i=0;i<arr2.length;i++)if(arr1.contains(arr2[i]))return!0;for(i=0;i<arr1.length;i++)if(arr2.contains(arr1[i]))return!0;return!1}var Selections,startPoint,$document=$(document),expando=0,getNS=function(){return".selections-"+ ++expando},validTypes={dataArea:DataArea,range:Range,colorLegend:ColorLegend,tooltip:Tooltip};return Selections=Class.extend({init:function(container,options,cache){Notification.mixin(this),this.notification("Activated"),this.notification("Deactivated"),this.notification("ToggleShape"),this.notification("ToggleShapes"),this.notification("ToggleTooltip"),this.notification("SelectWhileLocked"),this.notification("Pan"),this.notification("Lasso"),this.notification("Confirm"),this.notification("Cancel"),this.notification("Select"),this.notification("SelectRange"),this.notification("Clear"),this.notification("ResetSelections"),this._active=!1,this._autoActivated=!1,this._isListening=!1,this._isScrolling=!1,this._isLocked=!1,this._shiftPressed=!1,this._lassoEnabled=!1,this.container=container,this.options=$.extend(!0,{},{getSelectionType:function(currentPoint,usingMove){var containerRect=this.containerRect,useMove=usingMove||!1,point=new Point(currentPoint.x-containerRect.x,currentPoint.y-containerRect.y);return Object.keys(this.types).map(function(key){return this.types[key]},this).filter(function(type){return Object.keys(type.components).map(function(key){return type.components[key]}).filter(function(components){return components.filter(function(component){var rect=type.getExtendedRect?type.getExtendedRect(component):type.getRect(component);return rect===containerRect&&(point.x+=containerRect.x,point.y+=containerRect.y),useMove?"tooltip"===type.name&&("function"==typeof component.isVisible?component.isVisible():!0)&&rect.pointInside(point.x,point.y):"tooltip"!==type.name?("function"==typeof component.isVisible?component.isVisible():!0)&&rect.pointInside(point.x,point.y):void 0}).length>0})[0]},this)[0]},toggle:!0,toggleRect:!0,swipe:!0,autoSwipe:!1,ctrlKeyAsToggleSelected:!1},options),this.cache=cache,this.containerRect=new Rect(0,0,0,0),this.eventNS=getNS(),this.types={},this._keyboard=!0,createTypes.call(this,this.options)},setContainer:function($element){this.off(),this.container=$element,this.on()},refreshContainerRect:function(){var offset=this.offset=this.container.offset(),width=this.container.width(),height=this.container.height();this.containerRect.set(offset.left,offset.top,width,height)},on:function(){function init(point){startPoint=point,handler.refreshContainerRect(),type=opts.getSelectionType.call(handler,point),type&&type.initComponent(point),tooltipType=opts.getSelectionType.call(handler,point,!0),tooltipType&&tooltipType.initComponent(point)}function activateType(){if(handler._activeType&&handler._activeType!==type){var currentActiveDimensions=handler._activeType.getActiveDimensions();handler._activeType.cancel(),handler._activeType.getActiveMode()===type.getActiveMode()&&checkDimensionsOverlap(currentActiveDimensions,type.getActiveDimensions())||(handler._activeType.clearSelection(),handler.ResetSelections.emit())}handler._activeType=type,handler._tooltipType=tooltipType=handler.types.tooltip}function activate(){activateType(),opts._disableSelectionActivation||handler.activate()}function canBeActivated(){return(state.state===state.States.analysis||state.state===state.States.play)&&!handler._isScrolling}function isActive(){return handler._active&&!state.isInEditMode()}function isMultiSelect(){return type&&opts.swipe&&canBeActivated()}function isMouse(e){return Support.isMouse(e)}if(!this._isListening){this._isListening=!0;var type,tooltipType,handler=this,opts=this.options;this._reset=function(){type=null,tooltipType=null},this.getActiveType=function(){return handler._activeType},this.getActiveTooltip=function(){return handler._tooltipType},this.getActiveMode=function(){return handler._activeType?handler._activeType.getActiveMode():null},this._setTypeOnAutoActivate=function(){type=handler.types.dataArea},this._activateType=function(t){type=t,activateType()},$document.off(handler.eventNS),$document.on("mouseup"+handler.eventNS,function(e){1===e.which&&!handler._shiftPressed&&handler._drawingLassoWithShift&&handler.Lasso.emit(!1)}),$document.on("keydown"+handler.eventNS,function(e){handler._keyboard&&16===e.which&&(!handler._shiftPressed&&handler._active&&handler.Lasso.emit(!handler._lassoEnabled),handler._shiftPressed=!0)}),$document.on("keyup"+handler.eventNS,function(e){handler._keyboard&&(16===e.which&&(handler._shiftPressed&&handler._active&&!handler._drawingLassoWithShift&&handler.Lasso.emit(handler._lassoEnabled),handler._shiftPressed=!1),isActive()&&(27===e.which?handler.cancel():13===e.which&&(type&&type.getIsEditing&&type.getIsEditing()?type.confirmEdit():handler.confirm())))}),this._onMouseMove=function(e){var p=new Point(e.pageX,e.pageY),oldTooltipType=tooltipType;handler.refreshContainerRect(),tooltipType=opts.getSelectionType.call(handler,p,!0),oldTooltipType&&oldTooltipType!==tooltipType&&oldTooltipType.cancel(),tooltipType&&(tooltipType.move.call(tooltipType,e,p),handler._tooltipType=tooltipType)},this._onMouseLeave=function(e){tooltipType&&tooltipType.leave(e)},this.types.tooltip&&Support.treatAsDesktop()&&(this.container.on("mousemove",this._onMouseMove),this.container.on("mouseleave",this._onMouseLeave),$document.on("mouseleave"+handler.eventNS,this._onMouseLeave)),this.types.range&&this.types.range.on&&this.types.range.on();var swipeActive=!1;Touche(this.container[0]).tap({id:this.eventNS,options:{preventDefault:opts.swipe},start:function(e,data){canBeActivated()&&(opts.autoSwipe&&isMouse(e)&&(opts.swipe=!0),init(data.pagePoints[0]))},end:function(e,data){if(canBeActivated()&&type&&!type.internal&&opts.toggle){if(handler._isLocked)return void handler.SelectWhileLocked.emit();activate(),Touche.preventGestures(this.gestureHandler),type.toggle.call(type,e,data.pagePoints[0]),"range"===type.getActiveMode()?type.selectRange():type.getSelectedShapes().length>0&&handler.Select.emit(type.getSelectedShapes(),handler.getKeyAsToggleSelected(e))}}}).tap({id:this.eventNS,options:{touches:2,preventDefault:opts.swipe},end:function(e,data){if(canBeActivated()&&opts.toggleRect&&(init(data.pagePoints[0]),type&&opts.toggle)){if(handler._isLocked)return void handler.SelectWhileLocked.emit();activate(),type.toggleRect.call(type,e,data.pagePoints[0],data.pagePoints[1])}}}).swipe({id:this.eventNS,options:{preventDefault:opts.swipe,useMomentum:!0,inertia:.5,radiusThreshold:6},start:function(e,data){if((isMultiSelect()||opts._enablePanning)&&(this.options.useMomentum=!0,tooltipType&&tooltipType.cancel(),handler._shiftPressed&&!handler._active&&handler.Lasso.emit(!handler._lassoEnabled),type)){if(!handler._lassoEnabled&&type.activeComponent&&"dataArea"===type.activeComponent.selectionIdentifier)return handler.Pan.emit("start",e,data),void(this._isPanning=!0);if(handler._lassoEnabled||!type.activeComponent||"colorLegend"!==type.activeComponent.selectionIdentifier)return swipeActive=!0,handler._isLocked?void handler.SelectWhileLocked.emit():(activate(),handler._drawingLassoWithShift=handler._shiftPressed,this.options.useMomentum=!1,type.start.call(type,e,startPoint),void 0)}},update:function(e,data){if(isMultiSelect()||opts._enablePanning)if(this._isPanning)handler.Pan.emit("update",e,data);else if(swipeActive&&type){if(handler._isLocked)return void handler.SelectWhileLocked.emit();type.update.call(type,e,data.pagePoints[0])}},end:function(e,data){if(isMultiSelect()||opts._enablePanning)if(this._isPanning)handler.Pan.emit("end",e,data),this._isPanning=!1;else if(swipeActive&&type){if(swipeActive=!1,handler._isLocked)return void handler.SelectWhileLocked.emit();handler._drawingLassoWithShift=!1,type.end.call(type,e,data)}},cancel:function(){type&&swipeActive&&(type.cancel.call(type,!0),tooltipType&&tooltipType.cancel.call(tooltipType,!0))}})}},off:function(){this.container.off(this.eventNS),this.container.off("mousemove",this._onMouseMove),this.container.off("mouseleave",this._onMouseLeave),Touche(this.container[0]).off("*",this.eventNS),$document.off(this.eventNS),this.types.range&&this.types.range.off&&this.types.range.off(),this._isListening=!1},autoActivate:function(){!this._autoActivated&&this._isListening&&(this._autoActivated=!0,this._setTypeOnAutoActivate(),this._activeType=this.types.dataArea,this._activeType.initComponent(),this.activate())},activate:function(type){this._active||(this.Activated.emit(),this._active=!0),type&&this._activateType(type)},deactivate:function(confirm){this._active&&(this._active=!1,this._autoActivated=!1,confirm||this.clearSelection(),this._activeType&&(this._activeType.cancel(),this._activeType=void 0),this._tooltipType&&(this._tooltipType.cancel(),this._tooltipType=void 0),this.Deactivated.emit(),this._reset())},confirm:function(){this._activeType&&this.deactivate(!0),this.Confirm.emit()},cancel:function(){this.deactivate(),this.Cancel.emit()},clearSelection:function(){this._activeType&&this._activeType.clearSelection(),this.types.tooltip&&this.types.tooltip.cancel()},toggleKeyboardAccelerators:function(keyboard){this._keyboard=keyboard},getKeyAsToggleSelected:function(e){
return!(e.metaKey||e.ctrlKey)},release:function(){this.off(),Notification.release(this),Object.keys(this.types).forEach(function(key){this.types[key].release()},this)},toggleScrolling:function(scrolling){scrolling=scrolling||!1,this._isScrolling=scrolling},setLocked:function(lock){this._isLocked=lock},setLassoEnabled:function(enabled){this._lassoEnabled=enabled}})}),define("objects.views/selections/cache-item-base",["core.utils/class"],function(Class){"use strict";function shapeIsNaN(shape){var rect=shape.getBoundingRect();return isNaN(rect.x+rect.y+rect.width+rect.height)}var CacheItem=Class.extend({init:function(dimensions,measures,values,labels,row,col,id){if(dimensions&&!(dimensions instanceof Array)||measures&&!(measures instanceof Array)||values&&!(measures instanceof Array)||labels&&!(values instanceof Array))throw"The dimensions, measures and values input must be undefined or arrays";this.selected=!1,this.highlighted=!1,this.values=values||[],this.labels=labels||[],this.row=row,this.col=col,this.id=id,this.parent=void 0,this.children=[],this._dimensions=dimensions||[],this._measures=measures||[],this._objectShapes={},this._shapes=[],this._tooltipShape=void 0,this._tooltipShapeComponent=void 0},get siblings(){return this._parent?this._parent.children:[]},clearShapes:function(id){id&&this._objectShapes[id]&&(this._objectShapes[id]=[]),this._shapes=[];for(var i in this._objectShapes)this._shapes=this._shapes.concat(this._objectShapes[i])},getShapes:function(id){return id?this._objectShapes[id]||(this._objectShapes[id]=[]):this._shapes},getShapeBounds:function(id){if(this._calculateTooltipPosition&&id){var shapes=this.getShapes(id),bounds=shapes.map(function(s){return s.getBoundingRect()});if(bounds=bounds.filter(function(r){return!shapeIsNaN(r)}),bounds.length){var rect=bounds.reduce(function(prev,current){return prev.combineWith(current)},bounds[0]);return rect}return null}return null},addShape:function(id,shape,isTooltipHandle){if(shape instanceof Array&&(!shape[0].pointInside||!shape[0].getBoundingRect)||!shape.pointInside||!shape.getBoundingRect)throw"The shape must implement a `pointInside` function";this._objectShapes[id]instanceof Array||(this._objectShapes[id]=[]),this._objectShapes[id].push(shape),this._shapes.push(shape),isTooltipHandle&&(this._tooltipShape=shape,this._tooltipShapeComponent=id)},addMeasure:function(measureName,value,label){this.values.push(value),this.labels.push(label),this._measures.push(measureName)},getMeasures:function(){return this._measures},getMeasuresIndecies:function(){return this._measures.map(function(item,index){return index})},addDimension:function(dimension){this._dimensions.push(dimension)},getDimensions:function(){return this._dimensions},getValue:function(measureIndex){return measureIndex=measureIndex||0,this.values[measureIndex]},getPreformattedLabel:function(measureIndex){return measureIndex=measureIndex||0,this.labels[measureIndex]},getCombinedElementID:function(){for(var current=this,ret=[current.id];current.parent;)current=current.parent,ret.push(current.id);return ret.reverse(),ret.join(",")}});return CacheItem.prototype.isCacheItem=!0,Object.defineProperties(CacheItem.prototype,{tooltipShape:{get:function(){return this._tooltipShape}},calculateTooltipPosition:{set:function(v){this._calculateTooltipPosition=v},get:function(){return this._calculateTooltipPosition}},interactPosition:{set:function(v){this._interactPosition=v},get:function(){return this._interactPosition}},tooltipShapeComponent:{get:function(){return this._tooltipShapeComponent}},label:{get:function(){throw new Error("CacheItem: label: Removed functionality")}},shape:{get:function(){throw new Error("CacheItem: shape: Removed functionality")}},value:{get:function(){throw new Error("CacheItem: value: Removed functionality")}}}),CacheItem}),define("objects.views/selections/cache",["./cache-item","./cache-item-base"],function(CacheItem,CacheItemBase){"use strict";function Cache(){this.data=[]}return Object.defineProperties(Cache.prototype,{has:{value:function(o){return-1!==this.data.indexOf(o)}},add:{value:function(o){if(!(o instanceof CacheItem||o instanceof CacheItemBase))throw"Invalid cache item!";this.has(o)||this.data.push(o)}},remove:{value:function(o){var index=this.data.indexOf(o);-1!==index&&this.data.splice(index,1)}},clear:{value:function(){this.data.length=0}}}),Cache}),define("objects.extension/default-view-selection-service",["qvangular","objects.views/selections/handler","objects.views/selections/cache"],function(qvangular,Selections,SelectionsCache){"use strict";qvangular.service("qvDefaultViewSelectionService",[function(){return{createSelections:function($scope,$element,selectionsOpts){var selections,selectionsDeactivatedFn;if(selectionsOpts&&selectionsOpts.dataArea)return selectionsOpts.isPopover=$scope.options.isPopover,selectionsOpts.selectionsDisabled=$scope.options.selectionsDisabled||!1,selections=new Selections($element,selectionsOpts,new SelectionsCache),selections.Activated.bind(function(){$scope.selectionsApi.activated()}),selections.Deactivated.bind(function(){$scope.selectionsApi.deactivateSearch&&$scope.selectionsApi.deactivateSearch()}),selections.Cancel.bind(function(){$scope.selectionsApi.cancel()}),selections.Select.bind(function(){$scope.selectionsApi.selectionsMade=!0}),selections.SelectRange.bind(function(){$scope.selectionsApi.selectionsMade=!0}),selections.Confirm.bind(function(){$scope.backendApi.endSelections(!0),$scope.selectionsApi.deactivated()}),selections.ResetSelections.bind(function(){$scope.backendApi.clearSelections()}),$scope.selectionsApi.confirm=function(){selections&&selections.confirm()},selectionsDeactivatedFn=$scope.selectionsApi.deactivated.bind($scope.selectionsApi),$scope.selectionsApi.deactivated=function(){selections&&selections.deactivate(),selectionsDeactivatedFn()},$scope.selectionsApi.deactivate=function(){selections&&(selections.deactivate(),this.deactivated())},$scope.selectionsApi.clear=function(){selections.clearSelection(),$scope.backendApi.clearSelections(),$scope.selectionsApi.selectionsMade=!0},$scope.selectionsApi.toggleKeyboardAccelerators=function(keyboard){selections.toggleKeyboardAccelerators(keyboard)},$scope.selectionsApi.getKeyAsToggleSelected=function(e){return selections.getKeyAsToggleSelected(e)},$scope.selectionsApi.toggleSearch=function(){$scope.options.search.toggle()},$scope.selectionsApi.activate=function(){selections.autoActivate()},$scope.selectionsApi.on=function(){selections.on()},$scope.selectionsApi.off=function(){selections.off()},$scope.$on("$destroy",function(){selections&&(selections.release(),selections=null)}),selections}}}])}),define("objects.extension/controller",["objects.extension/base-controller","util","core.utils/deferred","objects.extension/default-view-selection-service"],function(BaseController,util,Deferred){"use strict";var Controller;return Controller=BaseController.extend({$scope:null,$element:null,api:null,view:null,create:function($scope,$element,View,viewOptions,selectionOptions,backendApi){var view=this.createView($scope,$element,View,viewOptions,backendApi),selOpts=util.extend(!0,{},selectionOptions,viewOptions.selections||{});return this.createSelections(view,$scope,$element,selOpts),view},createView:function($scope,$element,View,options,backendApi){return new View($scope,$element,options,backendApi)},createSelections:function(view,$scope,$element,options){var selections=this.selectionService.createSelections($scope,$element,options);return view.setSelections(selections),selections},init:function($scope,$element,selectionService){this.$scope=$scope,this.$element=$element,this.selectionService=selectionService;var self=this,view=this.view=this.create($scope,$element,$scope.ext.View,$scope.options,$scope.ext.options.selections,$scope.backendApi);view.initialize(),this.handleSpecialCaseForSyntaxSugarInExtension(view),$scope.$on("$destroy",function(){view&&(view.destroy(view),self.$scope.options=null,self.view=null,view=null)})},handleSpecialCaseForSyntaxSugarInExtension:function(view){var key,extension=this.$scope.object.ext;for(key in extension)"View"!==key&&"constructor"!==key&&"options"!==key&&view[key]&&(view[key]=extension[key])},onPaint:function(visible){var updateDataPromise,self=this;return this.view?this.view.suppressOnPaint(this.$scope.layout)?Deferred.resolve():(this.view.refreshSelections(),visible?(this.view.prePaint(this.$scope.layout),updateDataPromise=this.view.updateData(this.$scope.layout),updateDataPromise&&updateDataPromise.then?updateDataPromise.then(function(){return self.view.paint(self.view.$element,self.$scope.layout)}):self.view.paint(self.view.$element,self.$scope.layout)):(updateDataPromise=this.view.updateData(this.$scope.layout),updateDataPromise&&updateDataPromise.then?this.view.updateData(this.$scope.layout):Deferred.resolve())):Deferred.resolve()},onResize:function(){return this.view.refreshSelections(),this.view.resize(this.view.$element,this.$scope.layout)},onStateChanged:function(state){this.view.allowInteraction(state)?this.view.on():this.view.off(),this.view.onStateChanged(state)},setBackendApi:function(backendApi){this.view.setBackendApi(backendApi)},setSnapshotData:function(snapshotLayout,options){return this.view.setSnapshotData(snapshotLayout,options)},getContextMenu:function(object,menu){return this.view.getContextMenu(object,menu)},getSelectionToolbar:function(){return this.view.getSelectionToolbar()},allowInteraction:function(state){return this.view.allowInteraction(state)},setInteraction:function(on){this.view.setInteraction(on)},getViewState:function(){return this.view.getViewState()}}),Controller.$inject=["$scope","$element","qvDefaultViewSelectionService"],Controller}),define("objects.extension/qv-extension",["qvangular","objects.extension/controller"],function(qvangular,controller){"use strict";qvangular.directive("qvExtension",function(){return{require:["qvExtension","^qvObject"],controller:controller,link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1];objectCtrl.addChildController(ctrl)}}})}),define("objects.extension/extension-type",["jquery","core.utils/class","general.utils/property-mapper","objects.extension/default-extension","util","qvangular","core.utils/deferred","objects.models/visualization-object","objects.extension/default-view","require","objects/inline-title-edit","objects.extension/qv-extension"],function($,Class,PropertyMapper,defaultExtension,util,qvangular,Deferred,VisualizationObject,DefaultView,require){function fillInDefault(extType,ext){var _ext=util.extend(!0,{},defaultExtension,ext);return _ext.libraryInfo=extType.getLibraryInfo(),_ext}function loadExtension(extType){var defer,path=extType.path;return _extensions[path]||(defer=Deferred(),require([path],function(xt){qvangular.$rootScope.$apply(function(){defer.resolve(fillInDefault(extType,xt))})},function(err){defer.reject(err)}),_extensions[path]=defer.promise),_extensions[path]}function isObject(o){return"[object Object]"===Object.prototype.toString.call(o)}function getDefaultTypeTranslationKey(type){var translationKey="";switch(type.toLowerCase()){case"listbox":translationKey="Object.Listbox";break;case"barchart":translationKey="Object.BarChart";break;case"combochart":translationKey="Object.ComboChart";break;case"filterpane":translationKey="Object.FilterPane";break;case"gauge":translationKey="Object.Gauge";break;case"kpi":translationKey="Object.Kpi";break;case"linechart":translationKey="Object.LineChart";break;case"piechart":translationKey="Object.PieChart";break;case"pivot-table":translationKey="Object.PivotTable";break;case"scatterplot":translationKey="Object.ScatterPlot";break;case"table":translationKey="Object.Table";break;case"treemap":translationKey="Object.Treemap";break;case"text-image":translationKey="Object.TextImage";break;case"sheet":translationKey="Common.Sheet";break;case"objectlibrary":translationKey="Object.ObjectLibrary";break;case"libraryobject":translationKey="Object.LibraryObject";break;case"map":translationKey="Object.Map";break;default:translationKey=""}return translationKey}function getIconName(value){switch(value.toLowerCase()){case"barchart":return"bar-chart-vertical";case"linechart":return"line-chart";case"table":return"table";case"pivot-table":return"pivot-table";case"components":return"components";case"piechart":return"pie-chart";case"filterpane":return"filterpane";case"listbox":return"list";case"gauge":return"gauge-chart";case"kpi":return"kpi";case"scatterplot":return"scatter-chart";case"text-image":return"text-image";case"treemap":return"treemap";case"map":return"map";case"combochart":return"combo-chart";default:return"extension"}}function getDefaultTemplateIconClassName(value){return"icon-"+getIconName(value)}function getTemplateIconFromIcon(icon){if(!icon)return"icon-extension";switch(icon.toLowerCase()){case"bar-chart-vertical":return"icon-bar-chart-vertical";case"line-chart":return"icon-line-chart";case"table":return"icon-table";case"pivot-table":return"icon-pivot-table";case"components":return"icon-components";case"pie-chart":return"icon-pie-chart";case"filterpane":return"icon-filterpane";case"list":return"icon-list";case"gauge-chart":return"icon-gauge-chart";case"kpi":return"icon-kpi";case"scatter-chart":return"icon-scatter-chart";case"text-image":return"icon-text-image";case"text":return"icon-titletext";case"map":return"icon-map";case"combo-chart":return"icon-combo-chart";default:return"icon-extension"}}function getDefaultLibraryInfo(type){var isLibraryItem=0!==type.indexOf("listbox");return{name:type,descriptionKey:"Template.preview.description."+type,translationKey:getDefaultTypeTranslationKey(type),template:type,templateIconClassName:getDefaultTemplateIconClassName(type),icon:getIconName(type),author:"Qlik",isThirdParty:!1,isLibraryItem:isLibraryItem}}var ExtensionType,_extensions={};qvangular.componentDirective("qvaIncludeObject",{model:"=",ext:"=",options:"="});var FONTMAP={"bar-chart-vertical":"!","line-chart":"%","pie-chart":"&",list:"-",table:"'","pivot-table":"(",filterpane:".","scatter-chart":"+","text-image":"/","gauge-chart":")",kpi:"1",treemap:"",map:",","combo-chart":"","":"E"};return ExtensionType=Class.extend("ExtensionType",{init:function(options){this.type=options.type,this.path=options.path,this.libraryInfo=options.libraryInfo||getDefaultLibraryInfo(options.type),this.components=options.components||[],this.libraryInfo.templateIconClassName||(this.libraryInfo.templateIconClassName=getTemplateIconFromIcon(this.libraryInfo.icon))},getLibraryInfo:function(){return this.libraryInfo},getTemplateIconClassName:function(){return this.libraryInfo.templateIconClassName},getIconChar:function(){return FONTMAP[this.libraryInfo.icon]?FONTMAP[this.libraryInfo.icon]:"g"},getModelCtor:function(){return loadExtension(this).then(function(ext){return ext.Model})},getInitialProperties:function(init){var that=this;return loadExtension(that).then(function(ext){var initProps=util.extend(!0,{qInfo:{qType:that.type},visualization:that.type},ext.initialProperties,init);return ext.libraryInfo.version&&!initProps.version&&(initProps.version=ext.libraryInfo.version),PropertyMapper.mapProperties(ext.definition,initProps,that.type)})["catch"](function(){return{qInfo:{qType:that.type},visualization:that.type}})},load:function(){return loadExtension(this).then(function(extension){var key;if(extension.View)for(key in DefaultView)DefaultView.hasOwnProperty(key);return isObject(extension.view)&&(extension.View=DefaultView.extend(extension.view)),void 0===extension.View&&(extension.View=DefaultView),util.extend(!0,{},extension)})},getExtensionType:function(){return loadExtension(this)}}),ExtensionType.addObject=function(element,id,app){var dfd=new Deferred;return require(["objects/object"],function(){var $element=$(element);$element.html('<qv-object model="model" options="options"></qv-object>');var $scope=qvangular.$rootScope.$new(),vis=VisualizationObject.get(id,app);vis.then(function(model){$scope.model=model,$scope.options={};var $compile=qvangular.getService("$compile");$compile($element.contents())($scope),qvangular.$apply($scope),dfd.resolve(vis)},function(error){dfd.reject(error)})}),dfd.promise},ExtensionType}),define("objects.utils/type-loader",["core.utils/deferred","general.utils/visualizations","objects.extension/extension-type","general.models/library/extension-list"],function(Deferred,visualizations,ExtensionType,ExtensionsListModel){function createLibraryInfo(name,data){return data=data||{},data.previewIconURL||data.preview&&data.preview.indexOf(".png")>0&&(data.previewIconURL="../extensions/"+name+"/"+data.preview),data.icon=data.icon||"extension",data.description=data.description||data.name,data.template=data.template||name,data.isLibraryItem=data.isLibraryItem===!1?!1:!0,data.isThirdParty=!0,data.name=data.name||data.template||name,data}function registerExtension(ext){ext.data&&"visualization"===ext.data.type&&visualizations.registerType(ext.id,new ExtensionType({type:ext.id,path:"extensions/"+ext.id+"/"+ext.id,libraryInfo:createLibraryInfo(ext.id,ext.data)}))}function load(skipThirdParty){return null===deferred&&(deferred=new Deferred,visualizations.registerType("listbox",new ExtensionType({type:"listbox",path:"extensions.qliktech/listbox/listbox"})),visualizations.registerType("filterpane",new ExtensionType({type:"filterpane",path:"extensions.qliktech/filterpane/filterpane",components:["extensions.qliktech/filterpane/properties/filterpane-data/filterpane-data","extensions.qliktech/filterpane/properties/filterpane-sorting/filterpane-sorting"]})),visualizations.registerType("gauge",new ExtensionType({type:"gauge",path:"extensions.qliktech/gauge/gauge"})),visualizations.registerType("kpi",new ExtensionType({type:"kpi",path:"extensions.qliktech/kpi/kpi"})),visualizations.registerType("table",new ExtensionType({type:"table",path:"extensions.qliktech/straight-table/straight-table",components:["extensions.qliktech/straight-table/properties/columns/columns"]})),visualizations.registerType("pivot-table",new ExtensionType({type:"pivot-table",path:"extensions.qliktech/pivot-table/pivot-table",components:["extensions.qliktech/pivot-table/properties/pivot-data/pivot-data","extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting"]})),visualizations.registerType("barchart",new ExtensionType({type:"barchart",path:"extensions.qliktech/barchart/barchart"})),visualizations.registerType("piechart",new ExtensionType({type:"piechart",path:"extensions.qliktech/piechart/piechart"})),visualizations.registerType("scatterplot",new ExtensionType({type:"scatterplot",path:"extensions.qliktech/scatterplot/scatterplot"})),visualizations.registerType("linechart",new ExtensionType({type:"linechart",path:"extensions.qliktech/linechart/linechart"})),visualizations.registerType("combochart",new ExtensionType({type:"combochart",path:"extensions.qliktech/combochart/combochart"})),visualizations.registerType("treemap",new ExtensionType({type:"treemap",path:"extensions.qliktech/treemap/treemap"})),visualizations.registerType("map",new ExtensionType({type:"map",path:"extensions.qliktech/map/map",components:["extensions.qliktech/map/properties/layers"]})),visualizations.registerType("text-image",new ExtensionType({type:"text-image",path:"extensions.qliktech/text-image/text-image"})),visualizations.registerType("widget",new ExtensionType({type:"widget",path:"extensions.qliktech/widget/widget",libraryInfo:createLibraryInfo("widget",{name:"Widget",description:"Qlik Sense Widget",isLibraryItem:!1})})),skipThirdParty?deferred.resolve():ExtensionsListModel.getList().then(function(extensionList){extensionList.forEach(function(ext){registerExtension(ext)}),deferred.resolve()})),deferred.promise}var deferred=null;return{load:load,registerExtension:registerExtension}}),define("text!objects/object.ng.html",[],function(){return'<div class="qv-object-wrapper">\r\n	<article class="qv-object qvt-visualization" ng-class="classList" qva-activate="takeSnapshot($event)" tid="{{objectClass}}">\r\n\r\n		<qv-rain ng-if="object.throbberApi.isVisible" show="object.throbberApi.isVisible" resize="object.throbberApi.watchResize"></qv-rain>\r\n\r\n		<div class="retry-overlay" ng-if="object.throbberApi.isQueryCanceled">\r\n			<ul class="cancelled-list">\r\n				<li>\r\n					<div class="retry-text" q-translation="Object.Cancelled"></div>\r\n				</li>\r\n				<li>\r\n					<button class="retry-button qui-outlinebutton" qva-activate="retry()" q-translation="Dialog.Button.Retry" tid="retry-calculations"></button>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n		<div class="cancel-overlay" ng-if="object.throbberApi.isLongRunningQuery">\r\n			<button class="cancel-button qui-outlinebutton" ng-if="!object.throbberApi.isQueryCanceled" qva-activate="cancel()"\r\n					q-translation="Common.Cancel" tid="cancel-calculations"></button>\r\n		</div>\r\n\r\n		<button ng-if="showSnapshotCount" class="snapshotcounter qui-iconbt" qva-activate="openSnapshotLibrary($event, \'snapshot\')">\r\n			<i class="icon-snapshot"></i><span>{{snapshotCount}}</span>\r\n		</button>\r\n\r\n		<header class="qv-object-header" ng-show="object.hasFrame && object.showTitles">\r\n			<h1 ng-attr-title="{{layout.title}}" class="qv-object-title qvt-visualization-title" qva-activate="titleClicked();">\r\n				<a ng-if="!editmode && options.showSearch && !object.isReadonly" q-title-translation="Common.Search" class="qv-object-search icon-magnifying-glass"\r\n					qva-activate="options.showSearch && options.search.toggle()"></a>\r\n				<span ng-if="!editmode || editmode && object.isReadonly" qve-highlight text="{{layout.title}}" query="options.highlightQuery"></span>\r\n				<span ng-if="options.showDisclaimerStar && !!layout.title && !editmode" class="disclaimer">*</span>\r\n				<div ng-if="editmode && !object.isReadonly" qv-inline-title-edit x-model="model" x-property-path="title" x-layout-path="title"\r\n					 x-empty-translation="Object.AddTitle"></div>\r\n			</h1>\r\n\r\n			<h2 ng-attr-title="{{layout.subtitle}}" ng-show="!!layout.subtitle" class="qv-object-subtitle qvt-visualization-subtitle">{{layout.subtitle}}</h2>\r\n		</header>\r\n\r\n		<div class="qv-object-content-container">\r\n			<div class="qv-object-content" qv-object-content component="object.content" options="options" object="object" backend-api="object.backendApi" layout="layout"\r\n				 ext="object.ext" selections-api="object.selectionsApi" throbber-api="object.throbberApi">\r\n			</div>\r\n		</div>\r\n\r\n		<footer ng-attr-title="{{layout.footnote}}" ng-show="object.hasFrame && object.showTitles && !!layout.footnote" class="qv-object-footnote qvt-visualization-footnote">{{layout.footnote}}</footer>\r\n	</article>\r\n\r\n	<qv-soft-property-panel object="object" ng-if="options.isZoomed && object.hasSoftProperties" can-save-soft-properties="options.canSaveSoftProperties" ng-hide="!object.showExploreMenu"></qv-soft-property-panel>\r\n\r\n	<div ng-if="navMenu.active" class="qv-object-nav" ng-class="{\'zero-top\' : options.isZoomed, \'visible\': navMenu.visible}">\r\n		<a ng-repeat="menuItem in navMenu.items"\r\n		   ng-if="menuItem.isVisible()"\r\n		   ng-class="[menuItem.cssClasses, menuItem.dynamicCssClasses()]"\r\n		   qva-activate="menuItem.action()"\r\n		   q-title-translation="{{menuItem.translation}}"\r\n		   tid="{{menuItem.tid}}"></a>\r\n	</div>\r\n</div>\r\n'}),define("text!objects.requirements/requirements.ng.html",[],function(){return'<div qv-requirements class="requirements-wrapper" ng-show="show" ng-class="{\'incomplete\': !showAdd}">\r\n	<div class="requirements">\r\n		<h2 class="header">\r\n			<i class="object-icon" ng-class="iconClass"></i>\r\n		</h2>\r\n	<p class="incomplete-text" ng-if="!showAdd" q-translation="Visualization.Requirements.IncompleteVisualization"></p>\r\n		<!-- finished dimensions -->\r\n	<ul ng-if="showAdd && finishedDimensions.length">\r\n		<li ng-repeat="dimension in finishedDimensions" class="item" ng-class="{ finished: !dimension.invalid, invalid: dimension.invalid }"\r\n			tid="{{ dimension.invalid ? \'invalid-dimension\' : \'added-dimension\'}}">\r\n			<span class="text" title="{{dimension.title}}">{{dimension.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeDimension($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished dimensions -->\r\n	<ul ng-if="showAdd && unfinishedDimensions.length">\r\n		<li ng-repeat="d in unfinishedDimensions" class="item missing" tid="missing-dimension">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': d.active }" qva-activate="showAddDimension($event,d)"\r\n					q-translation="Visualization.Requirements.AddDimension" tid="add-dimension"></button>\r\n			</li>\r\n		</ul>\r\n		<!-- finished measures -->\r\n	<ul ng-if="showAdd && finishedMeasures.length">\r\n		<li ng-repeat="measure in finishedMeasures" class="item" ng-class="{ finished: !measure.invalid, invalid: measure.invalid }"\r\n			tid="{{ measure.invalid ? \'invalid-measure\' : \'added-measure\'}}">\r\n			<span class="text" title="{{measure.title}}">{{measure.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeMeasure($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished measures -->\r\n	<ul ng-if="showAdd && unfinishedMeasures.length">\r\n		<li ng-repeat="m in unfinishedMeasures" class="item missing" tid="missing-measure">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': m.active }" qva-activate="showAddMeasure($event,m)"\r\n					q-translation="Visualization.Requirements.AddMeasure" tid="add-measure"></button>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-translation",["autogenerated/qix/engine-enums","translator"],function(engineEnums,translator){"use strict";function getTranslationKey(errorCode){return"ErrorCode."+errorCode}var errorCodes=engineEnums.NxLocalizedErrorCode;return{getDimensionError:function(errorCode){var key;return key=errorCode===errorCodes.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidDimension":errorCode===errorCodes.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingDimension":getTranslationKey(errorCode),translator.get(key)},getMeasureError:function(errorCode){var key;return key=errorCode===errorCodes.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidMeasure":errorCode===errorCodes.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingMeasure":getTranslationKey(errorCode),translator.get(key)},getHyperCubeError:function(errorCode){var key=getTranslationKey(errorCode);return translator.get(key)},getListObjectError:function(errorCode){var key=getTranslationKey(errorCode);return translator.get(key)}}}),define("text!objects.add-popovers/add-dimension-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<object-add-typeahead>\r\n		<div class="object-add-popover-header">\r\n			<div class="qui-inputwithicon">\r\n				<input type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\r\n					   object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)" maxlength="255"/>\r\n				<i class="icon-expression edit-expression" q-title-translation="Tooltip.OpenExpressionEditor" qva-activate="closeAddPopover()"\r\n				   pp-expression-editor="search.term" pp-expression-editor-on-apply="addFieldDimension({value:value})" expression-type="dimension"></i>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content" object-add-typeahead-menu>\r\n			<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="dimension in dimensions" tid="dimension-item"\r\n					object-add-typeahead-item="dimension" on-select="addLibraryDimension(dimension)">\r\n					<span qve-highlight text="{{dimension.label}}" title="{{dimension.label}}" query="search.term" class="qui-list-text"></span>\r\n				</li>\r\n			</ul>\r\n			<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n					object-add-typeahead-item="field" on-select="addFieldDimension(field)">\r\n					<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n					<span qve-highlight text="{{field.label}}" title="{{field.label}}" query="search.term" class="qui-list-text"></span>\r\n				</li>\r\n			</ul>\r\n			<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n		</div>\r\n	</object-add-typeahead>\r\n</immidiate-contextual>'}),define("text!objects.add-popovers/object-add-typeahead.ng.html",[],function(){return"<div ng-transclude></div>"}),define("general.services/aligner/aligner",[],function(){function Aligner(args){this.container=args.container,this.body=args.body,this.alignAgainst=args.alignAgainst}return Aligner.prototype.showTranscluded=function($transclude){$transclude(function(clone){this.container.appendTo(this.body).append(clone)}.bind(this))},Aligner.prototype.showContent=function(content){this.container.appendTo(this.body).append(content)},Aligner.prototype.update=function(){var offset=this.alignAgainst.offset();this.container.css({top:offset.top,left:offset.left,width:this.alignAgainst.width(),height:this.alignAgainst.height(),zIndex:1021})},Aligner.prototype.hide=function(){this.container.remove()},Aligner}),define("objects.add-popovers/object-add-typeahead",["qvangular","text!./object-add-typeahead.ng.html","general.services/aligner/aligner"],function(qvangular,template){qvangular.directive("objectAddTypeahead",[function(){return{template:template,scope:{},transclude:!0,replace:!0,restrict:"E",controller:["$scope",function($scope){function scrollIntoView(){var menu=$scope.menu;if($scope.activeItem){var item=$scope.activeItem,position=item.getPosition();position.top<0?menu.setScrollTop(item.getOffsetTop()):position.top+item.getHeight()>menu.getHeight()&&item.scrollIntoView(!1)}else menu.setScrollTop(0)}var controller=this;$scope.items=[],this.activate=function(item){$scope.activeItem=item},this.nextItem=function(steps){var index=$scope.items.indexOf($scope.activeItem);"undefined"!=typeof steps&&(index=(index+steps)%$scope.items.length),index===$scope.items.length-1?controller.activate(null):-1===index?controller.activate($scope.items[0]):controller.activate($scope.items[index+1]),scrollIntoView()},this.prevItem=function(steps){var index=$scope.items.indexOf($scope.activeItem);"undefined"!=typeof steps&&(index=(index-steps+$scope.items.length)%$scope.items.length),0===index?controller.activate(null):-1===index?controller.activate($scope.items[$scope.items.length-1]):controller.activate($scope.items[index-1]),scrollIntoView()},this.getActiveItem=function(){return $scope.activeItem},this.selectActiveItem=function(){$scope.activeItem&&$scope.activeItem.select()},this.select=function(item){$scope.select({item:item}),$scope.activeItem=null},this.setMenu=function(menu){$scope.menu=menu},this.addItem=function(item){$scope.items.push(item)},this.removeItem=function(item){var idx=$scope.items.indexOf(item);idx>=0&&$scope.items.splice(idx,1)}}]}}]),qvangular.directive("objectAddTypeaheadInput",[function(){return{require:["^objectAddTypeahead","ngModel"],link:function(scope,element,attrs,ctrls){var autocompleteController=ctrls[0],modelController=ctrls[1];element.on("keydown",function(e){e.stopPropagation(),13===e.which||9===e.which?(e.preventDefault(),autocompleteController.getActiveItem()?scope.$apply(function(){autocompleteController.selectActiveItem();
}):scope.$apply(function(){scope.$eval(attrs.onEnter,{$event:e})})):33===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.prevItem(10)})):34===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.nextItem(10)})):40===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.nextItem()})):38===e.which?(e.preventDefault(),scope.$apply(function(){autocompleteController.prevItem()})):27===e.which&&(e.preventDefault(),scope.$apply(function(){scope.$eval(attrs.onEscape,{$event:e})}))}),scope.$watch(autocompleteController.getActiveItem,function(activeItem){activeItem?activeItem.item.label&&element.val(activeItem.item.label):element.val(modelController.$modelValue)}),scope.$watch(modelController.$modelValue,function(val){val||autocompleteController.activate(null)})}}}]),qvangular.directive("objectAddTypeaheadMenu",[function(){return{require:"^objectAddTypeahead",link:function(scope,element,attrs,controller){scope.controller=controller,controller.setMenu({getHeight:function(){return element.height()},setScrollTop:function(top){element[0].scrollTop=top}})}}}]),qvangular.directive("objectAddTypeaheadItem",[function(){return{require:"^objectAddTypeahead",link:function(scope,element,attrs,controller){function selectItem(){scope.$eval(attrs.onSelect,{item:item})}var item=scope.$eval(attrs.objectAddTypeaheadItem),itemDescr={item:item,getOffsetTop:function(){return element[0].offsetTop},scrollIntoView:function(start){element[0].scrollIntoView(start)},getPosition:function(){return element.position()},getHeight:function(){return element.height()},select:function(){selectItem()}};controller.addItem(itemDescr),scope.$on("$destroy",function(){controller.removeItem(itemDescr)}),scope.$watch(function(){var active=controller.getActiveItem();return active?active.item===item:!1},function(active){active?element.addClass("object-add-typeahead-active"):element.removeClass("object-add-typeahead-active")}),element.on("mouseenter",function(){element.addClass("object-add-typeahead-hover")}),element.on("mouseleave",function(){element.removeClass("object-add-typeahead-hover")}),element.on("qv-activate",function(event){event.preventDefault(),scope.$apply(function(){selectItem()})})}}}])}),define("objects.add-popovers/add-dimension-popover",["core.utils/deferred","general.utils/string-normalization","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-dimension-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(Deferred,StringNormalization,arrayUtil,support,libraryUtils,template,directDiscoveryService){"use strict";function filter(data,term){return""===term?data:data.filter(function(entity){return"undefined"==typeof entity.value?!1:StringNormalization.string(entity.value.toLowerCase()).indexOf(StringNormalization.string(term.toLowerCase()))>-1})}var ITEM_LIMIT=100,component={template:template,controller:["$scope",function($scope){$scope.search={term:""},$scope.isDirectDiscoveryField=directDiscoveryService.isDirectDiscoveryField,$scope.getDirectDiscoveryTypeTranslationKey=directDiscoveryService.getTypeTranslationKey,$scope.autoFocus=support.treatAsDesktop(),$scope.position||($scope.position="right"),$scope.onEscape=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.search.term=""):$scope.closeAddPopover()},$scope.onEnter=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.addFieldDimension({value:$scope.search.term})):$scope.closeAddPopover()};var cache=null;$scope.$watch("search.term",function(term){function setItems(){var fields=filter(cache.fields,term),dimensions=filter(cache.dimensions,term);dimensions.length>ITEM_LIMIT?(dimensions=arrayUtil.limit(dimensions,ITEM_LIMIT),fields=[]):fields.length+dimensions.length>ITEM_LIMIT&&(fields=arrayUtil.limit(fields,ITEM_LIMIT-dimensions.length)),$scope.fields=fields,$scope.dimensions=dimensions}cache?setItems():Deferred.all({fields:libraryUtils.getSortedFields(),dimensions:libraryUtils.getSortedDimensions()}).then(function(args){var fields=args.fields.map(function(field){return{label:field.qName,value:field.qName,qTags:field.qTags}}),dimensions=args.dimensions.map(function(dimension){return{label:dimension.qData.title,value:dimension.qData.title,libraryId:dimension.qInfo.qId}});cache={fields:fields,dimensions:dimensions},setItems()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"="}};return component}),define("text!objects.add-popovers/add-measure-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<div class="object-add-popover" ng-show="!step2">\r\n		<object-add-typeahead>\r\n			<div class="object-add-popover-header">\r\n				<div class="qui-inputwithicon">\r\n					<input type="text" name="new-measure" autocomplete="off" ng-model="search.term" tid="add-measure-input" qva-focus="autoFocus"\r\n						   maxlength="255" object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)"/>\r\n					<i class="icon-expression edit-expression" q-title-translation="Tooltip.OpenExpressionEditor" qva-activate="closeAddPopover()"\r\n					   pp-expression-editor="search.term" pp-expression-editor-on-apply="addExpressionMeasure({value:value})" expression-type="measure"></i>\r\n				</div>\r\n			</div>\r\n			<div class="object-add-popover-content" object-add-typeahead-menu>\r\n				<div class="object-add-popover-list-header" ng-if="measures.length" q-translation="Common.Measures"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="measure in measures" tid="measure-item"\r\n						object-add-typeahead-item="measure" on-select="addLibraryMeasure(measure)">\r\n						<span qve-highlight text="{{measure.value}}" title="{{measure.value}}" query="search.term" class="qui-list-text"></span>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Visualization.Requirements.FromField"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n						object-add-typeahead-item="field" on-select="showFromField(field)">\r\n						<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n						<span qve-highlight text="{{field.value}}" title="{{field.value}}" query="search.term" class="qui-list-text"></span>\r\n						<i class="object-add-popover-toogle-step2-icon qui-list-icon icon-triangle-right"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-nohits" ng-if="!measures.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n			</div>\r\n		</object-add-typeahead>\r\n	</div>\r\n	<div class="object-add-popover back" ng-show="step2">\r\n		<div class="object-add-popover-header">\r\n			<div qva-activate="goBack($event);">\r\n				<i class="icon-triangle-left"></i>\r\n				<span q-translation="Visualization.Requirements.Back"></span>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content">\r\n			<div class="object-add-popover-list-header" q-translation="Visualization.Requirements.Aggregation"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="suggestion in fieldSuggestions" qva-activate="addFromField(suggestion)" tid="from-field-item">\r\n					<span class="qui-list-text" title="{{suggestion.aggregation}}({{suggestion.field}})">{{suggestion.aggregation}}({{suggestion.field}})</span>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.add-popovers/add-measure-popover",["core.utils/deferred","general.utils/string-normalization","util","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-measure-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(Deferred,StringNormalization,util,arrayUtil,support,libraryUtils,template,directDiscoveryService){"use strict";function filter(data,term){return""===term?data:data.filter(function(entity){return"undefined"==typeof entity.value?!1:StringNormalization.string(entity.value.toLowerCase()).indexOf(StringNormalization.string(term.toLowerCase()))>-1})}var ITEM_LIMIT=100,component={template:template,controller:["$scope",function($scope){$scope.search={term:""},$scope.isDirectDiscoveryField=directDiscoveryService.isDirectDiscoveryField,$scope.getDirectDiscoveryTypeTranslationKey=directDiscoveryService.getTypeTranslationKey,$scope.autoFocus=support.treatAsDesktop(),$scope.position||($scope.position="right"),$scope.onEscape=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.search.term=""):$scope.closeAddPopover()},$scope.onEnter=function(event){""!==$scope.search.term?(event.stopPropagation(),$scope.addExpressionMeasure({value:$scope.search.term})):$scope.closeAddPopover()},$scope.showFromField=function(field){$scope.currentField=field,$scope.step2=!0},$scope.goBack=function(event){event.preventDefault(),$scope.currentField=null,$scope.step2=!1},$scope.$watch("currentField",function(field){field?$scope.fieldSuggestions=["Sum","Count","Avg","Min","Max"].map(function(fnName){var fieldValue=util.escapeField($scope.currentField.value);return{aggregation:fnName,field:fieldValue}}):$scope.fieldSuggestions=[]}),$scope.addFromField=function(suggestion){var expression=suggestion.aggregation+"("+suggestion.field+")";$scope.addExpressionMeasure({value:expression})};var cache=null;$scope.$watch("search.term",function(term){function setItems(){var measures=filter(cache.measures,term),fields=filter(cache.fields,term);measures.length>ITEM_LIMIT?(measures=arrayUtil.limit(measures,ITEM_LIMIT),fields=[]):measures.length+fields.length>ITEM_LIMIT&&(fields=arrayUtil.limit(fields,ITEM_LIMIT-measures.length)),$scope.fields=fields,$scope.measures=measures}cache?setItems():Deferred.all({fields:libraryUtils.getSortedFields(),measures:libraryUtils.getSortedMeasures()}).then(function(args){var fields=args.fields.map(function(field){return{value:field.qName,label:field.qName,field:field.qName,qTags:field.qTags}}),measures=args.measures.map(function(measure){return{value:measure.qData.title,label:measure.qData.title,libraryId:measure.qInfo.qId}});cache={fields:fields,measures:measures},setItems()})})}],scope:{alignTo:"=",addExpressionMeasure:"=",addLibraryMeasure:"=",closeAddPopover:"=",position:"="}};return component}),define("objects.requirements/requirements",["jquery","qvangular","text!./requirements.ng.html","client.utils/state","general.services/show-service/show-service","objects.extension/base-controller","objects.error-handling/error-translation","core.utils/resize","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover"],function($,qvangular,template,State,showService,BaseController,errorTranslation,Resize,addDimensionPopoverComponent,addMeasurePopoverComponent){"use strict";function getArray(len){var i,a=new Array(len);for(i=0;len>i;++i)a[i]={index:i};return a}function getDimensionInfo(layout){if(layout.qHyperCube)return layout.qHyperCube.qDimensionInfo||[];if(layout.qChildList){var children=layout.qChildList.qItems||[];return children.map(function(){return{}})}var hasError=!layout.qListObject||!layout.qListObject.qDimensionInfo||layout.qListObject.qDimensionInfo.qError;return hasError?[]:[layout.qListObject.qDimensionInfo]}function getMeasureInfo(layout){return layout.qHyperCube?layout.qHyperCube.qMeasureInfo||[]:[]}function updateShowAdd($scope){$scope.showAdd=State.isInEditMode()&&!$scope.object.isReadonly}var RequirementsController,activeItem=null;return RequirementsController=BaseController.extend({$scope:null,init:function($scope){function updateState(){updateShowAdd($scope)}function addFieldDimension(item){return $scope.object.ext.addFieldDimension(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function addLibraryDimension(item){return $scope.object.ext.addLibraryDimension(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function addLibraryMeasure(item){return $scope.object.ext.addLibraryMeasure(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function addExpressionMeasure(item){return $scope.object.ext.addExpressionMeasure(item,$scope.object).then(function(){$scope.object.model.save(),closeAddPopover()})}function closeAddPopover(event){popover&&(popover.destroy(),popover=null),activeItem&&(activeItem.active=!1),event&&!$(event.target).hasClass("add-button")&&(activeItem=null)}this.$scope=$scope,State.StateChanged.bind(updateState),$scope.$on("$destroy",function(){State.StateChanged.unbind(updateState)}),updateState(),$scope.removeDimension=function(index){$scope.object.model.getProperties().then(function(props){var propertyHandler=$scope.ext.getCreatePropertyHandler();propertyHandler.setProperties(props),propertyHandler.removeDimension(index).then(function(){$scope.object.model.save()})})},$scope.removeMeasure=function(index){$scope.object.model.getProperties().then(function(props){var propertyHandler=$scope.ext.getCreatePropertyHandler();propertyHandler.setProperties(props),propertyHandler.removeMeasure(index).then(function(){$scope.object.model.save()})})};var popover;$scope.showAddDimension=function(event,item){if(activeItem&&activeItem===item)return void(activeItem=null);var popoverComponent=$scope.ext.addDimensionPopoverComponent||addDimensionPopoverComponent;popover=showService.show(popoverComponent,{alignTo:$(event.target),closeAddPopover:closeAddPopover,addFieldDimension:addFieldDimension,addLibraryDimension:addLibraryDimension}),item.active=!0,activeItem=item},$scope.showAddMeasure=function(event,item){if(activeItem&&activeItem===item)return void(activeItem=null);var popoverComponent=$scope.ext.addMeasurePopoverComponent||addMeasurePopoverComponent;popover=showService.show(popoverComponent,{alignTo:$(event.target),closeAddPopover:closeAddPopover,addLibraryMeasure:addLibraryMeasure,addExpressionMeasure:addExpressionMeasure}),item.active=!0,activeItem=item},Resize.on("start",closeAddPopover),$scope.$on("$destroy",function(){Resize.off("start",closeAddPopover),closeAddPopover()})},onPaint:function(){var dimensions,measures,$scope=this.$scope,layout=$scope.layout,minDimensions=$scope.ext.dimensionDefinition?$scope.ext.dimensionDefinition.min:0,maxDimensions=$scope.ext.dimensionDefinition?$scope.ext.dimensionDefinition.max:0,minMeasures=$scope.ext.measureDefinition?$scope.ext.measureDefinition.min:0,maxMeasures=$scope.ext.measureDefinition?$scope.ext.measureDefinition.max:0;updateShowAdd($scope),$scope.iconClass=$scope.object.ext.libraryInfo.templateIconClassName,$scope.minDimensions=minDimensions,$scope.minMeasures=minMeasures,$scope.maxDimensions=maxDimensions,$scope.maxMeasures=maxMeasures,minDimensions!==maxDimensions||minMeasures!==maxMeasures?$scope.headerStr="Visualization.Requirements.AddAtLeast":$scope.headerStr="Visualization.Requirements.Add",dimensions=getDimensionInfo(layout).map(function(dimension){var title,errorCode=dimension.qError&&dimension.qError.qErrorCode;return title=errorCode?errorTranslation.getDimensionError(errorCode):dimension.title||dimension.qFallbackTitle,{invalid:!!errorCode,title:title}}),measures=getMeasureInfo(layout).map(function(measure){var title,errorCode=measure.qError&&measure.qError.qErrorCode;return title=errorCode?errorTranslation.getMeasureError(errorCode):measure.qFallbackTitle,{invalid:!!errorCode,title:title}}),$scope.finishedDimensions=dimensions,$scope.finishedMeasures=measures,$scope.unfinishedDimensions=getArray(Math.max(0,$scope.minDimensions-$scope.finishedDimensions.length)),$scope.unfinishedMeasures=getArray(Math.max(0,$scope.minMeasures-$scope.finishedMeasures.length)),$scope.show=!0}}),RequirementsController.$inject=["$scope"],qvangular.directive("qvRequirements",function(){return{controller:RequirementsController,require:["qvRequirements","^qvObject"],link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1];objectCtrl.addChildController(ctrl)}}}),{template:template,controller:RequirementsController}}),define("text!objects.error-handling/error-info-popup.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" width="200" position="\'top\'" collision="\'flipfit\'" class="qui-immidiateContextual" on-close-view="onClose(event)">\r\n	<div class="object-error-popup">\r\n		<!--<div class="object-error-title" q-translation="{{error.title}}"></div>-->\r\n		<div class="object-error-message">{{error.message}}</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.error-handling/error-info-popup",["text!objects.error-handling/error-info-popup.ng.html","core.utils/resize"],function(template,resize){"use strict";return{template:template,controller:["$scope",function($scope){function resizeFn(){$scope.onClose()}$scope.$on("$destroy",function(){resize.off("start",resizeFn)}),resize.on("start",resizeFn)}]}}),define("text!objects.error-handling/error.ng.html",[],function(){return'<div qv-errorhandler class="object-error" ng-class="error.class" tid="object.Error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span>{{error.title}}</span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-handler",["qvangular","angular","touche","translator","./error-info-popup","text!./error.ng.html","objects.extension/base-controller","objects.error-handling/error-translation","autogenerated/qix/engine-enums"],function(qvangular,angular,Touche,translator,popupComponent,template,BaseController,errorTranslation,engineEnums){"use strict";function isSoftError(error){return error.qErrorCode===engineEnums.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED}function extractHyperCubeHack(layout){return layout.qHyperCube?layout.qHyperCube:layout.layers&&layout.layers.length&&layout.layers[0].qHyperCube?layout.layers[0].qHyperCube:!1}function getCustomErrorMessage(dataEntity){var errorCode=dataEntity.qError.qErrorCode;switch(errorCode){case engineEnums.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED:return dataEntity.customErrorMessage?dataEntity.customErrorMessage.calcCond:""}}var ErrorController=BaseController.extend({$scope:null,init:function($scope){this.$scope=$scope,$scope.hasSoftError=!1,$scope.hasHardError=!1,$scope.showMore=function(event){var element=angular.element("<div>").appendTo("body");element.showComponent(popupComponent,{alignTo:angular.element(event.target),error:$scope.error,onClose:function(){element.remove(),Touche.preventGestures()}})}},onPaint:function(){var errorMessage,$scope=this.$scope,error=$scope.object.error;if(!error){var layout=$scope.layout,hyperCube=extractHyperCubeHack(layout);hyperCube?hyperCube.qError&&(errorMessage=getCustomErrorMessage(hyperCube)||errorTranslation.getHyperCubeError(hyperCube.qError.qErrorCode),error=isSoftError(hyperCube.qError)?{"class":"soft-error",message:errorMessage}:{"class":"hard-error",title:translator.get("Object.Error"),message:errorMessage}):layout.qListObject&&(layout.qListObject.qError?(errorMessage=getCustomErrorMessage(layout.qListObject)||errorTranslation.getListObjectError(layout.qListObject.qError.qErrorCode),error=isSoftError(layout.qListObject.qError)?{"class":"soft-error",message:errorMessage}:{"class":"hard-error",title:translator.get("Object.Error"),message:errorMessage}):layout.qListObject.qDimensionInfo&&layout.qListObject.qDimensionInfo.qError.qErrorCode&&(errorMessage=getCustomErrorMessage(layout.qListObject.qDimensionInfo)||errorTranslation.getDimensionError(layout.qListObject.qDimensionInfo.qError.qErrorCode),error=isSoftError(layout.qListObject.qDimensionInfo.qError.qErrorCode)?{"class":"soft-error",message:errorMessage}:{"class":"hard-error",title:translator.get("Object.Error"),message:errorMessage}))}$scope.error=error}});return ErrorController.$inject=["$scope"],qvangular.directive("qvErrorhandler",function(){return{controller:ErrorController,require:["qvErrorhandler","^qvObject"],link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],objectCtrl=ctrls[1];objectCtrl.addChildController(ctrl)}}}),{template:template,controller:ErrorController}}),define("objects.utils/data-properties/empty-handler",["./data-property-handler","util"],function(DataPropertyHandler){"use strict";var EmptyHandler=DataPropertyHandler.extend({getDimensions:function(){return[]},getMeasures:function(){return[]}});return EmptyHandler}),define("text!objects.error-handling/invalid-type.ng.html",[],function(){return'<div qv-extension class="object-error hard-error" tid="object.Error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span>{{error.title}}</span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\r\n		<button ng-if="showButton" class="qui-button object-error-remove" qva-activate="remove($event)" q-translation="Common.Delete"></button>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/invalid-type",["angular","touche","translator","objects.utils/data-properties/empty-handler","client.utils/state","./error-info-popup","text!objects.error-handling/invalid-type.ng.html"],function(angular,Touche,translator,EmptyHandler,State,popupComponent,template){"use strict";return{type:"invalid",template:template,definition:{type:"items",items:{}},snapshot:{canTakeSnapshot:!1},getContextMenu:function(){},hasError:function(){return!1},showRequirements:function(){return!1},getCreatePropertyHandler:function(){return new EmptyHandler},getDropFieldOptions:function(){},getDropDimensionOptions:function(){},getDropMeasureOptions:function(){},controller:["$scope",function($scope){var message,error=$scope.object.error,title=translator.get(error.title);message=Array.isArray(error.message)?translator.get(error.message[0],error.message.slice(1)):translator.get(error.message),$scope.error={title:title,message:message},$scope.showButton=!($scope.options&&$scope.options._hideErrorButton),$scope.remove=function(event){var id=$scope.layout.qInfo.qId,sheet=State.model,obj=sheet.getObjectById(id);sheet.removeObject({row:obj.row,col:obj.col}),event.stopPropagation()},$scope.showMore=function(event){var element=angular.element("<div>").appendTo("body");element.showComponent(popupComponent,{alignTo:angular.element(event.target),error:$scope.error,onClose:function(){element.remove(),Touche.preventGestures()}})}}]}}),define("objects.utils/resize",["pubsub"],function(pubsub){function sendResizeEvent(data){data=data||{},pubsub.publish("/ui/object/resize",data)}["/resize/end","/ui/panel/toggle","/ui/grid/cellswap","/ui/grid/cellresize","/ui/grid/cellsplitting","/ui/grid/zoom/activated","/ui/grid/zoom/deactivated"].forEach(function(v){pubsub.subscribe(v,sendResizeEvent)})}),define("text!client.views/selection-toolbar/selection-toolbar.ng.html",[],function(){return'<div class="qv-selection-toolbar qvt-selection-toolbar"\r\n	 ng-style="toolbar.style"\r\n	 ng-class="{ \'sel-toolbar-card\': !options.isPopover, \'sel-toolbar-popover\': options.isPopover, \'sel-toolbar-click-to-unlock-bg\': locked, \'sel-toolbar-menu-item\': locked }"\r\n	 qva-activate="locked && toggleLock($event);">\r\n    <div class="sel-toolbar-list-wrapper">\r\n		<table class="sel-toolbar-list">\r\n            <tr>\r\n                <td class="sel-toolbar-list-item" ng-class="{ \'sel-toolbar-list-item-hide-more\': filteredMenuButtons.length === 0 }">\r\n                    <button tid="selection-toolbar.toggleShowMenu"\r\n                            class="sel-toolbar-btn sel-toolbar-icon sel-toolbar-icon-toggle"\r\n                            ng-class="{ \'menu-active\': toolbar.showMenu }"\r\n                            q-title-translation="{{toolbar.showMenu ? \'Tooltip.CloseSelectionMenu\' : \'Tooltip.SelectionMenu\'}}"\r\n                            qva-activate="toggleShowMenu($event)">\r\n                        <span class="sel-toolbar-span-icon selections-more"></span>\r\n                    </button>\r\n                </td>\r\n                <td ng-if="toolbar.showLock || locked" class="sel-toolbar-list-item sel-toolbar-list-item-lockunlock">\r\n                    <button tid="selection-toolbar.lock"\r\n                            class="sel-toolbar-btn sel-toolbar-icon"\r\n                            q-title-translation="{{\'DataModelViewer.RightMenu.Tooltip.ClickTo\' + (locked ? \'Unlock\' : \'Lock\')}}"\r\n                            ng-disabled="locked ? false : !toolbar.backendApi.hasSelections()"\r\n                            qva-activate="!locked && toggleLock($event);">\r\n                        <span class="sel-toolbar-span-icon" ng-class="!locked ? \'icon-toolbar-unlocked\':\'icon-toolbar-locked sel-toolbar-menu-span-icon\'"></span>\r\n                    </button>\r\n                </td>\r\n                <td ng-show="locked" class="sel-toolbar-list-item-locked">\r\n                    <p class="sel-toolbar-menu-text" q-translation="SelectionToolbar.ClickToUnlock"></p>\r\n                </td>\r\n                <td ng-show="!locked" ng-repeat="button in filteredButtons" class="sel-toolbar-list-item" ng-class="button.clazz">\r\n                    <button tid="{{button.tid}}"\r\n                            qva-activate="buttonAction($event, button)"\r\n                            q-title-translation="{{button.name}}"\r\n                            ng-disabled="buttonIsDisabled(button)"\r\n                            class="sel-toolbar-btn"\r\n                            ng-class="[button.buttonClass, button.isIcon ? \'sel-toolbar-icon\' : \'\', button.isActive(this) ? \'menu-active\' : \'\']">\r\n                        <span class="sel-toolbar-span-icon" ng-class="button.iconClass"></span>\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n\r\n    </div>\r\n	<div ng-if="toolbar.showMenu" class="sel-toolbar-menu" ng-style="toolbar.menuStyle"\r\n		 qva-delegated-activate="div:not(.disabled)#menuAction($event);">\r\n		<div ng-repeat="button in filteredMenuButtons" class="sel-toolbar-menu-item"\r\n			 tid="{{button.tid}}"\r\n			 q-title-translation="{{button.name}}"\r\n			 ng-class="{\'disabled\': buttonIsDisabled(button) }">\r\n			<table class="sel-toolbar-menu-table" ng-class="{ \'selection-toolbar-menu-table-align-center\': filteredButtons.length === 0 }">\r\n				<tr>\r\n					<td><span class="sel-toolbar-menu-span-icon" ng-class="button.iconClass"></span></td>\r\n					<td ng-if="filteredButtons.length !== 0"><p class="sel-toolbar-menu-text" q-translation="{{button.name}}"></p></td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("client.views/selection-toolbar/selection-toolbar",["jquery","qvangular","text!./selection-toolbar.ng.html","core.utils/deferred"],function($,qvangular,template,Deferred){"use strict";var component,buttonLayout,BUTTON_WIDTH=44,SEPARATOR_WIDTH=1,BORDER_SPACING=8,EXTRA_EDGE_PADDING=2;return qvangular.componentDirective("qvaIncludeSelectionToolbar",{toolbar:"=",options:"="}),buttonLayout={width:0,buttons:[],haveButtons:function(){return this.buttons.length>0},reset:function(width){this.width=width,this.buttons.length=0},freeWidth:function(){var i,usedWidth=0;for(i=0;i<this.buttons.length;i++)usedWidth+=this.buttons[i];return this.width-usedWidth}},component={template:template,controller:["$scope",function($scope){function howManyButtons(width,buttons,menuButtons){var buttonWidth,i,extraWidth=0;for(buttonLayout.reset(width-(BORDER_SPACING+2*EXTRA_EDGE_PADDING)),i=buttons.length-1;i>=0&&(buttonWidth="sel-toolbar-icon-separator"!==buttons[i].buttonClass?BUTTON_WIDTH+BORDER_SPACING:SEPARATOR_WIDTH+BORDER_SPACING,buttonWidth<=buttonLayout.freeWidth());i--)buttonLayout.buttons.push(buttonWidth);for(($scope.toolbar.showLock||$scope.locked)&&(extraWidth+=BUTTON_WIDTH+BORDER_SPACING),(menuButtons.length>0||buttons.length>buttonLayout.buttons.length)&&(extraWidth+=BUTTON_WIDTH+BORDER_SPACING);buttonLayout.haveButtons()&&buttonLayout.freeWidth()<extraWidth;)buttonLayout.buttons.pop();return buttonLayout.buttons.length}function layoutButtons(){var i,btn,btns=[].concat($scope.toolbar.buttons),menuBtns=[].concat($scope.toolbar.menuButtons),cnt=howManyButtons($scope.toolbar.style.width,btns,menuBtns);for($scope.filteredButtons=[],$scope.filteredMenuButtons=[],i=0;cnt>i&&btns.length;++i)$scope.filteredButtons.push(btns.pop());for($scope.filteredButtons.reverse();btns.length;)btn=btns.pop(),"sel-toolbar-icon-separator"!==btn.buttonClass&&$scope.filteredMenuButtons.push(btn);for(;menuBtns.length;)$scope.filteredMenuButtons.push(menuBtns.shift())}function handleLock(locked){$scope.locked=locked,$scope.toolbar.showMenu=!1,gotPositionPromise.then(function(){layoutButtons()})}var dfd=Deferred(),gotPositionPromise=dfd.promise;$scope.filteredButtons=[],$scope.filteredMenuButtons=[],$scope.selectionInfo={show:!1,selected:0,total:0},$scope.lassoEnabled=!1,this.confirm=function(){$scope.selectionsApi.confirm()},this.close=function(){$scope.destroyComponent()},$scope.buttonAction=function($event,button){$event.originalEvent.preventDefault(),button.action.call($scope.toolbar)},$scope.buttonIsDisabled=function(button){return"function"==typeof button.isDisabled?button.isDisabled.call($scope.toolbar):!1},$scope.menuAction=function($event){var scope=$($event.target).scope();$event.originalEvent.preventDefault(),scope.button.action.call($scope.toolbar),$scope.toolbar.showMenu=!$scope.toolbar.showMenu},$scope.toggleShowMenu=function($event){$event.originalEvent.preventDefault(),$scope.toolbar.showMenu=!$scope.toolbar.showMenu},$scope.toggleLasso=function(){$scope.lassoEnabled=!$scope.lassoEnabled,$scope.toolbar.toggleLasso($scope.lassoEnabled)},$scope.toggleLock=function($event){$event.originalEvent.preventDefault(),$scope.toolbar.backendApi.isLocked()?($scope.toolbar.selectionsApi.selectionsMade=!0,$scope.toolbar.backendApi.unlock()):$scope.toolbar.backendApi.lock()},$scope.$watch("toolbar.backendApi.isLocked()",function(locked){void 0!==locked&&handleLock(locked?!0:!1)}),$scope.$watch("toolbar.position",function(position){position&&($scope.toolbar.style=position,dfd.resolve(),handleLock($scope.toolbar.backendApi.isLocked?$scope.toolbar.backendApi.isLocked():!1))}),$scope.$watch("toolbar.menuMaxHeight",function(maxHeight){maxHeight&&($scope.toolbar.menuStyle={maxHeight:maxHeight})}),$scope.$watch("options.lassoEnabled",function(enabled){$scope.lassoEnabled=enabled})}]}}),define("client.views/selection-toolbar/selection-toolbar-service",["qvangular","client.views/selection-toolbar/selection-toolbar","util","core.utils/notification","angular"],function(qvangular,component,util,Notification){"use strict";qvangular.service("qvSelectionToolbarService",function(){function getBoundingBox($object,$dockToElement){var prevCellSiblings,tableBbox,firstCell,firstCellBbox,objectRect=$object[0].getBoundingClientRect(),bbox=$dockToElement[0].getBoundingClientRect();return $dockToElement.is("th, td")&&(tableBbox=$dockToElement.closest("table")[0].getBoundingClientRect(),prevCellSiblings=$dockToElement.prevAll(),firstCell=prevCellSiblings.length?prevCellSiblings.last():$dockToElement,firstCellBbox=firstCell[0].getBoundingClientRect(),firstCellBbox.left-tableBbox.left===1)?{top:bbox.top-objectRect.top,left:bbox.left-1-objectRect.left,
width:bbox.width}:{top:bbox.top-objectRect.top,left:bbox.left-objectRect.left,width:bbox.width}}var service,$container,ctrl;return service={open:function($object,$dockToElement,input){var bbox=getBoundingBox($object,$dockToElement),position={top:-44+bbox.top,width:bbox.width+(input.offsetWidth||0),left:bbox.left};input.toolbar=util.extend(!0,input.toolbar,{position:position,menuMaxHeight:input.menuMaxHeight}),$container=angular.element("<div>"),ctrl=$container.showComponent(component,input),$container.appendTo($object),this.Opened.emit()},close:function(){ctrl&&(ctrl.close(),this.Closed.emit(),ctrl=void 0),$container&&$container.remove()},confirm:function(){ctrl&&(ctrl.confirm(),ctrl=void 0),this.close()}},Notification.create(service,"Closed"),Notification.create(service,"Opened"),service})}),define("text!objects/throbber/throbber.ng.html",[],function(){return'<div ng-show="progress" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader" style="width:20%;height:20%;position:absolute;top:40%;left:40%"></div>\r\n</div>\r\n'}),define("objects/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvThrobber",["$timeout",function($timeout){return{replace:!0,template:template,restrict:"E",scope:{model:"=",progress:"=",delay:"=",disabled:"="},link:function($scope){var timeoutP;$scope.$watch("model.isValidating",function(value){return $scope.disabled===!0?void($scope.progress=!1):void($scope.model&&void 0===$scope.model.state?$scope.progress=!0:value?(timeoutP&&$timeout.cancel(timeoutP),timeoutP=$timeout(function(){$scope.model&&$scope.model.isValidating&&($scope.progress=!0)},$scope.delay||1e3)):$scope.progress=!1)})}}}])}),define("text!general.services/loader/rain/rain.ng.html",[],function(){return'<div class="rain progress" ng-class="{\'qv-fade-out\': fadeOut}">\r\n	<div class="rain-progress" ng-style="rainStyle">\r\n		<div class="progress-div rotating" ng-class="ngClasses">\r\n		</div>\r\n	</div>\r\n	<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\r\n		<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\r\n		<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\r\n	</div>\r\n</div>\r\n'}),define("general.services/loader/rain/rain",["qvangular","text!../rain/rain.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvRain",[function(){return{replace:!0,template:template,restrict:"E",scope:{show:"=",resize:"=?",messageObj:"=?"},link:function($scope,$element){function update(){var bbox=$element[0].getBoundingClientRect(),min=Math.min(bbox.width,bbox.height);min=.3*min,$scope.rainStyle.height=min+"px",$scope.rainStyle.width=min+"px",$scope.rainStyle.top=(bbox.height-min)/2,$scope.rainStyle.left=(bbox.width-min)/2}$scope.rainStyle={},$scope.$watch("show",function(show){void 0!==show&&show&&update()}),$scope.resize&&$scope.resize(update),update()}}}])}),define("objects/object",["jquery","qvangular","core.utils/deferred","general.utils/visualizations","objects.models/visualization-object","objects.utils/layout","objects.utils/type-loader","text!./object.ng.html","pubsub","client.utils/state","objects.extension/extension-type","util","translator","objects.requirements/requirements","objects.error-handling/error-handler","core.utils/resize","objects.extension/base-controller","objects.error-handling/invalid-type","objects.utils/resize","client.views/selection-toolbar/selection-toolbar-service","objects/throbber/throbber","general.services/loader/rain/rain"],function($,qvangular,Deferred,Visualizations,VisualizationObject,layoutMode,TypeLoader,template,pubsub,State,ExtensionType,util,translator,requirements,errorHandler,resize,BaseCtrl){"use strict";function confirmSelections(object){object.selectionsApi&&object.selectionsApi.active&&object.selectionsApi.confirm()}function setUpResize($scope,object){function isVisible(){return!$scope.options||$scope.options.isVisible!==!1}function confirmSelectionsOnResizeStart(){confirmSelections(object)}function onResize(){isVisible()&&(qvangular.$apply($scope,function(){object.resize()}),object.throbberApi.resize())}function triggerResize(){timer||(timer=setTimeout(function(){onResize(),clearTimeout(timer),timer=null},100))}var timer;$scope.$on("resizeCell",function(){triggerResize()}),pubsub.subscribe("/ui/object/resize."+$scope.$id,function(){triggerResize()}),resize.on("start."+$scope.$id,confirmSelectionsOnResizeStart),$scope.$on("$destroy",function(){clearTimeout(timer),pubsub.unsubscribe("."+$scope.$id),resize.off("start."+$scope.$id,confirmSelectionsOnResizeStart)})}function setUpModel($scope,object){function layoutCallback(layout){$scope.model.isCancelled||($scope.layout=layout,object.setLayout(layout,$scope.options))}function modelCallback(model){object.model&&unobserveModel(object.model),observeModel(model),object.setModel(model)}function onModelInvalid(){object.setRenderState(objectRenderStates.INVALID)}function observeModel(model){model.Invalidated&&!model.isCancelled&&model.Invalidated.bind(onModelInvalid)}function unobserveModel(model){model.Invalidated&&model.Invalidated.unbind(onModelInvalid)}var unbindLayout;$scope.object._forcePaint=!0,unbindLayout=VisualizationObject.bindLayout($scope,"model",layoutCallback,modelCallback),$scope.$on("$destroy",function(){object.model&&unobserveModel(object.model),unbindLayout&&unbindLayout()})}function setUpPaint($scope,object,$element,ctrl){function isVisible(){return!$scope.options||$scope.options.isVisible!==!1}function onRendered(object,callback,promise,err){paintP=Deferred(),promise&&promise.then?promise.then(function(){paintP.resolve(objectOnPaintReturnValues.PROMISE)}):paintP.resolve(objectOnPaintReturnValues.UNKNOWN),paintP.promise.then(function(status){object.setRenderState(objectRenderStates.RENDERED),callback&&setTimeout(function(){callback({promised:status===objectOnPaintReturnValues.PROMISE,error:err||!1})},0)})}var updateTimeoutP,resetTimeoutP,resizeTimeoutP,paintP,$objectElem,width,height;object.setObjectClass=function(resize){$objectElem||($objectElem=$element.find(".qv-object")),(resize||void 0===width)&&(width=$objectElem[0].clientWidth),(resize||void 0===height)&&(height=$objectElem[0].clientHeight);var mode=layoutMode.getLayoutMode(width,height),type=object.type&&object.type.type,classList=[];if($scope.ext&&State.state===State.States.snapshot){var snapshotClass=object.canTakeSnapshot()?"qv-snapshot-enabled":"qv-snapshot-disabled";classList.push(snapshotClass)}object.selectionsApi&&object.selectionsApi.active&&classList.push("qv-selections-active"),object.objectSize={w:width,h:height},$scope.options.layoutMode=mode;var layoutClass="qv-layout-"+layoutMode.getLayoutModeKey(mode);classList.push(layoutClass),$scope.objectClass="qv-object-"+type,classList.push($scope.objectClass),object.selectionClass&&classList.push(object.selectionClass),$scope.classList=classList},object.update=function(){this.valid&&(this.loadContent(),updateTimeoutP=qvangular.getService("$timeout")(function(){object.setObjectClass(),object.backendApi&&object.backendApi.updateCache($scope.layout);var req=ctrl.childLoaded();$scope.rpcId=req.rpcId,req.then(function(child){try{onRendered(object,$scope.options.onRendered,child.onPaint(isVisible()))}catch(err){throw object.error={"class":"hard-error",title:translator.get("Object.Error"),message:translator.get("Object.ErrorMessage.RenderingFailed",object.ext.type)},object.content=errorHandler,ctrl.resetChildController(),resetTimeoutP=qvangular.getService("$timeout")(function(){ctrl.childLoaded().then(function(child){onRendered(object,$scope.options.onRendered,child.onPaint(!0),!0)})}),err}})}))},object.resize=function(){isVisible()&&(object.setRenderState(objectRenderStates.INVALID),resizeTimeoutP=qvangular.getService("$timeout")(function(){object.setObjectClass(!0),ctrl.childLoaded().then(function(child){onRendered(object,null,child.onResize())})}))},object.onResize=function(){ctrl.childLoaded().then(function(child){onRendered(object,null,child.onResize())})},$scope.$on("$destroy",function(){var $timeout=qvangular.getService("$timeout");$timeout.cancel(updateTimeoutP),$timeout.cancel(resetTimeoutP),$timeout.cancel(resizeTimeoutP),paintP&&paintP.reject()})}function setUpLoading($scope,$element,object,ctrl){function getComponent(){var args={options:$scope.options,object:object,layout:$scope.layout,ext:object.ext};return object.ext.hasError(args)?errorHandler:object.ext.showRequirements(args)?requirements:object.ext}var loading=Deferred();object.loaded=loading.promise,object.valid=!1,object.showExploreMenu=!1,object.loadContent=function(){var component=getComponent();this.content!==component&&(void 0!==this.content&&(ctrl.resetChildController(),ctrl.childLoaded().then(function(child){child.onStateChanged(State)})),this.content=component)},object.reset=function(){this.valid&&($scope.options=util.extend({},$scope.resetOptions,{isZoomed:$scope.options.isZoomed}),loading=Deferred(),this.loaded=loading.promise,this.valid=!1)},object.validate=function(){this.valid||this.layout&&this.type&&this.ext&&(this.valid=!0,loading.resolve())},object.setExtension=function(ext){this.ext=ext,$scope.ext=ext,"invalid"!==ext.type&&(ext.mapProperties(this.model),ext.mapSoftProperties(),this.setBackendApi(),this.updateSnapshot()),this.validate(),this.update(),this.ext.model=this.model},object.setBackendApi=function(){var APIType=$scope.options.APIType||this.ext.BackendApi,backendApi=this.backendApi=new APIType(this.model);ctrl.childLoaded().then(function(child){child.setBackendApi(backendApi)})},object.setType=function(type,updatePropertyPanel){this.backendApi&&this.backendApi.destroy(),this.ext=null,this.backendApi=null,this.hasContent=!1,this.type=type,type.load().then(function(ext){object.type===type&&(type!==invalidExtensionType&&(object.error=null),object.setExtension(ext),setUpSelections($scope,$element,object,ctrl),updatePropertyPanel&&(qvangular.$rootScope.$broadcast("refreshPropertyPanel"),qvangular.$rootScope.$broadcast("reloadExploreContent")))},function(){object.setType(invalidExtensionType),object.error={"class":"hard-error",title:translator.get("Object.Invalid.Title"),message:translator.get("Object.ErrorMessage.NotFound",type.type)},object.isInvalid=!0})},object.setModel=function(model){this.model=model,this.ext&&(this.ext.model=model,this.setBackendApi())},object.setLayout=function(layout){this.layout=layout;var typeName=layout.visualization||layout.qInfo.qType,type=Visualizations.getType(typeName);layout.qError&&(type=invalidExtensionType,this.error={title:"Object.Error",message:"Object.Invalid.Info"}),type||(type=invalidExtensionType,this.error={title:"Object.Invalid.Title",message:["Object.ErrorMessage.NotFound",typeName]}),this.type!==type&&(this.reset(),this.setType(type,!!this.type)),this.isInvalid=type===invalidExtensionType,this.isLink=!this.isInvalid&&!!layout.qExtendsId,this.showTitles=layout.showTitles!==!1,this.validate(),this.update()}}function setUpSelections($scope,$element,object,ctrl){function onOutside(e){var $target=$(e.target);object.selectionsApi.ignoreOnOutside($target)||(object.selectionsApi.getDockToElement().off(".object"),object.selectionsApi.confirm())}function beforeUnload(){return object.backendApi&&object.backendApi.endSelections(!0),null}object.activateSelections=function(){"undefined"!=typeof object.ext.options.selections&&ctrl.childLoaded().then(function(child){child.allowInteraction(State)&&object.selectionsApi.activate()})},object.selectionsApi&&"function"==typeof object.selectionsApi.destroy&&object.selectionsApi.destroy(),object.selectionsApi={destroy:function(){this._activatedCallbacks=[],this._deactivatedCallbacks=[],$(window).off("onbeforeunload",beforeUnload)},active:!1,selectionsMade:!1,_activatedCallbacks:[],_deactivatedCallbacks:[],on:function(){},off:function(){},ignoreOnOutside:function($target){return!(!$target.closest(".qv-selection-toolbar").length&&!$target.closest(".selections-data-area-ui").length)},getDockToElement:function(){return $element},getMenuMaxHeight:function(){return object.selectionsApi.getDockToElement().outerHeight()},getSelectionToolbarWidthOffset:function(){return 0},watchActivated:function(fn){return this._activatedCallbacks.push(fn),function(){var ix=this._activatedCallbacks.indexOf(fn);this._activatedCallbacks.splice(ix,1)}.bind(this)},activated:function(suppressBeginSelections){this.active=!0,suppressBeginSelections||object.backendApi.beginSelections(),$(window).on("onbeforeunload",beforeUnload),$scope.options.isPopover||(this.getDockToElement().on("qv-outside.object",onOutside),qvangular.$apply($scope,function(){object.setObjectClass(),object.getSelectionToolbar().then(function(toolbar){var input={toolbar:toolbar,selectionsApi:object.selectionsApi,options:$scope.options,menuMaxHeight:object.selectionsApi.getMenuMaxHeight(),offsetWidth:object.selectionsApi.getSelectionToolbarWidthOffset()};qvangular.getService("qvSelectionToolbarService").open($element,object.selectionsApi.getDockToElement(),input)})})),this._activatedCallbacks.forEach(function(fn){fn.call(this)},this)},watchDeactivated:function(fn){return this._deactivatedCallbacks.push(fn),function(){var ix=this._deactivatedCallbacks.indexOf(fn);this._deactivatedCallbacks.splice(ix,1)}.bind(this)},deactivated:function(){$(window).off("onbeforeunload",beforeUnload),this.active=!1,this.selectionsMade=!1,$scope.options.isPopover||(object.selectionsApi.getDockToElement().off(".object"),qvangular.$apply($scope,function(){object.setObjectClass(),qvangular.getService("qvSelectionToolbarService").close()})),this._deactivatedCallbacks.forEach(function(fn){fn.call(this)},this)},confirm:function(){object.selectionsApi.deactivateSearch&&object.selectionsApi.deactivateSearch(),object.backendApi.endSelections(!0),this.deactivated()},cancel:function(){object.selectionsApi.deactivateSearch&&object.selectionsApi.deactivateSearch(),object.backendApi.endSelections(!1),this.deactivated()},clear:function(){object.backendApi.clearSelections()},toggleKeyboardAccelerators:function(){},getKeyAsToggleSelected:function(e){return!(e.metaKey||e.ctrlKey)},search:function(){},confirmSearch:function(){},cancelSearch:function(){},activate:function(){this.active||this.activated()}}}function setUpThrobber($scope,object){function resetThrobber(isValidating,showDelay){qvangular.getService("$timeout").cancel(isVisibleTimeout),qvangular.getService("$timeout").cancel(isLongRunningTimeout),object.selectionsApi&&object.selectionsApi.active?object.throbberApi.hide():$scope.model&&void 0===$scope.model.state?object.throbberApi.show():$scope.model&&$scope.model.isCancelled?object.throbberApi.isQueryCanceled=!0:isValidating?(isVisibleTimeout=qvangular.getService("$timeout")(function(){$scope.model&&$scope.model.isValidating&&object.throbberApi.show()},showDelay),isLongRunningTimeout=qvangular.getService("$timeout")(function(){object.throbberApi.isVisible===!0&&(object.throbberApi.isLongRunningQuery=!0,object.throbberApi.isQueryCanceled=!1)},8e3)):(object.throbberApi.hide(),object.throbberApi.isLongRunningQuery=!1)}var unwatchFn,isVisibleTimeout,isLongRunningTimeout;object.throbberApi&&"function"==typeof object.throbberApi.destroy&&object.throbberApi.destroy(),object.throbberApi={resizeCallbacks:[],isVisible:!1,isLongRunningQuery:!1,isQueryCanceled:!1,initialize:function(){unwatchFn=$scope.$watch("model.isValidating",function(isValidating){resetThrobber(isValidating,1e3)})},reset:function(isValidating){resetThrobber(isValidating,0)},show:function(){object.throbberApi.isVisible=!0,object.throbberApi.isQueryCanceled=!1,object.throbberApi.isLongRunningQuery=!1},hide:function(){object.throbberApi.isVisible=!1,object.throbberApi.isLongRunningQuery=!1,qvangular.getService("$timeout").cancel(isVisibleTimeout),qvangular.getService("$timeout").cancel(isLongRunningTimeout)},off:function(){unwatchFn(),qvangular.getService("$timeout").cancel(isVisibleTimeout),qvangular.getService("$timeout").cancel(isLongRunningTimeout)},destroy:function(){object.throbberApi.off(),object.throbberApi.resizeCallbacks.length=0},resize:function(){object.throbberApi.resizeCallbacks.forEach(function(callback){callback()})},watchResize:function(callback){object.throbberApi.resizeCallbacks.push(callback)}},object.throbberApi.initialize()}var invalidExtensionType=new ExtensionType({type:"invalid",path:"objects.error-handling/invalid-type"}),objectRenderStates={INVALID:0,RENDERED:1},objectOnPaintReturnValues={UNKNOWN:0,PROMISE:1};qvangular.componentDirective("qvObjectContent",{object:"=",backendApi:"=",ext:"=",options:"=",layout:"=",selectionsApi:"=",throbberApi:"="}),qvangular.directive("qvObject",["$parse",function($parse){return{restrict:"E",replace:!0,template:template,scope:{options:"=",model:"=",object:"=?",navMenu:"="},controller:function(){var childDfd=Deferred();this.addChildController=function(ctrl,ctrlScope){ctrl instanceof BaseCtrl||(ctrl=new(BaseCtrl.extend(ctrl)),ctrl.$scope=ctrlScope),childDfd.resolve(ctrl)},this.resetChildController=function(){childDfd=Deferred()},this.childLoaded=function(){return childDfd.promise}},link:function($scope,$element,$attrs,ctrl){var stateTimeoutP,object=$scope.object={};$scope.resetOptions=util.extend({},$scope.options),$scope.options||($scope.options={}),$scope.options.zoomEnabled=!!$attrs.zoomObject,$scope.$on("objectTrigger",function(event,type){switch(type){case"zoomOnCell":$parse($attrs.zoomObject)($scope.$parent)}event.stopPropagation()}),Object.defineProperties(object,{hasFrame:{get:function(){return!$scope.options.isPopover&&!object.isInvalid}},isReadonly:{get:function(){return object.isLink||object.isInvalid||$scope.options.isReadonly}},haveTitleArea:{get:function(){var layout=this.layout;return this.showTitles&&(""!==layout.title||""!==layout.subtitle||State.state===State.States.edit&&!this.isReadonly)}},hasSoftProperties:{get:function(){return!!this.ext&&!!this.ext.mappedSoftDefinition}}}),object.getPropertyPanelContent=function(){return object.loaded.then(function(){var propertyHandler=object.ext.getCreatePropertyHandler(),definition=object.ext.mappedDefinition||object.ext.definition,globalChangeListeners=object.ext.globalChangeListeners;return{definition:definition,globalChangeListeners:globalChangeListeners,type:object.type,backendApi:object.backendApi,handler:propertyHandler,iconClass:object.ext.libraryInfo.templateIconClassName,titleRef:"title",ext:object.ext}})},object.getSoftPropertyContent=function(){return object.loaded.then(function(){var definition=object.ext.mappedSoftDefinition||object.ext.softDefinition;return{definition:definition,type:object.type,backendApi:object.backendApi}})},object.toggleExploreMenu=function(display){void 0!==display?object.showExploreMenu=display:object.showExploreMenu=!object.showExploreMenu},object.setSnapshotData=function(snapshotLayout,options){return ctrl.childLoaded().then(function(child){return child.setSnapshotData(snapshotLayout,options)})},object.getViewState=function(){return ctrl.childLoaded().then(function(child){return child.getViewState()})},object.getDropOptions=function(builder,showMenu){return object.ext.getDropOptions(object,builder,showMenu)},object.getContextMenu=function(menu){return ctrl.childLoaded().then(function(child){return child.getContextMenu(object,menu)})},object.getObjectMenu=function(menu){return ctrl.childLoaded().then(function(child){return child.getObjectMenu(object,menu)})},object.getSelectionToolbar=function(){return object.loaded.then(function(){return ctrl.childLoaded().then(function(child){return child.getSelectionToolbar()})})},object.reloadContent=function(){$scope.ext=object.ext=$.extend({},object.ext),object.loadContent()},object.canShowExploreMenu=function(){var isOtherContent=this.content===requirements||this.content===errorHandler;return!this.isInvalid&&this.hasSoftProperties&&!isOtherContent},object.canTakeSnapshot=function(){return this.content!==requirements&&this.content!==errorHandler&&$scope.model.isValid?"function"==typeof $scope.ext.snapshot.canTakeSnapshot?$scope.ext.snapshot.canTakeSnapshot.call(null,object):"boolean"==typeof $scope.ext.snapshot.canTakeSnapshot?$scope.ext.snapshot.canTakeSnapshot:!1:void 0},object.updateSnapshot=function(){var snapshotMode=State.state===State.States.snapshot;object&&object.ext&&snapshotMode?object.ext.snapshot.updateCount($scope).then(function(count){$scope.showSnapshotCount=object&&object.canTakeSnapshot()&&count>0}):$scope.showSnapshotCount=!1},object.setInteraction=function(on){ctrl.childLoaded().then(function(child){child.setInteraction(on)})},object.setRenderState=function(state){object.renderState!==state&&(object.renderState=state,$scope.$emit("objectRenderStateChange",state))},$scope.$watch(function(){return State.state},function(currentState){var req=ctrl.childLoaded();$scope.rpcId=req.rpcId,req.then(function(child){$scope.editmode=currentState===State.States.edit,$scope.editmode&&confirmSelections(object),object.updateSnapshot(),child.onStateChanged(State),qvangular.getService("$timeout").cancel(stateTimeoutP),stateTimeoutP=qvangular.getService("$timeout")(function(){object.setObjectClass()})})}),setUpLoading($scope,$element,object,ctrl),setUpResize($scope,object),setUpPaint($scope,object,$element,ctrl),object.setRenderState(objectRenderStates.INVALID),TypeLoader.load($scope.options._skipRegisterExtensions).then(function(){setUpModel($scope,object)}),object.loaded.then(function(){$scope.cancelled=$scope.model.isCancelled}),$scope.$watch("options",function(options){options&&options.setController&&ctrl.childLoaded().then(function(){options.setController(object)})}),$scope.$on("childSelectionActive",function(event,active){object.childInSelection=active,event.preventDefault()}),$scope.takeSnapshot=function(event,options){State.state===State.States.snapshot&&object.canTakeSnapshot()&&($scope.ext.snapshot.take(this,object,event,options),$scope.showSnapshotCount=!0)},$scope.openSnapshotLibrary=function(event){event.stopImmediatePropagation(),qvangular.getService("storyItemsLibrary").openLibrary({event:event,library:"snapshot",objectId:this.layout.qInfo.qId})},$scope.titleClicked=function(){this.options._disableSelections||$scope.editmode||object.activateSelections()},$scope.cancel=function(){$scope.model.__layoutRPCId&&($scope.model.cancelRequest($scope.model.__layoutRPCId),delete $scope.model.__layoutRPCId,object.throbberApi.hide(),object.throbberApi.isQueryCanceled=!0)},$scope.retry=function(){object.throbberApi.hide(),object.throbberApi.isQueryCanceled=!1,object.throbberApi.reset(!0),$scope.model.markAsInvalid(),$scope.model.getLayout().then(function(layout){$scope.layout=layout,object.setLayout(layout)})},setUpThrobber($scope,object,ctrl),$scope.$on("$destroy",function(){qvangular.getService("$timeout").cancel(stateTimeoutP),object&&(confirmSelections(object),object.selectionsApi&&"function"==typeof object.selectionsApi.destroy&&object.selectionsApi.destroy(),object.backendApi&&(object.backendApi.destroy(),object.backendApi=null),object.throbberApi&&object.throbberApi.destroy(),object=null,$scope.object=null)})}}}])}),define("text!client.views/current-selections/current-selections.ng.html",[],function(){return'<div class="qv-panel-subtoolbar qv-panel-current-selections" ng-class="{smallDevice: isSmallDevice}">\r\n	<div ng-if="!isSmallDevice">\r\n		<div class="qv-selections-pager">\r\n\r\n			<div class="buttons borderbox">\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="back()" ng-disabled="disable.back" q-title-translation="Tooltip.NavigateBack">\r\n					<i class="icon-toolbar-navigation-back"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="forward()" ng-disabled="disable.forward" q-title-translation="Tooltip.NavigateForward">\r\n					<i class="icon-toolbar-navigation-forward"></i>\r\n				</button>\r\n\r\n				<button id="clearselections" class="qv-subtoolbar-button borderbox" ng-disabled="disable.clear" qva-activate="clearAllFields()" q-title-translation="Tooltip.ClearSelections">\r\n					<i class="icon-toolbar-clearselections"></i>\r\n				</button>\r\n\r\n			</div>\r\n			<div class="selections-shadow" ng-if="showShadow"></div>\r\n			<div class="wrap borderbox" style="height: 100%;" qv-pager qv-selection-pager>\r\n				<ul class="list" ng-show="items.length > 0 && !isGlobalSelectionsActive" qva-delegated-activate=".item#showPopover($event)" qva-outside-ignore-for="currentSelectionsItems">\r\n					<li ng-repeat="item in items track by item.qField" data-csid="{{item.qField}}">\r\n						<div class="item" ng-mousemove="openTooltip($event, item)" ng-mouseleave="closeTooltip()" ng-class="{\r\n				\'active\' : item.qField === activeFieldName,\r\n				\'dim\' : $parent.itemSelected && !item.active,\r\n				\'item-locked\' : item.qLocked,\r\n				\'locked-feedback item-animate-in\' : item.feedbackActive && item.qLocked,\r\n				\'item-animate-out\' : !item.feedbackActive && item.qLocked }">\r\n							<div ng-class="{locked:item.qLocked}" class="text">\r\n								<div class="text-wrap">\r\n									<span ng-class="{ \'icon-toolbar-locked\': item.qLocked }"></span><span class="name">{{item.qField}}</span>\r\n								</div>\r\n								<span class="values">{{item.translation}}</span>\r\n							</div>\r\n						<span ng-class="{\r\n						\'icon-toolbar-locked\': item.qLocked,\r\n						\'item-animate-in\' : item.feedbackActive,\r\n						\'item-animate-out\' : !item.feedbackActive,\r\n						\'icon-locked-feedback\' : item.feedbackActive && item.qLocked }">\r\n						</span>\r\n							<div class="options">\r\n								<a ng-if="!item.qLocked && !item.isPlaceHolder" qva-activate="clear(item.qField)" class="remove" q-title-translation="CurrentSelections.Remove">\r\n									<i class="icon-cancel"></i>\r\n								</a>\r\n							</div>\r\n\r\n							<qv-state-count-bar ng-if="!item.isPlaceHolder" cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n				<div ng-if="!items.length" class="empty-text no-selection" q-translation="CurrentSelections.NoSelections"></div>\r\n				<a class="qv-pager-nav qv-pager-previous" qva-activate="prevPage()" q-title-translation="Tooltip.Previous"><i class="icon-hub-previous"></i></a>\r\n				<a class="qv-pager-nav qv-pager-next" qva-activate="nextPage()" q-title-translation="Tooltip.Next"><i class="icon-hub-next"></i></a>\r\n			</div>\r\n			<div class="buttons-end borderbox">\r\n				<button tid="toggleGlobalSearchButton" class="qv-subtoolbar-button global-search-button borderbox" ng-class="{active: isGlobalSearchActive}" qva-activate="toggleGlobalSearch()" q-title-translation="{{isGlobalSearchActive ? \'Tooltip.CloseGlobalSearch\' : \'Tooltip.GlobalSearch\'}}">\r\n					<i class="icon-toolbox-search-magnifier"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" ng-class="{active: isGlobalSelectionsActive}" qva-activate="toggleGlobalSelection($event)"\r\n					q-title-translation="{{isGlobalSelectionsActive ? \'Tooltip.CloseGlobalSelector\' : \'Tooltip.GlobalSelector\'}}" tid="currentSelections.toggleGlobalSelections">\r\n					<i class="icon-toolbar-currentselections"></i>\r\n				</button>\r\n			</div>\r\n\r\n		</div>\r\n	</div>\r\n	<div ng-if="isSmallDevice && mobileIndicatorShow && !inSelection " qva-activate="toggleGlobalSelection($event)" class="qv-current-selections-mobile-wrapper" tid="currentSelections.toggleMobileSelections" q-title-translation="GlobalSelections.CurrentSelections">\r\n		<div class="qv-current-selections-mobile-background">\r\n			<p class="qv-current-selections-mobile-nbr" ng-class="{selections: nbrSelections > 0}">{{nbrSelections}}</p>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("objects.models/listbox",["objects.models/visualization-object","general.utils/visualizations","objects.utils/data-properties/listobject-util","util","objects.utils/type-loader"],function(VisualizationObject,Visualizations,listObjectUtil,util,TypeLoader){"use strict";var Listbox,cachedTransientArray=[];return Listbox=VisualizationObject.extend("Listbox",{}),Listbox.createTransient=function(that,app,props){var transientObject,i,result,toReturn=-1,cachedTransientArrayLength=cachedTransientArray.length;for(transientObject={that:that,app:app,props:props},i=0;cachedTransientArrayLength>i;i++)if(angular.equals(cachedTransientArray[i].askFor,transientObject)){toReturn=i;break}return toReturn>=0?cachedTransientArray[toReturn].result:(result=TypeLoader.load().then(function(){return Visualizations.getType("listbox").getInitialProperties(props).then(function(init){return VisualizationObject.createTransient.call(that,init,app)})}),cachedTransientArray.push({askFor:transientObject,result:result}),result)},Listbox.createTransientField=function(app,field,initProps){var props={};return props.qListObjectDef=listObjectUtil.createFieldDimension(field),util.extend(!0,props,initProps||{}),this.createTransient(this,app,props)},Listbox.createTransientDimension=function(app,id,initProps){var props={};return props.qListObjectDef=listObjectUtil.createLibraryDimension(id),util.extend(!0,props,initProps||{}),this.createTransient(this,app,props)},Listbox}),define("objects/listbox-popover/listbox-popover",["core.utils/deferred","core.utils/resize"],function(Deferred,resize){var component={template:null,controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function destroy(){$timeout(function(){$scope.destroyComponent(),$element.remove()}),resize.off("start.listbox-popover-error",destroy)}function getWidth(){return $timeout(function(){return $element.find(".toolbar-wrapper").outerWidth()})}var ctrl=this;ctrl.selectionsActivated=function(){},ctrl.selectionsDeactivated=function(){},ctrl.close=function(){destroy()},$scope.closeView=function(event){$scope.onPopoverClose(event),destroy()},Deferred.all({object:$scope.getVisualization(),width:getWidth()}).then(function(args){var object=args.object,width=args.width;object.getSelectionToolbar().then(function(toolbar){$scope.toolbar=toolbar,$scope.toolbar.showLock=$scope.options.showLock,$scope.toolbar.position={width:width},object.activateSelections()}),object.loaded.then(function(){object.ext.hasError({layout:object.model.layout})&&resize.on("start.listbox-popover-error",destroy)}),object.selectionsApi.watchActivated(function(){ctrl.selectionsActivated()}),object.selectionsApi.watchDeactivated(function(){ctrl.selectionsDeactivated(),destroy()}),$scope.closeView=function(event){object.selectionsApi.confirm(),$scope.onPopoverClose(event),destroy()}})}]};return component}),define("text!objects/listbox-popover/listbox-popover.ng.html",[],function(){return'<immidiate-contextual\r\n		class="qv-listbox-popover"\r\n		align-to="$alignToElement"\r\n		position="popupPosition"\r\n		collision="collision"\r\n		width="234"\r\n		height="332"\r\n		on-close-view="closeView(event)"\r\n		qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options"></div>\r\n	<div class="listbox-wrapper" >\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</immidiate-contextual>\r\n'}),define("text!objects/listbox-popover/listbox-popover-small-device.ng.html",[],function(){return'<div\r\n	class="qv-listbox-popover-small-device">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options">\r\n	</div>\r\n	<h1 class="qvt-visualization-title">{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}</h1>\r\n	<div class="listbox-wrapper">\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</div>\r\n'}),define("objects/listbox-popover/listbox-popover-service",["qvangular","util","core.utils/deferred","objects.models/listbox","client.views/selection-toolbar/selection-toolbar","objects/listbox-popover/listbox-popover","general.utils/responsive-state","text!./listbox-popover.ng.html","text!./listbox-popover-small-device.ng.html","objects/object","general.components/immidiate-contextual/immidiate-contextual"],function(qvangular,util,Deferred,Listbox,selectionToolbar,listboxPopoverComponent,ResponsiveState,desktopTemplate,smallDeviceTemplate){
qvangular.service("qvListboxPopoverService",["$document",function($document){var $container,service,ctrl,$body=$document.find("body");return service={show:function(model,options,selectionsDeactivatedCallback,selectionsActivatedCallback){var d=Deferred(),data={$alignToElement:options.$alignToElement,popupPosition:options.position||"bottom",collision:options.collision||"none",qvaOutsideIgnoreFor:options.qvaOutsideIgnoreFor,getVisualization:function(){return d.promise},model:model,onPopoverClose:this.onPopoverClose,options:{setController:d.resolve,isPopover:!0,showLock:options.showLock,search:options.search||{}},selectionToolbarComponent:selectionToolbar};return ctrl&&(ctrl.selectionsActivated=function(){},ctrl.selectionsDeactivated=function(){},ctrl.close()),$container=angular.element("<div>"),$body.append($container),listboxPopoverComponent.template=ResponsiveState.isSmallDevice?smallDeviceTemplate:desktopTemplate,ctrl=$container.showComponent(listboxPopoverComponent,data),ctrl.selectionsActivated=function(){util.isFunction(selectionsActivatedCallback)&&selectionsActivatedCallback()},ctrl.selectionsDeactivated=function(){util.isFunction(selectionsDeactivatedCallback)&&selectionsDeactivatedCallback(),selectionsDeactivatedCallback=null,selectionsActivatedCallback=null},ctrl},showField:function(field,app,options,initProps,selectionsDeactivatedCallback,selectionsActivatedCallback){return Listbox.createTransientField(app,field,initProps).then(function(model){return Deferred.resolve(this.show(model,options,selectionsDeactivatedCallback,selectionsActivatedCallback))}.bind(this))},showDimension:function(id,app,options,initProps,selectionsDeactivatedCallback,selectionsActivatedCallback){Listbox.createTransientDimension(app,id,initProps).then(function(model){this.show(model,options,selectionsDeactivatedCallback,selectionsActivatedCallback)}.bind(this))},close:function(){ctrl&&ctrl.close()},onPopoverClose:function(){}}}])}),define("widget.pager",["jquery","jqueryui"],function($){return $.widget("qv.pager",{options:{itemSelector:">li",orientation:"horizontal",pageSize:"auto",startPage:1,animationDuration:300},_create:function(){var opts=this.options;$.extend(this,{positionProperty:"horizontal"===opts.orientation?"left":"top",sizeProperty:"horizontal"===opts.orientation?"outerWidth":"outerHeight"}),this.refresh(),this.goToPage(opts.startPage)},isItemInsidePage:function(item){var me=$(item),itemPos=me.position()[this.positionProperty]+me[this.sizeProperty](),leftBoundary=Math.abs(parseFloat(me.parent().css("margin-"+this.positionProperty))),rightBoundary=leftBoundary+this.containerSize;return itemPos>leftBoundary&&rightBoundary>itemPos},calculatePageSize:function(){return Math.floor(this.containerSize/this.calculateItemSize())},calculateItemSize:function(){return this.element.find(this.options.itemSelector).eq(0)[this.sizeProperty]()},refresh:function(){var oldCurrentPage=this.currentPage||1;this.containerSize=this.element.parent()[this.sizeProperty](),this.pageSize="auto"===this.options.pageSize?this.calculatePageSize():this.options.pageSize,this.itemSize=this.calculateItemSize(),this.maxPages=Math.ceil(this.element.find(this.options.itemSelector).length/this.pageSize||1),this.currentPage=Math.min(oldCurrentPage,this.maxPages),this.goToPage(this.currentPage)},goToPage:function(pageNumber){this.currentPage=Math.min(Math.max(1,pageNumber),this.maxPages);var margin=(this.currentPage-1)*this.itemSize*this.pageSize,animateObj={};animateObj[this.positionProperty]=-margin+"px",this.element.stop(!0).animate(animateObj,this.options.animationDuration)},goToPreviousPage:function(){this.goToPage(this.currentPage-1)},goToNextPage:function(){this.goToPage(this.currentPage+1)},goToPageContaining:function(selector){var pageNumber=Math.ceil(this.element.find(selector).index()+1/this.pageSize);this.goToPage(pageNumber)},_destroy:function(){this.element.off(this.eventNamespace)}}),$}),define("general.components/pager/pager",["qvangular","core.utils/resize","widget.pager"],function(qvangular,resize){qvangular.directive("qvPager",["$timeout",function($timeout){return{restrict:"A",priority:0,link:function(scope,elem){function refreshPager(){scope.refreshPager()}"ontouchstart"in window&&elem.css("overflow-x","auto"),scope.pagerData=elem.find("ul").pager().data("qv-pager"),elem.addClass("qv-pager"),scope.nextPage=function(){$timeout(function(){scope.pagerData.goToNextPage(),scope.refreshPager(!0)})},scope.prevPage=function(){$timeout(function(){scope.pagerData.goToPreviousPage(),scope.refreshPager(!0)})},scope.goToPage=function(pageNo){scope.pagerData.goToPage(pageNo),scope.refreshPager(!0)},scope.refreshPager=function(onlyClasses){var classes="";onlyClasses||scope.pagerData.refresh(),elem.removeClass("qv-pager-back qv-pager-forward"),1!==scope.pagerData.currentPage?(scope.showShadow=!0,classes+="qv-pager-back "):scope.showShadow=!1,scope.pagerData.currentPage!==scope.pagerData.maxPages&&(classes+="qv-pager-forward "),elem.addClass(classes)},scope.$on("refreshPager",refreshPager),scope.$on("$destroy",function(){resize.off("end",refreshPager)})}}}])}),define("text!client.views/global-selections/global-selections.ng.html",[],function(){return'<div class="qv-global-selections" ng-class="{\'toolbar\': toolbar, \'selection-toolbar-open\': selectionToolbarOpen}">\r\n\r\n	<section class="qv-gs-section qv-gs-top" tid="globalSelections.topSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'fields\' }" all-items="selectedFields"></div>\r\n	</section>\r\n\r\n	<section class="qv-gs-section" tid="globalSelections.bottomSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.AppDimensions"></h2>\r\n			<qui-checkbox qui-model="showFields" qui-label="{{\'GlobalSelections.ShowFields\'|translate}}" qui-title="{{\'GlobalSelections.ShowFields\'|translate}}" tid="globalSelections.showFields"></qui-checkbox>\r\n			<qui-search-field class="qv-gs-searchfield" placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter" maxlength="255"\r\n							 tid="globalSelections.searchField" on-escape="filter = \'\';" auto-focus="autoFocus" on-enter="onEnter($event)"></qui-search-field>\r\n		</header>\r\n\r\n		<div class="qv-gs-info" ng-if="!dimAvailable && !showFields">\r\n			<h2 q-translation="GlobalSelections.DimensionsWarning"></h2>\r\n		</div>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'dimensions\'}" all-items="dimensionsFields" filter="filter"></div>\r\n	</section>\r\n</div>\r\n'}),define("text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="confirm-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<header ng-if="header" class="dm-header" q-translation="{{header}}"></header>\r\n	<main class="dm-main">\r\n		<div class="qv-mvc-dialog-content">\r\n			<div class="qv-mvc-dialog-icon icon-{{icon}}" ng-show="icon"></div>\r\n			<p><span q-translation="{{text}}"></span></p>\r\n		</div>\r\n	</main>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="{{$parent.confirmLabel}}"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("general.utils/tabbable-elements",["jquery","jqueryui"],function($){"use strict";var caches=[];return{preventTabbing:function(body){var cache={id:caches.length,elements:body.find(":tabbable")};caches.push(cache),cache.elements.each(function(){var element=$(this);element.data("tabbable-elements-tabindex",element.attr("tabindex"))}),cache.elements.attr("tabindex","-1")},restoreTabbing:function(){var cache=caches.pop();cache.elements.each(function(){var element=$(this),prev=element.data("tabbable-elements-tabindex");prev?element.attr("tabindex",prev):element.removeAttr("tabindex")})}}}),define("assets/client/dialogs/directives/tabbable-container",["qvangular","general.utils/tabbable-elements","jquery"],function(qvangular,tabbable,$){qvangular.directive("qvTabbableContainer",function(){return{restrict:"A",controller:["$scope","$element",function(scope,element){var before=element[0].nextSibling,parent=element[0].parentNode;parent.removeChild(element[0]),tabbable.preventTabbing($(document.body)),document.activeElement&&document.activeElement.blur(),parent.insertBefore(element[0],before),scope.$on("$destroy",function(){tabbable.restoreTabbing()})}]}})}),define("general.utils/keyboard-event-dispatcher",["jquery"],function($){function removeEventHandlerObjectsForJack(jackId){Object.keys(events).forEach(function(eventName){events[eventName]=events[eventName].filter(function(o){return o.jackId!==jackId})})}function dispatchEvents(eventName){var args=Array.prototype.slice.call(arguments,1);events[eventName].forEach(function(handlerObject){handlerObject.jackId===hijackIdStack[hijackIdStack.length-1]&&handlerObject.handler.apply(null,args)})}function registerHandler(jack,eventName,handler){events[eventName]||(body.on(eventName,dispatchEvents.bind(null,eventName)),events[eventName]=[]),events[eventName].push({jackId:jack.id,handler:handler})}var body,events={},hijackIdStack=[],proto={on:function(eventName,handler){registerHandler(this,eventName,handler)},release:function(){var jackId=this.id;removeEventHandlerObjectsForJack(jackId),hijackIdStack.splice(hijackIdStack.indexOf(jackId),1)}};return{hijack:function(){body||(body=$(document));var hijack=Object.create(proto,{id:{value:hijackIdStack.length}});return hijackIdStack.push(hijack.id),hijack}}}),define("assets/client/dialogs/directives/escape",["qvangular","general.utils/keyboard-event-dispatcher"],function(qvangular,KeyboardDispatcher){qvangular.directive("qvDialogEscape",["$parse",function($parse){return{restrict:"A",controller:["$scope",function(scope){var hijack=this.hijack=KeyboardDispatcher.hijack();scope.$on("$destroy",function(){hijack.release()})}],link:function(scope,elem,attr,controller){var fn=$parse(attr.qvDialogEscape);controller.hijack.on("keydown",function(e){27===e.keyCode&&(e.preventDefault(),setTimeout(function(){scope.$apply(function(){fn(scope,{$event:e})})}))})}}}])}),define("text!assets/client/dialogs/directives/modal-dialog.ng.html",[],function(){return'<div class="modal-container qui-modalbackground-centered" qv-tabbable-container>\r\n	<div id="{{id}}"\r\n		 class="modal-frame qui-delayedModal"\r\n		 ng-transclude></div>\r\n</div>\r\n'}),define("assets/client/dialogs/directives/modal-dialog",["qvangular","text!assets/client/dialogs/directives/modal-dialog.ng.html","general.utils/keyboard-event-dispatcher"],function(qvangular,template,KeyboardDispatcher){qvangular.directive("qvModalDialog",function(){return{scope:{id:"@qvId",confirm:"&qvConfirm",cancel:"&qvCancel"},restrict:"E",transclude:!0,replace:!0,template:template,link:function(scope){var hijack=KeyboardDispatcher.hijack();scope.$on("$destroy",function(){hijack.release()}),hijack.on("keydown",function(e){if(27===e.keyCode&&(e.preventDefault(),setTimeout(function(){scope.$apply(function(){scope.cancel()})})),13===e.keyCode){if("TEXTAREA"===e.target.tagName)return;if("BUTTON"===e.target.tagName)return;setTimeout(function(){scope.$apply(function(){scope.confirm()})})}})}}})}),define("text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html",[],function(){return'<footer class="dm-footer">\r\n    <qui-button qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></qui-button>\r\n    <qui-button qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></qui-button>\r\n</footer>\r\n'}),define("text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html",[],function(){return'<footer class="dm-footer">\r\n    <qui-button light qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></qui-button>\r\n    <qui-button light qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></qui-button>\r\n</footer>\r\n'}),define("assets/client/dialogs/directives/confirm-cancel-footer",["qvangular","text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html","text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html"],function(qvangular,template,lightTemplate){qvangular.directive("qvConfirmCancelFooter",function(){return{scope:{confirmLabel:"@qvConfirmLabel",confirm:"&qvConfirm",confirmDisabled:"=qvConfirmDisabled",cancel:"&qvCancel",cancelDisabled:"=qvCancelDisabled"},restrict:"E",replace:!0,template:function(jQuery,$attr){var isLight=$attr.hasOwnProperty("light");return isLight?lightTemplate:template}}})}),define("assets/client/dialogs/directives/dialog-directives",["assets/client/dialogs/directives/tabbable-container","assets/client/dialogs/directives/escape","assets/client/dialogs/directives/modal-dialog","assets/client/dialogs/directives/confirm-cancel-footer"],function(){}),define("assets/client/dialogs/confirm-dialog/confirm-dialog",["general.services/show-service/show-service","text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(showService,template){function show(options){var text=options.text,icon=void 0!==options.icon?options.icon:"cogwheel",confirmLabel=options.confirm||"Common.OK",input={text:text,header:options.header,icon:icon,confirmLabel:confirmLabel};return showService.show(component,input).resultPromise}var component={template:template,scope:{text:"=",header:"=",icon:"=",confirmLabel:"="},controller:["$scope",function($scope){$scope.confirm=function(){$scope.destroyComponent(),$scope.deferredResult.resolve()},$scope.cancel=function(){$scope.destroyComponent(),$scope.deferredResult.reject()}}]};return{show:show}}),define("client.controllers/grid-controller",["core.utils/deferred","client.utils/state","general.utils/responsive-state","objects.models/visualization-object","general.utils/support"],function(Deferred,State,ResponsiveState,VisualizationObject,Support){"use strict";function createMatrix(cols,rows){for(var matrix=[],i=0;rows>i;i++){matrix[i]=[];for(var y=0;cols>y;y++)matrix[i][y]=1}return matrix}function updateMatrix(matrix,cell){var i,y,maxRow=cell.row+cell.rowspan,maxCol=cell.col+cell.colspan;for(i=cell.row;maxRow>i;i++)for(y=cell.col;maxCol>y;y++)matrix[i][y]=0}function alignCell(grid,cell){var rect=grid.rectFor(cell);return{width:"calc( "+rect.width+"% - "+2*rect.margin+"px )",height:"calc( "+rect.height+"% - "+2*rect.margin+"px )",left:"calc( "+rect.left+"% + "+rect.margin+"px )",top:"calc( "+rect.top+"% + "+rect.margin+"px )"}}function updateGridSize(grid,cols,rows){var inEdit=State.isInEditMode(),margin=inEdit?4:0,colTotal=100,rowTotal=100,colSize=colTotal/cols,rowSize=rowTotal/rows;grid.rectFor=function(pos){var width=pos.colspan*colSize,height=pos.rowspan*rowSize,left=pos.col*colSize,top=pos.row*rowSize;return{left:left,top:top,width:width,height:height,margin:margin}};var i,horizontalLines=[],verticalLines=[];for(i=0;cols-1>i;++i){var left=(i+1)*colSize;verticalLines.push({left:left+"%"})}for(i=0;rows-1>i;++i){var top=(i+1)*rowSize;horizontalLines.push({top:top+"%"})}grid.cols=cols,grid.rows=rows,grid.horizontalLines=horizontalLines,grid.verticalLines=verticalLines}function updateSheet(grid,layout){var newSheet=layout.qInfo.qId!==grid.lastSheetId,selectNewCells=!newSheet&&State.isInEditMode()&&!grid.zoomCell&&layout.permissions.update;grid.lastSheetId=layout.qInfo.qId,grid.hasUpdatePermission=layout.permissions.update,grid.isSheet=!0,grid.isMaster=!1,grid.sheetTitle=layout.qMeta&&layout.qMeta.title||"",grid.isDraft=layout.qMeta&&layout.qMeta.sourceObject&&layout.qMeta.sourceObject.length,grid.isDraftOwner=layout.qMeta&&layout.qMeta.draftObject&&layout.qMeta.draftObject.length,(newSheet||!grid.hasUpdatePermission)&&(grid.activeCell=null),newSheet&&(grid.cells=[]),updateCells(grid,layout.cells.slice(),selectNewCells)}function getNavMenu(grid,cell){return{active:!1,visible:!1,items:[{translation:"Visualization.Unlink",tid:"nav-menu-link",cssClasses:"icon-link",dynamicCssClasses:function(){var classes=[];return grid.zoomCell?classes.push("big"):classes.push("border","white"),classes.join(" ")},isVisible:function(){return(Support.treatAsDesktop()||grid.zoomCell)&&cell.object.isLink&&State.isInEditMode()},action:function(){cell.getVisualization().then(function(vis){var LinkObjectService=require("client.services/link-object-service");LinkObjectService.showBreakLinkDialog(vis.model)})}},{translation:"Tooltip.ExplorationMenu",tid:"nav-menu-explore",cssClasses:"icon-control",dynamicCssClasses:function(){var classes=[];return cell.object.showExploreMenu&&classes.push("active"),grid.zoomCell?classes.push("big"):classes.push("border","white"),cell.object.layout&&cell.object.layout.qHasSoftPatches&&classes.push("changed-state"),classes.join(" ")},isVisible:function(){return(Support.treatAsDesktop()||grid.zoomCell)&&cell.object.canShowExploreMenu()&&!State.isInEditMode()&&!grid.zooming},action:function(){grid.zoomCell?(cell.object.toggleExploreMenu(),cell.object.resize()):(grid.zoom(cell),cell.object.toggleExploreMenu(!0))}},{translation:"Tooltip.ZoomOut",tid:"nav-menu-zoom-out",cssClasses:"icon-cancel big",isVisible:function(){return grid.isSheet&&grid.zoomCell===cell&&!grid.zooming},action:function(){cell.navMenu.visible=!1,cell.object.showExploreMenu&&cell.object.toggleExploreMenu(!1),grid.zoom(null)}},{translation:"Tooltip.ZoomIn",tid:"nav-menu-zoom-in",cssClasses:"icon-zoom-in white border",isVisible:function(){return Support.treatAsDesktop()&&!grid.zoomCell&&!cell.object.isInvalid&&!grid.zooming},action:function(){grid.zoom(cell)}}]}}function findOldCell(id,oldcells){var i;if(!oldcells)return null;for(i=0;i<oldcells.length;++i)if(oldcells[i].id===id)return oldcells[i];return null}function updateCells(grid,cells,selectNewCells){function createEmptyCell(cell){updateMatrix(matrix,cell);var newCell={},pos={col:cell.col,row:cell.row,colspan:cell.colspan,rowspan:cell.rowspan};grid.setCellSize(newCell,pos),newCell.isEmpty=!0,newCell.navMenu={},result.push(newCell)}function createUsedCell(cell){updateMatrix(matrix,cell);var newCell=findOldCell(cell.name,grid.cells);if(!newCell){newCell={},newCell.id=cell.name;var d=Deferred();newCell.options={setController:d.resolve,id:cell.name,isVisible:!0,isZoomed:!1,isActive:!1,canSaveSoftProperties:grid.hasUpdatePermission&&!ResponsiveState.isSmallDevice},newCell.navMenu=getNavMenu(grid,newCell),VisualizationObject.get(cell.name).then(function(model){newCell.model=model,selectNewCells&&grid.toggleActive(newCell)}),newCell.getVisualization=function(){return d.promise}}var pos={col:cell.col,row:cell.row,colspan:cell.colspan,rowspan:cell.rowspan};grid.setCellSize(newCell,pos),newCell.isEmpty=!1,result.push(newCell)}function findOptimalRectangle(){function upadateStack(c,r,rSpan){for(var minC=c;sStack.length>0;){var top=sStack[sStack.length-1];if(top.rowSpan===rSpan)return;if(top.rowSpan<rSpan)break;sStack.pop(),minC=top.col;var cSpan=c-top.col,area=top.rowSpan*cSpan;area>sArea&&(sArea=area,sRect={col:top.col,row:r,colspan:cSpan,rowspan:top.rowSpan})}rSpan>0&&sStack.push({col:minC,rowSpan:rSpan})}for(var r,consecutive,sStack,sArea,sRect,c=cols,m=[];c--;)for(consecutive=0,r=rows,m[c]=[];r--;)matrix[r][c]?m[c][r]=++consecutive:(consecutive=0,m[c][r]=null);for(sRect=null,sArea=0,sStack=[],r=0;rows>r;++r){for(c=0;cols>c;++c)null!==m[c][r]?upadateStack(c,r,m[c][r]):upadateStack(c,r,0);upadateStack(c,r,0)}return sRect}function createEmptyCells(){for(var cell,i=1;;){if(cell=findOptimalRectangle(),!cell)break;cell.priority=i++,cells.push(cell),createEmptyCell(cell)}}function sortList(list){list.sort(function(a,b){return a=a.pos,b=b.pos,a.row-b.row}).sort(function(a,b){return a=a.pos,b=b.pos,a.row===b.row?a.col-b.col:a.row-b.row})}var cols=grid.cols,rows=grid.rows,result=[],matrix=createMatrix(cols,rows);cells.forEach(createUsedCell),sortList(result),createEmptyCells(),grid.cells=result}function Grid(gridService){this.gridService=gridService}return Grid.prototype.setCellSize=function(cell,pos){cell.pos=pos,cell.style=alignCell(this,pos)},Grid.prototype.updateActiveCell=function(){function cap_expand(dir,span){span>=0&&expand_count[dir]>span&&(expand_count[dir]=span)}function addResize(dir,span){0===expand_count[dir]&&1>=span||resize.push({dir:dir,expand:expand_count[dir],contract:span-1})}var grid=this;if(grid.activeCell&&State.isInEditMode()){for(var active_pos=grid.activeCell.pos,active_left=active_pos.col,active_right=active_left+active_pos.colspan,active_top=active_pos.row,active_bottom=active_top+active_pos.rowspan,expand_count={left:active_left,right:grid.cols-active_right,top:active_top,bottom:grid.rows-active_bottom},i=0;i<grid.cells.length;++i)if(grid.cells[i]!==grid.activeCell&&!grid.cells[i].isEmpty){var left=grid.cells[i].pos.col,right=left+grid.cells[i].pos.colspan,top=grid.cells[i].pos.row,bottom=top+grid.cells[i].pos.rowspan;active_bottom>top&&bottom>active_top&&(cap_expand("left",active_left-right),cap_expand("right",left-active_right)),active_right>left&&right>active_left&&(cap_expand("top",active_top-bottom),cap_expand("bottom",top-active_bottom))}var resize=[];addResize("left",active_pos.colspan),addResize("right",active_pos.colspan),addResize("top",active_pos.rowspan),addResize("bottom",active_pos.rowspan),grid.activeCell.resize=resize,grid.activeCell.updating=!1}},Grid.prototype.removeResizeHandles=function(){var grid=this;grid.activeCell&&delete grid.activeCell.resize},Grid.prototype.clearActiveCell=function(){var grid=this;grid.removeResizeHandles(),grid.activeCell=null},Grid.prototype.toggleActive=function(cell){var grid=this;State.isInEditMode()&&(!cell||grid.zoomCell||cell.isEmpty?grid.clearActiveCell():(grid.clearActiveCell(),grid.hasUpdatePermission&&(grid.activeCell=cell),grid.updateActiveCell()))},Grid.prototype.setEditMaster=function(masterId,type){var grid=this,cells=[{name:masterId,type:type,col:0,row:0,colspan:1,rowspan:1}];grid.lastSheetId=null,grid.isSheet=!1,grid.isMaster=!0,updateGridSize(grid,1,1),grid.activeCell=null,updateCells(grid,cells,!1),grid.zoom(grid.cells[0])},Grid.prototype.update=function(layout){if(layout){var grid=this;grid.layout=layout,updateGridSize(grid,layout.columns||12,layout.rows||7),updateSheet(grid,layout),grid.activeCell&&-1===grid.cells.indexOf(grid.activeCell)&&grid.clearActiveCell(),grid.zoomCell&&-1===grid.cells.indexOf(grid.zoomCell)&&(grid.zoomCell=null),grid.updateActiveCell()}},Grid.prototype.zoom=function(cell){var grid=this;grid.cells&&(grid.cells.forEach(function(c){c.options&&(c.options.isVisible=c===cell||!cell,c.options.isZoomed=c===cell&&!!cell)}),cell?(grid.clearActiveCell(),grid.zoomCell=cell,grid.gridService.saveScrollState(),cell.object&&(cell.object.expanded=!!cell)):grid.zoomCell&&(grid.zoomCell.object&&(grid.zoomCell.object.expanded=!1),grid.clearActiveCell(),grid.hasUpdatePermission&&(grid.activeCell=grid.zoomCell),grid.zoomCell=null,grid.updateActiveCell(),grid.gridService.restoreScrollState()))},Grid.prototype.exploreMenu=function(cell,display){cell&&cell.object&&cell.object.hasSoftProperties&&cell.object.toggleExploreMenu(display)},Grid.prototype.getOptimalCell=function(){var grid=this,items=grid.cells.slice();items.sort(function(a,b){if(a.isEmpty&&!b.isEmpty)return-1;if(b.isEmpty&&!a.isEmpty)return 1;var a_dim=a.pos.colspan*a.pos.rowspan,b_dim=b.pos.colspan*b.pos.rowspan;return a_dim>b_dim?-1:b_dim>a_dim?1:0});var optimalCell=items[0]||null;if(optimalCell&&!optimalCell.isEmpty)if(optimalCell.pos.colspan>1||optimalCell.pos.rowspan>1){var direction=optimalCell.pos.colspan>optimalCell.pos.rowspan?"right":"bottom";optimalCell={isEmpty:!0,pos:{pos:optimalCell.pos,split:direction}}}else optimalCell=null;return optimalCell},Grid}),define("client.services/grid-service",["qvangular","core.models/rpc-base","client.controllers/grid-controller","client.utils/state","jquery","general.services/delayed-modal/delayed-modal"],function(qvangular,RPCBase,Grid,State,$){"use strict";function gridFullMessage(){var dialog=qvangular.getService("$delayedModal"),options=$.extend(!0,{},{},{title:"Ui.Warning.GridFull.Title",content:"Ui.Warning.GridFull"});dialog.open(options)}function setState(view,zoom){State.setView(view);var body=$(document.body);body.toggleClass("qv-view-sheet",!zoom),body.toggleClass("qv-view-object",zoom),body.toggleClass("qv-gridzoom",zoom)}function start(model){var isEdit;$scope||($scope=qvangular.$rootScope.$new(!0),$scope.grid=new Grid(this),$scope.model=model,RPCBase.bindLayout($scope,"model",function(layout){$scope.grid.update(layout)}),$scope.$watch(State.isInEditMode,function(isInEdit){isEdit=isInEdit,$scope.grid.update($scope.grid.layout),isEdit?$scope.grid.updateActiveCell():($scope.grid.removeResizeHandles(),closeEditMaster())}),$scope.$watch("grid.zoomCell",function(zoom){if(!(isEditMaster()||State.view===State.Views.story&&State.state!==State.States.analysis)){var view=zoom?State.Views.object:State.Views.sheet;setState(view,!!zoom)}}),State.SheetChanged.bind(setSheet))}function setSheet(sheet){$scope&&($scope.model=sheet)}function stop(){$scope&&($scope.$destroy(),$scope=null,State.SheetChanged.unbind(setSheet),$interval.cancel(gridState.intervalPromise),gridState.gridElement=null)}function getOptimalCell(){var cell=$scope&&$scope.grid.getOptimalCell();return cell||gridFullMessage(),cell}function removeCell(cell){$scope&&$scope.model.removeObject(cell.pos)}function isEditMaster(){return $scope&&$scope.grid&&!$scope.model}function closeEditMaster(){isEditMaster()&&(setSheet(State.model),setState(State.Views.sheet,!1))}function editMaster(masterId,type){$scope&&($scope.model=null,$scope.grid.setEditMaster(masterId,type),setState(State.Views.masterObject,!0))}var $scope=null,$timeout=qvangular.getService("$timeout"),$interval=qvangular.getService("$interval"),gridState={gridElement:null,scrollTop:0,scrollLeft:0,lastZoomedCell:null,intervalPromise:null};return{start:start,stop:stop,goToEditMode:function(){State.setState(State.States.edit)},getOptimalCell:getOptimalCell,removeCell:removeCell,isActive:function(){return!!$scope},getGrid:function(){return $scope&&$scope.grid},getModel:function(){return $scope&&$scope.model},getActiveCell:function(){return $scope&&($scope.grid.activeCell||$scope.grid.zoomCell)},activateCell:function(cell){$scope&&$scope.grid.toggleActive(cell)},deactivateCell:function(){$scope&&$scope.grid.toggleActive(null)},getZoomCell:function(){return $scope&&$scope.grid.zoomCell},getZoomedCellId:function(){return $scope.grid.zoomCell.id},zoomInOnCell:function(id){var array;$scope&&(array=$scope.grid.cells.filter(function(item){return item.id===id}),array.length&&$scope.grid.zoom(array[0]))},zoomOut:function(){$scope&&$scope.grid.zoom(null)},saveZoom:function(){!gridState.lastZoomedCell&&$scope.grid.zoomCell&&$scope.grid.zoomCell.id&&(gridState.lastZoomedCell=$scope.grid.zoomCell.id)},restoreZoom:function(){gridState.lastZoomedCell&&$timeout(function(){$scope.grid.blockZoomAnimation=!0,this.zoomInOnCell(gridState.lastZoomedCell),gridState.lastZoomedCell=null}.bind(this))},setGridElement:function(elem){gridState.gridElement=elem},saveScrollState:function(){!gridState.lastZoomedCell&&gridState.gridElement&&(gridState.scrollTop=gridState.gridElement.scrollTop,gridState.scrollLeft=gridState.gridElement.scrollLeft)},restoreScrollState:function(){gridState.lastZoomedCell||(gridState.scrollTop>0&&(gridState.intervalPromise=$interval(function(){gridState.gridElement.children.length>0&&(gridState.gridElement.scrollTop=gridState.scrollTop,gridState.scrollTop=0,$interval.cancel(gridState.intervalPromise))},50)),gridState.scrollLeft>0&&(gridState.intervalPromise=$interval(function(){gridState.gridElement.children.length>0&&(gridState.gridElement.scrollLeft=gridState.scrollLeft,gridState.scrollLeft=0,$interval.cancel(gridState.intervalPromise))},50)))},isEditMaster:isEditMaster,closeEditMaster:closeEditMaster,editMaster:editMaster}}),define("client.assets/assets-utils",["jquery","util","assets/client/dialogs/confirm-dialog/confirm-dialog","pubsub","client.utils/state","client.services/grid-service"],function($,util,ConfirmDialog,pubsub,state,GridService){function actOnDialog(dialogInput,action){ConfirmDialog.show({text:dialogInput}).then(action)}function permissionToCreate(type){if(!permissions)throw new TypeError("Permissions are not available yet. Make sure you have initialized this module with init().");switch(type){case"measure":return permissions.createMeasure;case"dimension":return permissions.createDimension;case"visualization":return permissions.createMasterobject;default:throw new TypeError("'"+type+"' is an unknown type.")}}var permissions,utils={init:function(appPermissions){appPermissions&&(permissions=$.extend({},appPermissions))},getContextMenuAddToText:function(){var active=GridService.getActiveCell();return active?"contextMenu.addToVisualization":"contextMenu.addToSheet"},getAddToOptions:function(){var active=GridService.getActiveCell(),options=null;return state.isInEditMode()&&(options={},active?options.object=!0:options.sheet=!0),options},getAddToText:function(){var active=GridService.getActiveCell();return state.isInEditMode()?active?"library.addtoVisualization":"library.addtosheet":null},addItemToSheetOrVisualization:function(item){if(this.isAddToMode()){var active=GridService.getActiveCell(),data={item:item};active&&(data.cell=active),pubsub.publish("/ui/library/addToSheet",data)}},librarySearchFn:function(item,query,matchName){return query&&""!==query?(matchName=matchName?matchName:function(matchItem,matchQuery){return util.match([matchItem.name],matchQuery)})(item,query.toLowerCase()):!0},libraryMultiSearch:function(item,query,matchOn){if(item.match={},!query||""===query)return!0;query=query.toLowerCase();for(var match=!1,i=0;i<matchOn.length;++i){var name=matchOn[i];util.match(item[name],query)&&(match=!0,item.match[name]=!0)}return match},itemDblClickHandler:function(item){this.isAddToSheetMode()&&pubsub.publish("/ui/library/addToSheet",{item:item})},removeDialog:actOnDialog,editDialog:actOnDialog,hasLinks:function(id,Type){return Type.get(id).then(function(master){return master.getLinkedObjects().then(function(linkedObjects){return 0!==linkedObjects.length})})},toggleSelection:function(item,event){var itemElement=$(event.currentTarget);return item.selected=!item.selected,item.selected?(itemElement.on("qv-outside",function(e){var element=$(e.target);1!==element.closest("#library-preview").length&&1!==element.closest(".qv-contextmenu").length&&(item.selected=!1,itemElement.off("qv-outside"))}),!0):(itemElement.off("qv-outside"),!1)},removeSelection:function(items){$.each(items,function(index,item){item.selected=!1})},localeOrderBy:function(input,fn){if(input){var sortFn=function(a,b){return a.localeCompare(b)};fn&&fn instanceof Function&&(sortFn=function(a,b){return fn(a).localeCompare(fn(b))}),input.sort(sortFn)}return input},isAddToSheetMode:function(){return state.isInEditMode()&&state.view===state.Views.sheet&&state.model.layout.permissions.update},isAddToVisualizationMode:function(){return state.isInEditMode()&&(state.view===state.Views.object&&state.model.layout.permissions.update||state.view===state.Views.masterObject)},isAddToMode:function(){return this.isAddToSheetMode()||this.isAddToVisualizationMode()},permissionToCreate:permissionToCreate};return utils}),define("text!client.views/global-selections/directives/scroll/scroll.ng.html",[],function(){return'<div class="qv-gs-scroll-container">\r\n	<qv-scroll-area class="qv-gs-scroll-area">\r\n		<div ng-if="scrollApi.loadPrevious" class="qv-gs-scroll-btn qv-gs-scroll-btn-previous" tid="globalSelections.loadPrevious">\r\n			<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true"></qv-scroll-load-button>\r\n		</div>\r\n		<div ng-repeat="item in items" class="qv-gs-listbox">\r\n			<p ng-if="item.qField" q-title-translation="Common.Field" tid="globalSelections.fieldIndicator" class="qv-gs-field-indicator">-</p>\r\n			<qv-gs-badge></qv-gs-badge>\r\n			<qv-object ng-if="item.visible" model="item.model" options="item.options" object="item.object" class="qv-object-listbox" id="{{item.id}}"></qv-object>\r\n			<div ng-if="!item.visible" class="qv-object qv-object-listbox qv-gs-placeholder" id="{{item.id}}">\r\n				<h1 class="qv-object-title">{{item.title}}</h1>\r\n				<div class="progress">\r\n					<qv-rain></qv-rain>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div ng-if="scrollApi.loadNext" class="qv-gs-scroll-btn" tid="globalSelections.loadNext">\r\n			<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n		</div>\r\n	</qv-scroll-area>\r\n	<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\r\n</div>\r\n';
}),define("general.scroll/api/dom-api",["core.utils/class","touche"],function(Class,Touche){"use strict";function getNamespace(){return".grid-object-dom-api-"+ ++i}var GridObjectDOMApi,i=0;return GridObjectDOMApi=Class.extend({init:function($element,$scrollArea,rowSelector,firstRowSelector,lastRowSelector,scrollContentSelector){scrollContentSelector=scrollContentSelector||".scroll-content",this.$element=$element,this.$scrollArea=$scrollArea,this.$scrollContent=$scrollArea.find(scrollContentSelector),this.rowSelector=rowSelector,this.firstRowSelector=firstRowSelector,this.lastRowSelector=lastRowSelector,this.namespace=getNamespace()},destroy:function(){this.unbindNativeScroll()},bindNativeScroll:function(fn){this.$scrollArea.on("scroll"+this.namespace,fn)},unbindNativeScroll:function(){this.$scrollArea.off(this.namespace)},resetNativeScroll:function(){this.$scrollArea.scrollTop(0)},preventNativeScroll:function(){var events="mousewheel"+this.namespace+" DOMMouseScroll"+this.namespace+" mousemove"+this.namespace;return this.$scrollArea.on(events,function(e){e.preventDefault()}),Touche(this.$scrollArea[0]).tap({id:this.namespace}),function(){this.$scrollArea.off(events),Touche(this.$scrollArea[0]).off("tap",this.namespace)}.bind(this)},getBoundingBox:function(){return this.$element[0].getBoundingClientRect()},getClientWidth:function(){return this.$element[0].clientWidth},getClientHeight:function(){return this.$element[0].clientHeight},getScrollAreaBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()},getScrollAreaClientWidth:function(){return this.$scrollArea[0].clientWidth},getScrollAreaClientHeight:function(){return this.$scrollArea[0].clientHeight},getScrollAreaOffsetTop:function(){return this.$scrollArea[0].offsetTop},getScrollContentBoundingBox:function(){return this.$scrollContent[0].getBoundingClientRect()},getFirstRow:function(){return this.$scrollArea.find(this.firstRowSelector)},getLastRow:function(){return this.$scrollArea.find(this.lastRowSelector)},getVisibleRowCount:function(maxRowHeight){function isRowVisible(row,scrollAreaRect){var rowRect=row.getBoundingClientRect();return Math.round(rowRect.bottom-scrollAreaRect.bottom)<1}function getMidIx(minIx,maxIx){var range=maxIx-minIx;return 1===range?maxIx:Math.floor(minIx+range/2)}function findLastVisibleIx(rows,minIx,maxIx,scrollAreaRect){var range=maxIx-minIx,midIx=getMidIx(minIx,maxIx),visible=isRowVisible(rows[midIx],scrollAreaRect);return 0===range?visible?midIx:-1:1===range?visible?midIx:findLastVisibleIx(rows,minIx,minIx,scrollAreaRect):visible?findLastVisibleIx(rows,midIx,maxIx,scrollAreaRect):findLastVisibleIx(rows,minIx,midIx,scrollAreaRect)}var rows=this.$element[0].querySelectorAll(this.rowSelector);if(0===rows.length)return 0;if(rows=Array.prototype.slice.call(rows),rows=rows.filter(function(node){return node.nodeType===Node.ELEMENT_NODE}),0===rows.length)return 0;var scrollAreaRect=this.getScrollAreaBoundingBox(),visibleCount=findLastVisibleIx(rows,0,rows.length-1,scrollAreaRect)+1;if(visibleCount===rows.length){var row=rows[rows.length-1],rowRect=row.getBoundingClientRect(),extraPx=Math.round(scrollAreaRect.bottom-rowRect.bottom);visibleCount+=Math.floor(extraPx/maxRowHeight)}return visibleCount},alignToFirstRow:function(){var $alignToRow=this.getFirstRow(),loadButtonHeight=48;return function(){var scrollTop=$alignToRow.position().top-loadButtonHeight;this.$scrollArea.scrollTop(scrollTop)}.bind(this)},alignToLastRow:function(){var $alignToRow=this.getLastRow(),loadButtonHeight=48;return function(){this.$scrollArea.scrollTop(0);var scrollTop=$alignToRow.position().top-this.getScrollAreaBoundingBox().height+$alignToRow[0].getBoundingClientRect().height+loadButtonHeight;this.$scrollArea.scrollTop(scrollTop)}.bind(this)}})}),define("general.scroll/api/data-api",["core.utils/deferred","core.utils/class"],function(Deferred,Class){"use strict";var ScrollDataApi;return ScrollDataApi=Class.extend({getRowCount:function(){return 0},getFirstElementIndex:function(){return-1},getLastElementIndex:function(){return-1},getIndexOf:function(row){return row.getIndex()},onVirtualScroll:function(){return Deferred.resolve()},onGotoNextBlock:function(){return Deferred.resolve()},onGotoPreviousBlock:function(){return Deferred.resolve()},onInitialNativeScroll:function(){return Deferred.resolve()}})}),define("general.scroll/scroll-area-service",["qvangular"],function(qvangular){"use strict";qvangular.service("qvScrollAreaService",function(){return{createScrollbar:function(){return{vLength:0,vViewportLength:0,vPos:0,vPage:0,thumb:{},style:{},classList:[],enabled:!1,getScrollDelta:function(data){var deltaX=0,deltaY=0;if(!this.enabled)return[0,0];switch(this.direction){case"vertical":deltaY=data.swipe.curDeltaY*(1/this.scaleFactor);break;case"horizontal":deltaX=data.swipe.curDeltaX*(1/this.scaleFactor);break;default:throw"not implemented"}return[deltaX,deltaY]},active:!1}},setScrollbarData:function(scrollbar,direction,trackSize,vSize,vViewportSize,viewportRect){var eSize,uiOffset=3;switch(direction){case"vertical":eSize=viewportRect.height;break;case"horizontal":eSize=viewportRect.width;break;default:throw"not implemented"}if(scrollbar.enabled=vSize>vViewportSize&&eSize>0,scrollbar.enabled)switch(eSize-=2*uiOffset,scrollbar.uiOffset=uiOffset,scrollbar.direction=direction,scrollbar.vLength=vSize,scrollbar.vViewportLength=vViewportSize,scrollbar.vPos=0,scrollbar.vPage=eSize,scrollbar.length=eSize,scrollbar.trackSize=trackSize,scrollbar.scaleFactor=eSize/vSize,scrollbar.thumb.pos=0,scrollbar.thumb.size=0,scrollbar.thumb.vPos=0,scrollbar.showMinAffordance=!1,scrollbar.showMaxAffordance=!0,scrollbar.direction){case"vertical":scrollbar.style.top=viewportRect.top+scrollbar.uiOffset+"px",scrollbar.style.width=trackSize+"px",scrollbar.style.left=viewportRect.left+viewportRect.width-trackSize-scrollbar.uiOffset+"px",scrollbar.style.height=viewportRect.height-2*scrollbar.uiOffset+"px";break;case"horizontal":scrollbar.style.height=trackSize+"px",scrollbar.style.top=viewportRect.top+viewportRect.height-trackSize-scrollbar.uiOffset+"px",scrollbar.style.left=viewportRect.left+scrollbar.uiOffset+"px",scrollbar.style.width=viewportRect.width-2*scrollbar.uiOffset+"px";break;default:throw"not implemented"}},setVirtualScrollPos:function(delta,scrollbar,isSwiping){var minPos=0,maxPos=scrollbar.vLength-scrollbar.vViewportLength,scrollAmount=0,virtualThumbPos=scrollbar.thumb.vPos;return scrollbar.enabled?(scrollbar.vPos+=delta,scrollbar.showMinAffordance=!1,scrollbar.showMaxAffordance=!1,scrollbar.vPos<minPos?(virtualThumbPos=minPos,scrollbar.vPos=isSwiping?scrollbar.vPos:minPos,scrollbar.showMaxAffordance=!0):scrollbar.vPos>maxPos?(virtualThumbPos=maxPos,scrollbar.vPos=isSwiping?scrollbar.vPos:maxPos,scrollbar.showMinAffordance=!0):(scrollbar.vPos!==minPos&&(scrollbar.showMinAffordance=!0),scrollbar.vPos!==maxPos&&(scrollbar.showMaxAffordance=!0),virtualThumbPos=scrollbar.vPos),scrollAmount=virtualThumbPos-scrollbar.thumb.vPos,scrollbar.thumb.vPos=virtualThumbPos,scrollAmount):0},setThumbStyle:function(thumbStyle,scrollbar){var thumb=scrollbar.thumb,minSize=12,scaleFactor=scrollbar.scaleFactor,thumbPos=Math.round(thumb.vPos*scaleFactor),thumbSize=Math.round(scrollbar.vViewportLength*scaleFactor);switch(minSize>thumbSize&&(thumbPos-=Math.round((minSize-thumbSize)/2),thumbSize=minSize),thumbPos=Math.max(thumbPos,0),thumbPos+thumbSize>scrollbar.length&&(thumbPos=scrollbar.length-thumbSize),thumb.size=thumbSize,thumb.pos=thumbPos,scrollbar.direction){case"vertical":thumbStyle.top=thumbPos+"px",thumbStyle.height=thumbSize+"px";break;case"horizontal":thumbStyle.left=thumbPos+"px",thumbStyle.width=thumbSize+"px";break;default:throw"not implemented"}},setTrackHitAreaStyle:function(trackHitAreaStyle,scrollbar,trackSize){"vertical"===scrollbar.direction?(trackHitAreaStyle.right=-scrollbar.uiOffset+"px",trackHitAreaStyle.width=trackSize+scrollbar.uiOffset+"px"):(trackHitAreaStyle.bottom=-scrollbar.uiOffset+"px",trackHitAreaStyle.height=trackSize+scrollbar.uiOffset+"px")}}})}),define("general.scroll/scroll-area-controller",["general.utils/support","general.scroll/scroll-area-service"],function(support){"use strict";var ScrollAreaController=["$scope","$element","$timeout","qvScrollAreaService",function($scope,$element,$timeout,scrollAreaService){var scrollbarXCtrl,scrollbarYCtrl,fadeTimeoutId,delayTimeoutId,scrollCallbacks=[],scrollStartCallbacks=[],scrollEndCallbacks=[];$scope.interactive=!1,$scope.virtualSize={width:0,height:0},$scope.virtualViewport={width:0,height:0},$scope.scrollbarX=scrollAreaService.createScrollbar(),$scope.scrollbarY=scrollAreaService.createScrollbar(),$scope.viewportRect={top:0,left:0,width:0,height:0},$scope.hover=!1,$scope.isMouse=!0,$scope.$on("$destroy",function(){clearTimeout(fadeTimeoutId),clearTimeout(delayTimeoutId)}),this.setMouse=function(isMouse){$scope.isMouse=isMouse},this.getScrollAreaRect=function(){var rect=$element[0].getBoundingClientRect();return{top:0,left:0,width:Math.ceil(rect.width),height:Math.ceil(rect.height)}},this.addScrollbarXCtrl=function(scrollbarCtrl){scrollbarXCtrl=scrollbarCtrl},this.addScrollbarYCtrl=function(scrollbarCtrl){scrollbarYCtrl=scrollbarCtrl},this.allowFade=function(){return(void 0===scrollbarXCtrl||scrollbarXCtrl.allowFade())&&(void 0===scrollbarYCtrl||scrollbarYCtrl.allowFade())},this.toggleFadeScrollbars=function(show){clearTimeout(delayTimeoutId),clearTimeout(fadeTimeoutId),(show||this.allowFade())&&(fadeTimeoutId=setTimeout(function(){var key=show?"fadeIn":"fadeOut";scrollbarXCtrl&&scrollbarXCtrl[key](),scrollbarYCtrl&&scrollbarYCtrl[key]()},show?0:800))},this.fadeInScrollbars=function(){this.toggleFadeScrollbars(!0)},this.fadeOutScrollbars=function(){support.treatAsDesktop()&&$scope.hover||this.toggleFadeScrollbars(!1)},this.fadeOutScrollbarsDelayed=function(){clearTimeout(delayTimeoutId),delayTimeoutId=setTimeout(function(){this.toggleFadeScrollbars(!1)}.bind(this),1e3)},this.setNonMouseTrackSize=function(){"object"==typeof $scope.nonMouseViewportScrolling&&($element.addClass($scope.nonMouseViewportScrolling.className),this.setTrackSize($scope.nonMouseViewportScrolling.scrollbarSize))},this.setMouseTrackSize=function(){"object"==typeof $scope.nonMouseViewportScrolling&&$element.removeClass($scope.nonMouseViewportScrolling.className),this.setTrackSize($scope.scrollbarSize)},this.setTrackSize=function(trackSize){var vPos=this.getVirtualPosition();this.setVirtualSize($scope.virtualSize,$scope.virtualViewport,$scope.viewportRect,trackSize),this.setVirtualScrollPos(vPos.vPosX,vPos.vPosY)},this.setupScrollbars=function(trackSize){trackSize=trackSize||8,scrollAreaService.setScrollbarData($scope.scrollbarY,"vertical",trackSize,$scope.virtualSize.height,$scope.virtualViewport.height,$scope.viewportRect),scrollAreaService.setScrollbarData($scope.scrollbarX,"horizontal",trackSize,$scope.virtualSize.width,$scope.virtualViewport.width,$scope.viewportRect),$scope.scrollbarX.enabled&&$scope.scrollbarY.enabled&&($scope.scrollbarX.length-=trackSize,$scope.scrollbarX.scaleFactor=$scope.scrollbarX.length/$scope.virtualSize.width,$scope.scrollbarX.style.width=$scope.viewportRect.width-trackSize-2*$scope.scrollbarX.uiOffset+"px",$scope.scrollbarY.length-=trackSize,$scope.scrollbarY.scaleFactor=$scope.scrollbarY.length/$scope.virtualSize.height,$scope.scrollbarY.style.height=$scope.viewportRect.height-trackSize-2*$scope.scrollbarY.uiOffset+"px")},this.setVirtualSize=function(virtualSize,virtualViewport,viewportRect,trackSize){$scope.viewportRect=viewportRect,$scope.virtualSize.width=virtualSize.width,$scope.virtualSize.height=virtualSize.height,$scope.virtualViewport.width=virtualViewport.width,$scope.virtualViewport.height=virtualViewport.height,this.setupScrollbars(trackSize)},this.setViewport=function(viewportRect){$scope.viewportRect=viewportRect},this.setVirtualViewport=function(virtualViewport){var vPos=this.getVirtualPosition();$scope.virtualViewport.width=virtualViewport.width,$scope.virtualViewport.height=virtualViewport.height,$scope.scrollbarX.vViewportLength=virtualViewport.width,$scope.scrollbarY.vViewportLength=virtualViewport.height,this.setupScrollbars($scope.isMouse?$scope.scrollbarSize:$scope.nonMouseViewportScrolling.scrollbarSize),this.setVirtualScrollPos(vPos.vPosX,vPos.vPosY)},this.getVirtualSize=function(){return{width:$scope.virtualSize.width,height:$scope.virtualSize.height}},this.getVirtualPosition=function(){var minPos=0,maxPos=this.getMaxPosition();return{vPosX:Math.max(minPos,Math.min(maxPos.vPosX,$scope.scrollbarX.vPos)),vPosY:Math.max(minPos,Math.min(maxPos.vPosY,$scope.scrollbarY.vPos))}},this.getMaxPosition=function(){var minPos=0,maxPosX=Math.max(minPos,$scope.scrollbarX.vLength-$scope.scrollbarX.vViewportLength),maxPosY=Math.max(minPos,$scope.scrollbarY.vLength-$scope.scrollbarY.vViewportLength);return{vPosX:maxPosX,vPosY:maxPosY}},this.isMouseOver=function(){return $scope.hover},this.resetScroll=function(){void 0!==$scope.scrollbarX.vPos&&void 0!==$scope.scrollbarY.vPos&&(0!==$scope.scrollbarX.vPos||0!==$scope.scrollbarY.vPos)&&this.scroll(-$scope.scrollbarX.vPos,-$scope.scrollbarY.vPos,!0,!1)},this.setVirtualScrollPos=function(deltaX,deltaY,isSwiping){scrollAreaService.setVirtualScrollPos(deltaX,$scope.scrollbarX,isSwiping),scrollAreaService.setVirtualScrollPos(deltaY,$scope.scrollbarY,isSwiping)},this.scroll=function(deltaX,deltaY,reset,isSwiping){var scrolledX,scrolledY;scrolledX=scrollAreaService.setVirtualScrollPos(deltaX,$scope.scrollbarX,isSwiping),scrolledY=scrollAreaService.setVirtualScrollPos(deltaY,$scope.scrollbarY,isSwiping),(0!==scrolledX||0!==scrolledY||reset)&&scrollCallbacks.forEach(function(callback){callback(scrolledX,scrolledY)})},this.getScrollAmount=function(deltaX,deltaY,deltaMode){switch(deltaMode){default:return{deltaX:deltaX,deltaY:deltaY}}},this.scrollStart=function(){scrollStartCallbacks.forEach(function(callback){callback()})},this.scrollEnd=function(){scrollEndCallbacks.forEach(function(callback){callback()})},this.onScroll=function(callback){scrollCallbacks.push(callback)},this.onScrollStart=function(callback){scrollStartCallbacks.push(callback)},this.onScrollEnd=function(callback){scrollEndCallbacks.push(callback)},this.on=function(){$scope.off=$scope.on(),$scope.interactive=!0},this.off=function(){$scope.off&&($scope.off(),$scope.interactive=!1)},this.isVerticalScrollEnabled=function(){return $scope.scrollbarY.enabled},this.digest=function(){$scope.$parent.$digest()}}];return ScrollAreaController}),define("general.scroll/loader/loader",["qvangular","core.utils/deferred"],function(qvangular,Deferred){"use strict";qvangular.directive("qvScrollLoader",["$animate","$timeout",function($animate,$timeout){return{restrict:"E",replace:!0,template:function($element,$attrs){var tag=$attrs.tag||"div";return"<"+tag+' ng-style="loaderStyle" class="qv-scroll-loader qv-animate"><qv-rain ng-if="showRain" show="showRain"></qv-rain></'+tag+">"},scope:{},controller:function(){},link:function($scope,$element,$attrs,ctrl){function update(top,bbox){$scope.loaderStyle.top=top,$scope.loaderStyle.width=bbox.width,$scope.loaderStyle.height=bbox.height}var rainTimeoutPromise,noRain=!!$attrs.noRain;$scope.loaderStyle={width:0,height:0},$scope.showRain=!1,ctrl.fadeIn=function(top,bbox){var defer=Deferred();return update(top,bbox),noRain||(rainTimeoutPromise=$timeout(function(){$scope.showRain=!0})),$animate.addClass($element,"fade",function(){defer.resolve()}),defer.promise},ctrl.fadeOut=function(){var defer=Deferred();return $scope.showRain=!1,$animate.removeClass($element,"fade",function(){$scope.loaderStyle.width=0,$scope.loaderStyle.height=0,$scope.$digest(),defer.resolve()}),defer.promise},$scope.$on("$destroy",function(){$timeout.cancel(rainTimeoutPromise)})}}}])}),define("text!general.scroll/loader/load-button.ng.html",[],function(){return'<div class="qv-scroll-data-load-buttons" ng-class="{ previous: previous }">\r\n	<div ng-transclude></div>\r\n	<button class="qui-outlinebutton" qva-activate="load()">\r\n		<p q-translation="{{text}}"></p>\r\n	</button>\r\n</div>'}),define("general.scroll/loader/load-button",["qvangular","text!./load-button.ng.html"],function(qvangular,loadButtonTemplate){"use strict";qvangular.directive("qvScrollLoadButton",[function(){return{restrict:"E",transclude:!0,replace:!0,template:function($element,$attrs){var tag=$attrs.tag||"div";return loadButtonTemplate.replace(/^\s*<div/,"<"+tag).replace(/<\/div>\s*$/,"</"+tag+">")},scope:{onLoad:"&",text:"@",previous:"="},link:function($scope){$scope.load=function(){$scope.onLoad()}}}}])}),define("text!general.scroll/scroll-area.ng.html",[],function(){return'<div>\r\n	<div class="scroll-content" ng-transclude></div>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMinAffordance" x-direction="\'vertical\'" x-dock="\'min\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMinAffordance" x-direction="\'horizontal\'" x-dock="\'min\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scrollbar x-data="scrollbarY" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarY.enabled"></qv-scrollbar>\r\n	<qv-scrollbar x-data="scrollbarX" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarX.enabled"></qv-scrollbar>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMaxAffordance" x-direction="\'vertical\'" x-dock="\'max\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMaxAffordance" x-direction="\'horizontal\'" x-dock="\'max\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n</div>\r\n'}),define("text!general.scroll/scrollbar.ng.html",[],function(){return'<div class="scrollbar-animation scrollbar-track"\r\n	ng-class="data.classList"\r\n	ng-style="data.style">\r\n	<qv-scrollbar-track-hit-area ng-style="trackHitAreaStyle" class="scrollbar-hitarea"></qv-scrollbar-track-hit-area>\r\n	<qv-scrollbar-thumb ng-class="{ active: data.active }" class="scrollbar-thumb" ng-style="thumbStyle"></qv-scrollbar-thumb>\r\n</div>\r\n'}),define("general.scroll/mouse-wheel-service",["qvangular"],function(qvangular){"use strict";var support="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";qvangular.service("qvMouseWheelService",function(){return{getEventName:function(){return support},getMouseWheelData:function(orgEvent){var deltaMode=1,delta=0,deltaX=0,deltaY=0,divider=40;return"wheel"===support?orgEvent:("MozMousePixelScroll"===orgEvent.type&&(deltaMode=0),orgEvent.wheelDelta&&(delta=-orgEvent.wheelDelta/divider),orgEvent.detail&&(delta=-orgEvent.detail/3),deltaY=delta,void 0!==orgEvent.axis&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaY=0,deltaX=-1*delta),void 0!==orgEvent.wheelDeltaY&&(deltaY=-1*orgEvent.wheelDeltaY/divider),void 0!==orgEvent.wheelDeltaX&&(deltaX=-1*orgEvent.wheelDeltaX/divider),{deltaMode:deltaMode,delta:delta,deltaX:deltaX,deltaY:deltaY,x:orgEvent.pageX,y:orgEvent.pageY})}}})}),define("general.scroll/scroll-area-affordance",["qvangular"],function(qvangular){"use strict";qvangular.directive("qvScrollAreaAffordance",function(){return{restrict:"E",template:'<div ng-show="show" class="scroll-affordance" ng-class="[dock,direction]" ng-style="style"></div>',replace:!0,require:"^qvScrollArea",scope:{viewportRect:"=",direction:"=",dock:"=",size:"=?",show:"="},link:function($scope){$scope.size=$scope.size||18,$scope.style={},$scope.updateAffordance=function(){switch($scope.direction){case"vertical":switch($scope.style.width=$scope.viewportRect.width+"px",$scope.style.height=$scope.size+"px",$scope.dock){case"min":$scope.style.left=$scope.viewportRect.left+"px",$scope.style.top=$scope.viewportRect.top+"px";break;case"max":$scope.style.left=$scope.viewportRect.left+"px",$scope.style.top=$scope.viewportRect.top+$scope.viewportRect.height-$scope.size+"px";break;default:throw"Dock "+$scope.dock+" not supported"}break;case"horizontal":switch($scope.style.width=$scope.size+"px",$scope.style.height=$scope.viewportRect.height+"px",$scope.dock){case"min":$scope.style.left=$scope.viewportRect.left+"px",$scope.style.top=$scope.viewportRect.top+"px";break;case"max":$scope.style.left=$scope.viewportRect.left+$scope.viewportRect.width-$scope.size+"px",$scope.style.top=$scope.viewportRect.top+"px";break;default:throw"Dock "+$scope.dock+" not supported"}break;default:throw"Direction "+$scope.direction+" not supported"}},$scope.$watch("viewportRect",$scope.updateAffordance,!0)}}})}),define("general.scroll/scroll-area",["jquery","qvangular","general.scroll/scroll-area-controller","text!./scroll-area.ng.html","text!./scrollbar.ng.html","touche","general.utils/support","general.scroll/scroll-area-service","general.scroll/mouse-wheel-service","general.scroll/scroll-area-affordance"],function($,qvangular,ScrollAreaController,scrollAreaTemplate,scrollbarTemplate,Touche,support){"use strict";qvangular.directive("qvScrollArea",["$document","$timeout","qvScrollAreaService","qvMouseWheelService",function($document,$timeout,scrollAreaService,mouseWheelService){return{restrict:"E",transclude:!0,template:scrollAreaTemplate,replace:!0,scope:{scrollbarSize:"=?",nonMouseViewportScrolling:"=?"},require:"qvScrollArea",controller:ScrollAreaController,link:function($scope,$element,$attrs,ctrl){function insideViewport(x,y){var left=$scope.viewportRect.left,top=$scope.viewportRect.top,right=$scope.viewportRect.left+$scope.viewportRect.width,bottom=$scope.viewportRect.top+$scope.viewportRect.height;return x>=left&&right>=x&&y>=top&&bottom>=y}function off(){$element.off($scope.namespace),$document.off($scope.namespace),Touche($element[0]).off("*",$scope.namespace)}"number"!=typeof $scope.scrollbarSize&&($scope.scrollbarSize=8),$scope.$watch("scrollbarX.enabled",function(enabled){enabled===!0&&$element.css("overflow-x","hidden")}),$scope.$watch("scrollbarY.enabled",function(enabled){enabled===!0&&$element.css("overflow-y","hidden")}),$scope.namespace=".scroll-area-"+$scope.$id,$scope.on=function(){return $element.on(mouseWheelService.getEventName()+$scope.namespace,function(e){var scrollAmount,wheelData=mouseWheelService.getMouseWheelData(e.originalEvent);scrollAmount=ctrl.getScrollAmount(wheelData.deltaX,wheelData.deltaY,wheelData.deltaMode),ctrl.scroll(scrollAmount.deltaX,scrollAmount.deltaY,!1,!1),support.treatAsDesktop()||(ctrl.setMouseTrackSize(),ctrl.fadeInScrollbars(),ctrl.fadeOutScrollbarsDelayed()),ctrl.digest()}),$document.on("keydown"+$scope.namespace,function(event){var deltaMode,scrollAmount,deltaX=0,deltaY=0,target=$(event.target),isInputTarget=target.is("input")||target.is("textarea");if($scope.hover&&!isInputTarget){switch(event.keyCode){case 33:deltaY=1,deltaMode=2;break;case 34:deltaY=-1,deltaMode=2;break;case 36:deltaY=1,deltaMode=10;break;case 35:deltaY=-1,deltaMode=10;break;case 38:deltaY=1,deltaMode=1;break;case 40:deltaY=-1,deltaMode=1;break;case 39:deltaX=-1,deltaMode=1;break;case 37:deltaX=1,deltaMode=1;break;default:return}scrollAmount=ctrl.getScrollAmount(deltaX,deltaY,deltaMode),ctrl.scroll(-scrollAmount.deltaX,-scrollAmount.deltaY,!1,!1),ctrl.digest()}}),$element.on((support.treatAsDesktop()?"mouseenter":"pointerenter")+$scope.namespace,function(e){$scope.isMouse=support.isMouse(e.originalEvent),$scope.isMouse?($scope.hover=!0,support.treatAsDesktop()&&(ctrl.setMouseTrackSize(),ctrl.fadeInScrollbars()),ctrl.digest()):e.preventDefault()}),$element.on((support.treatAsDesktop()?"mouseleave":"pointerleave")+$scope.namespace,function(e){$scope.isMouse=support.isMouse(e.originalEvent),$scope.isMouse&&($scope.hover=!1,support.treatAsDesktop()&&ctrl.fadeOutScrollbars())}),"object"==typeof $scope.nonMouseViewportScrolling&&("number"!=typeof $scope.nonMouseViewportScrolling.scrollbarSize&&($scope.nonMouseViewportScrolling.scrollbarSize=36),"string"!=typeof $scope.nonMouseViewportScrolling.className&&($scope.nonMouseViewportScrolling.className="show-non-mouse-scrollbars"),Touche($element[0]).swipe({id:$scope.namespace,options:{radiusThreshold:0,useMomentum:!0,inertia:.7},start:function(e,data){return support.isMouse(e)?void this.cancel():insideViewport(data.pagePoints[0].x-this.rect.x,data.pagePoints[0].y-this.rect.y)?(ctrl.setMouse(!1),ctrl.setNonMouseTrackSize(),ctrl.scrollStart(),ctrl.fadeInScrollbars(),void ctrl.digest()):void this.cancel()},update:function(e,data){var deltaX=$scope.scrollbarX.getScrollDelta(data)[0],deltaY=$scope.scrollbarY.getScrollDelta(data)[1];ctrl.scroll(-1*deltaX,-1*deltaY,!1,!0),ctrl.digest()},end:function(){ctrl.scrollEnd(),ctrl.fadeOutScrollbars(),ctrl.digest()}})),off},$scope.$on("$destroy",function(){off()})}}}]),qvangular.directive("qvScrollbar",["qvScrollAreaService",function(scrollAreaService){return{restrict:"E",require:["^qvScrollArea","qvScrollbar"],scope:{data:"=",interactive:"=",viewportRect:"="},template:scrollbarTemplate,replace:!0,controller:function(){},link:function($scope,$element,$attrs,ctrls){function fade(add){$element[add?"addClass":"removeClass"]("fade")}var scrollAreaCtrl=ctrls[0],ctrl=ctrls[1];"vertical"===$scope.data.direction?($scope.data.classList.push("vertical"),scrollAreaCtrl.addScrollbarYCtrl(ctrl)):($scope.data.classList.push("horizontal"),scrollAreaCtrl.addScrollbarXCtrl(ctrl)),ctrl.allowFade=function(){return!$scope.data.active},ctrl.fadeIn=function(){return fade(!0)},ctrl.fadeOut=function(){return fade(!1)},$scope.thumbStyle={},$scope.$watch("data.thumb",function(){scrollAreaService.setThumbStyle($scope.thumbStyle,$scope.data)},!0),$scope.$watch("data.vPage",function(){scrollAreaService.setThumbStyle($scope.thumbStyle,$scope.data)}),$scope.$watch("data.vLength",function(){scrollAreaService.setThumbStyle($scope.thumbStyle,$scope.data)}),$scope.$watch("data.enabled",function(enabled){scrollAreaCtrl.isMouseOver()&&enabled&&ctrl.fadeIn()}),$scope.setThumbStyle=scrollAreaService.setThumbStyle.bind(null,$scope.thumbStyle,$scope.data),$scope.trackHitAreaStyle={},$scope.$watch("data.trackSize",function(trackSize){void 0!==trackSize&&scrollAreaService.setTrackHitAreaStyle($scope.trackHitAreaStyle,$scope.data,trackSize)}),$scope.start=function(isMouse){scrollAreaCtrl.setMouse(isMouse),$scope.data.active||support.treatAsDesktop()||(isMouse?scrollAreaCtrl.setMouseTrackSize():scrollAreaCtrl.setNonMouseTrackSize(),scrollAreaCtrl.fadeInScrollbars()),$scope.data.active=!0,scrollAreaCtrl.scrollStart()},$scope.update=function(deltaX,deltaY){scrollAreaCtrl.scroll(deltaX,deltaY,!1,!0)},$scope.end=function(delayFadeOut){var data=$scope.data,minPos=0,maxPos=data.vLength-data.vViewportLength;data.vPos<minPos?data.vPos=minPos:data.vPos>maxPos&&(data.vPos=maxPos),$scope.data.active=!1,scrollAreaCtrl.scrollEnd(),delayFadeOut?scrollAreaCtrl.fadeOutScrollbarsDelayed():scrollAreaCtrl.fadeOutScrollbars()},$scope.on=function(){return $scope.hitAreaOff=$scope.hitAreaOn(),$scope.thumbOff=$scope.thumbOn(),function(){$scope.hitAreaOff(),$scope.thumbOff()}},$scope.$watch("interactive",function(on){on?$scope.off=$scope.on():$scope.off&&$scope.off()})}}}]),qvangular.directive("qvScrollbarThumb",[function(){return{restrict:"E",template:"<div></div>",replace:!0,require:"^qvScrollArea",link:function($scope,$element,$attrs,scrollAreaCtrl){$scope.thumbOn=function(){return Touche($element[0]).tap({start:function(e){Touche.preventGestures(this.gestureHandler),$scope.start(support.isMouse(e)),scrollAreaCtrl.digest()}}).swipe({options:{radiusThreshold:0},update:function(e,data){$scope.update.apply($scope,$scope.data.getScrollDelta(data)),scrollAreaCtrl.digest()},end:function(){$scope.end(),scrollAreaCtrl.digest()}}),function(){Touche($element[0]).off()}},$scope.$on("$destroy",function(){Touche($element[0]).off()})}}}]),qvangular.directive("qvScrollbarTrackHitArea",[function(){return{restrict:"E",replace:!0,template:"<div></div>",require:"^qvScrollArea",link:function($scope,$element,$attrs,scrollAreaCtrl){function mouseStart(data,rect){var scrollAmount,up,down,left,right,thumbSize=$scope.data.thumb.size,thumbPos=$scope.data.thumb.pos,deltaX=0,deltaY=0;switch($scope.data.direction){case"vertical":up=data.pagePoints[0].y-rect.y<thumbPos,down=data.pagePoints[0].y-rect.y>thumbPos+thumbSize,down?(scrollAmount=scrollAreaCtrl.getScrollAmount(-1,-1,2),deltaX=0,deltaY=-scrollAmount.deltaY):up&&(scrollAmount=scrollAreaCtrl.getScrollAmount(1,1,2),deltaX=0,deltaY=-scrollAmount.deltaY);break;case"horizontal":left=data.pagePoints[0].x-rect.x<thumbPos,right=data.pagePoints[0].x-rect.x>thumbPos+thumbSize,left?(scrollAmount=scrollAreaCtrl.getScrollAmount(1,1,2),deltaX=-scrollAmount.deltaX,deltaY=0):right&&(scrollAmount=scrollAreaCtrl.getScrollAmount(-1,-1,2),deltaX=-scrollAmount.deltaX,deltaY=0)}scrollAreaCtrl.scroll(deltaX,deltaY)}function nonMouseStart(data,rect){switch($scope.data.direction){case"vertical":$scope.update(0,(data.pagePoints[0].y-rect.y-($scope.data.thumb.pos+$scope.data.thumb.size/2))*(1/$scope.data.scaleFactor));break;case"horizontal":$scope.update((data.pagePoints[0].x-rect.x-($scope.data.thumb.pos+$scope.data.thumb.size/2))*(1/$scope.data.scaleFactor),0);break;default:throw"not implemented"}}$scope.hitAreaOn=function(){return Touche($element[0]).tap({start:function(e,data){Touche.preventGestures(this.gestureHandler),$scope.start(support.isMouse(e)),$scope.setThumbStyle(),support.isMouse(e)?mouseStart(data,this.rect):nonMouseStart(data,this.rect),scrollAreaCtrl.digest()},end:function(){$scope.end(!0),scrollAreaCtrl.digest()}}).swipe({options:{radiusThreshold:0},start:function(e,data){return support.isMouse(e)?void this.cancel():($scope.update.apply($scope,$scope.data.getScrollDelta(data)),void scrollAreaCtrl.digest())},update:function(e,data){$scope.update.apply($scope,$scope.data.getScrollDelta(data)),scrollAreaCtrl.digest()},end:function(){$scope.end(!0),scrollAreaCtrl.digest()}}),function(){Touche($element[0]).off()}},$scope.$on("$destroy",function(){Touche($element[0]).off()})}}}])}),define("general.scroll/api/vertical-scroll-api",["core.utils/class","core.utils/notification","util","general.utils/support","general.scroll/api/dom-api","general.scroll/api/data-api","general.scroll/scroll-area-controller","general.scroll/loader/loader","general.scroll/loader/load-button","general.scroll/scroll-area"],function(Class,Notification,util,support,DOMApi,DataApi,ScrollAreaCtrl){"use strict";var VerticalScrollApi;return VerticalScrollApi=Class.extend({destroy:function(){this.$timeout.cancel(this.initPromise),this.$timeout.cancel(this.setVirtualSizePromise),this.unpreventNativeScroll&&this.unpreventNativeScroll(),this.domApi.destroy()},init:function($timeout,settings){Notification.create(this,"Scroll"),this.$timeout=$timeout,this.initPromise=null,this.setVirtualSizePromise=null,void 0!==settings.virtualScrollEnabled?this.virtualScrollEnabled=settings.virtualScrollEnabled:this.virtualScrollEnabled=support.treatAsDesktop(),this.loaderStyle={width:0,height:0},this.totalRows=0,this.totalColumns=0,this.alignBottomAbsolute=!1,this.axisDelta={xAxis:0,yAxis:0},this.alignToBottomReduce={active:!1,activeFromStart:!1},this.ignoreScroll=!1,this.loadNext=!1,this.loadPrevious=!1,this.settings=util.extend(!0,{alignToBottom:"absolute",minRowHeight:21,maxRowHeight:21,minColumnWidth:30,viewportRowCount:0,viewportColumnCount:0,width:0,height:0,blockSize:100,keepItemsCount:10},settings)},initialize:function(domApi,dataApi,virtualScrollApi,loaderApi){if(!(domApi instanceof DOMApi))throw"Must provide an instance of domApi";if(!(dataApi instanceof DataApi))throw"Must provide an instance of dataApi";if(!(virtualScrollApi instanceof ScrollAreaCtrl[4]))throw"Must provide an instance of ScrollAreaController";if(!loaderApi||"function"!=typeof loaderApi.fadeIn||"function"!=typeof loaderApi.fadeOut)throw"Must provide valid loader api";return this.initPromise?this.initPromise:(this.domApi=domApi,
this.dataApi=dataApi,this.virtualScrollApi=virtualScrollApi,this.loaderApi=loaderApi,this.initPromise=this.$timeout(function(){this.onInit(),this.onInitVirtualScroll(),this.bindNativeScroll()}.bind(this)),this.initPromise)},onInit:function(){this.updateViewport()},onInitVirtualScroll:function(){this.virtualScrollApi.onScroll(this.onVirtualScroll.bind(this)),this.virtualScrollApi.getScrollAmount=this.getVirtualScrollAmount.bind(this)},bindNativeScroll:function(){this.domApi.bindNativeScroll(this.onNativeScroll.bind(this))},activate:function(){this.virtualScrollEnabled&&this.virtualScrollApi.on(),this.unpreventNativeScroll&&(this.unpreventNativeScroll(),this.unpreventNativeScroll=null)},deactivate:function(){this.unpreventNativeScroll=this.domApi.preventNativeScroll(),this.virtualScrollApi.off()},updateViewport:function(){var bbox=this.domApi.getBoundingBox();this.settings.width=bbox.width,this.settings.height=bbox.height,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),this.settings.viewportColumnCount=Math.ceil(this.settings.width/this.settings.minColumnWidth)},setTotalRows:function(totalRows){this.totalRows=totalRows},setTotalColumns:function(totalColumns){this.totalColumns=totalColumns},getSpliceArgs:function(){var dataRowCnt=this.dataApi.getRowCount(),viewportRowCount=this.settings.viewportRowCount,keepItemsCnt=this.settings.keepItemsCount,howMany=dataRowCnt-viewportRowCount-keepItemsCnt;return[0,howMany]},onSetVirtualSize:function(keepScrollPos){var visibleRows,virtualSize,virtualViewport,viewportRect,scrollAreaRect=this.domApi.getScrollAreaBoundingBox(),scrollContentRect=this.domApi.getScrollContentBoundingBox(),vPos=this.virtualScrollApi.getVirtualPosition(),vHeight=this.settings.minRowHeight*this.totalRows;"reduce"===this.settings.alignToBottom?(this.alignToBottomReduce.active=!1,this.alignToBottomReduce.activeFromStart=!1,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),scrollContentRect.height>=scrollAreaRect.height&&this.settings.viewportRowCount>=this.totalRows&&(visibleRows=this.domApi.getVisibleRowCount(),visibleRows<this.settings.viewportRowCount&&(this.alignToBottomReduce.active=!0,this.alignToBottomReduce.activeFromStart=!0,this.settings.viewportRowCount=visibleRows))):this.dataApi.getRowCount()===this.totalRows&&(vHeight=scrollContentRect.height),virtualSize={width:this.settings.minColumnWidth*this.totalColumns,height:vHeight},virtualViewport={width:scrollAreaRect.width,height:this.settings.viewportRowCount*this.settings.minRowHeight},viewportRect={top:0,left:0,width:scrollAreaRect.width,height:scrollAreaRect.height},this.virtualScrollApi.setVirtualSize(virtualSize,virtualViewport,viewportRect),keepScrollPos&&this.virtualScrollApi.scroll(vPos.vPosX,vPos.vPosY,!0)},setVirtualSize:function(keepScrollPos){if(this.virtualScrollEnabled){var promize=this.setVirtualSizePromise=this.$timeout(function(){this.onSetVirtualSize(keepScrollPos),this.updateAlignToBottom()}.bind(this));return promize}},getVirtualScrollAmount:function(deltaX,deltaY,deltaMode){var vPos=this.virtualScrollApi.getVirtualPosition(),vMaxPos=this.virtualScrollApi.getMaxPosition();if(this.alignBottomAbsolute&&0>deltaY)return{deltaX:deltaX,deltaY:deltaY};switch(deltaMode){case 1:return{deltaX:0,deltaY:this.settings.minRowHeight*deltaY};case 2:return{deltaX:0,deltaY:this.settings.viewportRowCount*this.settings.minRowHeight*deltaY};case 10:return{deltaX:0,deltaY:deltaY>0?vPos.vPosY*deltaY:vPos.vPosY-vMaxPos.vPosY};default:return{deltaX:deltaX,deltaY:deltaY}}},getPage:function(vPos){return{left:Math.floor(vPos.vPosX/this.settings.minColumnWidth),top:Math.floor(vPos.vPosY/this.settings.minRowHeight),width:this.settings.viewportColumnCount,height:this.settings.viewportRowCount}},adjustPageToBounds:function(page){page.top>0&&page.top+page.height>this.totalRows&&(page.top=Math.max(0,this.totalRows-page.height),page.height=Math.min(this.totalRows,page.height)),page.left>0&&page.left+page.width>this.totalColumns&&(page.left=Math.max(0,this.totalColumns-page.width),page.width=Math.min(this.totalColumns,page.width))},onVirtualScroll:function(scrolledX,scrolledY){this.Scroll.emit();var vPos=this.virtualScrollApi.getVirtualPosition(),vPosMax=this.virtualScrollApi.getMaxPosition(),page=this.getPage(vPos);return this.alignToBottomReduce.active&&0>scrolledY&&(this.graduallyLeaveAlignToBottomReduce(page),vPosMax=this.virtualScrollApi.getMaxPosition()),"reduce"===this.settings.alignToBottom&&vPosMax.vPosY>0&&vPos.vPosY===vPosMax.vPosY&&(this.alignToBottomReduce.active=!0),this.adjustPageToBounds(page),this.axisDelta.xAxis=scrolledX,this.axisDelta.yAxis=scrolledY,this.dataApi.onVirtualScroll(page.top,page.height,page.left,page.width,scrolledX,scrolledY).then(function(){this.updateAlignToBottom()}.bind(this))},updateAlignToBottom:function(){"reduce"===this.settings.alignToBottom?this.updateAlignToBottomReduce():this.updateAlignToBottomAbsolute()},updateAlignToBottomAbsolute:function(){var vPos=this.virtualScrollApi.getVirtualPosition(),vMaxPos=this.virtualScrollApi.getMaxPosition();this.virtualScrollApi.isVerticalScrollEnabled()&&vPos.vPosY===vMaxPos.vPosY?this.alignBottomAbsolute=!0:this.alignBottomAbsolute=!1},updateAlignToBottomReduce:function(){var makeSureItsPossibleToScrollDown=!1;if(this.alignToBottomReduce.active){if(this.axisDelta.yAxis>0){var visibleRowCount=this.domApi.getVisibleRowCount(this.settings.maxRowHeight);this.settings.viewportRowCount=visibleRowCount}else{var maxRowCount=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.settings.viewportRowCount>=maxRowCount&&(this.alignToBottomReduce.active=!1),makeSureItsPossibleToScrollDown=!0}var scrollAreaRect=this.domApi.getScrollAreaBoundingBox();this.virtualScrollApi.setViewport({top:0,left:0,width:scrollAreaRect.width,height:scrollAreaRect.height}),this.virtualScrollApi.setVirtualViewport({width:scrollAreaRect.width,height:this.settings.viewportRowCount*this.settings.minRowHeight}),makeSureItsPossibleToScrollDown&&this.virtualScrollApi.setVirtualScrollPos(0,-1)}},graduallyLeaveAlignToBottomReduce:function(page){var maxRowCount=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.alignToBottomReduce.activeFromStart||(page.height=Math.min(this.totalRows-page.top,maxRowCount),this.settings.viewportRowCount=page.height)},updateLoadingButtons:function(){var rowIndex=this.dataApi.getFirstElementIndex(),height=this.dataApi.getRowCount();rowIndex+height>=this.totalRows||0===this.totalRows||0>rowIndex?this.loadNext=!1:this.loadNext=!0,rowIndex>0?this.loadPrevious=!0:this.loadPrevious=!1},resetNativeScroll:function(){return this.ignoreScroll=!0,this.loadNext=!1,this.loadPrevious=!1,this.domApi.resetNativeScroll(),function(){this.ignoreScroll=!1}.bind(this)},onNativeScroll:function(){if(this.Scroll.emit(),!this.ignoreScroll){var rowIndex=this.dataApi.getLastElementIndex()+1,height=this.settings.blockSize-rowIndex;this.ignoreScroll=!0,this.dataApi.onInitialNativeScroll(rowIndex,height).then(function(){this.updateLoadingButtons()}.bind(this))}},gotoNextBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var alignToRowFn=this.domApi.alignToLastRow(),rowIndex=this.dataApi.getLastElementIndex()+1,height=this.settings.blockSize-this.settings.keepItemsCount;this.dataApi.onGotoNextBlock(rowIndex,height).then(function(){this.updateLoadingButtons(),this.$timeout(function(){alignToRowFn(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))},gotoPreviousBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var alignToRowFn=this.domApi.alignToFirstRow(),height=this.settings.blockSize-this.settings.keepItemsCount,rowIndex=this.dataApi.getFirstElementIndex()-height;0>rowIndex&&(height+=rowIndex,rowIndex=0),this.dataApi.onGotoPreviousBlock(rowIndex,height).then(function(){this.updateLoadingButtons(),this.$timeout(function(){alignToRowFn(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))}})}),define("general.scroll/api/simple-list-data-api",["core.utils/deferred","general.scroll/api/data-api"],function(Deferred,ScrollDataApi){"use strict";var SimpleListDataApi;return SimpleListDataApi=ScrollDataApi.extend({init:function(scrollApi){this.list=[],this.scrollApi=scrollApi},getRowCount:function(){return this.scrollApi.items?this.scrollApi.items.length:0},getFirstElementIndex:function(){return this.list.indexOf(this.scrollApi.items[0])},getLastElementIndex:function(){return this.list.indexOf(this.scrollApi.items[this.scrollApi.items.length-1])},getItems:function(index,count){return this.list.slice(Math.max(0,index),index+count)},setItems:function(index,count){this.scrollApi.items=this.getItems(index,count)},setList:function(list){this.list=list,this.scrollApi.setTotalRows(this.list.length),this.scrollApi.virtualScrollEnabled?(this.setItems(0,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!1)):(this.setItems(0,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()())},resize:function(){this.scrollApi.updateViewport();var count=this.getRowCount(),start=count>0?this.getFirstElementIndex():0;return 0!==start&&start+this.scrollApi.settings.viewportRowCount>count&&(start=Math.max(0,count-this.scrollApi.settings.viewportRowCount)),this.scrollApi.virtualScrollEnabled?(this.setItems(start,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!0)):0===start&&count<this.scrollApi.settings.blockSize?(this.setItems(start,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()(),Deferred.resolve()):Deferred.resolve()},onVirtualScroll:function(rowIndex,height){return this.setItems(rowIndex,height),Deferred.resolve()},onInitialNativeScroll:function(rowIndex,height){return this.setItems(0,rowIndex+height),Deferred.resolve()},onGotoNextBlock:function(rowIndex,height){var keepItemsCnt=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(rowIndex-keepItemsCnt,height+keepItemsCnt),Deferred.resolve()},onGotoPreviousBlock:function(rowIndex,height){var keepItemsCnt=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(rowIndex,height+keepItemsCnt),Deferred.resolve()}})}),function(root,undefined){"use strict";var HEX_CHARS=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],HEX_TABLE={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],sha256=function(message){return sha2(message,!0)},sha224=function(message){return sha2(message,!1)},sha2=function(message,is256){is256===undefined&&(is256=!0);var blocks=hasUTF8(message)?UTF8toBlocks(message):ASCIItoBlocks(message);if(is256)var h0=1779033703,h1=3144134277,h2=1013904242,h3=2773480762,h4=1359893119,h5=2600822924,h6=528734635,h7=1541459225;else var h0=3238371032,h1=914150663,h2=812702999,h3=4144912697,h4=4290775857,h5=1750603025,h6=1694076839,h7=3204075428;for(var i=0,length=blocks.length;length>i;i+=16){for(var s0,s1,w=[],j=0;16>j;++j)w[j]=blocks[i+j];for(var j=16;64>j;++j)s0=rightrotate(w[j-15],7)^rightrotate(w[j-15],18)^w[j-15]>>>3,s1=rightrotate(w[j-2],17)^rightrotate(w[j-2],19)^w[j-2]>>>10,w[j]=w[j-16]+s0+w[j-7]+s1;for(var maj,t1,t2,ch,a=h0,b=h1,c=h2,d=h3,e=h4,f=h5,g=h6,h=h7,j=0;64>j;++j)s0=rightrotate(a,2)^rightrotate(a,13)^rightrotate(a,22),maj=a&b^a&c^b&c,t2=s0+maj,s1=rightrotate(e,6)^rightrotate(e,11)^rightrotate(e,25),ch=e&f^~e&g,t1=h+s1+ch+K[j]+w[j]&4294967295,h=g,g=f,f=e,e=d+t1,d=c,c=b,b=a,a=t1+t2;h0+=a,h1+=b,h2+=c,h3+=d,h4+=e,h5+=f,h6+=g,h7+=h}var hex=toHexString(h0)+toHexString(h1)+toHexString(h2)+toHexString(h3)+toHexString(h4)+toHexString(h5)+toHexString(h6);return is256&&(hex+=toHexString(h7)),hex},rightrotate=function(x,c){return x>>>c|x<<32-c},toHexString=function(num){for(var hex="",i=0;4>i;i++){var offset=3-i<<3;hex+=HEX_CHARS[num>>offset+4&15]+HEX_CHARS[num>>offset&15]}return hex},hasUTF8=function(message){for(var i=message.length;i--;)if(message.charCodeAt(i)>255)return!0;return!1},ASCIItoBlocks=function(message){var i,length=message.length,chunkCount=(length+8>>6)+1,blockCount=chunkCount<<4,blocks=[];for(i=0;blockCount>i;++i)blocks[i]=0;for(i=0;length>i;++i)blocks[i>>2]|=message.charCodeAt(i)<<(3-i%4<<3);return blocks[i>>2]|=128<<(3-i%4<<3),blocks[blockCount-1]=length<<3,blocks},UTF8toBlocks=function(message){for(var uri=encodeURIComponent(message),blocks=[],i=0,bytes=0,length=uri.length;length>i;++i){var c=uri.charCodeAt(i);37==c?blocks[bytes>>2]|=(HEX_TABLE[uri.charAt(++i)]<<4|HEX_TABLE[uri.charAt(++i)])<<(3-bytes%4<<3):blocks[bytes>>2]|=c<<(3-bytes%4<<3),++bytes}var chunkCount=(bytes+8>>6)+1,blockCount=chunkCount<<4,index=bytes>>2;blocks[index]|=128<<(3-bytes%4<<3);for(var i=index+1;blockCount>i;++i)blocks[i]=0;return blocks[blockCount-1]=bytes<<3,blocks};window.sha256=sha256,window.sha224=sha224}(this),define("sha256",function(){}),define("assets/datamodelviewer/utils/dmv-crypto-util",["sha256"],function(){function _sha256(s){if(void 0===s)throw new Error("String is undefined.");if(0===s.length)throw new Error("String is empty.");var hashed=sha256(s);return hashed}var exports={sha256:_sha256};return exports}),define("client.views/global-selections/directives/scroll/scroll",["qvangular","text!./scroll.ng.html","core.utils/class","objects.models/listbox","core.models/app","objects.utils/data-properties/listobject-util","core.utils/resize","core.utils/deferred","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/simple-list-data-api","jquery","util","objects.utils/shapes/rect","assets/datamodelviewer/utils/dmv-crypto-util","client.views/selection-toolbar/selection-toolbar-service","general.scroll/scroll-area"],function(qvangular,template,Class,Listbox,App,listObjectUtil,Resize,Deferred,ScrollApi,ScrollDOMApi,SimpleListDataApi,$,util,Rect,cryptoUtil){"use strict";function reSizeArray(theArray,length){for(;theArray.length>length;)theArray.pop()}var GsSimpleListDataApi=SimpleListDataApi.extend({init:function(){this.resetColumnIndex(),this._super.apply(this,arguments)},resetColumnIndex:function(){this.columnIndex=0},setList:function(list){this.list=list,this.scrollApi.setTotalRows(this.list.length),this.setItems(this.columnIndex,this.scrollApi.settings.blockSize),this.scrollApi.updateLoadingButtons()},onInitialNativeScroll:function(){return Deferred.resolve()},onGotoNextBlock:function(){var promise=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return promise},onGotoPreviousBlock:function(){var promise=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return promise}}),HorizontalScrollDOMApi=ScrollDOMApi.extend({resetNativeScroll:function(){this.$scrollArea.scrollLeft(0)},alignToFirstRow:function(){var $alignToColumn=this.getFirstRow(),columnId=$alignToColumn.children(".qv-object-wrapper").attr("id"),loadButtonWidthOffset=260;return function(){var scrollLeft,$newColumn=$(this.$scrollArea.find("#"+columnId));$newColumn.length>0&&(scrollLeft=$newColumn.offset().left-loadButtonWidthOffset,this.$scrollArea.scrollLeft(scrollLeft))}.bind(this)},alignToLastRow:function(){var $alignToColumn=this.getLastRow(),columnId=$alignToColumn.children(".qv-object-wrapper").attr("id"),loadButtonWidthOffset=250;return function(){var scrollLeft,$newColumn=$(this.$scrollArea.find("#"+columnId));$newColumn.length>0&&(this.$scrollArea.scrollLeft(0),scrollLeft=$newColumn.parent().position().left-this.getScrollAreaBoundingBox().width+$newColumn[0].getBoundingClientRect().width+loadButtonWidthOffset,this.$scrollArea.scrollLeft(scrollLeft))}.bind(this)},getBoundingBox:function(){var bbox=this._super.apply(this,arguments);return new Rect(bbox.top,bbox.left,bbox.height,bbox.width)}}),Controller=Class.extend({size:{width:0,height:0},itemSize:0,itemSpacing:0,$element:void 0,init:function($scope,$timeout,selectionToolbarService){this.$scope=$scope,this.$timeout=$timeout,this.selectionToolbarService=selectionToolbarService,this.$scope.items=[]},initialize:function($element,size,options){this.setSize(size),this.setItemSize(options.itemSize),this.setItemSpacing(options.itemSpacing),this.setElement($element.find(".qv-gs-scroll-area")),this.setItems(),this.initialized=!0},updateVisible:function(){var startIndex=this.offsetX-(this.$scope.scrollApi.loadPrevious?1:0),visibleCount=this.visibleItemsCount;this.$scope.items.forEach(function(item,index){var visible=index>=startIndex&&startIndex+visibleCount>index;!item.visible&&visible&&(item.options={isPopOver:!1}),visible&&!item.model&&this.getModel(item).then(function(item,model){item.model=model}.bind(null,item)),item.visible=visible},this)},getModel:function(item){var model,initProps=this.getInitProps(item.title);return item.qField?model=Listbox.createTransientField(App.current,item.qField,initProps):item.qId&&(model=Listbox.createTransientDimension(App.current,item.qId,initProps)),model},onScroll:function(){this.qvGlobalSelectionsCtrl.setIgnoreUpdates(!1),this.selectionToolbarService.confirm(),this.updateHighlights(),this.$timeout.cancel(this.scrollTimeout),this.scrollTimeout=this.$timeout(function(){this.updateVisible(),this.updateHighlights()}.bind(this),100)},onResize:function(size){this.setSize(size),this.updateVisible()},updateHighlights:function(){this.$scope.items.forEach(function(item){item.options.highlightQuery=this.$scope.filter},this)},setItems:function(){var i,item,prototype,$scope=this.$scope,itemCount=this.totalItemsCount;for($scope.items.length!==itemCount&&reSizeArray($scope.items,itemCount),i=0;itemCount>i;i++)item=$scope.items[i]||{},prototype=$scope.scrollApi.items[i],prototype.enableBadge&&(item.enableBadge=prototype.enableBadge),item.model||(item.options={isPopOver:!1}),prototype.qField?(delete item.qId,item.model&&item.qField===prototype.qField||(item.visible&&($scope.items[i]=util.extend(!0,{},item),item=$scope.items[i],delete item.$$hashKey,delete item.options.search),item.title=prototype.title,item.qField=prototype.qField,item.id=cryptoUtil.sha256(item.qField),delete item.model)):prototype.qId&&(delete item.qField,item.model&&item.qId===prototype.qId||(item.visible&&($scope.items[i]=util.extend(!0,{},item),item=$scope.items[i],delete item.$$hashKey,delete item.options.search),item.title=prototype.title,item.qId=prototype.qId,item.id=cryptoUtil.sha256(item.qId),delete item.model)),$scope.items[i]||($scope.items[i]=item);this.updateVisible()},getInitProps:function(title){var initProps={title:title,qListObjectDef:{qDef:{}}};return listObjectUtil.autoSortDimension(initProps.qListObjectDef),initProps},getWidthOf:function(count){return this.totalItemSize*count-this.itemSpacing},setItemSize:function(itemSize){this.itemSize=itemSize||220},setItemSpacing:function(itemSpacing){this.itemSpacing=itemSpacing||20},setSize:function(size){this.size=size},setElement:function($element){this.$element=$element,this.$element.on("scroll",this.onScroll.bind(this))}});Object.defineProperties(Controller.prototype,{vPosX:{get:function(){return this.$element.scrollLeft()}},totalItemSize:{get:function(){return this.itemSize+this.itemSpacing}},visibleItemsCount:{get:function(){var maxVisible=Math.ceil(((this.vPosX+(this.previousBtnVisible?240:0))%this.totalItemSize+this.size.width)/this.totalItemSize);return Math.min(maxVisible,this.totalItemsCount+(this.previousBtnVisible?1:0))}},totalItemsCount:{get:function(){return(this.$scope.scrollApi.items||[]).length}},offsetX:{get:function(){return Math.floor(this.vPosX/this.totalItemSize)}},previousBtnVisible:{get:function(){return!!this.$scope.scrollApi.loadPrevious}}}),Controller.$inject=["$scope","$timeout","qvSelectionToolbarService"],qvangular.directive("qvGlobalSelectSection",["$parse","$timeout",function($parse,$timeout){return{controller:Controller,require:["qvGlobalSelectSection","^qvGlobalSelections"],template:template,replace:!0,scope:{allItems:"=",filter:"="},link:function($scope,$element,$attrs,ctrls){var ctrl=ctrls[0],qvGlobalSelectionsCtrl=ctrls[1],options=$parse($attrs.qvGlobalSelectSection)(),size={},$scrollArea=$element.find(".qv-gs-scroll-area"),virtualScrollCtrl=$scrollArea.controller("qvScrollArea"),loaderCtrl=$element.find(".qv-scroll-loader").controller("qvScrollLoader"),settings={blockSize:24,minRowHeight:240,maxRowHeight:240,keepItemsCount:4,virtualScrollEnabled:!1},scrollApi=$scope.scrollApi=new ScrollApi($timeout,settings),scrollDataApi=new GsSimpleListDataApi(scrollApi),scrollDOMApi=new HorizontalScrollDOMApi($element,$scrollArea,".qv-gs-listbox",".qv-gs-listbox:first",".qv-gs-listbox:last"),watcher=null,resize=function(){size.width=$element.innerWidth(),size.height=$element.innerHeight(),ctrl.onResize(size)};ctrl.qvGlobalSelectionsCtrl=qvGlobalSelectionsCtrl,scrollApi.initialize(scrollDOMApi,scrollDataApi,virtualScrollCtrl,loaderCtrl).then(function(){scrollApi.activate(),scrollApi.updateViewport(),$scope.$watch("filter",function(){scrollDataApi.resetColumnIndex(),scrollApi.resetNativeScroll()}),$scope.$watch("allItems",function(items){items&&(scrollDataApi.setList(items),watcher&&watcher(),watcher=$scope.$watch("scrollApi.items",function(){qvGlobalSelectionsCtrl.ignoreUpdates||(0===scrollApi.items.length&&$scope.allItems.length>0&&(scrollApi.resetNativeScroll(),scrollDataApi.resetColumnIndex(),scrollDataApi.setList(items)),ctrl.initialized&&ctrl.setItems())}))})}),$timeout(function(){size.width=$element.innerWidth(),size.height=$element.innerHeight(),ctrl.initialize($element,size,options)}),Resize.on("end",resize),$scope.$on("$destroy",function(){Resize.off("end",resize),scrollApi.destroy()}),qvGlobalSelectionsCtrl.addCallback(options.type,function(){ctrl.$timeout(function(){ctrl.setItems(),ctrl.$timeout(function(){ctrl.updateHighlights()})})})}}}])}),define("text!client.views/global-selections/directives/badge/badge.ng.html",[],function(){return'<div class="qv-gs-badge" ng-if="item.showBadge" q-title-translation="Tooltip.clearSelection" tid="globalSelections.badge">\r\n	<q qva-activate="badgeClick(item)"></q>\r\n</div>\r\n'}),define("objects.backend-api/listbox-api",["./backend-api"],function(BackendApi){"use strict";var ListboxApi;return ListboxApi=BackendApi.extend("Listbox",{init:function(model){this._super(model,"/qListObjectDef"),this.cacheCube.setMethodName("GetListObjectData")},select:function(dimNo,values,toggleMode){return this.model.rpc("SelectListObjectValues",null,[this.path,values,toggleMode])},selectAll:function(){return this.model.rpc("SelectListObjectAll",null,[this.path])},selectPossible:function(){return this.model.rpc("SelectListObjectPossible",null,[this.path])},selectAlternative:function(){return this.model.rpc("SelectListObjectAlternative",null,[this.path])},selectExcluded:function(){return this.model.rpc("SelectListObjectExcluded",null,[this.path])},search:function(term){return this.model.rpc("SearchListObjectFor","qSuccess",[this.path,term])},abortSearch:function(){return this.model.rpc("AbortListObjectSearch",null,[this.path])},confirmSearch:function(toggleMode){return this.model.rpc("AcceptListObjectSearch",null,[this.path,toggleMode])},updateCache:function(layout){this.cacheCube.set(layout.qListObject.qDataPages),this.cacheCube.setCubeSize(layout.qListObject.qSize)},setInitialData:function(layout){this.cacheCube.set(layout.qListObject.qDataPages)},getData:function(pages){return this.cacheCube.getData(pages)},getDataPage:function(page){return this.getData([page]).then(function(dataPages){return dataPages[0]})},getSize:function(){return this.model.layout.qListObject.qSize},lock:function(){return this.model.rpc("Lock",null,[this.path])},unlock:function(){return this.model.rpc("Unlock",null,[this.path])},isLocked:function(){return this.model.layout&&this.model.layout.qListObject&&this.model.layout.qListObject.qDimensionInfo.qLocked?!0:!1},getDimensionInfos:function(){return this.model.layout&&this.model.layout.qListObject?[this.model.layout.qListObject.qDimensionInfo]:[]}})}),define("client.views/global-selections/directives/badge/badge",["qvangular","text!./badge.ng.html","objects.backend-api/listbox-api"],function(qvangular,template,ListboxApi){qvangular.directive("qvGsBadge",function(){return{restrict:"E",template:template,replace:!0,link:function($scope){$scope.item.enableBadge&&($scope.item.object||($scope.item.object={}),$scope.$watchCollection("[item.model.layout.qListObject.qDimensionInfo.qLocked, item.object.selectionsApi.active]",function(newVal){qvangular.$apply(function(){$scope.item.showBadge=(void 0===newVal[0]||newVal[0]===!1)&&newVal[1]===!1})}),$scope.badgeClick=function(item){var backendApi=new ListboxApi(item.model);backendApi.beginSelections(),backendApi.clearSelections(),backendApi.endSelections(!0)})}}})}),define("client.views/global-selections/global-selections",["jquery","qvangular","text!./global-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.utils/support","client.assets/assets-utils","core.utils/class","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","core.utils/deferred","core.models/app","core.utils/resize","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.utils/type-loader","client.views/selection-toolbar/selection-toolbar-service","client.views/global-selections/directives/scroll/scroll","client.views/global-selections/directives/badge/badge"],function($,qvangular,template,CurrentSelections,DimensionModel,support,assetUtils,Class,FieldModel,FieldListModel,Deferred,App,resize,DirectDiscoveryService,TypeLoader){var eventNs=".globalSelections",Controller=Class.extend({init:function($scope,$document){var self=this;this.$scope=$scope,this.$document=$document,this.callbacks=[],this.ignoreUpdates=!1,this.hasLoaded=!1,$scope.dimensions=[],$scope.dimensionsFields=[],$scope.selectedFields=[],$scope.fields=[],$scope.dimAvailable=!1,$scope.showFields=!1,$scope.showFieldsCheckbox=!0,$scope.filter="",$scope.autoFocus=support.treatAsDesktop(),$scope.selectionToolbarOpen=!1,Deferred.all({fields:this.getFields(),select:this.bindCurrentSelections(),dim:this.getLibraryDimensions(),reg:this.registerExtensions()}).then(function(){self.hasLoaded=!0,self.setupUi(self),$scope.$watchCollection("[filter, showFields]",function(){self.filterShown(self,self.$scope)}),$(".qv-gs-section .qv-gs-header")[1].style.display="none",$(".qv-gs-section .qv-gs-header")[1].offsetHeight,$(".qv-gs-section .qv-gs-header")[1].style.display="block"})},registerExtensions:function(){var dfd=new Deferred;return TypeLoader.load().then(function(){dfd.resolve()}),dfd.promise},getFields:function(){var $scope=this.$scope,dfd=new Deferred;return FieldModel.getListLayout().then(function(layout){$scope.fields=FieldListModel.expand(layout).map(function(item){return{title:item.qName,qField:item.qName,qTags:item.qTags}}),dfd.resolve()}),dfd.promise},_updateCurrentSelectionFields:function(currentSelectionLayout){var self=this,$scope=this.$scope;$scope.selectedFields=currentSelectionLayout.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}).map(function(sel){return{title:sel.qField,qField:sel.qField,enableBadge:!0}}),self.hasLoaded&&self.filterShown(self,$scope)},handleCurrentSelectionFields:function(){var self=this;this.$scope.currentSelectionsModel.getLayout().then(function(layout){self._updateCurrentSelectionFields(layout)})},bindCurrentSelections:function(){var $scope=this.$scope,self=this;return CurrentSelections.get().then(function(currentSelectionsModel){return $scope.currentSelectionsModel=currentSelectionsModel,CurrentSelections.bindLayout($scope,"currentSelectionsModel",function(layout){App.current.isModal()||self._updateCurrentSelectionFields(layout)})})},getLibraryDimensions:function(){var isCalculatedField=this.isCalculatedField,$scope=this.$scope,dfd=new Deferred;return DimensionModel.getList().then(function(DimensionList){DimensionList.getLayout().then(function(items){$scope.dimensions=items.filter(function(item){return item.qData.info.length>0&&(item.qData.info.some(isCalculatedField)?!1:!0)&&"H"!==item.qData.grouping}).map(function(item){return{title:item.qData.title,fieldName:item.qData.info[0].qName,qId:item.qInfo.qId}}),dfd.resolve()})}),dfd.promise},setupUi:function(self){var $scope=self.$scope;$scope.showFieldsCheckbox=$scope.fields.length>0,$scope.dimAvailable=$scope.dimensions.length>0,!$scope.dimAvailable&&$scope.showFieldsCheckbox&&($scope.showFields=!0)},isCalculatedField:function(fieldInfo){return"="===fieldInfo.qName[0]},filterShown:function(self,$scope){var filterLowerCase="",temp=[];$scope.dimensionsFields=$scope.dimensions.filter(function(dimension){return!$scope.selectedFields.some(function(field){return dimension.fieldName===field.qField})}),$scope.showFields&&(temp=$scope.fields.filter(function(field){return!$scope.selectedFields.some(function(selectedField){return selectedField.qField===field.qField})}),temp=DirectDiscoveryService.removeMeasureAndDetailsFields(temp),$scope.dimensionsFields=$scope.dimensionsFields.concat(temp.filter(function(field){return!$scope.dimensions.some(function(dimension){return field.qField===dimension.fieldName})}))),$scope.filter.length>0&&(filterLowerCase=$scope.filter.toLowerCase(),temp=$scope.dimensionsFields.filter(function(item){return-1!==item.title.toLowerCase().indexOf(filterLowerCase)}),$scope.dimensionsFields=temp),assetUtils.localeOrderBy($scope.dimensionsFields,function(d){return d.title}),qvangular.$apply($scope,function(){self.notifyCallbacks(self)})},addCallback:function(type,callback){this.callbacks.push({type:type,fn:callback})},notifyCallbacks:function(self){self.hasLoaded&&(self.ignoreUpdates||self.callbacks.forEach(function(callback){("fields"===callback.type||"dimensions"===callback.type)&&callback.fn()}))},setIgnoreUpdates:function(ignoreUpdates){this.ignoreUpdates=ignoreUpdates}});return Controller.$inject=["$scope","$document"],qvangular.directive("qvGlobalSelections",["$document","qvSelectionToolbarService","$timeout",function($document,selectionToolbarService,$timeout){return{restrict:"E",template:template,controller:Controller,require:["qvGlobalSelections"],scope:{},replace:!0,link:function($scope,$element,$attrs,ctrls){$scope.toolbar=$document.find(".qui-toolbar")[0]?!0:!1;var ctrl=ctrls[0],onResize=function(){ctrl.ignoreUpdates=!1},selectionToolbarClosedCallback=function(){$scope.selectionToolbarOpen=!1,$timeout(function(){ctrl.handleCurrentSelectionFields()})},selectionToolbarOpenedCallback=function(){$scope.selectionToolbarOpen=!0};selectionToolbarService.Closed.bind(selectionToolbarClosedCallback),selectionToolbarService.Opened.bind(selectionToolbarOpenedCallback),$document.on("keyup"+eventNs,function(event){27===event.which?ctrl.ignoreUpdates=!1:13===event.which&&(ctrl.ignoreUpdates=!1)}),Touche($document[0].body).tap({id:eventNs,options:{preventDefault:!1},start:function(event){var badgeClicked=$(event.target).closest(".qv-gs-badge").length>0,listboxClicked=$(event.target).closest(".qv-gs-listbox").length>0,selectionToolbarClicked=$(event.target).closest(".qv-selection-toolbar").length>0;
ctrl.ignoreUpdates=listboxClicked&&!badgeClicked&&!selectionToolbarClicked}}),resize.on("start",onResize),$scope.$on("$destroy",function(){ctrl.callbacks=[],selectionToolbarService.Closed.unbind(selectionToolbarClosedCallback),selectionToolbarService.Opened.unbind(selectionToolbarOpenedCallback),Touche($document[0].body).off("*",eventNs),$document.off(eventNs),resize.off("start",onResize)}),$scope.onEnter=function($event){$event.stopPropagation(),$event.target.blur()}}}}]),"<qv-global-selections></qv-global-selections>"}),define("text!client.views/mobile-selections/mobile-selections.ng.html",[],function(){return'<div class="qv-mobile-selections" tid="{{\'mobileSelections.showFields.\' + filter.showFields}}">\r\n		<div class="qv-ms-toolbar">\r\n		<p qva-activate="selectionsBack()" ng-class="{\'qv-ms-button-disabled\' : disable.back, \'qv-ms-button-enabled\': !disable.back}" class="qv-ms-toolbar-buttons" tid="mobileSelections.back" q-title-translation="Tooltip.NavigateBack"><</p>\r\n		<p qva-activate="selectionsForward()" ng-class="{\'qv-ms-button-disabled\' : disable.forward, \'qv-ms-button-enabled\': !disable.forward}" class="qv-ms-toolbar-buttons" tid="mobileSelections.forward" q-title-translation="Tooltip.NavigateForward">=</p>\r\n		<p qva-activate="selectionsClear()" ng-class="{\'qv-ms-button-disabled\' : disable.clear, \'qv-ms-button-enabled\': !disable.clear}" class="qv-ms-toolbar-buttons" tid="mobileSelections.clear" q-title-translation="Tooltip.ClearSelections">:</p>\r\n		<p qva-activate="toggleMenu()" ng-class="{\'qv-ms-button-disabled\' : !enableMenu, \'qv-ms-button-enabled\': enableMenu, \'qv-ms-button-menu-active\': menuActive }" class="qv-ms-toolbar-buttons" id="mobileSelectionsMenu" tid="mobileSelections.showMenu" qva-outside-ignore-for="allOutside" q-title-translation="Toolbar.Menu"></p>\r\n\r\n		<qui-toolbarbutton qva-activate="close($event)" name="close" class="qv-ms-toolbar-close" tid="mobileSelections.close">\r\n			<span q-translation="Common.Close" class="qv-ms-toolbar-close-text"></span>\r\n		</qui-toolbarbutton>\r\n		</div>\r\n		<header class="qv-ms-header">\r\n				<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n	<qui-search-field placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter.filter" maxlength="255"\r\n		on-enter="filter.onEnter($event)" class="qv-ms-searchbox" tid="mobileSelections.searchfield">\r\n		</qui-search-field>\r\n		<div class="qv-ms-scroll-area">\r\n			<qv-ms-selected ng-repeat="item in selectedFields"></qv-ms-selected>\r\n			<qv-ms-selectable ng-repeat="item in selectables"></qv-ms-selectable>\r\n		</div>\r\n</div>\r\n'}),define("text!client.views/mobile-selections/menu/mobile-selections-menu.ng.html",[],function(){return'<immidiate-contextual align-to=" \'#mobileSelectionsMenu\' " position="\'bottom\'" on-close-view="closeView()" qva-outside-ignore-for="mobileSelectionsMenu" smallview="true">\r\n	<ul class="qui-icontextlist toolbar-menu">\r\n		<li qva-activate="toggleFields($event)" data-icon="{{fieldsIcon}}">\r\n			<span class="qui-textlist-text" q-translation="{{fieldsLabel}}"></span>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>\r\n'}),define("client.views/mobile-selections/menu/mobile-selections-menu",["text!./mobile-selections-menu.ng.html"],function(template){"use strict";var contextMenu={scope:{menuItem:"=",closeMenu:"="},template:template,controller:["$scope",function($scope){$scope.fieldsLabel=$scope.menuItem.model.showFields?"GlobalSelections.HideFields":"GlobalSelections.ShowFields",$scope.fieldsIcon=$scope.menuItem.model.showFields?"remove":"add",$scope.toggleFields=function($event){$event.preventDefault(),$scope.menuItem.model.showFields=!$scope.menuItem.model.showFields,$scope.closeMenu()},$scope.closeView=function(){$scope.closeMenu()}}]};return contextMenu}),define("general.utils/qv-keyboard-shortcuts",["jquery","general.utils/dom-util"],function($,DOMUtil){"use strict";function qvKeyboardShortcuts(){this.groups=[],this.shortcuts=[],this.timer={id:null},this.isReleased=!0,this.currentEvent=void 0}var qvKeyShortcuts,keyCodes={a:65,alt:18,b:66,backspace:8,c:67,ctrl:17,d:68,del:46,down:40,e:69,f:70,enter:13,esc:27,g:71,h:72,home:36,i:73,j:74,k:75,l:76,left:37,m:77,n:78,o:79,p:80,q:81,r:82,right:39,s:83,shift:16,space:32,t:84,tab:9,u:85,up:38,v:86,w:87,win:224,x:88,y:89,z:90,cmd:91},eventNamespace="qvKeyboardShortcuts",listening=!1;return qvKeyboardShortcuts.prototype.createGroup=function(name,priority){var group,i,that=this;for(i=0;i<this.groups.length;i++)if(this.groups[i].name===name){group=this.groups[i];break}if(group)throw"Keyboard shortcut group already exist: "+name;return group={name:name,priority:priority,active:!1,shortcuts:[]},this.groups.push(group),this.groups.sort(function(a,b){return a.priority-b.priority}),{registerKeys:function(keyCombo,callback,options){that.registerKeys(group,keyCombo,callback,options)},on:function(){that.activateGroup(group)},off:function(){that.deactivateGroup(group)},"delete":function(){that.deactivateGroup(group),that.deleteGroup(group)}}},qvKeyboardShortcuts.prototype.activateGroup=function(group){var that=this;group.active=!0,listening||(listening=!0,$(document).on("keydown."+eventNamespace,function(e){that.handleEvent(e)}))},qvKeyboardShortcuts.prototype.deactivateGroup=function(group){var activeCount;group.active=!1,activeCount=this.groups.reduce(function(count,group){return group.active&&count++,count},0),0===activeCount&&listening&&(listening=!1,$(document).off("keydown."+eventNamespace))},qvKeyboardShortcuts.prototype.deleteGroup=function(groupToDelete){this.groups=this.groups.filter(function(group){return group!==groupToDelete})},qvKeyboardShortcuts.prototype.registerKeys=function(group,keyCombo,callback,options){var keys=keyCombo.toLowerCase().split("+"),obj={ctrlKey:!1,shiftKey:!1,keyCode:null,name:"",callback:null,allowInAllContexts:options&&"allowInInput"in options?options.allowInInput:!1,preventDefault:options&&"preventDefault"in options?options.preventDefault:!0,delay:options&&"delay"in options?options.delay:250};for(var code in keyCodes)for(var i=0;i<keys.length;i++)obj.name=keyCombo.toLowerCase(),obj.callback=callback,("ctrl"===keys[i]||"cmd"===keys[i])&&(obj.ctrlKey=!0),"shift"===keys[i]&&(obj.shiftKey=!0),keys[i]===code&&17!==keyCodes[code]&&16!==keyCodes[code]&&91!==keyCodes[code]&&(obj.keyCode=keyCodes[code]);group.shortcuts.push(obj)},qvKeyboardShortcuts.prototype.preventDefault=function(){this.currentEvent&&this.currentEvent.preventDefault()},qvKeyboardShortcuts.prototype.handleEvent=function(e){function findKeyEvent(ctrlValue,shiftValue,currentKeypress){for(var group,keySet,i=0;i<that.groups.length;i++)if(group=that.groups[i],group.active)for(var j=0;j<group.shortcuts.length;j++)if(keySet=group.shortcuts[j],keySet.ctrlKey===ctrlValue&&keySet.shiftKey===shiftValue&&keySet.keyCode===currentKeypress)return keySet}function prepareToPerformAction(e,keySet){var isInput=DOMUtil.isInput(document.activeElement);(!isInput||keySet.allowInAllContexts)&&performAction(e,keySet)}function performAction(e,keySet){keySet.preventDefault&&e.preventDefault(),"number"!=typeof that.timer.id&&(keySet.callback(keySet),keySet.delay>0?that.timer.id=setTimeout(function(){clearDelay()},keySet.delay):clearDelay())}function clearDelay(){clearTimeout(that.timer.id),delete that.timer.id}var keySet,that=this;this.currentEvent=e,e.shiftKey?e.shiftKey&&(!e.ctrlKey&&!e.metaKey||e.altKey||(keySet=findKeyEvent(!0,!0,e.which),keySet&&prepareToPerformAction(e,keySet))):!e.ctrlKey&&!e.metaKey||e.altKey?(keySet=findKeyEvent(!1,!1,e.which),keySet&&prepareToPerformAction(e,keySet)):(keySet=findKeyEvent(!0,!1,e.which),keySet&&prepareToPerformAction(e,keySet))},qvKeyShortcuts=new qvKeyboardShortcuts}),define("text!client.views/mobile-selections/directives/selectable/selectable.ng.html",[],function(){return'<div qva-activate="showSelectable()" ng-class="{\'qv-ms-touch-flash\' : item.flash}" class="qv-ms-selectable" tid="mobileSelections.selectable">\r\n	<p ng-if="item.qField" class="qv-ms-is-field"></p>\r\n	<div class="qv-ms-highlight">\r\n		<span qve-highlight text="{{item.title}}" query="filter.filter"></span>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selectable/selectable",["qvangular","text!./selectable.ng.html","core.utils/class"],function(qvangular,template,Class){var Controller=Class.extend({init:function($scope){this.$scope=$scope}});Controller.$inject=["$scope"],qvangular.directive("qvMsSelectable",["$timeout",function($timeout){return{controller:Controller,restrict:"E",replace:!0,template:template,link:function($scope){$scope.showSelectable=function(){$scope.item.flash=!0,$timeout(function(){$scope.$emit("showListbox",$scope.item),$scope.item.flash=!1},20)}}}}])}),define("text!client.views/mobile-selections/directives/selected/selected.ng.html",[],function(){return'<div class="qv-ms-selected" tid="mobileSelections.selected">\r\n	<div class="qv-ms-selected-icon">\r\n		<a ng-show="!item.qLocked" qva-activate="clear(item.qField)">\r\n			<i class="icon-cancel"></i>\r\n		</a>\r\n		<a ng-show="item.qLocked" qva-activate="showSelected(item.qField)">\r\n			<i class="icon-toolbar-locked"></i>\r\n		</a>\r\n	</div>\r\n	<div qva-activate="showSelected(item.qField)" class="qv-ms-selected-info">\r\n		<h1 class="qv-object-title">{{item.qField}}</h1>\r\n		<span>{{item.translation}}</span>\r\n		<qv-state-count-bar cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selected/selected",["qvangular","text!./selected.ng.html","core.utils/class"],function(qvangular,template,Class){var Controller=Class.extend({init:function($scope){this.$scope=$scope}});Controller.$inject=["$scope"],qvangular.directive("qvMsSelected",function(){return{controller:Controller,restrict:"E",replace:!0,template:template,link:function($scope){$scope.showSelected=function(){$scope.$emit("showListbox",$scope.item)},$scope.clear=function(fieldName){$scope.currentSelectionsModel.clearField(fieldName)}}}})}),define("client.views/current-selections/current-selections-service",["qvangular","translator"],function(qvangular,translator){qvangular.service("qvCurrentSelectionsService",[function(){return{translate:function(item){var translation,selectedCount=item.qStateCounts.qSelected+item.qStateCounts.qSelectedExcluded+item.qStateCounts.qLocked+item.qStateCounts.qLockedExcluded,totalCount=item.qTotal;return translation=totalCount===selectedCount&&totalCount>1?translator.get("CurrentSelections.All"):selectedCount>1&&totalCount>1?translator.get("CurrentSelections.Of",[selectedCount,totalCount]):item.qSelectedFieldSelectionInfo.map(function(i){return i.qName}).join(", ").toString()}}}])}),define("client.views/mobile-selections/mobile-selections",["qvangular","text!./mobile-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.models/field","client.assets/assets-utils","core.utils/class","core.utils/deferred","core.models/app","objects.models/listbox","general.services/show-service/show-service","client.views/mobile-selections/menu/mobile-selections-menu","client.assets/tab-contents/fields/assets-directdiscovery-service","general.utils/qv-keyboard-shortcuts","client.views/global-selections/global-selections-service","client.views/mobile-selections/directives/selectable/selectable","client.views/mobile-selections/directives/selected/selected","objects/listbox-popover/listbox-popover-service","client.views/current-selections/current-selections-service"],function(qvangular,template,CurrentSelections,DimensionModel,FieldModel,assetUtils,Class,Deferred,App,Listbox,showService,menu,DirectDiscoveryService,qvKeyboardShortcuts){var Controller=Class.extend({init:function($scope,$document){var self=this;self.$scope=$scope,self.$document=$document,self.hasLoaded=!1,$scope.dimensions=[],$scope.fields=[],$scope.selectedFields=[],$scope.filter={filter:"",showFields:!1,onEnter:function($event){$event.stopPropagation(),$event.target.blur()}},$scope.selectables=[],$scope.dimAvailable=!1,$scope.enableMenu=!0,$scope.disable={clear:!1,back:!1,forward:!1},Deferred.all({selections:this.bindCurrentSelections(self),dimensions:this.getLibraryDimensions(),fields:this.getFields()}).then(function(){self.hasLoaded=!0,$scope.enableMenu=$scope.fields.length>0,$scope.dimAvailable=$scope.dimensions.length>0,!$scope.dimAvailable&&$scope.enableMenu&&($scope.filter.showFields=!0),$scope.$watch("filter",function(){self.filterSelectables(self)},!0)})},filterSelectables:function(self){var $scope=self.$scope,filterLowerCase="",temp=[];$scope.selectables=$scope.dimensions.filter(function(dimension){return!$scope.selectedFields.some(function(field){return dimension.fieldName===field.qField})}),$scope.filter.showFields===!0&&(temp=$scope.fields.filter(function(field){return!$scope.selectedFields.some(function(selectedField){return selectedField.qField===field.qField})}),temp=DirectDiscoveryService.removeMeasureAndDetailsFields(temp),$scope.selectables=$scope.selectables.concat(temp.filter(function(field){return!$scope.dimensions.some(function(dimension){return field.qField===dimension.fieldName})}))),$scope.filter.filter.length>0&&(filterLowerCase=$scope.filter.filter.toLowerCase(),temp=$scope.selectables.filter(function(item){return-1!==item.title.toLowerCase().indexOf(filterLowerCase)}),$scope.selectables=temp),assetUtils.localeOrderBy($scope.selectables,function(d){return d.title}),qvangular.$apply($scope)},bindCurrentSelections:function(self){var $scope=self.$scope,dfd=new Deferred,currentSelectionsService=qvangular.getService("qvCurrentSelectionsService");return CurrentSelections.get().then(function(currentSelectionsModel){$scope.currentSelectionsModel=currentSelectionsModel,CurrentSelections.bindLayout($scope,"currentSelectionsModel",function(layout){$scope.disable={clear:0===layout.qSelectionObject.qSelections.length||layout.qSelectionObject.qSelections.every(function(selection){return selection.qLocked}),back:0===layout.qSelectionObject.qBackCount,forward:0===layout.qSelectionObject.qForwardCount},$scope.selectedFields=layout.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}),$scope.selectedFields.forEach(function(field){field.translation=currentSelectionsService.translate(field)}),self.hasLoaded&&self.filterSelectables(self)}),dfd.resolve()}),dfd.promise},getLibraryDimensions:function(){var isCalculatedField=this.isCalculatedField,$scope=this.$scope,dfd=new Deferred;return DimensionModel.getList().then(function(DimensionList){DimensionList.getLayout().then(function(items){$scope.dimensions=items.filter(function(item){return item.qData.info.length>0&&(item.qData.info.some(isCalculatedField)?!1:!0)&&"H"!==item.qData.grouping}).map(function(item){return{title:item.qData.title,fieldName:item.qData.info[0].qName,qId:item.qInfo.qId}}),dfd.resolve()})}),dfd.promise},getFields:function(){var $scope=this.$scope,dfd=new Deferred;return FieldModel.getListLayout().then(function(layout){$scope.fields=layout.map(function(item){return{title:item.qName,qField:item.qName,qTags:item.qTags}}),dfd.resolve()}),dfd.promise},isCalculatedField:function(fieldInfo){return"="===fieldInfo.qName[0]}});return Controller.$inject=["$scope","$document"],qvangular.directive("qvMobileSelections",["$document","qvGlobalSelectionsService","qvListboxPopoverService",function($document,globalSelectionService,qvListboxPopoverService){return{restrict:"E",template:template,controller:Controller,replace:!0,require:["qvMobileSelections"],scope:{},link:function($scope,$element){var popover=null,closeMenu=function(){popover.destroy(),popover=null,$scope.menuActive=!1},keyboardShortcutsGroup=qvKeyboardShortcuts.createGroup("mobile-selections",0);keyboardShortcutsGroup.registerKeys("enter",function(){}),keyboardShortcutsGroup.on(),document.activeElement&&document.activeElement.blur(),$scope.close=function(e){e.preventDefault(),globalSelectionService.off("select")},$scope.selectionsBack=function(){$scope.currentSelectionsModel.back()},$scope.selectionsForward=function(){$scope.currentSelectionsModel.forward()},$scope.selectionsClear=function(){$scope.currentSelectionsModel.clearAll()},$scope.toggleMenu=function(){popover?closeMenu():$scope.enableMenu&&($scope.menuActive=!0,popover=showService.show(menu,{menuItem:{model:$scope.filter},closeMenu:closeMenu}))},$scope.$on("showListbox",function(childScope,item){var initProps={title:item.title,qListObjectDef:{qDef:{}}},showListbox=function(model){$element.children(".qv-ms-searchbox").find("input").blur(),qvListboxPopoverService.show(model,{})};item.qField?Listbox.createTransientField(App.current,item.qField,initProps).then(showListbox):Listbox.createTransientDimension(App.current,item.qId,initProps).then(showListbox)}),$scope.$on("$destroy",function(){popover&&(popover.destroy(),popover=null),keyboardShortcutsGroup["delete"]()})}}}]),"<qv-mobile-selections></qv-mobile-selections>"}),define("text!client.views/global-selections-deactivate/global-selections-deactivate.ng.html",[],function(){return'<div class="qv-global-selections-deactivate" qva-activate="deactivateGlobalSelection()" ng-style="{height: height}">\r\n	\r\n</div>'}),define("client.views/global-selections-deactivate/global-selections-deactivate",["text!./global-selections-deactivate.ng.html","qvangular","client.views/global-selections/global-selections-service"],function(template,qvangular){return{template:template,controller:["$scope","$document","qvGlobalSelectionsService",function($scope,$document,globalSelectionsService){qvangular.getService("$timeout")(function(){$scope.height=$document.find(".qui-toolbar").outerHeight(),$scope.height||($scope.height=$document.find(".qv-panel-current-selections").outerHeight())}),$scope.deactivateGlobalSelection=function(){globalSelectionsService.offAll()}}]}}),define("text!client.views/global-search/global-search.ng.html",[],function(){return'<div>\r\n    <div class="qv-global-search" ng-class="{ overlay:displaySuggestions || displayResult }" ng-style="{paddingTop: toolbarHeight}" tid="globalSearch">\r\n        <qv-global-search-input class="qv-global-search-input"></qv-global-search-input>\r\n    	<div class="qv-global-search-dimmer" ng-if="query.length > 0" ng-style="{\'max-height\': dimMaxHeight}">     \r\n    		<qv-global-search-result class="qv-global-search-result" tid="globalSearch.ResultList" ng-class="{ \'qv-global-search-result-loader-open\': resultLoaderOpen, \'noresults\' : showNoResultsMessage() }" ></qv-global-search-result>	\r\n    	</div> \r\n    </div>\r\n    <div class="qv-global-search-glass" ng-if="query.length > 0" qva-activate="close();"></div>\r\n</div>\r\n'}),define("client.views/global-search/global-search-keyboard-shortcuts",["qvangular","general.utils/qv-keyboard-shortcuts"],function(qvangular,qvKeyboardShortcuts){function GlobalSearchKeyboardShortcuts($element,$scope,searchCtrl){function updateStateIfKeyDown(){var stateFocus=$scope.stateFocus;"input"===stateFocus?stateFocus=$scope.displaySuggestions?"suggestions":$scope.isPartials()?"partials":$scope.displayResult?"results":"start-new-search":"suggestions"===stateFocus?stateFocus=$scope.isPartials()?"partials":$scope.displayResult?"results":"start-new-search":"partials"===stateFocus&&$scope.forcePartials&&(stateFocus="results"),$scope.stateFocus=stateFocus}function updateStateIfKeyUp(){var stateFocus=$scope.stateFocus;"results"===stateFocus&&0===$scope.activeSelectIx?stateFocus=$scope.isPartials()?"partials":$scope.displaySuggestions?"suggestions":"input":"partials"===stateFocus||"start-new-search"===stateFocus?stateFocus=$scope.displaySuggestions?"suggestions":"input":"suggestions"===stateFocus&&(stateFocus="input"),$scope.stateFocus=stateFocus}function isTargetInput(){return"INPUT"===$document[0].activeElement.tagName}function preventAndApply(){qvKeyboardShortcuts.preventDefault(),qvangular.$rootScope.$apply()}function isCaretAtEnd(input){var range,bookmark,caretPos;return document.selection&&document.selection.createRange?(range=document.selection.createRange(),bookmark=range.getBookmark(),caretPos=bookmark.charCodeAt(2)-2):input.setSelectionRange&&(caretPos=input.selectionStart),caretPos===input.value.length}function handleEsc(){isTargetInput()?"suggestions"===$scope.stateFocus?searchCtrl.hideSuggestions():$scope.query?$scope.query="":$scope.close():$scope.close(),preventAndApply()}function handleLeft(){"suggestions"===$scope.stateFocus&&($scope.activeSuggestionIx=$scope.activeSuggestionIx>0?$scope.activeSuggestionIx-1:$scope.suggestions.length-1,preventAndApply())}function handleRight(){"suggestions"===$scope.stateFocus&&($scope.activeSuggestionIx=($scope.activeSuggestionIx+1)%$scope.suggestions.length,preventAndApply())}function handleUp(){switch(updateStateIfKeyUp(),$scope.stateFocus){case"input":$scope.activeSuggestionIx=-1;break;case"suggestions":$scope.activeSuggestionIx=0,$scope.activeSelectIx=-1;break;case"partials":$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1;break;case"results":$scope.activeSuggestionIx=-1,searchCtrl.moveActiveResult(-1)}preventAndApply()}function handleDown(){switch(updateStateIfKeyDown(),$scope.stateFocus){case"input":$scope.activeSuggestionIx=-1;break;case"suggestions":$scope.activeSuggestionIx=0,$scope.activeSelectIx=-1;break;case"partials":$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1;break;case"results":$scope.activeSuggestionIx=-1,searchCtrl.moveActiveResult(1)}preventAndApply()}function handleEnter(keyset){switch($scope.stateFocus){case"input":$scope.isPartials()?searchCtrl.setShowPartialMatches():$scope.displaySuggestions?handleSelectSuggestion(keyset,!0):$scope.displayResult?searchCtrl.select($scope.searchTerms,0):searchCtrl.startNewSearchFor();break;case"suggestions":handleSelectSuggestion(keyset,!0);break;case"partials":searchCtrl.setShowPartialMatches();break;case"results":$scope.showMeMoreFocus?searchCtrl.loadNextPage():searchCtrl.select($scope.searchTerms,$scope.activeSelectIx);break;case"start-new-search":searchCtrl.startNewSearchFor()}preventAndApply()}function handleSelectSuggestion(keyset,noCheckForEnd){(noCheckForEnd||isCaretAtEnd(input))&&($scope.activeSuggestionIx=-1===$scope.activeSuggestionIx?0:$scope.activeSuggestionIx,$scope.onSuggestSelect()),preventAndApply()}function handleCtrlfCloseSearch(){searchCtrl.closeSearch(),qvKeyboardShortcuts.preventDefault()}var shortcutOptions,shortcutOptionsDelay,input=$element.find("input")[0],$document=qvangular.getService("$document");$scope.stateFocus="input",shortcutOptions={preventDefault:!1,allowInInput:!0,delay:0},shortcutOptionsDelay={preventDefault:!1,allowInInput:!0,delay:75},keyboardShortcutsGroup=qvKeyboardShortcuts.createGroup("global-search",1),keyboardShortcutsGroup.registerKeys("esc",handleEsc,shortcutOptions),keyboardShortcutsGroup.registerKeys("left",handleLeft,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("right",handleRight,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("up",handleUp,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("down",handleDown,shortcutOptionsDelay),keyboardShortcutsGroup.registerKeys("enter",handleEnter,shortcutOptions),keyboardShortcutsGroup.registerKeys("tab",handleSelectSuggestion,shortcutOptions),keyboardShortcutsGroup.registerKeys("ctrl+f",handleCtrlfCloseSearch,shortcutOptions),keyboardShortcutsGroup.on()}var keyboardShortcutsGroup;return GlobalSearchKeyboardShortcuts.prototype.on=function(){keyboardShortcutsGroup.on()},GlobalSearchKeyboardShortcuts.prototype.off=function(){keyboardShortcutsGroup.off()},GlobalSearchKeyboardShortcuts.prototype["delete"]=function(){keyboardShortcutsGroup["delete"]()},GlobalSearchKeyboardShortcuts}),define("text!client.views/global-search/directives/input/input.ng.html",[],function(){return'<div class="qv-search-input" ng-class="{\'focus\': isInputFocused}">\r\n	<div class="search-field-area">\r\n        <label class="search-placeholder" ng-if="query.length === 0" q-translation="GlobalSearch.SearchData"></label>\r\n		<qui-search-field class="search-field" query="query" auto-focus="autoFocus" autocomplete="\'off\'" is-focused="isInputFocused" tid="globalSearch.searchField" />\r\n	</div>\r\n	<div class="search-underlines">\r\n		<span ng-repeat="underline in underlines" class="underline" ng-class="underline.isWhitespace ? \'term-space\' : \'term\' + underline.colorIx">{{underline.string}}</span>\r\n		<qv-global-search-input-hint></qv-global-search-input-hint>\r\n	</div>\r\n</div>'}),define("text!client.views/global-search/directives/input/input-hint.ng.html",[],function(){return'<span ng-show="displaySuggestions" class="search-suggest" tid="globalSearch.suggestionString">{{hintString}}</span>\r\n'}),define("client.views/global-search/global-search-data-service",["qvangular"],function(qvangular){function addOrEditUnderline(underlines,string,index,isWhitespace){var underline;0!==string.length&&(underlines[index]||(underlines[index]={}),underline=underlines[index],underline.string=string,underline.isWhitespace=isWhitespace||string.length<minimumQueryLength&&!isCJK(string)||'"'===string,underline.colorIx=underline.isWhitespace?-1:colorIx,colorIx=underline.isWhitespace?colorIx:(colorIx+1)%capUnderlineLimit)}function isCJK(str){return str.match(/[\u3040-\u9FBF]/)||str.match(/[\uFF65-\uFF9F]/)}function addSearchTerm(searchTerms,string,startQuote,endQuote){string.length<minimumQueryLength&&!isCJK(string)||searchTerms.push({string:string,startQuote:startQuote,endQuote:endQuote})}function addRange(qRange,ranges,termIx,suggestionText){var i,j,startRange,endRange,startIx,endIx;for(startIx=qRange.qCharPos,endIx=startIx+qRange.qCharCount,i=0;i<ranges.length;++i)if(startRange=ranges[i],!(startIx>=startRange.end)){for(j=i;j<ranges.length;++j)endRange=ranges[j],!(endIx>endRange.end);j--,j-i>1&&ranges.splice(i+1,j-i-1),i===j?ranges.splice(i+1,0,{start:endIx,end:endRange.end,highlight:endRange.highlight,term:endRange.term}):endRange.start=endIx,startRange.end=startIx,ranges.splice(i+1,0,{start:startIx,end:endIx,highlight:!0,term:termIx});break}for(i=ranges.length-1;i>=0;--i)ranges[i].start===ranges[i].end?ranges.splice(i,1):ranges[i].substring=suggestionText.substring(ranges[i].start,ranges[i].end)}var colorIx=0,capUnderlineLimit=6,minimumQueryLength=1,globalSearchActive=!1;qvangular.service("qvGlobalSearchService",function(){this.transformResult=function($scope,searchResultData,groupOffset,associationOffset,groupBaseRowIx){var i,j,k,l,m,searchTermGroup,matchCombination,match,hit,fieldMatch,dataFieldDict,nDisplayValues,data=searchResultData.qResults;for(this.setGlobalSearchActive(!0),$scope.searchTermGroups=$scope.searchTermGroups||[],i=0;i<data.qSearchTermsMatched.length;++i){for($scope.searchTermGroups[groupOffset+i]=$scope.searchTermGroups[groupOffset+i]||[],searchTermGroup=$scope.searchTermGroups[groupOffset+i],searchTermGroup.maxCombinations=0,j=0;j<data.qSearchTermsMatched[i].length;++j){for(searchTermGroup[associationOffset+j]=searchTermGroup[associationOffset+j]||{},matchCombination=searchTermGroup[associationOffset+j],matchCombination.selectIx=data.qSearchTermsMatched[i][j].qId,matchCombination.groupBaseRowIx=groupBaseRowIx,matchCombination.matches=matchCombination.matches||[],matchCombination.nbrMatches=0,k=0;k<data.qSearchTermsMatched[i][j].qFieldMatches.length;++k){for(fieldMatch=data.qSearchTermsMatched[i][j].qFieldMatches[k],matchCombination.matches[k]=matchCombination.matches[k]||{},match=matchCombination.matches[k],match.fieldName=data.qFieldNames[fieldMatch.qField],match.hits=match.hits||[],nDisplayValues=fieldMatch.qValues.length,match.rowIndex=matchCombination.selectIx,match.fieldMatchIndex=k,match.nDisplayValues=nDisplayValues,match.moreHits=fieldMatch.qNoOfMatches-nDisplayValues,matchCombination.nbrMatches+=fieldMatch.qTerms.length,matchCombination.nbrMatches>searchTermGroup.maxCombinations&&(searchTermGroup.maxCombinations=matchCombination.nbrMatches),l=0;nDisplayValues>l;++l)for(match.hits[l]=match.hits[l]||{},hit=match.hits[l],dataFieldDict=data.qFieldDictionaries[fieldMatch.qField].qResult[fieldMatch.qValues[l]],hit.ranges=[{start:0,end:dataFieldDict.qText.length,highlight:!1,term:-1}],m=0;m<dataFieldDict.qRanges.length;++m)addRange(dataFieldDict.qRanges[m],hit.ranges,dataFieldDict.qRanges[m].qTerm%capUnderlineLimit,dataFieldDict.qText,data.qSearchTerms[dataFieldDict.qRanges[m].qTerm]);match.hits.splice(l,match.hits.length-l)}matchCombination.matches.splice(k,matchCombination.matches.length-k)}searchTermGroup.splice(associationOffset+j,searchTermGroup.length-(associationOffset+j)),groupBaseRowIx+=searchTermGroup.length,$scope.nbrLoadedRows=groupBaseRowIx,associationOffset=0}for($scope.searchTermGroups.splice(groupOffset+i,$scope.searchTermGroups.length-(groupOffset+i)),this.setHeaders($scope),$scope.displayResult=!1,i=0;i<$scope.searchTermGroups.length;++i)if($scope.searchTermGroups[i].length>0){$scope.displayResult=!0;break}},this.showMore=function(moreData,match){var data=moreData.qResults;if(1===data.qSearchTermsMatched.length){var dataFieldDict,hit,l,m,fieldMatch=data.qSearchTermsMatched[0][0].qFieldMatches[match.fieldMatchIndex],nDisplayValues=fieldMatch.qValues.length;for(match.nDisplayValues=nDisplayValues,match.moreHits=fieldMatch.qNoOfMatches-nDisplayValues,l=0;nDisplayValues>l;++l)if(!match.hits[l])for(match.hits[l]={},hit=match.hits[l],dataFieldDict=data.qFieldDictionaries[fieldMatch.qField].qResult[fieldMatch.qValues[l]],hit.ranges=[{start:0,end:dataFieldDict.qText.length,highlight:!1,term:-1}],m=0;m<dataFieldDict.qRanges.length;++m)addRange(dataFieldDict.qRanges[m],hit.ranges,dataFieldDict.qRanges[m].qTerm%capUnderlineLimit,dataFieldDict.qText,data.qSearchTerms[dataFieldDict.qRanges[m].qTerm])}},this.setHeaders=function($scope){var group,i,j,maxCols=0;for(i=0;i<$scope.searchTermGroups.length;i++)for(j=0;j<$scope.searchTermGroups[i].length;j++)group=$scope.searchTermGroups[i][j],group.matches.length>maxCols&&(maxCols=group.matches.length);for($scope.columnCount=maxCols,$scope.columnWidth=Math.floor(100/maxCols)+"%",$scope.shadowHeaders=$scope.shadowHeaders||[],$scope.shadowHeaders.splice(0,$scope.shadowHeaders.length-maxCols),i=$scope.shadowHeaders.length;maxCols>i;i++)$scope.shadowHeaders[i]={}},this.transformSuggest=function($scope,searchSuggestData,maxNbr){var i,suggestion,ix=0,underlines=[];for(this.getUnderlinersAndSearchTerms($scope.query,underlines,[]),maxNbr=void 0!==maxNbr?maxNbr:25,maxNbr=Math.min(maxNbr,searchSuggestData.qResult.qSuggestions.length),i=0;maxNbr>i;++i)suggestion={value:searchSuggestData.qResult.qSuggestions[i].qValue,term:searchSuggestData.qResult.qSuggestions[i].qTerm},$scope.query!==this.getResultingQueryFromSuggestion(underlines,suggestion)&&($scope.suggestions[ix]=suggestion,ix++);$scope.suggestions.splice(ix,$scope.suggestions.length-ix)},this._whitespaces=[" ","	","\n","\r","\r\n",""],this.isWhiteSpaceAt=function(string,charIx){var i,whitespaces=this._whitespaces,ch=string.charAt(charIx);for(i=0;i<whitespaces.length;++i)if(ch===whitespaces[i])return!0;return!1},this.getUnderlinersAndSearchTerms=function(string,underlines,searchTerms){function indexOfNextWhiteSpace(string,startIx){var ix,i,currIx;for(i=0;i<whitespaces.length;++i)ix=string.indexOf(whitespaces[i],startIx),ix>=0&&(!currIx||currIx>ix)&&(currIx=ix);return currIx||-1}function findEndQuoteIndex(string,startIx){var ix;do ix=string.indexOf('"',startIx),startIx=ix+1;while(ix>=0&&end>startIx&&!service.isWhiteSpaceAt(string,startIx));return ix}function nextToken(){for(;end>tempIx&&service.isWhiteSpaceAt(string,tempIx);)tempIx++;tempIx>ix&&addOrEditUnderline(underlines,string.substring(ix,tempIx),next++,!0),ix=tempIx}var sub,ix=0,tempIx=0,end=string.length,next=0,whitespaces=this._whitespaces,service=this;for(searchTerms.length=0,colorIx=0,nextToken();end>ix;)if('"'!==string.charAt(ix)){if(tempIx=indexOfNextWhiteSpace(string,ix),sub=tempIx>=0?string.substring(ix,tempIx):string.substring(ix),
addOrEditUnderline(underlines,sub,next++),addSearchTerm(searchTerms,sub,!1,!1),0>tempIx)break;ix=tempIx,nextToken()}else{if(addOrEditUnderline(underlines,string.substring(ix,ix+1),next++),tempIx=findEndQuoteIndex(string,++ix),sub=tempIx>=0?string.substring(ix,tempIx):string.substring(ix),addOrEditUnderline(underlines,sub,next++),addSearchTerm(searchTerms,sub,!0,tempIx>0),0>tempIx)break;addOrEditUnderline(underlines,string.substring(tempIx,tempIx+1),next++),ix=tempIx+=1,nextToken()}underlines.splice(next,underlines.length-next)},this.getSuggestTerms=function(string,searchTerms){function getLastWordInString(string){var endIx,ix,startIx;if(string=string.trim(),0===string.length)return null;for(endIx=string.length,ix=endIx-1,startIx=-1;ix>-1;){if(service.isWhiteSpaceAt(string,ix)){startIx=ix+1;break}ix--}return startIx=Math.max(startIx,0),string.substring(startIx,endIx)}var suggestTerms,lastWord,service=this;return lastWord=getLastWordInString(string),suggestTerms=searchTerms.map(function(searchTerm){return searchTerm.string}),lastWord&&2===lastWord.length&&'"'===lastWord.charAt(0)&&suggestTerms.push(lastWord.charAt(1)),suggestTerms},this.getUnderlineLengthFromTermIx=function(underlines,termIx){for(var underline,ix=0,currentTermIx=0;ix<underlines.length&&(underline=underlines[ix],termIx>currentTermIx||underline.isWhitespace)&&(ix!==underlines.length-1||1!==underline.string.length||this.isWhiteSpaceAt(underline.string,0)||'"'===underline.string);)underline.isWhitespace||currentTermIx++,ix++;return ix>0?ix:0},this.getResultingQueryFromSuggestion=function(underlines,suggestion){var query,quoteAtStart,insert1stQuote,insert2ndQuote,queryLength=this.getUnderlineLengthFromTermIx(underlines,suggestion.term);return query=underlines.slice(0,queryLength).reduce(function(previousValue,underline){return previousValue+underline.string},""),quoteAtStart='"'===query.charAt(query.length-1),insert1stQuote=quoteAtStart?!1:suggestion.value.indexOf(" ")>=0,insert2ndQuote=insert1stQuote||quoteAtStart,query+(insert1stQuote?'"':"")+suggestion.value+(insert2ndQuote?'"':"")},this.getMinQueryLength=function(){return minimumQueryLength},this.setGlobalSearchActive=function(active){globalSearchActive=active},this.isGlobalSearchActive=function(){return globalSearchActive}})}),define("client.views/global-search/directives/input/input",["qvangular","util","text!./input.ng.html","text!./input-hint.ng.html","general.utils/string-normalization","client.views/global-search/global-search-data-service"],function(qvangular,util,inputTemplate,inputHintTemplate,StringNormalization){function isEqual(arr1,arr2){var i;if(arr1.length!==arr2.length)return!1;for(i=0;i<arr1.length;++i)if(arr1[i]!==arr2[i])return!1;return!0}var ongoing=null;qvangular.directive("qvGlobalSearchInput",["$timeout","qvGlobalSearchService",function($timeout,searchDataService){return{restrict:"E",replace:!0,template:inputTemplate,require:"^qvGlobalSearch",link:function($scope,$element,$attrs,searchCtrl){var input=$element.find("input"),lastSearch=[],$document=qvangular.getService("$document");input.on("keydown",function(){$scope.ignoreQueryChange=!1}),$scope.autoFocus=!util.isIos()&&!util.isAndroid(),$scope.$watch("query",function(value){var searchStrings,suggestTerms,searchTerms=[];return $timeout.cancel(ongoing),$scope.ignoreQueryChange||searchCtrl.resetSuggestions(),value&&0!==value.length?(searchDataService.getUnderlinersAndSearchTerms(value,$scope.underlines,searchTerms),$scope.ignoreQueryChange?void($scope.ignoreQueryChange=!1):void(ongoing=$timeout(function(){searchDataService.isWhiteSpaceAt(value,value.length-1)||'"'===value.charAt(value.length-1)?searchCtrl.hideSuggestions():(suggestTerms=searchDataService.getSuggestTerms(value,searchTerms),searchCtrl.suggest(suggestTerms)),searchStrings=searchTerms.map(function(searchTerm){return searchTerm.string}),searchTerms.length>0&&!isEqual(searchStrings,lastSearch)?searchCtrl.search(searchStrings):value.length<searchDataService.getMinQueryLength()&&searchCtrl.emptyResult(),lastSearch=searchStrings,ongoing=null},200))):(searchCtrl.emptyResult(),$scope.underlines.length=0,void(lastSearch=[]))}),$scope.$watch("isInputFocused",function(focused){focused&&$document.find("body").animate({scrollTop:$element.offset().top},100)}),$scope.$on("focusInput",function(){input.focus()}),$scope.$on("blurInput",function(){input.blur()}),$scope.$on("$destroy",function(){input.off()})}}}]),qvangular.directive("qvGlobalSearchInputHint",["qvGlobalSearchService",function(searchDataService){return{restrict:"E",replace:!0,template:inputHintTemplate,require:"^qvGlobalSearch",link:function($scope){function updateQueryAndHint(){var suggestTerms,queryLength,normLength,suggest,hint,suggestion=$scope.suggestions[-1===$scope.activeSuggestionIx?0:$scope.activeSuggestionIx],underlines=[],searchTerms=[];searchDataService.getUnderlinersAndSearchTerms($scope.query,underlines,searchTerms),suggestTerms=searchDataService.getSuggestTerms($scope.query,searchTerms),!$scope.displaySuggestions||$scope.suggestions.length<=0||0===suggestTerms.length||(queryLength=searchDataService.getUnderlineLengthFromTermIx(underlines,suggestion.term),suggest=underlines.slice(queryLength).reduce(function(previousValue,underline){return previousValue+(underline.isWhitespace?" ":underline.string)},""),normLength=StringNormalization.string(suggest).length,suggest=StringNormalization.string(suggestion.value).slice(0,normLength),hint=StringNormalization.string(suggestion.value).slice(normLength),$scope.ignoreQueryChange=!0,$scope.hintString=hint)}$scope.$watch("activeSuggestionIx",function(){updateQueryAndHint()}),$scope.$watchCollection("suggestions",function(){updateQueryAndHint()}),$scope.$watch("displaySuggestions",function(){updateQueryAndHint()})}}}])}),define("text!client.views/global-search/directives/result/result.ng.html",[],function(){return'<div>\r\n\r\n	<qv-global-search-suggest class="qv-global-search-suggest" qv-scroll-to-active="{{activeSelectIx === -1 && stateFocus === \'suggestions\'}}" ></qv-global-search-suggest>	\r\n\r\n	<div ng-if="isPartials()" qv-scroll-to-active="{{stateFocus === \'partials\'}}" class="qv-global-search-result-message search-partials-message">\r\n		<qv-global-search-result-msg></qv-global-search-result-msg>\r\n		<div qva-activate="setShowPartialMatches($event)" tid="globalSearch.showPartialMatches" class="btn-base partial-matches-btn" q-translation="{{ !forcePartials?\'GlobalSearch.ShowPartialMatches\' : \'GlobalSearch.HidePartialMatches\' }}" ng-class="{ \'active\': stateFocus === \'partials\' }" ></div>\r\n	</div>\r\n	\r\n	<div ng-if="displayResult && (!isPartials() || forcePartials)" class="qv-global-search-result-groups">\r\n\r\n		<div ng-if="(outsideSelection || currentSelections)" class="qv-global-search-result-title strong" >\r\n			<span ng-if="outsideSelection && !currentSelections" tid="globalSearch.matchesWholeDataset" q-translation="GlobalSearch.MatchesWholeDataset"></span>\r\n			<span ng-if="currentSelections" tid="globalSearch.addToYourSelections" q-translation="GlobalSearch.AddToYourSelections"></span>\r\n		</div>\r\n\r\n		<!-- Results -->\r\n		<div ng-repeat="searchTermGroup in searchTermGroups">\r\n			<div class="caption-flex" ng-if="searchTermGroup.0.nbrMatches < searchTerms.length" q-translation="GlobalSearch.MatchedSearchTerms,{{searchTermGroup.0.nbrMatches}}"></div>\r\n\r\n			<div class="content-flex" ng-init="parentIndex = $index" ng-class="{ \'touch-off\':!isSmallDevice }" ng-repeat="combination in searchTermGroup" qv-scroll-to-active="{{(combination.groupBaseRowIx + $index === activeSelectIx) && stateFocus === \'results\' }}" tid="globalSearch.resultGroup">\r\n				\r\n				<div class="cell" ng-repeat="match in combination.matches" tid="globalSearch.resultField" ng-class="{ \'maxcell\': !$last && !$first, \'maxcellfirst\': ($first && combination.matches.length > 1) }" >\r\n					\r\n					<div class="group-hits" qva-activate="select( combination, $parentIndex )" ng-style="{\'width\': (isSmallDevice && match.moreHits > 0)? \'80%\': \'100%\'}" ng-class="{ \'open\' : match.mobileExpand }">\r\n						<span class="field-name" tid="globalSearch.resultField.Name">{{match.fieldName}}</span>\r\n						<span ng-repeat="hit in match.hits" tid="globalSearch.resultField.Hit">\r\n							<span ng-repeat="range in hit.ranges track by $index" ng-class="range.highlight ? \'highlighted\' + range.term : \'\'">{{range.substring}}</span>\r\n							<span>{{$last ? \'\' : \', \'}}</span>		\r\n						</span>	\r\n						<div tid="globalSearch.resultField.MoreHits" ng-if="!isSmallDevice && match.moreHits > 0" qva-activate="onShowMoreHits($event, match)" class="more-hits-mobile italic"><span class="more-text" q-translation="GlobalSearch.MoreResults,{{match.moreHits}}"></span></div>		\r\n					</div>\r\n					<div class="more-hits-area" ng-if="isSmallDevice && match.moreHits > 0" tid="globalSearch.resultField.MoreHits"  qva-activate="onShowMoreHits($event, match)"><div class="more-hits-mobile"></div></div>\r\n\r\n				</div>		\r\n			</div>\r\n		</div>	\r\n		\r\n		<!-- show me more button -->\r\n		<div qv-scroll-to-active="{{showMeMoreFocus}}" class="show-me-more"><span ng-if="paging.totalRows > paging.lastRowIx" tid="globalSearch.showmemore" qva-activate="showMeMore($event)" class="btn-base" q-translation="GlobalSearch.ShowMeMore" ng-class="{\'active\': showMeMoreFocus }"></span></div>\r\n\r\n	</div>\r\n\r\n	<qv-global-search-no-results class="search-no-results-message" ng-show="showNoResultsMessage()" ></qv-global-search-no-results>\r\n\r\n	<qv-global-search-throbber></qv-global-search-throbber>\r\n</div>\r\n'}),define("text!client.views/global-search/directives/result/result-message.ng.html",[],function(){return'<div class="qv-global-search-result-message-inline">\r\n    <span ng-if="currentSelections" q-translation="GlobalSearch.NoMatchesWithinCurrentSelection"></span>\r\n    <span ng-if="!currentSelections" q-translation="GlobalSearch.NoMatchesForTheTerms"></span>\r\n    <span ng-repeat="t in searchTerms track by $index">\r\n        <span class="underlined{{$index % capUnderlineMaxNumber}}">{{t}}</span>\r\n        <i ng-if="!$last && $index === searchTerms.length-2" q-translation="GlobalSearch.And"></i><i ng-if="!$last && $index !== searchTerms.length-2">,</i>\r\n    </span> \r\n</div>  '}),define("text!client.views/global-search/directives/result/no-results.ng.html",[],function(){return'<div>\r\n    <div class="qv-global-search-result-groups" ng-if="!error.show">\r\n\r\n        <div class="qv-global-search-result-message" >            \r\n            <qv-global-search-result-msg></qv-global-search-result-msg>\r\n\r\n            <div ng-if="currentSelections && !allSelectionsLocked" tid="globalSearch.newSearchJustFor" qva-activate="searchOutsideSelections($event)" class="btn-base" q-translation="GlobalSearch.NewSearchJustFor,{{query.trim()}}" ng-class="{ \'active\': stateFocus === \'start-new-search\'}"></div>\r\n        </div>\r\n    </div>      \r\n\r\n    <div class="qv-global-search-result-error" ng-if="error.show">\r\n        <span q-translation="{{error.translation}}"></span>\r\n    </div>\r\n</div>'}),define("client.views/global-search/directives/result/result",["qvangular","text!./result.ng.html","text!./result-message.ng.html","text!./no-results.ng.html","touche"],function(qvangular,template,templateMessage,templateNoResults){qvangular.directive("qvGlobalSearchResult",["$timeout",function($timeout){return{restrict:"E",template:template,replace:!0,require:["^qvGlobalSearch","qvGlobalSearchResult"],controller:function(){this.getElement=function(){}},link:function($scope,$element,$attrs,controllers){var searchCtrl=controllers[0],searchResultCtrl=controllers[1];$scope.resultLoaderOpen=!1,$scope.emptyMessageEnabled=!1,$scope.capUnderlineMaxNumber=6,$scope.select=function(combination,$index){Touche.utils.touch?($scope.activeResultIx=$index,$timeout(function(){searchCtrl.select($scope.searchTerms,combination.selectIx)},100)):searchCtrl.select($scope.searchTerms,combination.selectIx)},$scope.loadNextPage=function(){searchCtrl.loadNextPage()},searchResultCtrl.getElement=function(){return $element},$scope.setShowPartialMatches=function(){searchCtrl.setShowPartialMatches()},$scope.showMeMore=function(){searchCtrl.loadNextPage()},$scope.showNoResultsMessage=function(){var res=$scope.emptyMessageEnabled&&$scope.searchTerms.length>0&&!$scope.displayResult&&!$scope.error.show&&!$scope.resultLoaderOpen||$scope.error.show;return res}}}}]),qvangular.directive("qvScrollToActive",function(){return{restrict:"A",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function($scope,$element,$attrs,controllers){function alignTop($container){$container[0].scrollTop=$element[0].offsetTop}function alignBottom(){$element[0].scrollIntoView(!1)}var searchResultCtrl=controllers[1];$attrs.$observe("qvScrollToActive",function(active){if(active=active+""=="true",$element.toggleClass("active",active),active){var $container=searchResultCtrl.getElement(),position=$element.position();position.top<0?alignTop($container):position.top+$element.height()>$container.height()&&alignBottom()}})}}}),qvangular.directive("qvGlobalSearchResultMsg",function(){return{restrict:"E",template:templateMessage,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}}),qvangular.directive("qvGlobalSearchNoResults",function(){return{restrict:"E",template:templateNoResults,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}})}),define("text!client.views/global-search/directives/suggest/suggest.ng.html",[],function(){return'<div class="qv-search-suggest-wrapper" ng-if="displaySuggestions" tid="globalSearch.suggestions">\r\n	<span class="hidden">{{query}}</span>\r\n    <div ng-show="isSmallDevice" class="dym" q-translation="GlobalSearch.DidYouMean"></div>\r\n	<ul class="suggest-popup">\r\n		<li ng-repeat="suggest in suggestions track by $index" qv-scroll-to-active-suggestion="{{$index === activeSuggestionIx && stateFocus === \'suggestions\'}}" ng-class="{active: $index === activeSuggestionIx && stateFocus === \'suggestions\'}" qva-activate="onSuggestSelect($index)" tid="globalSearch.suggestion" bold-suggest=\'{{suggest.value}}\'>\r\n			{{suggest.value}}\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("client.views/global-search/directives/suggest/suggest",["qvangular","text!./suggest.ng.html"],function(qvangular,template){qvangular.directive("qvGlobalSearchSuggest",[function(){return{restrict:"E",template:template,replace:!0,require:["^qvGlobalSearch"],link:function(){}}}]),qvangular.directive("qvScrollToActiveSuggestion",function(){return{restrict:"A",require:["^qvGlobalSearch"],link:function($scope,$element,$attrs){$attrs.$observe("qvScrollToActiveSuggestion",function(active){if(active=active+""=="true"){var position=$element.position(),$container=$element.parent();if($element[0].scrollIntoView(!1),position.left<0)$container.scrollLeft($element[0].offsetLeft-$container[0].offsetLeft);else if(position.left+$element.width()>$container.width()){var deltaScroll=position.left+$element.width()-$container.width();$container.scrollLeft($container[0].scrollLeft+deltaScroll)}}})}}})}),define("text!client.views/global-search/directives/throbber/throbber.ng.html",[],function(){return'<div ng-show="resultLoaderOpen" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader"></div>\r\n</div>'}),define("client.views/global-search/directives/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvGlobalSearchThrobber",["$timeout",function($timeout){return{replace:!0,template:template,restrict:"E",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function($scope,$element,$attrs,controllers){function checkResetScroll(resetScroll){resetScroll&&(searchResultCtrl.getElement()[0].scrollTop=0)}var timer,searchResultCtrl=controllers[1];$scope.$on("resultLoader",function(event,show,resetScroll){show?($timeout.cancel(timer),timer=$timeout(function(){checkResetScroll(resetScroll),$scope.resultLoaderOpen=!0,$scope.emptyMessageEnabled=!1},1e3)):($timeout.cancel(timer),checkResetScroll(resetScroll),$scope.resultLoaderOpen=!1,$scope.emptyMessageEnabled=$scope.searchTerms.length>0)})}}}])}),define("client.views/global-search/global-search-controller",["jquery","qvangular","core.models/app","./global-search-keyboard-shortcuts","autogenerated/qix/engine-enums","client.controllers/error-handler-controller","general.utils/responsive-state","client.models/current-selections","client.views/global-search/directives/input/input","client.views/global-search/directives/result/result","client.views/global-search/directives/suggest/suggest","client.views/global-search/directives/throbber/throbber","client.views/global-search/global-search-data-service","client.views/global-selections/global-selections-service"],function($,qvangular,App,GlobalSearchKeyboardShortcuts,enums,ErrorHandler,ResponsiveState,CurrentSelections){function GlobalSearchController($scope,$document,$element,$window){function clickOutside(e){var element=$(e.target);1!==element.closest(".qv-selections-pager").length&&($element.off("qv-outside"),ctrl.closeSearch())}function getSearchContext(){var context="Cleared";return $scope.currentSelections&&(context="CurrentSelections",$scope.lockedSelections&&$scope.lockedSelections.length>0&&(context="LockedFieldsOnly")),context}function getTransformOffset(result){var offset,nbrMatches,lastGroupIx=$scope.searchTermGroups.length-1;return nbrMatches=result.qSearchTermsMatched[0][0].qFieldMatches.reduce(function(count,match){return count+match.qTerms.length},0),offset=$scope.searchTermGroups[lastGroupIx][0].nbrMatches===nbrMatches?lastGroupIx:lastGroupIx+1}function getAssociationOffset(groupOffset){var offset=0;return $scope.searchTermGroups[groupOffset]&&(offset=$scope.searchTermGroups[groupOffset].length),offset}function getGroupBaseRowIx(groupOffset){var groupBaseRowIx,group,groups=$scope.searchTermGroups;return groups[groupOffset]?(group=groups[groupOffset],groupBaseRowIx=group[0].groupBaseRowIx):(group=groups[groupOffset-1],groupBaseRowIx=group[0].groupBaseRowIx+group.length),groupBaseRowIx}var searchDataService=qvangular.getService("qvGlobalSearchService"),$timeout=qvangular.getService("$timeout"),globalSelectionsService=qvangular.getService("qvGlobalSelectionsService"),keyboardShortcuts=new GlobalSearchKeyboardShortcuts($element,$scope,this),state={search:{idCounter:0,state:States.idle,searchTerms:""},result:{state:States.idle},suggest:{idCounter:0,state:States.idle,suggestTerms:""}},responsiveViewListener=function(){$timeout(function(){$scope.isSmallDevice=ResponsiveState.isSmallDevice})},topOffset=$element.offset().top+$element[0].offsetTop,ctrl=this;$scope.isSmallDevice=ResponsiveState.isSmallDevice,ResponsiveState.ViewChanged.bind(responsiveViewListener),$scope.input="input goes here",$scope.result="result goes here",$scope.$on("$destroy",function(){keyboardShortcuts["delete"](),ResponsiveState.ViewChanged.unbind(responsiveViewListener)}),CurrentSelections.get().then(function(cs){$scope.modelSelections=cs}),$scope.$watch(globalSelectionsService.getSelectionCount,function(value){$scope.currentSelections=value&&value>0?!0:!1,$scope.allSelectionsLocked=$scope.currentSelections&&globalSelectionsService.getSelectionLockedCount()===value,ctrl.search($scope.searchTerms)}),$scope.$watch(globalSelectionsService.getSelectionLockedCount,function(value){$scope.allSelectionsLocked=$scope.currentSelections&&globalSelectionsService.getSelectionCount()===value}),$scope.underlines=[],$scope.query="",$scope.searchTerms=[],$scope.searchTermGroups=[],$scope.displayResult=!1,$scope.activeSelectIx=-1,$scope.showMeMoreFocus=!1,$scope.forcePartials=!1,$scope.allSelectionsLocked=!1,$scope.dimMaxHeight=null,$scope.error={show:!1,message:"",description:""},$scope.paging={lastRowIx:0,totalRows:0},$scope.searchOutsideSelections=function(){ctrl.startNewSearchFor()},$scope.onShowMoreHits=function(event,match){if(event.stopPropagation(),!match.disableShowMore){match.disableShowMore=!0,match.mobileExpand=!0;var page={qOffset:match.rowIndex,qCount:1,qMaxNbrFieldMatches:match.nDisplayValues+15};ctrl.callSearch($scope.searchTerms,page).then(function(data){searchDataService.showMore(data,match)})["finally"](function(){match.disableShowMore=!1})}},$scope.close=function(){ctrl.closeSearch()},$scope.$watch("isInputFocused",function(value){value&&$element.on("qv-outside",clickOutside)}),$scope.suggestions=[],$scope.displaySuggestions=!1,$scope.activeSuggestionIx=-1,$scope.ignoreQueryChange=!1,$scope.onSuggestSelect=function(index){var newQuery,deregister,suggestion,underlines=[];index=void 0!==index?index:$scope.activeSuggestionIx,suggestion=$scope.suggestions[index],searchDataService.getUnderlinersAndSearchTerms($scope.query,underlines,[]),newQuery=searchDataService.getResultingQueryFromSuggestion(underlines,suggestion),newQuery.length>255?(keyboardShortcuts.off(),ErrorHandler.showDialog({message:"ErrorDialog.SearchStringTooLong"}),deregister=$scope.$on("errorHandlerClosed",function(){keyboardShortcuts.on(),deregister()})):($scope.query=newQuery+" ",$scope.ignoreQueryChange=!1),ctrl.hideSuggestions(),$scope.$broadcast("focusInput")},this.hideSuggestions=function(){$scope.displaySuggestions&&($scope.displaySuggestions=!1,this.resetSuggestions())},this.startNewSearchFor=function(){$scope.outsideSelection=!0,$scope.modelSelections.clearAll(),$scope.$broadcast("focusInput"),this.search($scope.searchTerms)},this.setShowPartialMatches=function(){$scope.forcePartials=!$scope.forcePartials,$scope.dimMaxHeight=$scope.forcePartials?$window.innerHeight-topOffset:null,$scope.$broadcast("focusInput")},$scope.isPartials=function(){return $scope.searchTermGroups.length&&$scope.searchTerms.length>$scope.searchTermGroups[0].maxCombinations},this.resetSuggestions=function(){$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1},this.showSuggestions=function(){$scope.displaySuggestions=!0,$scope.activeSuggestionIx=-1,$scope.activeSelectIx=-1},this.showError=function(err){$scope.displayResult=!1,$scope.error.show=!0,$scope.error.translation="ErrorCode."+err.error.code,err.isHandled=!0},this.toogleSuggestions=function(show){show?this.showSuggestions():this.hideSuggestions()},this.emptyResult=function(){$scope.displayResult=!1,$scope.activeSelectIx=-1,$scope.error.show=!1,state.search.state=States.idle,state.suggest.state=States.idle,$scope.searchTerms=[],$scope.searchTermGroups=[],$scope.outsideSelection=!1,$scope.$broadcast("resultLoader",!1),$scope.forcePartials=!1,$scope.stateFocus="input",this.hideSuggestions(),searchDataService.setGlobalSearchActive(!1)},this.moveActiveResult=function(step){$scope.showMeMoreFocus=!1,0!==step&&(step>0?($scope.activeSelectIx=Math.min($scope.activeSelectIx+1,$scope.nbrLoadedRows),$scope.activeSelectIx=Math.min($scope.activeSelectIx,$scope.paging.totalRows-1),$scope.activeSelectIx===$scope.nbrLoadedRows&&($scope.showMeMoreFocus=!0)):0>step&&($scope.activeSelectIx=Math.max($scope.activeSelectIx-1,0)))},this.search=function(searchTerms){function success(data){requestId===state.search.idCounter&&state.search.state===States.pending&&(state.search.state=States.idle,state.search.searchTerms="",$scope.searchTerms=searchTerms,$scope.$broadcast("resultLoader",!1,!0),searchDataService.transformResult($scope,data,0,0,0),$scope.activeSelectIx=-1,$scope.paging.lastRowIx=$scope.searchTermGroups.reduce(function(rowCount,searchTermGroup){return rowCount+searchTermGroup.length},0),$scope.paging.totalRows=data.qResults.qTotalSearchResults)}function error(err){err.error.code===enums.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(self.emptyResult(),self.showError(err)),err.error.code!==enums.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(state.search.state=States.idle,state.search.searchTerms="",$scope.$broadcast("resultLoader",!1),$scope.displayResult=!1)}if($scope.dimMaxHeight=$window.innerHeight-topOffset,$scope.stateFocus="input",0!==searchTerms.length){state.search.idCounter=state.search.idCounter+1;var requestId=state.search.idCounter,self=this,page={qOffset:0,qCount:5,qMaxNbrFieldMatches:5};state.search.state=States.pending,state.search.searchTerms=searchTerms,$scope.$broadcast("resultLoader",!0,!0),$scope.error.show=!1,this.callSearch(searchTerms,page).then(success,error)}},this.loadNextPage=function(){$scope.dimMaxHeight=$element.find(".qv-global-search-dimmer").height();var page={qOffset:$scope.paging.lastRowIx,qCount:5,qMaxNbrFieldMatches:5};state.result.state===States.idle&&(state.result.state=States.pending,$scope.showMeMoreFocus=!1,this.callSearch($scope.searchTerms,page).then(function(data){var groupOffset=getTransformOffset(data.qResults),associationOffset=getAssociationOffset(groupOffset),groupBaseRowIx=getGroupBaseRowIx(groupOffset);searchDataService.transformResult($scope,data,groupOffset,associationOffset,groupBaseRowIx),$scope.paging.lastRowIx=$scope.searchTermGroups.reduce(function(rowCount,searchTermGroup){return rowCount+searchTermGroup.length},0)})["finally"](function(){state.result.state=States.idle}))},this.callSearch=function(searchTerms,page){var options={qContext:getSearchContext()},request=App.current.rpc("SearchAssociations",null,[options,searchTerms,page]);return request},this.closeSearch=function(){$element.off("qv-outside"),$scope.isSmallDevice?(ctrl.emptyResult(),$scope.query="",$scope.$broadcast("blurInput")):globalSelectionsService.toggleGlobalSearch()},this.suggest=function(suggestTerms){function success(data){state.suggest.suggestTerms="",searchDataService.isWhiteSpaceAt($scope.query,$scope.query.length-1)||'"'===$scope.query.charAt($scope.query.length-1)||(requestId===state.suggest.idCounter&&state.suggest.state===States.pending&&(searchDataService.transformSuggest($scope,data,10),self.toogleSuggestions($scope.suggestions.length>0),$scope.$broadcast("suggestShow",!0,!0)),state.suggest.state=States.idle)}function error(err){err.error.code===enums.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(err.isHandled=!0),err.error.code!==enums.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(state.suggest.state=States.idle,state.suggest.suggestTerms="")}if(0!==suggestTerms.length){var self=this;state.suggest.idCounter=state.suggest.idCounter+1;var requestId=state.suggest.idCounter;state.suggest.state=States.pending,state.suggest.suggestTerms=suggestTerms,App.current.rpc("SearchSuggest",null,[{},suggestTerms]).then(success,error)}},this.select=function(terms,selectIx){if($scope.$broadcast("blurInput"),0!==terms.length&&0!==$scope.searchTermGroups.length){0>selectIx&&(selectIx=$scope.activeSelectIx=0);var options={qContext:getSearchContext()};App.current.rpc("SelectAssociations",null,[options,terms,selectIx]),this.emptyResult(),$scope.query="",$scope.$broadcast("focusInput")}},this.setTestSearchTermGroups=function(groups){$scope.searchTermGroups=groups}}var States={idle:0,pending:1};return GlobalSearchController}),define("client.views/global-search/global-search",["qvangular","text!./global-search.ng.html","client.views/global-search/global-search-controller"],function(qvangular,template,GlobalSearchController){return qvangular.directive("qvGlobalSearch",function(){return{restrict:"E",template:template,controller:["$scope","$document","$element","$window",GlobalSearchController],require:["qvGlobalSearch"],scope:{},replace:!0,link:function(){}}}),"<qv-global-search></qv-global-search>"}),define("client.views/global-selections/global-selections-service",["jquery","qvangular","client.views/global-selections/global-selections","client.views/mobile-selections/mobile-selections","client.views/global-selections-deactivate/global-selections-deactivate","client.views/global-search/global-search","client.utils/state","general.utils/responsive-state","core.models/app","client.views/selection-toolbar/selection-toolbar-service"],function($,qvangular,desktopComponent,mobileComponent,deactivate,searchComponent,State,ResponsiveState,App){qvangular.service("qvGlobalSelectionsService",["$document","$timeout","qvSelectionToolbarService",function($document,$timeout,selectionToolbarService){function openComponentsCount(){var keys=Object.keys(components),count=0;return keys.forEach(function(key){components[key].$container&&count++}),count}function closeSearchWhenNotAnalysisStateOrInObjectView(){(!State.isInAnalysisMode||State.inObjectView())&&removeComponent(components.search)}function updateResponsiveView(){removeComponent(components.select),setupComponent(components.select)}function setupComponent(component){component.$container=angular.element("<div>"),component.$containerId?$document.find(component.$containerId).append(component.$container):$document.find("body").append(component.$container),component.$container.showComponent(component.getComponent()),$deactivateContainer||ResponsiveState.isSmallDevice||($deactivateContainer=angular.element("<div>"),$document.find("body").append($deactivateContainer),$deactivateContainer.showComponent(deactivate)),component.setup()}function removeComponent(component){component.$container&&(component.$container.remove(),component.$container=void 0),$deactivateContainer&&0===openComponentsCount()&&($deactivateContainer.remove(),$deactivateContainer=void 0),component.destroy()}function isOpen(component){return component.$container?!0:!1}function toggleComponent(component){isOpen(component)?(removeComponent(component),$("body").removeClass("qv-global-selections-enabled")):(State.state===State.States.snapshot&&State.setState(State.States.analysis),$("body").addClass("qv-global-selections-enabled"),setupComponent(component))}var $deactivateContainer,service,components={select:{$container:void 0,getComponent:function(){return ResponsiveState.isSmallDevice?mobileComponent:desktopComponent},setup:function(){ResponsiveState.ViewChanged.bind(updateResponsiveView)},destroy:function(){ResponsiveState.ViewChanged.unbind(updateResponsiveView)}},search:{$container:void 0,$containerId:"#qv-global-search-container",getComponent:function(){return searchComponent},setup:function(){State.StateChanged.bind(closeSearchWhenNotAnalysisStateOrInObjectView),App.current.isModal()&&selectionToolbarService.confirm()},destroy:function(){State.StateChanged.unbind(closeSearchWhenNotAnalysisStateOrInObjectView)}}},csShowCallback=null,selectionCount=0,selectionLockedCount=0,globalSearchService=qvangular.getService("qvGlobalSearchService");return service={toggleGlobalSelection:function(){toggleComponent(components.select)},toggleGlobalSearch:function(){$timeout(function(){toggleComponent(components.search)})},openGlobalSearch:function(){components.search.$container||(removeComponent(components.search),setupComponent(components.search))},closeGlobalSearchIfNotActive:function(){globalSearchService.isGlobalSearchActive()||this.off("search")},off:function(key){var component=components[key];removeComponent(component)},offAll:function(){var me=this,keys=Object.keys(components);keys.forEach(function(key){me.off(key)})},isSelectActive:function(){return void 0!==components.select.$container},isSearchActive:function(){return void 0!==components.search.$container},setCsShowCallback:function(callback){csShowCallback=callback},setCsShow:function(show){csShowCallback&&csShowCallback(show)},setSelectionCount:function(n){selectionCount=n},getSelectionCount:function(){return selectionCount},setSelectionLockedCount:function(n){selectionLockedCount=n},getSelectionLockedCount:function(){return selectionLockedCount}}}])}),define("text!client.views/state-count-bar/state-count-bar.ng.html",[],function(){return'<div class="qv-state-count-bar" tid="stateCount">\r\n	<div class="state selected" ng-style="{\'width\': percents.qSelected + \'%\'}"></div>\r\n	<div class="state locked" ng-style="{\'width\': percents.qLocked + \'%\'}"></div>\r\n	<div class="state optional" ng-style="{\'width\':  percents.qOption + \'%\'}"></div>\r\n	<div class="state alternative" ng-style="{\'width\':  percents.qAlternative + \'%\'}"></div>\r\n</div>';
}),define("client.views/state-count-bar/state-count-bar",["qvangular","text!./state-count-bar.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvStateCountBar",function(){return{restrict:"E",template:template,scope:{cardinal:"=",stateCounts:"="},link:function($scope){function updateScope(){var percents,cardinal=$scope.cardinal,stateCounts=$scope.stateCounts;void 0!==cardinal&&void 0!==stateCounts&&(percents=getPercents(cardinal,stateCounts),$scope.percents=validatePercents(percents))}function getPercents(cardinal,stateCounts){var percents={};return["qSelected","qLocked","qOption","qAlternative"].forEach(function(state){var count=stateCounts[state]||0,percent=Math.round(count/cardinal*100);count>0&&0===percent&&(percent=1),percents[state]=percent}),percents}function validatePercents(rawPercents){var key,maxKey,percents={},total=0;for(key in rawPercents)percents[key]=rawPercents[key],(!maxKey||rawPercents[key]>rawPercents[maxKey])&&(maxKey=key),total+=rawPercents[key];return total>100&&(percents[maxKey]=rawPercents[maxKey]-(total-100)),percents}$scope.percents=[],$scope.$watch("cardinal",function(){updateScope()}),$scope.$watchCollection("stateCounts",function(){updateScope()})}}})}),define("client.views/current-selections/current-selections",["qvangular","text!./current-selections.ng.html","client.models/current-selections","core.utils/resize","general.utils/responsive-state","client.utils/state","core.models/app","objects/listbox-popover/listbox-popover-service","general.components/pager/pager","client.views/global-selections/global-selections-service","client.views/state-count-bar/state-count-bar","objects.views/charts/tooltip/chart-tooltip-service","client.views/current-selections/current-selections-service"],function(qvangular,template,CurrentSelections,resize,ResponsiveState,State,App){"use strict";function createPlaceHolder(placeholderObj,field){return placeholderObj.isPlaceHolder=!0,placeholderObj.active=!1,placeholderObj.qLocked=!1,placeholderObj.feedbackActive=!1,placeholderObj.translation="",placeholderObj.qTotal=0,placeholderObj.qStateCounts=0,field&&(placeholderObj.qField=field),placeholderObj}qvangular.directive("qvSelectionPager",["qvGlobalSelectionsService","$timeout",function(globalSelectionService,$timeout){return{restrict:"A",priority:1,link:function(scope){var isSelectActiveListner=scope.$watch(globalSelectionService.isSelectActive,function(active){scope.$emit("globalSelectionActive",active),$timeout(function(){scope.refreshPager(!1)})});resize.on("end",scope.refreshPager),scope.$on("$destroy",function(){isSelectActiveListner()})}}}]);var component={template:template,replace:!0,restrict:"E",scope:{appName:"@"},link:function($scope){var $timeout=qvangular.getService("$timeout"),globalSelectionService=qvangular.getService("qvGlobalSelectionsService"),updateResponsiveView=function(){$timeout(function(){$scope.isSmallDevice=ResponsiveState.isSmallDevice})},stateChangeListener=function(){State.inSheetView()&&ResponsiveState.isSmallDevice&&globalSelectionService.openGlobalSearch()};$scope.isSmallDevice=ResponsiveState.isSmallDevice,$scope.cachedPlaceHolders=[],ResponsiveState.ViewChanged.bind(updateResponsiveView),$scope.$watch("isSmallDevice",function(isSmallDevice){isSmallDevice===!0?globalSelectionService.openGlobalSearch():globalSelectionService.closeGlobalSearchIfNotActive()}),State.StateChanged.bind(stateChangeListener),$scope.mobileIndicatorTop=!1,$scope.mobileIndicatorShow=!1,globalSelectionService.setCsShowCallback(function(show){$scope.mobileIndicatorShow=show}),$scope.$on("globalSelectionActive",function(childScope,active){$scope.isGlobalSelectionsActive=active}),App.get($scope.appName).then(function(app){$scope.$watch(app.isModal.bind(app),function(inSelection){$scope.inSelection=inSelection,$scope.inSelection&&$scope.activeFieldName&&$scope.activeFieldName.length>0?$scope.cachedPlaceHolders=$scope.items.map(function(item){return createPlaceHolder({},item.qField)}):($scope.cachedPlaceHolders=[],$scope.items=$scope.items.filter(function(item){return!item.isPlaceHolder}))})}),$scope.$watch(globalSelectionService.isSearchActive,function(active){$scope.isGlobalSearchActive=active}),$scope.toggleGlobalSelection=function($event){$event.preventDefault(),globalSelectionService.toggleGlobalSelection()},$scope.toggleGlobalSearch=function(){globalSelectionService.toggleGlobalSearch()},$scope.$on("$destroy",function(){ResponsiveState.ViewChanged.unbind(updateResponsiveView),globalSelectionService.off("search"),State.StateChanged.unbind(stateChangeListener),globalSelectionService.setCsShowCallback(null)})},controller:["$scope","$timeout","qvChartTooltipService","qvGlobalSelectionsService","qvCurrentSelectionsService",function($scope,$timeout,chartTooltipService,globalSelector,currentSelectionsService){function toggleGlobalSelector(){globalSelector.setCsShow(ResponsiveState.isSmallDevice&&$scope.items.length>0&&State.view!==State.Views.object)}var tooltipTimeout,rootScopeListener,tooltipOpen=!1,listboxPopoverService=qvangular.getService("qvListboxPopoverService");$scope.items=[],$scope.disable={clear:!0,back:!0,forward:!0},CurrentSelections.get().then(function(cs){$scope.model=cs}),CurrentSelections.bindLayout($scope,"model",function(layout){$scope.disable.clear=0===layout.qSelectionObject.qSelections.length||layout.qSelectionObject.qSelections.every(function(selection){return selection.qLocked}),$scope.disable.back=0===layout.qSelectionObject.qBackCount,$scope.disable.forward=0===layout.qSelectionObject.qForwardCount,$scope.items=layout.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex});var lockedSelectionsCount=0;$scope.items.forEach(function(item){item.qLocked===!0&&lockedSelectionsCount++,item.translation=currentSelectionsService.translate(item)}),$scope.nbrSelections=$scope.items.length,globalSelector.setSelectionLockedCount(lockedSelectionsCount),globalSelector.setSelectionCount($scope.items.length),toggleGlobalSelector(),$scope.cachedPlaceHolders.length>0&&$scope.activeFieldName&&$scope.activeFieldName.length>0&&($scope.cachedPlaceHolders.forEach(function(item){item=createPlaceHolder(item)}),$scope.items.forEach(function(item){$scope.cachedPlaceHolders.forEach(function(placeHolder,j){item.qField===placeHolder.qField&&($scope.cachedPlaceHolders[j]=item)})}),$scope.items=$scope.cachedPlaceHolders),$timeout(function(){$scope.$broadcast("refreshPager")})}),$scope.$watch(State.inObjectView,toggleGlobalSelector),$scope.$watch("isSmallDevice",toggleGlobalSelector),$scope.clear=function(fieldName){$scope.$parent.itemSelected&&($scope.$parent.itemSelected=!1),$scope.model.clearField(fieldName)},$scope.clearAllFields=function(){$scope.model.clearAll()},$scope.back=function(){$scope.model.back()},$scope.forward=function(){$scope.model.forward()},$scope.showPopover=function($event){var $element=angular.element($event.target).closest(".item"),fieldName=$element.scope().item.qField,popoverOptions={qvaOutsideIgnoreFor:"currentSelectionsItems",$alignToElement:$element,showLock:!0};return $scope.isClearSelectionIcon($event.target)?void($scope.activeFieldName&&(listboxPopoverService.close(),$scope.activeFieldName="")):fieldName===$scope.activeFieldName?(listboxPopoverService.close(),void($scope.activeFieldName="")):($timeout(function(){$scope.closeTooltip()},100),$scope.activeFieldName=fieldName,void listboxPopoverService.showField(fieldName,$scope.model.session.currentApp,popoverOptions,{},function(){$scope.activeFieldName="",$timeout(function(){$scope.closeTooltip()},100)}))},$scope.openTooltip=function($event,item){return $scope.isClearSelectionIcon($event.target)?void $scope.closeTooltip():void(tooltipOpen||Touche.utils.touch||($scope.cancelTooltip(),tooltipTimeout=$timeout(function(){var selectedCount=item.qStateCounts.qSelected+item.qStateCounts.qSelectedExcluded+item.qStateCounts.qLocked+item.qStateCounts.qLockedExcluded;tooltipOpen=!0,chartTooltipService.open({content:[{header:item.qField+" ("+selectedCount+"/"+item.qTotal+")",rows:[{content:item.translation}]}],position:{x:$event.clientX,y:$event.clientY},direction:"bottom",template:"generic"})},500)))},$scope.closeTooltip=function(){tooltipOpen=!1,$scope.cancelTooltip(),chartTooltipService.close()},$scope.cancelTooltip=function(){$timeout.cancel(tooltipTimeout)},$scope.isClearSelectionIcon=function(element){return angular.element(element).closest(".remove").is(".remove")},rootScopeListener=qvangular.$rootScope.$on("locked-feedback",function(event,args){$scope.items.forEach(function(element){-1!==args[0].indexOf(element.qField)&&(args[1]?element.feedbackActive=!1:element.feedbackActive=!0,qvangular.$apply($scope))})}),$scope.$on("$destroy",function(){rootScopeListener()})}]};return qvangular.directive("qvStageCurrentSelections",function(){return component}),component}),"undefined"==typeof Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{enumerable:!1,get:function(){var matches=this.toString().match(/^function( (.*?))?\(/);return matches&&matches.length>=3?matches[2]:"anonymous function"}}),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,value:function(e){return-1!==this.indexOf(e)}}),"scrollX"in window.constructor.prototype||Object.defineProperties(window.constructor.prototype,{scrollX:{get:function(){return this.pageXOffset}},scrollY:{get:function(){return this.pageYOffset}}}),define("core.utils/augment",function(){}),define("qlik",["qvangular","translator","core.models/app","client.models/rpc-session","core.utils/deferred","apis/qglobal","apis/qapp","apis/qnavigation","apis/qsession","client.utils/state","general.utils/touch-configuration-util","general.models/library/extension-list","util","autogenerated/qix/engine-enums","general.utils/qv-activate","general.utils/qv-swipe","general.utils/qv-longtapswipe","objects/object","client.views/current-selections/current-selections","core.utils/augment","general.services/content-api/content-api","angular-route","angular-animate","angular-sanitize"],function(qvangular,translator,App,RPCSession,Deferred,QGlobal,QApp,QNavigation,QSession,State,touchConfigUtil,ExtensionList,Util,enums){function initClient(){clientInitialized||inClient||(clientInitialized=!0,touchConfigUtil.configureTouchSupport(),langSelected||translator.setup())}function setOnError(onError,onWarning){errorCallback=onError,QApp.setErrorCallback(onError),inClient||QSession.setupSocketErrorHandling(onError,onWarning)}function setLanguage(lang){langSelected=!0,translator.setup(lang)}function currApp(obj){var app=obj&&obj.backendApi?obj.backendApi.model.session.currentApp:App.current;return currWrapper||(currWrapper=new QApp(app)),currWrapper.model===app?currWrapper:new QApp(app)}function makeConfig(conf){return conf=conf||{},{host:conf.host||Util.hostname,port:conf.port?conf.port.toString():Util.port,isSecure:conf.isSecure||Util.isSecure,reloadURI:Util.reloadURI,prefix:conf.prefix||Util.basePath,openWithoutData:conf.openWithoutData,identity:conf.identity}}function openApp(appId,config){initClient();var cfg=makeConfig(config),cacheId=App.makeCacheId(appId,cfg);return appCache[cacheId]?appCache[cacheId]:(qvangular.$apply(qvangular.$rootScope,function(){var app=App.getSync(appId,cfg,!0);if(app){app.session.Close.observers.forEach(function(obs){app.session.Close.unbind(obs)}),app.waitForOpen.promise.then(function(){errorCallback&&app.session.Close.bind(function(){errorCallback({code:Errors.LOCERR_GENERIC_CONNECTION_LOST,message:"Connection lost"})})},function(err){errorCallback&&(errorCallback(err.error),err.isHandled=!0)});var qapp=new QApp(app);qapp.close=function(){return delete appCache[cacheId],app.close()},appCache[cacheId]=qapp}}),appCache[cacheId])}function getGlobal(config){return new QGlobal(makeConfig(config))}function table(ext,path){var app=currApp(ext);return app.table(ext,path)}var errorCallback,currWrapper,navigationApi,appCache={},clientInitialized=!1,langSelected=!1,inClient=!1,Errors=enums.NxLocalizedErrorCode;window.location.pathname.indexOf("/sense/app/")>-1?inClient=!0:(State.setState(State.States.analysis),State.setView(State.Views.sheet)),navigationApi=new QNavigation(inClient);var exports={openApp:openApp,currApp:currApp,getGlobal:getGlobal,setOnError:setOnError,setLanguage:setLanguage,table:table,getAppList:function(callback,param){qvangular.$apply(qvangular.$rootScope,function(){var session=RPCSession.get("?transient=",makeConfig(param));session.open(),App.getList(session).then(function(list){callback(list),session.close()})})},resize:function(id){id?pubsub.publish("/ui/object/resize."+id):pubsub.publish("/resize/end")},getExtensionList:function(callback){var dfd=new Deferred;return ExtensionList.getList().then(function(reply){callback&&callback(reply),dfd.resolve(reply)}),dfd.promise},callRepository:function(path,method,body){return qvangular.getService("$contentApi").request({method:method||"GET",url:path,data:body})},navigation:navigationApi};return define("qlik",exports),require.s.contexts.sense&&(require.s.contexts._.defined.angular=require.s.contexts.sense.defined.angular),exports}),define("text!general.services/media-tool/media-tool.ng.html",[],function(){return'<div class="qv-st-container">\r\n	<form class="qv-st-form">\r\n		<textarea class="qv-st-instance">{{data}}</textarea>\r\n	</form>\r\n</div>'}),define("general.services/media-tool/theme",[],function(){var palette=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],fontSizes={1:"XS",2:"S",3:"M",4:"L",5:"XL"},fontSizesPx={10:"1",13:"2",16:"3",22:"4",32:"5"},htmlSizeToMarkdownSize={1:1,2:2,3:3,4:4,5:5,6:5},markdownSizeToHtmlSize={1:1,2:2,3:3,4:4,5:5};return{palette:palette,fontSizes:fontSizes,fontSizesPx:fontSizesPx,htmlSizeToMarkdownSize:htmlSizeToMarkdownSize,markdownSizeToHtmlSize:markdownSizeToHtmlSize}}),define("text!general.services/media-tool/toolbar.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" position="\'top\'" collision="\'collision\'" width="options.width" height="48" class="qui-immidiateContextual qv-texttool-toolbar"\r\n					  on-close-view="closeToolbar(event)" ondragstart="return false">\r\n\r\n	<div ng-if="textTool.showUsage" class="usage"><span q-translation="MediaTool.YouHaveUsed"></span> <span>{{textTool.usage}}%</span></div>\r\n\r\n	<div id="qv-toolbar-colorpicker" tid="colorpicker" q-title-translation="MediaTool.Toolbar.FontColor">\r\n		<div qv-color-picker-button on-close="closecolorpickerfoldout(event)" ng-model="color" ng-show="buttons.color" ng-disabled="!haveSelection()"></div>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-fontsize" qva-activate="setActiveFoldout(\'fontSizes\',$event)" ng-show="buttons.fontSize" tid="fontSize" ng-disabled="!haveSelection()"\r\n			ng-class="{\'qui-active\':foldouts.fontSizes}" q-title-translation="MediaTool.Toolbar.FontSize" class="qui-button">\r\n		{{shortFontSize(textTool.fontSize)}}\r\n		<i class="text-size-arrow icon-triangle-bottom"></i>\r\n	</button>\r\n	<immidiate-contextual ng-if="foldouts.fontSizes" width="48" align-to="\'#qv-toolbar-fontsize\'" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFontsizeFoldout(event)">\r\n		<ul class="qui-icontextlist qv-media-tool-fontsize">\r\n			<li ng-repeat="size in fontSizes" qva-activate="setFontSize($event, size)" ng-class="{\'active\':textTool.fontSize == size}"><span class="qui-textlist-text">{{shortFontSize(size)}}</span></li>\r\n		</ul>\r\n	</immidiate-contextual>\r\n\r\n	<div class="qui-buttongroup" ng-show="buttonGroup1">\r\n		<div ng-class="{\'qui-active\':textTool.states.bold}" ng-show="buttons.bold" tid="bold" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Bold" class="qui-button" data-icon="toolbar-bold" qva-press="exec($event,\'bold\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.italic}"  ng-show="buttons.italic" tid="italic" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Italic" class="qui-button" data-icon="toolbar-cursive" qva-press="exec($event,\'italic\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.underline}"  ng-show="buttons.underline" tid="underline" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Underline" class="qui-button" data-icon="toolbar-underline" qva-press="exec($event,\'underline\')"></div>\r\n	</div>\r\n\r\n	<div class="qui-buttongroup" ng-show="buttonGroup2">\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyLeft}" ng-show="buttons.justifyLeft" tid="justifyLeft"\r\n				class="qui-button" q-title-translation="Common.Text.AlignLeft" data-icon="toolbar-left" qva-activate="exec($event,\'justifyLeft\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyCenter}" ng-show="buttons.justifyCenter" tid="justifyCenter"\r\n				class="qui-button" q-title-translation="Common.Text.AlignCenter" data-icon="toolbar-center" qva-activate="exec($event,\'justifyCenter\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyRight}" ng-show="buttons.justifyRight" tid="justifyRight"\r\n				class="qui-button" q-title-translation="Common.Text.AlignRight" data-icon="toolbar-right" qva-activate="exec($event,\'justifyRight\')"></button>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-link" qva-activate="openLinkFoldout($event)" ng-show="buttons.link" tid="link"\r\n			ng-class="{\'qui-active\':foldouts.link}" class="qui-button" q-title-translation="{{ textTool.states.link ? \'MediaTool.Toolbar.EditURLLink\' : \'MediaTool.Toolbar.CreateURLLink\' }}"\r\n			ng-disabled="linkDisabled()">\r\n		<i class="icon-link" ng-class="{\'active\':textTool.states.link}"></i>\r\n		<i class="icon-triangle-bottom"></i>\r\n	</button>\r\n\r\n	<button id="qv-toolbar-image" qva-activate="openMediaLibrary($event)" ng-class="{\'qui-active\':foldouts.mediaLibrary}" ng-show="buttons.image" tid="image"\r\n			class="qui-button" q-title-translation="MediaTool.Toolbar.InsertImage" data-icon="image"></button>\r\n\r\n</immidiate-contextual>'}),define("general.services/media-tool/text-selection",[],function(){function getSelection(){return window.getSelection()}var Selection={};return Selection.createRange=function(elem,start,end){var range=document.createRange();return start=start||0,end="undefined"==typeof end?elem.childNodes.length:end,range.setStart(elem,start),range.setEnd(elem,end),range},Selection.createRangeForElement=function(elem){var range=document.createRange();return range.selectNode(elem),range},Selection.addRange=function(range,exclusive){var sel=getSelection();exclusive&&sel.removeAllRanges(),sel.addRange(range)},Selection.getRange=function(idx){var selection=window.getSelection();return idx=idx||0,selection.rangeCount>idx?getSelection().getRangeAt(idx):null},Selection.rangeEquals=function(range1,range2){return null===range1&&null===range2?!0:null===range1||null===range2?!1:0===range1.compareBoundaryPoints(window.Range.START_TO_START,range2)&&0===range1.compareBoundaryPoints(window.Range.END_TO_END,range2)},Selection}),define("text!general.services/media-tool/link-foldout/link-foldout.ng.html",[],function(){return'<immidiate-contextual width="400" align-to="options.alignTo" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFoldout(event)"\r\n					  class="qv-link-foldout qui-immidiateContextual" tid="link-foldout">\r\n\r\n	<div class="link-header">\r\n		<h1 class="link-header-text" ng-if="linkActive" q-translation="MediaTool.Toolbar.InsertUrlLink.Title"></h1>\r\n		<h1 class="link-header-text" ng-if="!linkActive" q-translation="Common.Bookmarks"></h1>\r\n		<div class="link-submenu" ng-if="inStorytelling()">\r\n			<ul>\r\n				<li class="qui-outlinebutton" ng-if="!linkActive" qva-activate="toggleLink(true)" q-translation="Common.URL" ></li>\r\n				<li class="qui-outlinebutton" ng-if="linkActive" qva-activate="toggleLink(false)" q-translation="Common.Bookmarks" ></li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="link-content" ng-if="linkActive">\r\n		<span class="link-label" q-translation="MediaTool.Toolbar.InsertUrlLink.Label"></span>\r\n		<input class="link-input qui-input" maxlength="255" ng-model="link.url" style="margin-bottom: 10px" qv-enter="onEnter($event)"/>\r\n		<div class="link-remove-container" ng-if="showRemove">\r\n			<button class="link-remove qui-button" data-icon="bin" qva-activate="removeLink($event)" q-title-translation="MediaTool.Toolbar.RemoveLink"></button>\r\n		</div>\r\n	</div>\r\n	<div class="bookmark-content" ng-if="!linkActive">\r\n		<ul>\r\n			<li ng-if="bookmarks.length < 1" class="bookmark-link-row">\r\n				<span class="bookmark-link-row-content no-bookmarks" q-translation="Bookmarks.NoBookmarks"></span>\r\n			</li>\r\n			<li class="bookmark-link-row" ng-repeat="bookmark in bookmarks" ng-class="{ active: bookmark.active}">\r\n				<span class="bookmark-link-row-content" qva-activate="insertBookmark($event, bookmark.qInfo.qId)" data-bookmark-id="{{bookmark.qInfo.qId}}">{{bookmark.qData.title}}</span>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n<!--</div>-->\r\n</immidiate-contextual>'}),define("general.services/media-tool/link-foldout/link-foldout",["jquery","text!./link-foldout.ng.html","client.utils/state","client.models/bookmark"],function($,template,State,BookmarkModel){var component={template:template,scope:{alignTo:"=",options:"="},controller:["$scope","$timeout","$element",function($scope,$timeout,$element){function setInitState(){!$scope.link.url&&$scope.link.bookmark?($scope.toggleLink(!1),getBookmarks()):$scope.toggleLink(!0)}function getBookmarks(){BookmarkModel.getList().then(function(list){list.getLayout().then(function(layout){$scope.bookmarks=layout,highlightActiveBookmark()})})}function highlightActiveBookmark(){$scope.bookmarks.forEach(function(item){item.qInfo.qId===$scope.link.bookmark?item.active=!0:item.active=!1})}$scope.link=$scope.options.link,$scope.link.url&&"#"!==$scope.link.url||($scope.link.url=""),$scope.link.url=decodeURIComponent($scope.link.url);var orgUrl=$scope.link.url;$scope.alignTo=$scope.options.alignTo,$scope.linkActive=!0,$scope.closeFoldout=function(e){var url=encodeURI($scope.link.url),$node=$scope.link.$node;return $scope.closed=!0,url===orgUrl?void $scope.options.onCancel(e):void(url&&url.length>0&&-1===url.indexOf("javascript:")?(0!==url.search("[a-zA-Z0-9]+:")&&(url="http://"+url),$scope.options.onSave(e,url,$node,{cmd:"createLink",formatter:"link"})):$scope.options.onCancel(e))},$scope.onEnter=function(e){$scope.closeFoldout(e)},$scope.showRemove=!!orgUrl,$scope.removeLink=function(evt){$scope.options.onRemove(evt,$scope.link.$node)},$scope.inStorytelling=function(){return State.state===State.States.editstory},$scope.insertBookmark=function(e,id){$scope.options.onSave(e,id,$scope.link.$node,{cmd:"createLink",formatter:"bookmark"})},$scope.toggleLink=function(active){$scope.linkActive=active,active&&setTimeout(function(){$(".link-input").focus()})},$scope.exposedApi.closing=function(){$scope.closed||$scope.closeFoldout()},$scope.$on("$destroy",function(){$scope.closed||$scope.closeFoldout()}),setInitState(),$scope.$watch("linkActive",function(){$scope.linkActive&&getBookmarks()}),$timeout(function(){$element.find(".link-input").focus()})}]};return component}),define("general.services/media-tool/toolbar",["jquery","touche","text!./toolbar.ng.html","general.services/media-tool/theme","general.services/media-tool/text-selection","general.services/media-tool/link-foldout/link-foldout","general.services/media-library/media-library","general.services/show-service/show-service"],function($,Touche,template,theme,Selection,linkFoldoutComponent,MediaLibraryService,showService){var palette=theme.palette,fontSizes=theme.fontSizes,foldouts={fontSizes:!1,link:!1,mediaLibrary:!1,colorpicker:!1},buttons={color:!0,fontSize:!0,bold:!0,italic:!0,underline:!0,justifyLeft:!0,justifyCenter:!0,justifyRight:!0,link:!0,image:!0},component={template:template,scope:{textTool:"=",options:"=",alignTo:"="},controller:["$scope","$timeout",function($scope,$timeout){$scope.palette=palette,$scope.fontSizes=Object.keys(fontSizes),$scope.foldouts=foldouts,"all"===$scope.options.buttons?($scope.buttons=buttons,$scope.buttonGroup1=!0,$scope.buttonGroup2=!0):"object"==typeof $scope.options.buttons&&($scope.buttons=$scope.options.buttons,$scope.buttonGroup1=$scope.buttons.bold||$scope.buttons.italic||$scope.buttons.underline,$scope.buttonGroup2=$scope.buttons.justifyLeft||$scope.buttons.justifyCenter||$scope.buttons.justifyRight),$scope.exec=function(evt,cmd){evt.preventDefault(),evt.stopPropagation(),Touche.preventGestures(),0===cmd.indexOf("justify")?$scope.textTool.setJustify(cmd):$scope.haveSelection()&&$scope.textTool.setBIU(cmd)},$scope.setActiveFoldout=function(name){Object.keys($scope.foldouts).forEach(function(foldout){foldout===name&&$scope.foldouts[foldout]?$scope.foldouts[foldout]=!1:$scope.foldouts[foldout]=foldout===name})},$scope.shortFontSize=function(size){return fontSizes[size]||size},$scope.openMediaLibrary=function(){$scope.textTool.saveRange(),$scope.setActiveFoldout("mediaLibrary"),MediaLibraryService.show({onCancel:function(){$scope.setActiveFoldout(),$scope.textTool.restoreRange(),$scope.textTool.focus()},onConfirm:function(img,imgDef){$scope.setActiveFoldout(),$timeout(function(){imgDef?$scope.textTool.insertImage(img,imgDef):($scope.textTool.restoreRange(),$scope.textTool.focus())},100)},selectedFile:null})},$scope.closeColorpickerFoldout=function(evt){$(evt.target).closest("#qv-toolbar-colorpicker").length&&Touche.preventGestures(),$scope.setActiveFoldout()},$scope.closeFontsizeFoldout=function(evt){$(evt.target).closest("#qv-toolbar-fontsize").length&&Touche.preventGestures(),$scope.setActiveFoldout()};var linkFoldout=null;$scope.openLinkFoldout=function(){var $node,range=$scope.textTool.currentRange,link={};range&&($node=$(range.commonAncestorContainer).closest("a"),$node.length&&(link.url=$node.attr("href"),link.bookmark=$node.attr("data-bookmark-id"),link.$node=$node),$scope.textTool.saveRange(),linkFoldout=showService.show(linkFoldoutComponent,{options:{toolbarScope:$scope,alignTo:$("#qv-toolbar-link"),link:link,onSave:function(e,url,$node,props){var range;$node?(range=document.createRange(),range.setStartBefore($node[0]),range.setEndAfter($node[0]),$scope.textTool.insertLink(url,range,props)):$scope.textTool.insertLink(url,null,props),$scope.closeLinkFoldout(e)},onCancel:function(e){$scope.closeLinkFoldout(e)},onRemove:function(e,$node){if($node){var range=Selection.createRangeForElement($node[0]);$scope.textTool.removeLink(range)}$scope.closeLinkFoldout(e)}}}),$scope.setActiveFoldout("link"))},$scope.setFontSize=function(evt,size){evt.preventDefault(),$scope.setActiveFoldout(),$scope.textTool.setFontSize(size)},$scope.closeLinkFoldout=function(evt){evt&&$(evt.target).closest("#qv-toolbar-link").length&&Touche.preventGestures(),$scope.setActiveFoldout(),linkFoldout&&(linkFoldout.destroy(),linkFoldout=null)},$scope.linkDisabled=function(){var range=$scope.textTool.currentRange,isLink=!!$scope.textTool.states.link;return!isLink&&(!range||range.collapsed)},$scope.haveSelection=function(){var range=$scope.textTool.currentRange;return!(!range||range.collapsed)},Object.defineProperty($scope,"color",{get:function(){var unselectedColor=10;return $scope.haveSelection()?theme.palette.indexOf($scope.textTool.color):theme.palette[unselectedColor]},set:function(color){$scope.textTool.setColor(theme.palette[color])}}),$scope.exposedApi.closing=function(){linkFoldout&&linkFoldout.closing()},$scope.$on("$destroy",function(){$scope.setActiveFoldout(),linkFoldout&&(linkFoldout.destroy(),linkFoldout=null)}),$timeout(function(){$scope.textTool.refreshState()})}]};return component}),define("general.services/media-tool/command-queue",[],function(){var CommandQueue=function(){this.queue=[]};return CommandQueue.prototype.push=function(item){this.queue.push(item)},CommandQueue.prototype.execAll=function(fn){this.queue.forEach(fn)},CommandQueue.prototype.remove=function(cmd){var i,item,isRemoved=!1;for(i=this.queue.length-1;i>=0;i--)item=this.queue[i],item.cmd===cmd&&(isRemoved=!0,this.queue.splice(i,1));return isRemoved},CommandQueue.prototype.clear=function(){this.queue=[]},CommandQueue}),define("general.services/media-tool/markdown-html-parser",["util"],function(util){function compileRegex(){var charactersRegexes=Parser.formatters.map(function(formatter){return formatter.character?util.escapeRegExp(formatter.character):""}),prefixGroup="("+charactersRegexes.join("|")+"){1}\\[",suffixGroup="\\]\\(([^\\\\)]*(?:\\\\.[^\\\\)]*)*)\\)",parseGroup="((?![\\s\\S]*?"+prefixGroup+"[\\s\\S]*?)[\\s\\S]*?)";Parser.markdownRegex=new RegExp(prefixGroup+parseGroup+suffixGroup,"mg")}function execRegex(regex,str,callback){for(var m=regex.exec(str),matched=[];m&&!(matched.indexOf(m.index)>-1);)matched.push(m.index),str=callback(str,m),m=regex.exec(str);return matched.length?execRegex(regex,str,callback):str}function reverse(str){return str.split("").reverse().join("")}function getHTMLFormatters(){var formatters=Parser.formatters.filter(function(formatter){return!!formatter.toHTML});return formatters.sort(function(f1,f2){var p1=f1.toHTML.priority||0,p2=f2.toHTML.priority||0;return p2-p1}),formatters}function getMarkdownFormatters(){var formatters=Parser.formatters.filter(function(formatter){return!!formatter.toMarkdown});return formatters.sort(function(f1,f2){var p1=f1.toMarkdown.priority||0,p2=f2.toMarkdown.priority||0;return p2-p1}),formatters}var Parser={};return Parser.register=function(options){Parser.formatters.push(options),compileRegex()},Parser.toHTML=function(str,char){var formatters=char||getHTMLFormatters(),needLoopAgain=!1;return str=str.replace(/\$\&amp;/g,"&#36;&amp;"),str=execRegex(Parser.markdownRegex,str,function(str,m){return str.replace(m[0],function(){return Parser.getFormatter(m[1]).toHTML.callback(m[2],m[4])})}),formatters.forEach(function(formatter){formatter.toHTML&&formatter.toHTML.regex&&(formatter.toHTML.reverse&&(str=reverse(str)),str=execRegex(formatter.toHTML.regex,str,function(str,m){var matching=m.splice(0,1)[0];return needLoopAgain=!0,str.replace(matching,formatter.toHTML.callback.apply(formatter.toHTML.callback,m))}),formatter.toHTML.reverse&&(str=reverse(str)))}),needLoopAgain?Parser.toHTML(str,char):str},Parser.toMarkdown=function(str,char){var formatters=char||getMarkdownFormatters(),opt=new Option;return opt.innerHTML=str,formatters.forEach(function(formatter){formatter.toMarkdown.tags.forEach(function(tag){var nodes=Array.prototype.slice.call(opt.getElementsByTagName(tag.name)).reverse();nodes.forEach(function(node){var match,hasAttribute=!tag.attr.length||tag.attr.some(function(attr){return node.hasAttribute(attr)}),ignoreAttribute=tag.dontMatchAttr&&tag.dontMatchAttr.some(function(attr){return node.hasAttribute(attr)});if(match=formatter.toMarkdown.regex?hasAttribute&&!ignoreAttribute&&formatter.toMarkdown.regex.exec(node.outerHTML.trim()):[node.outerHTML.trim()],!ignoreAttribute&&hasAttribute&&match){var span=document.createElement("span");span.innerHTML=formatter.toMarkdown.callback.apply(node,match.slice(1)),node.parentNode.replaceChild(span,node)}})})}),opt.innerHTML.replace(/<(\/)?span>/g,"")},Parser.getFormatter=function(char){var i,formatters=Parser.formatters;for(i=0;i<formatters.length;i++)if(formatters[i].character===char)return formatters[i];return null},Parser.escapeMarkdown=function(markdown){return markdown.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\~/g,"\\~").replace(/\-/g,"\\-");
},Parser.unescapeMarkdown=function(markdown){return markdown.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\~/g,"~").replace(/\\\-/g,"-")},Parser.reset=function(){Parser.formatters=[],Parser.markdownRegex=null},Parser.reset(),Parser}),define("general.services/media-tool/formatters/font-color",["sirtrevor","core.utils/theme","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(SirTrevor,theme,Theme,Parser){var palette=theme.palette;return Parser.register({name:"font-color",character:"#",toHTML:{callback:function(text,colorIndex){return'<font color="'+palette[colorIndex]+'">'+text+"</font>"}},toMarkdown:{regex:/^<font(?: size="([0-7]|undefined)")? color="(#[a-f0-9]{3,6})"(?: size="([0-7]|undefined)")?.*?>([\s\S]+)<\/font>$/,callback:function(sizeBefore,color,sizeAfter,text){if(""===text)return"";var size=sizeBefore||sizeAfter;return null!==size&&void 0!==size&&(size=Theme.htmlSizeToMarkdownSize[size],text="%["+text+"]("+size+")"),-1===palette.indexOf(color)?text:"#["+text+"]("+palette.indexOf(color)+")"},tags:[{name:"font",attr:["color"]}]}}),SirTrevor.Formatter.extend({title:"color",cmd:"foreColor",text:"color",onClick:function(props){document.execCommand(props.cmd,!1,props.param)}})}),define("general.services/media-tool/formatters/font-size",["sirtrevor","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Theme,Parser){return Parser.register({name:"font-size",character:"%",toHTML:{callback:function(text,size){return"<font size='"+Theme.markdownSizeToHtmlSize[size]+"'>"+text+"</font>"}},toMarkdown:{regex:/^<font size="([0-7])".*?>([\s\S]+)<\/font>$/,callback:function(size,text){return""===text?"":(size>7&&(size=Theme.fontSizesPx[size]),null!==size&&void 0!==size?(size=Theme.htmlSizeToMarkdownSize[size],"%["+text+"]("+size+")"):text)},tags:[{name:"font",attr:["size"]}]}}),SirTrevor.Formatter.extend({title:"fontsize",cmd:"fontSize",text:"fontsize"})}),define("general.services/media-tool/feature-detection",["angular","general.services/media-tool/text-selection"],function(angular,Selection){function testCommand(cmd,val){var activeElem=document.activeElement;return document.body.appendChild(pseudoElem),pseudoElem.innerHTML="Feature detection.",pseudoElem.focus(),Selection.addRange(Selection.createRange(pseudoElem),!0),document.execCommand(cmd,!1,val),document.activeElement=activeElem,document.body.removeChild(pseudoElem),pseudoElem.innerHTML}var pseudoElem=angular.element("<div contenteditable style='position:absolute;top: -999999px;'>")[0],usesAlign=testCommand("justifyCenter").indexOf(" align=")>-1;return{usesAlign:usesAlign}}),define("general.services/media-tool/formatters/justify",["sirtrevor","qvangular","encoder","general.services/media-tool/markdown-html-parser","general.services/media-tool/feature-detection"],function(SirTrevor,qvangular,encoder,Parser,featureDetection){var usesAlign=featureDetection.usesAlign;Parser.register({name:"justify",character:"^",toHTML:{callback:function(text,align){return text||(text="&nbsp;"),usesAlign?'<div align="'+encoder.encodeForAttr2(align)+'">'+text+"</div>":'<div style="text-align: '+encoder.encodeForAttr2(align)+';">'+text+"</div>"}},toMarkdown:{regex:/^<(?:div|p) (?:style="text(?:\\)?-)?align(?:="|: )(left|center|right|justified)(?:"|;").*?>([\s\S]+)<\/(?:div|p)>$/,callback:function(align,text){return"^["+text+"]("+align+")"},tags:[{name:"div",attr:["align","style"]},{name:"p",attr:["align"]}]}});var JustifyLeft=SirTrevor.Formatter.extend({title:"align left",cmd:"justifyLeft",text:"left",onClick:function(){var style=qvangular.getService("qvMediaTool").getParagraph().el.style,oldDir=style.direction;"ltr"!==oldDir&&oldDir||(oldDir="ltr",style.direction="rtl"),document.execCommand("justifyLeft",!1),"ltr"===oldDir&&(style.direction="ltr")}}),JustifyCenter=SirTrevor.Formatter.extend({title:"align center",cmd:"justifyCenter",text:"center",onClick:function(){document.execCommand("justifyCenter",!1)}}),JustifyRight=SirTrevor.Formatter.extend({title:"align right",cmd:"justifyRight",text:"right",toMarkdown:function(html){return Parser.toMarkdown(html)},toHTML:function(markdown){return Parser.toHTML(markdown)},onClick:function(){var style=qvangular.getService("qvMediaTool").getParagraph().el.style,oldDir=style.direction;"rtl"===oldDir&&(style.direction="ltr"),document.execCommand("justifyRight",!1),"rtl"===oldDir&&(style.direction="rtl")}});return{Left:JustifyLeft,Right:JustifyRight,Center:JustifyCenter}}),define("general.services/media-tool/formatters/bold",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"bold",character:"**",toHTML:{priority:5,regex:/\*\*(?!\\)([\s\S]+?(?!\*\\))\*\*/g,callback:function(text){return">b/<"+text+">b<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:b|strong)>([\s\S]+)<\/(?:b|strong)>$/,callback:function(text){return""===text?"":"**"+text+"**"},tags:[{name:"b",attr:[]},{name:"strong",attr:[]}]}}),SirTrevor.Formatter.extend({title:"bold",cmd:"bold",text:"B",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag(["b","strong"])||opts.hasEndAncestorTag(["b","strong"]):opts.hasStartAncestorTag(["b","strong"])&&opts.hasEndAncestorTag(["b","strong"])},toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/italic",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"italic",character:"_",toHTML:{priority:5,regex:/\_(?!\\)([\s\S]+?(?!\_\\))\_/g,callback:function(text){return">i/<"+text+">i<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:i|em)>([\s\S]+)<\/(?:i|em)>$/,callback:function(text){return""===text?"":"_"+text+"_"},tags:[{name:"i",attr:[]},{name:"em",attr:[]}]}}),SirTrevor.Formatter.extend({title:"italic",cmd:"italic",text:"I",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag(["i","em"])||opts.hasEndAncestorTag(["i","em"]):opts.hasStartAncestorTag(["i","em"])&&opts.hasEndAncestorTag(["i","em"])},toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/underline",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"underline",character:"~",toHTML:{priority:5,regex:/~(?!\\)([\s\S]+?(?!~\\))~/g,callback:function(text){return">u/<"+text+">u<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<u>([\s\S]+)<\/u>$/,callback:function(text){return""===text?"":"~"+text+"~"},tags:[{name:"u",attr:[]}]}}),SirTrevor.Formatter.extend({title:"underline",cmd:"underline",text:"U",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag("u")||opts.hasEndAncestorTag("u"):opts.hasStartAncestorTag("u")&&opts.hasEndAncestorTag("u")},toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/bookmark",["jquery","qvangular","sirtrevor","encoder","general.services/media-tool/markdown-html-parser"],function($,qvangular,SirTrevor,encoder,Parser){function findAnchor(target,url){var mediaToolService=qvangular.getService("qvMediaTool"),ancestor=mediaToolService.getRange().commonAncestorContainer,elems=$(ancestor).find("a[href="+url+"]");return"#text"===ancestor.nodeName&&(elems="A"!==target.nodeName?$(target).find("a[href="+url+"]"):$(target)),0===elems.length&&(elems=$(ancestor).find("a:not([href])")),elems}return Parser.register({name:"bookmark",character:"$",toHTML:{callback:function(text,id){return'<a href="#" class="bookmark-link" data-bookmark-id="'+encoder.encodeForAttr2(id)+'">'+text+"</a>"}},toMarkdown:{regex:/^<a (?=.*data\\-bookmark\\-id="([^"]+)").*?>([\s\S]+?)<\/a>$/,callback:function(id,text){return"$["+text+"]("+id+")"},tags:[{name:"a",attr:["data\\-bookmark\\-id"]}]}}),SirTrevor.Formatter.extend({title:"bookmark",cmd:"createLink",text:"Bookmark",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag("a")||opts.hasEndAncestorTag("a"):opts.hasStartAncestorTag("a")&&opts.hasEndAncestorTag("a")},onClick:function(props){var url=props.url;$(document).on("DOMNodeInserted.bookmark",function(e){var elems=findAnchor(e.target,url);$.each(elems,function(i,elem){$(elem).hasClass("bookmark-link")||(elem.setAttribute("href","#"),elem.removeAttribute("_moz_dirty"),elem.className+="bookmark-link",elem.setAttribute("data-bookmark-id",url))}),setTimeout(function(){$(document).off("DOMNodeInserted.bookmark")},250)}),document.execCommand(this.cmd,!1,url)}})}),define("general.services/media-tool/formatters/link",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(SirTrevor,Parser){return Parser.register({name:"link",character:"@",toHTML:{callback:function(text,url){return 0===url.indexOf("javascript:")&&(url=""),0!==url.search("[a-zA-Z0-9]+:")&&(url="http://"+url),url=url.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24"),"<a href='"+decodeURI(url)+"' target='\\_blank'>"+text+"</a>"}},toMarkdown:{regex:/^<a href="(?!#)([^"]+)".*?>([\s\S]+?)<\/a>$/,callback:function(url,text){return"@["+text+"]("+url+")"},tags:[{name:"a",attr:["href"]}]}}),SirTrevor.Formatter.extend({title:"link",cmd:"createLink",text:"Link",isActive:function(opts){return opts.rangeCollapsed?opts.hasStartAncestorTag("a")||opts.hasEndAncestorTag("a"):opts.hasStartAncestorTag("a")&&opts.hasEndAncestorTag("a")},onClick:function(props){var url=props.url;document.execCommand(this.cmd,!1,url)}})}),define("general.services/media-tool/formatters/unlink",["sirtrevor"],function(SirTrevor){return SirTrevor.Formatter.extend({title:"unlink",cmd:"unlink",text:"Unlink",onClick:function(props){var url=props.url;document.execCommand(this.cmd,!1,url)}})}),define("lz-string",[],function(){var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(input){if(null==input)return"";var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=LZString.compress(input);i<2*input.length;)i%2==0?(chr1=input.charCodeAt(i/2)>>8,chr2=255&input.charCodeAt(i/2),chr3=i/2+1<input.length?input.charCodeAt(i/2+1)>>8:NaN):(chr1=255&input.charCodeAt((i-1)/2),(i+1)/2<input.length?(chr2=input.charCodeAt((i+1)/2)>>8,chr3=255&input.charCodeAt((i+1)/2)):chr2=chr3=NaN),i+=3,enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+LZString._keyStr.charAt(enc1)+LZString._keyStr.charAt(enc2)+LZString._keyStr.charAt(enc3)+LZString._keyStr.charAt(enc4);return output},decompressFromBase64:function(input){if(null==input)return"";var output_,chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",ol=0,i=0,f=LZString._f;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=LZString._keyStr.indexOf(input.charAt(i++)),enc2=LZString._keyStr.indexOf(input.charAt(i++)),enc3=LZString._keyStr.indexOf(input.charAt(i++)),enc4=LZString._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,ol%2==0?(output_=chr1<<8,64!=enc3&&(output+=f(output_|chr2)),64!=enc4&&(output_=chr3<<8)):(output+=f(output_|chr1),64!=enc3&&(output_=chr2<<8),64!=enc4&&(output+=f(output_|chr3))),ol+=3;return LZString.decompress(output)},compressToUTF16:function(input){if(null==input)return"";var i,c,current,output="",status=0,f=LZString._f;for(input=LZString.compress(input),i=0;i<input.length;i++)switch(c=input.charCodeAt(i),status++){case 0:output+=f((c>>1)+32),current=(1&c)<<14;break;case 1:output+=f(current+(c>>2)+32),current=(3&c)<<13;break;case 2:output+=f(current+(c>>3)+32),current=(7&c)<<12;break;case 3:output+=f(current+(c>>4)+32),current=(15&c)<<11;break;case 4:output+=f(current+(c>>5)+32),current=(31&c)<<10;break;case 5:output+=f(current+(c>>6)+32),current=(63&c)<<9;break;case 6:output+=f(current+(c>>7)+32),current=(127&c)<<8;break;case 7:output+=f(current+(c>>8)+32),current=(255&c)<<7;break;case 8:output+=f(current+(c>>9)+32),current=(511&c)<<6;break;case 9:output+=f(current+(c>>10)+32),current=(1023&c)<<5;break;case 10:output+=f(current+(c>>11)+32),current=(2047&c)<<4;break;case 11:output+=f(current+(c>>12)+32),current=(4095&c)<<3;break;case 12:output+=f(current+(c>>13)+32),current=(8191&c)<<2;break;case 13:output+=f(current+(c>>14)+32),current=(16383&c)<<1;break;case 14:output+=f(current+(c>>15)+32,(32767&c)+32),status=0}return output+f(current+32)},decompressFromUTF16:function(input){if(null==input)return"";for(var current,c,output="",status=0,i=0,f=LZString._f;i<input.length;){switch(c=input.charCodeAt(i)-32,status++){case 0:current=c<<1;break;case 1:output+=f(current|c>>14),current=(16383&c)<<2;break;case 2:output+=f(current|c>>13),current=(8191&c)<<3;break;case 3:output+=f(current|c>>12),current=(4095&c)<<4;break;case 4:output+=f(current|c>>11),current=(2047&c)<<5;break;case 5:output+=f(current|c>>10),current=(1023&c)<<6;break;case 6:output+=f(current|c>>9),current=(511&c)<<7;break;case 7:output+=f(current|c>>8),current=(255&c)<<8;break;case 8:output+=f(current|c>>7),current=(127&c)<<9;break;case 9:output+=f(current|c>>6),current=(63&c)<<10;break;case 10:output+=f(current|c>>5),current=(31&c)<<11;break;case 11:output+=f(current|c>>4),current=(15&c)<<12;break;case 12:output+=f(current|c>>3),current=(7&c)<<13;break;case 13:output+=f(current|c>>2),current=(3&c)<<14;break;case 14:output+=f(current|c>>1),current=(1&c)<<15;break;case 15:output+=f(current|c),status=0}i++}return LZString.decompress(output)},compress:function(uncompressed){if(null==uncompressed)return"";var i,value,ii,context_dictionary={},context_dictionaryToCreate={},context_c="",context_wc="",context_w="",context_enlargeIn=2,context_dictSize=3,context_numBits=2,context_data_string="",context_data_val=0,context_data_position=0,f=LZString._f;for(ii=0;ii<uncompressed.length;ii+=1)if(context_c=uncompressed.charAt(ii),Object.prototype.hasOwnProperty.call(context_dictionary,context_c)||(context_dictionary[context_c]=context_dictSize++,context_dictionaryToCreate[context_c]=!0),context_wc=context_w+context_c,Object.prototype.hasOwnProperty.call(context_dictionary,context_wc))context_w=context_wc;else{if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;context_numBits>i;i++)context_data_val<<=1,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;8>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;16>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1;context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),context_dictionary[context_wc]=context_dictSize++,context_w=String(context_c)}if(""!==context_w){if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;context_numBits>i;i++)context_data_val<<=1,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;8>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;16>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1}context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1;context_enlargeIn--,0==context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++)}for(value=2,i=0;context_numBits>i;i++)context_data_val=context_data_val<<1|1&value,15==context_data_position?(context_data_position=0,context_data_string+=f(context_data_val),context_data_val=0):context_data_position++,value>>=1;for(;;){if(context_data_val<<=1,15==context_data_position){context_data_string+=f(context_data_val);break}context_data_position++}return context_data_string},decompress:function(compressed){if(null==compressed)return"";if(""==compressed)return null;var next,i,w,bits,resb,maxpower,power,c,dictionary=[],enlargeIn=4,dictSize=4,numBits=3,entry="",result="",f=LZString._f,data={string:compressed,val:compressed.charCodeAt(0),position:32768,index:1};for(i=0;3>i;i+=1)dictionary[i]=i;for(bits=0,maxpower=Math.pow(2,2),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(next=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 2:return""}for(dictionary[3]=c,w=result=c;;){if(data.index>data.string.length)return"";for(bits=0,maxpower=Math.pow(2,numBits),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(c=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=32768,data.val=data.string.charCodeAt(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 2:return result}if(0==enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++),dictionary[c])entry=dictionary[c];else{if(c!==dictSize)return null;entry=w+w.charAt(0)}result+=entry,dictionary[dictSize++]=w+entry.charAt(0),enlargeIn--,w=entry,0==enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++)}}};return LZString}),define("objects.utils/animation-frame",[],function(){var sT=function(callback){return window.setTimeout(callback,1e3/60)},cT=function(id){return window.clearTimeout(id)},request=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||sT,cancel=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame||cT;return{request:request===sT?sT:request.bind(window),cancel:cancel===cT?cT:cancel.bind(window)}}),define("objects.views/charts/utils/matrix",["core.utils/class"],function(Class){var Matrix;return Matrix=Class.extend({init:function(){this._elements=[[1,0,0],[0,1,0],[0,0,1]],this._stack=[]},clone:function(){var mt=new Matrix;return mt.multiply(this._elements)},set:function(arr){return this._elements=arr,this},save:function(){return this._stack.push(this.elements),this},restore:function(){return this._stack.length&&(this._elements=this._stack.pop()),this},add:function(value){var i,j;for(i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)this._elements[i][j]+=value;return this},translate:function(x,y){return this.multiply([[1,0,x],[0,1,y],[0,0,1]]),this},rotate:function(radianAngle){var cos=Math.cos(-radianAngle),sin=Math.sin(-radianAngle);return this.multiply([[cos,sin,0],[-sin,cos,0],[0,0,1]]),this},skew:function(xAngle,yAngle){var tanX=Math.tan(xAngle),tanY=Math.tan(yAngle);return this.multiply([[1,tanX,0],[tanY,1,0],[0,0,1]]),this},multiply:function(value){var i,j,m,k;if(value instanceof Matrix&&(value=value._elements),Array.isArray(value)){for(m=[[0,0,0],[0,0,0],[0,0,0]],i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)for(k=0;3>k;k++)m[i][j]+=this._elements[i][k]*value[k][j];this._elements=m}else for(i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)this._elements[i][j]*=value;return this},scale:function(x,y){return(arguments.length<2||"undefined"==typeof y)&&(y=x),this.multiply([[x,0,0],[0,y,0],[0,0,1]]),this},determinant:function(){var a=this._elements[0][0],b=this._elements[0][1],c=this._elements[0][2],d=this._elements[1][0],e=this._elements[1][1],f=this._elements[1][2],g=this._elements[2][0],h=this._elements[2][1],i=this._elements[2][2],p=0;return p=a*e*i+b*f*g+c*d*h-c*e*g-b*d*i-a*f*h},invert:function(){var dt=this.determinant(),a=this._elements[0][0],b=this._elements[0][1],c=this._elements[0][2],d=this._elements[1][0],e=this._elements[1][1],f=this._elements[1][2],g=this._elements[2][0],h=this._elements[2][1],k=this._elements[2][2];return this._elements=[[e*k-f*h,c*h-b*k,b*f-c*e],[f*g-d*k,a*k-c*g,c*d-a*f],[d*h-e*g,g*b-a*h,a*e-b*d]],this.multiply(1/dt),this},transpose:function(){var m=Object.create(this._elements);return this._elements=[[m[0][0],m[1][0],m[2][0]],[m[0][1],m[1][1],m[2][1]],[m[0][2],m[1][2],m[2][2]]],this},identity:function(){return this._elements=[[1,0,0],[0,1,0],[0,0,1]],this},transformPoint:function(p){var i,j,vec=[p.x,p.y,1],e=this._elements,m=[0,0,0];for(i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)m[i]+=vec[j]*e[i][j];return{x:m[0],y:m[1]}},transformPoints:function(array){var vec,i,j,k,m,e=this._elements,ret=[];for(k=0;k<array.length;k++){for(vec=[array[k].x,array[k].y,1],m=[0,0,0],i=0;i<this._elements.length;i++)for(j=0;j<this._elements[i].length;j++)m[i]+=vec[j]*e[i][j];ret.push({x:m[0],y:m[1]})}return ret},toString:function(){var s="";return this._elements.forEach(function(row,i,arr){s+=row.join("	")+(i<arr.length?"\n":"")}),s}}),Object.defineProperties(Matrix.prototype,{elements:{get:function(){var m=this._elements;return[[m[0][0],m[0][1],m[0][2]],[m[1][0],m[1][1],m[1][2]],[m[2][0],m[2][1],m[2][2]]]}}}),Matrix}),define("objects.views/charts/utils/canvas-renderer",["core.utils/class","objects.utils/shapes/rect","objects.utils/animation-frame","jquery","./matrix","core.utils/deferred"],function(Class,Rect,aF,$,Matrix,Deferred){"use strict";function cacheFontHeight(font,height){fontCacheArr.length>100&&delete fontCacheObj[fontCacheArr.shift()],fontCacheArr.push(font),fontCacheObj[font]=height}function getFontHeightCanvas(g){if(g.font in fontCacheObj)return fontCacheObj[g.font];var height=1.5*g.measureText("m").width;return cacheFontHeight(g.font,height),height}function polygon(g,o,doFill,doStroke,close){var p,i,points=o.shape.points,num=points?points.length:0;if(g.beginPath(),p=points[0]){for(g.moveTo(p.x,p.y),i=1;num>i;i+=1)p=points[i],g.lineTo(p.x,p.y);close&&g.closePath(),doFill&&g.fill(),doStroke&&g.stroke()}}function lineWrap(text,width,maxNumLines){var n,testLine,testWidth,words=text?text.replace(/^\s*|\s*$/,"").split(" "):[],lines=[],line=words[0];if(!line)return[];for(n=1;n<words.length;n++)testLine=line+" "+words[n],testWidth=dummyContext.measureText(testLine).width,testWidth>width&&maxNumLines>lines.length?(lines.push(line),line=words[n]):line=testLine;return lines.length<maxNumLines?lines.push(line):lines[Math.max(0,lines.length-1)]?lines[Math.max(0,lines.length-1)]+=" "+line:lines[Math.max(0,lines.length-1)]=" "+line,lines}function wordWrap(lines,width,maxNumLines){if(void 0!==lines){var n,line,testLine,rest,isSplit,i,maxNumLetters,postFixedTestLine,ellipsis="",minWidthLetter=dummyContext.measureText("i").width;for(n=0;n<lines.length;n++){if(line=lines[n],maxNumLetters=Math.ceil(Math.max(0,width/minWidthLetter))+1,maxNumLetters<line.length?(rest=line.slice(maxNumLetters),line=line.slice(0,maxNumLetters)):rest="",testLine=line,line&&line.length>1&&dummyContext.measureText(line).width>width){for(isSplit=!1,i=line.length;i>0;i--)if(testLine=testLine.substring(0,testLine.length-1),postFixedTestLine=testLine+(maxNumLines>n+1?"-":ellipsis),dummyContext.measureText(postFixedTestLine).width<width){rest=line.substring(i-1)+rest,line=postFixedTestLine,isSplit=!0;break}isSplit||(rest=line.substring(1),line=line.substring(0,1)),isSplit||i||(rest="",line=ellipsis)}lines[n]=String(line).trim(),rest&&n<lines.length-1?lines[n+1]=rest+" "+lines[n+1]:rest&&lines.length<maxNumLines&&lines.push(rest)}}}function wrapText(text,maxNumLines,options){var lines,maxWidth=options.maxWidth;return isNaN(maxWidth)?[text]:(lines=maxNumLines>1?lineWrap(text,maxWidth,maxNumLines):[text],wordWrap(lines,maxWidth,maxNumLines),lines)}function renderTextAdvanced(g,options,isMeasuring){var lines,i,text=options.text,lineHeight=(options.lineHeight||1)*getFontHeightCanvas(g),maxWidth="maxWidth"in options?options.maxWidth:options.width,maxHeight="maxHeight"in options?options.maxHeight:options.height,width=options.width,height=options.height,maxNumLines=options.maxNumLines,x=options.x||0,y=options.y||0;if(dummyContext.font=g.font,isNaN(maxNumLines)&&(maxNumLines=maxHeight?Math.max(1,Math.floor(maxHeight/lineHeight)):1),lines=wrapText(text,maxNumLines,{maxWidth:maxWidth,maxHeight:maxHeight}),isMeasuring){for(width=0,i=0;i<lines.length;i++)width=Math.max(width,g.measureText(lines[i]).width);return{lines:lines,numLines:lines.length,width:width,height:lines.length*lineHeight,truncated:Array.isArray(/$/.exec(lines[lines.length-1]))}}for("middle"===g.textBaseline?"undefined"!=typeof height?y+=height/2:lines.length&&(y-=(lines.length-1)*lineHeight/2):"bottom"===g.textBaseline&&("undefined"!=typeof height?y+=height:y-=(lines.length-1)*lineHeight),"center"===g.textAlign&&width?x+=width/2:"right"===g.textAlign&&width&&(x+=width),i=0;i<lines.length;i++)g.fillText(lines[i],x,y),y+=lineHeight}function drawStuff(g,m,objects,scale,ancestorFill,ancestorStroke){var i,j,t,object,mt,gradient,o;for(i=0;i<objects.length;i+=1)if(object=objects[i]){if(g.save(),t=object.transform,t&&(m.save(),m.multiply(t)),"opacity"in object&&(g.globalAlpha=object.opacity),object.fill)if(object.fill.gradient){if(o=object.fill.gradient,isNaN(o.x0)||isNaN(o.y0)||isNaN(o.x1)||isNaN(o.y1))return;for(gradient=g.createLinearGradient(o.x0,o.y0,o.x1,o.y1),j=0;j<o.limits.length;j++)gradient.addColorStop(o.limits[j],o.colors[j]);g.fillStyle=gradient}else g.fillStyle=object.fill;if(object.stroke&&0!==object.strokeWidth){if(object.stroke.gradient){for(o=object.stroke.gradient,gradient=g.createLinearGradient(o.x0,o.y0,o.x1,o.y1),j=0;j<o.limits.length;j++)gradient.addColorStop(o.limits[j],o.colors[j]);g.strokeStyle=gradient}else g.strokeStyle=object.stroke;g.lineWidth=object.strokeWidth||1,scale>1&&"polygon"!==object.type&&(g.lineWidth/=scale)}object.lineJoin&&(g.lineJoin=object.lineJoin),object.lineCap&&(g.lineCap=object.lineCap),mt=m.elements,"group"===object.type?(m.save(),object.clip&&(g.beginPath(),g.setTransform(mt[0][0],mt[1][0],mt[0][1],mt[1][1],mt[0][2],mt[1][2]),g.rect(object.clip.rect.x,object.clip.rect.y,object.clip.rect.width,object.clip.rect.height),g.clip()),drawStuff(g,m,object.children,void 0,!!object.fill||!!ancestorFill,!!object.stroke&&0!==object.strokeWidth||!!ancestorStroke),m.restore()):object.type in render&&(g.setTransform(mt[0][0],mt[1][0],mt[0][1],mt[1][1],mt[0][2],mt[1][2]),render[object.type](g,object,!!object.fill||!!ancestorFill,!!object.stroke&&0!==object.strokeWidth||!!ancestorStroke)),g.globalAlpha=1,t&&m.restore(),g.restore()}}function applyViewBox(g,m,vb){if(vb){var mt=m.elements;switch(vb.type){case"clip":g.save(),g.setTransform(mt[0][0],mt[1][0],mt[0][1],mt[1][1],mt[0][2],mt[1][2]),g.beginPath(),g.rect(vb.rect.x,vb.rect.y,vb.rect.width,vb.rect.height),g.clip();break;case"slice":}}}function restoreViewBox(g,vb){vb&&g.restore()}var CanvasRenderer,render,_devicePixelRatio=window.devicePixelRatio||1,dummyCanvas=document.createElement("canvas"),dummyContext=dummyCanvas.getContext("2d"),dummySpan=document.createElement("span"),backingStoreRatio=dummyContext.webkitBackingStorePixelRatio||dummyContext.mozBackingStorePixelRatio||dummyContext.msBackingStorePixelRatio||dummyContext.oBackingStorePixelRatio||dummyContext.backingStorePixelRatio||1,devicePixelToBackingStoreRatio=_devicePixelRatio/backingStoreRatio,fontCacheObj={},fontCacheArr=[];dummySpan.innerText="Wj",render={rect:function(g,o,doFill,doStroke){doFill&&g.fillRect(o.shape.x||0,o.shape.y||0,o.shape.width||0,o.shape.height||0),doStroke&&g.strokeRect(o.shape.x||0,o.shape.y||0,o.shape.width||0,o.shape.height||0)},roundRect:function(g,o,doFill,doStroke){g.beginPath(),g.moveTo(o.shape.x+o.shape.radius,o.shape.y),g.lineTo(o.shape.x+o.shape.width-o.shape.radius,o.shape.y),g.quadraticCurveTo(o.shape.x+o.shape.width,o.shape.y,o.shape.x+o.shape.width,o.shape.y+o.shape.radius),g.lineTo(o.shape.x+o.shape.width,o.shape.y+o.shape.height-o.shape.radius),g.quadraticCurveTo(o.shape.x+o.shape.width,o.shape.y+o.shape.height,o.shape.x+o.shape.width-o.shape.radius,o.shape.y+o.shape.height),g.lineTo(o.shape.x+o.shape.radius,o.shape.y+o.shape.height),g.quadraticCurveTo(o.shape.x,o.shape.y+o.shape.height,o.shape.x,o.shape.y+o.shape.height-o.shape.radius),g.lineTo(o.shape.x,o.shape.y+o.shape.radius),g.quadraticCurveTo(o.shape.x,o.shape.y,o.shape.x+o.shape.radius,o.shape.y),g.closePath(),doFill&&g.fill(),doStroke&&g.stroke()},circle:function(g,o,doFill,doStroke){if(o.shape&&o.shape.r&&!o.shape.radius&&(o.shape.radius=o.shape.r),!(isNaN(o.shape.cx)||isNaN(o.shape.cy)||isNaN(o.shape.radius)||o.shape.radius<=0)){var m=.551784;g.save(),g.translate(o.shape.cx,o.shape.cy),g.scale(o.shape.radius,o.shape.radius),g.beginPath(),g.moveTo(1,0),g.bezierCurveTo(1,-m,m,-1,0,-1),g.bezierCurveTo(-m,-1,-1,-m,-1,0),g.bezierCurveTo(-1,m,-m,1,0,1),g.bezierCurveTo(m,1,1,m,1,0),g.closePath(),g.restore(),doFill&&g.fill(),doStroke&&g.stroke()}},line:function(g,o,doFill,doStroke){doStroke&&(g.beginPath(),
g.moveTo(o.shape.x1,o.shape.y1),g.lineTo(o.shape.x2,o.shape.y2),g.stroke())},polygon:function(g,o,doFill,doStroke){polygon(g,o,doFill,doStroke,!0)},polyline:function(g,o,doFill,doStroke){polygon(g,o,doFill,doStroke)},polygons:function(g,o,doFill,doStroke){var polygon,points,numPoints,p,i,j,polygons=o.shape.polygons,numPolygons=polygons?polygons.length:0;for(g.beginPath(),i=0;numPolygons>i;i++)if(polygon=polygons[i],points=polygon.points,numPoints=points?points.length:0,0!==numPoints&&(p=points[0]))for(g.moveTo(p.x,p.y),j=1;numPoints>j;j+=1)p=points[j],g.lineTo(p.x,p.y);doFill&&g.fill(),doStroke&&g.stroke()},multipolygon:function(g,o,doFill,doStroke){var polygons,numPolygons,points,numPoints,p,i,j,k,geopolygons=o.shape.geopolygons,numGeoPolygons=geopolygons?geopolygons.length:0;for(g.beginPath(),i=0;numGeoPolygons>i;i++)for(polygons=geopolygons[i].getPolygons(),numPolygons=polygons?polygons.length:0,j=0;numPolygons>j;j++)if(points=polygons[j].points,numPoints=points?points.length:0,0!==numPoints&&(p=points[0]))for(g.moveTo(p.x,p.y),k=1;numPoints>k;k+=1)p=points[k],g.lineTo(p.x,p.y);doFill&&g.fill(),doStroke&&g.stroke()},arc:function(g,o,doFill,doStroke){var arc=o.shape;g.beginPath(),arc.end-arc.start===2*Math.PI?(g.arc(arc.cx,arc.cy,arc.radius,arc.start+arc.radianOffset,arc.end+arc.radianOffset,!1),g.moveTo(arc.cx+arc.innerRadius*Math.cos(arc.radianOffset+arc.start),arc.cy+arc.innerRadius*Math.sin(arc.radianOffset+arc.start)),g.arc(arc.cx,arc.cy,arc.innerRadius,arc.end+arc.radianOffset,arc.start+arc.radianOffset,!0)):(g.arc(arc.cx,arc.cy,arc.radius,arc.start+arc.radianOffset,arc.end+arc.radianOffset,!1),isNaN(arc.innerRadius)||arc.innerRadius===arc.radius||(g.lineTo(arc.innerRadius*Math.cos(arc.end+arc.radianOffset)+arc.cx,arc.innerRadius*Math.sin(arc.end+arc.radianOffset)+arc.cy),arc.innerRadius>0&&g.arc(arc.cx,arc.cy,arc.innerRadius,arc.end+arc.radianOffset,arc.start+arc.radianOffset,!0),g.lineTo(arc.radius*Math.cos(arc.start+arc.radianOffset)+arc.cx,arc.radius*Math.sin(arc.start+arc.radianOffset)+arc.cy))),g.closePath(),doFill&&g.fill(),doStroke&&g.stroke()},text:function(g,o){o.shape&&o.shape.text&&o.fill&&(o.shape.font&&(g.font=o.shape.font),o.shape.align&&(g.textAlign=o.shape.align),o.shape.baseline&&(g.textBaseline=o.shape.baseline),renderTextAdvanced(g,o.shape))}},CanvasRenderer=Class.extend({init:function(container,options){var settings=$.extend(!0,{storeObjects:!1},options);this._container=container,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.width=0,this._canvas.height=0,settings.name&&this._canvas.setAttribute("name",settings.name),this.storeRenderedObjects=settings.storeObjects===!0,this.scaling={x:1,y:1},this._container&&this._container.appendChild(this._canvas),this.rect=new Rect(0,0,0,0),this.shapes=[],this._matrix=new Matrix},setDimensions:function(x,y,w,h){this.rect.set(x,y,w,h)},setDimensionsToContainerRatio:function(x,y){this.scaling={x:x,y:y},this.ratios={x:x,y:y}},show:function(){this._canvas.style.display=""},hide:function(){this._canvas.style.display="none"},clear:function(schedule){if(schedule){if(!this._clearTimer){var self=this;this._clearTimer=aF.request(function(){self._clearTimer&&(self._canvas.width=0,self._clearTimer=0)})}}else aF.cancel(this._clearTimer),this._clearTimer=0,this._canvas.width=0,this._canvas.height=0,$(this._canvas).data("shapes",null),this.shapes=[]},render:function(){aF.cancel(this._clearTimer),this._clearTimer=0,_devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=dummyContext.webkitBackingStorePixelRatio||dummyContext.mozBackingStorePixelRatio||dummyContext.msBackingStorePixelRatio||dummyContext.oBackingStorePixelRatio||dummyContext.backingStorePixelRatio||1,devicePixelToBackingStoreRatio=_devicePixelRatio/backingStoreRatio;var extendedWidth,extendedHeight,c=this._canvas,g=c.getContext("2d"),scale=devicePixelToBackingStoreRatio,m=this._matrix,shiftX=0,shiftY=0;return extendedHeight=this.rect.height*this.scaling.y,extendedWidth=this.rect.width*this.scaling.x,this.edgeBleed&&(shiftX=this.edgeBleed.left*this.scaling.x,shiftY=this.edgeBleed.top*this.scaling.y,extendedHeight+=this.edgeBleed.top*this.scaling.y+this.edgeBleed.bottom*this.scaling.y,extendedWidth+=this.edgeBleed.left*this.scaling.x+this.edgeBleed.right*this.scaling.x),extendedHeight=Math.round(extendedHeight),extendedWidth=Math.round(extendedWidth),this._canvas.style.left=-shiftX+"px",this._canvas.style.top=-shiftY+"px",c.width!==extendedWidth||c.height!==extendedHeight?(c.width=scale*extendedWidth,c.height=scale*extendedHeight,this._canvas.style.width=extendedWidth+"px",this._canvas.style.height=extendedHeight+"px"):g.clearRect(0,0,c.width,c.height),g.save(),m.save(),m.scale(scale*this.scaling.x,scale*this.scaling.y),m.translate(shiftX/this.scaling.x,shiftY/this.scaling.y),applyViewBox(g,m,this.viewBox),drawStuff(g,m,this.shapes,this.scaling.x),restoreViewBox(g,this.viewBox),g.restore(),m.restore(),this.storeRenderedObjects&&$(this._canvas).data("shapes",this.shapes),Deferred.resolve()},setFont:function(f){this._canvas.getContext("2d").font=f},getFontHeight:function(font){if("string"!=typeof font)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(font in fontCacheObj)return fontCacheObj[font];var height,g=this._canvas.getContext("2d");return g.font!==font?(g.save(),g.font=font,height=1.5*g.measureText("m").width,g.restore()):height=1.5*g.measureText("m").width,cacheFontHeight(font,height),height},getTextWidth:function(text,font){var width,g=this._canvas.getContext("2d");return g.save(),g.font=font,width=void 0!==text?Math.ceil(g.measureText(text).width):0,g.restore(),width},getEMFontWidth:function(font){var x,text="m",g=this._canvas.getContext("2d");return g.save(),g.font=font,x=g.measureText(text).width,g.restore(),x},getAverageLetterWidth:function(font){var x,latin="eeeaaaiinnoorsstldumcph";return dummyContext.font=font||this._canvas.getContext("2d").font,x=dummyContext.measureText(latin).width,x/latin.length},release:function(){$(this._canvas).data("shapes",null),this.shapes=[],this._container&&(this._container.removeChild(this._canvas),this._container=null)},applyTransform:function(){var i;for(i=0;i<this.shapes.length;i+=1)this.shapes[i].type in transforms&&transforms[this.shapes[i].type](this.shapes[i].shape,this.ratios)}});var transforms={rect:function(shape,o){shape.x*=o.x,shape.y*=o.y,shape.width*=o.x,shape.height*=o.y},line:function(shape,o){shape.x1*=o.x,shape.y1*=o.y,shape.x2*=o.x,shape.y2*=o.y},circle:function(shape,o){shape.cx*=o.x,shape.cy*=o.y,shape.r*=Math.min(o.x,o.y)},polygon:function(shape,o){var i,p;for(i=0;i<shape.points.length;i++)p=shape.points[i],p.x*=o.x,p.y*=o.y},text:function(shape,o){shape.x*=o.x,shape.y*=o.y,shape.width*=o.x,shape.height*=o.y}};return CanvasRenderer.getTextWidth=function(t){return Math.ceil(dummyContext.measureText(t).width)},CanvasRenderer.setFont=function(f){dummyContext.font=f},CanvasRenderer.getAverageLetterWidth=function(f){var x,latin="eeeaaaiinnoorsstldumcph";return dummyContext.font=f,x=dummyContext.measureText(latin).width,x/latin.length},CanvasRenderer.measureText=function(text,font){var h,w,metrics,g=dummyContext;return font&&g.font!==font&&(g.save(),g.font=font),w=g.measureText(text).width,font in fontCacheObj?h=fontCacheObj[font]:(h=1.5*g.measureText("m").width,cacheFontHeight(font,h)),font&&g.restore(),metrics=void 0!==text?{width:w,height:h}:{width:0,height:0}},CanvasRenderer.measureTextObject=function(o){return o.shape.font&&(dummyContext.font=o.shape.font),o.shape.align&&(dummyContext.textAlign=o.shape.align),o.shape.baseline&&(dummyContext.textBaseline=o.shape.baseline),renderTextAdvanced(dummyContext,o.shape,!0)},CanvasRenderer.getFontHeight=function(font){var height,g=dummyContext;return font in fontCacheObj?fontCacheObj[font]:(font&&(g.save(),g.font=font),height=1.5*g.measureText("m").width,cacheFontHeight(font,height),font&&g.restore(),height)},CanvasRenderer.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(dummyContext.webkitBackingStorePixelRatio||dummyContext.mozBackingStorePixelRatio||dummyContext.msBackingStorePixelRatio||dummyContext.oBackingStorePixelRatio||dummyContext.backingStorePixelRatio||1)},CanvasRenderer}),define("general.services/media-tool/formatters/measure",["qvangular","sirtrevor","util","translator","lz-string","general.utils/array-util","objects.views/charts/utils/canvas-renderer","general.services/media-tool/markdown-html-parser"],function(qvangular,SirTrevor,util,translator,lzString,arrayUtils,CanvasRenderer,Parser){function getMeasure(layout,id){var i,measureList=layout.qHyperCube.qMeasureInfo;for(i=0;i<measureList.length;++i)if(measureList[i].cId===id)return measureList[i];return null}function getMeasureValue(layout,id){var i,totalRow,measureList=layout.qHyperCube.qMeasureInfo;for(i=0;i<measureList.length;++i)if(measureList[i].cId===id)return totalRow=layout.qHyperCube.qGrandTotalRow[i],!totalRow||"NaN"===totalRow.qNum&&"-"===totalRow.qText?"":totalRow.qText;return""}function createTokenizedMeasure(text){var width,height=30,pixelRatio=CanvasRenderer.getDevicePixelToBackingStoreRatio(),maxWidth=150,iconAlpha=.35,font="13px 'QlikView Sans'",ctx=canvas.getContext("2d"),measuredText=CanvasRenderer.measureTextObject({shape:{text:text,width:112,font:font}});width=Math.ceil(Math.min(measuredText.width+50,maxWidth)),canvas.height=height*pixelRatio,canvas.width=width*pixelRatio,canvas.style.height=height+"px",canvas.style.width=width+"px",ctx.clearRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.scale(pixelRatio,pixelRatio),ctx.font="24px 'QlikView Icons'",ctx.globalAlpha=iconAlpha,ctx.fillText("3",2,height/2+8),ctx.globalAlpha=1,ctx.font="13px 'QlikView Sans'",ctx.fillText(measuredText.lines[0],32,height/2+5),ctx.restore();var dataUrl=canvas.toDataURL("image/png"),img=document.createElement("img");return img.setAttribute("src",dataUrl),img.setAttribute("class","tokenized-measure"),img.setAttribute("width",width+"px"),img.setAttribute("height",height+"px"),img}var canvas=document.createElement("canvas");return Parser.register({name:"measure",character:"=",toHTML:{callback:function(text,measureId){var layout,elem,mediaToolService=qvangular.getService("qvMediaTool");if(mediaToolService.isActive()){var options=mediaToolService.getOptions();if(!options.useMeasures)return"";var name,measureProps=options.propertyHandler.getMeasure(measureId),isInvalid=!1;if(measureProps){var measureLayout=getMeasure(options.layout,measureId);!measureLayout||measureLayout.qError?(isInvalid=!0,name=translator.get("Object.ErrorMessage.MissingMeasure")):name=measureLayout.qFallbackTitle}else name=options.copiedMeasures[measureId];var measureStr=JSON.stringify(measureProps);elem=createTokenizedMeasure(name),elem.setAttribute("data-measure-id",measureId),elem.setAttribute("data-measure-name",lzString.compressToBase64(name)),elem.setAttribute("data-measure",lzString.compressToBase64(measureStr)),elem.setAttribute("data-tid","ti-measure"),isInvalid&&elem.classList.add("invalid-measure")}else{layout=mediaToolService.getCurrentLayout();var measureValue=getMeasureValue(layout,measureId);if(null===measureValue)return"";elem=document.createElement("span"),elem.setAttribute("data-tid","ti-measure"),elem.appendChild(document.createTextNode(measureValue))}return elem.outerHTML}},toMarkdown:{callback:function(){var text="",measureId=this.getAttribute("data\\-measure\\-id"),options=qvangular.getService("qvMediaTool").getOptions();if(!getMeasure(options.layout,measureId)&&!options.copiedMeasures[measureId]){var measureStr=lzString.decompressFromBase64(this.getAttribute("data\\-measure")),measure=JSON.parse(measureStr);measureId=util.generateId(),measure.qDef.cId=measureId;var properties=options.properties;properties.qHyperCubeDef.qMeasures.push(measure),arrayUtils.indexAdded(properties.qHyperCubeDef.qInterColumnSortOrder,properties.qHyperCubeDef.qDimensions.length+properties.qHyperCubeDef.qMeasures.length-1);var measureName=lzString.decompressFromBase64(this.getAttribute("data\\-measure\\-name"));options.copiedMeasures[measureId]=measureName}return"=["+text+"]("+measureId+")"},tags:[{name:"img",attr:["data\\-measure\\-id"]}]}}),SirTrevor.Formatter.extend({title:"measure",cmd:"",text:"measure",toMarkdown:function(html){return html},toHTML:function(markdown){return markdown}})}),define("general.services/media-tool/formatters/image",["qvangular","sirtrevor","general.services/media-tool/markdown-html-parser","general.models/media-library"],function(qvangular,SirTrevor,Parser,MediaLibraryModel){function findImageUrl(id,images,isLayout){for(var prop=isLayout?"qStaticContentUrl":"qStaticContentUrlDef",i=0;i<images.length;i++)if(images[i].id===id)return images[i].url[prop].qUrl;return""}function escape(str){return str.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24")}return Parser.register({name:"image",character:"!",toHTML:{callback:function(id,imgUrl){var mediaToolService=qvangular.getService("qvMediaTool");if(mediaToolService.useImageArray()){var srcUrl=imgUrl,layout=mediaToolService.getCurrentLayout();imgUrl=findImageUrl(id,layout.images,!0),imgUrl=imgUrl?Parser.escapeMarkdown(imgUrl):srcUrl}return imgUrl=MediaLibraryModel.stripBasePath(imgUrl),imgUrl=escape(imgUrl),imgUrl=MediaLibraryModel.addBasePath(imgUrl),id||(id="image"),id=escape(id),"<img src='"+imgUrl+"' data-image-id='"+id+"'>"}},toMarkdown:{regex:/^<img.*?src="([^"]+)".*?>$/,callback:function(imgUrl){var imgId=this.getAttribute("data\\-image\\-id")||"";return imgId||(imgId=""),imgUrl=Parser.unescapeMarkdown(imgUrl),imgUrl=MediaLibraryModel.stripBasePath(imgUrl),imgUrl=Parser.escapeMarkdown(imgUrl),"!["+imgId+"]("+imgUrl+")"},tags:[{name:"img",attr:["src"],dontMatchAttr:["data\\-measure\\-id"]}]}}),SirTrevor.Formatter.extend({title:"image",cmd:"insertImage",text:"image",onClick:function(props){document.execCommand(props.cmd,!1,props.param)}})}),define("general.services/media-tool/formatters/paste",["general.services/media-tool/markdown-html-parser","util"],function(Parser,Util){var re_color=/color: rgb\\\((\d{1,3}), (\d{1,3}), (\d{1,3})/i,re_size=/font\\\-size: (\d+)px/i,re_underline=/text\\\-decoration: underline/i,re_bold=/font\\\-weight: bold/i;Parser.register({name:"paste",character:"`",toMarkdown:{regex:/^<(span|font|i|b|u) style="(.+?)">(.+?)<\/(?:span|font|i|b|u)>$/,callback:function(tag,style,content){var match;return re_color.test(style)&&(style=style.replace(/rgb\\\(/g,"rgb(").replace(/\\\);/g,");"),content=Parser.getFormatter("#").toMarkdown.callback(null,Util.normalizeToHex(style),null,content)),match=re_size.exec(style),match&&(content=Parser.getFormatter("%").toMarkdown.callback(match[1],content)),match=re_underline.exec(style),match&&(content=Parser.getFormatter("~").toMarkdown.callback(content)),match=re_bold.exec(style),match&&(content=Parser.getFormatter("**").toMarkdown.callback(content)),this.innerHTML=content,this.removeAttribute("style"),Parser.toMarkdown(this.outerHTML.trim())},tags:[{name:"span",attr:["style"]},{name:"font",attr:["style"]},{name:"b",attr:["style"]},{name:"i",attr:["style"]},{name:"u",attr:["style"]}]}}),Parser.register({name:"word",character:"``",toMarkdown:{regex:/^.+$/i,callback:function(){return" "},tags:[{name:"style",attr:[]},{name:"w:WordDocument",attr:[]}]}})}),define("general.services/media-tool/sir-trevor-extensions",["jquery","sirtrevor","underscore","general.services/media-tool/text-selection","general.services/media-tool/formatters/font-color","general.services/media-tool/formatters/font-size","general.services/media-tool/formatters/justify","general.services/media-tool/formatters/bold","general.services/media-tool/formatters/italic","general.services/media-tool/formatters/underline","general.services/media-tool/formatters/bookmark","general.services/media-tool/formatters/link","general.services/media-tool/formatters/unlink","general.services/media-tool/formatters/measure","general.services/media-tool/formatters/image","general.utils/string-limits","general.services/media-tool/formatters/paste"],function($,SirTrevor,_,Selection,FontColor,FontSize,Justify,Bold,Italic,Underline,Bookmark,Link,Unlink,Measure,MediaImage,StringLimits){function findTextNodes(elem){for(var nodes=[],i=0;i<elem.childNodes.length;i++)3===elem.childNodes[i].nodeType?nodes.push(elem.childNodes[i]):nodes.push.apply(nodes,findTextNodes(elem.childNodes[i]));return nodes}function capMaxLength(){var elem=this,overflow=elem.textContent.length-StringLimits.textImage;if(overflow>0){var range=Selection.getRange(),node=range.commonAncestorContainer;if(3===node.nodeType){var nodes=findTextNodes(document.activeElement),idx=nodes.indexOf(node);nodes=nodes.splice(0,idx+1),nodes.reverse().forEach(function(node){return 0>=overflow?!1:(node.nodeValue.length>overflow?(node.splitText(node.nodeValue.length-overflow),node.parentNode.removeChild(node.nextSibling),Selection.addRange(range,!0)):node.parentNode.removeChild(node),void(overflow-=node.nodeValue.length))})}}}delete SirTrevor.Formatters.Bold,delete SirTrevor.Formatters.Italic,delete SirTrevor.Formatters.Link,delete SirTrevor.Formatters.Unlink,SirTrevor.Formatters.bold=new Bold,SirTrevor.Formatters.italic=new Italic,SirTrevor.Formatters.underline=new Underline,SirTrevor.Formatters.justifyLeft=new Justify.Left,SirTrevor.Formatters.justifyCenter=new Justify.Center,SirTrevor.Formatters.justifyRight=new Justify.Right,SirTrevor.Formatters.fontSize=new FontSize,SirTrevor.Formatters.foreColor=new FontColor,SirTrevor.Formatters.bookmark=new Bookmark,SirTrevor.Formatters.link=new Link,SirTrevor.Formatters.unlink=new Unlink,SirTrevor.Formatters.measure=new Measure,SirTrevor.Formatters.insertImage=new MediaImage,SirTrevor.Blocks.Paragraph=function(){return SirTrevor.Block.extend({type:"paragraph",className:"st-block",icon_name:"paragraph",editorHTML:'<div class="st-required st-text-block" contenteditable="true" autocomplete="off" autocorrect="off"></div>',attributes:function(){return _.extend(SirTrevor.SimpleBlock.fn.attributes.call(this),{})},title:function(){return"Paragraph"},loadData:function(data){this.getTextBlock().html(SirTrevor.toHTML(data.text,this.type))},focus:function(){var contentEditableElement=this.getTextBlock();contentEditableElement.focus()},_initTextBlocks:function(){var block=this.getTextBlock();block.bind("input",capMaxLength).bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter)},_initUIComponents:function(){this.onFocus(),this.onBlur()},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready")},toData:function(){SirTrevor.log("toData for "+this.blockID);var block=this.getTextBlock();block.find("div,p").each(function(){var $this=$(this);$this.is("[align],[style]")||$this.attr("align","left")});var content=block.html();this.setData({text:SirTrevor.toMarkdown(content,this.type)})}})}(),SirTrevor.FloatingBlockControls=function(){return SirTrevor.FloatingBlockControls.extend({className:"",bound:[],initialize:function(){},attributes:function(){}})}(),SirTrevor.BlockControls=function(){return SirTrevor.FloatingBlockControls.extend({className:"",bound:[],html:"",initialize:function(){},hide:function(){},show:function(){},handleControlButtonClick:function(){}})}(),SirTrevor.FormatBar=function(){return SirTrevor.FormatBar.extend({className:"",initialize:function(){}})}()}),define("general.services/media-tool/media-tool",["jquery","underscore","util","general.utils/dom-util","qvangular","sirtrevor","text!./media-tool.ng.html","general.services/media-tool/theme","general.services/media-tool/toolbar","general.services/media-tool/command-queue","general.services/media-tool/text-selection","general.utils/string-limits","general.models/media-library","general.services/show-service/show-service","general.utils/support","./sir-trevor-extensions"],function($,_,util,DOMUtil,qvangular,SirTrevor,template,theme,toolbarComponent,CommandQueue,Selection,StringLimits,MediaLibraryModel,showService,support){var textToolComponent,$sce=qvangular.getService("$sce"),states={bold:!1,italic:!1,underline:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,link:!1,fontSize:!1};return textToolComponent={controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function showToolbar(){hideToolbar(),toolbar=showService.show(toolbarComponent,{textTool:$scope,options:$scope.options.toolbar||{},alignTo:$scope.options.alignTo||$element})}function hideToolbar(){toolbar&&($scope.editor.formatBar.$el.remove(),toolbar.destroy(),toolbar=null)}function buildActiveArgs(){function isEditorElement(element){return $scope.getEditorElement()===element}function hasAncestorTag(tags,ancestors){return Array.isArray(tags)?tags.some(function(tag){return hasAncestorTag(tag,ancestors)}):ancestors.some(function(ancestor){return ancestor.nodeName.toLowerCase()===tags})}var startAncestors=DOMUtil.getAncestorsUntil($scope.currentRange.startContainer,isEditorElement),endAncestors=DOMUtil.getAncestorsUntil($scope.currentRange.endContainer,isEditorElement);return{rangeCollapsed:$scope.currentRange.collapsed,hasStartAncestorTag:function(tags){return hasAncestorTag(tags,startAncestors)},hasEndAncestorTag:function(tags){return hasAncestorTag(tags,endAncestors)}}}function bindEvents(element){function setEditorState(refresh){$scope.saveRange(),$scope.cmdQueue.clear(),refresh&&$scope.refreshState()}var isTouch=!support.treatAsDesktop();$("body").on("mouseup.texttool",function(e){var target=$(e.target);target.closest(".qv-texttool-toolbar, .qui-immidiateContextual, .qv-modal-container-centered").length?DOMUtil.isInput(document.activeElement)||($scope.focus(),$scope.restoreRange()):isTouch||document.activeElement===$scope.getEditorElement()[0]&&$timeout(function(){setEditorState(!0),$scope.$apply()})}),isTouch&&$(document).on("selectionchange.texttool",function(){if(document.activeElement===$scope.getEditorElement()[0]){var newRange=Selection.getRange();newRange&&!Selection.rangeEquals(newRange,$scope.currentRange)&&setEditorState(!0)}}),element.on("qv-activate","img",function(e){var range=Selection.createRangeForElement(e.target);$scope.focus(),Selection.addRange(range,!0),$scope.saveRange(),$scope.refreshState()}),element.on("scroll",function(){$scope.saveScroll()}),element.on("keydown input",function(event){13!==event.which&&($scope.cmdQueue.execAll(function(item){$scope.execCustom(item)}),$scope.cmdQueue.clear()),$timeout(function(){$scope.$apply()})}),isTouch||element.on("keyup",function(){setEditorState(!0)})}var html=$sce.getTrustedHtml(SirTrevor.toHTML($scope.options.markdown));$scope.data={data:[{type:"paragraph",data:{text:SirTrevor.toMarkdown(html)}}]},$scope.states=states,$scope.cmdQueue=new CommandQueue;var toolbar;this.scope=function(){return $scope},this.closing=function(){toolbar&&(toolbar.closing(),toolbar.destroy())},$scope.getParagraph=function(){return $scope.editor.blocks[0]},$scope.getEditorElement=function(){return $scope.getParagraph().getTextBlock()},$scope.destroy=function(){hideToolbar(),$scope.destroyComponent()},$scope.calculateUsage=function(){var editorElement=$scope.getEditorElement()[0];$scope.usage=Math.min(100,(editorElement.textContent.length/StringLimits.textImage*100).toFixed(0)),$scope.showUsage=$scope.usage>=90},$scope.refreshState=function(){$scope.currentRange&&qvangular.$apply($scope,function(){$scope.calculateUsage();var args=buildActiveArgs();Object.keys($scope.states).forEach(function(state){$scope.states[state]=SirTrevor.Formatters[state].isActive(args)});var color;$scope.currentRange&&(color=document.queryCommandValue("foreColor"),"undefined"!=typeof color&&(color=util.normalizeToHex(color))),$scope.color=color||"#545352";var fontSize,element;$scope.currentRange&&(element=DOMUtil.getParentElementWithAttribute($scope.currentRange.endContainer,"font","size"),element&&(fontSize=element.getAttribute("size"),fontSize=theme.htmlSizeToMarkdownSize[fontSize],fontSize=theme.markdownSizeToHtmlSize[fontSize]),"undefined"===fontSize&&(fontSize=null)),$scope.fontSize=fontSize||3})},$scope.saveRange=function(){var range=Selection.getRange();range?$scope.currentRange=range.cloneRange():$scope.currentRange=null},$scope.restoreRange=function(){if($scope.currentRange){var range=Selection.getRange();range?range&&(Selection.rangeEquals(range,$scope.currentRange)||Selection.addRange($scope.currentRange,!0)):Selection.addRange($scope.currentRange,!0)}},$scope.saveScroll=function(){$scope.currentScrollTop=$scope.getEditorElement()[0].scrollTop},$scope.restoreScroll=function(){$scope.currentScrollTop&&($scope.getEditorElement()[0].scrollTop=$scope.currentScrollTop)},$scope.setJustify=function(cmd){$scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.execCustom({cmd:cmd}),$scope.saveRange(),$scope.refreshState()},$scope.setBIU=function(cmd){if($scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.states[cmd]=!$scope.states[cmd],$scope.currentRange.collapsed){var hasRemovedCmd=$scope.cmdQueue.remove(cmd);hasRemovedCmd||$scope.cmdQueue.push({cmd:cmd})}else $scope.execCustom({cmd:cmd});$scope.saveRange()},$scope.setFontSize=function(size){$scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.currentRange.collapsed?($scope.cmdQueue.remove("fontSize"),$scope.cmdQueue.push({param:size,cmd:"fontSize"})):$scope.execCustom({param:size,cmd:"fontSize"}),$scope.saveRange(),$scope.fontSize=size},$scope.setColor=function(color){$scope.focus(),$scope.restoreScroll(),$scope.restoreRange(),$scope.currentRange.collapsed?($scope.cmdQueue.remove("foreColor"),$scope.cmdQueue.push({param:color,cmd:"foreColor"})):$scope.execCustom({param:color,cmd:"foreColor"}),$scope.saveRange(),$scope.color=color},$scope.insertImage=function(img,imgDef){img=MediaLibraryModel.addBasePath(img),imgDef=MediaLibraryModel.addBasePath(imgDef),$scope.focus(),$scope.restoreRange(),$scope.execCustom({param:img,cmd:"insertImage"}),$scope.options.insertedImages.push({url:img,urlDef:imgDef}),$scope.saveRange(),$scope.focus()},$scope.insertLink=function(url,range,props){range?Selection.addRange(range,!0):$scope.restoreRange(),$scope.focus(),$scope.execCustom({url:url,cmd:props.cmd,formatter:props.formatter}),$scope.saveRange(),$scope.refreshState()},$scope.removeLink=function(range){Selection.addRange(range,!0),$scope.execCustom({cmd:"unlink",range:range}),$scope.saveRange(),$scope.refreshState(),$scope.focus()},$scope.execCustom=function(props){var format=SirTrevor.Formatters[props.formatter||props.cmd];_.isUndefined(format)||(!_.isUndefined(format.onClick)&&_.isFunction(format.onClick)?format.onClick(props):document.execCommand(props.cmd,!1,props.param))},$scope.focus=function(){$scope.getEditorElement().focus()},$timeout(function(){$scope.editor=new SirTrevor.Editor({el:$element.find("textarea"),defaultType:"paragraph",onEditorRender:function(){var textBlock=$element.find(".st-text-block");bindEvents(textBlock),"function"==typeof $scope.options.onOpen&&$scope.options.onOpen($scope),$scope.options.toolbar&&showToolbar(),$timeout(function(){$scope.refreshState()})}})}),$scope.$on("$destroy",function(){hideToolbar(),$("body").off(".texttool"),$(document).off(".texttool")})}],template:template}}),define("general.services/media-tool/media-tool-service",["qvangular","sirtrevor","general.services/media-tool/media-tool"],function(qvangular,SirTrevor,textToolComponent){var $sce=qvangular.getService("$sce"),mediaToolService=qvangular.service("qvMediaTool",[function(){var editorComponent,currentLayout,useImageArray,opts,service={};return service.show=function(element,options){opts=options,editorComponent=element.showComponent(textToolComponent,{options:options})},service.hide=function(){editorComponent&&(editorComponent.scope().destroy(),editorComponent=null,opts=null)},service.closing=function(){editorComponent&&editorComponent.closing()},service.isActive=function(){return opts&&"function"==typeof opts.isActive?opts.isActive():!!editorComponent},service.getCurrentLayout=function(){return currentLayout},service.useImageArray=function(){return useImageArray},service.getOptions=function(){return opts||{}},service.getMarkdown=function(){var paragraphData,paragraph=editorComponent.scope().getParagraph();return paragraph&&(paragraphData=paragraph.saveAndGetData())?paragraphData.text:null},service.hasContent=function(markdown){return markdown&&"^[\n](left)"!==markdown},service.getParagraph=function(){return editorComponent.scope().getParagraph()},service.getEditorElement=function(){return editorComponent.scope().getEditorElement()},service.getRange=function(){return editorComponent.scope().currentRange},service.toHTML=function(markdown,layout,shouldUseImageArray){if(currentLayout=layout,useImageArray=shouldUseImageArray,markdown){var html=SirTrevor.toHTML(markdown);return markdown=SirTrevor.toMarkdown(html),$sce.getTrustedHtml(SirTrevor.toHTML(markdown))}return""},service.toMarkdown=function(html){return html?SirTrevor.toMarkdown(html):""},service}]);return mediaToolService}),define("dev-hub.lib/object-lister",["jquery","core.utils/deferred","objects.utils/type-loader","general.utils/visualizations","general.services/media-tool/media-tool-service"],function($,Deferred,TypeLoader,visualizations,mediaToolService){"use strict";function listVisualizations(app){var defer=new Deferred;return TypeLoader.load().then(function(){var objects=[];app.getList("masterobject",function(reply){reply.qAppObjectList.qItems.forEach(function(value){var is_in_list=objects.filter(function(o){return value.qInfo.qId===o.id});if(!(is_in_list.length>0)){var row=value;row.type=value.qData.visualization,row.id=value.qInfo.qId,row.title=value.qMeta&&value.qMeta.title?value.qMeta.title:"[no title]",row.tags=value.qData.tags,row.appid=app.id;var libinfo=visualizations.getLibraryInfo(value.qData.visualization);row.icon=libinfo?libinfo.icon:"toolbar-help",objects.unshift(row)}})}),app.getList("sheet",function(reply){var sheets=reply.qAppObjectList.qItems.sort(function(a,b){return a.qData.rank-b.qData.rank});sheets.forEach(function(value){objects.push({id:value.qInfo.qId,title:value.qData.title,type:"sheet"}),value.qData.cells.forEach(function(v){var row=v;row.id=v.name,row.appid=app.id,objects.push(row),app.getObjectProperties(row.id).then(function(val){var properties=val.properties,libinfo=visualizations.getLibraryInfo(properties.qInfo.qType);row.icon=libinfo?row.icon=libinfo.icon:row.icon="toolbar-help",properties.title&&properties.title.trim&&properties.title.trim().length>0?row.title=properties.title:properties.markdown&&properties.markdown.trim&&properties.markdown.trim().length>0?app.getObject(row.id).then(function(model){row.title=$("<div>"+mediaToolService.toHTML(model.layout.markdown,model.layout)+"</div>").text()}):"object"==typeof properties.title?app.getObject(row.id).then(function(model){row.title=model.layout.title}):properties.title?row.title="[no title]":app.getObject(row.id).then(function(model){!model.layout.title||model.layout.title&&""===model.layout.title.trim()?row.title="[no title]":row.title=model.layout.title})})})}),defer.resolve(objects)})}),defer.promise}function listSnapshots(app){var defer=new Deferred;return TypeLoader.load().then(function(){var objects=[];app.getList("SnapshotList",function(reply){reply.qBookmarkList.qItems.forEach(function(value){var row={};row.id=value.qInfo.qId,row.title=value.qData.libraryTitle||value.qData.title,row.timestamp=value.qData.timestamp,row.appid=app.id;var libinfo=visualizations.getLibraryInfo(value.qData.visualizationType);libinfo&&(row.icon=libinfo.icon),objects.push(row)}),defer.resolve(objects)})}),defer.promise}return{listVisualizations:listVisualizations,listSnapshots:listSnapshots}}),define("dev-hub.lib/assets-files-utils",["qvangular","underscore","core.utils/deferred","translator","dev-hub.lib/utils","general.services/content-api/content-api"],function(qvangular,_,Deferred,translator,devHubUtils){
"use strict";function createFileObject(fullFileName,content){var ext=_getFileExtension(fullFileName),fileDefaults=_getFileDefaults(ext);return{fileName:fullFileName,extension:ext,content:content||fileDefaults.defaultContent,contentType:null,mode:fileDefaults.editorMode,lastModified:null,isDirty:!0}}function isImage(fileExtension){return["gif","png","jpeg","jpg"].indexOf(fileExtension)>-1}function saveFilesToRepo(assets){var defer=new Deferred,promises=[];return assets.isDirty()&&assets.files.forEach(function(file){file.isDirty&&promises.push(saveFileInRepo(assets.extensionUniqueName,file))}),Deferred.all(promises).then(function(){defer.resolve(assets)}),defer.promise}function isFileInAssets(fileName,assets){var res=assets.files.filter(function(file){return file.fileName.toLowerCase()===fileName.toLowerCase()});return res.length>0}function removeFileFromAssets(fileObject,assets){var defer=new Deferred;return defer.resolve(assets.files.splice(assets.files.indexOf(fileObject),1)),defer.promise}function _loadFileFromRepo(extensionUniqueName,fileName){return isImage(_getFileExtension(fileName))?contentApi.request({method:"GET",url:"/extensions/"+extensionUniqueName+"/"+fileName,cache:!1,responseType:"blob"}):contentApi.request({method:"GET",url:"/extensions/"+extensionUniqueName+"/"+fileName,cache:!1,transformResponse:function(data){return data}})}function _isFileInRepo(extensionUniqueName,fileName){var defer=new Deferred;return contentApi.request({method:"GET",url:"/extensions/"+extensionUniqueName+"/"+fileName}).success(function(){defer.resolve(!0)}).error(function(){defer.resolve(!1)}),defer.promise}function deleteExtensionFromRepo(extensionUniqueName){var defer=new Deferred;return contentApi.request({method:"DELETE",url:"/qrs/extension/name/"+extensionUniqueName}).success(function(){defer.resolve()}).error(function(err){defer.reject({errMsg:translator.get("Devhub.ErrorExtensionDelete",extensionUniqueName),errObject:err})}),defer.promise}function createExtensionInRepo(definition){var defer=new Deferred;return contentApi.request({method:"POST",url:"/qrs/extension/name/"+definition.name,data:JSON.stringify(definition,null,"	")}).success(function(){defer.resolve(definition)}).error(function(err){defer.reject({errName:"errCreateExtension",errMessage:translator.get("Devhub.ErrorCreateExtension"),errObject:err})}),defer.promise}function loadFile(extensionUniqueName,fileName){var ext=_getFileExtension(fileName),fileDefaults=_getFileDefaults(ext),defer=new Deferred;return _loadFileFromRepo(extensionUniqueName,fileName).success(function(data,status,headers){defer.resolve({success:!0,file:{fileName:fileName,extension:ext,content:data,contentType:headers()["content-type"],mode:fileDefaults.editorMode,lastModified:headers()["last-modified"],isDirty:!1}})}).error(function(err){defer.resolve({success:!1,errObject:err,file:{fileName:fileName,extension:ext,content:fileDefaults.defaultContent,contentType:null,mode:fileDefaults.editorMode,lastModified:null,isDirty:!0,loadingErr:err}})}),defer.promise}function readLocalFile(file){var defer=new Deferred,reader=new FileReader;return reader.onload=function(e){defer.resolve(createFileObject(file.name,e.target.result))},reader.onerror=function(e){defer.reject({errName:"errFileReader",errMessage:translator.get("Devhub.ErrorReadingLocalFile"),errObject:e})},"image/"===file.type.substr(0,6)?reader.readAsDataURL(file):reader.readAsText(file),defer.promise}function getExtensionFileObjectsFromRepo(extensionUniqueName){var promises=[],defer=new Deferred;return _loadFileFromRepo(extensionUniqueName,"wbfolder.wbl").success(function(data){if(data.length>0){var fileList=_getFilesFromWbFolderContent(data);fileList.forEach(function(file){promises.push(loadFile(extensionUniqueName,file))}),Deferred.all(promises).then(function(reply){var fileList=reply.map(function(replyObj){return replyObj.file});defer.resolve(fileList)})["catch"](function(err){defer.reject({errName:"loadFilesFromRepo",errMessage:translator.get("Devhub.ErrorLoadingFilesFromRepo",extensionUniqueName),errObject:err})})}else defer.reject({errName:"wbFolderEmpty",errMessage:translator.get("Devhub.wbFolderEmpty",extensionUniqueName)})}).error(function(){defer.reject({errName:"wbFolderMissing",errMessage:translator.get("Devhub.wbFolderMissing",extensionUniqueName)})}),defer.promise}function checkWbFolder(extensionUniqueName){var defer=new Deferred;return _loadFileFromRepo(extensionUniqueName,"wbfolder.wbl").success(function(){defer.resolve()}).error(function(){defer.reject()}),defer.promise}function _getFileDefaults(fileExtension){switch(fileExtension.toLowerCase()){case"html":return{defaultContent:"<div></div>",editorMode:"htmlmixed"};case"js":return{defaultContent:"// JavaScript\r\n",editorMode:"javascript"};case"qext":case"json":return{defaultContent:"{\r\n\r\n}",editorMode:"javascript"};case"css":return{defaultContent:"/* CSS */\r\n",editorMode:"css"};case"gif":case"png":case"jpg":case"jpeg":return{defaultContent:void 0,editorMode:void 0};default:return{defaultContent:"",editorMode:"javascript"}}}function duplicateExtension(srcName,destName){var defer=new Deferred;return getExtensionFileObjectsFromRepo(srcName).then(function(sourceObjects){var destObjects=templateReplacements(sourceObjects,srcName,destName);destObjects.push(createFileObject("wbfolder.wbl",genWbFolderContent(destObjects)));var extType=getExtensionType(sourceObjects);if(extType){destObjects.forEach(function(file){file.isDirty=!0});var saveFileToRepoArgs={extensionUniqueName:destName,files:destObjects,type:extType,isDirty:function(){return!0}};createExtensionInRepo({name:destName,type:extType}).then(function(){saveFilesToRepo(saveFileToRepoArgs).then(function(savedAssets){defer.resolve(savedAssets)})["catch"](function(errSave){defer.reject({errName:"errDuplicateExtensionTasks",errMessage:translator.get("Devhub.ErrorCopyingExtension"),errObject:errSave})})})["catch"](function(errCreate){defer.reject({errName:"errDuplicateExtensionTasks",errMessage:translator.get("Devhub.ErrorCopyingExtension"),errObject:errCreate})})}})["catch"](function(errObj){defer.reject(errObj)}),defer.promise}function templateReplacements(fileObjects,srcName,destName){return fileObjects.forEach(function(fileObject){if(fileObject.fileName=fileObject.fileName.replace(srcName,destName),fileObject.content&&fileObject.content.length>0&&(fileObject.content.indexOf("${name}")>-1&&(fileObject.content=fileObject.content.replace(/\${name}/g,destName)),["js","css","html","htm","json"].indexOf(fileObject.extension)>-1&&(fileObject.content=fileObject.content.replace(new RegExp(srcName,"g"),destName)),"qext"===fileObject.extension)){var d=JSON.parse(fileObject.content);d.name=destName,d.type=d.type.replace("-template",""),fileObject.content=JSON.stringify(d,null,"	")}}),fileObjects}function getExtensionType(fileObjects){var qextFile=_.findWhere(fileObjects,{extension:"qext"});return qextFile&&qextFile.content?JSON.parse(qextFile.content).type:void 0}function _getFilesFromWbFolderContent(wbFolderContent){var fileList=wbFolderContent.replace(/[\r\n]/g,"").split(";");return fileList.filter(function(filename){return""!==filename.trim()})}function getExtensionFileListFromRepo(extensionUniqueName){var defer=new Deferred;return _loadFileFromRepo(extensionUniqueName,"wbfolder.wbl").success(function(data){if(data.length>0){var fileList=_getFilesFromWbFolderContent(data),qextFiles=fileList.filter(function(fileName){return"qext"===_getFileExtension(fileName)});1===qextFiles.length?defer.resolve(fileList):defer.reject({errName:"moreThanOneQEXT",errMessage:translator.get("Devhub.ErrorMoreThanOneQEXT")})}}).error(function(){defer.reject({errName:"wbFolderMissing",errMessage:translator.get("Devhub.wbFolderMissing",extensionUniqueName)})}),defer.promise}function saveFilesToWbFolder(extensionUniqueName,files){return saveFileInRepo(extensionUniqueName,createFileObject("wbfolder.wbl",genWbFolderContent(files)))}function genWbFolderContent(files){return files.map(function(file){return file.fileName}).join(";\r\n")}function saveFileInRepo(extensionUniqueName,fileObject){var defer=new Deferred;return contentApi.request({method:"POST",url:"/qrs/extension/"+extensionUniqueName+"/uploadfile?externalpath="+fileObject.fileName+"&overwrite=true",data:fileObject.content}).success(function(){_loadFileFromRepo(extensionUniqueName,fileObject.fileName).success(function(content,status,headers){fileObject.lastModified=headers("last-modified"),fileObject.isDirty=!1,defer.resolve(fileObject)})["catch"](function(err){defer.reject({errName:"LoadFileFromQRSErr",errMessage:translator.get("Devhub.LoadFileFromQRSErr",fileObject.fileName),errObject:err})})}).error(function(err){defer.reject({errName:"ExtensionUploadToQRSErr",errMessage:translator.get("Devhub.ExtensionUploadToQRSErr",fileObject.fileName),errObject:err})}),defer.promise}function getExtensionsFromRepo(isGrouped){var defer=new Deferred;return contentApi.getExtensions().then(function(list){isGrouped===!0?defer.resolve(groupExtensionList(list)):defer.resolve(list)}),defer.promise}function _getFileExtension(fullFileName){return fullFileName.substr(fullFileName.lastIndexOf(".")+1).toLowerCase()}function _getFileName(fullFileName){return fullFileName.substr(0,fullFileName.lastIndexOf("."))}var contentApi=qvangular.getService("$contentApi"),init=function(){translator.setup("en").then(function(){})},addNewFile=function(fileName,assets){var defer=new Deferred;if(isFileInAssets(fileName,assets))defer.reject({errorMsg:translator.get("Devhub.FileAlreadyExists",fileName)});else{var validFileName=isValidFileName(fileName,!0);validFileName.success===!0?_isFileInRepo(assets.extensionUniqueName,fileName).then(function(result){result===!0?defer.reject({errorMsg:translator.get("Devhub.FileAlreadyExists",fileName)}):saveFileInRepo(assets.extensionUniqueName,createFileObject(fileName,null)).then(function(file){file.isDirty=!0,assets.files.push(file),saveFilesToWbFolder(assets.extensionUniqueName,assets.files).then(function(){defer.resolve(assets)})["catch"](function(err){defer.reject(err)})})["catch"](function(reply){defer.reject(reply)})}):defer.reject({errorMsg:validFileName.errorMsg})}return defer.promise},deleteFile=function(fileObj,assets){var defer=new Deferred,assetsClone=_.extend({},assets);return assetsClone.files=assets.files.slice(),removeFileFromAssets(fileObj,assetsClone),Deferred.all({deleteFileFromRepo:deleteFileFromRepo(assets.extensionUniqueName,fileObj.fileName),saveFilesToWbFolder:saveFilesToWbFolder(assets.extensionUniqueName,assetsClone.files),removeFileFromAssets:removeFileFromAssets(fileObj,assets)}).then(function(args){defer.resolve(args.removeFileFromAssets)})["catch"](function(err){defer.reject(err)}),defer.promise},deleteFileFromRepo=function(extensionUniqueName,fileName){var defer=new Deferred;return _isFileInRepo(extensionUniqueName,fileName).then(function(isInRepo){isInRepo?contentApi.request({method:"DELETE",url:"/qrs/extension/"+extensionUniqueName+"/deletecontent?externalpath="+fileName}).success(function(){defer.resolve()}).error(function(err){defer.reject(err)}):defer.resolve()}),defer.promise},importFromLocal=function(selectedFile,assets){var defer=new Deferred;return readLocalFile(selectedFile).then(function(fileObj){if(isFileInAssets(fileObj.fileName,assets))defer.reject({errMessage:translator.get("Devhub.ErrorImportDuplicateFile",fileObj.fileName)});else{var newAssets=_.extend({},assets);newAssets.files=assets.files.slice(),newAssets.files.push(fileObj),Deferred.all({saveFileInRepo:saveFileInRepo(assets.extensionUniqueName,fileObj),saveFilesToWbFolder:saveFilesToWbFolder(assets.extensionUniqueName,newAssets.files)}).then(function(){defer.resolve(newAssets)})["catch"](function(err){defer.reject(err)})}})["catch"](function(err){defer.reject({errName:"errorReadLocalFile",errMessage:translator.get("Devhub.ErrorReadingLocalFile"),errObject:err})}),defer.promise},isValidFileName=function(filename,validateFileExtension){if(validateFileExtension){if(/^[\.0-9a-zA-Z_-]+\..{2,4}$/.test(filename)){var ext=_getFileExtension(filename),xix=["js","css","html","json"].indexOf(ext);return-1===xix?{success:!1,errorMsg:translator.get("Devhub.ErrorAllowedFileTypes")}:{success:!0}}return{success:!1,errorMsg:translator.get("Devhub.InvalidFileName")}}var valid=filename&&/^[\.0-9a-zA-Z_-]+$/.test(filename);return{success:valid,errorMsg:valid?void 0:translator.get("Devhub.InvalidFileName")}},groupExtensionList=function(list){var groupedList={extensionList:[],templateList:[]};for(var id in list){var analyze=/^(.*)\-template$/.exec(list[id].type);if(analyze){var extType=analyze[1],groups=groupedList.templateList.filter(function(tmpl){return tmpl.type===extType});if(groups.length>0)groups[0].items.push({id:id,name:list[id].name||id});else{var group={type:extType,items:[{id:id,name:list[id].name||id}]};groupedList.templateList.push(group)}}else groupedList.extensionList.push({id:id,qext:list[id],src:list[id].preview&&-1!==list[id].preview.indexOf(".")?devHubUtils.getPrefix()+"extensions/"+id+"/"+list[id].preview:""})}return groupedList};return{init:init,isValidFileName:isValidFileName,isFileInAssets:isFileInAssets,isImage:isImage,checkWbFolder:checkWbFolder,createFileObject:createFileObject,getExtensionFileObjectsFromRepo:getExtensionFileObjectsFromRepo,getExtensionFileListFromRepo:getExtensionFileListFromRepo,saveFileInRepo:saveFileInRepo,saveFilesToRepo:saveFilesToRepo,removeFileFromAssets:removeFileFromAssets,addNewFile:addNewFile,getExtensionsFromRepo:getExtensionsFromRepo,deleteExtensionFromRepo:deleteExtensionFromRepo,deleteFileFromRepo:deleteFileFromRepo,deleteFile:deleteFile,importFromLocal:importFromLocal,duplicateExtension:duplicateExtension,saveFilesToWbFolder:saveFilesToWbFolder,readLocalFile:readLocalFile,_loadFileFromRepo:_loadFileFromRepo,__onlytest__:{_getFileName:_getFileName,_getFileExtension:_getFileExtension,_getFileDefaults:_getFileDefaults,_getFilesFromWbFolderContent:_getFilesFromWbFolderContent,_isFileInRepo:_isFileInRepo}}}),define("text!dev-hub.dialogs/new-extension/new-extension.ng.html",[],function(){return'<div class="modal-container qui-modalbackground-centered">\r\n	<div id="new-extension-dialog" class="dev-hub-dialog qui-delayedModal modal-frame">\r\n		<div class="wrapper">\r\n			<header class="dm-header" q-translation="Devhub.CreateNew"></header>\r\n			<main class="dm-main">\r\n				<div>\r\n					<div class="metadata-item">\r\n						<label class="qv-taglabel" q-translation="Devhub.Name"></label>:\r\n						<input class="qui-input" ng-model="name" value="" type="text">\r\n					</div>\r\n					<div class="metadata-item" ng-show="templates">\r\n						<label class="qv-taglabel" q-translation="Common.Template"></label>:\r\n						<qui-select qui-model="template">\r\n							<optgroup ng-repeat="template in templates" label="{{getName(template.type)}}">\r\n								<option ng-repeat="item in template.items" value="{{item.id}}">{{item.name}}</option>\r\n							</optgroup>\r\n						</qui-select>\r\n					</div>\r\n				</div>\r\n				<div class="error-msg">{{error}}</div>\r\n			</main>\r\n		</div>\r\n		<footer class="dm-footer">\r\n			<button class="button" qva-activate="closeView()" q-translation="Devhub.Cancel"></button>\r\n			<button class="button" qva-activate="create()" q-translation="Common.CreateAndEdit"></button>\r\n		</footer>\r\n	</div>\r\n</div>\r\n'}),define("dev-hub.dialogs/new-extension/new-extension",["text!dev-hub.dialogs/new-extension/new-extension.ng.html"],function(template){"use strict";function initCap(str){return str.charAt(0).toUpperCase()+str.slice(1)}var newDialog={template:template,controller:["$scope",function($scope){$scope.error="",$scope.closeView=function(){$scope.destroyComponent()},$scope.create=function(){var err=$scope.createNew(this.name,this.template);err?$scope.error=err:$scope.closeView()},$scope.getName=function(type){return type="visualization"===type?type+" extension":type,initCap(type)+" templates"}}]};return newDialog}),define("dev-hub.services/error-service",["qvangular","translator","general.services/delayed-modal/delayed-modal"],function(qvangular,translator){var delayedModal=qvangular.getService("$delayedModal");qvangular.service("qwErrorService",[function(){var raiseException=function(errTitle,errMessage,errObj){delayedModal.open({title:errTitle||translator.get("Devhub.ErrorDialog.Title"),content:errMessage,buttons:[]}),window.console.error(errTitle,errObj)},raiseError=function(errTitle,errMessage,buttons){delayedModal.open({title:errTitle||translator.get("Devhub.ErrorDialog.Title"),content:errMessage,buttons:buttons?buttons:[]})},silentError=function(errTitle,errDescription){window.console.error(errTitle,errDescription)};return{raiseError:raiseError,raiseException:raiseException,silentError:silentError}}])}),define("dev-hub.services/common-service",["qvangular","qlik","jquery","underscore","translator","core.utils/deferred","dev-hub.lib/object-lister","dev-hub.lib/assets-files-utils","dev-hub.dialogs/new-extension/new-extension","dev-hub.services/error-service"],function(qvangular,qlik,$,_,translator,Deferred,objectLister,assetsFilesUtils,newExtensionDialog){"use strict";var errorService=qvangular.getService("qwErrorService");qvangular.service("qwCommonService",[function(){function registerWatcher(type,what){watchers[type]||(watchers[type]=[]),watchers[type].push(what)}function notifyWatchers(type){watchers[type]&&watchers[type].forEach(function(what){"function"==typeof what&&what()})}function getApplist(){var defer=new Deferred;return qlik.getAppList(function(reply){var objs=[];return reply.forEach(function(value){objs.push({id:value.qDocId,type:value.qDocName})}),defer.resolve(objs)},connectionConfig),defer.promise}function getObjectList(app){var defer=new Deferred;return objectLister.listVisualizations(app).then(function(list){defer.resolve(list)}),defer.promise}function getFieldList(app,sort){var defer=new Deferred;return app.getList("FieldList",function(reply){sort&&defer.resolve(reply.qFieldList.qItems.sort(function(a,b){return a.qName<b.qName?-1:b.qName<a.qName?1:void 0})),defer.resolve(reply.qFieldList.qItems)}),defer.promise}function getDimensionList(app){var defer=new Deferred;return app.getList("DimensionList",function(reply){defer.resolve(reply.qDimensionList.qItems)}),defer.promise}function getMeasureList(app){var defer=new Deferred;return app.getList("MeasureList",function(reply){defer.resolve(reply.qMeasureList.qItems)}),defer.promise}function _isIdInList(list,name){return _.filter(list,function(element){return element.id.toLowerCase()===name.toLowerCase()}).length>0}function getProductInfo(){var defer=new Deferred;return Deferred.all({qvVersion:qlik.getGlobal(connectionConfig).getProductVersion(),isPersonalMode:qlik.getGlobal(connectionConfig).isPersonalMode()}).then(function(res){defer.resolve({version:res.qvVersion.qReturn,isPersonal:res.isPersonalMode.qReturn})}),defer.promise}function init(){return getProductInfo()}var gotTimeout=!1;qlik.setOnError(function(error){translator.ready.then(function(){var buttons=[];gotTimeout&&16===error.code?(buttons=[{name:"Common.Refresh",defaultButton:!0,callback:function(){window.location.reload(!0)}},{name:"Common.Close",defaultEscButton:!0,defaultButton:!1}],errorService.raiseError("Devhub.ErrorDialog.Title",error.code?"ErrorCode."+error.code:error.message,buttons)):(buttons=[{name:"Common.Refresh",defaultButton:!0,callback:function(){window.location.reload(!0)}}],errorService.raiseError("Devhub.ErrorDialog.Title",error.message+(error.method?" ("+error.method+")":""),buttons))})},function(warning){"OnSessionTimedOut"===warning.method&&(gotTimeout=!0)});var toolConfig,currentLocation="",watchers=[],connectionConfig={host:window.location.hostname,prefix:window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/dev-hub")+1),port:window.location.port,isSecure:"https:"===window.location.protocol},defaultToolConfig={toolPath:"default",toolTitle:"",general:{undoRedo:!1},rightPanel:{active:!1,open:!1},leftPanel:{active:!1,open:!1},toolbarSearch:!1,bottomBar:{active:!1,openView:!1},selectionsBar:{enabled:!1,toggled:!1}},setToolConfig=function(config){toolConfig=_.extend(defaultToolConfig,config)},getToolConfig=function(){return toolConfig},newExtension=function(startPageAssets,typeFilter){var defer=new Deferred;return translator.ready.then(function(){return startPageAssets.templateList.length<1?errorService.raiseError("Devhub.ErrorDialog.Title","Devhub.ErrorNoTemplates"):void $("#popup").showComponent(newExtensionDialog,{createNew:function(name,template){return name&&template?name.length>80?translator.get("Devhub.NameTooLong"):assetsFilesUtils.isValidFileName(name,!1)?_isIdInList(startPageAssets.extensionList,name)?translator.get("Devhub.ExtensionAlreadyExists",name):void assetsFilesUtils.duplicateExtension(template,name).then(function(reply){defer.resolve(reply)})["catch"](function(errObj){defer.reject({errName:"errCreateExtension",errObject:errObj,errMessage:translator.get("Devhub.ErrorCreateExtension")})}):translator.get("Devhub.InvalidFileName"):translator.get("Devhub.FieldsMandatory")},templates:typeFilter?_.where(startPageAssets.templateList,{type:typeFilter}):startPageAssets.templateList,name:"",template:null})}),defer.promise};return{init:init,config:connectionConfig,currentLocation:function(){return currentLocation},getApplist:getApplist,getObjectList:getObjectList,getFieldList:getFieldList,getDimensionList:getDimensionList,getMeasureList:getMeasureList,getProductInfo:getProductInfo,setToolConfig:setToolConfig,getToolConfig:getToolConfig,registerWatcher:registerWatcher,notifyWatchers:notifyWatchers,dialogs:{newExtension:newExtension},__onlytest__:{_isIdInList:_isIdInList}}}])}),define("dev-hub.services/navigation-service",["qvangular","jquery","core.utils/deferred","ng!$window","crossroads","dev-hub.lib/utils","translator","general.services/loader/loader","dev-hub.services/common-service"],function(qvangular,$,Deferred,$window,crossroads,utils,translator){"use strict";qvangular.service("qwNavigationService",[function(){function openUrlInNewTabIfCtrlKeyPressed(ctrlKeyPressed,element){element.disable||(ctrlKeyPressed?$window.open(element.link):location.href=element.link)}function getMenuItems(){return menuItems.sort(function(a,b){return a.order-b.order})}function getTools(){return getMenuItems().filter(function(t){return t.order>0})}function createNavigationMenuItems(){var defer=new Deferred;return defer.resolve(getMenuItems()),defer.promise}var qvLoader=qvangular.getService("qvLoader"),commonService=qvangular.getService("qwCommonService"),getFullLocation=function(){var prefix=window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/dev-hub")+1),url=window.location.href;return url=url.split("/"),url[0]+"//"+url[2]+("/"===prefix[prefix.length-1]?prefix.substr(0,prefix.length-1):prefix)},openExtension=function(extensionUnqiueName,extensionType,newWindow){var basePath=getFullLocation(),toolPath="",newHash="";"mashup"===extensionType?(toolPath="/dev-hub/mashup-editor/",newHash="#qext{"+extensionUnqiueName+"}"):(toolPath="/dev-hub/extension-editor/",newHash="#qext{"+extensionUnqiueName+"}"),newWindow===!0?window.open(basePath+toolPath+newHash):window.location.pathname.indexOf(toolPath)>-1?(window.location.hash=newHash,window.location.reload(!0)):window.location.href=basePath+toolPath+newHash},menuItems=[],container=null,getNavigationMenu=function(){return{icon:"navigation",tooltipInactive:"Devhub.Navigation",isToggleButton:!0,buttonType:"qui-button",tid:"4dd7ec",menuOptions:{position:"bottom",width:"305",content:{tid:"4dd7ed",menuClasses:"toolbar-menu qui-icontextlist",createMenuItems:createNavigationMenuItems}}}},setContainer=function(element){container=element instanceof $?element:$(element)},setLocation=function(path){commonService.currentLocation=path.split("/")[path.split("/").length]?path.split("/")[path.split("/").length]:path.split("/")[path.split("/").length-1]},setBrowserTitle=function(){var currentToolConfig=commonService.getToolConfig();currentToolConfig&&utils.setBrowserTitle(translator.get(currentToolConfig.toolTitle))},init=function(container){qvLoader.show({messageObj:{task:""}}),setContainer(container),crossroads.parse(document.location.pathname)};return{init:init,registerRoute:function(path,callback){var prefix=window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/dev-hub")+1);prefix=prefix.substr(0,prefix.length-1),path=prefix+path,crossroads.addRoute(path,function(){setLocation(path),callback&&"function"==typeof callback?callback.then&&"function"==typeof callback.then?callback().then(function(){setBrowserTitle(),qvLoader.close(!0)}):(callback(),setBrowserTitle(),qvLoader.close(!0)):qvLoader.close(!0)})},getContainer:function(){return container&&container.length>0?container:$("#container")},addMenuItem:function(menuItem){menuItems.push(menuItem)},getNavigationMenu:getNavigationMenu,getTools:getTools,openUrlInNewTabIfCtrlKeyPressed:openUrlInNewTabIfCtrlKeyPressed,getFullLocation:getFullLocation,openExtension:openExtension}}])}),define("assets/hub/hub-toolbar/hub-toolbar-controller",["core.utils/external-urls","core.utils/resize","general.utils/support","qvangular","dev-hub.services/navigation-service"],function(externalUrls,Resize,Support,qvangular){function init(o){$||($=o.jquery),helpUrl||(helpUrl=o.helpUrl),$aboutDialog||($aboutDialog=o.aboutDialog),popoverTemplate||(popoverTemplate=o.popoverTemplate),translator||(translator=o.translator),authentication||(authentication=o.authentication),shortcuts||(shortcuts=o.shortcuts),qa||(qa=o.qa),RouteController||(RouteController=o.RouteController),HubState||(HubState=o.HubState),routing||(routing=o.routing)}function createItem(text,icon,callback,isUserInfo,tooltip){var obj={};return isUserInfo&&(obj.isUserInfo=isUserInfo),tooltip&&(obj.tooltip=tooltip),obj.icon=icon,obj.text=text,obj.callback=callback,obj}function outsideClick(e,outside,callback){$(e.target).is("[ignore-outside]")||outside(),callback&&(callback(),e.preventDefault())}function removePopover(){popover&&(popover.remove(),popover=null),s.menuActive=!1,s.listItems.length=0,s.alignTo="",s.contextOption={}}function compileMenu($compile,$element){popover=$compile(popoverTemplate)(s).appendTo($element)}function goToPrevious(scope){var sortFilter=$(".hub-content-toolbar-wrapper .sort-filter"),searchField=$(".hub-content-wrapper input");scope.search.text="",searchField.blur(),sortFilter&&sortFilter.blur(),HubState.isGlobalSearch&&HubState.view===HubState.MobileView.instream?(HubState.setGlobalSearch(!1),scope.$emit("newSearch")):HubState.isGlobalSearch&&HubState.view===HubState.MobileView.home?(scope.$emit("resetList"),routing.changeUrl(RouteController.buildUrl(!0,"hub","my","home")),HubState.setGlobalSearch(!1),HubState.setView()):(routing.changeUrl(RouteController.buildUrl(!0,"hub","my","home")),HubState.setView())}function getHelpLink(scope){var context=scope.isPersonalMode?"Hub.dt.Help":"Hub.Help",mod=scope.isPersonalMode&&!scope.isSmallDevice?"&mod=client_dt":"";return scope.isSmallDevice&&(context="SmallScreen.Help"),helpUrl.path+"#"+translator.language+mod+"|"+context}var $,s,$aboutDialog,helpUrl,popoverTemplate,popover,translator,authentication,shortcuts,qa,RouteController,HubState,routing,cachedSearchString="";return{init:init,goToPrevious:goToPrevious,ctrl:["$scope","$element","$compile",function($scope,$element,$compile){s=$scope,shortcuts.SearchBegin.bind(function(){HubState.isGlobalSearch||($scope.toggleSearch(),qa.$apply($scope))}),shortcuts.SearchEnd.bind(function(){HubState.isGlobalSearch&&($scope.toggleSearch(),qa.$apply($scope))}),$scope.contextOption={},$scope.listItems=[],$scope.isSearch=!1,$scope.menuActive=!1,$scope.alwaysAnonymous=!1,$scope.isLoggedIn=!1,$scope.isHttps=!1,$scope.focus=Support.treatAsDesktop(),authentication.onDataReceived.then(function(data){$scope.isHttps=!0,"NONE"!==data.userDirectory&&($scope.userId=data.userId,$scope.userDirectory=data.userDirectory),$scope.isLoggedIn=data.loginUri?!1:!0,$scope.alwaysAnonymous=data.loginUri||data.logoutUri?!1:!0,$scope.doSignInOrOut=data.loginUri?function(){window.location.href=authentication.loginUri}:function(){$.ajax({type:"DELETE",url:authentication.logoutUri,async:!0})}}),$scope.position="bottom",$scope.alignTo="",$scope.contextOption.hidepointer=!1,$scope.contextOption.smallview=!1,$scope.outsideClickedFunc=outsideClick,$scope.removePopover=removePopover,$scope.goToCloud=function(){window.open(externalUrls.cloudBaseUrl)},$scope.toggleSearch=function(){$scope.appList.length&&($scope.search.text="",$scope.isSearch=!$scope.isSearch,HubState.setGlobalSearch($scope.isSearch),$scope.hideSidebar=!$scope.hideSidebar||$scope.isPersonalMode,$scope.isSearch&&($scope.search.text=cachedSearchString),$scope.$emit("saveState"),$scope.$emit("newSearch"))},$scope.toggleMenu=function(e,alignTo){var options={};return!$scope.menuActive||$scope.alignTo!==alignTo&&"undefined"!=typeof alignTo?($scope.alignTo!==alignTo&&(removePopover(),$scope.alignTo=alignTo,".hub-menu button"===alignTo?(options.version=$scope.qvVersion,options.isPersonal=$scope.isPersonalMode,$scope.isSmallDevice?($scope.isLoggedIn&&!$scope.alwaysAnonymous&&$scope.listItems.push(createItem($scope.userId+" "+$scope.userDirectory,"",$.noop,!0)),$scope.isPersonalMode||$scope.alwaysAnonymous||$scope.listItems.push(createItem("Hub.SignOut","log-in-out",$scope.doSignInOrOut)),$scope.listItems.push(createItem("GlobalMenu.Help","help",function(){window.open(getHelpLink($scope))},null,"Common.Tooltip.OpenHelpInNewTab"),createItem("Common.About","info",function(){$aboutDialog.show(options)}))):($scope.listItems.push(createItem("Qlik Dev Hub","repair",function(){window.open(qvangular.getService("qwNavigationService").getFullLocation()+"/dev-hub")},null,"Tooltip.OpenNewWindow")),$scope.listItems.push(createItem("GlobalMenu.Help","help",function(){window.open(getHelpLink($scope))},null,"Common.Tooltip.OpenHelpInNewTab"),createItem("Common.About","info",function(){$aboutDialog.show(options)})))):$scope.listItems=[createItem("Hub.SignOut","log-in-out",$scope.doSignInOrOut)]),$scope.isSmallDevice&&($scope.contextOption.hidepointer=!0,$scope.contextOption.top=54,$scope.contextOption.smallview=!0),compileMenu($compile,$element),void($scope.menuActive=!0)):void removePopover()},$scope.$watch("search.text",function(newVal){$scope.isSearch&&(cachedSearchString=newVal),$scope.$emit("newSearch")}),$scope.goToPrevious=function(){goToPrevious($scope)},Resize.on("start",removePopover),$scope.$on("$destroy",function(){Resize.off("start",removePopover)})}]}}),define("text!assets/hub/hub-toolbar/hub-toolbar.ng.html",[],function(){return'<div class="hub-toolbar">\r\n	<div class="toolbar-menus">\r\n		<div class="menu-left" ng-if="isSmallDevice && hideSidebar">\r\n			<div tid="goToPrev" class="hub-toolbar-flexbutton" qva-activate="goToPrevious()" ng-if="(!isPersonalMode || isGlobalSearch)">\r\n				<i class="icon-hub-previous" q-title-translation="Tooltip.NavigateBack"></i>\r\n			</div>\r\n			<div tid="goToCloud" class="hub-toolbar-flexbutton" qva-activate="goToCloud();" ng-if="isPersonalMode && !isGlobalSearch">\r\n				<i class="icon-cloud" q-title-translation="Hub.Tooltip.Cloud"></i>\r\n			</div>\r\n		</div>\r\n		<div class="hub-brand">\r\n			<img ng-if="isPersonalMode" alt="Qlik Sense" class="brand-img" ng-show="!hideSidebar || !isSmallDevice" src="../resources/img/logo/sense-desktop.png">\r\n			<img ng-if="!isPersonalMode" alt="Qlik Sense" class="brand-img" ng-show="!hideSidebar || !isSmallDevice" src="../resources/img/logo/sense-server.png">\r\n\r\n			<div class="stream-title" q-translation="{{pathTranslation}}" q-title-translation="{{pathTranslation}}" ng-show="hideSidebar && !isGlobalSearch && isSmallDevice"></div>\r\n			<div class="stream-title" q-translation="Common.Search" q-title-translation="Common.Search" ng-show="hideSidebar && isGlobalSearch && isSmallDevice"></div>\r\n		</div>\r\n\r\n		<div class="hub-user-info" ng-if="!isSearch">\r\n			<div class="hub-menu">\r\n				<button ng-class="{ \'qui-active\': alignTo === \'.hub-menu button\' }"\r\n						ignore-outside\r\n						qva-activate="toggleMenu( $event, \'.hub-menu button\' )"\r\n						tid="menuBtn"\r\n						class="hub-button icon-threebars qui-dropdown"\r\n						q-title-translation="Toolbar.Menu"></button>\r\n			</div>\r\n			<div class="hub-login-btn-cont" ng-if="isHttps && !isLoggedIn && !isPersonalMode && !alwaysAnonymous && !isSmallDevice">\r\n				<qui-button light\r\n							qva-activate="doSignInOrOut()"\r\n							tid="sign-in-out"\r\n							q-translation="Hub.SignIn"></qui-button>\r\n			</div>\r\n			<div ng-class="{ \'underlined\': alignTo === \'.login-info\' }"\r\n				 class="login-info" ignore-outside qva-activate="toggleMenu( $event, \'.login-info\' );"\r\n				 tid="login-menu"\r\n				 ng-if="isHttps && !isPersonalMode && isLoggedIn && !alwaysAnonymous && !isSmallDevice">\r\n				<div class="user" ignore-outside>\r\n					<div class="user-sub user-id" ignore-outside>{{ userId }}</div>\r\n					<div class="user-sub user-dir" ignore-outside>{{ userDirectory }}</div>\r\n				</div>\r\n				<div class="pointer" ignore-outside>S</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="hub-search-container" ng-if="!isSmallDevice">\r\n		<div class="hub-search" ng-if="isSearch">\r\n			<qui-search-field auto-focus="focus" query="search.text" class="no-border" placeholder="Common.Search"/>\r\n		</div>\r\n		<div ng-if="isPersonalMode && !isSearch" class="hub-search-cloud">\r\n			<div class="hub-toolbar-flexbutton" qva-activate="goToCloud();" tid="goToCloud">\r\n				<i class="icon-cloud" q-title-translation="Hub.Tooltip.Cloud"></i>\r\n			</div>\r\n		</div>\r\n		<div class="hub-toolbar-search hub-toolbar-flexbutton" qva-activate="toggleSearch();" ng-disabled="!appList.length" ng-if="!isSearch" tid="toggleSearch">\r\n			<i class="icon-magnifying-glass" q-title-translation="Common.Search"></i>\r\n		</div>\r\n		<div class="hub-search-done hub-toolbar-flexbutton" qva-activate="toggleSearch();" ng-if="isSearch">\r\n			<button qva-activate="toggleSearch()" class="qui-button-light" tid="doneSearch">\r\n				<span q-translation="Common.Done"></span>\r\n			</button>\r\n		</div>\r\n	</div>\r\n</div>';
}),define("text!assets/hub/hub-toolbar/popover.ng.html",[],function(){return'<immidiate-contextual hidepointer="contextOption.hidepointer" smallview="contextOption.smallview" align-to="alignTo" position="position" top="contextOption.top" on-close-view="outsideClickedFunc(event, toggleMenu)">\r\n    <ul class="qui-icontextlist">\r\n        <li qva-activate="outsideClickedFunc($event, removePopover, item.callback)" class="s-li" ng-class="{\'is-user-info\': item.isUserInfo}" data-icon="{{item.icon}}" q-title-translation="{{item.tooltip || item.text}}" ng-repeat="item in listItems">\r\n            <span q-translation="{{item.text}}" class="s-text" ng-if="!item.isUserInfo"></span>\r\n            <span ng-if="item.icon == \'help\' || item.icon == \'repair\'" class="qui-open-in-new-tab-icon" data-icon="stacked-windows" ng-disabled="false"></span>\r\n            <span class="i-text" ng-if="item.isUserInfo">{{ userId }}<br />{{ userDirectory }}</span>\r\n        </li>\r\n    </ul>\r\n</immidiate-contextual>\r\n'}),define("assets/hub/hub-shortcuts",["jquery","core.utils/notification"],function($,Notification){"use strict";var HubShortcuts={};return Notification.mixin(HubShortcuts),HubShortcuts.notification("SearchBegin"),HubShortcuts.notification("SearchEnd"),$(document).on("keydown.hubShortcutKeys",function(e){var isCtrl=e.ctrlKey||e.metaKey;isCtrl&&70===e.which?(HubShortcuts.SearchBegin.emit(),e.preventDefault()):27===e.which&&(HubShortcuts.SearchEnd.emit(),e.preventDefault())}),HubShortcuts}),define("text!general.services/about-dialog/about-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="about-dialog" qv-cancel="destroyComponent()">\r\n	<main class="dm-main" ng-class="setMainClass()">\r\n		<div class="flex-item side-panel">\r\n			<div ng-if="!isSmallDevice" class="about-s-holder">\r\n				<a q-translation="Common.About" qva-activate="info.view=\'about\'" class="about-a-style {{setClass(\'about\')}}"></a>\r\n				<a q-translation="About.3rdPartySoftware" qva-activate="info.view=\'licenses\'" class="about-a-style {{setClass(\'licenses\')}}"></a>\r\n				<a q-translation="About.LicenceAgreement" qva-activate="info.view=\'ula\'" class="about-a-style {{setClass(\'ula\')}}"></a>\r\n			</div>\r\n\r\n			<qui-select ng-if="isSmallDevice" class="about-select" qui-model="info.view">\r\n				<option value="about" q-translation="Common.About"></option>\r\n				<option value="licenses" q-translation="About.3rdPartySoftware"></option>\r\n				<option value="ula" q-translation="About.LicenceAgreement"></option>\r\n			</qui-select>\r\n		</div>\r\n		<div class="flex-item content">\r\n			<div ng-if="view(\'about\')" class="about cont-div"  ng-style="setBackgroundStyle()">\r\n				<div class="about-flex">\r\n					<div class="about-logo" ng-style="setLogoStyle"></div>\r\n					<div class="about-divider"></div>\r\n					<p class="about-version">\r\n						<span class="qv-version">{{versionText}}</span>\r\n					</p>\r\n\r\n					<a class="about-link" target="_blank" href="http://www.qlik.com/">www.qlik.com</a>\r\n\r\n					<div class="about-footer">\r\n						<div class="about-copyright" q-translation="About.Copyright"></div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<div ng-if="view(\'licenses\')" class="licenses cont-div">\r\n				<h2 class="about-h2" ng-if="!isSmallDevice" q-translation="About.3rdPartySoftware">3rd Party Software</h2>\r\n\r\n				<p class="about-p" q-translation="About.3rdPartySoftwareIntro"></p>\r\n				<ul class="about-ul">\r\n					<li class="license-link" ng-repeat="license in licenses">\r\n						<a class="about-a-style" qva-activate="scrollToLicense($index)">{{license.name}}</a>\r\n					</li>\r\n				</ul>\r\n\r\n				<div class="license-entry" ng-repeat="license in licenses">\r\n					<h3>{{license.name}} <button class="qui-button" data-icon="triangle-top" qva-activate="scrollToLicense()"></button></h3>\r\n					<a ng-href="{{license.url}}" target="_blank">{{license.license}}</a>\r\n					<div class="license-text"><code>{{license.text}}</code></div>\r\n				</div>\r\n\r\n			</div>\r\n			<qv-ula ng-if="view(\'ula\')"></qv-ula>\r\n		</div>\r\n	</main>\r\n	<footer class="dm-footer">\r\n		<qui-button qva-activate="destroyComponent()" q-translation="Common.Close" qva-focus="true"></qui-button>\r\n	</footer>\r\n</qv-modal-dialog>'}),define("text!general.services/about-dialog/ula-personal.ng.html",[],function(){return'<div class="qv-ula cont-div" tid="ula-personal">\r\n	<iframe class="ifrm" frameborder="0" height="100%" width="100%" src="../resources/assets/general/services/about-dialog/personal.html"></iframe>\r\n</div>\r\n'}),define("text!general.services/about-dialog/ula-server.ng.html",[],function(){return'<div class="qv-ula cont-div server" tid="ula-server">\r\n	<iframe class="ifrm" frameborder="0" height="100%" width="100%" src="../resources/assets/general/services/about-dialog/server.html"></iframe>\r\n</div>\r\n'}),define("general.services/about-dialog/license-agreement",["qvangular","text!./ula-personal.ng.html","text!./ula-server.ng.html"],function(qvangular,personalTemplate,serverTemplate){qvangular.directive("qvUla",function(){return{restrict:"E",replace:!0,template:function(){return qvangular.getService("$rootScope").isPersonalMode?personalTemplate:serverTemplate}}})}),define("general.services/about-dialog/about-dialog",["qvangular","core.utils/deferred","text!./about-dialog.ng.html","general.utils/responsive-state","general.services/show-service/show-service","translator","general.models/media-library","mqa","require","general.utils/string-normalization","general.services/about-dialog/license-agreement","assets/client/dialogs/directives/dialog-directives"],function(qvangular,Deferred,template,ResponsiveState,ShowService,translator,MediaLibraryModel,mqa,require,SN){function fetchLicenses(){var dfd=new Deferred;return require(["autogenerated/licenses"],function(licenses){dfd.resolve(licenses.sort(function(a,b){var aName=SN.string(a.name).toLocaleUpperCase(),bName=SN.string(b.name).toLocaleUpperCase();return aName.localeCompare(bName)}))}),dfd.promise}var component={template:template,scope:{version:"=",personal:"="},controller:["$scope","$element",function($scope,$element){var viewChanged,logoUrl,backgroundUrl;$scope.versionText=translator.get("About.Version")+" "+$scope.version,$scope.showBackground=mqa.match("aboutDialogShowCircles"),$scope.updateBackground=function(enable){$scope.showBackground=enable},mqa.on("aboutDialogShowCircles",$scope.updateBackground),$scope.mainClasses={},$scope.info={view:"about"},$scope.isSmallDevice=ResponsiveState.isSmallDevice,logoUrl=$scope.personal?MediaLibraryModel.addBasePath("/resources/img/about-logo-personal.png"):MediaLibraryModel.addBasePath("/resources/img/about-logo.png"),backgroundUrl=MediaLibraryModel.addBasePath("/resources/img/about-circles.png"),$scope.setLogoStyle={"background-image":'url("'+logoUrl+'")'},$scope.setBackgroundStyle=function(){return $scope.showBackground?{"background-image":'url("'+backgroundUrl+'")',"background-repeat":"no-repeat","background-size":"40%","background-position":"bottom right"}:void 0},$scope.setMainClass=function(){var o={};return o[$scope.info.view]=!0,o},$scope.setClass=function(view){return view===$scope.info.view?"active":""},$scope.view=function(view){return view===$scope.info.view},$scope.scrollToLicense=function(idx){"undefined"!=typeof idx?$element.find(".license-entry").eq(idx)[0].scrollIntoView(!0):$element.find(".content").scrollTop(0)},fetchLicenses().then(function(licenses){$scope.licenses=licenses}),viewChanged=function(isSmall){$scope.isSmallDevice=isSmall,qvangular.$apply($scope)},ResponsiveState.ViewChanged.bind(viewChanged),$scope.$on("$destroy",function(){ResponsiveState.ViewChanged.unbind(viewChanged),mqa.off("aboutDialogShowCircles",$scope.updateBackground)})}]};qvangular.service("$aboutDialog",[function(){return{show:function(o){var input={version:o.version,personal:o.isPersonal};return ShowService.show(component,input)}}}])}),define("hub.files/hub-toolbar/hub-toolbar",["qvangular","jquery","assets/hub/hub-toolbar/hub-toolbar-controller","text!assets/hub/hub-toolbar/hub-toolbar.ng.html","text!assets/hub/hub-toolbar/popover.ng.html","core.utils/help-url","translator","core.utils/authentication","assets/hub/hub-shortcuts","general.controllers/route-controller","hub.files/hub-state","assets/hub/hub-routing","general.services/about-dialog/about-dialog"],function(qvangular,$,ctrl,template,popoverTemplate,helpUrl,translator,authentication,hs,RouteController,HubState,routing){qvangular.directive("qveHubToolbar",function(){"use strict";return ctrl.init({jquery:$,helpUrl:helpUrl,aboutDialog:qvangular.getService("$aboutDialog"),popoverTemplate:popoverTemplate,translator:translator,authentication:authentication,shortcuts:hs,qa:qvangular,RouteController:RouteController,HubState:HubState,routing:routing}),{restrict:"E",replace:!0,scope:"=",template:template,controller:ctrl.ctrl}})}),define("text!assets/hub/create-app.ng.html",[],function(){return'<div>\r\n	<p q-translation="CreateApp.FilenameDefaultText"></p>\r\n	<input class="qui-input" qva-select ng-model="appName" ng-change="validateForm ()" qv-enter="handleEnter()" maxlength="{{isPersonalMode ? 200 : 255}}" type="text" val="" />\r\n    <p ng-if="appExists" class="qv-fail" q-translation="CreateApp.TitleNotUniqueErrorMessage"></p>\r\n	<p ng-if="invalidChars" class="qv-fail" q-translation="Common.InvalidCharacters"></p>\r\n	<p ng-if="undefinedError" class="qv-fail" q-translation="{{undefinedError}}"></p>\r\n	<p ng-if="!failed && !appExists && !invalidChars">&nbsp;</p>\r\n</div>\r\n'}),define("text!assets/hub/open-app.ng.html",[],function(){return'<div>\r\n	<p class="hub-app-cmsg">{{ newlyCreatedAppTitle }}</p>\r\n</div>'}),define("text!assets/client/dialogs/loading.ng.html",[],function(){return'<div class="q-modal-loading">\r\n	<div class="loading qv-loader"></div>\r\n	<p q-translation="Common.PleaseWait"></p>\r\n</div>'}),define("assets/scripteditor/services/fix-ie-ten-box-shadow-service",["jquery"],function($){function fix(selector){$(selector).hide(0,function(){$(selector).show()})}var exports={fix:fix};return exports}),define("client.views/app-overview/hub-and-overview-common",[],function(){"use strict";function validateTitleContainsAllowedChars(title){var noForbiddenCharsRegex=/^[^\\\/:\*\t\?"<>\|]+$/,validChars=!0;return title.length&&(validChars=noForbiddenCharsRegex.test(title)),validChars}function checkForEmptyTitle(title){return 0===title.length||0===title.replace(/\s/g,"").length}return{allowedChars:validateTitleContainsAllowedChars,emptyTitle:checkForEmptyTitle}}),define("assets/hub/content-toolbar/content-toolbar-controller",["general.controllers/route-controller","text!assets/hub/create-app.ng.html","text!assets/hub/open-app.ng.html","text!assets/client/dialogs/loading.ng.html","qvangular","translator","assets/scripteditor/services/fix-ie-ten-box-shadow-service","assets/hub/hub-model","autogenerated/qix/engine-enums","client.views/app-overview/hub-and-overview-common","hub.files/hub-state","general.services/delayed-modal/delayed-modal"],function(RouteController,createAppTemplate,openAppTemplate,loadingTemplate,qvangular,translator,fixIE10BoxShadowService,hubModel,enums,hubAoCommonApi,HubState){"use strict";function appExists(a,o){var exist=-1!==a.map(function(e){return e.qDocName.replace(".qvf","").toUpperCase()}).indexOf(o.toUpperCase());return exist}function canCreate(modalScope){return!modalScope.emptyTitle&&!modalScope.appExists&&!modalScope.invalidChars}function validateForm($delayedModal,$scope){return $delayedModal.scope.appName=$delayedModal.scope.appName.trim(),resetErrors($delayedModal),$delayedModal.scope.appName?($delayedModal.scope.undefinedError=!1,$delayedModal.scope.appExists=!1,$delayedModal.scope.emptyTitle=hubAoCommonApi.emptyTitle($delayedModal.scope.appName),$delayedModal.scope.invalidChars=!hubAoCommonApi.allowedChars($delayedModal.scope.appName)&&!$delayedModal.scope.emptyTitle,$scope.$root.isPersonalMode&&($delayedModal.scope.appExists=appExists($scope.appList,$delayedModal.scope.appName)),void(canCreate($delayedModal.scope)?$delayedModal.scope.buttons[1].expression=!0:$delayedModal.scope.buttons[1].expression=!1)):($delayedModal.scope.emptyTitle=!0,void($delayedModal.scope.buttons[1].expression=!1))}function resetErrors($delayedModal){$delayedModal.scope.undefinedError=!1,$delayedModal.scope.appExists=!1,$delayedModal.scope.emptyTitle=!1,$delayedModal.scope.invalidChars=!1}function createListItem(value,text){return{value:value,text:text}}var myTimer,myErrorTimer,errors=enums.NxLocalizedErrorCode,showLoadingDialog=!1;return["$scope","$delayedModal","$timeout","$$expandable",function($scope,$delayedModal,$timeout,$$expandable){function pushToArray(sId){$scope.exp.sections.length=0,$scope.exp.sections.push(createListItem(0,"Common.SortByAlphabetical")),sId&&$scope.exp.sections.push(createListItem(1,"Common.SortByPublishedDate"))}function clearAndUnlockDialog(){$timeout.cancel(myTimer),$timeout.cancel(myErrorTimer),$delayedModal.unlock()}function showAppCompletedDialog(){$delayedModal.update({title:"Dialog.AppCreatedHeader",html:openAppTemplate,buttons:[{name:"Common.Close",tid:"HubCloseButton"},{name:"Hub.OpenApp",tid:"HubOpenAppButton",defaultButton:!0,callback:function(){window.open(RouteController.buildUrl(!0,"sense","app",$delayedModal.scope.createdId),"_blank"),$delayedModal.close()}}]})}function createAppCompleted(result){return result.qSuccess?($delayedModal.scope.createdId=result.qAppId,$scope.$emit("appListModified",!0),showLoadingDialog?void $timeout(function(){clearAndUnlockDialog(),showAppCompletedDialog(),HubState.setIsCreating(!1)},1e3):(clearAndUnlockDialog(),showAppCompletedDialog(),HubState.setIsCreating(!1),void fixIE10BoxShadowService.fix(".qui-delayedModal"))):void createAppError(result)}function checkIfErrorOnCreate(code){return code===errors.LOCERR_GENERIC_UNKNOWN&&code!==errors.LOCERR_APP_ALREADY_EXISTS||code===errors.LOCERR_FILE_NAME_INVALID}function getErrorString(err){var text="Error.WhileCreateingApp";return err&&err===errors.LOCERR_FILE_NAME_INVALID&&(text="Error.FilenameInvalid"),text}function createAppError(result){clearAndUnlockDialog(),resetErrors($delayedModal),!result.error||checkIfErrorOnCreate(result.error.code)?result.error.code===errors.LOCERR_FILE_NAME_INVALID?($delayedModal.close(),$scope.createApp(null,null,getErrorString(result.error.code))):$delayedModal.update({showButtons:!0,title:"ErrorDialog.Title",html:'<span q-translation="'+getErrorString(result.error)+'"></span>',buttons:[{name:"Common.Close"}]}):result.error.code===errors.LOCERR_APP_ALREADY_EXISTS&&($delayedModal.scope.appExists=!0),result.error&&(result.error.isHandled=!0)}function showTimeoutDialog(){var options={title:"Common.Timeout.Title",content:"Hub.CreateApp.Timeout"};$delayedModal.open(options)}function showLoading(show,title){!$delayedModal.scope.createdId&&show&&(showLoadingDialog=show,$delayedModal.update({html:loadingTemplate,title:translator.get("HubCreateDialog.Creating")+" "+title,showDefaultButton:!1,buttons:[]}),myErrorTimer=$timeout(function(){showLoadingDialog&&($delayedModal.close(),showTimeoutDialog())},6e4))}var defaultCreateApp;return $scope.$watchCollection("[allowCreateApp, isSmallDevice, route]",function(newValues){$scope.hasCreateNew=newValues[0]&&!newValues[1]&&"stream"!==newValues[2]}),$scope.exp.toggleAscDesc=function(){$scope.apps.reverse(),$scope.exp.isAscending=!$scope.exp.isAscending},$scope.$watch("streamId",pushToArray),defaultCreateApp=function(title){$delayedModal.scope.newlyCreatedAppTitle=translator.get("Dialog.AppCreated",[title]),$scope.createHubItem(title).then(createAppCompleted,createAppError),myTimer=$timeout(function(){showLoading(!0,title)},1400)},$scope.sortFilter=function(){$scope.exp.selectedFilter===hubModel.SortFilterOptions.alphabetical?hubModel.alphabeticSort($scope.apps,"qTitle",!$scope.exp.isAscending):$scope.exp.selectedFilter===hubModel.SortFilterOptions.publishedDate&&hubModel.dateSort($scope.apps,"publishTime",!$scope.exp.isAscending)},$scope.$watch("exp.selectedFilter",function(){$scope.updatedByUser?$scope.exp.isAscending=!0:$scope.updatedByUser=!0,$scope.sortFilter()}),$scope.createApp=function(func,defaultTitle,errorMsg){var createAppFunc=func||defaultCreateApp,defaultAppName=defaultTitle||"",errorText=errorMsg||!1,createAppCallback=function(){$delayedModal.scope.appName.length&&!$delayedModal.isLocked&&$delayedModal.scope.buttons[1].expression&&($delayedModal.lock(),createAppFunc($delayedModal.scope.appName),qvangular.$apply($scope))};$delayedModal.open({emptyTitle:!1,isPersonalMode:$scope.isPersonalMode,appExists:!1,appName:defaultAppName,invalidChars:!1,undefinedError:errorText,failed:errorText,width:"490px",loading:!1,autoClose:!1,title:"Hub.CreateApp",html:createAppTemplate,createdId:0,validateForm:function(){$delayedModal.scope.appName=this.appName,validateForm($delayedModal,$scope)},handleEnter:createAppCallback,buttons:[{name:"Common.Cancel"},{name:"Common.Create",defaultButton:!0,expression:!1,callback:createAppCallback}]}),$delayedModal.scope.createdId=null},$scope.toggleView=function(isGrid){$$expandable.forceClose(),$scope.isGrid=isGrid},{appExists:appExists,canCreate:canCreate,validateForm:validateForm}}]}),define("text!assets/hub/content-toolbar/content-toolbar.ng.html",[],function(){return'<div class="hub-content-toolbar-wrapper" ng-class="{\'c-globalsearch-active\': isGlobalSearch}">\r\n	<div class="hub-content-toolbar" ng-if="!isGlobalSearch">\r\n		<div class="no-globalsearch">\r\n			<div class="hub-span" ng-if="!isSmallDevice" q-title-translation="{{pathTranslation}}">{{pathTranslation | translate}}</div>\r\n\r\n			<div class="buttons">\r\n				<div class="button-div" tid="tlb-add" ng-if="hasCreateNew">\r\n					<qui-button light qva-activate="createApp()" q-title-translation="Hub.CreateApp">\r\n						<span class="create-new" q-translation="Hub.CreateApp"></span>\r\n						<span class="plus-sign">+</span>\r\n					</qui-button>\r\n				</div>\r\n\r\n				<qui-filter is-ascending="exp.isAscending"\r\n							toggle-asc-desc="exp.toggleAscDesc()"\r\n							sections="exp.sections"\r\n							sort-title="Common.SortDirection"\r\n							sort-opt-title="Common.SortOptions"\r\n							selected-fltr="exp.selectedFilter"></qui-filter>\r\n\r\n				<div class="button-div" ng-if="!isSmallDevice">\r\n					<qui-button-icon toggle\r\n									 qva-activate="toggleView( true )"\r\n									 active="isGrid"\r\n									 id="viewmode-grid"\r\n									 data-name="grid"\r\n									 tid="gl-tgl"\r\n									 q-title-translation="Tooltip.Grid"\r\n							><span data-icon="hub-grid"></span>\r\n					</qui-button-icon>\r\n\r\n					<qui-button-icon toggle\r\n									 qva-activate="toggleView( false )"\r\n									 active="!isGrid"\r\n									 id="viewmode-list"\r\n									 data-name="vertical"\r\n									 tid="gl-tgl"\r\n									 q-title-translation="Tooltip.List"\r\n							><span data-icon="hub-list"></span>\r\n					</qui-button-icon>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="globalsearch-active" ng-if="isGlobalSearch && !isSmallDevice">\r\n		<span q-translation="Hub.SearchResults"></span>\r\n	</div>\r\n</div>'}),define("hub.files/content-toolbar/content-toolbar",["qvangular","assets/hub/content-toolbar/content-toolbar-controller","text!assets/hub/content-toolbar/content-toolbar.ng.html"],function(qvangular,tBarController,template){qvangular.directive("qveToolbar",function(){"use strict";return{restrict:"E",replace:!0,template:template,controller:tBarController}})}),define("text!assets/hub/content/content.ng.html",[],function(){return'<div class="hub-appslist">\r\n	<div class="hub-noapps" ng-if="!apps.length" q-translation="{{noItems}}"></div>\r\n	<div class="hub-as" ng-if="apps.length">\r\n		<ul class="qv-content-ul"\r\n			qva-activate="performAction($event)"\r\n			ng-if="apps.length"\r\n			ng-class="{\'qv-grid\' : isGrid, \'qv-list\' : !isGrid}">\r\n			<li class="qv-content-li"\r\n				ng-repeat="item in apps track by item.qDocId"\r\n				ng-class="{\'last\': $last, \'qv-app-disabled\': item.isDisabled, \'qv-app-enabled\': !item.isDisabled, \'duplicated-item-animation\': item.animation && !isGrid}"\r\n				qva-context-menu="!item.isDisabled ? onContextMenu( $event ) : null"\r\n				data-action="goToApp">\r\n				<div class="qv-item-border-outer"></div>\r\n				<div class="qv-item-border-inner"></div>\r\n				<div class="qv-content-item">\r\n					<div qv-hub-thumb class="qv-thumb-wrap"></div>\r\n					<div class="qv-details-wrap {{setActive(item)}}"\r\n						 ng-class="{\'duplicated-item-animation\' : item.animation}"\r\n						 ng-if="isGrid"\r\n						 qva-outside-ignore-for="expandable"\r\n						 data-action="{{ isSmallDevice ? \'goToApp\' : \'toggleExpandable\' }}">\r\n						<div class="qv-details-name">\r\n							<div class="qv-text">\r\n								<span class="q-ellipsis" title="{{ item.qTitle }}">{{ item.qTitle }}</span>\r\n							</div>\r\n						</div>\r\n						<div class="qv-details-info" ng-if="!isSmallDevice">\r\n							<i class="icon-info" q-title-translation="Tooltip.Details"></i><i ng-if="item.qReadOnly" class="icon-toolbar-locked" q-title-translation="Hub.App.ReadOnly"></i>\r\n						</div>\r\n					</div>\r\n					<div class="qv-details-wrap" ng-if="!isGrid">\r\n						<div class="ao-mw">\r\n							<div class="qv-details-name">\r\n								<i ng-if="item.qReadOnly" class="icon-toolbar-locked" q-title-translation="Hub.App.ReadOnly"></i>\r\n								<span qve-highlight class="qv-text" text="{{item.qTitle}}" query="search.text"></span>\r\n							</div>\r\n							<div ng-if="isPersonalMode" class="details" title="{{item.qDocId}}" tid="file-name">\r\n								<span q-translation="AppDetails.FileName"></span> <i>{{ item.qDocId }}</i>\r\n							</div>\r\n							<div ng-if="item.qReadOnly" class="details" q-translation="Hub.App.ReadOnly" tid="ro-text"></div>\r\n							<div class="details item-stream" ng-if="isGlobalSearch && !isPersonalMode">\r\n								<span ng-if="item.qMeta.stream.name" q-translation="Hub.Stream"></span>\r\n								<span>{{getStreamName(item.qMeta.stream.name)}}</span>\r\n							</div>\r\n							<div class="details" tid="published-text" ng-if="!isGrid && !isPersonalMode && item.qMeta.published">\r\n								<span q-translation="Hub.PublishedDate"></span>\r\n								<qve-formate-date date="item.qMeta.publishTime" format="LLL"></qve-formate-date>\r\n							</div>\r\n							<div class="description" ng-if="!isGrid"><span data-action="goToApp"><span qve-highlight text="{{item.qMeta.description}}" query="search.text"></span></span></div>\r\n						</div>\r\n					</div>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("client.views/app-overview/directives/item-thumb/item-thumb-config",["general.utils/visualizations","core.utils/deferred","require"],function(visualizations,Deferred,require){function calculateData(input){var data={};return data.width=input.width-input.numCols*input.spacing,data.height=input.height-input.numRows*input.spacing,data.columnWidth=data.width/input.numCols,data.rowHeight=data.height/input.numRows,data.cols=input.numCols,data.rows=input.numRows,data.spacing=input.spacing,data}function renderCell(ctx,renderData,cellData){var width=cellData.colspan/renderData.cols*renderData.width+(cellData.colspan-2)*renderData.spacing,height=cellData.rowspan/renderData.rows*renderData.height+(cellData.rowspan-2)*renderData.spacing,xPos=renderData.spacing+renderData.columnWidth*cellData.col+renderData.spacing*cellData.col,yPos=renderData.spacing+renderData.rowHeight*cellData.row+renderData.spacing*cellData.row,calcedFontSize=width>=height?height:width;ctx.fillStyle="rgb(242, 242, 242)",ctx.fillRect(xPos,yPos,width,height),calcedFontSize=Math.round(.5*calcedFontSize),calcedFontSize=Math.max(8,Math.min(calcedFontSize,20)),ctx.fillStyle="rgba(89, 89, 89,0.6)",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=calcedFontSize*canvasMultiplier+"px 'QlikView Icons'",ctx.fillText(visualizations.getIconChar(cellData.type)||"g",xPos+width/2,yPos+height/2)}var defaultSizesFromUx={width:144,height:96},canvasMultiplier=2,conf={staticSrc:{staticPublishedSheet:function(){return require.toUrl("img/appoverview/Ic_SheetPublished.png")},staticUnPublishedSheet:function(){return require.toUrl("img/appoverview/Ic_SheetUnpublished.png")},staticPublishedStory:function(){return require.toUrl("img/appoverview/Ic_StoryPublished.png")},staticUnPublishedStory:function(){return require.toUrl("img/appoverview/Ic_StoryUnpublished.png")},staticApp:function(){return require.toUrl("img/appoverview/Ic_AppBig.png")},brokenImage:function(){return require.toUrl("img/appoverview/Ic_BrokenBig.png")}},dimensions:{original:defaultSizesFromUx,width:defaultSizesFromUx.width-2,height:defaultSizesFromUx.height-2,spacing:2},getSrc:function(isPub,isSheet){var tag=isSheet?"Sheet":"Story",item=isPub?"staticPublished":"staticUnPublished";return conf.staticSrc[item+tag]()},generateImageForStory:function(scope,story,slide){var dfd=new Deferred;return story.getLayout(scope.item.qInfo.qId).then(function(stry){stry.qChildList&&stry.qChildList.qItems.length?(scope.slide=stry.qChildList.qItems.slice().sort(function(a,b){return a.qData.rank===b.qData.rank?0:a.qData.rank<b.qData.rank?-1:1})[0],scope.slide?slide.getLayout(scope.slide.qInfo.qId).then(function(layout){layout.qChildList.qItems.length>0?dfd.resolve():dfd.reject()}):dfd.reject()):dfd.reject()}),dfd.promise},paintCanvas:function(item){function render(cells){cells.forEach(function(cell){renderCell(ctx,renderData,cell)})}var renderData,ctx,src,canvas=document.createElement("canvas");return renderData=calculateData({width:conf.dimensions.width*canvasMultiplier,height:conf.dimensions.height*canvasMultiplier,spacing:conf.dimensions.spacing,numRows:item.qData.rows,numCols:item.qData.columns}),canvas.width=conf.dimensions.width*canvasMultiplier,canvas.height=conf.dimensions.height*canvasMultiplier,ctx=canvas.getContext("2d"),ctx.clearRect(0,0,canvas.width,canvas.height),render(item.qData.cells),src=canvas.toDataURL(),ctx=null,renderData=null,canvas.remove&&canvas.remove(),canvas=null,src}};return conf}),define("assets/hub/hub-item",["qvangular","assets/hub/hub-model","assets/hub/common/hub-session","general.controllers/route-controller","assets/hub/hub-routing","translator","hub.files/hub-state","core.utils/external-urls","core.models/app","encoder","client.controllers/error-handler-controller"],function(qvangular,hubModel,hubSession,RouteController,routing,translator,HubState,externalUrls,App,encoder,ErrorHandler){"use strict";function duplicateApp(scope){HubState.setIsDuplicating(!0,scope.clickedItem),hubModel.rpcCall(hubSession.getQRSSession(),"App.Duplicate",[{id:scope.clickedItem.qDocId}]).then(function(id){HubState.setIsDuplicating(!1,{id:id.result.value})},function(error){error.isHandled=!0,ErrorHandler.showDialog({code:error.error.code}),HubState.setIsDuplicating(!1,{id:-1})}),scope.clickedItem.qMeta.published&&routing.changeUrl(RouteController.buildUrl("my","work"))}function openAppWithoutData(scope){var url;url=scope.isPersonalMode?RouteController.buildUrl(!0,"sense","app",scope.clickedItem.qDocId.substr(0,scope.clickedItem.qDocId.length-4),"noData","true"):RouteController.buildUrl(!0,"sense","app",scope.clickedItem.qDocId,"noData","true"),window.open(url)}function deleteApp(scope){delayedModal.open({title:"Hub.Confirm.Delete.Title",content:translator.get("Hub.Confirm.Delete.Description",[scope.clickedItem.qTitle]),buttons:[{name:"Common.Cancel"},{name:"Common.Delete",defaultButton:!0,callback:function(){var promise;scope.clickedItem.isDisabled=!0,promise=scope.isPersonalMode?App.remove(scope.clickedItem.qDocId,hubSession.getEngineSession()):hubModel.rpcCall(hubSession.getQRSSession(),"App.Delete",[{id:scope.clickedItem.qDocId}]),promise.then(function(){scope.$root.$broadcast("appListModified",!1)},function(){scope.clickedItem.isDisabled=!1})}}]})}function uploadApp(clickedItem){var url=externalUrls.cloudUploadUrl,first=!0;clickedItem.qDocId&&(url+="FilePath="+encoder.encodeForURL(clickedItem.qDocId),first=!1),clickedItem.qDocName&&(first||(url+="&"),url+="FileName="+encoder.encodeForURL(clickedItem.qDocName),first=!1),clickedItem.qTitle&&(first||(url+="&"),url+="DisplayTitle="+encoder.encodeForURL(clickedItem.qTitle)),window.open(url)}var delayedModal=qvangular.getService("$delayedModal");return{duplicateApp:duplicateApp,openAppWithoutData:openAppWithoutData,deleteApp:deleteApp,uploadApp:uploadApp}}),define("hub.files/content/hub-contextmenu/hub-contextmenu-items",["general.utils/responsive-state","assets/hub/hub-item","util","assets/hub/hub-factory","hub.files/hub-state"],function(ResponsiveState,hubItem,util,hubFactory,HubState){function createDeleteMenuItem($scope){var clickedItem=$scope.clickedItem,closeView=$scope.closeView,canDelete=!(!$scope.clickedItem.privileges||-1===$scope.clickedItem.privileges.indexOf("delete"))||$scope.isPersonalMode,isDisabled=HubState.isDuplicating&&clickedItem.qDocId===HubState.duplicatingItem.qDocId;return clickedItem.qReadOnly||ResponsiveState.isSmallDevice||!canDelete?null:{text:"Common.Delete",tid:"delete",disabled:isDisabled,action:function(){closeView(),hubItem.deleteApp($scope)}}}function createUploadMenuItem($scope){var clickedItem=$scope.clickedItem,closeView=$scope.closeView;return $scope.isPersonalMode?{text:"contextMenu.upload",tid:"upload",action:function(){closeView(),hubItem.uploadApp(clickedItem)}}:null}function createOpenWithoutDataItem($scope){var clickedItem=$scope.clickedItem,closeView=$scope.closeView;return $scope.isPersonalMode&&util.hasFileExtension(clickedItem.qDocName,"qvw")||clickedItem.qMeta.published?null:{text:"contextMenu.openWithoutData",tid:"openWithoutData",action:function(){closeView(),hubItem.openAppWithoutData($scope)}}}function createDuplicateMenuItem($scope){var closeView=$scope.closeView;return checkDuplicatePermissions($scope)?{text:"Common.Duplicate",tid:"duplicate",disabled:HubState.isDuplicating,action:function(){hubItem.duplicateApp($scope),closeView()}}:null}function checkDuplicatePermissions($scope){return!$scope.isPersonalMode&&$scope.isAppOwner&&!$scope.isSmallDevice&&hubFactory.exports.allowCreateApp}return{createDeleteMenuItem:createDeleteMenuItem,createUploadMenuItem:createUploadMenuItem,createOpenWithoutDataItem:createOpenWithoutDataItem,createDuplicateMenuItem:createDuplicateMenuItem}}),define("text!client.views/app-overview/directives/contextmenu/contextmenu.ng.html",[],function(){return'<immidiate-contextual hidepointer="true" position="bottom" width="200" height="auto" on-close-view="closeView()" style="z-index: 10000;" ng-if="showMenu">\r\n	<ul class="qui-textlist">\r\n		<li ng-repeat="menuItem in menuItems" qva-activate="menuItem.disabled || menuItem.action( $event )" ng-disabled="menuItem.disabled">\r\n			<span class="qui-textlist-text" tid="{{menuItem.tid}}" q-translation="{{menuItem.text}}"></span>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>'}),define("hub.files/content/hub-contextmenu/hub-contextmenu",["hub.files/content/hub-contextmenu/hub-contextmenu-items","text!client.views/app-overview/directives/contextmenu/contextmenu.ng.html","core.utils/resize","qvangular","general.components/immidiate-contextual/immidiate-contextual"],function(contextMenuItems,template,Resize){var contextMenu={template:template,controller:["$scope",function($scope){var onResize,returnedMenuItems=[];$scope.closeView=function(){$scope.destroyComponent()},returnedMenuItems.push(contextMenuItems.createOpenWithoutDataItem($scope)),returnedMenuItems.push(contextMenuItems.createUploadMenuItem($scope)),returnedMenuItems.push(contextMenuItems.createDuplicateMenuItem($scope)),returnedMenuItems.push(contextMenuItems.createDeleteMenuItem($scope)),$scope.menuItems=returnedMenuItems.filter(function(element){return null!==element}),$scope.showMenu=$scope.menuItems.length>0,onResize=function(){$scope.closeView()},Resize.on("end",onResize),
$scope.$on("$destroy",function(){Resize.off("end",onResize)})}]};return contextMenu}),define("text!assets/hub/content/app-thumb/app-thumb.ng.html",[],function(){return'<div class="app-thumbnail-wrapper" data-action="goToApp">\r\n	<div class="thumb-hover"></div>\r\n	<img ng-src="{{ imgSrc }}" draggable="false" class="img app-thumbnail img-no-drag qv-img-thumb"/>\r\n</div>'}),define("hub.files/content/content",["jquery","qvangular","assets/hub/hub-model","hub.files/hub-state","general.controllers/route-controller","text!assets/hub/content/content.ng.html","translator","client.views/app-overview/directives/item-thumb/item-thumb-config","util","general.utils/dom-util","general.models/media-library","hub.files/content/hub-contextmenu/hub-contextmenu","general.utils/responsive-state","core.utils/authentication","text!assets/hub/content/app-thumb/app-thumb.ng.html","general.services/expandable/expandable","client.views/app-overview/directives/expandable/expandable"],function($,qvangular,hubModel,HubState,RouteController,template,translator,thumbConfig,util,domUtil,MediaLibraryModel,contextMenu,responsiveState,authentication,appThumbTemplate){"use strict";function getMediaLibraryLink(thatLink){var link=MediaLibraryModel.stripBasePath(thatLink);return MediaLibraryModel.addBasePath(link)}function getDefaultAppImg(scope){return getMediaLibraryLink(scope.item.qThumbnail.qUrl||thumbConfig.staticSrc.staticApp())}function setThumbnail(link,scope){scope.imgSrc=link,qvangular.$apply(scope)}function stripExtension(fileName){var hasMultipleExtensions,newFileName,hasQvf=util.hasFileExtension(fileName,"qvf");return newFileName=hasQvf?util.removeExtensionFromName(fileName,"qvf"):util.removeExtensionFromName(fileName,"qvw"),hasMultipleExtensions=hasQvf?util.hasFileExtension(newFileName,"qvf"):util.hasFileExtension(newFileName,"qvw"),hasMultipleExtensions?fileName:newFileName}function goToApp(title,rc){var url=rc.buildUrl(!0,"sense","app",stripExtension(title));sessionStorage.setItem("hasShownhasScriptButNoData",!1),!responsiveState.isSmallDevice||qvangular.$rootScope.isPersonalMode?window.open(url):rc.setUrl(url)}function toggleExpandable(that,expandable){var scrollElem,element=that.element.closest("li"),scrollSelector=responsiveState.isSmallDevice?".hub-content-wrapper":".hub-as";scrollElem=element.closest(scrollSelector),expandable.open({isHub:!0,parent:element.closest("ul"),scrollElem:scrollElem,elem:element,currentItem:that.scope.item,currentId:that.scope.item.qDocId,currentTitle:that.scope.item.qTitle,currentDescription:that.scope.item.qMeta.description,dynamicColor:that.scope.item.qMeta.dynamicColor,pointerOffset:responsiveState.isSmallDevice?8:0,index:that.scope.$index,isEditMode:!1,thatScope:that.scope,template:"<qv-expandable-read />"},that.scope,null,scrollSelector,!1)}function performAction(that,fakeScopeForExpandable){switch(that.action){case"goToItem":goToApp(fakeScopeForExpandable.$fakeScope.item.qDocId,RouteController);break;case"goToApp":that.scope.item.isDisabled||goToApp(that.scope.item.qDocId,RouteController);break;case"toggleExpandable":that.scope.item.isDisabled||toggleExpandable(that,$expandable)}}function isScrollClick(e){var descCont,hasScroll,scrollBarPos,isScrollClick,scrollCont=$(e.target).closest(".description"),pointerPos=e.pageX;return scrollCont.length&&(descCont=scrollCont.find("[data-action]"),hasScroll=descCont.height()>scrollCont.height(),scrollBarPos=scrollCont[0].getBoundingClientRect().right-15,isScrollClick=hasScroll&&pointerPos>=scrollBarPos),isScrollClick}function doClick(e){var that=domUtil.getAction(e,"li",!0);that.action&&!isScrollClick(e)&&performAction(that,e)}function doContextMenuClick(e){var closestLi=$(e.target).closest("li"),isAppOwner=!0;if(0!==closestLi.length){var popoverElem=$("div.qv-popover-container");if(!qvangular.$rootScope.isPersonalMode){var authData=authentication.userDirectory+" "+authentication.userId,appItemMeta=closestLi.scope().item.qMeta,appOwnerData=appItemMeta.userDir+" "+appItemMeta.userId;isAppOwner=authData===appOwnerData}popoverElem.showComponent(contextMenu,{event:e,isAppOwner:isAppOwner,clickedItem:closestLi.scope().item,parent:popoverElem,isSmallDevice:responsiveState.isSmallDevice})}}var $expandable=qvangular.getService("$$expandable");qvangular.directive("qvHubThumb",function(){return{restrict:"A",template:appThumbTemplate,scope:!0,link:function(scope){scope.imgSrc=getDefaultAppImg(scope),scope.$watch("item.qThumbnail.qUrl",function(link){if(link&&link.length>1){var img=new Image;link=getMediaLibraryLink(link),img.src=link,img.onerror=function(){setThumbnail(getMediaLibraryLink(thumbConfig.staticSrc.brokenImage()),scope)},img.onload=function(){setThumbnail(link,scope)}}else setThumbnail(getDefaultAppImg(scope),scope)})}}}),qvangular.directive("qveContent",function(){return{restrict:"E",replace:!0,template:template,controller:["$scope","$$expandable",function($scope,$$expandable){function getList(){$scope.appList&&($scope.$root.isPersonalMode?($scope.apps=[],$.extend($scope.apps,$scope.appList)):$scope.apps=$scope.appList.filter(function(item){return hubModel.filterApps(item.qMeta,$scope.streamId)?item:void 0}),$scope.exp.selectedFilter===hubModel.SortFilterOptions.alphabetical?hubModel.alphabeticSort($scope.apps,"qTitle",!$scope.exp.isAscending):$scope.exp.selectedFilter===hubModel.SortFilterOptions.publishedDate&&hubModel.dateSort($scope.apps,"publishTime",!$scope.exp.isAscending))}function getSearchResults(){$scope.appList&&($scope.apps=$scope.appList.filter(function(){return hubModel.alphabeticSortByStream($scope.appList.slice(),"qTitle")}).filter(function(item){return hubModel.filterSearchResults(item,$scope.search)?item:void 0}))}function doSearch(){var isGlobalS=$scope.search.text.length&&HubState.isGlobalSearch||!$scope.search.text.length&&HubState.isGlobalSearch;isGlobalS?getSearchResults():HubState.isGlobalSearch||getList()}$scope.apps=[],$scope.search={text:"",enabled:!1},$scope.performAction=doClick,$scope.onContextMenu=function(e){doContextMenuClick(e)},$scope.$on("newListReady",function(){doSearch()}),$scope.$on("resetList",function(){getList()}),$scope.$on("newSearch",function(){doSearch()}),$scope.$on("showContent",function(e,value){$scope.isSmallDevice&&($scope.showAppsContent=value)}),$scope.$watch("streamId",function(newValue,oldValue){null===newValue?($scope.savedSelectedFilter=$scope.exp.selectedFilter,$scope.exp.selectedFilter=hubModel.SortFilterOptions.alphabetical,$scope.savedIsAscending=$scope.exp.isAscending):!oldValue&&newValue&&($scope.exp.selectedFilter=$scope.savedSelectedFilter||hubModel.SortFilterOptions.alphabetical,$scope.exp.selectedFilter===hubModel.SortFilterOptions.publishedDate&&($scope.exp.isAscending=$scope.savedIsAscending,$scope.updatedByUser=!1)),getList()}),$scope.setActive=function(item){var cls="";return $$expandable.activeItem===item.qDocId&&(cls="active"),cls},$scope.getStreamName=function(streamName){return streamName?streamName:translator.get("Hub.NavigationPanel.MyWork")}}]}})}),define("text!assets/hub/sidemenu/sidemenu.ng.html",[],function(){return'<div class="hub-sidebar">\r\n	<div ng-if="showMyWorkLi" class="flex-menu-itm my-work-container">\r\n		<ul class="hub-ul">\r\n			<li tid="my-work" class="hub-li my-work" ng-class="{\'qv-active\': activeKey === \'my-work\' && !isSmallDevice}" qva-activate="gotToUrl($event, \'my\')">\r\n				<div class="hub-side-icon"><i class="icon-hub-my-work"></i></div>\r\n				<div class="hub-div hub-s-name-style" q-translation="Hub.NavigationPanel.MyWork"></div>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n	<div class="qv-stream-title" ng-if="streamsList.length">\r\n		<span>{{ "Hub.Title.Stream" | translate }}</span>\r\n	</div>\r\n	<div class="qv-streams" ng-if="streamsList.length">\r\n		<ul class="hub-ul" tid="streams">\r\n			<li class="hub-li" q-title-translation="{{stream.qName}}" ng-repeat="stream in streamsList" ng-class="{\'qv-active\': activeKey === \'{{stream.qId}}\'  && !isSmallDevice }" qva-activate="gotToUrl($event, \'stream\', \'{{stream.qId}}\')">\r\n				<div class="hub-div hub-s-name-style">{{stream.qName}}</div>\r\n			</li>\r\n\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("hub.files/sidemenu/sidemenu",["qvangular","text!assets/hub/sidemenu/sidemenu.ng.html","general.controllers/route-controller","assets/hub/hub-routing","hub.files/hub-state"],function(qvangular,template,RouteController,routing,HubState){var ctrl=["$scope",function($scope){$scope.activeKey=routing.getActiveKey(),$scope.gotToUrl=function(event,key,param){param=param?param:"work",routing.changeUrl(RouteController.buildUrl(!0,"hub",key,param)),event.preventDefault(),HubState.setView()},$scope.$on("newRoute",function(){$scope.activeKey=routing.getActiveKey()})}];return qvangular.directive("qveSideMenu",function(){"use strict";return{restrict:"E",replace:!0,template:template,controller:ctrl}}),ctrl}),define("text!assets/hub/mobile-search/mobile-search.ng.html",[],function(){return'<div class="hub-mobile-search" ng-show="isSmallDevice && !noRoute" ng-class="{\'in-stream\': hideSidebar}">\r\n	<qui-search-field on-enter="enter( $event )" class="no-border" query="search.text" disabled="!appList.length" focuscallback="searchFocus()" placeholder="Common.Search" />\r\n</div>'}),define("hub.files/mobile-search/mobile-search",["qvangular","text!assets/hub/mobile-search/mobile-search.ng.html","hub.files/hub-state","general.utils/android-keyboard-fix"],function(qvangular,template,HubState,AndroidKeyboardFix){var ctrl=["$scope","$element",function($scope,$element){$scope.enter=function(e){13===e.keyCode&&AndroidKeyboardFix.isNeeded()&&$element.find("input").blur()},$scope.searchFocus=function(){HubState.isGlobalSearch||($scope.hideSidebar=!0,HubState.setGlobalSearch(!0),$scope.$emit("saveState"),$scope.setGridListView(),$scope.$emit("newSearch"))}}];return qvangular.directive("qveMobileSearch",function(){"use strict";return{restrict:"E",replace:!0,template:template,controller:ctrl}}),ctrl}),define("text!assets/hub/getting-started/getting-started.ng.html",[],function(){return'<div class="qv-g-s">\r\n	<div class="qv-diag-ph">\r\n		<div class="qui-whiteModal" tid="hub-getting-started">\r\n			<div class="qv-header">\r\n				<div class="qv-logo"><img src="../resources/img/logo/qlik-sense-desktop.png"></div>\r\n				<div class="icon-close" qva-activate="close();" q-title-translation="Common.Close">&nbsp;</div>\r\n			</div>\r\n			<div class="qv-content">\r\n				<h1 class="message"> {{ \'Hub.GettingStarted.Message\' | translate }} </h1>\r\n				<div class="qv-ca-holder" ng-if="!$parent.isSmallDevice">\r\n					<div class="qui-gettingStartedButton" qva-activate="create();" tid="hub-gs-add">\r\n						<div class="qv-inner-border">\r\n							<div class="icon-add">&nbsp;</div>\r\n							<div class="qv-text">\r\n								<div class="qv-title">{{ \'Hub.GettingStarted.Button.CreateANewApp\' | translatetoupper }}</div>\r\n								<div class="qv-info">{{ \'Hub.GettingStarted.Button.StartExploring\' | translate }}</div>\r\n							</div>\r\n						</div>\r\n					</div>\r\n				</div>\r\n				<qui-checkbox qui-model="exp.isChecked" qui-label="{{ \'Hub.ShowAtStartup\' | translate }}"></qui-checkbox>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("hub.files/getting-started/getting-started",["jquery","qvangular","text!assets/hub/getting-started/getting-started.ng.html"],function($,qvangular,template){var key="qvHideHubGettingStarted",ctrl=["$scope","$element",function($scope,$element){var nameSpace="gettingStarted."+$scope.$id;$scope.exp={},$scope.exp.isChecked=localStorage.getItem("qvHideHubGettingStarted")||!0,$(document).on("keydown."+nameSpace,function(e){27===e.keyCode&&$scope.close()}),$scope.close=function(){localStorage.removeItem(key),$scope.exp.isChecked||localStorage.setItem(key,!0),$scope.$destroy(),$element.remove()},$scope.create=function(){$scope.createApp(),$scope.close()},$scope.$on("$destroy",function(){$(document).off("keydown."+nameSpace)})}];return qvangular.directive("qveHubGettingStarted",function(){"use strict";return{restrict:"E",replace:!0,scope:{createApp:"&"},template:template,controller:ctrl}}),ctrl}),define("text!assets/hub/getting-started/marketing-url.ng.html",[],function(){return'<div class="qui-horizontal-content-tray" tid="learnMoreQlikSense">\r\n	<div class="border-bottom"></div>\r\n	<span class="qv-holder" qva-activate="goToUrl()">{{ "Hub.GettingStarted.LinkToMarketing" | translate }}</span>\r\n</div>'}),define("assets/hub/getting-started/marketing-url",["core.utils/external-urls","qvangular","jquery","text!assets/hub/getting-started/marketing-url.ng.html"],function(eu,qvangular,$,template){var ctrl=["$scope",function($scope){$("body").addClass("has-marketing"),$scope.url=eu.gettingStarted,$scope.goToUrl=function(){window.open($scope.url)}}];return qvangular.directive("qveMarketingPlaceholder",function(){"use strict";return{restrict:"E",replace:!0,scope:!0,template:template,controller:ctrl}}),ctrl}),define("assets/datamodelviewer/services/dmv-observer-service",[],function(){function getObservers(key){var observers=allObservers[key];return observers||(allObservers[key]=observers=[]),observers}function addObserver(key,observer){if(!key)throw new Error("Key is not defined.");if("string"!=typeof key)throw new Error("Key has to a String.");if(!observer)throw new Error("No observer was defined.");if("function"!=typeof observer)throw new Error("Observer is not a function.");var observers=getObservers(key);observers.push(observer)}function notifyAll(key,arg1,arg2){if(!key)throw new Error("Key is not defined.");if("string"!=typeof key)throw new Error("Key has to a String.");var observers=getObservers(key);observers.forEach(function(obs){obs(arg1,arg2)})}function removeObserver(key,observer){if(!key)throw new Error("Key is not defined.");if(!observer)throw new Error("Observer is not defined.");var observers=getObservers(key),index=observers.indexOf(observer);if(-1===index)throw new Error('Unknown observer for the key "'+key+'".');observers.splice(index,1)}var allObservers={};return{addObserver:addObserver,notifyAll:notifyAll,removeObserver:removeObserver}}),define("scripteditor.services/explicit-save-service",["core.models/app","assets/datamodelviewer/services/dmv-observer-service","ng!$q"],function(App,observerService,$q){function resetTimeStamp(){return(new Date).getTime()}function saveApp(callbackFunction){var deferred=$q.defer();if(callbackFunction&&"function"!=typeof callbackFunction)throw new Error("The callback function specified is not a function.");return saveIsOngoing=!0,App.get().then(function(app){app.doSave().then(function(){saveIsOngoing=!1,lastSaveTimeStamp=(new Date).getTime(),updateAppProperties(notifyObserversThatAppDirtyStatusHasChanged),callbackFunction&&callbackFunction(),deferred.resolve()},function(error){saveIsOngoing=!1,deferred.reject(error)})}),deferred.promise}function getUnixTimeStampFromOLE(oaDate){var date=new Date;return date.setTime(24*(oaDate-25569)*3600*1e3),Math.floor(date.getTime()/1e3)}function updateTimeStampsFromAppInfo(){lastSaveTimeStamp=getUnixTimeStampFromOLE(appInfo.qUtcLastSaveTime),lastRunScriptTimeStamp=getUnixTimeStampFromOLE(appInfo.qUtcLastReloadTime),lastChangeTimeStamp=lastSaveTimeStamp}function updateAppProperties(callbackFunction){App.get().then(function(app){app.getProperties().then(function(result){appInfo=result,updateTimeStampsFromAppInfo(),callbackFunction&&callbackFunction()})})}function init(){lastChangeTimeStamp=resetTimeStamp(),App.get().then(function(app){app.getProperties().then(function(result){appInfo=result,updateTimeStampsFromAppInfo()}).then(function(){app.getLayout().then(function(layout){appTitle=layout.qTitle?layout.qTitle:layout.qFileName?layout.qFileName.replace(/\.(qvw|qvf)$/i,""):""})}),app.Invalidated.bind(function(){app.getLayout().then(function(layout){layout.qModified&&notifyThatNewChangeIsDoneAndSaveIsRequired()})})})}function updateWhenLastScriptWasExecuted(){updateAppProperties(notifyObserversThatAppDirtyStatusHasChanged)}function isAppDirty(){if(lastChangeTimeStamp&&!lastSaveTimeStamp)return!0;var isDirty=lastChangeTimeStamp>lastSaveTimeStamp;return isDirty}function isSaveOngoing(){return saveIsOngoing}function haveWeDoneSaveButNoReload(){var result=lastSaveTimeStamp>lastRunScriptTimeStamp;return result}function onAppIsNowDirty(observer){observerService.addObserver(OBSERVER_KEY_APP_IS_NOW_DIRTY,observer)}function onAppIsNowClean(observer){observerService.addObserver(OBSERVER_KEY_APP_IS_NOW_CLEAN,observer)}function notifyObserversThatAppDirtyStatusHasChanged(){setTimeout(function(){var weDoneSaveButNoReload=haveWeDoneSaveButNoReload(),key=isAppDirty()?OBSERVER_KEY_APP_IS_NOW_DIRTY:OBSERVER_KEY_APP_IS_NOW_CLEAN;observerService.notifyAll(key,weDoneSaveButNoReload)},0)}function notifyThatNewChangeIsDoneAndSaveIsRequired(){previousLastChangeTimeStamp=lastChangeTimeStamp,lastChangeTimeStamp=resetTimeStamp(),notifyObserversThatAppDirtyStatusHasChanged()}function getLastSavedAsString(){return appInfo&&appInfo.qLastSaveTimeAsString?appInfo.qLastSaveTimeAsString:""}function getLastReloadAsString(){return appInfo&&appInfo.qLastReloadTimeAsString?appInfo.qLastReloadTimeAsString:""}function getTitle(){return appTitle}function doDirtyRollback(){if(!lastChangeTimeStamp)throw new Error("Cannot do rollback since the app has never been flagged as dirty.");lastChangeTimeStamp=previousLastChangeTimeStamp,notifyObserversThatAppDirtyStatusHasChanged()}var previousLastChangeTimeStamp,lastChangeTimeStamp,lastSaveTimeStamp,lastRunScriptTimeStamp,saveIsOngoing=!1,appTitle="",appInfo={qLastSaveTimeAsString:"2013-08-08 13:15:19",qLastReloadTimeAsString:"2013-08-08 13:15:19"},OBSERVER_KEY_APP_IS_NOW_DIRTY="OBSERVER_KEY_APP_IS_NOW_DIRTY",OBSERVER_KEY_APP_IS_NOW_CLEAN="OBSERVER_KEY_APP_IS_NOW_CLEAN";return{saveApp:saveApp,haveWeDoneSaveButNoReload:haveWeDoneSaveButNoReload,notifyThatNewChangeIsDoneAndSaveIsRequired:notifyThatNewChangeIsDoneAndSaveIsRequired,updateWhenLastScriptWasExecuted:updateWhenLastScriptWasExecuted,isAppDirty:isAppDirty,isSaveOngoing:isSaveOngoing,onAppIsNowDirty:onAppIsNowDirty,onAppIsNowClean:onAppIsNowClean,getLastSavedAsString:getLastSavedAsString,getLastReloadAsString:getLastReloadAsString,getTitle:getTitle,init:init,doDirtyRollback:doDirtyRollback}}),define("text!general.views/confirm-dialog/confirm-dialog.ng.html",[],function(){return'<div class="qv-modal-container qui-modalbackground" qva-outside-ignore-for="allOutside" ng-style="containerStyle">\r\n	<div class="qui-delayedModal" qv-global-escape="onEscape()">\r\n		<header class="dm-header">{{ translatedHeader }}</header>\r\n		<main class="dm-main">\r\n			<p>{{ translatedContent }}</p>\r\n			<span ng-if="options.moreContent">\r\n				<br>\r\n				<span q-translation="{{ options.moreContent }}"></span>\r\n			</span>\r\n\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button ng-if="options.showDeclineButton" qva-activate="$event.preventDefault(); onDeclineButtonClicked();" q-translation="{{ options.declineButtonTitle }}" id="declineButton" tid="2e68fc"></qui-button>\r\n			<qui-button ng-if="options.showConfirmButton" qva-activate="$event.preventDefault(); onConfirmButtonClicked();" q-translation="{{ options.confirmButtonTitle }}" id="confirmButton" tid="2e68f8" qva-focus="true"></qui-button>\r\n		</footer>\r\n	</div>\r\n</div>'}),define("general.views/confirm-dialog/confirm-dialog",["jquery","text!general.views/confirm-dialog/confirm-dialog.ng.html","general.services/show-service/show-service","translator"],function($,template,showService,translator){function confirmAction(incomingOptions){var options={showConfirmButton:!0,showDeclineButton:!0,confirmButtonTitle:"Common.OK",declineButtonTitle:"Common.Cancel"};return $.extend(options,incomingOptions),showService.show(dialog,{options:options})}var dialog={template:template,scope:{options:"="},controller:["$scope",function($scope){$scope.translatedHeader=translator.get($scope.options.header,$scope.options.headerParameter),$scope.translatedContent=translator.get($scope.options.content,$scope.options.contentParameter),$scope.options.closePromise&&$scope.options.closePromise.then(function(){$scope.destroyComponent()}),$scope.onConfirmButtonClicked=function(){$scope.destroyComponent(),$scope.deferredResult.resolve(!0)},$scope.onEscape=$scope.onDeclineButtonClicked=function(){$scope.destroyComponent(),$scope.deferredResult.reject()}}]};return{confirmAction:confirmAction}}),define("core.utils/environment",["core.utils/deferred","qvangular","core.utils/help-url"],function(Deferred,qvangular,helpUrl){var environment={},dfd=null;return environment.setup=function(session){return dfd||(dfd=new Deferred,session.rpc({method:"IsPersonalMode",handle:-1,params:[]}).then(function(result){var isPersonalMode=result.result.qReturn;qvangular.$rootScope.isPersonalMode=isPersonalMode,helpUrl.setBaseUrl(isPersonalMode),dfd.resolve({isPersonalMode:isPersonalMode})})),dfd.promise},environment}),define("scripteditor.services/keywords",[],function(){function getAllKeywordsAsLowerCase(){return keywordsAsLowerCase}function getAllKeywords(){return keywords}function setAllKeywords(_keywords){keywords=_keywords}function setAllKeywordsAsLowerCase(_keywordsAsLowerCase){keywordsAsLowerCase=_keywordsAsLowerCase}var keywords,keywordsAsLowerCase,exports={setAllKeywordsAsLowerCase:setAllKeywordsAsLowerCase,getAllKeywordsAsLowerCase:getAllKeywordsAsLowerCase,setAllKeywords:setAllKeywords,getAllKeywords:getAllKeywords};return exports}),define("assets/hldm/models/input-table-model",["jquery"],function($){function getByNameOrCreate(array,name,fn){for(var i in array)if(array[i].name===name)return array[i];var newItem;return fn&&(newItem=fn(name),array.push(newItem)),newItem}function createFieldModel(name){var fieldModel={name:name,alias:name,selected:!1};return fieldModel}function createInputTableModel(data){function getOrCreateFieldByName(fieldName){return getByNameOrCreate(data.fields,fieldName,createFieldModel)}function getFieldByName(fieldName){return getByNameOrCreate(data.fields,fieldName)}function isNothingSelected(){for(var i in data.fields)if(data.fields[i].selected)return!1;return!0}function setFieldSelected(fieldName,selected){data.state="modified",getOrCreateFieldByName(fieldName).selected=selected,tableModel.markedForRemoval=!1}function isFieldSelected(fieldName){return getOrCreateFieldByName(fieldName).selected}function selectedFieldsCount(){var count=0;for(var i in data.fields)data.fields[i].selected&&count++;return count}function fieldsCount(){return data.fields.length}function changeFieldAlias(oldAlias,newAlias){data.state="modified";for(var i in data.fields)if(data.fields[i].alias===oldAlias){data.fields[i].alias=newAlias?newAlias:data.fields[i].name;break}}function setFieldAlias(name,newAlias){newAlias||(newAlias=name),data.state="modified";for(var i in data.fields)if(data.fields[i].name===name){data.fields[i].alias=newAlias;break}}function qualifyField(name){data.state="modified";for(var i in data.fields)if(data.fields[i].name===name){data.fields[i].alias=data.tableName+"."+data.fields[i].name;break}}function getOriginalFieldNameFromAlias(oldAlias){for(var i in data.fields)if(data.fields[i].alias===oldAlias)return data.fields[i].name}function getFieldAlias(name){for(var i in data.fields)if(data.fields[i].name===name)return data.fields[i].alias||data.fields[i].name}function isFieldNameInUse(alias){for(var i in data.fields)if(data.fields[i].alias===alias)return!0;return!1}function setFormatSpec(formatSpec){tableModel.data.formatSpec=formatSpec}function getTableAlias(){return void 0===data.tableAlias||""===data.tableAlias?data.tableName:data.tableAlias}function pruneOtherFields(fieldNames){var i,fieldNamesToKeepMap={};for(i in fieldNames)fieldNamesToKeepMap[fieldNames[i]]=!0;for(i in tableModel.data.fields){var field=tableModel.data.fields[i];fieldNamesToKeepMap[field.name]||(field.selected=!1)}}function registerFieldSourceRename(oldName,newName,selected){var oldField=getFieldByName(oldName),newField=getFieldByName(newName);if(oldField&&newField){var index=data.fields.indexOf(oldField);-1!==index&&data.fields.splice(index,1),oldField.alias!==oldField.name&&(newField.alias=oldField.alias),newField.selected=selected}else oldField?(oldField.alias===oldField.name&&(oldField.alias=newName),oldField.name=newName,oldField.selected=selected):newField||getOrCreateFieldByName(newName)}function markForRemoval(){tableModel.markedForRemoval=!0;for(var i in data.fields)data.fields[i].selected=!1}function serialize(){data.tableAlias=getTableAlias();var copy=$.extend(!0,{},data);return delete copy.state,copy}function isNew(){return!!data.state}var tableModel={data:data,markedForRemoval:!1,markForRemoval:markForRemoval,setFieldSelected:setFieldSelected,isFieldSelected:isFieldSelected,serialize:serialize,selectedFieldsCount:selectedFieldsCount,getOriginalFieldNameFromAlias:getOriginalFieldNameFromAlias,getFieldAlias:getFieldAlias,changeFieldAlias:changeFieldAlias,qualifyField:qualifyField,isFieldNameInUse:isFieldNameInUse,registerFieldSourceRename:registerFieldSourceRename,fieldsCount:fieldsCount,setFormatSpec:setFormatSpec,setFieldAlias:setFieldAlias,getFieldByOriginalName:getOrCreateFieldByName,isNew:isNew,isNothingSelected:isNothingSelected,pruneOtherFields:pruneOtherFields,getTableAlias:getTableAlias};return tableModel}var exports={create:createInputTableModel};return exports}),define("assets/hldm/models/table-transformation-model",[],function(){function createTableTransformationModel(data){function serialize(){return data}var transformationModel={data:data,serialize:serialize};return transformationModel}var exports={create:createTableTransformationModel};return exports}),define("assets/hldm/models/association-node-model",[],function(){function createAssociationsNodeModel(data){function serialize(){return associationNodeModel.data}data.assocloc=data.assocloc||"0 0";var associationNodeModel={serialize:serialize,data:data};return Object.defineProperty(associationNodeModel,"assocloc",{set:function(assocloc){associationNodeModel.data.assocloc=assocloc},get:function(){return associationNodeModel.data.assocloc}}),Object.defineProperty(associationNodeModel,"key",{set:function(key){associationNodeModel.data.key=key},get:function(){return associationNodeModel.data.key}}),Object.defineProperty(associationNodeModel,"category",{set:function(category){associationNodeModel.data.category=category},get:function(){return associationNodeModel.data.category}}),associationNodeModel}var exports={create:createAssociationsNodeModel};return exports}),define("assets/hldm/models/load-model-storage",["jquery","core.utils/deferred","core.models/generic-object"],function($,Deferred,GenericObject){function loadModelExists(listLayout){for(var i in listLayout)if("LoadModel"===listLayout[i].qInfo.qId)return!0;return!1}function getExistingLoadModelGenericObject(){return ensureListMonitoringStarted(),loadModelGOAtStartupDeferred.promise}function awaitGenericObject(){return loadModelGODeferred.promise}function setProperties(serializedUpdates){var returnResult={qInfo:{qType:"LoadModel",qId:"LoadModel"}};return $.extend(returnResult,serializedUpdates),loadModelGO||LoadModelModel.create({qInfo:{qType:"LoadModel",qId:"LoadModel"}}),loadModelGODeferred.promise.then(function(){return loadModelGO.setProperties(returnResult)})}function ensureListMonitoringStarted(){listMonitoringStarted||(listMonitoringStarted=!0,LoadModelModel.getList().then(function(listModel){listModel.getLayout().then(function(firstListLayout){loadModelExists(firstListLayout)?LoadModelModel.get("LoadModel").then(function(loadModelResult){loadModelGOAtStartupDeferred.resolve(loadModelResult),loadModelGO=loadModelResult,loadModelGODeferred.resolve(loadModelResult)}):(loadModelGOAtStartupDeferred.resolve(void 0),listModel.Invalidated.bind(function listModelInvalidated(){listModel.getLayout().then(function(listLayout){loadModelExists(listLayout)&&(listModel.Invalidated.unbind(listModelInvalidated),LoadModelModel.get("LoadModel").then(function(loadModelResult){loadModelGO=loadModelResult,loadModelGODeferred.resolve(loadModelResult)}))})}))})}))}var loadModelGO,LoadModelModel=GenericObject.extend("LoadModel",{},{listProperties:{qAppObjectListDef:{qType:"LoadModel"}}}),listMonitoringStarted=!1,loadModelGOAtStartupDeferred=Deferred(),loadModelGODeferred=Deferred(),exports={getExistingLoadModelGenericObject:getExistingLoadModelGenericObject,awaitGenericObject:awaitGenericObject,setProperties:setProperties};return exports}),define("assets/hldm/models/load-model",["jquery","underscore","assets/hldm/models/input-table-model","assets/hldm/models/table-transformation-model","assets/hldm/models/association-node-model","assets/hldm/models/load-model-storage"],function($,_,InputTableModel,TransformationModel,AssociationNodeModel,loadModelStorage){function createLoadModel(serialized){function _createAndAddToCollection(collection,model,data){var item=model.create(data);return collection.push(item),item}function _overwriteCollection(collection,serializedCollection,model){collection.splice(0,collection.length),serializedCollection&&serializedCollection.forEach(function(data){return _createAndAddToCollection(collection,model,data)})}function hasTableWithConnection(conn){for(var i in tableModels)if(tableModels[i].data.dataconnectorName===conn)return!0;return!1}function _removeUnusedConnections(){for(var conn in connectionMetaDataModels)connectionMetaDataModels.hasOwnProperty(conn)&&(hasTableWithConnection(conn)||delete connectionMetaDataModels[conn])}function overwriteContent(serialized){connectionMetaDataModels=serialized.connectionMetaDataModels||{},_overwriteCollection(tableModels,serialized.tables,InputTableModel),_overwriteCollection(transformations,serialized.transformations,TransformationModel),_overwriteCollection(associationNodeModels,serialized.associationNodes,AssociationNodeModel),loadModel.version++}function getDataconnectorSelectionEditor(dataconnector){function setMetadataModelForConnection(connectionInfo){connectionMetaDataModels[dataconnector.name]=$.extend(!0,{},dataconnector,{dbInfo:connectionInfo})}function getTableModelByDatabasePath(databaseName,ownerName,tableName){for(var i in tableModels)if(tableModels[i].data.dataconnectorName===dataconnector.name&&tableModels[i].data.databaseName===databaseName&&tableModels[i].data.ownerName===ownerName&&tableModels[i].data.tableName===tableName)return tableModels[i];return void 0}function getUniqueTableName(tableName){for(var counter=0,uniqueName=tableName,baseName=tableName;getTableModelWithName(uniqueName);)uniqueName=baseName+"-"+ ++counter;return uniqueName}function getOrCreateTableModelByDatabasePath(databaseName,ownerName,tableName){var existing=getTableModelByDatabasePath(databaseName,ownerName,tableName);if(existing)return existing;var connType=dataconnector.typeName?dataconnector.typeName:dataconnector.type,data={dataconnectorName:dataconnector.name,boxType:"folder"===connType||"internet"===connType?"load-file":"load-sql",databaseName:databaseName,ownerName:ownerName,tableName:tableName,tableAlias:getUniqueTableName(tableName),key:dataconnector.name+":"+databaseName+":"+ownerName+":"+tableName,fields:[],calculatedFields:[],state:"new"};return _createAndAddToCollection(tableModels,InputTableModel,data)}var dataconnectorSelectionEditor={getTableModelByDatabasePath:getTableModelByDatabasePath,getOrCreateTableModelByDatabasePath:getOrCreateTableModelByDatabasePath,setMetadataModelForConnection:setMetadataModelForConnection};return dataconnectorSelectionEditor}function serialize(){function emptyFieldLists(tableModel){return!tableModel.isNothingSelected()}var result={tables:tableModels.filter(emptyFieldLists).map(function(tableModel){return tableModel.serialize()}),transformations:transformations.map(function(transformation){return transformation.serialize()}),associationNodes:associationNodeModels.map(function(associationNode){return associationNode.serialize()}),connectionMetaDataModels:connectionMetaDataModels
};return result}function findTableByKey(tableKey){for(var i in tableModels)if(tableModels[i].data.key===tableKey)return tableModels[i];return void 0}function changeTableFieldAlias(tableKey,oldAlias,newAlias){var table=findTableByKey(tableKey),exists=_.find(table.data.fields,function(field){return field.alias===newAlias});return exists?!1:(table.changeFieldAlias(oldAlias,newAlias),!0)}function qualifyTableField(tableKey,fieldName){var table=findTableByKey(tableKey);if(table){var qualifiedName=table.getOriginalFieldNameFromAlias(fieldName);isFieldNameInUse(qualifiedName)&&(qualifiedName=table.data.tableName+"."+qualifiedName),qualifiedName===fieldName&&(qualifiedName+="_"),table.changeFieldAlias(fieldName,qualifiedName)}}function qualifyTableFields(fromKey,fromAlias,toKey,toAlias){var tempNameFrom=TEMP_NAME_PREFIX+tempCounter++,tempNameTo=TEMP_NAME_PREFIX+tempCounter++,fromTable=findTableByKey(fromKey),toTable=findTableByKey(toKey),originalFromFieldName=fromTable.getOriginalFieldNameFromAlias(fromAlias),originalToFieldName=toTable.getOriginalFieldNameFromAlias(toAlias);fromTable.changeFieldAlias(fromAlias,tempNameFrom),toTable.changeFieldAlias(toAlias,tempNameTo),fromTable.isFieldNameInUse(originalFromFieldName)?fromTable.changeFieldAlias(tempNameFrom,fromTable.data.tableName+"."+fromAlias):fromTable.changeFieldAlias(tempNameFrom,originalFromFieldName),toTable.isFieldNameInUse(originalToFieldName)||originalToFieldName===originalFromFieldName?toTable.changeFieldAlias(tempNameTo,toTable.data.tableName+"."+toAlias):toTable.changeFieldAlias(tempNameTo,originalToFieldName)}function setCurrentTableModel(tableModel){loadModel.currentTableModel=tableModel}function isFieldNameInUse(alias){for(var i in tableModels)if(tableModels[i].isFieldNameInUse(alias))return!0;return!1}function remove(objectOrKey){var key;key="object"==typeof objectOrKey?objectOrKey.key:objectOrKey;var i;for(i in loadModel.transformations)if(loadModel.transformations[i].data.key===key){loadModel.transformations.splice(i,1);break}for(i in tableModels)if(tableModels[i].data.key===key){tableModels.splice(i,1);break}}function getConnectionMetaDataModel(name){return connectionMetaDataModels[name]}function getTableModelWithName(name){for(var i in tableModels){var tableModel=tableModels[i];if(tableModel.getTableAlias()===name)return tableModel}return void 0}function clone(){return createLoadModel(serialize())}function removeAllTablesMarkedForRemoval(){tableModels.filter(function(tableModel){return tableModel.markedForRemoval}).forEach(function(tableModel){remove(tableModel.data.key)}),_removeUnusedConnections()}function createTransformation(data){transformations.push(TransformationModel.create(data))}var tableModels=[],associationNodeModels=[],transformations=[],connectionMetaDataModels={},tempCounter=0,TEMP_NAME_PREFIX="9576934875038746211194868",loadModel={generalCounter:0,version:0,getDataconnectorSelectionEditor:getDataconnectorSelectionEditor,overwriteContent:overwriteContent,serialize:serialize,toString:toString,tableModels:tableModels,transformations:transformations,associationNodeModels:associationNodeModels,isFieldNameInUse:isFieldNameInUse,getConnectionMetaDataModel:getConnectionMetaDataModel,changeTableFieldAlias:changeTableFieldAlias,qualifyTableFields:qualifyTableFields,qualifyTableField:qualifyTableField,setCurrentTableModel:setCurrentTableModel,currentTableModel:void 0,createTransformation:createTransformation,getTableModelWithName:getTableModelWithName,remove:remove,clone:clone,removeAllTablesMarkedForRemoval:removeAllTablesMarkedForRemoval};return overwriteContent(serialized),loadModel}function _bindInvalidation(genObj){function onNewLayout(newLayout){loadModel.overwriteContent(newLayout),invalidationFns.forEach(function(fn){fn()})}genObj.Invalidated.bind(function(){genObj.getLayout().then(onNewLayout)}),genObj.getLayout().then(onNewLayout)}function getLoadModel(fn){return-1===invalidationFns.indexOf(fn)&&invalidationFns.push(fn),loadModelPromise||(loadModelPromise=loadModelStorage.getExistingLoadModelGenericObject().then(function(existingGenericObject){return existingGenericObject?existingGenericObject.getLayout().then(function(layout){return loadModel=createLoadModel(layout),_bindInvalidation(existingGenericObject),loadModel}):(loadModel=createLoadModel({}),loadModelStorage.awaitGenericObject().then(function(genericObject){genericObject.getLayout().then(function(newLayout){loadModel.overwriteContent(newLayout),_bindInvalidation(genericObject)})}),loadModel)})),loadModelPromise}function updateProperties(serializedUpdates){return loadModelStorage.setProperties(serializedUpdates)}function resetLoadModel(){return updateProperties(createLoadModel({}).serialize())}var loadModel,loadModelPromise,invalidationFns=[],exports={getLoadModel:getLoadModel,updateProperties:updateProperties,resetLoadModel:resetLoadModel};return exports}),define("assets/hldm/models/associations-model",["assets/hldm/models/association-node-model","underscore"],function(AssociationNodeModel,_){function groupFieldsWithAssociatedTables(tables){var fieldsAssociatedWithTables={};if(tables)for(var t=0;t<tables.length;t++){var fields=tables[t].fields;if(fields)for(var f=0;f<fields.length;f++){var fieldName=fields[f].alias||fields[f].name;fieldsAssociatedWithTables[fieldName]?fieldsAssociatedWithTables[fieldName].tables.push(tables[t]):fieldsAssociatedWithTables[fieldName]={fieldName:fieldName,tables:[tables[t]]}}}return fieldsAssociatedWithTables}function associationIntersectionNodes(tables){for(var fieldsWithAssociatedTables=groupFieldsWithAssociatedTables(tables),associationsNames=Object.keys(fieldsWithAssociatedTables),nodes=[],i=0;i<associationsNames.length;i++){var groupedTables=fieldsWithAssociatedTables[associationsNames[i]].tables;groupedTables.length>1&&nodes.push({key:associationsNames[i],category:"AssociationIntersection"})}return nodes}function associatedLinks(tables){for(var fieldsWithAssociatedTables=groupFieldsWithAssociatedTables(tables),fields=Object.keys(fieldsWithAssociatedTables),arr=[],i=0;i<fields.length;i++){var groupedTables=fieldsWithAssociatedTables[fields[i]].tables;if(groupedTables.length>1)for(var j=0;j<groupedTables.length;j++){var link={to:fields[i],from:groupedTables[j].key,fromField:fields[i]};arr.push(link)}}return arr}function createAssociationsModel(loadModel,loadModelTraverser){function addAssociation(){}function removeAssociation(link){loadModel.qualifyTableField(link.from,link.fromField),updateAssociationNodes()}function bindLayout($scope,fn){var unbind=$scope.$watch(function(){return loadModel.version},function(){fn(getLayout())});return $scope.$on("$destroy",function(){unbind()}),unbind}function getTables(){return loadModelTraverser.compiledTables(loadModel)}function getLayout(){var nodes=getTables();updateAssociationNodes();var links=associatedLinks(nodes),associationNodes=loadModel.associationNodeModels,layout={nodes:nodes.concat(associationNodes),links:links,fieldNamesAssociations:groupFieldsWithAssociatedTables(nodes)};return layout}function _addAssociationsNodesToLoadModelPresentIn(updatedAssociationNodes,options){for(var i=0;i<updatedAssociationNodes.length;i++){var updatedAssociationNode=updatedAssociationNodes[i],match=!1;if(match=_.find(loadModel.associationNodeModels,function(associationNode){return associationNode.data.key===updatedAssociationNode.key}),!match){if(groupFieldsWithAssociatedTables(getTables()),options)for(var keys=Object.keys(options),o=0;o<keys.length;o++){var key=keys[o];updatedAssociationNodes[i][key]=options[key]}loadModel.associationNodeModels.push(AssociationNodeModel.create(updatedAssociationNodes[i]))}}}function _removeAssociationNodesFromLoadModelNotPresentIn(updatedAssociationNodes){for(var i=loadModel.associationNodeModels.length-1;i>=0;i--){var associationNode=loadModel.associationNodeModels[i],match=!1;match=_.find(updatedAssociationNodes,function(updatedAssociationNode){return associationNode.data.key===updatedAssociationNode.key}),match||loadModel.associationNodeModels.splice(i,1)}}function updateAssociationNodes(options){var updatedAssociationNodes=associationIntersectionNodes(getTables())||[];_removeAssociationNodesFromLoadModelNotPresentIn(updatedAssociationNodes),_addAssociationsNodesToLoadModelPresentIn(updatedAssociationNodes,options)}function remove(key){loadModel.remove(key),updateAssociationNodes()}var associationsModel={addAssociation:addAssociation,removeAssociation:removeAssociation,getLayout:getLayout,bindLayout:bindLayout,remove:remove,updateAssociationNodes:updateAssociationNodes};return associationsModel}var exports={createAssociationsModel:createAssociationsModel,associatedLinks:associatedLinks,associationIntersectionNodes:associationIntersectionNodes};return exports}),define("text!assets/hldm/box-types/load-file.txt",[],function(){return"{{#each inject.prefix}}\r\n{{.}}\r\n{{/each}}\r\n{{#if dependencies.keep.enabled}}\r\nKEEP ([{{dependencies.keep.model.tableName}}])\r\n{{/if}}\r\nLOAD {{load-field-list fields}}\r\nFROM {{load-file-from-lib dataconnectorName databaseName}}\r\n{{formatSpec}};"}),define("text!assets/client/dialogs/dimension-dialog/dimension-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="dimensions-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<header class="dm-header" q-translation="{{input.title}}"></header>\r\n	<main class="dm-main">\r\n		<div data-dimension-type="{{input.dimension.type}}"  class="dimension-type-{{input.dimension.type}}">\r\n            <div class="dimension-dialog-radio">\r\n                <!-- changed to not use label and added qva-activate much faster on ipad -->\r\n                <qui-radiobutton class="dimension-dialog-radio-single"\r\n                                qui-name="dimension-type"\r\n                                qui-label="{{ \'Common.Single\' | translate }}"\r\n                                qui-model="input.dimension.type"\r\n                                qui-value="single"></qui-radiobutton>\r\n\r\n                <qui-radiobutton class="dimension-dialog-radio-drilldown"\r\n                                qui-name="dimension-type"\r\n                                qui-label="{{ \'Dimensions.Dialog.Type.DrillDown\' | translate }}"\r\n                                qui-model="input.dimension.type"\r\n                                qui-value="drilldown"></qui-radiobutton>\r\n            </div>\r\n			<div id="dimensions-dialog-content">\r\n				<!-- Available fields -->\r\n				<section id="dimension-dialog-fields" class="field-box">\r\n					<h1 q-translation="Assets.FieldsTab.Table"></h1>\r\n					<qui-select qui-model="input.dimension.selectedTable" qui-options="table for table in input.dimension.tables"></qui-select>\r\n                    <div class="dimension-dialog-search">\r\n                        <qv-assets-search-panel query="search.query" />\r\n                    </div>\r\n					<div class="dimension-dialog-field-list">\r\n						<qv-scroll-area class="scroll-area" ng-class="{ \'native-scroll-enabled\': !scroll.virtualScrollEnabled }">\r\n							<qv-scroll-load-button\r\n									ng-show="scroll.loadPrevious"\r\n									on-load="scroll.gotoPreviousBlock()"\r\n									text="Object.Listbox.LoadPrevious" previous="true"></qv-scroll-load-button>\r\n\r\n							<ul class="qui-list" ng-class="{ \'align-bottom\': scroll.alignBottomAbsolute }">\r\n								<li ng-repeat="field in scroll.items"\r\n									qva-activate="selectFieldHandler(field, $event)"\r\n									class="qui-list-item"\r\n									ng-class="{ \'qui-selected\': field.selected }">\r\n\r\n									<div ng-if="field.dimensionDialogMetaData.icon" class="icon-{{field.dimensionDialogMetaData.icon}} qui-list-icon" q-title-translation="{{field.dimensionDialogMetaData.iconTooltip}}"></div>\r\n									<div class="qui-list-text" qve-highlight text="{{field.qName}}" query="search.query"></div>\r\n									<div ng-if="field.used" class="icon-tick qui-list-icon"></div>\r\n								</li>\r\n							</ul>\r\n\r\n							<div ng-if="!scroll.items.length" class="no-hits">\r\n								<span ng-if="search.query.length" q-translation="Toolbox.Search.Nohits"></span>\r\n								<span ng-if="!search.query.length" q-translation="library.noitems"></span>\r\n							</div>\r\n\r\n							<qv-scroll-load-button\r\n									ng-show="scroll.loadNext"\r\n									on-load="scroll.gotoNextBlock()"\r\n									text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n						</qv-scroll-area>\r\n						<qv-scroll-loader></qv-scroll-loader>\r\n				</div>\r\n				</section>\r\n\r\n				<!-- Selected fields -->\r\n                <section class="dimension-editor-form">\r\n				<section id="dimensions-dialog-field-reference" class="field-box">\r\n					<h1 q-translation="Dimensions.Dialog.FieldReference"></h1>\r\n                        <ul id="dimensions-dialog-field-tokens"\r\n							ng-class="{ invalid: !input.dimension.validity.selectedFields }"\r\n							qv-sortable-list="sortableLists">\r\n\r\n						<li ng-repeat="field in input.dimension.selectedFields" data-id="{{field}}" title="{{field}}" ng-class="{ placeholder: $index === placeholderIndex }">\r\n                                <div class="field-wrapper field-token">\r\n                                    <div class="icon-handle" q-title-translation="Common.Move"></div>\r\n								<div class="field-text">{{field}}</div>\r\n                                    <div class="icon-trash remove" qva-activate="removeItemHandler($index)" q-title-translation="Common.Delete"></div>\r\n							</div>\r\n							<qui-button button-type="smalliconbutton-fx" class="icon-expression edit-expression" qva-activate="editExpressionHandler($event, $index)" q-title-translation="Tooltip.OpenExpressionEditor"></qui-button>\r\n						</li>\r\n						<li class="empty-expression-placeholder">\r\n							<div class="field-wrapper"></div>\r\n							<qui-button button-type="smalliconbutton-fx" class="icon-expression edit-expression" qva-activate="editExpressionHandler($event)" q-title-translation="Tooltip.OpenExpressionEditor"></qui-button>\r\n						</li>\r\n					</ul>\r\n				</section>\r\n\r\n				<!-- Meta data-->\r\n				<section class="metadata-form">\r\n					<div class="metadata-item">\r\n						<label q-translation="metadata.name"></label>\r\n						<input class="qui-input" type="text" name="metadata-name" maxlength="255" ng-model="input.dimension.name" id="dimensions-dialog-name" ng-class="{ \'qui-invalid\': !input.dimension.validity.name }">\r\n					</div>\r\n					<div class="metadata-item">\r\n						<label q-translation="metadata.description"></label>\r\n						<textarea class="qui-textarea" name="metadata-description" maxlength="512" ng-model="input.dimension.description" id="dimensions-dialog-description" ng-class="{ \'qui-invalid\': !input.dimension.validity.description }"></textarea>\r\n					</div>\r\n                        <div class="metadata-item tags">\r\n                            <label q-translation="metadata.tags" class="qv-taglabel"></label>\r\n                            <qv-tagcloud tags="input.dimension.tags" update="input.dimension.updateTags"></qv-tagcloud>\r\n                        </div>\r\n                    </section>\r\n\r\n                    <qui-button ng-if="input.add" qva-activate="confirm()" class="add-dimension-button" autofocus q-translation="Dimensions.Dialog.Add.Button"></qui-button>\r\n				</section>\r\n			</div>\r\n		</div>\r\n	</main>\r\n\r\n	<footer class="dm-footer">\r\n		<qv-spinner show="adding"></qv-spinner>\r\n		<div ng-if="added" qva-outside="hideAddedFeedback()" class="qv-animate dimension-added"><i class="icon-tick"></i><span q-translation="Dimensions.Dialog.DimensionAdded"></span></div>\r\n        <qui-button ng-if="input.add" qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Done" tid="done"></qui-button>\r\n		<qui-button ng-if="!input.add" qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="cancel"></qui-button>\r\n		<qui-button ng-if="!input.add" qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="Common.Save"></qui-button>\r\n	</footer>\r\n</qv-modal-dialog>\r\n'}),define("assets/client/dialogs/dimension-dialog/dimension-dialog-logic",["ng!$timeout","general.utils/string-normalization"],function($timeout,StringNormalization){"use strict";function DimensionDialog(scope,lastItem,validation,stringLimits){function validateNameField(){return validation.validateMetadata(dimension,stringLimits)}function validateFieldsInDimension(){return validation.validateFieldsInDimension(dimension)}function validate(){var validName=validateNameField(),validFields=validateFieldsInDimension();return validName&&validFields}function filterFields(){function matchSearch(field){return-1!==StringNormalization.string(field.qName.toLowerCase()).indexOf(StringNormalization.string(query.toLowerCase()))}var query=scope.search.query,table=dimension.selectedTable;table===scope.allTablesStr?dimension.filteredFields=dimension.allFields.filter(function(field){return matchSearch(field)}):dimension.filteredFields=dimension.allFields.filter(function(field){return-1!==field.qSrcTables.indexOf(table)&&matchSearch(field)})}function isFieldInList(name,list){var i=0,len=list.length;for(i=0;len>i;i++)if(list[i].qName===name)return!0;return!1}function updateFieldExpression(index,expression){expression=expression.replace(/^=+/,"="),"="!==expression.charAt(0)&&(expression="="+expression),void 0!==index?dimension.selectedFields[index]=expression:(dimension.selectedFields.push(expression),dimension.type!==SINGLE&&$timeout(function(){lastItem[0].scrollIntoView()}))}function selectFieldHandler(field){field&&!field.selected&&(dimension.type===SINGLE?dimension.selectedFields=[field.qName]:(dimension.selectedFields.push(field.qName),$timeout(function(){lastItem[0].scrollIntoView()})))}function clearDialog(){dimension.name="",dimension.description="",dimension.tags=[],dimension.selectedFields=[]}function isEmpty(){return""===dimension.name&&""===dimension.description&&0===dimension.tags.length&&0===dimension.selectedFields.length}var dimension=scope.input.dimension;return{selectFieldHandler:selectFieldHandler,updateFieldExpression:updateFieldExpression,isFieldInList:isFieldInList,clearDialog:clearDialog,isEmpty:isEmpty,validateNameField:validateNameField,validateFieldsInDimension:validateFieldsInDimension,validate:validate,filterFields:filterFields}}var SINGLE="single";return{create:function(scope,lastItem,validation,stringLimits){return new DimensionDialog(scope,lastItem,validation,stringLimits)}}}),define("general.utils/dimension-utils",[],function(){"use strict";var exports={},dimensionTypes={};return Object.defineProperties(dimensionTypes,{single:{value:"N",writable:!1},drilldown:{value:"H",writable:!1}}),exports={dimensionTypes:dimensionTypes}}),define("client.services/validation",[],function(){function deEqualizerChar(expression){return expression.replace(/^=+/,"")}function validateMetadata(obj,stringLimits){return obj.validity.name=!!obj.name&&!!obj.name.trim()&&obj.name.length<=stringLimits.name,obj.description?obj.validity.description=obj.description.length<=stringLimits.description:obj.validity.description=!0,obj.validity.name&&obj.validity.description}function validateExpr(obj,stringLimits){var expr=obj.expression,result="string"==typeof expr&&expr.trim().length>0&&expr.length<=stringLimits.expression;return expr&&(obj.expression=deEqualizerChar(expr)),obj.validity.expression=result,result}function validateFieldsInDimension(obj){var fields=obj.selectedFields,result=!1;return fields?("single"===obj.type?result=1===fields.length:"drilldown"===obj.type&&(result=fields.length>1),obj.validity.selectedFields=result,result):!1}return{validateMetadata:validateMetadata,validateExpr:validateExpr,validateFieldsInDimension:validateFieldsInDimension}}),define("general.sortable/sortable-list-service",["jquery","qvangular"],function($,qvangular){"use strict";qvangular.service("qvSortableListDragService",[function(){var service;return service={$new:function(){return{fromItem:void 0,enterItem:void 0,enterList:void 0,toItem:void 0,offsetX:0,offsetY:0,left:0,top:0,direction:void 0,clientRect:void 0,scroll:{},pageX:0,pageY:0}},startOffset:function($scroll,drag,$drag,startPoint){var $offsetParent=$drag.offsetParent(),pos=$drag.position();drag.left=pos.left+$offsetParent[0].scrollLeft,drag.top=pos.top+$offsetParent[0].scrollTop,drag.offsetX=drag.left-startPoint.x-$offsetParent[0].scrollLeft,drag.offsetY=drag.top-startPoint.y-$offsetParent[0].scrollTop},startData:function($scroll,drag,$drag,itemKey){drag.scroll.clientRect=$scroll[0].getBoundingClientRect(),drag.scroll.width=$scroll[0].scrollWidth,drag.scroll.height=$scroll[0].scrollHeight,drag.clientRect=$drag[0].getBoundingClientRect(),drag.minLeft=-drag.clientRect.width,drag.maxLeft=drag.scroll.width,drag.minTop=-drag.clientRect.height,drag.maxTop=drag.scroll.height-drag.clientRect.height,drag.fromItem=$drag.scope()[itemKey],drag.toItem=void 0,drag.enterItem=void 0,drag.enterList=void 0},updateData:function($scroll,drag,$drag,pageX,pageY,listSelector,listKey,itemSelector,itemKey,enterItemFn,enterListFn){function isValidElement($el){return $el.length&&service.isChild($scroll[0],$el[0])}var $enter,enterElement,enterItem,enterList,dataFn=function(){};drag.pageX=pageX,drag.pageY=pageY,drag.pageX<=drag.scroll.clientRect.left?drag.pageX=drag.scroll.clientRect.left+1:drag.pageX>=drag.scroll.clientRect.left+drag.scroll.clientRect.width&&(drag.pageX=drag.scroll.clientRect.left+drag.scroll.clientRect.width-1),drag.pageY<=drag.scroll.clientRect.top?drag.pageY=drag.scroll.clientRect.top+1:drag.pageY>=drag.scroll.clientRect.top+drag.scroll.clientRect.height&&(drag.pageY=drag.scroll.clientRect.top+drag.scroll.clientRect.height-1);var display=$drag[0].style.display;$drag[0].style.display="none",enterElement=document.elementFromPoint(drag.pageX,drag.pageY),$enter=$(enterElement).closest(itemSelector),isValidElement($enter)?dataFn=function($el){enterItem=$el.scope()[itemKey],drag.enterItem!==enterItem&&(drag.enterList=void 0,drag.enterItem=enterItem,drag.toItem=drag.enterItem,enterItemFn())}:($enter=$(enterElement).closest(listSelector),isValidElement($enter)?dataFn=function($el){enterList="function"==typeof listKey?listKey($el):$el.scope()[listKey],drag.enterList!==enterList&&(drag.enterList=enterList,drag.enterItem=void 0,drag.toItem=void 0,enterListFn())}:drag.enterItem=void 0),$drag[0].style.display=display,dataFn($enter)},start:function($scroll,drag,$drag){$drag[0].style||($drag[0].style=""),$drag[0].style.position="absolute",$drag[0].style.width=drag.clientRect.width+"px",$drag[0].style.height=drag.clientRect.height+"px",$drag[0].style.pointerEvents="none",$drag[0].style.left=drag.left+"px",$drag[0].style.top=drag.top+"px",$drag[0].style.zIndex=1},update:function($scroll,drag,$drag,swipe){var left,top;switch(drag.direction){case"horizontal":drag.left=swipe.currentPoint.x+drag.offsetX+$scroll[0].scrollLeft;break;case"vertical":drag.top=swipe.currentPoint.y+drag.offsetY+$scroll[0].scrollTop;break;default:drag.left=swipe.currentPoint.x+drag.offsetX+$scroll[0].scrollLeft,drag.top=swipe.currentPoint.y+drag.offsetY+$scroll[0].scrollTop}left=drag.left,top=drag.top,drag.left<drag.minLeft?left=drag.minLeft:drag.left>drag.maxLeft&&(left=drag.maxLeft),drag.top<drag.minTop?top=drag.minTop:drag.top>drag.maxTop&&(top=drag.maxTop),$drag[0].style.left=left+"px",$drag[0].style.top=top+"px"},end:function(drag,$drag){drag.stopAutoScrolling&&(drag.stopAutoScrolling(),drag.stopAutoScrolling=null),$drag&&$drag.length&&$drag[0].removeAttribute("style")},isParent:function(parent,target){return parent===target},isChild:function(parent,target){var cur=target;if(service.isParent(parent,target))return!1;for(;cur;){if(cur===parent)return!0;cur=cur.parentNode}return!1},autoScroll:function(scrollElem,scrollClientRect,scrollWidth,scrollHeight,drag,updateCallback,scrollSpeed,scrollSensitivity){function scrollLoop(scrollOffsetX,scrollOffsetY){if(scrollLeft=scrollElem.scrollLeft,scrollTop=scrollElem.scrollTop,scroll){if(0>scrollOffsetX&&0===scrollLeft)return void(scroll=!1);if(scrollOffsetX>0&&scrollLeft+parseInt(scrollClientRect.height+.5,10)>=scrollWidth)return void(scroll=!1);if(0>scrollOffsetY&&0===scrollTop)return void(scroll=!1);if(scrollOffsetY>0&&scrollTop+parseInt(scrollClientRect.height+.5,10)>=scrollHeight)return void(scroll=!1);0!==scrollOffsetX&&(scrollElem.scrollLeft+=scrollOffsetX),0!==scrollOffsetY&&(scrollElem.scrollTop+=scrollOffsetY),updateCallback(),setTimeout(function(){scrollLoop(scrollOffsetX,scrollOffsetY)})}}var scroll=!0,scrollLeft=0,scrollTop=0,offsetX=0,offsetY=0;switch(drag.direction){case"horizontal":drag.pageX<=scrollClientRect.left+scrollSensitivity?offsetX=-scrollSpeed:drag.pageX>=scrollClientRect.left+scrollClientRect.width-scrollSensitivity&&(offsetX=scrollSpeed);break;case"vertical":drag.pageY<=scrollClientRect.top+scrollSensitivity?offsetY=-scrollSpeed:drag.pageY>=scrollClientRect.top+scrollClientRect.height-scrollSensitivity&&(offsetY=scrollSpeed);break;default:drag.pageY<=scrollClientRect.top+scrollSensitivity?offsetY=-scrollSpeed:drag.pageY>=scrollClientRect.top+scrollClientRect.height-scrollSensitivity&&(offsetY=scrollSpeed)}return(0!==offsetX||0!==offsetY)&&scrollLoop(offsetX,offsetY),drag.stopAutoScrolling&&(drag.stopAutoScrolling(),delete drag.stopAutoScrolling),drag.stopAutoScrolling=function(){scroll=!1},drag.stopAutoScrolling}}}])}),define("general.sortable/sortable-list",["core.utils/class","util","jquery","qvangular","touche","general.utils/dom-util","general.sortable/sortable-list-service"],function(Class,util,$,qvangular,Touche,DOMUtil){"use strict";var DefaultSortableList=Class.extend("DefaultSortableList",{init:function(options){this.options=util.extend(!0,{gesture:{name:"swipe",options:{radiusThreshold:2,preventDefault:!1}},direction:"",scrollSelector:"",listSelector:"",listKey:"",itemSelector:"[ng-repeat]",itemDragSelector:"[ng-repeat]",itemKey:"$index"},options||{})},onBegin:function(){},onEnter:function(){},onEnterList:function(){},onMove:function(){},onMoveToList:function(){},onCancel:function(){},allowDrag:function(e){return Touche.utils.isMouse(e)?!!$(e.target).closest(this.options.itemSelector).length:!!$(e.target).closest(this.options.itemDragSelector).length},allowScroll:function(e){return!this.allowDrag(e)},allowEnter:function(){return!0},allowAutoScroll:function(){return!0},onAutoScroll:function(defaultScrollFn){defaultScrollFn()},getGesture:function(){return this.options.gesture},getDirection:function(){return this.options.direction},getScrollSensitivity:function(e){return Touche.utils.isMouse(e)?15:25},getScrollSpeed:function(e){return Touche.utils.isMouse(e)?15:25}});return qvangular.directive("qvSortableList",["$parse","qvSortableListDragService",function($parse,dragService){return{restrict:"A",controller:function(){},link:function($scope,$element,$attrs,ctrl){var unWatch=$scope.$watch($attrs.qvSortableList,function(api){function on(){return $drag=void 0,Touche($element[0])[gesture.name](dragFlow).tap(tapFlow),Touche($scrollElem[0]).tap({id:"sortable-list-tap-"+$scope.$id,options:{preventDefault:!1},start:function(e){api.allowScroll(e)||DOMUtil.isInput(e.target)||e.preventDefault()}}),function(){Touche($scrollElem[0]).off("*","sortable-list-tap-"+$scope.$id),Touche($element[0]).off("*",ns)}}if(unWatch(),!(api instanceof DefaultSortableList)){var DefaultSortableApi=DefaultSortableList.extend(api||{});api=new DefaultSortableApi(api&&api.options)}var $scrollElem=$element.closest(api.options.scrollSelector);$scrollElem.length||($scrollElem=$element);var $drag,scrollSpeed,scrollSensitivity,gesture,off,drag=dragService.$new(),ns="sortable-list-"+$scope.$id,tapFlow={id:ns,options:{preventDefault:!1},start:function(e,data){if($drag=void 0,!DOMUtil.isInput(e.target)&&dragService.isChild($scrollElem[0],e.target)&&api.allowDrag(e)){if($drag=$(e.target).closest(api.options.itemSelector),0===$drag.length)return void($drag=void 0);drag.direction=api.getDirection(),scrollSpeed=api.getScrollSpeed(e),scrollSensitivity=api.getScrollSensitivity(e),dragService.startOffset($scrollElem,drag,$drag,data.pagePoints[0]),dragService.startData($scrollElem,drag,$drag,api.options.itemKey)}},end:function(){$drag=void 0}},dragFlow={id:ns,start:function(e){return $drag?(e.preventDefault(),api.onBegin(drag.fromItem,drag.clientRect),$scope.$digest(),void dragService.start($scrollElem,drag,$drag)):void this.cancel()},update:function(e,data){function update(){dragService.update($scrollElem,drag,$drag,data.swipe),dragService.updateData($scrollElem,drag,$drag,data.pagePoints[0].x,data.pagePoints[0].y,api.options.listSelector,api.options.listKey,api.options.itemSelector,api.options.itemKey,function(){trigger()},function(){api.onEnterList(drag.enterList),$scope.$digest()})}function trigger(){api.allowEnter(drag.enterItem,drag.fromItem)?(api.onEnter(drag.enterItem),$scope.$digest()):(drag.enterItem=void 0,drag.toItem=void 0)}if(!$drag)return void this.cancel();if(update(),api.allowAutoScroll()){var defaultScrollFn=dragService.autoScroll.bind(this,$scrollElem[0],drag.scroll.clientRect,drag.scroll.width,drag.scroll.height,drag,update,scrollSpeed,scrollSensitivity);api.onAutoScroll(defaultScrollFn,drag.enterList,drag.enterItem,function($elem,clientRect,scrollWidth,scrollHeight){dragService.autoScroll($elem,clientRect,scrollWidth,scrollHeight,drag,update,scrollSpeed,scrollSensitivity)})}},end:function(){dragService.end(drag,$drag),void 0!==drag.toItem?(api.onMove(drag.fromItem,drag.toItem),$scope.$digest()):void 0!==drag.enterList?(api.onMoveToList(drag.fromItem,drag.enterList),$scope.$digest()):(api.onCancel(),$scope.$digest()),$drag=void 0},cancel:function(){$drag&&(dragService.end(drag,$drag),api.onCancel(),$drag=void 0)}};gesture=api.options.gesture,dragFlow.options=gesture.options,$scope.$on("$destroy",function(){Touche($scrollElem[0]).off("*","sortable-list-tap-"+$scope.$id),Touche($element[0]).off("*",ns)}),ctrl.on=function(){off||(off=on())},ctrl.off=function(){off&&(off(),off=void 0)},ctrl.cancel=function(){dragFlow.cancel()},ctrl.on()})}}}]),DefaultSortableList}),define("text!client.views/tagcloud/tagcloud.ng.html",[],function(){return'<div class="qv-cloud">\r\n	<div class="qv-tageditor">\r\n		<div class="qui-inputwithicon">\r\n			<input tid="tag-cloud-input" ng-model="tagInput" class="qv-tagText" type="text" maxlength="31">\r\n            <i class="icon icon-expand" q-title-translation="Tooltip.AddTag" qva-activate="addTagsAndFocus( $event )"></i>\r\n		</div>\r\n	</div>\r\n	<div tid="tag-cloud-cloud" class="qv-tagCloud" data-value="tags">\r\n		<span ng-repeat="tag in tags" class="qv-tagItem qui-tag">\r\n			<div class="qv-tagContent">{{tag}}</div>\r\n            <div class="icon icon-trash qv-clearTag" qva-activate="removeTagAt( $index )" q-title-translation="Common.Delete"></div>\r\n		</span>\r\n	</div>\r\n</div>\r\n'}),define("client.views/tagcloud/tagcloud",["assets/qvangular/qvangular-core","text!./tagcloud.ng.html"],function(qvangular,template){var TAG_AMOUNT_LIMIT=30;qvangular.directive("qvTagcloud",["$parse",function($parse){return{template:template,replace:!0,restrict:"E",scope:{tags:"=",onChange:"&"},link:function($scope,$element,$attrs){function addTag(name){var tags=$scope.tags;name=name.trim(),!name||-1!==tags.indexOf(name)||tags.length>=TAG_AMOUNT_LIMIT||tags.push(name)}$scope.tagInput="";var $input=$element.find(".qv-tagText");$input.bind("blur",function(){$scope.$apply(function(){$scope.addTags()})}),$input.bind("keydown",function(e){13===e.which&&(e.stopPropagation(),$scope.$apply(function(){$scope.addTags()}))}),$scope.removeTagAt=function(index){$scope.tags.splice(index,1),$scope.onChange()},$scope.addTags=function(){var tagInput=$scope.tagInput;if(tagInput){$scope.tagInput="";var newTags=tagInput.trim().split(",");newTags.forEach(addTag),$scope.tags.sort(function(a,b){
return a.localeCompare(b)}),$scope.onChange()}},$scope.addTagsAndFocus=function(event){event.preventDefault(),$scope.addTags(),$input.focus()};var gettersetter=$parse($attrs.update);gettersetter.assign&&gettersetter.assign($scope.$parent,$scope.addTags)}}}])}),define("text!general.views/spinner/spinner.ng.html",[],function(){return'<div ng-show="show" class="qv-animate spinner ng-hide">\r\n	<div class="qv-loader"></div>\r\n</div>\r\n'}),define("general.views/spinner/spinner",["qvangular","text!./spinner.ng.html"],function(qvangular,template){"use strict";qvangular.directive("qvSpinner",function(){return{replace:!0,template:template,restrict:"E",scope:{show:"="}}})}),define("text!client.assets/search-panel/assets-search-panel.ng.html",[],function(){return'<div class="assets-search-panel" data-help="Library.Search">\r\n	<qui-search-field query="rawQuery" placeholder="Common.Search" on-escape="rawQuery = \'\';" />\r\n</div>'}),define("client.assets/search-panel/assets-search-panel",["jquery","qvangular","text!client.assets/search-panel/assets-search-panel.ng.html"],function($,qvangular,template){"use strict";qvangular.directive("qvAssetsSearchPanel",function(){return{restrict:"E",replace:!0,scope:{query:"="},template:template,link:function($scope,element){function clickOutside(e){$(e.target).hasClass("clear-button")||(inputEl.blur(),inputEl.off("qv-outside"))}$scope.$watch("rawQuery",function(value){0===$.trim(value).length?""!==$scope.query&&($scope.query=""):$scope.query=value});var inputEl=element.find("input");inputEl.on("focus",function(){inputEl.on("qv-outside",clickOutside)}),inputEl.on("keypress",function(e){13===e.keyCode&&inputEl.blur()}),inputEl.on("keydown",function(event){27===event.which?event.stopPropagation():13===event.which&&event.stopPropagation()})}}})}),define("assets/client/dialogs/dimension-dialog/dimension-dialog",["util","general.utils/dom-util","general.services/show-service/show-service","text!assets/client/dialogs/dimension-dialog/dimension-dialog.ng.html","assets/client/dialogs/dimension-dialog/dimension-dialog-logic","translator","general.utils/dimension-utils","general.utils/string-limits","client.services/validation","assets/client/dialogs/confirm-dialog/confirm-dialog","general.utils/array-util","jquery","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/simple-list-data-api","touche","general.sortable/sortable-list","assets/client/dialogs/directives/dialog-directives","client.views/tagcloud/tagcloud","general.views/spinner/spinner","client.assets/search-panel/assets-search-panel"],function(util,domUtil,showService,template,dimensionDialogLogicFactory,translator,dimensionUtils,stringLimits,Validation,ConfirmDialog,arrayUtils,$,ScrollApi,ScrollDOMApi,SimpleListDataApi,Touche){function typeWatcher(curr,prev,scope){var firstFieldName;curr===DRILLDOWN&&prev===SINGLE&&(firstFieldName=scope.input.dimension.selectedFields[0],!firstFieldName||""!==firstFieldName&&firstFieldName!==scope.input.dimension.name||(scope.input.dimension.name="")),curr===SINGLE&&1===scope.input.dimension.selectedFields.length&&dimensionDialogLogic.validateFieldsInDimension(),curr===SINGLE&&scope.input.dimension.selectedFields.length>1&&(ConfirmDialog.show({text:"Dimensions.Dialog.FieldDeleteWarning"}).then(function(){scope.input.dimension.type=SINGLE,scope.input.dimension.selectedFields.length=1,setSelectedState(scope)}),scope.input.dimension.type=prev)}function selectedFieldsWatcher(curr,prev,scope){scope.input.dimension.type===SINGLE&&1===curr.length&&dimensionDialogLogic.isFieldInList(curr[0],scope.input.dimension.allFields)?1!==prev.length||prev[0]!==scope.input.dimension.name&&scope.input.dimension.name?0!==prev.length||scope.input.dimension.name||(scope.input.dimension.name=curr[0]):scope.input.dimension.name=curr[0]:scope.input.dimension.type===SINGLE&&scope.input.dimension.name===prev[0]&&dimensionDialogLogic.isFieldInList(scope.input.dimension.name,scope.input.dimension.allFields)&&(scope.input.dimension.name="")}function setSelectedState(scope){scope.input.dimension.allFields.forEach(function(field){field.selected=scope.input.dimension.selectedFields.contains(field.qName)})}function markUsedFields(scope){scope.input.dimension.allFields.forEach(function(field){field.used=field.used||scope.input.dimension.selectedFields.contains(field.qName)})}function clearUsedFieldMarks(scope){scope.input.dimension.allFields.forEach(function(field){field.used=!1})}function formData($scope){return{name:$scope.input.dimension.name,description:$scope.input.dimension.description,tags:$scope.input.dimension.tags,expr:$scope.input.dimension.selectedFields,type:$scope.input.dimension.type}}function setupWatchers($scope,dimensionDialogLogic){$scope.$watch("input.dimension.type",typeWatcher),$scope.$watch("input.dimension.selectedFields",selectedFieldsWatcher,!0),$scope.$watch("input.dimension.selectedTable",dimensionDialogLogic.filterFields),$scope.$watch("input.dimension.name",function(){$("#dimensions-dialog-name").hasClass("qui-invalid")&&dimensionDialogLogic.validateNameField()}),$scope.$watch("input.dimension.selectedFields",function(){$("#dimensions-dialog-field-tokens").hasClass("invalid")&&dimensionDialogLogic.validateFieldsInDimension()},!0),$scope.$watch("search.query",function(){dimensionDialogLogic.filterFields()})}function show(args){var input={title:args.title,tableData:args.tableData,dimension:args.dimension,expressionInterface:args.expressionInterface,add:args.add,callback:args.callback};return showService.show(component,input)}function add(args){args.title="Dimensions.Dialog.Add.Title",args.add=!0,show(args)}function edit(args){args.title="Dimensions.Dialog.Edit.Title",show(args)}var allTablesStr,dimensionDialogLogic,dimensionTypes=dimensionUtils.dimensionTypes,DRILLDOWN="drilldown",SINGLE="single",component={template:template,controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function addPlaceholder(fromItem){$scope.placeholderIndex=fromItem,dimension.selectedFields.splice(fromItem,0,"")}function removePlaceholder(){-1!==$scope.placeholderIndex&&(dimension.selectedFields.splice($scope.placeholderIndex,1),$scope.placeholderIndex=-1)}function updateFieldExpression(index,expression){dimensionDialogLogic.updateFieldExpression(index,expression),setSelectedState($scope)}var sortableElement,emptyExpressionItem,addButton,td=$scope.input.tableData,dimension=$scope.input.dimension;dimension.validity={},dimension.validity.description=!0,dimension.validity.name=!0,dimension.validity.selectedFields=!0,dimension.selectedFields=dimension.qDim.qFieldDefs,dimension.type=dimension.qDim.qGrouping===dimensionTypes.drilldown?DRILLDOWN:SINGLE,dimension.stringLimits=stringLimits,dimension.allFields=[],allTablesStr=translator.get("Common.All.Tables"),$scope.allTablesStr=allTablesStr,dimension.selectedTable=allTablesStr,$scope.search={query:""},$scope.sortableLists={options:{direction:"vertical",itemSelector:"li:not(.empty-expression-placeholder)"},onBegin:function(fromItem){addPlaceholder(fromItem)},onEnter:function(enterItem){arrayUtils.move(dimension.selectedFields,$scope.placeholderIndex,enterItem),$scope.placeholderIndex=enterItem},onMove:function(fromItem,toItem){removePlaceholder(),null!==toItem&&$scope.placeholderIndex!==fromItem&&(toItem>fromItem&&toItem--,arrayUtils.move(dimension.selectedFields,fromItem,toItem))},onCancel:function(){removePlaceholder()},allowDrag:function(e){return Touche.utils.isMouse(e)?!!$(e.target).closest(".field-token").length:!!$(e.target).closest(".icon-handle").length}},$scope.placeholderIndex=-1,$scope.$root.$evalAsync(function(){sortableElement=$element.find("#dimensions-dialog-field-tokens"),emptyExpressionItem=sortableElement.find(".empty-expression-placeholder"),addButton=$element.find(".add-dimension-button"),dimensionDialogLogic=dimensionDialogLogicFactory.create($scope,emptyExpressionItem,Validation,stringLimits),setupWatchers($scope,dimensionDialogLogic)}),td&&(dimension.allFields=td.fields,dimension.filteredFields=td.fields.slice(),dimension.tables=td.tables,dimension.tables.unshift(allTablesStr)),$scope.cancel=function(){dimension.updateTags(),!$scope.input.add||dimensionDialogLogic.isEmpty()?$scope.destroyComponent():ConfirmDialog.show({text:"Dimensions.Dialog.CloseWarning"}).then(function(){$scope.destroyComponent()},function(){addButton.focus()})},$scope.showAddingFeedback=function(){$scope.adding=!0,setTimeout(function(){$scope.adding=!1,$scope.added=!0,$scope.$apply()},500)},$scope.hideAddedFeedback=function(){$scope.added=!1},$scope.confirm=function(){dimension.updateTags(),dimension.expr=dimension.selectedFields,dimensionDialogLogic.validate()&&($scope.input.callback(formData($scope)),$scope.input.add?(markUsedFields($scope),dimensionDialogLogic.clearDialog(),setSelectedState($scope),$scope.showAddingFeedback(),addButton.focus()):$scope.destroyComponent())},$scope.selectFieldHandler=function(field,event){event.preventDefault(),setTimeout(function(){var elem=domUtil.elementFromEventPosition(event),inMomentumScroll=elem!==event.target;inMomentumScroll||(dimensionDialogLogic.selectFieldHandler(field),setSelectedState($scope),$scope.$apply())},100)},$scope.removeItemHandler=function(index){dimension.selectedFields.splice(index,1),setSelectedState($scope)},$scope.editExpressionHandler=function(e,index){e.preventDefault();var scope=$scope,expression=scope.input.dimension.selectedFields[index]||"";"="!==expression.substr(0,1)&&(expression=util.escapeField(expression)),scope.input.expressionInterface(updateFieldExpression,index,expression)},setSelectedState($scope),clearUsedFieldMarks($scope);var settings={minRowHeight:38,maxRowHeight:38,blockSize:60,keepItemsCount:10},scrollApi=$scope.scroll=new ScrollApi($timeout,settings),dataApi=new SimpleListDataApi(scrollApi);$scope.$evalAsync(function(){var $scrollArea=$element.find(".scroll-area"),virtualScrollCtrl=$scrollArea.controller("qvScrollArea"),domApi=new ScrollDOMApi($scrollArea,$scrollArea,".qui-list-item",".qui-list-item:first",".qui-list-item:last"),loaderCtrl=$element.find(".qv-scroll-loader").controller("qvScrollLoader");scrollApi.initialize(domApi,dataApi,virtualScrollCtrl,loaderCtrl).then(function(){scrollApi.activate(),scrollApi.updateViewport(),$scope.$watch("input.dimension.filteredFields",function(items){items&&dataApi.setList(items)})}),$scope.$on("$destroy",function(){scrollApi.destroy()})})}]};return{add:add,edit:edit}}),define("general.utils/expression-validator",["core.utils/notification","core.utils/class","core.models/app"],function(Notification,Class,App){var Modes={Expression:0,NumberOrExpression:1},ExpressionValidator=Class.extend("ExpressionValidator",{init:function(app,mode){this.currentExpr=null,this.nextExpr=null,this.hasOutstandingCall=!1,this.app=app||App.current,this.mode=mode||Modes.Expression,Notification.create(this,"Update")},onResponse:function(data){var expr,labels,valid,i,bad;if(this.hasOutstandingCall=!1,this.nextExpr)expr=this.nextExpr,labels=this.nextLabels,this.nextExpr=null,this.nextLabels=null,this.callEngine(expr,labels);else{for(expr=this.currentExpr,valid=!data.qErrorMsg&&0===data.qBadFieldNames.length,i=0;i<data.qBadFieldNames.length;i++)bad=data.qBadFieldNames[i],bad.name=expr.substr(bad.qFrom||0,bad.qCount);this.Update.emit({valid:valid,data:{error:data.qErrorMsg,bad:data.qBadFieldNames}})}},callEngine:function(expr,labels){var self=this;if(this.hasOutstandingCall)throw new Error("Invalid state");this.currentExpr=expr,this.hasOutstandingCall=!0;var result;result=this.mode===Modes.NumberOrExpression?this.app.checkNumberOrExpression(expr):this.app.checkExpression(expr,labels),result.then(function(result){self.onResponse(result)},function(){self.onResponse({qErrorMsg:"Error",qBadFieldNames:[]})})},validate:function(expr,labels){this.hasOutstandingCall?(this.nextExpr=expr,this.nextLabels=labels):this.callEngine(expr,labels)}});return{ExpressionValidator:ExpressionValidator,Modes:Modes}}),define("text!general.components/info-popover/info-popover.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" position="position" collision="fit" on-close-view="closeView()" qv-dialog-escape="closeView()">\r\n	<span class="info-popover-message" ng:show="translationKey" q-translation="{{translationKey}}"></span>\r\n	<span class="info-popover-message" ng:show="text">{{text}}</span>\r\n</immidiate-contextual>\r\n'}),define("general.components/info-popover/info-popover",["text!./info-popover.ng.html","assets/client/dialogs/directives/escape"],function(template){var infoPopover={scope:{translationKey:"=",text:"=",alignTo:"=",position:"="},template:template,controller:["$scope",function($scope){$scope.closeView=function(){$scope.destroyComponent(),$scope.onClose()}}]};return infoPopover}),define("text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="expression-editor-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<div id="expression-editor-wrapper">\r\n		<section id="expression-editor-content">\r\n			<h1 class="dm-header" q-translation="{{input.title}}"></h1>\r\n			<main class="dm-main">\r\n\r\n				<div id="expression-editor-container">\r\n					<div qv-extract="resizeCounter" id="expression-editor-stage" data-help="Panel.Stage" ng-class="{ invalid: !validity.expression }">\r\n						<qv-codearea\r\n								data-show-breakpoint-gutter="false"\r\n								data-disabled="false"\r\n								data-resize-trigger="resizeCounter"\r\n								data-mode="qlikviewReloadScriptMode"\r\n								qv-codearea-code-container="codearea"\r\n								qv-codearea-exposed-context-api="codearea.contextApi"\r\n								qv-codearea-function-tip="functionTipOptions"\r\n								qv-codearea-limit="stringLimits.expression"\r\n								qv-codearea-exposed-touch-api=\'codeareaTouchApi\'\r\n								qv-codearea-autocomplete="autocompleteOptions"\r\n								qv-codearea-help-mode="false"\r\n								qv-codearea-help-mode-options="helpModeOptions"\r\n								qv-codearea-composition-event\r\n							></qv-codearea>\r\n						<qv-codearea-touch-overlay\r\n								ng-if="enableTouchOverlay"\r\n								codearea-touch-api="codeareaTouchApi"\r\n							></qv-codearea-touch-overlay>\r\n					</div>\r\n				</div>\r\n\r\n				<div id="expression-editor-status" ng-class="info.status" >\r\n					<i ng-class="{ disabled: !info.extraErrorMsg }"\r\n						class="icon-info"\r\n						qva-activate="showErrorMessage( info.extraErrorMsg, $event )"></i>\r\n					<span translate="info.errorMsg" ng-show="info.errorMsg"></span>\r\n				</div>\r\n\r\n			</main>\r\n		</section>\r\n		<section id="expression-editor-panel" class="qribby-accordion-pp">\r\n			<section class="qribby-accordion-section">\r\n				<header class="qribby-accordion-section-header">\r\n					<h1 q-translation="Common.Fields"></h1>\r\n				</header>\r\n				<div class="qribby-accordion-section-content">\r\n\r\n					<div id="expression-editor-toolbar-table">\r\n						<label q-translation="Assets.FieldsTab.Table"></label>\r\n						<qui-select\r\n							id="expression-dialog-fields-tab-select-field"\r\n							qui-model="controller.selectedTable"\r\n							qui-options="table for table in controller.tableNames">\r\n						</qui-select>\r\n					</div>\r\n\r\n					<div id="expression-editor-toolbar-field">\r\n						<label q-translation="Common.Field"></label>\r\n						<qui-select\r\n							id="expression-dialog-functions-common-select-field"\r\n							qui-model="controller.selectedField"\r\n							qui-options="field for field in controller.fieldNames">\r\n						</qui-select>\r\n					</div>\r\n\r\n					<div id="expression-editor-toolbar-functions">\r\n						<qui-select id="expression-dialog-fields-tab-select-aggregation" qui-model="controller.selectedCommonFunction">\r\n							<option q-translation="ExpressionEditor.FieldsTab.SelectAggregationHint" value=""></option>\r\n							<option ng-repeat="func in controller.commonFunctions" value="{{func}}">{{func}}</option>\r\n						</qui-select>\r\n					</div>\r\n\r\n					<div id="expression-editor-toolbar-insert">\r\n						<qui-button\r\n							outline\r\n							ng-disabled="!controller.previewText()"\r\n							type="button"\r\n							qva-activate="insertTextHandler($event)"\r\n							q-title-translation="Tooltip.ExpressionEditor.InsertExpression">\r\n							<span q-translation="ExpressionEditor.Insert"></span>\r\n						</qui-button>\r\n					</div>\r\n				</div>\r\n			</section>\r\n		</section>\r\n	</div>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="Common.Apply"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("assets/client/dialogs/expression-dialog/expression-dialog-controller",["util"],function(util){"use strict";function commonFunctions(){return["Sum","Count","Avg","Min","Max"]}function previewText(){var field;return field=this.selectedField||"",field=util.escapeField(field),this.selectedCommonFunction?this.selectedCommonFunction+"("+field+")":field}function extractFieldnames(fields){return fields.map(function(x){return x.qName})}function filterFields(fields,table){return fields.filter(function(x){return-1!==x.qSrcTables.indexOf(table)})}function compare(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}function extractTablenames(fields){var i,j,tables=[];for(i=0;i<fields.length;++i)for(j=0;j<fields[i].qSrcTables.length;++j)-1===tables.indexOf(fields[i].qSrcTables[j])&&tables.push(fields[i].qSrcTables[j]);return tables.sort(compare),tables}function setTableFilter(obj,fields,table){table!==obj.allTablesText&&(fields=filterFields(fields,table)),obj.fieldNames=extractFieldnames(fields),updateSelectedField(obj)}function updateSelectedField(obj){-1===obj.fieldNames.indexOf(obj.selectedField)&&(obj.selectedField=obj.fieldNames[0])}function create(options){var translator=options.translator,allfields=options.fields.slice();allfields.sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())});var allTablesText=translator.get("Common.All.Tables"),result={allTablesText:allTablesText,commonFunctions:commonFunctions(),selectedCommonFunction:"",setTableFilter:function(table){setTableFilter(result,allfields,table)},selectedTable:allTablesText,tableNames:[allTablesText].concat(extractTablenames(allfields)),fieldNames:extractFieldnames(allfields),selectedField:"",previewText:previewText};return updateSelectedField(result),result}return{create:create}}),define("assets/client/dialogs/expression-dialog/expression-validation-info",[],function(){"use strict";function updateValidationStatus(info,result){if(info.status=result.valid?STATUS_VALID:STATUS_INVALID,info.errorMsg=result.valid?"Common.OK":"Expression.Validation.InvalidExpression",info.extraErrorMsg="",result.data)if(result.data.bad.length>0){var names=result.data.bad.map(function(bad){return bad.name});info.errorMsg={id:"Expression.Validation.BadFieldName",value:[names.join(", ")]}}else result.data.error&&(info.extraErrorMsg=result.data.error)}function validate(info,validator,expr,labels){""!==expr.replace(/\s+/g,"")?(info.status=STATUS_VALIDATING,validator.validate(expr,labels)):(info.status=STATUS_INVALID,info.errorMsg="",info.extraErrorMsg="")}function create(options){var validator=options.validator,info={errorMsg:"",extraErrorMsg:"",status:STATUS_VALIDATING,setExpr:function(expr){validate(info,validator,expr,options.labels)}};return validator.Update.bind(function(result){updateValidationStatus(info,result)}),info}var STATUS_VALIDATING="validating",STATUS_VALID="valid",STATUS_INVALID="invalid";return{create:create}}),define("text!general.components/function-tip-view/function-tip-view.html",[],function(){return'<qui-float qui-offset="offset" qui-resize-on-change="content" class="qv-function-tip-container">\r\n	<div class=\'qv-function-tip-view\' ng-show=\'content\'>{{content}}</div>\r\n</qui-float>\r\n'}),define("general.components/function-tip-view/function-tip-view",["text!./function-tip-view.html"],function(template){"use strict";return{scope:{offset:"=",content:"="},template:template,controller:[function(){}]}}),define("general.models/bnf-model",["core.models/engine","lz-string","core.utils/deferred"],function(engine,lzString,Deferred){"use strict";function createBnfModel(qBNFDefs){function cleanSignature(str){return str.replace(/\s+/g," ").replace(/\s+(\)|\]|,)/g,"$1").replace(/(\(|\[|,)\s+/g,"$1")}function generateKeywords(){qBNFDefs.forEach(categorizeKeyword)}function generateAutocompleteList(){function addTypeToKeyword(type,keyword){return{text:keyword,type:type}}cache.functions.length<1&&generateKeywords();var keywordsWithType=cache.notFunctions.map(addTypeToKeyword.bind(null,"keyword")),functionsWithType=cache.functions.map(addTypeToKeyword.bind(null,"function"));cache.autocompleteList=keywordsWithType.concat(functionsWithType)}function categorizeKeyword(entry){entry.qBnfLiteral===!0&&(-1===cache.keywords.indexOf(entry.qStr)&&cache.keywords.push(entry.qStr),entry.qStr&&(cache.keywordsAsLowerCase.push(entry.qStr.toLowerCase()),cache.mapping[entry.qStr.toLowerCase()]=entry.qNbr,entry.qAggrFunc||entry.qQvFunc?(-1===cache.functions.indexOf(entry.qStr)&&cache.functions.push(entry.qStr),keywordTypes[entry.qStr.toLowerCase()]="function"):entry.qFieldFlag||(-1===cache.notFunctions.indexOf(entry.qStr)&&cache.notFunctions.push(entry.qStr),keywordTypes[entry.qStr.toLowerCase()]="keyword")))}function getBnfEntryFromQNumber(qnum){if(qnum=parseInt(qnum,10),cache.bnfEntries[qnum])return cache.bnfEntries[qnum];var obj=qBNFDefs.filter(function(d){return parseInt(d.qNbr,10)===qnum});return cache.bnfEntries[qnum]=obj[0],obj[0]||!1}function getBnfEntryFromKeyword(keyword){cache.keywords.length<1&&generateKeywords(),keyword=keyword.toLowerCase();var qnum=cache.mapping[keyword];return getBnfEntryFromQNumber(qnum)}function getLiteralString(qnum){var str="",obj=getBnfEntryFromQNumber(qnum);return qnum>=0&&56>=qnum?str=obj.qStr||"":obj&&(str=obj.qStr||obj.qName),str}function getSignature(entry){return entry&&!entry.signature&&(entry.qBnf&&entry.qBnf.length>0?entry.signature=entry.qBnf.map(getLiteralString).join(" ").trim():entry.qPNbr&&(entry.signature=getSignature(getBnfEntryFromQNumber(entry.qPNbr))),entry.signature=cleanSignature(entry.signature)),entry.signature||""}function getAllKeywords(){return cache.keywords.length<1&&generateKeywords(),cache.keywords}function getAllKeywordsAsLowerCase(){return cache.keywordsAsLowerCase.length<1&&generateKeywords(),cache.keywordsAsLowerCase}function getAutocompleteList(){return cache.autocompleteList||generateAutocompleteList(),cache.autocompleteList}function getSignatureFromKeyword(keyword){var entry=getBnfEntryFromKeyword(keyword);return entry!==!1?getSignature(entry):""}function getKeywordsWithHelp(){return qBNFDefs.filter(function(d){return d.qHelpId&&d.qHelpId>0}).map(function(o){return o.qStr})}function isFunction(word){return"function"===keywordTypes[word.toLowerCase()]}function isField(){return!1}function isVariable(){return!1}function isKeyword(word){return!!keywordTypes[word.toLowerCase()]}function getAllFunctions(){return cache.functions.length<1&&generateKeywords(),cache.functions}var keywordTypes={},cache={keywords:[],keywordsAsLowerCase:[],functions:[],notFunctions:[],bnfEntries:[],mapping:{}};return generateKeywords(),{getBnfEntry:getBnfEntryFromQNumber,getLiteralString:getLiteralString,getAllKeywords:getAllKeywords,getAllKeywordsAsLowerCase:getAllKeywordsAsLowerCase,getAutocompleteList:getAutocompleteList,getKeywordsWithHelp:getKeywordsWithHelp,getSignatureFromKeyword:getSignatureFromKeyword,getFunctionTip:getSignatureFromKeyword,isFunction:isFunction,isField:isField,isKeyword:isKeyword,isVariable:isVariable,getAllFunctions:getAllFunctions}}function loadBnfModel(scriptKind){var BNF_CACHE_DATA_KEY="BNF_CACHE_DATA_"+scriptKind,BNF_CACHE_VERSION_KEY="BNF_CACHE_VERSION_"+scriptKind;return engine.global.qvVersion().then(function(version){var defer=new Deferred,versionInCache=localStorage.getItem(BNF_CACHE_VERSION_KEY),rightVersionInCache=versionInCache===version,compressedCachedBnf=rightVersionInCache?localStorage.getItem(BNF_CACHE_DATA_KEY):void 0;if(compressedCachedBnf)try{var bnfDef=JSON.parse(lzString.decompressFromUTF16(compressedCachedBnf));return defer.resolve(createBnfModel(bnfDef)),defer.promise}catch(error){}return engine.global.getBNF(scriptKind).then(function(result){var newBnfDef=result.qBnfDefs;localStorage.setItem(BNF_CACHE_DATA_KEY,lzString.compressToUTF16(JSON.stringify(newBnfDef))),localStorage.setItem(BNF_CACHE_VERSION_KEY,version),defer.resolve(createBnfModel(newBnfDef))}),defer.promise})}function getBnfModel(scriptKind){return bnfModelPromises[scriptKind]||(bnfModelPromises[scriptKind]=loadBnfModel(scriptKind)),bnfModelPromises[scriptKind]}function getReloadScriptBnfModel(){return getBnfModel("S")}function getExpressionBnfModel(){return getBnfModel("E")}var bnfModelPromises={};return{createBnfModel:createBnfModel,getReloadScriptBnfModel:getReloadScriptBnfModel,getExpressionBnfModel:getExpressionBnfModel}}),define("assets/client/dialogs/expression-dialog/expression-bnf",["core.utils/deferred","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","core.models/variable","general.models/bnf-model"],function(Deferred,Field,FieldListModel,Variable,BnfModel){function addTypeToKeyword(type,keyword){return{text:keyword,type:type}}function create(options){function isFunction(word){return bnf.isFunction(word)}function getFunctionTip(word){return bnf.getFunctionTip(word)}function isKeyword(word){return!!keywords[word.toLowerCase()]||isFunction(word)}function isField(word){return!!fields[word]}function isVariable(word){return!!variables[word]}function getAutocompleteList(){return autocompleteList}var bnf=options.bnf,keywords=getKeywords(),fields=options.fields,variables=options.variables,keywordsWithType=keywordList.map(addTypeToKeyword.bind(null,"keyword")),variablesWithType=Object.keys(variables).map(addTypeToKeyword.bind(null,"variable")),fieldsWithType=Object.keys(fields).map(addTypeToKeyword.bind(null,"field")),functionsWithType=bnf.getAllFunctions().map(addTypeToKeyword.bind(null,"function")),autocompleteList=keywordsWithType.concat(variablesWithType,fieldsWithType,functionsWithType),bnfModel={getAutocompleteList:getAutocompleteList,getFunctionTip:getFunctionTip,isFunction:isFunction,isField:isField,isKeyword:isKeyword,isVariable:isVariable};return bnfModel}function getKeywords(){for(var keywords={},i=0;i<keywordList.length;++i){var name=keywordList[i];keywords[name]=!0}return keywords}function getFields(app){return Field.getListLayout(app).then(function(fieldList){fieldList=FieldListModel.expand(fieldList);for(var fields={},i=0;i<fieldList.length;++i){var name=fieldList[i].qName;fields[name]=!0}return fields})}function getVariables(app){return Variable.getListLayout(app).then(function(variableList){for(var variables={},i=0;i<variableList.length;++i){var name=variableList[i].qName;variables[name]=!0}return variables})}function get(app){return Deferred.all({bnf:BnfModel.getExpressionBnfModel(),fields:getFields(app),variables:getVariables(app)}).then(create)}var keywordList=["like","not","and","or","xor","follows","precedes","bitnot","bitand","bitor","bitxor","$","$1","$2","$3","$4","$5","$_1","$_2","$_3","$_4","$_5","total","distinct","nodistinct","all","include","must_include"];return{get:get}}),define("general.components/extract",["jquery","qvangular","core.utils/resize","general.services/aligner/aligner"],function($,qvangular,Resize,Aligner){qvangular.directive("qvExtract",["$timeout","$parse",function($timeout,$parse){return{restrict:"A",transclude:!0,link:function($scope,$element,$attrs,nullController,$transclude){function updateContainer(){aligner.update(),++resizeCounter,gettersetter.assign&&gettersetter.assign($scope,resizeCounter)}var aligner=new Aligner({container:$("<div style='position:absolute'>"),body:document.body,alignAgainst:$element}),gettersetter=$parse($attrs.qvExtract),resizeCounter=0;aligner.showTranscluded($transclude),aligner.update(),$timeout(function(){updateContainer()}),Resize.on("end",updateContainer),$scope.$on("$destroy",function(){aligner.hide(),Resize.off("end",updateContainer)})}}}])}),window.CodeMirror=function(){"use strict";function CodeMirror(place,options){if(!(this instanceof CodeMirror))return new CodeMirror(place,options);this.options=options=options||{};for(var opt in defaults)!options.hasOwnProperty(opt)&&defaults.hasOwnProperty(opt)&&(options[opt]=defaults[opt]);setGuttersForLineNumbers(options);var docStart="string"==typeof options.value?0:options.value.first,display=this.display=makeDisplay(place,docStart);display.wrapper.CodeMirror=this,updateGutters(this),options.autofocus&&!mobile&&focusInput(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new Delayed},themeChanged(this),options.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");var doc=options.value;"string"==typeof doc&&(doc=new Doc(options.value,options.mode)),operation(this,attachDoc)(this,doc),ie&&setTimeout(bind(resetInput,this,!0),20),registerEventHandlers(this);var hasFocus;try{hasFocus=document.activeElement==display.input}catch(e){}hasFocus||options.autofocus&&!mobile?setTimeout(bind(onFocus,this),20):onBlur(this),operation(this,function(){for(var opt in optionHandlers)optionHandlers.propertyIsEnumerable(opt)&&optionHandlers[opt](this,options[opt],Init);for(var i=0;i<initHooks.length;++i)initHooks[i](this)})()}function makeDisplay(place,docStart){var d={},input=d.input=elt("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;");return webkit?input.style.width="1000px":input.setAttribute("wrap","off"),ios&&(input.style.border="1px solid black"),input.setAttribute("autocorrect","off"),input.setAttribute("autocapitalize","off"),input.setAttribute("spellcheck","false"),d.inputDiv=elt("div",[input],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),d.scrollbarH=elt("div",[elt("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),d.scrollbarV=elt("div",[elt("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),d.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler"),d.gutterFiller=elt("div",null,"CodeMirror-gutter-filler"),d.lineDiv=elt("div",null,"CodeMirror-code"),d.selectionDiv=elt("div",null,null,"position: relative; z-index: 1"),d.cursor=elt("div","","CodeMirror-cursor"),d.otherCursor=elt("div","","CodeMirror-cursor CodeMirror-secondarycursor"),d.measure=elt("div",null,"CodeMirror-measure"),d.lineSpace=elt("div",[d.measure,d.selectionDiv,d.lineDiv,d.cursor,d.otherCursor],null,"position: relative; outline: none"),d.mover=elt("div",[elt("div",[d.lineSpace],"CodeMirror-lines")],null,"position: relative"),d.sizer=elt("div",[d.mover],"CodeMirror-sizer"),d.heightForcer=elt("div",null,null,"position: absolute; height: "+scrollerCutOff+"px; width: 1px;"),d.gutters=elt("div",null,"CodeMirror-gutters"),d.lineGutter=null,d.scroller=elt("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll"),d.scroller.setAttribute("tabIndex","-1"),d.wrapper=elt("div",[d.inputDiv,d.scrollbarH,d.scrollbarV,d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror"),ie_lt8&&(d.gutters.style.zIndex=-1,d.scroller.style.paddingRight=0),place.appendChild?place.appendChild(d.wrapper):place(d.wrapper),ios&&(input.style.width="0px"),webkit||(d.scroller.draggable=!0),khtml?(d.inputDiv.style.height="1px",d.inputDiv.style.position="absolute"):ie_lt8&&(d.scrollbarH.style.minWidth=d.scrollbarV.style.minWidth="18px"),d.viewOffset=d.lastSizeC=0,d.showingFrom=d.showingTo=docStart,d.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null,d.prevInput="",d.alignWidgets=!1,d.pollingFast=!1,d.poll=new Delayed,d.cachedCharWidth=d.cachedTextHeight=null,d.measureLineCache=[],d.measureLineCachePos=0,d.inaccurateSelection=!1,d.maxLine=null,d.maxLineLength=0,
d.maxLineChanged=!1,d.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null,d}function loadMode(cm){cm.doc.mode=CodeMirror.getMode(cm.options,cm.doc.modeOption),cm.doc.iter(function(line){line.stateAfter&&(line.stateAfter=null),line.styles&&(line.styles=null)}),cm.doc.frontier=cm.doc.first,startWorker(cm,100),cm.state.modeGen++,cm.curOp&&regChange(cm)}function wrappingChanged(cm){cm.options.lineWrapping?(cm.display.wrapper.className+=" CodeMirror-wrap",cm.display.sizer.style.minWidth=""):(cm.display.wrapper.className=cm.display.wrapper.className.replace(" CodeMirror-wrap",""),computeMaxLength(cm)),estimateLineHeights(cm),regChange(cm),clearCaches(cm),setTimeout(function(){updateScrollbars(cm)},100)}function estimateHeight(cm){var th=textHeight(cm.display),wrapping=cm.options.lineWrapping,perLine=wrapping&&Math.max(5,cm.display.scroller.clientWidth/charWidth(cm.display)-3);return function(line){return lineIsHidden(cm.doc,line)?0:wrapping?(Math.ceil(line.text.length/perLine)||1)*th:th}}function estimateLineHeights(cm){var doc=cm.doc,est=estimateHeight(cm);doc.iter(function(line){var estHeight=est(line);estHeight!=line.height&&updateLineHeight(line,estHeight)})}function keyMapChanged(cm){var map=keyMap[cm.options.keyMap],style=map.style;cm.display.wrapper.className=cm.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(style?" cm-keymap-"+style:""),cm.state.disableInput=map.disableInput}function themeChanged(cm){cm.display.wrapper.className=cm.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+cm.options.theme.replace(/(^|\s)\s*/g," cm-s-"),clearCaches(cm)}function guttersChanged(cm){updateGutters(cm),regChange(cm),setTimeout(function(){alignHorizontally(cm)},20)}function updateGutters(cm){var gutters=cm.display.gutters,specs=cm.options.gutters;removeChildren(gutters);for(var i=0;i<specs.length;++i){var gutterClass=specs[i],gElt=gutters.appendChild(elt("div",null,"CodeMirror-gutter "+gutterClass));"CodeMirror-linenumbers"==gutterClass&&(cm.display.lineGutter=gElt,gElt.style.width=(cm.display.lineNumWidth||1)+"px")}gutters.style.display=i?"":"none"}function lineLength(doc,line){if(0==line.height)return 0;for(var merged,len=line.text.length,cur=line;merged=collapsedSpanAtStart(cur);){var found=merged.find();cur=getLine(doc,found.from.line),len+=found.from.ch-found.to.ch}for(cur=line;merged=collapsedSpanAtEnd(cur);){var found=merged.find();len-=cur.text.length-found.from.ch,cur=getLine(doc,found.to.line),len+=cur.text.length-found.to.ch}return len}function computeMaxLength(cm){var d=cm.display,doc=cm.doc;d.maxLine=getLine(doc,doc.first),d.maxLineLength=lineLength(doc,d.maxLine),d.maxLineChanged=!0,doc.iter(function(line){var len=lineLength(doc,line);len>d.maxLineLength&&(d.maxLineLength=len,d.maxLine=line)})}function setGuttersForLineNumbers(options){var found=indexOf(options.gutters,"CodeMirror-linenumbers");-1==found&&options.lineNumbers?options.gutters=options.gutters.concat(["CodeMirror-linenumbers"]):found>-1&&!options.lineNumbers&&(options.gutters=options.gutters.slice(0),options.gutters.splice(found,1))}function updateScrollbars(cm){var d=cm.display,docHeight=cm.doc.height,totalHeight=docHeight+paddingVert(d);d.sizer.style.minHeight=d.heightForcer.style.top=totalHeight+"px",d.gutters.style.height=Math.max(totalHeight,d.scroller.clientHeight-scrollerCutOff)+"px";var scrollHeight=Math.max(totalHeight,d.scroller.scrollHeight),needsH=d.scroller.scrollWidth>d.scroller.clientWidth+1,needsV=scrollHeight>d.scroller.clientHeight+1;needsV?(d.scrollbarV.style.display="block",d.scrollbarV.style.bottom=needsH?scrollbarWidth(d.measure)+"px":"0",d.scrollbarV.firstChild.style.height=scrollHeight-d.scroller.clientHeight+d.scrollbarV.clientHeight+"px"):(d.scrollbarV.style.display="",d.scrollbarV.firstChild.style.height="0"),needsH?(d.scrollbarH.style.display="block",d.scrollbarH.style.right=needsV?scrollbarWidth(d.measure)+"px":"0",d.scrollbarH.firstChild.style.width=d.scroller.scrollWidth-d.scroller.clientWidth+d.scrollbarH.clientWidth+"px"):(d.scrollbarH.style.display="",d.scrollbarH.firstChild.style.width="0"),needsH&&needsV?(d.scrollbarFiller.style.display="block",d.scrollbarFiller.style.height=d.scrollbarFiller.style.width=scrollbarWidth(d.measure)+"px"):d.scrollbarFiller.style.display="",needsH&&cm.options.coverGutterNextToScrollbar&&cm.options.fixedGutter?(d.gutterFiller.style.display="block",d.gutterFiller.style.height=scrollbarWidth(d.measure)+"px",d.gutterFiller.style.width=d.gutters.offsetWidth+"px"):d.gutterFiller.style.display="",mac_geLion&&0===scrollbarWidth(d.measure)&&(d.scrollbarV.style.minWidth=d.scrollbarH.style.minHeight=mac_geMountainLion?"18px":"12px",d.scrollbarV.style.pointerEvents=d.scrollbarH.style.pointerEvents="none")}function visibleLines(display,doc,viewPort){var top=display.scroller.scrollTop,height=display.wrapper.clientHeight;"number"==typeof viewPort?top=viewPort:viewPort&&(top=viewPort.top,height=viewPort.bottom-viewPort.top),top=Math.floor(top-paddingTop(display));var bottom=Math.ceil(top+height);return{from:lineAtHeight(doc,top),to:lineAtHeight(doc,bottom)}}function alignHorizontally(cm){var display=cm.display;if(display.alignWidgets||display.gutters.firstChild&&cm.options.fixedGutter){for(var comp=compensateForHScroll(display)-display.scroller.scrollLeft+cm.doc.scrollLeft,gutterW=display.gutters.offsetWidth,l=comp+"px",n=display.lineDiv.firstChild;n;n=n.nextSibling)if(n.alignable)for(var i=0,a=n.alignable;i<a.length;++i)a[i].style.left=l;cm.options.fixedGutter&&(display.gutters.style.left=comp+gutterW+"px")}}function maybeUpdateLineNumberWidth(cm){if(!cm.options.lineNumbers)return!1;var doc=cm.doc,last=lineNumberFor(cm.options,doc.first+doc.size-1),display=cm.display;if(last.length!=display.lineNumChars){var test=display.measure.appendChild(elt("div",[elt("div",last)],"CodeMirror-linenumber CodeMirror-gutter-elt")),innerW=test.firstChild.offsetWidth,padding=test.offsetWidth-innerW;return display.lineGutter.style.width="",display.lineNumInnerWidth=Math.max(innerW,display.lineGutter.offsetWidth-padding),display.lineNumWidth=display.lineNumInnerWidth+padding,display.lineNumChars=display.lineNumInnerWidth?last.length:-1,display.lineGutter.style.width=display.lineNumWidth+"px",!0}return!1}function lineNumberFor(options,i){return String(options.lineNumberFormatter(i+options.firstLineNumber))}function compensateForHScroll(display){return getRect(display.scroller).left-getRect(display.sizer).left}function updateDisplay(cm,changes,viewPort,forced){for(var updated,oldFrom=cm.display.showingFrom,oldTo=cm.display.showingTo,visible=visibleLines(cm.display,cm.doc,viewPort),first=!0;;first=!1){var oldWidth=cm.display.scroller.clientWidth;if(!updateDisplayInner(cm,changes,visible,forced))break;if(updated=!0,changes=[],updateSelection(cm),updateScrollbars(cm),first&&cm.options.lineWrapping&&oldWidth!=cm.display.scroller.clientWidth)forced=!0;else if(forced=!1,viewPort&&(viewPort=Math.min(cm.display.scroller.scrollHeight-cm.display.scroller.clientHeight,"number"==typeof viewPort?viewPort:viewPort.top)),visible=visibleLines(cm.display,cm.doc,viewPort),visible.from>=cm.display.showingFrom&&visible.to<=cm.display.showingTo)break}return updated&&(signalLater(cm,"update",cm),(cm.display.showingFrom!=oldFrom||cm.display.showingTo!=oldTo)&&signalLater(cm,"viewportChange",cm,cm.display.showingFrom,cm.display.showingTo)),updated}function updateDisplayInner(cm,changes,visible,forced){var display=cm.display,doc=cm.doc;if(!display.wrapper.clientWidth)return display.showingFrom=display.showingTo=doc.first,void(display.viewOffset=0);if(!(!forced&&0==changes.length&&visible.from>display.showingFrom&&visible.to<display.showingTo)){maybeUpdateLineNumberWidth(cm)&&(changes=[{from:doc.first,to:doc.first+doc.size}]);var gutterW=display.sizer.style.marginLeft=display.gutters.offsetWidth+"px";display.scrollbarH.style.left=cm.options.fixedGutter?gutterW:"0";var positionsChangedFrom=1/0;if(cm.options.lineNumbers)for(var i=0;i<changes.length;++i)changes[i].diff&&changes[i].from<positionsChangedFrom&&(positionsChangedFrom=changes[i].from);var end=doc.first+doc.size,from=Math.max(visible.from-cm.options.viewportMargin,doc.first),to=Math.min(end,visible.to+cm.options.viewportMargin);if(display.showingFrom<from&&from-display.showingFrom<20&&(from=Math.max(doc.first,display.showingFrom)),display.showingTo>to&&display.showingTo-to<20&&(to=Math.min(end,display.showingTo)),sawCollapsedSpans)for(from=lineNo(visualLine(doc,getLine(doc,from)));end>to&&lineIsHidden(doc,getLine(doc,to));)++to;var intact=[{from:Math.max(display.showingFrom,doc.first),to:Math.min(display.showingTo,end)}];if(intact=intact[0].from>=intact[0].to?[]:computeIntact(intact,changes),sawCollapsedSpans)for(var i=0;i<intact.length;++i)for(var merged,range=intact[i];merged=collapsedSpanAtEnd(getLine(doc,range.to-1));){var newTo=merged.find().from.line;if(!(newTo>range.from)){intact.splice(i--,1);break}range.to=newTo}for(var intactLines=0,i=0;i<intact.length;++i){var range=intact[i];range.from<from&&(range.from=from),range.to>to&&(range.to=to),range.from>=range.to?intact.splice(i--,1):intactLines+=range.to-range.from}if(!forced&&intactLines==to-from&&from==display.showingFrom&&to==display.showingTo)return void updateViewOffset(cm);intact.sort(function(a,b){return a.from-b.from});try{var focused=document.activeElement}catch(e){}.7*(to-from)>intactLines&&(display.lineDiv.style.display="none"),patchDisplay(cm,from,to,intact,positionsChangedFrom),display.lineDiv.style.display="",focused&&document.activeElement!=focused&&focused.offsetHeight&&focused.focus();var different=from!=display.showingFrom||to!=display.showingTo||display.lastSizeC!=display.wrapper.clientHeight;return different&&(display.lastSizeC=display.wrapper.clientHeight,startWorker(cm,400)),display.showingFrom=from,display.showingTo=to,updateHeightsInViewport(cm),updateViewOffset(cm),!0}}function updateHeightsInViewport(cm){for(var height,display=cm.display,prevBottom=display.lineDiv.offsetTop,node=display.lineDiv.firstChild;node;node=node.nextSibling)if(node.lineObj){if(ie_lt8){var bot=node.offsetTop+node.offsetHeight;height=bot-prevBottom,prevBottom=bot}else{var box=getRect(node);height=box.bottom-box.top}var diff=node.lineObj.height-height;if(2>height&&(height=textHeight(display)),diff>.001||-.001>diff){updateLineHeight(node.lineObj,height);var widgets=node.lineObj.widgets;if(widgets)for(var i=0;i<widgets.length;++i)widgets[i].height=widgets[i].node.offsetHeight}}}function updateViewOffset(cm){var off=cm.display.viewOffset=heightAtLine(cm,getLine(cm.doc,cm.display.showingFrom));cm.display.mover.style.top=off+"px"}function computeIntact(intact,changes){for(var i=0,l=changes.length||0;l>i;++i){for(var change=changes[i],intact2=[],diff=change.diff||0,j=0,l2=intact.length;l2>j;++j){var range=intact[j];change.to<=range.from&&change.diff?intact2.push({from:range.from+diff,to:range.to+diff}):change.to<=range.from||change.from>=range.to?intact2.push(range):(change.from>range.from&&intact2.push({from:range.from,to:change.from}),change.to<range.to&&intact2.push({from:change.to+diff,to:range.to+diff}))}intact=intact2}return intact}function getDimensions(cm){for(var d=cm.display,left={},width={},n=d.gutters.firstChild,i=0;n;n=n.nextSibling,++i)left[cm.options.gutters[i]]=n.offsetLeft,width[cm.options.gutters[i]]=n.offsetWidth;return{fixedPos:compensateForHScroll(d),gutterTotalWidth:d.gutters.offsetWidth,gutterLeft:left,gutterWidth:width,wrapperWidth:d.wrapper.clientWidth}}function patchDisplay(cm,from,to,intact,updateNumbersFrom){function rm(node){var next=node.nextSibling;return webkit&&mac&&cm.display.currentWheelTarget==node?(node.style.display="none",node.lineObj=null):node.parentNode.removeChild(node),next}var dims=getDimensions(cm),display=cm.display,lineNumbers=cm.options.lineNumbers;intact.length||webkit&&cm.display.currentWheelTarget||removeChildren(display.lineDiv);var container=display.lineDiv,cur=container.firstChild,nextIntact=intact.shift(),lineN=from;for(cm.doc.iter(from,to,function(line){if(nextIntact&&nextIntact.to==lineN&&(nextIntact=intact.shift()),lineIsHidden(cm.doc,line)){if(0!=line.height&&updateLineHeight(line,0),line.widgets&&cur&&cur.previousSibling)for(var i=0;i<line.widgets.length;++i){var w=line.widgets[i];if(w.showIfHidden){var prev=cur.previousSibling;if(/pre/i.test(prev.nodeName)){var wrap=elt("div",null,null,"position: relative");prev.parentNode.replaceChild(wrap,prev),wrap.appendChild(prev),prev=wrap}var wnode=prev.appendChild(elt("div",[w.node],"CodeMirror-linewidget"));w.handleMouseEvents||(wnode.ignoreEvents=!0),positionLineWidget(w,wnode,prev,dims)}}}else if(nextIntact&&nextIntact.from<=lineN&&nextIntact.to>lineN){for(;cur.lineObj!=line;)cur=rm(cur);lineNumbers&&lineN>=updateNumbersFrom&&cur.lineNumber&&setTextContent(cur.lineNumber,lineNumberFor(cm.options,lineN)),cur=cur.nextSibling}else{if(line.widgets)for(var reuse,j=0,search=cur;search&&20>j;++j,search=search.nextSibling)if(search.lineObj==line&&/div/i.test(search.nodeName)){reuse=search;break}var lineNode=buildLineElement(cm,line,lineN,dims,reuse);if(lineNode!=reuse)container.insertBefore(lineNode,cur);else{for(;cur!=reuse;)cur=rm(cur);cur=cur.nextSibling}lineNode.lineObj=line}++lineN});cur;)cur=rm(cur)}function buildLineElement(cm,line,lineNo,dims,reuse){var wrap,built=buildLineContent(cm,line),lineElement=built.pre,markers=line.gutterMarkers,display=cm.display,bgClass=built.bgClass?built.bgClass+" "+(line.bgClass||""):line.bgClass;if(!(cm.options.lineNumbers||markers||bgClass||line.wrapClass||line.widgets))return lineElement;if(reuse){reuse.alignable=null;for(var next,isOk=!0,widgetsSeen=0,insertBefore=null,n=reuse.firstChild;n;n=next)if(next=n.nextSibling,/\bCodeMirror-linewidget\b/.test(n.className)){for(var i=0;i<line.widgets.length;++i){var widget=line.widgets[i];if(widget.node==n.firstChild){widget.above||insertBefore||(insertBefore=n),positionLineWidget(widget,n,reuse,dims),++widgetsSeen;break}}if(i==line.widgets.length){isOk=!1;break}}else reuse.removeChild(n);reuse.insertBefore(lineElement,insertBefore),isOk&&widgetsSeen==line.widgets.length&&(wrap=reuse,reuse.className=line.wrapClass||"")}if(wrap||(wrap=elt("div",null,line.wrapClass,"position: relative"),wrap.appendChild(lineElement)),bgClass&&wrap.insertBefore(elt("div",null,bgClass+" CodeMirror-linebackground"),wrap.firstChild),cm.options.lineNumbers||markers){var gutterWrap=wrap.insertBefore(elt("div",null,null,"position: absolute; left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px"),wrap.firstChild);if(cm.options.fixedGutter&&(wrap.alignable||(wrap.alignable=[])).push(gutterWrap),!cm.options.lineNumbers||markers&&markers["CodeMirror-linenumbers"]||(wrap.lineNumber=gutterWrap.appendChild(elt("div",lineNumberFor(cm.options,lineNo),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+dims.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+display.lineNumInnerWidth+"px"))),markers)for(var k=0;k<cm.options.gutters.length;++k){var id=cm.options.gutters[k],found=markers.hasOwnProperty(id)&&markers[id];found&&gutterWrap.appendChild(elt("div",[found],"CodeMirror-gutter-elt","left: "+dims.gutterLeft[id]+"px; width: "+dims.gutterWidth[id]+"px"))}}if(ie_lt8&&(wrap.style.zIndex=2),line.widgets&&wrap!=reuse)for(var i=0,ws=line.widgets;i<ws.length;++i){var widget=ws[i],node=elt("div",[widget.node],"CodeMirror-linewidget");widget.handleMouseEvents||(node.ignoreEvents=!0),positionLineWidget(widget,node,wrap,dims),widget.above?wrap.insertBefore(node,cm.options.lineNumbers&&0!=line.height?gutterWrap:lineElement):wrap.appendChild(node),signalLater(widget,"redraw")}return wrap}function positionLineWidget(widget,node,wrap,dims){if(widget.noHScroll){(wrap.alignable||(wrap.alignable=[])).push(node);var width=dims.wrapperWidth;node.style.left=dims.fixedPos+"px",widget.coverGutter||(width-=dims.gutterTotalWidth,node.style.paddingLeft=dims.gutterTotalWidth+"px"),node.style.width=width+"px"}widget.coverGutter&&(node.style.zIndex=5,node.style.position="relative",widget.noHScroll||(node.style.marginLeft=-dims.gutterTotalWidth+"px"))}function updateSelection(cm){var display=cm.display,collapsed=posEq(cm.doc.sel.from,cm.doc.sel.to);if(collapsed||cm.options.showCursorWhenSelecting?updateSelectionCursor(cm):display.cursor.style.display=display.otherCursor.style.display="none",collapsed?display.selectionDiv.style.display="none":updateSelectionRange(cm),cm.options.moveInputWithCursor){var headPos=cursorCoords(cm,cm.doc.sel.head,"div"),wrapOff=getRect(display.wrapper),lineOff=getRect(display.lineDiv);display.inputDiv.style.top=Math.max(0,Math.min(display.wrapper.clientHeight-10,headPos.top+lineOff.top-wrapOff.top))+"px",display.inputDiv.style.left=Math.max(0,Math.min(display.wrapper.clientWidth-10,headPos.left+lineOff.left-wrapOff.left))+"px"}}function updateSelectionCursor(cm){var display=cm.display,pos=cursorCoords(cm,cm.doc.sel.head,"div");display.cursor.style.left=pos.left+"px",display.cursor.style.top=pos.top+"px",display.cursor.style.height=Math.max(0,pos.bottom-pos.top)*cm.options.cursorHeight+"px",display.cursor.style.display="",pos.other?(display.otherCursor.style.display="",display.otherCursor.style.left=pos.other.left+"px",display.otherCursor.style.top=pos.other.top+"px",display.otherCursor.style.height=.85*(pos.other.bottom-pos.other.top)+"px"):display.otherCursor.style.display="none"}function updateSelectionRange(cm){function add(left,top,width,bottom){0>top&&(top=0),fragment.appendChild(elt("div",null,"CodeMirror-selected","position: absolute; left: "+left+"px; top: "+top+"px; width: "+(null==width?clientWidth-left:width)+"px; height: "+(bottom-top)+"px"))}function drawForLine(line,fromArg,toArg){function coords(ch,bias){return charCoords(cm,Pos(line,ch),"div",lineObj,bias)}var start,end,lineObj=getLine(doc,line),lineLen=lineObj.text.length;return iterateBidiSections(getOrder(lineObj),fromArg||0,null==toArg?lineLen:toArg,function(from,to,dir){var rightPos,left,right,leftPos=coords(from,"left");if(from==to)rightPos=leftPos,left=right=leftPos.left;else{if(rightPos=coords(to-1,"right"),"rtl"==dir){var tmp=leftPos;leftPos=rightPos,rightPos=tmp}left=leftPos.left,right=rightPos.right}null==fromArg&&0==from&&(left=pl),rightPos.top-leftPos.top>3&&(add(left,leftPos.top,null,leftPos.bottom),left=pl,leftPos.bottom<rightPos.top&&add(left,leftPos.bottom,null,rightPos.top)),null==toArg&&to==lineLen&&(right=clientWidth),(!start||leftPos.top<start.top||leftPos.top==start.top&&leftPos.left<start.left)&&(start=leftPos),(!end||rightPos.bottom>end.bottom||rightPos.bottom==end.bottom&&rightPos.right>end.right)&&(end=rightPos),pl+1>left&&(left=pl),add(left,rightPos.top,right-left,rightPos.bottom)}),{start:start,end:end}}var display=cm.display,doc=cm.doc,sel=cm.doc.sel,fragment=document.createDocumentFragment(),clientWidth=display.lineSpace.offsetWidth,pl=paddingLeft(cm.display);if(sel.from.line==sel.to.line)drawForLine(sel.from.line,sel.from.ch,sel.to.ch);else{var fromLine=getLine(doc,sel.from.line),toLine=getLine(doc,sel.to.line),singleVLine=visualLine(doc,fromLine)==visualLine(doc,toLine),leftEnd=drawForLine(sel.from.line,sel.from.ch,singleVLine?fromLine.text.length:null).end,rightStart=drawForLine(sel.to.line,singleVLine?0:null,sel.to.ch).start;singleVLine&&(leftEnd.top<rightStart.top-2?(add(leftEnd.right,leftEnd.top,null,leftEnd.bottom),add(pl,rightStart.top,rightStart.left,rightStart.bottom)):add(leftEnd.right,leftEnd.top,rightStart.left-leftEnd.right,leftEnd.bottom)),leftEnd.bottom<rightStart.top&&add(pl,leftEnd.bottom,null,rightStart.top)}removeChildrenAndAdd(display.selectionDiv,fragment),display.selectionDiv.style.display=""}function restartBlink(cm){if(cm.state.focused){var display=cm.display;clearInterval(display.blinker);var on=!0;display.cursor.style.visibility=display.otherCursor.style.visibility="",cm.options.cursorBlinkRate>0&&(display.blinker=setInterval(function(){display.cursor.style.visibility=display.otherCursor.style.visibility=(on=!on)?"":"hidden"},cm.options.cursorBlinkRate))}}function startWorker(cm,time){cm.doc.mode.startState&&cm.doc.frontier<cm.display.showingTo&&cm.state.highlight.set(time,bind(highlightWorker,cm))}function highlightWorker(cm){var doc=cm.doc;if(doc.frontier<doc.first&&(doc.frontier=doc.first),!(doc.frontier>=cm.display.showingTo)){var prevChange,end=+new Date+cm.options.workTime,state=copyState(doc.mode,getStateBefore(cm,doc.frontier)),changed=[];doc.iter(doc.frontier,Math.min(doc.first+doc.size,cm.display.showingTo+500),function(line){if(doc.frontier>=cm.display.showingFrom){var oldStyles=line.styles;line.styles=highlightLine(cm,line,state);for(var ischange=!oldStyles||oldStyles.length!=line.styles.length,i=0;!ischange&&i<oldStyles.length;++i)ischange=oldStyles[i]!=line.styles[i];ischange&&(prevChange&&prevChange.end==doc.frontier?prevChange.end++:changed.push(prevChange={start:doc.frontier,end:doc.frontier+1})),line.stateAfter=copyState(doc.mode,state)}else processLine(cm,line,state),line.stateAfter=doc.frontier%5==0?copyState(doc.mode,state):null;return++doc.frontier,+new Date>end?(startWorker(cm,cm.options.workDelay),!0):void 0}),changed.length&&operation(cm,function(){for(var i=0;i<changed.length;++i)regChange(this,changed[i].start,changed[i].end)})()}}function findStartLine(cm,n,precise){for(var minindent,minline,doc=cm.doc,lim=precise?-1:n-(cm.doc.mode.innerMode?1e3:100),search=n;search>lim;--search){if(search<=doc.first)return doc.first;var line=getLine(doc,search-1);if(line.stateAfter&&(!precise||search<=doc.frontier))return search;var indented=countColumn(line.text,null,cm.options.tabSize);(null==minline||minindent>indented)&&(minline=search-1,minindent=indented)}return minline}function getStateBefore(cm,n,precise){var doc=cm.doc,display=cm.display;if(!doc.mode.startState)return!0;var pos=findStartLine(cm,n,precise),state=pos>doc.first&&getLine(doc,pos-1).stateAfter;return state=state?copyState(doc.mode,state):startState(doc.mode),doc.iter(pos,n,function(line){processLine(cm,line,state);var save=pos==n-1||pos%5==0||pos>=display.showingFrom&&pos<display.showingTo;line.stateAfter=save?copyState(doc.mode,state):null,++pos}),precise&&(doc.frontier=pos),state}function paddingTop(display){return display.lineSpace.offsetTop}function paddingVert(display){return display.mover.offsetHeight-display.lineSpace.offsetHeight}function paddingLeft(display){var e=removeChildrenAndAdd(display.measure,elt("pre",null,null,"text-align: left")).appendChild(elt("span","x"));return e.offsetLeft}function measureChar(cm,line,ch,data,bias){var dir=-1;if(data=data||measureLine(cm,line),data.crude){var left=data.left+ch*data.width;return{left:left,right:left+data.width,top:data.top,bottom:data.bottom}}for(var pos=ch;;pos+=dir){var r=data[pos];if(r)break;0>dir&&0==pos&&(dir=1)}return bias=pos>ch?"left":ch>pos?"right":bias,"left"==bias&&r.leftSide?r=r.leftSide:"right"==bias&&r.rightSide&&(r=r.rightSide),{left:ch>pos?r.right:r.left,right:pos>ch?r.left:r.right,top:r.top,bottom:r.bottom}}function findCachedMeasurement(cm,line){for(var cache=cm.display.measureLineCache,i=0;i<cache.length;++i){var memo=cache[i];if(memo.text==line.text&&memo.markedSpans==line.markedSpans&&cm.display.scroller.clientWidth==memo.width&&memo.classes==line.textClass+"|"+line.wrapClass)return memo}}function clearCachedMeasurement(cm,line){var exists=findCachedMeasurement(cm,line);exists&&(exists.text=exists.measure=exists.markedSpans=null)}function measureLine(cm,line){var cached=findCachedMeasurement(cm,line);if(cached)return cached.measure;var measure=measureLineInner(cm,line),cache=cm.display.measureLineCache,memo={text:line.text,width:cm.display.scroller.clientWidth,markedSpans:line.markedSpans,measure:measure,classes:line.textClass+"|"+line.wrapClass};return 16==cache.length?cache[++cm.display.measureLineCachePos%16]=memo:cache.push(memo),measure}function measureLineInner(cm,line){function measureRect(rect){var top=rect.top-outer.top,bot=rect.bottom-outer.top;bot>maxBot&&(bot=maxBot),0>top&&(top=0);for(var i=vranges.length-2;i>=0;i-=2){var rtop=vranges[i],rbot=vranges[i+1];if(!(rtop>bot||top>rbot)&&(top>=rtop&&rbot>=bot||rtop>=top&&bot>=rbot||Math.min(bot,rbot)-Math.max(top,rtop)>=bot-top>>1)){vranges[i]=Math.min(top,rtop),vranges[i+1]=Math.max(bot,rbot);break}}return 0>i&&(i=vranges.length,vranges.push(top,bot)),{left:rect.left-outer.left,right:rect.right-outer.left,top:i,bottom:null}}function finishRect(rect){rect.bottom=vranges[rect.top+1],rect.top=vranges[rect.top]}if(!cm.options.lineWrapping&&line.text.length>=cm.options.crudeMeasuringFrom)return crudelyMeasureLine(cm,line);var display=cm.display,measure=emptyArray(line.text.length),pre=buildLineContent(cm,line,measure,!0).pre;if(ie&&!ie_lt8&&!cm.options.lineWrapping&&pre.childNodes.length>100){for(var fragment=document.createDocumentFragment(),chunk=10,n=pre.childNodes.length,i=0,chunks=Math.ceil(n/chunk);chunks>i;++i){for(var wrap=elt("div",null,null,"display: inline-block"),j=0;chunk>j&&n;++j)wrap.appendChild(pre.firstChild),--n;fragment.appendChild(wrap)}pre.appendChild(fragment)}removeChildrenAndAdd(display.measure,pre);var outer=getRect(display.lineDiv),vranges=[],data=emptyArray(line.text.length),maxBot=pre.offsetHeight;ie_lt9&&display.measure.first!=pre&&removeChildrenAndAdd(display.measure,pre);for(var cur,i=0;i<measure.length;++i)if(cur=measure[i]){var node=cur,rect=null;if(/\bCodeMirror-widget\b/.test(cur.className)&&cur.getClientRects){1==cur.firstChild.nodeType&&(node=cur.firstChild);var rects=node.getClientRects();rects.length>1&&(rect=data[i]=measureRect(rects[0]),rect.rightSide=measureRect(rects[rects.length-1]))}rect||(rect=data[i]=measureRect(getRect(node))),cur.measureRight&&(rect.right=getRect(cur.measureRight).left),cur.leftSide&&(rect.leftSide=measureRect(getRect(cur.leftSide)))}removeChildren(cm.display.measure);for(var cur,i=0;i<data.length;++i)(cur=data[i])&&(finishRect(cur),cur.leftSide&&finishRect(cur.leftSide),cur.rightSide&&finishRect(cur.rightSide));return data}function crudelyMeasureLine(cm,line){var copy=new Line(line.text.slice(0,100),null);line.textClass&&(copy.textClass=line.textClass);var measure=measureLineInner(cm,copy),left=measureChar(cm,copy,0,measure,"left"),right=measureChar(cm,copy,99,measure,"right");return{crude:!0,top:left.top,left:left.left,bottom:left.bottom,width:(right.right-left.left)/100}}function measureLineWidth(cm,line){var hasBadSpan=!1;if(line.markedSpans)for(var i=0;i<line.markedSpans;++i){var sp=line.markedSpans[i];!sp.collapsed||null!=sp.to&&sp.to!=line.text.length||(hasBadSpan=!0)}var cached=!hasBadSpan&&findCachedMeasurement(cm,line);if(cached||line.text.length>=cm.options.crudeMeasuringFrom)return measureChar(cm,line,line.text.length,cached&&cached.measure,"right").right;var pre=buildLineContent(cm,line,null,!0).pre,end=pre.appendChild(zeroWidthElement(cm.display.measure));return removeChildrenAndAdd(cm.display.measure,pre),getRect(end).right-getRect(cm.display.lineDiv).left}function clearCaches(cm){cm.display.measureLineCache.length=cm.display.measureLineCachePos=0,cm.display.cachedCharWidth=cm.display.cachedTextHeight=null,cm.options.lineWrapping||(cm.display.maxLineChanged=!0),cm.display.lineNumChars=null}function pageScrollX(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function pageScrollY(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function intoCoordSystem(cm,lineObj,rect,context){if(lineObj.widgets)for(var i=0;i<lineObj.widgets.length;++i)if(lineObj.widgets[i].above){var size=widgetHeight(lineObj.widgets[i]);rect.top+=size,rect.bottom+=size}if("line"==context)return rect;context||(context="local");var yOff=heightAtLine(cm,lineObj);if("local"==context?yOff+=paddingTop(cm.display):yOff-=cm.display.viewOffset,"page"==context||"window"==context){var lOff=getRect(cm.display.lineSpace);yOff+=lOff.top+("window"==context?0:pageScrollY());var xOff=lOff.left+("window"==context?0:pageScrollX());rect.left+=xOff,rect.right+=xOff}return rect.top+=yOff,rect.bottom+=yOff,rect}function fromCoordSystem(cm,coords,context){if("div"==context)return coords;var left=coords.left,top=coords.top;if("page"==context)left-=pageScrollX(),top-=pageScrollY();else if("local"==context||!context){var localBox=getRect(cm.display.sizer);left+=localBox.left,top+=localBox.top}var lineSpaceBox=getRect(cm.display.lineSpace);return{left:left-lineSpaceBox.left,top:top-lineSpaceBox.top}}function charCoords(cm,pos,context,lineObj,bias){return lineObj||(lineObj=getLine(cm.doc,pos.line)),intoCoordSystem(cm,lineObj,measureChar(cm,lineObj,pos.ch,null,bias),context)}function cursorCoords(cm,pos,context,lineObj,measurement){function get(ch,right){var m=measureChar(cm,lineObj,ch,measurement,right?"right":"left");return right?m.left=m.right:m.right=m.left,intoCoordSystem(cm,lineObj,m,context)}function getBidi(ch,partPos){var part=order[partPos],right=part.level%2;return ch==bidiLeft(part)&&partPos&&part.level<order[partPos-1].level?(part=order[--partPos],ch=bidiRight(part)-(part.level%2?0:1),right=!0):ch==bidiRight(part)&&partPos<order.length-1&&part.level<order[partPos+1].level&&(part=order[++partPos],ch=bidiLeft(part)-part.level%2,right=!1),right&&ch==part.to&&ch>part.from?get(ch-1):get(ch,right)}lineObj=lineObj||getLine(cm.doc,pos.line),measurement||(measurement=measureLine(cm,lineObj));var order=getOrder(lineObj),ch=pos.ch;if(!order)return get(ch);var partPos=getBidiPartAt(order,ch),val=getBidi(ch,partPos);return null!=bidiOther&&(val.other=getBidi(ch,bidiOther)),val}function PosWithInfo(line,ch,outside,xRel){var pos=new Pos(line,ch);return pos.xRel=xRel,outside&&(pos.outside=!0),pos}function coordsChar(cm,x,y){var doc=cm.doc;if(y+=cm.display.viewOffset,0>y)return PosWithInfo(doc.first,0,!0,-1);var lineNo=lineAtHeight(doc,y),last=doc.first+doc.size-1;if(lineNo>last)return PosWithInfo(doc.first+doc.size-1,getLine(doc,last).text.length,!0,1);for(0>x&&(x=0);;){var lineObj=getLine(doc,lineNo),found=coordsCharInner(cm,lineObj,lineNo,x,y),merged=collapsedSpanAtEnd(lineObj),mergedPos=merged&&merged.find();if(!merged||!(found.ch>mergedPos.from.ch||found.ch==mergedPos.from.ch&&found.xRel>0))return found;lineNo=mergedPos.to.line}}function coordsCharInner(cm,lineObj,lineNo,x,y){function getX(ch){var sp=cursorCoords(cm,Pos(lineNo,ch),"line",lineObj,measurement);return wrongLine=!0,innerOff>sp.bottom?sp.left-adjust:innerOff<sp.top?sp.left+adjust:(wrongLine=!1,sp.left)}var innerOff=y-heightAtLine(cm,lineObj),wrongLine=!1,adjust=2*cm.display.wrapper.clientWidth,measurement=measureLine(cm,lineObj),bidi=getOrder(lineObj),dist=lineObj.text.length,from=lineLeft(lineObj),to=lineRight(lineObj),fromX=getX(from),fromOutside=wrongLine,toX=getX(to),toOutside=wrongLine;if(x>toX)return PosWithInfo(lineNo,to,toOutside,1);for(;;){if(bidi?to==from||to==moveVisually(lineObj,from,1):1>=to-from){for(var ch=fromX>x||toX-x>=x-fromX?from:to,xDiff=x-(ch==from?fromX:toX);isExtendingChar.test(lineObj.text.charAt(ch));)++ch;var pos=PosWithInfo(lineNo,ch,ch==from?fromOutside:toOutside,0>xDiff?-1:xDiff?1:0);return pos}var step=Math.ceil(dist/2),middle=from+step;if(bidi){middle=from;for(var i=0;step>i;++i)middle=moveVisually(lineObj,middle,1)}var middleX=getX(middle);middleX>x?(to=middle,toX=middleX,(toOutside=wrongLine)&&(toX+=1e3),dist=step):(from=middle,fromX=middleX,fromOutside=wrongLine,dist-=step)}}function textHeight(display){if(null!=display.cachedTextHeight)return display.cachedTextHeight;if(null==measureText){measureText=elt("pre");for(var i=0;49>i;++i)measureText.appendChild(document.createTextNode("x")),measureText.appendChild(elt("br"));measureText.appendChild(document.createTextNode("x"))}removeChildrenAndAdd(display.measure,measureText);var height=measureText.offsetHeight/50;return height>3&&(display.cachedTextHeight=height),removeChildren(display.measure),height||1}function charWidth(display){if(null!=display.cachedCharWidth)return display.cachedCharWidth;var anchor=elt("span","x"),pre=elt("pre",[anchor]);removeChildrenAndAdd(display.measure,pre);
var width=anchor.offsetWidth;return width>2&&(display.cachedCharWidth=width),width||10}function startOperation(cm){cm.curOp={changes:[],forceUpdate:!1,updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,cursorActivity:!1,updateMaxLine:!1,updateScrollPos:!1,id:++nextOpId},delayedCallbackDepth++||(delayedCallbacks=[])}function endOperation(cm){var op=cm.curOp,doc=cm.doc,display=cm.display;if(cm.curOp=null,op.updateMaxLine&&computeMaxLength(cm),display.maxLineChanged&&!cm.options.lineWrapping&&display.maxLine){var width=measureLineWidth(cm,display.maxLine);display.sizer.style.minWidth=Math.max(0,width+3+scrollerCutOff)+"px",display.maxLineChanged=!1;var maxScrollLeft=Math.max(0,display.sizer.offsetLeft+display.sizer.offsetWidth-display.scroller.clientWidth);maxScrollLeft<doc.scrollLeft&&!op.updateScrollPos&&setScrollLeft(cm,Math.min(display.scroller.scrollLeft,maxScrollLeft),!0)}var newScrollPos,updated;if(op.updateScrollPos)newScrollPos=op.updateScrollPos;else if(op.selectionChanged&&display.scroller.clientHeight){var coords=cursorCoords(cm,doc.sel.head);newScrollPos=calculateScrollPos(cm,coords.left,coords.top,coords.left,coords.bottom)}(op.changes.length||op.forceUpdate||newScrollPos&&null!=newScrollPos.scrollTop)&&(updated=updateDisplay(cm,op.changes,newScrollPos&&newScrollPos.scrollTop,op.forceUpdate),cm.display.scroller.offsetHeight&&(cm.doc.scrollTop=cm.display.scroller.scrollTop)),!updated&&op.selectionChanged&&updateSelection(cm),op.updateScrollPos?(display.scroller.scrollTop=display.scrollbarV.scrollTop=doc.scrollTop=newScrollPos.scrollTop,display.scroller.scrollLeft=display.scrollbarH.scrollLeft=doc.scrollLeft=newScrollPos.scrollLeft,alignHorizontally(cm),op.scrollToPos&&scrollPosIntoView(cm,clipPos(cm.doc,op.scrollToPos.from),clipPos(cm.doc,op.scrollToPos.to),op.scrollToPos.margin)):newScrollPos&&scrollCursorIntoView(cm),op.selectionChanged&&restartBlink(cm),cm.state.focused&&op.updateInput&&resetInput(cm,op.userSelChange);var hidden=op.maybeHiddenMarkers,unhidden=op.maybeUnhiddenMarkers;if(hidden)for(var i=0;i<hidden.length;++i)hidden[i].lines.length||signal(hidden[i],"hide");if(unhidden)for(var i=0;i<unhidden.length;++i)unhidden[i].lines.length&&signal(unhidden[i],"unhide");var delayed;if(--delayedCallbackDepth||(delayed=delayedCallbacks,delayedCallbacks=null),op.textChanged&&signal(cm,"change",cm,op.textChanged),op.cursorActivity&&signal(cm,"cursorActivity",cm),delayed)for(var i=0;i<delayed.length;++i)delayed[i]()}function operation(cm1,f){return function(){var cm=cm1||this,withOp=!cm.curOp;withOp&&startOperation(cm);try{var result=f.apply(cm,arguments)}finally{withOp&&endOperation(cm)}return result}}function docOperation(f){return function(){var result,withOp=this.cm&&!this.cm.curOp;withOp&&startOperation(this.cm);try{result=f.apply(this,arguments)}finally{withOp&&endOperation(this.cm)}return result}}function runInOp(cm,f){var result,withOp=!cm.curOp;withOp&&startOperation(cm);try{result=f()}finally{withOp&&endOperation(cm)}return result}function regChange(cm,from,to,lendiff){null==from&&(from=cm.doc.first),null==to&&(to=cm.doc.first+cm.doc.size),cm.curOp.changes.push({from:from,to:to,diff:lendiff})}function slowPoll(cm){cm.display.pollingFast||cm.display.poll.set(cm.options.pollInterval,function(){readInput(cm),cm.state.focused&&slowPoll(cm)})}function fastPoll(cm){function p(){var changed=readInput(cm);changed||missed?(cm.display.pollingFast=!1,slowPoll(cm)):(missed=!0,cm.display.poll.set(60,p))}var missed=!1;cm.display.pollingFast=!0,cm.display.poll.set(20,p)}function readInput(cm){var input=cm.display.input,prevInput=cm.display.prevInput,doc=cm.doc,sel=doc.sel;if(!cm.state.focused||hasSelection(input)||isReadOnly(cm)||cm.state.disableInput)return!1;cm.state.pasteIncoming&&cm.state.fakedLastChar&&(input.value=input.value.substring(0,input.value.length-1),cm.state.fakedLastChar=!1);var text=input.value;if(text==prevInput&&posEq(sel.from,sel.to))return!1;if(ie&&!ie_lt9&&cm.display.inputHasSelection===text)return resetInput(cm,!0),!1;var withOp=!cm.curOp;withOp&&startOperation(cm),sel.shift=!1;for(var same=0,l=Math.min(prevInput.length,text.length);l>same&&prevInput.charCodeAt(same)==text.charCodeAt(same);)++same;var from=sel.from,to=sel.to;same<prevInput.length?from=Pos(from.line,from.ch-(prevInput.length-same)):cm.state.overwrite&&posEq(from,to)&&!cm.state.pasteIncoming&&(to=Pos(to.line,Math.min(getLine(doc,to.line).text.length,to.ch+(text.length-same))));var updateInput=cm.curOp.updateInput,changeEvent={from:from,to:to,text:splitLines(text.slice(same)),origin:cm.state.pasteIncoming?"paste":"+input"};return makeChange(cm.doc,changeEvent,"end"),cm.curOp.updateInput=updateInput,signalLater(cm,"inputRead",cm,changeEvent),text.length>1e3||text.indexOf("\n")>-1?input.value=cm.display.prevInput="":cm.display.prevInput=text,withOp&&endOperation(cm),cm.state.pasteIncoming=!1,!0}function resetInput(cm,user){var minimal,selected,doc=cm.doc;if(posEq(doc.sel.from,doc.sel.to))user&&(cm.display.prevInput=cm.display.input.value="",ie&&!ie_lt9&&(cm.display.inputHasSelection=null));else{cm.display.prevInput="",minimal=hasCopyEvent&&(doc.sel.to.line-doc.sel.from.line>100||(selected=cm.getSelection()).length>1e3);var content=minimal?"-":selected||cm.getSelection();cm.display.input.value=content,cm.state.focused&&selectInput(cm.display.input),ie&&!ie_lt9&&(cm.display.inputHasSelection=content)}cm.display.inaccurateSelection=minimal}function focusInput(cm){"nocursor"==cm.options.readOnly||mobile&&document.activeElement==cm.display.input||cm.display.input.focus()}function isReadOnly(cm){return cm.options.readOnly||cm.doc.cantEdit}function registerEventHandlers(cm){function reFocus(){cm.state.focused&&setTimeout(bind(focusInput,cm),0)}function onResize(){null==resizeTimer&&(resizeTimer=setTimeout(function(){resizeTimer=null,d.cachedCharWidth=d.cachedTextHeight=knownScrollbarWidth=null,clearCaches(cm),runInOp(cm,bind(regChange,cm))},100))}function unregister(){for(var p=d.wrapper.parentNode;p&&p!=document.body;p=p.parentNode);p?setTimeout(unregister,5e3):off(window,"resize",onResize)}function drag_(e){signalDOMEvent(cm,e)||cm.options.onDragEvent&&cm.options.onDragEvent(cm,addStop(e))||e_stop(e)}function prepareCopy(){d.inaccurateSelection&&(d.prevInput="",d.inaccurateSelection=!1,d.input.value=cm.getSelection(),selectInput(d.input))}var d=cm.display;on(d.scroller,"mousedown",operation(cm,onMouseDown)),ie?on(d.scroller,"dblclick",operation(cm,function(e){if(!signalDOMEvent(cm,e)){var pos=posFromMouse(cm,e);if(pos&&!clickInGutter(cm,e)&&!eventInWidget(cm.display,e)){e_preventDefault(e);var word=findWordAt(getLine(cm.doc,pos.line).text,pos);extendSelection(cm.doc,word.from,word.to)}}})):on(d.scroller,"dblclick",function(e){signalDOMEvent(cm,e)||e_preventDefault(e)}),on(d.lineSpace,"selectstart",function(e){eventInWidget(d,e)||e_preventDefault(e)}),captureMiddleClick||on(d.scroller,"contextmenu",function(e){onContextMenu(cm,e)}),on(d.scroller,"scroll",function(){d.scroller.clientHeight&&(setScrollTop(cm,d.scroller.scrollTop),setScrollLeft(cm,d.scroller.scrollLeft,!0),signal(cm,"scroll",cm))}),on(d.scrollbarV,"scroll",function(){d.scroller.clientHeight&&setScrollTop(cm,d.scrollbarV.scrollTop)}),on(d.scrollbarH,"scroll",function(){d.scroller.clientHeight&&setScrollLeft(cm,d.scrollbarH.scrollLeft)}),on(d.scroller,"mousewheel",function(e){onScrollWheel(cm,e)}),on(d.scroller,"DOMMouseScroll",function(e){onScrollWheel(cm,e)}),on(d.scrollbarH,"mousedown",reFocus),on(d.scrollbarV,"mousedown",reFocus),on(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0});var resizeTimer;on(window,"resize",onResize),setTimeout(unregister,5e3),on(d.input,"keyup",operation(cm,function(e){signalDOMEvent(cm,e)||cm.options.onKeyEvent&&cm.options.onKeyEvent(cm,addStop(e))||16==e.keyCode&&(cm.doc.sel.shift=!1)})),on(d.input,"input",function(){ie&&!ie_lt9&&cm.display.inputHasSelection&&(cm.display.inputHasSelection=null),fastPoll(cm)}),on(d.input,"keydown",operation(cm,onKeyDown)),on(d.input,"keypress",operation(cm,onKeyPress)),on(d.input,"focus",bind(onFocus,cm)),on(d.input,"blur",bind(onBlur,cm)),cm.options.dragDrop&&(on(d.scroller,"dragstart",function(e){onDragStart(cm,e)}),on(d.scroller,"dragenter",drag_),on(d.scroller,"dragover",drag_),on(d.scroller,"drop",operation(cm,onDrop))),on(d.scroller,"paste",function(e){eventInWidget(d,e)||(focusInput(cm),fastPoll(cm))}),on(d.input,"paste",function(){if(webkit&&!cm.state.fakedLastChar&&!(new Date-cm.state.lastMiddleDown<200)){var start=d.input.selectionStart,end=d.input.selectionEnd;d.input.value+="$",d.input.selectionStart=start,d.input.selectionEnd=end,cm.state.fakedLastChar=!0}cm.state.pasteIncoming=!0,fastPoll(cm)}),on(d.input,"cut",prepareCopy),on(d.input,"copy",prepareCopy),khtml&&on(d.sizer,"mouseup",function(){document.activeElement==d.input&&d.input.blur(),focusInput(cm)})}function eventInWidget(display,e){for(var n=e_target(e);n!=display.wrapper;n=n.parentNode)if(!n||n.ignoreEvents||n.parentNode==display.sizer&&n!=display.mover)return!0}function posFromMouse(cm,e,liberal){var display=cm.display;if(!liberal){var target=e_target(e);if(target==display.scrollbarH||target==display.scrollbarH.firstChild||target==display.scrollbarV||target==display.scrollbarV.firstChild||target==display.scrollbarFiller||target==display.gutterFiller)return null}var x,y,space=getRect(display.lineSpace);try{x=e.clientX,y=e.clientY}catch(e){return null}return coordsChar(cm,x-space.left,y-space.top)}function onMouseDown(e){function doSelect(cur){if(!posEq(lastPos,cur)){if(lastPos=cur,"single"==type)return void extendSelection(cm.doc,clipPos(doc,start),cur);if(startstart=clipPos(doc,startstart),startend=clipPos(doc,startend),"double"==type){var word=findWordAt(getLine(doc,cur.line).text,cur);posLess(cur,startstart)?extendSelection(cm.doc,word.from,startend):extendSelection(cm.doc,startstart,word.to)}else"triple"==type&&(posLess(cur,startstart)?extendSelection(cm.doc,startend,clipPos(doc,Pos(cur.line,0))):extendSelection(cm.doc,startstart,clipPos(doc,Pos(cur.line+1,0))))}}function extend(e){var curCount=++counter,cur=posFromMouse(cm,e,!0);if(cur)if(posEq(cur,last)){var outside=e.clientY<editorSize.top?-20:e.clientY>editorSize.bottom?20:0;outside&&setTimeout(operation(cm,function(){counter==curCount&&(display.scroller.scrollTop+=outside,extend(e))}),50)}else{cm.state.focused||onFocus(cm),last=cur,doSelect(cur);var visible=visibleLines(display,doc);(cur.line>=visible.to||cur.line<visible.from)&&setTimeout(operation(cm,function(){counter==curCount&&extend(e)}),150)}}function done(e){counter=1/0,e_preventDefault(e),focusInput(cm),off(document,"mousemove",move),off(document,"mouseup",up)}if(!signalDOMEvent(this,e)){var cm=this,display=cm.display,doc=cm.doc,sel=doc.sel;if(sel.shift=e.shiftKey,eventInWidget(display,e))return void(webkit||(display.scroller.draggable=!1,setTimeout(function(){display.scroller.draggable=!0},100)));if(!clickInGutter(cm,e)){var start=posFromMouse(cm,e);switch(e_button(e)){case 3:return void(captureMiddleClick&&onContextMenu.call(cm,cm,e));case 2:return webkit&&(cm.state.lastMiddleDown=+new Date),start&&extendSelection(cm.doc,start),setTimeout(bind(focusInput,cm),20),void e_preventDefault(e)}if(!start)return void(e_target(e)==display.scroller&&e_preventDefault(e));cm.state.focused||onFocus(cm);var now=+new Date,type="single";if(lastDoubleClick&&lastDoubleClick.time>now-400&&posEq(lastDoubleClick.pos,start))type="triple",e_preventDefault(e),setTimeout(bind(focusInput,cm),20),selectLine(cm,start.line);else if(lastClick&&lastClick.time>now-400&&posEq(lastClick.pos,start)){type="double",lastDoubleClick={time:now,pos:start},e_preventDefault(e);var word=findWordAt(getLine(doc,start.line).text,start);extendSelection(cm.doc,word.from,word.to)}else lastClick={time:now,pos:start};var last=start;if(cm.options.dragDrop&&dragAndDrop&&!isReadOnly(cm)&&!posEq(sel.from,sel.to)&&!posLess(start,sel.from)&&!posLess(sel.to,start)&&"single"==type){var dragEnd=operation(cm,function(e2){webkit&&(display.scroller.draggable=!1),cm.state.draggingText=!1,off(document,"mouseup",dragEnd),off(display.scroller,"drop",dragEnd),Math.abs(e.clientX-e2.clientX)+Math.abs(e.clientY-e2.clientY)<10&&(e_preventDefault(e2),extendSelection(cm.doc,start),focusInput(cm))});return webkit&&(display.scroller.draggable=!0),cm.state.draggingText=dragEnd,display.scroller.dragDrop&&display.scroller.dragDrop(),on(document,"mouseup",dragEnd),void on(display.scroller,"drop",dragEnd)}e_preventDefault(e),"single"==type&&extendSelection(cm.doc,clipPos(doc,start));var startstart=sel.from,startend=sel.to,lastPos=start,editorSize=getRect(display.wrapper),counter=0,move=operation(cm,function(e){ie||e_button(e)?extend(e):done(e)}),up=operation(cm,done);on(document,"mousemove",move),on(document,"mouseup",up)}}}function gutterEvent(cm,e,type,prevent,signalfn){try{var mX=e.clientX,mY=e.clientY}catch(e){return!1}if(mX>=Math.floor(getRect(cm.display.gutters).right))return!1;prevent&&e_preventDefault(e);var display=cm.display,lineBox=getRect(display.lineDiv);if(mY>lineBox.bottom||!hasHandler(cm,type))return e_defaultPrevented(e);mY-=lineBox.top-display.viewOffset;for(var i=0;i<cm.options.gutters.length;++i){var g=display.gutters.childNodes[i];if(g&&getRect(g).right>=mX){var line=lineAtHeight(cm.doc,mY),gutter=cm.options.gutters[i];return signalfn(cm,type,cm,line,gutter,e),e_defaultPrevented(e)}}}function contextMenuInGutter(cm,e){return hasHandler(cm,"gutterContextMenu")?gutterEvent(cm,e,"gutterContextMenu",!1,signal):!1}function clickInGutter(cm,e){return gutterEvent(cm,e,"gutterClick",!0,signalLater)}function onDrop(e){var cm=this;if(!(signalDOMEvent(cm,e)||eventInWidget(cm.display,e)||cm.options.onDragEvent&&cm.options.onDragEvent(cm,addStop(e)))){e_preventDefault(e),ie&&(lastDrop=+new Date);var pos=posFromMouse(cm,e,!0),files=e.dataTransfer.files;if(pos&&!isReadOnly(cm))if(files&&files.length&&window.FileReader&&window.File)for(var n=files.length,text=Array(n),read=0,loadFile=function(file,i){var reader=new FileReader;reader.onload=function(){text[i]=reader.result,++read==n&&(pos=clipPos(cm.doc,pos),makeChange(cm.doc,{from:pos,to:pos,text:splitLines(text.join("\n")),origin:"paste"},"around"))},reader.readAsText(file)},i=0;n>i;++i)loadFile(files[i],i);else{if(cm.state.draggingText&&!posLess(pos,cm.doc.sel.from)&&!posLess(cm.doc.sel.to,pos))return cm.state.draggingText(e),void setTimeout(bind(focusInput,cm),20);try{var text=e.dataTransfer.getData("Text");if(text){var curFrom=cm.doc.sel.from,curTo=cm.doc.sel.to;setSelection(cm.doc,pos,pos),cm.state.draggingText&&replaceRange(cm.doc,"",curFrom,curTo,"paste"),cm.replaceSelection(text,null,"paste"),focusInput(cm),onFocus(cm)}}catch(e){}}}}function onDragStart(cm,e){if(ie&&(!cm.state.draggingText||+new Date-lastDrop<100))return void e_stop(e);if(!signalDOMEvent(cm,e)&&!eventInWidget(cm.display,e)){var txt=cm.getSelection();if(e.dataTransfer.setData("Text",txt),e.dataTransfer.setDragImage&&!safari){var img=elt("img",null,null,"position: fixed; left: 0; top: 0;");img.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",opera&&(img.width=img.height=1,cm.display.wrapper.appendChild(img),img._top=img.offsetTop),e.dataTransfer.setDragImage(img,0,0),opera&&img.parentNode.removeChild(img)}}}function setScrollTop(cm,val){Math.abs(cm.doc.scrollTop-val)<2||(cm.doc.scrollTop=val,gecko||updateDisplay(cm,[],val),cm.display.scroller.scrollTop!=val&&(cm.display.scroller.scrollTop=val),cm.display.scrollbarV.scrollTop!=val&&(cm.display.scrollbarV.scrollTop=val),gecko&&updateDisplay(cm,[]),startWorker(cm,100))}function setScrollLeft(cm,val,isScroller){(isScroller?val==cm.doc.scrollLeft:Math.abs(cm.doc.scrollLeft-val)<2)||(val=Math.min(val,cm.display.scroller.scrollWidth-cm.display.scroller.clientWidth),cm.doc.scrollLeft=val,alignHorizontally(cm),cm.display.scroller.scrollLeft!=val&&(cm.display.scroller.scrollLeft=val),cm.display.scrollbarH.scrollLeft!=val&&(cm.display.scrollbarH.scrollLeft=val))}function onScrollWheel(cm,e){var dx=e.wheelDeltaX,dy=e.wheelDeltaY;null==dx&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(dx=e.detail),null==dy&&e.detail&&e.axis==e.VERTICAL_AXIS?dy=e.detail:null==dy&&(dy=e.wheelDelta);var display=cm.display,scroll=display.scroller;if(dx&&scroll.scrollWidth>scroll.clientWidth||dy&&scroll.scrollHeight>scroll.clientHeight){if(dy&&mac&&webkit)for(var cur=e.target;cur!=scroll;cur=cur.parentNode)if(cur.lineObj){cm.display.currentWheelTarget=cur;break}if(dx&&!gecko&&!opera&&null!=wheelPixelsPerUnit)return dy&&setScrollTop(cm,Math.max(0,Math.min(scroll.scrollTop+dy*wheelPixelsPerUnit,scroll.scrollHeight-scroll.clientHeight))),setScrollLeft(cm,Math.max(0,Math.min(scroll.scrollLeft+dx*wheelPixelsPerUnit,scroll.scrollWidth-scroll.clientWidth))),e_preventDefault(e),void(display.wheelStartX=null);if(dy&&null!=wheelPixelsPerUnit){var pixels=dy*wheelPixelsPerUnit,top=cm.doc.scrollTop,bot=top+display.wrapper.clientHeight;0>pixels?top=Math.max(0,top+pixels-50):bot=Math.min(cm.doc.height,bot+pixels+50),updateDisplay(cm,[],{top:top,bottom:bot})}20>wheelSamples&&(null==display.wheelStartX?(display.wheelStartX=scroll.scrollLeft,display.wheelStartY=scroll.scrollTop,display.wheelDX=dx,display.wheelDY=dy,setTimeout(function(){if(null!=display.wheelStartX){var movedX=scroll.scrollLeft-display.wheelStartX,movedY=scroll.scrollTop-display.wheelStartY,sample=movedY&&display.wheelDY&&movedY/display.wheelDY||movedX&&display.wheelDX&&movedX/display.wheelDX;display.wheelStartX=display.wheelStartY=null,sample&&(wheelPixelsPerUnit=(wheelPixelsPerUnit*wheelSamples+sample)/(wheelSamples+1),++wheelSamples)}},200)):(display.wheelDX+=dx,display.wheelDY+=dy))}}function doHandleBinding(cm,bound,dropShift){if("string"==typeof bound&&(bound=commands[bound],!bound))return!1;cm.display.pollingFast&&readInput(cm)&&(cm.display.pollingFast=!1);var doc=cm.doc,prevShift=doc.sel.shift,done=!1;try{isReadOnly(cm)&&(cm.state.suppressEdits=!0),dropShift&&(doc.sel.shift=!1),done=bound(cm)!=Pass}finally{doc.sel.shift=prevShift,cm.state.suppressEdits=!1}return done}function allKeyMaps(cm){var maps=cm.state.keyMaps.slice(0);return cm.options.extraKeys&&maps.push(cm.options.extraKeys),maps.push(cm.options.keyMap),maps}function handleKeyBinding(cm,e){var startMap=getKeyMap(cm.options.keyMap),next=startMap.auto;clearTimeout(maybeTransition),next&&!isModifierKey(e)&&(maybeTransition=setTimeout(function(){getKeyMap(cm.options.keyMap)==startMap&&(cm.options.keyMap=next.call?next.call(null,cm):next,keyMapChanged(cm))},50));var name=keyName(e,!0),handled=!1;if(!name)return!1;var keymaps=allKeyMaps(cm);return handled=e.shiftKey?lookupKey("Shift-"+name,keymaps,function(b){return doHandleBinding(cm,b,!0)})||lookupKey(name,keymaps,function(b){return("string"==typeof b?/^go[A-Z]/.test(b):b.motion)?doHandleBinding(cm,b):void 0}):lookupKey(name,keymaps,function(b){return doHandleBinding(cm,b)}),handled&&(e_preventDefault(e),restartBlink(cm),ie_lt9&&(e.oldKeyCode=e.keyCode,e.keyCode=0),signalLater(cm,"keyHandled",cm,name,e)),handled}function handleCharBinding(cm,e,ch){var handled=lookupKey("'"+ch+"'",allKeyMaps(cm),function(b){return doHandleBinding(cm,b,!0)});return handled&&(e_preventDefault(e),restartBlink(cm),signalLater(cm,"keyHandled",cm,"'"+ch+"'",e)),handled}function onKeyDown(e){var cm=this;if(cm.state.focused||onFocus(cm),!(signalDOMEvent(cm,e)||cm.options.onKeyEvent&&cm.options.onKeyEvent(cm,addStop(e)))){ie&&27==e.keyCode&&(e.returnValue=!1);var code=e.keyCode;cm.doc.sel.shift=16==code||e.shiftKey;var handled=handleKeyBinding(cm,e);opera&&(lastStoppedKey=handled?code:null,!handled&&88==code&&!hasCopyEvent&&(mac?e.metaKey:e.ctrlKey)&&cm.replaceSelection(""))}}function onKeyPress(e){var cm=this;if(!(signalDOMEvent(cm,e)||cm.options.onKeyEvent&&cm.options.onKeyEvent(cm,addStop(e)))){var keyCode=e.keyCode,charCode=e.charCode;if(opera&&keyCode==lastStoppedKey)return lastStoppedKey=null,void e_preventDefault(e);if(!(opera&&(!e.which||e.which<10)||khtml)||!handleKeyBinding(cm,e)){var ch=String.fromCharCode(null==charCode?keyCode:charCode);this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!isReadOnly(this)&&this.doc.mode.electricChars.indexOf(ch)>-1&&setTimeout(operation(cm,function(){indentLine(cm,cm.doc.sel.to.line,"smart")}),75),handleCharBinding(cm,e,ch)||(ie&&!ie_lt9&&(cm.display.inputHasSelection=null),fastPoll(cm))}}}function onFocus(cm){"nocursor"!=cm.options.readOnly&&(cm.state.focused||(signal(cm,"focus",cm),cm.state.focused=!0,-1==cm.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(cm.display.wrapper.className+=" CodeMirror-focused"),cm.curOp||(resetInput(cm,!0),webkit&&setTimeout(bind(resetInput,cm,!0),0))),slowPoll(cm),restartBlink(cm))}function onBlur(cm){cm.state.focused&&(signal(cm,"blur",cm),cm.state.focused=!1,cm.display.wrapper.className=cm.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(cm.display.blinker),setTimeout(function(){cm.state.focused||(cm.doc.sel.shift=!1)},150)}function onContextMenu(cm,e){function prepareSelectAllHack(){if(null!=display.input.selectionStart){var extval=display.input.value=""+(posEq(sel.from,sel.to)?"":display.input.value);display.prevInput="",display.input.selectionStart=1,display.input.selectionEnd=extval.length}}function rehide(){if(display.inputDiv.style.position="relative",display.input.style.cssText=oldCSS,ie_lt9&&(display.scrollbarV.scrollTop=display.scroller.scrollTop=scrollPos),slowPoll(cm),null!=display.input.selectionStart){(!ie||ie_lt9)&&prepareSelectAllHack(),clearTimeout(detectingSelectAll);var i=0,poll=function(){" "==display.prevInput&&0==display.input.selectionStart?operation(cm,commands.selectAll)(cm):i++<10?detectingSelectAll=setTimeout(poll,500):resetInput(cm)};detectingSelectAll=setTimeout(poll,200)}}if(!signalDOMEvent(cm,e,"contextmenu")){var display=cm.display,sel=cm.doc.sel;if(!eventInWidget(display,e)&&!contextMenuInGutter(cm,e)){var pos=posFromMouse(cm,e),scrollPos=display.scroller.scrollTop;if(pos&&!opera){var reset=cm.options.resetSelectionOnContextMenu;reset&&(posEq(sel.from,sel.to)||posLess(pos,sel.from)||!posLess(pos,sel.to))&&operation(cm,setSelection)(cm.doc,pos,pos);var oldCSS=display.input.style.cssText;if(display.inputDiv.style.position="absolute",display.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",focusInput(cm),resetInput(cm,!0),posEq(sel.from,sel.to)&&(display.input.value=display.prevInput=" "),ie&&!ie_lt9&&prepareSelectAllHack(),captureMiddleClick){e_stop(e);var mouseup=function(){off(window,"mouseup",mouseup),setTimeout(rehide,20)};on(window,"mouseup",mouseup)}else setTimeout(rehide,50)}}}}function clipPostChange(doc,change,pos){if(!posLess(change.from,pos))return clipPos(doc,pos);var diff=change.text.length-1-(change.to.line-change.from.line);if(pos.line>change.to.line+diff){var preLine=pos.line-diff,lastLine=doc.first+doc.size-1;return preLine>lastLine?Pos(lastLine,getLine(doc,lastLine).text.length):clipToLen(pos,getLine(doc,preLine).text.length)}if(pos.line==change.to.line+diff)return clipToLen(pos,lst(change.text).length+(1==change.text.length?change.from.ch:0)+getLine(doc,change.to.line).text.length-change.to.ch);var inside=pos.line-change.from.line;return clipToLen(pos,change.text[inside].length+(inside?0:change.from.ch))}function computeSelAfterChange(doc,change,hint){if(hint&&"object"==typeof hint)return{anchor:clipPostChange(doc,change,hint.anchor),head:clipPostChange(doc,change,hint.head)};if("start"==hint)return{anchor:change.from,head:change.from};var end=changeEnd(change);if("around"==hint)return{anchor:change.from,head:end};if("end"==hint)return{anchor:end,head:end};var adjustPos=function(pos){if(posLess(pos,change.from))return pos;if(!posLess(change.to,pos))return end;var line=pos.line+change.text.length-(change.to.line-change.from.line)-1,ch=pos.ch;return pos.line==change.to.line&&(ch+=end.ch-change.to.ch),Pos(line,ch)};return{anchor:adjustPos(doc.sel.anchor),head:adjustPos(doc.sel.head)}}function filterChange(doc,change,update){var obj={canceled:!1,from:change.from,to:change.to,text:change.text,origin:change.origin,cancel:function(){this.canceled=!0}};return update&&(obj.update=function(from,to,text,origin){from&&(this.from=clipPos(doc,from)),to&&(this.to=clipPos(doc,to)),text&&(this.text=text),void 0!==origin&&(this.origin=origin)}),signal(doc,"beforeChange",doc,obj),doc.cm&&signal(doc.cm,"beforeChange",doc.cm,obj),obj.canceled?null:{from:obj.from,to:obj.to,text:obj.text,origin:obj.origin}}function makeChange(doc,change,selUpdate,ignoreReadOnly){if(doc.cm){if(!doc.cm.curOp)return operation(doc.cm,makeChange)(doc,change,selUpdate,ignoreReadOnly);if(doc.cm.state.suppressEdits)return}if(!(hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange"))||(change=filterChange(doc,change,!0))){var split=sawReadOnlySpans&&!ignoreReadOnly&&removeReadOnlyRanges(doc,change.from,change.to);if(split){for(var i=split.length-1;i>=1;--i)makeChangeNoReadonly(doc,{from:split[i].from,to:split[i].to,text:[""]});split.length&&makeChangeNoReadonly(doc,{from:split[0].from,to:split[0].to,text:change.text},selUpdate)}else makeChangeNoReadonly(doc,change,selUpdate)}}function makeChangeNoReadonly(doc,change,selUpdate){if(1!=change.text.length||""!=change.text[0]||!posEq(change.from,change.to)){var selAfter=computeSelAfterChange(doc,change,selUpdate);addToHistory(doc,change,selAfter,doc.cm?doc.cm.curOp.id:NaN),makeChangeSingleDoc(doc,change,selAfter,stretchSpansOverChange(doc,change));var rebased=[];linkedDocs(doc,function(doc,sharedHist){sharedHist||-1!=indexOf(rebased,doc.history)||(rebaseHist(doc.history,change),rebased.push(doc.history)),makeChangeSingleDoc(doc,change,null,stretchSpansOverChange(doc,change))})}}function makeChangeFromHistory(doc,type){if(!doc.cm||!doc.cm.state.suppressEdits){var hist=doc.history,event=("undo"==type?hist.done:hist.undone).pop();if(event){var anti={changes:[],anchorBefore:event.anchorAfter,headBefore:event.headAfter,anchorAfter:event.anchorBefore,headAfter:event.headBefore,generation:hist.generation};("undo"==type?hist.undone:hist.done).push(anti),hist.generation=event.generation||++hist.maxGeneration;for(var filter=hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange"),i=event.changes.length-1;i>=0;--i){var change=event.changes[i];if(change.origin=type,filter&&!filterChange(doc,change,!1))return void(("undo"==type?hist.done:hist.undone).length=0);anti.changes.push(historyChangeFromChange(doc,change));var after=i?computeSelAfterChange(doc,change,null):{anchor:event.anchorBefore,head:event.headBefore};makeChangeSingleDoc(doc,change,after,mergeOldSpans(doc,change));var rebased=[];linkedDocs(doc,function(doc,sharedHist){sharedHist||-1!=indexOf(rebased,doc.history)||(rebaseHist(doc.history,change),rebased.push(doc.history)),makeChangeSingleDoc(doc,change,null,mergeOldSpans(doc,change))})}}}}function shiftDoc(doc,distance){function shiftPos(pos){return Pos(pos.line+distance,pos.ch)}doc.first+=distance,doc.cm&&regChange(doc.cm,doc.first,doc.first,distance),doc.sel.head=shiftPos(doc.sel.head),doc.sel.anchor=shiftPos(doc.sel.anchor),doc.sel.from=shiftPos(doc.sel.from),doc.sel.to=shiftPos(doc.sel.to)}function makeChangeSingleDoc(doc,change,selAfter,spans){if(doc.cm&&!doc.cm.curOp)return operation(doc.cm,makeChangeSingleDoc)(doc,change,selAfter,spans);if(change.to.line<doc.first)return void shiftDoc(doc,change.text.length-1-(change.to.line-change.from.line));if(!(change.from.line>doc.lastLine())){if(change.from.line<doc.first){var shift=change.text.length-1-(doc.first-change.from.line);shiftDoc(doc,shift),change={from:Pos(doc.first,0),to:Pos(change.to.line+shift,change.to.ch),text:[lst(change.text)],origin:change.origin}}var last=doc.lastLine();change.to.line>last&&(change={from:change.from,to:Pos(last,getLine(doc,last).text.length),text:[change.text[0]],origin:change.origin}),change.removed=getBetween(doc,change.from,change.to),selAfter||(selAfter=computeSelAfterChange(doc,change,null)),doc.cm?makeChangeSingleDocInEditor(doc.cm,change,spans,selAfter):updateDoc(doc,change,spans,selAfter)}}function makeChangeSingleDocInEditor(cm,change,spans,selAfter){var doc=cm.doc,display=cm.display,from=change.from,to=change.to,recomputeMaxLength=!1,checkWidthStart=from.line;cm.options.lineWrapping||(checkWidthStart=lineNo(visualLine(doc,getLine(doc,from.line))),doc.iter(checkWidthStart,to.line+1,function(line){return line==display.maxLine?(recomputeMaxLength=!0,!0):void 0})),posLess(doc.sel.head,change.from)||posLess(change.to,doc.sel.head)||(cm.curOp.cursorActivity=!0),updateDoc(doc,change,spans,selAfter,estimateHeight(cm)),cm.options.lineWrapping||(doc.iter(checkWidthStart,from.line+change.text.length,function(line){var len=lineLength(doc,line);len>display.maxLineLength&&(display.maxLine=line,display.maxLineLength=len,display.maxLineChanged=!0,recomputeMaxLength=!1)}),recomputeMaxLength&&(cm.curOp.updateMaxLine=!0)),doc.frontier=Math.min(doc.frontier,from.line),startWorker(cm,400);var lendiff=change.text.length-(to.line-from.line)-1;if(regChange(cm,from.line,to.line+1,lendiff),hasHandler(cm,"change")){var changeObj={from:from,to:to,text:change.text,removed:change.removed,origin:change.origin};if(cm.curOp.textChanged){for(var cur=cm.curOp.textChanged;cur.next;cur=cur.next);cur.next=changeObj}else cm.curOp.textChanged=changeObj}}function replaceRange(doc,code,from,to,origin){if(to||(to=from),posLess(to,from)){var tmp=to;to=from,from=tmp}"string"==typeof code&&(code=splitLines(code)),makeChange(doc,{from:from,to:to,text:code,origin:origin},null)}function Pos(line,ch){return this instanceof Pos?(this.line=line,void(this.ch=ch)):new Pos(line,ch)}function posEq(a,b){return a.line==b.line&&a.ch==b.ch}function posLess(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch}function copyPos(x){return Pos(x.line,x.ch)}function clipLine(doc,n){return Math.max(doc.first,Math.min(n,doc.first+doc.size-1))}function clipPos(doc,pos){if(pos.line<doc.first)return Pos(doc.first,0);var last=doc.first+doc.size-1;return pos.line>last?Pos(last,getLine(doc,last).text.length):clipToLen(pos,getLine(doc,pos.line).text.length)}function clipToLen(pos,linelen){var ch=pos.ch;return null==ch||ch>linelen?Pos(pos.line,linelen):0>ch?Pos(pos.line,0):pos}function isLine(doc,l){return l>=doc.first&&l<doc.first+doc.size}function extendSelection(doc,pos,other,bias){if(doc.sel.shift||doc.sel.extend){var anchor=doc.sel.anchor;if(other){var posBefore=posLess(pos,anchor);posBefore!=posLess(other,anchor)?(anchor=pos,pos=other):posBefore!=posLess(pos,other)&&(pos=other)}setSelection(doc,anchor,pos,bias)}else setSelection(doc,pos,other||pos,bias);doc.cm&&(doc.cm.curOp.userSelChange=!0)}function filterSelectionChange(doc,anchor,head){var obj={anchor:anchor,head:head};return signal(doc,"beforeSelectionChange",doc,obj),doc.cm&&signal(doc.cm,"beforeSelectionChange",doc.cm,obj),obj.anchor=clipPos(doc,obj.anchor),obj.head=clipPos(doc,obj.head),obj}function setSelection(doc,anchor,head,bias,checkAtomic){if(!checkAtomic&&hasHandler(doc,"beforeSelectionChange")||doc.cm&&hasHandler(doc.cm,"beforeSelectionChange")){var filtered=filterSelectionChange(doc,anchor,head);head=filtered.head,anchor=filtered.anchor}var sel=doc.sel;if(sel.goalColumn=null,null==bias&&(bias=posLess(head,sel.head)?-1:1),(checkAtomic||!posEq(anchor,sel.anchor))&&(anchor=skipAtomic(doc,anchor,bias,"push"!=checkAtomic)),(checkAtomic||!posEq(head,sel.head))&&(head=skipAtomic(doc,head,bias,"push"!=checkAtomic)),!posEq(sel.anchor,anchor)||!posEq(sel.head,head)){sel.anchor=anchor,sel.head=head;var inv=posLess(head,anchor);sel.from=inv?head:anchor,sel.to=inv?anchor:head,doc.cm&&(doc.cm.curOp.updateInput=doc.cm.curOp.selectionChanged=doc.cm.curOp.cursorActivity=!0),signalLater(doc,"cursorActivity",doc);
}}function reCheckSelection(cm){setSelection(cm.doc,cm.doc.sel.from,cm.doc.sel.to,null,"push")}function skipAtomic(doc,pos,bias,mayClear){var flipped=!1,curPos=pos,dir=bias||1;doc.cantEdit=!1;search:for(;;){var line=getLine(doc,curPos.line);if(line.markedSpans)for(var i=0;i<line.markedSpans.length;++i){var sp=line.markedSpans[i],m=sp.marker;if((null==sp.from||(m.inclusiveLeft?sp.from<=curPos.ch:sp.from<curPos.ch))&&(null==sp.to||(m.inclusiveRight?sp.to>=curPos.ch:sp.to>curPos.ch))){if(mayClear&&(signal(m,"beforeCursorEnter"),m.explicitlyCleared)){if(line.markedSpans){--i;continue}break}if(!m.atomic)continue;var newPos=m.find()[0>dir?"from":"to"];if(posEq(newPos,curPos)&&(newPos.ch+=dir,newPos.ch<0?newPos=newPos.line>doc.first?clipPos(doc,Pos(newPos.line-1)):null:newPos.ch>line.text.length&&(newPos=newPos.line<doc.first+doc.size-1?Pos(newPos.line+1,0):null),!newPos)){if(flipped)return mayClear?(doc.cantEdit=!0,Pos(doc.first,0)):skipAtomic(doc,pos,bias,!0);flipped=!0,newPos=pos,dir=-dir}curPos=newPos;continue search}}return curPos}}function scrollCursorIntoView(cm){var coords=scrollPosIntoView(cm,cm.doc.sel.head,null,cm.options.cursorScrollMargin);if(cm.state.focused){var display=cm.display,box=getRect(display.sizer),doScroll=null;if(coords.top+box.top<0?doScroll=!0:coords.bottom+box.top>(window.innerHeight||document.documentElement.clientHeight)&&(doScroll=!1),null!=doScroll&&!phantom){var hidden="none"==display.cursor.style.display;hidden&&(display.cursor.style.display="",display.cursor.style.left=coords.left+"px",display.cursor.style.top=coords.top-display.viewOffset+"px"),display.cursor.scrollIntoView(doScroll),hidden&&(display.cursor.style.display="none")}}}function scrollPosIntoView(cm,pos,end,margin){for(null==margin&&(margin=0);;){var changed=!1,coords=cursorCoords(cm,pos),endCoords=end&&end!=pos?cursorCoords(cm,end):coords,scrollPos=calculateScrollPos(cm,Math.min(coords.left,endCoords.left),Math.min(coords.top,endCoords.top)-margin,Math.max(coords.left,endCoords.left),Math.max(coords.bottom,endCoords.bottom)+margin),startTop=cm.doc.scrollTop,startLeft=cm.doc.scrollLeft;if(null!=scrollPos.scrollTop&&(setScrollTop(cm,scrollPos.scrollTop),Math.abs(cm.doc.scrollTop-startTop)>1&&(changed=!0)),null!=scrollPos.scrollLeft&&(setScrollLeft(cm,scrollPos.scrollLeft),Math.abs(cm.doc.scrollLeft-startLeft)>1&&(changed=!0)),!changed)return coords}}function scrollIntoView(cm,x1,y1,x2,y2){var scrollPos=calculateScrollPos(cm,x1,y1,x2,y2);null!=scrollPos.scrollTop&&setScrollTop(cm,scrollPos.scrollTop),null!=scrollPos.scrollLeft&&setScrollLeft(cm,scrollPos.scrollLeft)}function calculateScrollPos(cm,x1,y1,x2,y2){var display=cm.display,snapMargin=textHeight(cm.display);0>y1&&(y1=0);var screen=display.scroller.clientHeight-scrollerCutOff,screentop=display.scroller.scrollTop,result={},docBottom=cm.doc.height+paddingVert(display),atTop=snapMargin>y1,atBottom=y2>docBottom-snapMargin;if(screentop>y1)result.scrollTop=atTop?0:y1;else if(y2>screentop+screen){var newTop=Math.min(y1,(atBottom?docBottom:y2)-screen);newTop!=screentop&&(result.scrollTop=newTop)}var screenw=display.scroller.clientWidth-scrollerCutOff,screenleft=display.scroller.scrollLeft;x1+=display.gutters.offsetWidth,x2+=display.gutters.offsetWidth;var gutterw=display.gutters.offsetWidth,atLeft=gutterw+10>x1;return screenleft+gutterw>x1||atLeft?(atLeft&&(x1=0),result.scrollLeft=Math.max(0,x1-10-gutterw)):x2>screenw+screenleft-3&&(result.scrollLeft=x2+10-screenw),result}function updateScrollPos(cm,left,top){cm.curOp.updateScrollPos={scrollLeft:null==left?cm.doc.scrollLeft:left,scrollTop:null==top?cm.doc.scrollTop:top}}function addToScrollPos(cm,left,top){var pos=cm.curOp.updateScrollPos||(cm.curOp.updateScrollPos={scrollLeft:cm.doc.scrollLeft,scrollTop:cm.doc.scrollTop}),scroll=cm.display.scroller;pos.scrollTop=Math.max(0,Math.min(scroll.scrollHeight-scroll.clientHeight,pos.scrollTop+top)),pos.scrollLeft=Math.max(0,Math.min(scroll.scrollWidth-scroll.clientWidth,pos.scrollLeft+left))}function indentLine(cm,n,how,aggressive){var doc=cm.doc;if(null==how&&(how="add"),"smart"==how)if(cm.doc.mode.indent)var state=getStateBefore(cm,n);else how="prev";var indentation,tabSize=cm.options.tabSize,line=getLine(doc,n),curSpace=countColumn(line.text,null,tabSize),curSpaceString=line.text.match(/^\s*/)[0];if("smart"==how&&(indentation=cm.doc.mode.indent(state,line.text.slice(curSpaceString.length),line.text),indentation==Pass)){if(!aggressive)return;how="prev"}"prev"==how?indentation=n>doc.first?countColumn(getLine(doc,n-1).text,null,tabSize):0:"add"==how?indentation=curSpace+cm.options.indentUnit:"subtract"==how?indentation=curSpace-cm.options.indentUnit:"number"==typeof how&&(indentation=curSpace+how),indentation=Math.max(0,indentation);var indentString="",pos=0;if(cm.options.indentWithTabs)for(var i=Math.floor(indentation/tabSize);i;--i)pos+=tabSize,indentString+="	";indentation>pos&&(indentString+=spaceStr(indentation-pos)),indentString!=curSpaceString&&replaceRange(cm.doc,indentString,Pos(n,0),Pos(n,curSpaceString.length),"+input"),line.stateAfter=null}function changeLine(cm,handle,op){var no=handle,line=handle,doc=cm.doc;return"number"==typeof handle?line=getLine(doc,clipLine(doc,handle)):no=lineNo(handle),null==no?null:op(line,no)?(regChange(cm,no,no+1),line):null}function findPosH(doc,pos,dir,unit,visually){function findNextLine(){var l=line+dir;return l<doc.first||l>=doc.first+doc.size?possible=!1:(line=l,lineObj=getLine(doc,l))}function moveOnce(boundToLine){var next=(visually?moveVisually:moveLogically)(lineObj,ch,dir,!0);if(null==next){if(boundToLine||!findNextLine())return possible=!1;ch=visually?(0>dir?lineRight:lineLeft)(lineObj):0>dir?lineObj.text.length:0}else ch=next;return!0}var line=pos.line,ch=pos.ch,origDir=dir,lineObj=getLine(doc,line),possible=!0;if("char"==unit)moveOnce();else if("column"==unit)moveOnce(!0);else if("word"==unit||"group"==unit)for(var sawType=null,group="group"==unit,first=!0;!(0>dir)||moveOnce(!first);first=!1){var cur=lineObj.text.charAt(ch)||"\n",type=isWordChar(cur)?"w":group?/\s/.test(cur)?null:"p":null;if(sawType&&sawType!=type){0>dir&&(dir=1,moveOnce());break}if(type&&(sawType=type),dir>0&&!moveOnce(!first))break}var result=skipAtomic(doc,Pos(line,ch),origDir,!0);return possible||(result.hitSide=!0),result}function findPosV(cm,pos,dir,unit){var y,doc=cm.doc,x=pos.left;if("page"==unit){var pageSize=Math.min(cm.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);y=pos.top+dir*(pageSize-(0>dir?1.5:.5)*textHeight(cm.display))}else"line"==unit&&(y=dir>0?pos.bottom+3:pos.top-3);for(;;){var target=coordsChar(cm,x,y);if(!target.outside)break;if(0>dir?0>=y:y>=doc.height){target.hitSide=!0;break}y+=5*dir}return target}function findWordAt(line,pos){var start=pos.ch,end=pos.ch;if(line){(pos.xRel<0||end==line.length)&&start?--start:++end;for(var startChar=line.charAt(start),check=isWordChar(startChar)?isWordChar:/\s/.test(startChar)?function(ch){return/\s/.test(ch)}:function(ch){return!/\s/.test(ch)&&!isWordChar(ch)};start>0&&check(line.charAt(start-1));)--start;for(;end<line.length&&check(line.charAt(end));)++end}return{from:Pos(pos.line,start),to:Pos(pos.line,end)}}function selectLine(cm,line){extendSelection(cm.doc,Pos(line,0),clipPos(cm.doc,Pos(line+1,0)))}function option(name,deflt,handle,notOnInit){CodeMirror.defaults[name]=deflt,handle&&(optionHandlers[name]=notOnInit?function(cm,val,old){old!=Init&&handle(cm,val,old)}:handle)}function copyState(mode,state){if(state===!0)return state;if(mode.copyState)return mode.copyState(state);var nstate={};for(var n in state){var val=state[n];val instanceof Array&&(val=val.concat([])),nstate[n]=val}return nstate}function startState(mode,a1,a2){return mode.startState?mode.startState(a1,a2):!0}function getKeyMap(val){return"string"==typeof val?keyMap[val]:val}function lookupKey(name,maps,handle){function lookup(map){map=getKeyMap(map);var found=map[name];if(found===!1)return"stop";if(null!=found&&handle(found))return!0;if(map.nofallthrough)return"stop";var fallthrough=map.fallthrough;if(null==fallthrough)return!1;if("[object Array]"!=Object.prototype.toString.call(fallthrough))return lookup(fallthrough);for(var i=0,e=fallthrough.length;e>i;++i){var done=lookup(fallthrough[i]);if(done)return done}return!1}for(var i=0;i<maps.length;++i){var done=lookup(maps[i]);if(done)return"stop"!=done}}function isModifierKey(event){var name=keyNames[event.keyCode];return"Ctrl"==name||"Alt"==name||"Shift"==name||"Mod"==name}function keyName(event,noShift){if(opera&&34==event.keyCode&&event["char"])return!1;var name=keyNames[event.keyCode];return null==name||event.altGraphKey?!1:(event.altKey&&(name="Alt-"+name),(flipCtrlCmd?event.metaKey:event.ctrlKey)&&(name="Ctrl-"+name),(flipCtrlCmd?event.ctrlKey:event.metaKey)&&(name="Cmd-"+name),!noShift&&event.shiftKey&&(name="Shift-"+name),name)}function StringStream(string,tabSize){this.pos=this.start=0,this.string=string,this.tabSize=tabSize||8,this.lastColumnPos=this.lastColumnValue=0}function TextMarker(doc,type){this.lines=[],this.type=type,this.doc=doc}function markText(doc,from,to,options,type){if(options&&options.shared)return markTextShared(doc,from,to,options,type);if(doc.cm&&!doc.cm.curOp)return operation(doc.cm,markText)(doc,from,to,options,type);var marker=new TextMarker(doc,type);if("range"==type&&!posLess(from,to))return marker;options&&copyObj(options,marker),marker.replacedWith&&(marker.collapsed=!0,marker.replacedWith=elt("span",[marker.replacedWith],"CodeMirror-widget"),options.handleMouseEvents||(marker.replacedWith.ignoreEvents=!0)),marker.collapsed&&(sawCollapsedSpans=!0),marker.addToHistory&&addToHistory(doc,{from:from,to:to,origin:"markText"},{head:doc.sel.head,anchor:doc.sel.anchor},NaN);var collapsedAtStart,collapsedAtEnd,updateMaxLine,curLine=from.line,size=0,cm=doc.cm;if(doc.iter(curLine,to.line+1,function(line){cm&&marker.collapsed&&!cm.options.lineWrapping&&visualLine(doc,line)==cm.display.maxLine&&(updateMaxLine=!0);var span={from:null,to:null,marker:marker};size+=line.text.length,curLine==from.line&&(span.from=from.ch,size-=from.ch),curLine==to.line&&(span.to=to.ch,size-=line.text.length-to.ch),marker.collapsed&&(curLine==to.line&&(collapsedAtEnd=collapsedSpanAt(line,to.ch)),curLine==from.line?collapsedAtStart=collapsedSpanAt(line,from.ch):updateLineHeight(line,0)),addMarkedSpan(line,span),++curLine}),marker.collapsed&&doc.iter(from.line,to.line+1,function(line){lineIsHidden(doc,line)&&updateLineHeight(line,0)}),marker.clearOnEnter&&on(marker,"beforeCursorEnter",function(){marker.clear()}),marker.readOnly&&(sawReadOnlySpans=!0,(doc.history.done.length||doc.history.undone.length)&&doc.clearHistory()),marker.collapsed){if(collapsedAtStart!=collapsedAtEnd)throw new Error("Inserting collapsed marker overlapping an existing one");marker.size=size,marker.atomic=!0}return cm&&(updateMaxLine&&(cm.curOp.updateMaxLine=!0),(marker.className||marker.title||marker.startStyle||marker.endStyle||marker.collapsed)&&regChange(cm,from.line,to.line+1),marker.atomic&&reCheckSelection(cm)),marker}function SharedTextMarker(markers,primary){this.markers=markers,this.primary=primary;for(var i=0,me=this;i<markers.length;++i)markers[i].parent=this,on(markers[i],"clear",function(){me.clear()})}function markTextShared(doc,from,to,options,type){options=copyObj(options),options.shared=!1;var markers=[markText(doc,from,to,options,type)],primary=markers[0],widget=options.replacedWith;return linkedDocs(doc,function(doc){widget&&(options.replacedWith=widget.cloneNode(!0)),markers.push(markText(doc,clipPos(doc,from),clipPos(doc,to),options,type));for(var i=0;i<doc.linked.length;++i)if(doc.linked[i].isParent)return;primary=lst(markers)}),new SharedTextMarker(markers,primary)}function getMarkedSpanFor(spans,marker){if(spans)for(var i=0;i<spans.length;++i){var span=spans[i];if(span.marker==marker)return span}}function removeMarkedSpan(spans,span){for(var r,i=0;i<spans.length;++i)spans[i]!=span&&(r||(r=[])).push(spans[i]);return r}function addMarkedSpan(line,span){line.markedSpans=line.markedSpans?line.markedSpans.concat([span]):[span],span.marker.attachLine(line)}function markedSpansBefore(old,startCh,isInsert){if(old)for(var nw,i=0;i<old.length;++i){var span=old[i],marker=span.marker,startsBefore=null==span.from||(marker.inclusiveLeft?span.from<=startCh:span.from<startCh);if(startsBefore||"bookmark"==marker.type&&span.from==startCh&&(!isInsert||!span.marker.insertLeft)){var endsAfter=null==span.to||(marker.inclusiveRight?span.to>=startCh:span.to>startCh);(nw||(nw=[])).push({from:span.from,to:endsAfter?null:span.to,marker:marker})}}return nw}function markedSpansAfter(old,endCh,isInsert){if(old)for(var nw,i=0;i<old.length;++i){var span=old[i],marker=span.marker,endsAfter=null==span.to||(marker.inclusiveRight?span.to>=endCh:span.to>endCh);if(endsAfter||"bookmark"==marker.type&&span.from==endCh&&(!isInsert||span.marker.insertLeft)){var startsBefore=null==span.from||(marker.inclusiveLeft?span.from<=endCh:span.from<endCh);(nw||(nw=[])).push({from:startsBefore?null:span.from-endCh,to:null==span.to?null:span.to-endCh,marker:marker})}}return nw}function stretchSpansOverChange(doc,change){var oldFirst=isLine(doc,change.from.line)&&getLine(doc,change.from.line).markedSpans,oldLast=isLine(doc,change.to.line)&&getLine(doc,change.to.line).markedSpans;if(!oldFirst&&!oldLast)return null;var startCh=change.from.ch,endCh=change.to.ch,isInsert=posEq(change.from,change.to),first=markedSpansBefore(oldFirst,startCh,isInsert),last=markedSpansAfter(oldLast,endCh,isInsert),sameLine=1==change.text.length,offset=lst(change.text).length+(sameLine?startCh:0);if(first)for(var i=0;i<first.length;++i){var span=first[i];if(null==span.to){var found=getMarkedSpanFor(last,span.marker);found?sameLine&&(span.to=null==found.to?null:found.to+offset):span.to=startCh}}if(last)for(var i=0;i<last.length;++i){var span=last[i];if(null!=span.to&&(span.to+=offset),null==span.from){var found=getMarkedSpanFor(first,span.marker);found||(span.from=offset,sameLine&&(first||(first=[])).push(span))}else span.from+=offset,sameLine&&(first||(first=[])).push(span)}if(sameLine&&first){for(var i=0;i<first.length;++i)null!=first[i].from&&first[i].from==first[i].to&&"bookmark"!=first[i].marker.type&&first.splice(i--,1);first.length||(first=null)}var newMarkers=[first];if(!sameLine){var gapMarkers,gap=change.text.length-2;if(gap>0&&first)for(var i=0;i<first.length;++i)null==first[i].to&&(gapMarkers||(gapMarkers=[])).push({from:null,to:null,marker:first[i].marker});for(var i=0;gap>i;++i)newMarkers.push(gapMarkers);newMarkers.push(last)}return newMarkers}function mergeOldSpans(doc,change){var old=getOldSpans(doc,change),stretched=stretchSpansOverChange(doc,change);if(!old)return stretched;if(!stretched)return old;for(var i=0;i<old.length;++i){var oldCur=old[i],stretchCur=stretched[i];if(oldCur&&stretchCur)spans:for(var j=0;j<stretchCur.length;++j){for(var span=stretchCur[j],k=0;k<oldCur.length;++k)if(oldCur[k].marker==span.marker)continue spans;oldCur.push(span)}else stretchCur&&(old[i]=stretchCur)}return old}function removeReadOnlyRanges(doc,from,to){var markers=null;if(doc.iter(from.line,to.line+1,function(line){if(line.markedSpans)for(var i=0;i<line.markedSpans.length;++i){var mark=line.markedSpans[i].marker;!mark.readOnly||markers&&-1!=indexOf(markers,mark)||(markers||(markers=[])).push(mark)}}),!markers)return null;for(var parts=[{from:from,to:to}],i=0;i<markers.length;++i)for(var mk=markers[i],m=mk.find(),j=0;j<parts.length;++j){var p=parts[j];if(!posLess(p.to,m.from)&&!posLess(m.to,p.from)){var newParts=[j,1];(posLess(p.from,m.from)||!mk.inclusiveLeft&&posEq(p.from,m.from))&&newParts.push({from:p.from,to:m.from}),(posLess(m.to,p.to)||!mk.inclusiveRight&&posEq(p.to,m.to))&&newParts.push({from:m.to,to:p.to}),parts.splice.apply(parts,newParts),j+=newParts.length-1}}return parts}function collapsedSpanAt(line,ch){var found,sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var sp,i=0;i<sps.length;++i)sp=sps[i],sp.marker.collapsed&&(null==sp.from||sp.from<ch)&&(null==sp.to||sp.to>ch)&&(!found||found.width<sp.marker.width)&&(found=sp.marker);return found}function collapsedSpanAtStart(line){return collapsedSpanAt(line,-1)}function collapsedSpanAtEnd(line){return collapsedSpanAt(line,line.text.length+1)}function visualLine(doc,line){for(var merged;merged=collapsedSpanAtStart(line);)line=getLine(doc,merged.find().from.line);return line}function lineIsHidden(doc,line){var sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var sp,i=0;i<sps.length;++i)if(sp=sps[i],sp.marker.collapsed){if(null==sp.from)return!0;if(!sp.marker.replacedWith&&0==sp.from&&sp.marker.inclusiveLeft&&lineIsHiddenInner(doc,line,sp))return!0}}function lineIsHiddenInner(doc,line,span){if(null==span.to){var end=span.marker.find().to,endLine=getLine(doc,end.line);return lineIsHiddenInner(doc,endLine,getMarkedSpanFor(endLine.markedSpans,span.marker))}if(span.marker.inclusiveRight&&span.to==line.text.length)return!0;for(var sp,i=0;i<line.markedSpans.length;++i)if(sp=line.markedSpans[i],sp.marker.collapsed&&!sp.marker.replacedWith&&sp.from==span.to&&(sp.marker.inclusiveLeft||span.marker.inclusiveRight)&&lineIsHiddenInner(doc,line,sp))return!0}function detachMarkedSpans(line){var spans=line.markedSpans;if(spans){for(var i=0;i<spans.length;++i)spans[i].marker.detachLine(line);line.markedSpans=null}}function attachMarkedSpans(line,spans){if(spans){for(var i=0;i<spans.length;++i)spans[i].marker.attachLine(line);line.markedSpans=spans}}function widgetOperation(f){return function(){var withOp=!this.cm.curOp;withOp&&startOperation(this.cm);try{var result=f.apply(this,arguments)}finally{withOp&&endOperation(this.cm)}return result}}function widgetHeight(widget){return null!=widget.height?widget.height:(widget.node.parentNode&&1==widget.node.parentNode.nodeType||removeChildrenAndAdd(widget.cm.display.measure,elt("div",[widget.node],null,"position: relative")),widget.height=widget.node.offsetHeight)}function addLineWidget(cm,handle,node,options){var widget=new LineWidget(cm,node,options);return widget.noHScroll&&(cm.display.alignWidgets=!0),changeLine(cm,handle,function(line){var widgets=line.widgets||(line.widgets=[]);if(null==widget.insertAt?widgets.push(widget):widgets.splice(Math.min(widgets.length-1,Math.max(0,widget.insertAt)),0,widget),widget.line=line,!lineIsHidden(cm.doc,line)||widget.showIfHidden){var aboveVisible=heightAtLine(cm,line)<cm.doc.scrollTop;updateLineHeight(line,line.height+widgetHeight(widget)),aboveVisible&&addToScrollPos(cm,0,widget.height)}return!0}),widget}function updateLine(line,text,markedSpans,estimateHeight){line.text=text,line.stateAfter&&(line.stateAfter=null),line.styles&&(line.styles=null),null!=line.order&&(line.order=null),detachMarkedSpans(line),attachMarkedSpans(line,markedSpans);var estHeight=estimateHeight?estimateHeight(line):1;estHeight!=line.height&&updateLineHeight(line,estHeight)}function cleanUpLine(line){line.parent=null,detachMarkedSpans(line)}function runMode(cm,text,mode,state,f){var flattenSpans=mode.flattenSpans;null==flattenSpans&&(flattenSpans=cm.options.flattenSpans);var style,curStart=0,curStyle=null,stream=new StringStream(text,cm.options.tabSize);for(""==text&&mode.blankLine&&mode.blankLine(state);!stream.eol();)stream.pos>cm.options.maxHighlightLength?(flattenSpans=!1,stream.pos=text.length,style=null):style=mode.token(stream,state),flattenSpans&&curStyle==style||(curStart<stream.start&&f(stream.start,curStyle),curStart=stream.start,curStyle=style),stream.start=stream.pos;for(;curStart<stream.pos;){var pos=Math.min(stream.pos,curStart+5e4);f(pos,curStyle),curStart=pos}}function highlightLine(cm,line,state){var st=[cm.state.modeGen];runMode(cm,line.text,cm.doc.mode,state,function(end,style){st.push(end,style)});for(var o=0;o<cm.state.overlays.length;++o){var overlay=cm.state.overlays[o],i=1,at=0;runMode(cm,line.text,overlay.mode,!0,function(end,style){for(var start=i;end>at;){var i_end=st[i];i_end>end&&st.splice(i,1,end,st[i+1],i_end),i+=2,at=Math.min(end,i_end)}if(style)if(overlay.opaque)st.splice(start,i-start,end,style),i=start+2;else for(;i>start;start+=2){var cur=st[start+1];st[start+1]=cur?cur+" "+style:style}})}return st}function getLineStyles(cm,line){return line.styles&&line.styles[0]==cm.state.modeGen||(line.styles=highlightLine(cm,line,line.stateAfter=getStateBefore(cm,lineNo(line)))),line.styles}function processLine(cm,line,state){var mode=cm.doc.mode,stream=new StringStream(line.text,cm.options.tabSize);for(""==line.text&&mode.blankLine&&mode.blankLine(state);!stream.eol()&&stream.pos<=cm.options.maxHighlightLength;)mode.token(stream,state),stream.start=stream.pos}function interpretTokenStyle(style,builder){if(!style)return null;for(;;){var lineClass=style.match(/(?:^|\s)line-(background-)?(\S+)/);if(!lineClass)break;style=style.slice(0,lineClass.index)+style.slice(lineClass.index+lineClass[0].length);var prop=lineClass[1]?"bgClass":"textClass";null==builder[prop]?builder[prop]=lineClass[2]:new RegExp("(?:^|s)"+lineClass[2]+"(?:$|s)").test(builder[prop])||(builder[prop]+=" "+lineClass[2])}return styleToClassCache[style]||(styleToClassCache[style]="cm-"+style.replace(/ +/g," cm-"))}function buildLineContent(cm,realLine,measure,copyWidgets){for(var merged,line=realLine,empty=!0;merged=collapsedSpanAtStart(line);)line=getLine(cm.doc,merged.find().from.line);var builder={pre:elt("pre"),col:0,pos:0,measure:null,measuredSomething:!1,cm:cm,copyWidgets:copyWidgets};do{line.text&&(empty=!1),builder.measure=line==realLine&&measure,builder.pos=0,builder.addToken=builder.measure?buildTokenMeasure:buildToken,(ie||webkit)&&cm.getOption("lineWrapping")&&(builder.addToken=buildTokenSplitSpaces(builder.addToken));var next=insertLineContent(line,builder,getLineStyles(cm,line));measure&&line==realLine&&!builder.measuredSomething&&(measure[0]=builder.pre.appendChild(zeroWidthElement(cm.display.measure)),builder.measuredSomething=!0),next&&(line=getLine(cm.doc,next.to.line))}while(next);!measure||builder.measuredSomething||measure[0]||(measure[0]=builder.pre.appendChild(empty?elt("span",""):zeroWidthElement(cm.display.measure))),builder.pre.firstChild||lineIsHidden(cm.doc,realLine)||builder.pre.appendChild(document.createTextNode(""));var order;if(measure&&ie&&(order=getOrder(line))){var l=order.length-1;order[l].from==order[l].to&&--l;var last=order[l],prev=order[l-1];if(last.from+1==last.to&&prev&&last.level<prev.level){var span=measure[builder.pos-1];span&&span.parentNode.insertBefore(span.measureRight=zeroWidthElement(cm.display.measure),span.nextSibling)}}var textClass=builder.textClass?builder.textClass+" "+(realLine.textClass||""):realLine.textClass;return textClass&&(builder.pre.className=textClass),signal(cm,"renderLine",cm,realLine,builder.pre),builder}function buildToken(builder,text,style,startStyle,endStyle,title){if(text){if(tokenSpecialChars.test(text))for(var content=document.createDocumentFragment(),pos=0;;){tokenSpecialChars.lastIndex=pos;var m=tokenSpecialChars.exec(text),skipped=m?m.index-pos:text.length-pos;if(skipped&&(content.appendChild(document.createTextNode(text.slice(pos,pos+skipped))),builder.col+=skipped),!m)break;if(pos+=skipped+1,"	"==m[0]){var tabSize=builder.cm.options.tabSize,tabWidth=tabSize-builder.col%tabSize;content.appendChild(elt("span",spaceStr(tabWidth),"cm-tab")),builder.col+=tabWidth}else{var token=elt("span","","cm-invalidchar");token.title="\\u"+m[0].charCodeAt(0).toString(16),content.appendChild(token),builder.col+=1}}else{builder.col+=text.length;var content=document.createTextNode(text)}if(style||startStyle||endStyle||builder.measure){var fullStyle=style||"";startStyle&&(fullStyle+=startStyle),endStyle&&(fullStyle+=endStyle);var token=elt("span",[content],fullStyle);return title&&(token.title=title),builder.pre.appendChild(token)}builder.pre.appendChild(content)}}function buildTokenMeasure(builder,text,style,startStyle,endStyle){for(var wrapping=builder.cm.options.lineWrapping,i=0;i<text.length;++i){var ch=text.charAt(i),start=0==i;ch>=""&&"">ch&&i<text.length-1?(ch=text.slice(i,i+2),++i):i&&wrapping&&spanAffectsWrapping(text,i)&&builder.pre.appendChild(elt("wbr"));var old=builder.measure[builder.pos],span=builder.measure[builder.pos]=buildToken(builder,ch,style,start&&startStyle,i==text.length-1&&endStyle);old&&(span.leftSide=old.leftSide||old),ie&&wrapping&&" "==ch&&i&&!/\s/.test(text.charAt(i-1))&&i<text.length-1&&!/\s/.test(text.charAt(i+1))&&(span.style.whiteSpace="normal"),builder.pos+=ch.length}text.length&&(builder.measuredSomething=!0)}function buildTokenSplitSpaces(inner){function split(old){for(var out=" ",i=0;i<old.length-2;++i)out+=i%2?" ":"";return out+=" "}return function(builder,text,style,startStyle,endStyle,title){return inner(builder,text.replace(/ {3,}/g,split),style,startStyle,endStyle,title)}}function buildCollapsedSpan(builder,size,marker,ignoreWidget){var widget=!ignoreWidget&&marker.replacedWith;if(widget&&(builder.copyWidgets&&(widget=widget.cloneNode(!0)),builder.pre.appendChild(widget),builder.measure)){if(size)builder.measure[builder.pos]=widget;else{var elt=zeroWidthElement(builder.cm.display.measure);if("bookmark"!=marker.type||marker.insertLeft){if(builder.measure[builder.pos])return;builder.measure[builder.pos]=builder.pre.insertBefore(elt,widget)}else builder.measure[builder.pos]=builder.pre.appendChild(elt)}builder.measuredSomething=!0}builder.pos+=size}function insertLineContent(line,builder,styles){var spans=line.markedSpans,allText=line.text,at=0;if(spans)for(var style,spanStyle,spanEndStyle,spanStartStyle,title,collapsed,len=allText.length,pos=0,i=1,text="",nextChange=0;;){if(nextChange==pos){spanStyle=spanEndStyle=spanStartStyle=title="",collapsed=null,nextChange=1/0;for(var foundBookmarks=[],j=0;j<spans.length;++j){var sp=spans[j],m=sp.marker;sp.from<=pos&&(null==sp.to||sp.to>pos)?(null!=sp.to&&nextChange>sp.to&&(nextChange=sp.to,spanEndStyle=""),m.className&&(spanStyle+=" "+m.className),m.startStyle&&sp.from==pos&&(spanStartStyle+=" "+m.startStyle),m.endStyle&&sp.to==nextChange&&(spanEndStyle+=" "+m.endStyle),m.title&&!title&&(title=m.title),m.collapsed&&(!collapsed||collapsed.marker.size<m.size)&&(collapsed=sp)):sp.from>pos&&nextChange>sp.from&&(nextChange=sp.from),"bookmark"==m.type&&sp.from==pos&&m.replacedWith&&foundBookmarks.push(m)}if(collapsed&&(collapsed.from||0)==pos&&(buildCollapsedSpan(builder,(null==collapsed.to?len:collapsed.to)-pos,collapsed.marker,null==collapsed.from),null==collapsed.to))return collapsed.marker.find();if(!collapsed&&foundBookmarks.length)for(var j=0;j<foundBookmarks.length;++j)buildCollapsedSpan(builder,0,foundBookmarks[j])}if(pos>=len)break;for(var upto=Math.min(len,nextChange);;){if(text){var end=pos+text.length;if(!collapsed){var tokenText=end>upto?text.slice(0,upto-pos):text;builder.addToken(builder,tokenText,style?style+spanStyle:spanStyle,spanStartStyle,pos+tokenText.length==nextChange?spanEndStyle:"",title)}if(end>=upto){text=text.slice(upto-pos),pos=upto;break}pos=end,spanStartStyle=""}text=allText.slice(at,at=styles[i++]),style=interpretTokenStyle(styles[i++],builder)}}else for(var i=1;i<styles.length;i+=2)builder.addToken(builder,allText.slice(at,at=styles[i]),interpretTokenStyle(styles[i+1],builder))}function updateDoc(doc,change,markedSpans,selAfter,estimateHeight){function spansFor(n){return markedSpans?markedSpans[n]:null}function update(line,text,spans){updateLine(line,text,spans,estimateHeight),signalLater(line,"change",line,change)}var from=change.from,to=change.to,text=change.text,firstLine=getLine(doc,from.line),lastLine=getLine(doc,to.line),lastText=lst(text),lastSpans=spansFor(text.length-1),nlines=to.line-from.line;if(0==from.ch&&0==to.ch&&""==lastText){for(var i=0,e=text.length-1,added=[];e>i;++i)added.push(new Line(text[i],spansFor(i),estimateHeight));update(lastLine,lastLine.text,lastSpans),nlines&&doc.remove(from.line,nlines),added.length&&doc.insert(from.line,added)}else if(firstLine==lastLine)if(1==text.length)update(firstLine,firstLine.text.slice(0,from.ch)+lastText+firstLine.text.slice(to.ch),lastSpans);else{for(var added=[],i=1,e=text.length-1;e>i;++i)added.push(new Line(text[i],spansFor(i),estimateHeight));added.push(new Line(lastText+firstLine.text.slice(to.ch),lastSpans,estimateHeight)),update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0)),doc.insert(from.line+1,added)}else if(1==text.length)update(firstLine,firstLine.text.slice(0,from.ch)+text[0]+lastLine.text.slice(to.ch),spansFor(0)),doc.remove(from.line+1,nlines);else{update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0)),update(lastLine,lastText+lastLine.text.slice(to.ch),lastSpans);for(var i=1,e=text.length-1,added=[];e>i;++i)added.push(new Line(text[i],spansFor(i),estimateHeight));nlines>1&&doc.remove(from.line+1,nlines-1),doc.insert(from.line+1,added)}signalLater(doc,"change",doc,change),setSelection(doc,selAfter.anchor,selAfter.head,null,!0)}function LeafChunk(lines){this.lines=lines,this.parent=null;for(var i=0,e=lines.length,height=0;e>i;++i)lines[i].parent=this,height+=lines[i].height;this.height=height}function BranchChunk(children){this.children=children;for(var size=0,height=0,i=0,e=children.length;e>i;++i){var ch=children[i];size+=ch.chunkSize(),height+=ch.height,ch.parent=this}this.size=size,this.height=height,this.parent=null}function linkedDocs(doc,f,sharedHistOnly){function propagate(doc,skip,sharedHist){if(doc.linked)for(var i=0;i<doc.linked.length;++i){var rel=doc.linked[i];if(rel.doc!=skip){var shared=sharedHist&&rel.sharedHist;(!sharedHistOnly||shared)&&(f(rel.doc,shared),propagate(rel.doc,doc,shared))}}}propagate(doc,null,!0)}function attachDoc(cm,doc){if(doc.cm)throw new Error("This document is already in use.");cm.doc=doc,doc.cm=cm,estimateLineHeights(cm),loadMode(cm),cm.options.lineWrapping||computeMaxLength(cm),cm.options.mode=doc.modeOption,regChange(cm)}function getLine(chunk,n){for(n-=chunk.first;!chunk.lines;)for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize();if(sz>n){chunk=child;break}n-=sz}return chunk.lines[n]}function getBetween(doc,start,end){var out=[],n=start.line;return doc.iter(start.line,end.line+1,function(line){var text=line.text;n==end.line&&(text=text.slice(0,end.ch)),n==start.line&&(text=text.slice(start.ch)),out.push(text),++n}),out}function getLines(doc,from,to){var out=[];return doc.iter(from,to,function(line){out.push(line.text)}),out}function updateLineHeight(line,height){for(var diff=height-line.height,n=line;n;n=n.parent)n.height+=diff}function lineNo(line){if(null==line.parent)return null;for(var cur=line.parent,no=indexOf(cur.lines,line),chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent)for(var i=0;chunk.children[i]!=cur;++i)no+=chunk.children[i].chunkSize();return no+cur.first}function lineAtHeight(chunk,h){var n=chunk.first;outer:do{for(var i=0,e=chunk.children.length;e>i;++i){var child=chunk.children[i],ch=child.height;if(ch>h){chunk=child;continue outer}h-=ch,n+=child.chunkSize()}return n}while(!chunk.lines);for(var i=0,e=chunk.lines.length;e>i;++i){var line=chunk.lines[i],lh=line.height;if(lh>h)break;h-=lh}return n+i}function heightAtLine(cm,lineObj){lineObj=visualLine(cm.doc,lineObj);for(var h=0,chunk=lineObj.parent,i=0;i<chunk.lines.length;++i){var line=chunk.lines[i];if(line==lineObj)break;h+=line.height}for(var p=chunk.parent;p;chunk=p,p=chunk.parent)for(var i=0;i<p.children.length;++i){var cur=p.children[i];if(cur==chunk)break;h+=cur.height}return h}function getOrder(line){var order=line.order;return null==order&&(order=line.order=bidiOrdering(line.text)),order}function makeHistory(startGen){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,generation:startGen||1,maxGeneration:startGen||1}}function attachLocalSpans(doc,change,from,to){var existing=change["spans_"+doc.id],n=0;doc.iter(Math.max(doc.first,from),Math.min(doc.first+doc.size,to),function(line){line.markedSpans&&((existing||(existing=change["spans_"+doc.id]={}))[n]=line.markedSpans),
++n})}function historyChangeFromChange(doc,change){var from={line:change.from.line,ch:change.from.ch},histChange={from:from,to:changeEnd(change),text:getBetween(doc,change.from,change.to)};return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1),linkedDocs(doc,function(doc){attachLocalSpans(doc,histChange,change.from.line,change.to.line+1)},!0),histChange}function addToHistory(doc,change,selAfter,opId){var hist=doc.history;hist.undone.length=0;var time=+new Date,cur=lst(hist.done);if(cur&&(hist.lastOp==opId||hist.lastOrigin==change.origin&&change.origin&&("+"==change.origin.charAt(0)&&doc.cm&&hist.lastTime>time-doc.cm.options.historyEventDelay||"*"==change.origin.charAt(0)))){var last=lst(cur.changes);posEq(change.from,change.to)&&posEq(change.from,last.to)?last.to=changeEnd(change):cur.changes.push(historyChangeFromChange(doc,change)),cur.anchorAfter=selAfter.anchor,cur.headAfter=selAfter.head}else for(cur={changes:[historyChangeFromChange(doc,change)],generation:hist.generation,anchorBefore:doc.sel.anchor,headBefore:doc.sel.head,anchorAfter:selAfter.anchor,headAfter:selAfter.head},hist.done.push(cur),hist.generation=++hist.maxGeneration;hist.done.length>hist.undoDepth;)hist.done.shift();hist.lastTime=time,hist.lastOp=opId,hist.lastOrigin=change.origin}function removeClearedSpans(spans){if(!spans)return null;for(var out,i=0;i<spans.length;++i)spans[i].marker.explicitlyCleared?out||(out=spans.slice(0,i)):out&&out.push(spans[i]);return out?out.length?out:null:spans}function getOldSpans(doc,change){var found=change["spans_"+doc.id];if(!found)return null;for(var i=0,nw=[];i<change.text.length;++i)nw.push(removeClearedSpans(found[i]));return nw}function copyHistoryArray(events,newGroup){for(var i=0,copy=[];i<events.length;++i){var event=events[i],changes=event.changes,newChanges=[];copy.push({changes:newChanges,anchorBefore:event.anchorBefore,headBefore:event.headBefore,anchorAfter:event.anchorAfter,headAfter:event.headAfter});for(var j=0;j<changes.length;++j){var m,change=changes[j];if(newChanges.push({from:change.from,to:change.to,text:change.text}),newGroup)for(var prop in change)(m=prop.match(/^spans_(\d+)$/))&&indexOf(newGroup,Number(m[1]))>-1&&(lst(newChanges)[prop]=change[prop],delete change[prop])}}return copy}function rebaseHistSel(pos,from,to,diff){to<pos.line?pos.line+=diff:from<pos.line&&(pos.line=from,pos.ch=0)}function rebaseHistArray(array,from,to,diff){for(var i=0;i<array.length;++i){for(var sub=array[i],ok=!0,j=0;j<sub.changes.length;++j){var cur=sub.changes[j];if(sub.copied||(cur.from=copyPos(cur.from),cur.to=copyPos(cur.to)),to<cur.from.line)cur.from.line+=diff,cur.to.line+=diff;else if(from<=cur.to.line){ok=!1;break}}sub.copied||(sub.anchorBefore=copyPos(sub.anchorBefore),sub.headBefore=copyPos(sub.headBefore),sub.anchorAfter=copyPos(sub.anchorAfter),sub.readAfter=copyPos(sub.headAfter),sub.copied=!0),ok?(rebaseHistSel(sub.anchorBefore),rebaseHistSel(sub.headBefore),rebaseHistSel(sub.anchorAfter),rebaseHistSel(sub.headAfter)):(array.splice(0,i+1),i=0)}}function rebaseHist(hist,change){var from=change.from.line,to=change.to.line,diff=change.text.length-(to-from)-1;rebaseHistArray(hist.done,from,to,diff),rebaseHistArray(hist.undone,from,to,diff)}function stopMethod(){e_stop(this)}function addStop(event){return event.stop||(event.stop=stopMethod),event}function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function e_defaultPrevented(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}function e_target(e){return e.target||e.srcElement}function e_button(e){var b=e.which;return null==b&&(1&e.button?b=1:2&e.button?b=3:4&e.button&&(b=2)),mac&&e.ctrlKey&&1==b&&(b=3),b}function on(emitter,type,f){if(emitter.addEventListener)emitter.addEventListener(type,f,!1);else if(emitter.attachEvent)emitter.attachEvent("on"+type,f);else{var map=emitter._handlers||(emitter._handlers={}),arr=map[type]||(map[type]=[]);arr.push(f)}}function off(emitter,type,f){if(emitter.removeEventListener)emitter.removeEventListener(type,f,!1);else if(emitter.detachEvent)emitter.detachEvent("on"+type,f);else{var arr=emitter._handlers&&emitter._handlers[type];if(!arr)return;for(var i=0;i<arr.length;++i)if(arr[i]==f){arr.splice(i,1);break}}}function signal(emitter,type){var arr=emitter._handlers&&emitter._handlers[type];if(arr)for(var args=Array.prototype.slice.call(arguments,2),i=0;i<arr.length;++i)arr[i].apply(null,args)}function signalLater(emitter,type){function bnd(f){return function(){f.apply(null,args)}}var arr=emitter._handlers&&emitter._handlers[type];if(arr){var args=Array.prototype.slice.call(arguments,2);delayedCallbacks||(++delayedCallbackDepth,delayedCallbacks=[],setTimeout(fireDelayed,0));for(var i=0;i<arr.length;++i)delayedCallbacks.push(bnd(arr[i]))}}function signalDOMEvent(cm,e,override){return signal(cm,override||e.type,cm,e),e_defaultPrevented(e)||e.codemirrorIgnore}function fireDelayed(){--delayedCallbackDepth;var delayed=delayedCallbacks;delayedCallbacks=null;for(var i=0;i<delayed.length;++i)delayed[i]()}function hasHandler(emitter,type){var arr=emitter._handlers&&emitter._handlers[type];return arr&&arr.length>0}function eventMixin(ctor){ctor.prototype.on=function(type,f){on(this,type,f)},ctor.prototype.off=function(type,f){off(this,type,f)}}function Delayed(){this.id=null}function countColumn(string,end,tabSize,startIndex,startValue){null==end&&(end=string.search(/[^\s\u00a0]/),-1==end&&(end=string.length));for(var i=startIndex||0,n=startValue||0;end>i;++i)"	"==string.charAt(i)?n+=tabSize-n%tabSize:++n;return n}function spaceStr(n){for(;spaceStrs.length<=n;)spaceStrs.push(lst(spaceStrs)+" ");return spaceStrs[n]}function lst(arr){return arr[arr.length-1]}function selectInput(node){if(ios)node.selectionStart=0,node.selectionEnd=node.value.length;else try{node.select()}catch(_e){}}function indexOf(collection,elt){if(collection.indexOf)return collection.indexOf(elt);for(var i=0,e=collection.length;e>i;++i)if(collection[i]==elt)return i;return-1}function createObj(base,props){function Obj(){}Obj.prototype=base;var inst=new Obj;return props&&copyObj(props,inst),inst}function copyObj(obj,target){target||(target={});for(var prop in obj)obj.hasOwnProperty(prop)&&(target[prop]=obj[prop]);return target}function emptyArray(size){for(var a=[],i=0;size>i;++i)a.push(void 0);return a}function bind(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args)}}function isWordChar(ch){return/\w/.test(ch)||ch>""&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}function isEmpty(obj){for(var n in obj)if(obj.hasOwnProperty(n)&&obj[n])return!1;return!0}function elt(tag,content,className,style){var e=document.createElement(tag);if(className&&(e.className=className),style&&(e.style.cssText=style),"string"==typeof content)setTextContent(e,content);else if(content)for(var i=0;i<content.length;++i)e.appendChild(content[i]);return e}function removeChildren(e){for(var count=e.childNodes.length;count>0;--count)e.removeChild(e.firstChild);return e}function removeChildrenAndAdd(parent,e){return removeChildren(parent).appendChild(e)}function setTextContent(e,str){ie_lt9?(e.innerHTML="",e.appendChild(document.createTextNode(str))):e.textContent=str}function getRect(node){return node.getBoundingClientRect()}function spanAffectsWrapping(){return!1}function scrollbarWidth(measure){if(null!=knownScrollbarWidth)return knownScrollbarWidth;var test=elt("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return removeChildrenAndAdd(measure,test),test.offsetWidth&&(knownScrollbarWidth=test.offsetHeight-test.clientHeight),knownScrollbarWidth||0}function zeroWidthElement(measure){if(null==zwspSupported){var test=elt("span","");removeChildrenAndAdd(measure,elt("span",[test,document.createTextNode("x")])),0!=measure.firstChild.offsetHeight&&(zwspSupported=test.offsetWidth<=1&&test.offsetHeight>2&&!ie_lt8)}return zwspSupported?elt("span",""):elt("span","",null,"display: inline-block; width: 1px; margin-right: -1px")}function iterateBidiSections(order,from,to,f){if(!order)return f(from,to,"ltr");for(var found=!1,i=0;i<order.length;++i){var part=order[i];(part.from<to&&part.to>from||from==to&&part.to==from)&&(f(Math.max(part.from,from),Math.min(part.to,to),1==part.level?"rtl":"ltr"),found=!0)}found||f(from,to,"ltr")}function bidiLeft(part){return part.level%2?part.to:part.from}function bidiRight(part){return part.level%2?part.from:part.to}function lineLeft(line){var order=getOrder(line);return order?bidiLeft(order[0]):0}function lineRight(line){var order=getOrder(line);return order?bidiRight(lst(order)):line.text.length}function lineStart(cm,lineN){var line=getLine(cm.doc,lineN),visual=visualLine(cm.doc,line);visual!=line&&(lineN=lineNo(visual));var order=getOrder(visual),ch=order?order[0].level%2?lineRight(visual):lineLeft(visual):0;return Pos(lineN,ch)}function lineEnd(cm,lineN){for(var merged,line;merged=collapsedSpanAtEnd(line=getLine(cm.doc,lineN));)lineN=merged.find().to.line;var order=getOrder(line),ch=order?order[0].level%2?lineLeft(line):lineRight(line):line.text.length;return Pos(lineN,ch)}function compareBidiLevel(order,a,b){var linedir=order[0].level;return a==linedir?!0:b==linedir?!1:b>a}function getBidiPartAt(order,pos){for(var found,i=0;i<order.length;++i){var cur=order[i];if(cur.from<pos&&cur.to>pos)return bidiOther=null,i;if(cur.from==pos||cur.to==pos){if(null!=found)return compareBidiLevel(order,cur.level,order[found].level)?(bidiOther=found,i):(bidiOther=i,found);found=i}}return bidiOther=null,found}function moveInLine(line,pos,dir,byUnit){if(!byUnit)return pos+dir;do pos+=dir;while(pos>0&&isExtendingChar.test(line.text.charAt(pos)));return pos}function moveVisually(line,start,dir,byUnit){var bidi=getOrder(line);if(!bidi)return moveLogically(line,start,dir,byUnit);for(var pos=getBidiPartAt(bidi,start),part=bidi[pos],target=moveInLine(line,start,part.level%2?-dir:dir,byUnit);;){if(target>part.from&&target<part.to)return target;if(target==part.from||target==part.to)return getBidiPartAt(bidi,target)==pos?target:(part=bidi[pos+=dir],dir>0==part.level%2?part.to:part.from);if(part=bidi[pos+=dir],!part)return null;target=dir>0==part.level%2?moveInLine(line,part.to,-1,byUnit):moveInLine(line,part.from,1,byUnit)}}function moveLogically(line,start,dir,byUnit){var target=start+dir;if(byUnit)for(;target>0&&isExtendingChar.test(line.text.charAt(target));)target+=dir;return 0>target||target>line.text.length?null:target}var gecko=/gecko\/\d/i.test(navigator.userAgent),ie=/MSIE \d/.test(navigator.userAgent),ie_lt8=ie&&(null==document.documentMode||document.documentMode<8),ie_lt9=ie&&(null==document.documentMode||document.documentMode<9),webkit=/WebKit\//.test(navigator.userAgent),qtwebkit=webkit&&/Qt\/\d+\.\d+/.test(navigator.userAgent),chrome=/Chrome\//.test(navigator.userAgent),opera=/Opera\//.test(navigator.userAgent),safari=/Apple Computer/.test(navigator.vendor),khtml=/KHTML\//.test(navigator.userAgent),mac_geLion=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),mac_geMountainLion=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),phantom=/PhantomJS/.test(navigator.userAgent),ios=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),mobile=ios||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),mac=ios||/Mac/.test(navigator.platform),windows=/win/i.test(navigator.platform),opera_version=opera&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);opera_version&&(opera_version=Number(opera_version[1])),opera_version&&opera_version>=15&&(opera=!1,webkit=!0);var measureText,lastClick,lastDoubleClick,flipCtrlCmd=mac&&(qtwebkit||opera&&(null==opera_version||12.11>opera_version)),captureMiddleClick=gecko||ie&&!ie_lt9,sawReadOnlySpans=!1,sawCollapsedSpans=!1,nextOpId=0,lastDrop=0,wheelSamples=0,wheelPixelsPerUnit=null;ie?wheelPixelsPerUnit=-.53:gecko?wheelPixelsPerUnit=15:chrome?wheelPixelsPerUnit=-.7:safari&&(wheelPixelsPerUnit=-1/3);var maybeTransition,detectingSelectAll,lastStoppedKey=null,changeEnd=CodeMirror.changeEnd=function(change){return change.text?Pos(change.from.line+change.text.length-1,lst(change.text).length+(1==change.text.length?change.from.ch:0)):change.to};CodeMirror.Pos=Pos,CodeMirror.prototype={constructor:CodeMirror,focus:function(){window.focus(),focusInput(this),onFocus(this),fastPoll(this)},setOption:function(option,value){var options=this.options,old=options[option];(options[option]!=value||"mode"==option)&&(options[option]=value,optionHandlers.hasOwnProperty(option)&&operation(this,optionHandlers[option])(this,value,old))},getOption:function(option){return this.options[option]},getDoc:function(){return this.doc},addKeyMap:function(map,bottom){this.state.keyMaps[bottom?"push":"unshift"](map)},removeKeyMap:function(map){for(var maps=this.state.keyMaps,i=0;i<maps.length;++i)if(maps[i]==map||"string"!=typeof maps[i]&&maps[i].name==map)return maps.splice(i,1),!0},addOverlay:operation(null,function(spec,options){var mode=spec.token?spec:CodeMirror.getMode(this.options,spec);if(mode.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:mode,modeSpec:spec,opaque:options&&options.opaque}),this.state.modeGen++,regChange(this)}),removeOverlay:operation(null,function(spec){for(var overlays=this.state.overlays,i=0;i<overlays.length;++i){var cur=overlays[i].modeSpec;if(cur==spec||"string"==typeof spec&&cur.name==spec)return overlays.splice(i,1),this.state.modeGen++,void regChange(this)}}),indentLine:operation(null,function(n,dir,aggressive){"string"!=typeof dir&&"number"!=typeof dir&&(dir=null==dir?this.options.smartIndent?"smart":"prev":dir?"add":"subtract"),isLine(this.doc,n)&&indentLine(this,n,dir,aggressive)}),indentSelection:operation(null,function(how){var sel=this.doc.sel;if(posEq(sel.from,sel.to))return indentLine(this,sel.from.line,how);for(var e=sel.to.line-(sel.to.ch?0:1),i=sel.from.line;e>=i;++i)indentLine(this,i,how)}),getTokenAt:function(pos,precise){var doc=this.doc;pos=clipPos(doc,pos);for(var state=getStateBefore(this,pos.line,precise),mode=this.doc.mode,line=getLine(doc,pos.line),stream=new StringStream(line.text,this.options.tabSize);stream.pos<pos.ch&&!stream.eol();){stream.start=stream.pos;var style=mode.token(stream,state)}return{start:stream.start,end:stream.pos,string:stream.current(),className:style||null,type:style||null,state:state}},getTokenTypeAt:function(pos){pos=clipPos(this.doc,pos);var styles=getLineStyles(this,getLine(this.doc,pos.line)),before=0,after=(styles.length-1)/2,ch=pos.ch;if(0==ch)return styles[2];for(;;){var mid=before+after>>1;if((mid?styles[2*mid-1]:0)>=ch)after=mid;else{if(!(styles[2*mid+1]<ch))return styles[2*mid+2];before=mid+1}}},getModeAt:function(pos){var mode=this.doc.mode;return mode.innerMode?CodeMirror.innerMode(mode,this.getTokenAt(pos).state).mode:mode},getHelper:function(pos,type){if(helpers.hasOwnProperty(type)){var help=helpers[type],mode=this.getModeAt(pos);return mode[type]&&help[mode[type]]||mode.helperType&&help[mode.helperType]||help[mode.name]}},getStateAfter:function(line,precise){var doc=this.doc;return line=clipLine(doc,null==line?doc.first+doc.size-1:line),getStateBefore(this,line+1,precise)},cursorCoords:function(start,mode){var pos,sel=this.doc.sel;return pos=null==start?sel.head:"object"==typeof start?clipPos(this.doc,start):start?sel.from:sel.to,cursorCoords(this,pos,mode||"page")},charCoords:function(pos,mode){return charCoords(this,clipPos(this.doc,pos),mode||"page")},coordsChar:function(coords,mode){return coords=fromCoordSystem(this,coords,mode||"page"),coordsChar(this,coords.left,coords.top)},lineAtHeight:function(height,mode){return height=fromCoordSystem(this,{top:height,left:0},mode||"page").top,lineAtHeight(this.doc,height+this.display.viewOffset)},heightAtLine:function(line,mode){var end=!1,last=this.doc.first+this.doc.size-1;line<this.doc.first?line=this.doc.first:line>last&&(line=last,end=!0);var lineObj=getLine(this.doc,line);return intoCoordSystem(this,getLine(this.doc,line),{top:0,left:0},mode||"page").top+(end?lineObj.height:0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},setGutterMarker:operation(null,function(line,gutterID,value){return changeLine(this,line,function(line){var markers=line.gutterMarkers||(line.gutterMarkers={});return markers[gutterID]=value,!value&&isEmpty(markers)&&(line.gutterMarkers=null),!0})}),clearGutter:operation(null,function(gutterID){var cm=this,doc=cm.doc,i=doc.first;doc.iter(function(line){line.gutterMarkers&&line.gutterMarkers[gutterID]&&(line.gutterMarkers[gutterID]=null,regChange(cm,i,i+1),isEmpty(line.gutterMarkers)&&(line.gutterMarkers=null)),++i})}),addLineClass:operation(null,function(handle,where,cls){return changeLine(this,handle,function(line){var prop="text"==where?"textClass":"background"==where?"bgClass":"wrapClass";if(line[prop]){if(new RegExp("(?:^|\\s)"+cls+"(?:$|\\s)").test(line[prop]))return!1;line[prop]+=" "+cls}else line[prop]=cls;return!0})}),removeLineClass:operation(null,function(handle,where,cls){return changeLine(this,handle,function(line){var prop="text"==where?"textClass":"background"==where?"bgClass":"wrapClass",cur=line[prop];if(!cur)return!1;if(null==cls)line[prop]=null;else{var found=cur.match(new RegExp("(?:^|\\s+)"+cls+"(?:$|\\s+)"));if(!found)return!1;var end=found.index+found[0].length;line[prop]=cur.slice(0,found.index)+(found.index&&end!=cur.length?" ":"")+cur.slice(end)||null}return!0})}),addLineWidget:operation(null,function(handle,node,options){return addLineWidget(this,handle,node,options)}),removeLineWidget:function(widget){widget.clear()},lineInfo:function(line){if("number"==typeof line){if(!isLine(this.doc,line))return null;var n=line;if(line=getLine(this.doc,line),!line)return null}else{var n=lineNo(line);if(null==n)return null}return{line:n,handle:line,text:line.text,gutterMarkers:line.gutterMarkers,textClass:line.textClass,bgClass:line.bgClass,wrapClass:line.wrapClass,widgets:line.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(pos,node,scroll,vert,horiz){var display=this.display;pos=cursorCoords(this,clipPos(this.doc,pos));var top=pos.bottom,left=pos.left;if(node.style.position="absolute",display.sizer.appendChild(node),"over"==vert)top=pos.top;else if("above"==vert||"near"==vert){var vspace=Math.max(display.wrapper.clientHeight,this.doc.height),hspace=Math.max(display.sizer.clientWidth,display.lineSpace.clientWidth);("above"==vert||pos.bottom+node.offsetHeight>vspace)&&pos.top>node.offsetHeight?top=pos.top-node.offsetHeight:pos.bottom+node.offsetHeight<=vspace&&(top=pos.bottom),left+node.offsetWidth>hspace&&(left=hspace-node.offsetWidth)}node.style.top=top+"px",node.style.left=node.style.right="","right"==horiz?(left=display.sizer.clientWidth-node.offsetWidth,node.style.right="0px"):("left"==horiz?left=0:"middle"==horiz&&(left=(display.sizer.clientWidth-node.offsetWidth)/2),node.style.left=left+"px"),scroll&&scrollIntoView(this,left,top,left+node.offsetWidth,top+node.offsetHeight)},triggerOnKeyDown:operation(null,onKeyDown),execCommand:function(cmd){return commands[cmd](this)},findPosH:function(from,amount,unit,visually){var dir=1;0>amount&&(dir=-1,amount=-amount);for(var i=0,cur=clipPos(this.doc,from);amount>i&&(cur=findPosH(this.doc,cur,dir,unit,visually),!cur.hitSide);++i);return cur},moveH:operation(null,function(dir,unit){var pos,sel=this.doc.sel;pos=sel.shift||sel.extend||posEq(sel.from,sel.to)?findPosH(this.doc,sel.head,dir,unit,this.options.rtlMoveVisually):0>dir?sel.from:sel.to,extendSelection(this.doc,pos,pos,dir)}),deleteH:operation(null,function(dir,unit){var sel=this.doc.sel;posEq(sel.from,sel.to)?replaceRange(this.doc,"",sel.from,findPosH(this.doc,sel.head,dir,unit,!1),"+delete"):replaceRange(this.doc,"",sel.from,sel.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(from,amount,unit,goalColumn){var dir=1,x=goalColumn;0>amount&&(dir=-1,amount=-amount);for(var i=0,cur=clipPos(this.doc,from);amount>i;++i){var coords=cursorCoords(this,cur,"div");if(null==x?x=coords.left:coords.left=x,cur=findPosV(this,coords,dir,unit),cur.hitSide)break}return cur},moveV:operation(null,function(dir,unit){var sel=this.doc.sel,pos=cursorCoords(this,sel.head,"div");null!=sel.goalColumn&&(pos.left=sel.goalColumn);var target=findPosV(this,pos,dir,unit);"page"==unit&&addToScrollPos(this,0,charCoords(this,target,"div").top-pos.top),extendSelection(this.doc,target,target,dir),sel.goalColumn=pos.left}),toggleOverwrite:function(value){(null==value||value!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite",""))},hasFocus:function(){return this.state.focused},scrollTo:operation(null,function(x,y){updateScrollPos(this,x,y)}),getScrollInfo:function(){var scroller=this.display.scroller,co=scrollerCutOff;return{left:scroller.scrollLeft,top:scroller.scrollTop,height:scroller.scrollHeight-co,width:scroller.scrollWidth-co,clientHeight:scroller.clientHeight-co,clientWidth:scroller.clientWidth-co}},scrollIntoView:operation(null,function(range,margin){null==range?range={from:this.doc.sel.head,to:null}:"number"==typeof range?range={from:Pos(range,0),to:null}:null==range.from&&(range={from:range,to:null}),range.to||(range.to=range.from),margin||(margin=0);var coords=range;null!=range.from.line&&(this.curOp.scrollToPos={from:range.from,to:range.to,margin:margin},coords={from:cursorCoords(this,range.from),to:cursorCoords(this,range.to)});var sPos=calculateScrollPos(this,Math.min(coords.from.left,coords.to.left),Math.min(coords.from.top,coords.to.top)-margin,Math.max(coords.from.right,coords.to.right),Math.max(coords.from.bottom,coords.to.bottom)+margin);updateScrollPos(this,sPos.scrollLeft,sPos.scrollTop)}),setSize:operation(null,function(width,height){function interpret(val){return"number"==typeof val||/^\d+$/.test(String(val))?val+"px":val}null!=width&&(this.display.wrapper.style.width=interpret(width)),null!=height&&(this.display.wrapper.style.height=interpret(height)),this.options.lineWrapping&&(this.display.measureLineCache.length=this.display.measureLineCachePos=0),this.curOp.forceUpdate=!0}),operation:function(f){return runInOp(this,f)},refresh:operation(null,function(){var badHeight=null==this.display.cachedTextHeight;clearCaches(this),updateScrollPos(this,this.doc.scrollLeft,this.doc.scrollTop),regChange(this),badHeight&&estimateLineHeights(this)}),swapDoc:operation(null,function(doc){var old=this.doc;return old.cm=null,attachDoc(this,doc),clearCaches(this),resetInput(this,!0),updateScrollPos(this,doc.scrollLeft,doc.scrollTop),signalLater(this,"swapDoc",this,old),old}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},eventMixin(CodeMirror);var optionHandlers=CodeMirror.optionHandlers={},defaults=CodeMirror.defaults={},Init=CodeMirror.Init={toString:function(){return"CodeMirror.Init"}};option("value","",function(cm,val){cm.setValue(val)},!0),option("mode",null,function(cm,val){cm.doc.modeOption=val,loadMode(cm)},!0),option("indentUnit",2,loadMode,!0),option("indentWithTabs",!1),option("smartIndent",!0),option("tabSize",4,function(cm){loadMode(cm),clearCaches(cm),regChange(cm)},!0),option("electricChars",!0),option("rtlMoveVisually",!windows),option("theme","default",function(cm){themeChanged(cm),guttersChanged(cm)},!0),option("keyMap","default",keyMapChanged),option("extraKeys",null),option("onKeyEvent",null),option("onDragEvent",null),option("lineWrapping",!1,wrappingChanged,!0),option("gutters",[],function(cm){setGuttersForLineNumbers(cm.options),guttersChanged(cm)},!0),option("fixedGutter",!0,function(cm,val){cm.display.gutters.style.left=val?compensateForHScroll(cm.display)+"px":"0",cm.refresh()},!0),option("coverGutterNextToScrollbar",!1,updateScrollbars,!0),option("lineNumbers",!1,function(cm){setGuttersForLineNumbers(cm.options),guttersChanged(cm)},!0),option("firstLineNumber",1,guttersChanged,!0),option("lineNumberFormatter",function(integer){return integer},guttersChanged,!0),option("showCursorWhenSelecting",!1,updateSelection,!0),option("resetSelectionOnContextMenu",!0),option("readOnly",!1,function(cm,val){"nocursor"==val?(onBlur(cm),cm.display.input.blur()):val||resetInput(cm,!0)}),option("dragDrop",!0),option("cursorBlinkRate",530),option("cursorScrollMargin",0),option("cursorHeight",1),option("workTime",100),option("workDelay",100),option("flattenSpans",!0),option("pollInterval",100),option("undoDepth",40,function(cm,val){cm.doc.history.undoDepth=val}),option("historyEventDelay",500),option("viewportMargin",10,function(cm){cm.refresh()},!0),option("maxHighlightLength",1e4,function(cm){loadMode(cm),cm.refresh()},!0),option("crudeMeasuringFrom",1e4),option("moveInputWithCursor",!0,function(cm,val){val||(cm.display.inputDiv.style.top=cm.display.inputDiv.style.left=0)}),option("tabindex",null,function(cm,val){cm.display.input.tabIndex=val||""}),option("autofocus",null);var modes=CodeMirror.modes={},mimeModes=CodeMirror.mimeModes={};CodeMirror.defineMode=function(name,mode){if(CodeMirror.defaults.mode||"null"==name||(CodeMirror.defaults.mode=name),arguments.length>2){mode.dependencies=[];for(var i=2;i<arguments.length;++i)mode.dependencies.push(arguments[i])}modes[name]=mode},CodeMirror.defineMIME=function(mime,spec){mimeModes[mime]=spec},CodeMirror.resolveMode=function(spec){if("string"==typeof spec&&mimeModes.hasOwnProperty(spec))spec=mimeModes[spec];else if(spec&&"string"==typeof spec.name&&mimeModes.hasOwnProperty(spec.name)){var found=mimeModes[spec.name];spec=createObj(found,spec),spec.name=found.name}else if("string"==typeof spec&&/^[\w\-]+\/[\w\-]+\+xml$/.test(spec))return CodeMirror.resolveMode("application/xml");return"string"==typeof spec?{name:spec}:spec||{name:"null"}},CodeMirror.getMode=function(options,spec){var spec=CodeMirror.resolveMode(spec),mfactory=modes[spec.name];if(!mfactory)return CodeMirror.getMode(options,"text/plain");var modeObj=mfactory(options,spec);if(modeExtensions.hasOwnProperty(spec.name)){var exts=modeExtensions[spec.name];for(var prop in exts)exts.hasOwnProperty(prop)&&(modeObj.hasOwnProperty(prop)&&(modeObj["_"+prop]=modeObj[prop]),modeObj[prop]=exts[prop])}return modeObj.name=spec.name,modeObj},CodeMirror.defineMode("null",function(){return{token:function(stream){stream.skipToEnd()}}}),CodeMirror.defineMIME("text/plain","null");var modeExtensions=CodeMirror.modeExtensions={};CodeMirror.extendMode=function(mode,properties){var exts=modeExtensions.hasOwnProperty(mode)?modeExtensions[mode]:modeExtensions[mode]={};copyObj(properties,exts)},CodeMirror.defineExtension=function(name,func){CodeMirror.prototype[name]=func},CodeMirror.defineDocExtension=function(name,func){Doc.prototype[name]=func},CodeMirror.defineOption=option;var initHooks=[];CodeMirror.defineInitHook=function(f){initHooks.push(f)};var helpers=CodeMirror.helpers={};CodeMirror.registerHelper=function(type,name,value){helpers.hasOwnProperty(type)||(helpers[type]=CodeMirror[type]={}),helpers[type][name]=value},CodeMirror.isWordChar=isWordChar,CodeMirror.copyState=copyState,CodeMirror.startState=startState,CodeMirror.innerMode=function(mode,state){for(;mode.innerMode;){var info=mode.innerMode(state);if(!info||info.mode==mode)break;state=info.state,mode=info.mode}return info||{mode:mode,state:state}};var commands=CodeMirror.commands={selectAll:function(cm){cm.setSelection(Pos(cm.firstLine(),0),Pos(cm.lastLine()))},killLine:function(cm){var from=cm.getCursor(!0),to=cm.getCursor(!1),sel=!posEq(from,to);sel||cm.getLine(from.line).length!=from.ch?cm.replaceRange("",from,sel?to:Pos(from.line),"+delete"):cm.replaceRange("",from,Pos(from.line+1,0),"+delete")},deleteLine:function(cm){var l=cm.getCursor().line;cm.replaceRange("",Pos(l,0),Pos(l),"+delete")},delLineLeft:function(cm){var cur=cm.getCursor();cm.replaceRange("",Pos(cur.line,0),cur,"+delete")},undo:function(cm){cm.undo()},redo:function(cm){cm.redo()},goDocStart:function(cm){cm.extendSelection(Pos(cm.firstLine(),0))},goDocEnd:function(cm){cm.extendSelection(Pos(cm.lastLine()))},goLineStart:function(cm){cm.extendSelection(lineStart(cm,cm.getCursor().line))},goLineStartSmart:function(cm){var cur=cm.getCursor(),start=lineStart(cm,cur.line),line=cm.getLineHandle(start.line),order=getOrder(line);if(order&&0!=order[0].level)cm.extendSelection(start);else{var firstNonWS=Math.max(0,line.text.search(/\S/)),inWS=cur.line==start.line&&cur.ch<=firstNonWS&&cur.ch;cm.extendSelection(Pos(start.line,inWS?0:firstNonWS))}},goLineEnd:function(cm){cm.extendSelection(lineEnd(cm,cm.getCursor().line))},goLineRight:function(cm){var top=cm.charCoords(cm.getCursor(),"div").top+5;cm.extendSelection(cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div"))},goLineLeft:function(cm){var top=cm.charCoords(cm.getCursor(),"div").top+5;cm.extendSelection(cm.coordsChar({left:0,top:top},"div"))},goLineUp:function(cm){cm.moveV(-1,"line")},goLineDown:function(cm){cm.moveV(1,"line")},goPageUp:function(cm){cm.moveV(-1,"page")},goPageDown:function(cm){cm.moveV(1,"page")},goCharLeft:function(cm){cm.moveH(-1,"char")},goCharRight:function(cm){cm.moveH(1,"char")},goColumnLeft:function(cm){cm.moveH(-1,"column")},goColumnRight:function(cm){cm.moveH(1,"column")},goWordLeft:function(cm){cm.moveH(-1,"word")},goGroupRight:function(cm){cm.moveH(1,"group")},goGroupLeft:function(cm){cm.moveH(-1,"group")},goWordRight:function(cm){cm.moveH(1,"word")},delCharBefore:function(cm){cm.deleteH(-1,"char")},delCharAfter:function(cm){cm.deleteH(1,"char")},delWordBefore:function(cm){cm.deleteH(-1,"word")},delWordAfter:function(cm){cm.deleteH(1,"word")},delGroupBefore:function(cm){cm.deleteH(-1,"group")},delGroupAfter:function(cm){cm.deleteH(1,"group")},indentAuto:function(cm){cm.indentSelection("smart")},indentMore:function(cm){cm.indentSelection("add")},indentLess:function(cm){cm.indentSelection("subtract")},insertTab:function(cm){cm.replaceSelection("	","end","+input")},defaultTab:function(cm){cm.somethingSelected()?cm.indentSelection("add"):cm.replaceSelection("	","end","+input")},transposeChars:function(cm){var cur=cm.getCursor(),line=cm.getLine(cur.line);cur.ch>0&&cur.ch<line.length-1&&cm.replaceRange(line.charAt(cur.ch)+line.charAt(cur.ch-1),Pos(cur.line,cur.ch-1),Pos(cur.line,cur.ch+1))},newlineAndIndent:function(cm){operation(cm,function(){cm.replaceSelection("\n","end","+input"),cm.indentLine(cm.getCursor().line,null,!0)})()},toggleOverwrite:function(cm){cm.toggleOverwrite()}},keyMap=CodeMirror.keyMap={};keyMap.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},keyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},keyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo",
"Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft",fallthrough:["basic","emacsy"]},keyMap["default"]=mac?keyMap.macDefault:keyMap.pcDefault,keyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},CodeMirror.lookupKey=lookupKey,CodeMirror.isModifierKey=isModifierKey,CodeMirror.keyName=keyName,CodeMirror.fromTextArea=function(textarea,options){function save(){textarea.value=cm.getValue()}if(options||(options={}),options.value=textarea.value,!options.tabindex&&textarea.tabindex&&(options.tabindex=textarea.tabindex),!options.placeholder&&textarea.placeholder&&(options.placeholder=textarea.placeholder),null==options.autofocus){var hasFocus=document.body;try{hasFocus=document.activeElement}catch(e){}options.autofocus=hasFocus==textarea||null!=textarea.getAttribute("autofocus")&&hasFocus==document.body}if(textarea.form&&(on(textarea.form,"submit",save),!options.leaveSubmitMethodAlone)){var form=textarea.form,realSubmit=form.submit;try{var wrappedSubmit=form.submit=function(){save(),form.submit=realSubmit,form.submit(),form.submit=wrappedSubmit}}catch(e){}}textarea.style.display="none";var cm=CodeMirror(function(node){textarea.parentNode.insertBefore(node,textarea.nextSibling)},options);return cm.save=save,cm.getTextArea=function(){return textarea},cm.toTextArea=function(){save(),textarea.parentNode.removeChild(cm.getWrapperElement()),textarea.style.display="",textarea.form&&(off(textarea.form,"submit",save),"function"==typeof textarea.form.submit&&(textarea.form.submit=realSubmit))},cm},StringStream.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(match){var ch=this.string.charAt(this.pos);if("string"==typeof match)var ok=ch==match;else var ok=ch&&(match.test?match.test(ch):match(ch));return ok?(++this.pos,ch):void 0},eatWhile:function(match){for(var start=this.pos;this.eat(match););return this.pos>start},eatSpace:function(){for(var start=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>start},skipToEnd:function(){this.pos=this.string.length},skipTo:function(ch){var found=this.string.indexOf(ch,this.pos);return found>-1?(this.pos=found,!0):void 0},backUp:function(n){this.pos-=n},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return countColumn(this.string,null,this.tabSize)},match:function(pattern,consume,caseInsensitive){if("string"!=typeof pattern){var match=this.string.slice(this.pos).match(pattern);return match&&match.index>0?null:(match&&consume!==!1&&(this.pos+=match[0].length),match)}var cased=function(str){return caseInsensitive?str.toLowerCase():str},substr=this.string.substr(this.pos,pattern.length);return cased(substr)==cased(pattern)?(consume!==!1&&(this.pos+=pattern.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},CodeMirror.StringStream=StringStream,CodeMirror.TextMarker=TextMarker,eventMixin(TextMarker),TextMarker.prototype.clear=function(){if(!this.explicitlyCleared){var cm=this.doc.cm,withOp=cm&&!cm.curOp;if(withOp&&startOperation(cm),hasHandler(this,"clear")){var found=this.find();found&&signalLater(this,"clear",found.from,found.to)}for(var min=null,max=null,i=0;i<this.lines.length;++i){var line=this.lines[i],span=getMarkedSpanFor(line.markedSpans,this);null!=span.to&&(max=lineNo(line)),line.markedSpans=removeMarkedSpan(line.markedSpans,span),null!=span.from?min=lineNo(line):this.collapsed&&!lineIsHidden(this.doc,line)&&cm&&updateLineHeight(line,textHeight(cm.display))}if(cm&&this.collapsed&&!cm.options.lineWrapping)for(var i=0;i<this.lines.length;++i){var visual=visualLine(cm.doc,this.lines[i]),len=lineLength(cm.doc,visual);len>cm.display.maxLineLength&&(cm.display.maxLine=visual,cm.display.maxLineLength=len,cm.display.maxLineChanged=!0)}null!=min&&cm&&regChange(cm,min,max+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,cm&&reCheckSelection(cm)),withOp&&endOperation(cm)}},TextMarker.prototype.find=function(){for(var from,to,i=0;i<this.lines.length;++i){var line=this.lines[i],span=getMarkedSpanFor(line.markedSpans,this);if(null!=span.from||null!=span.to){var found=lineNo(line);null!=span.from&&(from=Pos(found,span.from)),null!=span.to&&(to=Pos(found,span.to))}}return"bookmark"==this.type?from:from&&{from:from,to:to}},TextMarker.prototype.changed=function(){var pos=this.find(),cm=this.doc.cm;if(pos&&cm){"bookmark"!=this.type&&(pos=pos.from);var line=getLine(this.doc,pos.line);if(clearCachedMeasurement(cm,line),pos.line>=cm.display.showingFrom&&pos.line<cm.display.showingTo){for(var node=cm.display.lineDiv.firstChild;node;node=node.nextSibling)if(node.lineObj==line){node.offsetHeight!=line.height&&updateLineHeight(line,node.offsetHeight);break}runInOp(cm,function(){cm.curOp.selectionChanged=cm.curOp.forceUpdate=cm.curOp.updateMaxLine=!0})}}},TextMarker.prototype.attachLine=function(line){if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;op.maybeHiddenMarkers&&-1!=indexOf(op.maybeHiddenMarkers,this)||(op.maybeUnhiddenMarkers||(op.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(line)},TextMarker.prototype.detachLine=function(line){if(this.lines.splice(indexOf(this.lines,line),1),!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;(op.maybeHiddenMarkers||(op.maybeHiddenMarkers=[])).push(this)}},CodeMirror.SharedTextMarker=SharedTextMarker,eventMixin(SharedTextMarker),SharedTextMarker.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var i=0;i<this.markers.length;++i)this.markers[i].clear();signalLater(this,"clear")}},SharedTextMarker.prototype.find=function(){return this.primary.find()};var LineWidget=CodeMirror.LineWidget=function(cm,node,options){if(options)for(var opt in options)options.hasOwnProperty(opt)&&(this[opt]=options[opt]);this.cm=cm,this.node=node};eventMixin(LineWidget),LineWidget.prototype.clear=widgetOperation(function(){var ws=this.line.widgets,no=lineNo(this.line);if(null!=no&&ws){for(var i=0;i<ws.length;++i)ws[i]==this&&ws.splice(i--,1);ws.length||(this.line.widgets=null);var aboveVisible=heightAtLine(this.cm,this.line)<this.cm.doc.scrollTop;updateLineHeight(this.line,Math.max(0,this.line.height-widgetHeight(this))),aboveVisible&&addToScrollPos(this.cm,0,-this.height),regChange(this.cm,no,no+1)}}),LineWidget.prototype.changed=widgetOperation(function(){var oldH=this.height;this.height=null;var diff=widgetHeight(this)-oldH;if(diff){updateLineHeight(this.line,this.line.height+diff);var no=lineNo(this.line);regChange(this.cm,no,no+1)}});var Line=CodeMirror.Line=function(text,markedSpans,estimateHeight){this.text=text,attachMarkedSpans(this,markedSpans),this.height=estimateHeight?estimateHeight(this):1};eventMixin(Line);var styleToClassCache={},tokenSpecialChars=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;LeafChunk.prototype={chunkSize:function(){return this.lines.length},removeInner:function(at,n){for(var i=at,e=at+n;e>i;++i){var line=this.lines[i];this.height-=line.height,cleanUpLine(line),signalLater(line,"delete")}this.lines.splice(at,n)},collapse:function(lines){lines.splice.apply(lines,[lines.length,0].concat(this.lines))},insertInner:function(at,lines,height){this.height+=height,this.lines=this.lines.slice(0,at).concat(lines).concat(this.lines.slice(at));for(var i=0,e=lines.length;e>i;++i)lines[i].parent=this},iterN:function(at,n,op){for(var e=at+n;e>at;++at)if(op(this.lines[at]))return!0}},BranchChunk.prototype={chunkSize:function(){return this.size},removeInner:function(at,n){this.size-=n;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(sz>at){var rm=Math.min(n,sz-at),oldHeight=child.height;if(child.removeInner(at,rm),this.height-=oldHeight-child.height,sz==rm&&(this.children.splice(i--,1),child.parent=null),0==(n-=rm))break;at=0}else at-=sz}if(this.size-n<25){var lines=[];this.collapse(lines),this.children=[new LeafChunk(lines)],this.children[0].parent=this}},collapse:function(lines){for(var i=0,e=this.children.length;e>i;++i)this.children[i].collapse(lines)},insertInner:function(at,lines,height){this.size+=lines.length,this.height+=height;for(var i=0,e=this.children.length;e>i;++i){var child=this.children[i],sz=child.chunkSize();if(sz>=at){if(child.insertInner(at,lines,height),child.lines&&child.lines.length>50){for(;child.lines.length>50;){var spilled=child.lines.splice(child.lines.length-25,25),newleaf=new LeafChunk(spilled);child.height-=newleaf.height,this.children.splice(i+1,0,newleaf),newleaf.parent=this}this.maybeSpill()}break}at-=sz}},maybeSpill:function(){if(!(this.children.length<=10)){var me=this;do{var spilled=me.children.splice(me.children.length-5,5),sibling=new BranchChunk(spilled);if(me.parent){me.size-=sibling.size,me.height-=sibling.height;var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling)}else{var copy=new BranchChunk(me.children);copy.parent=me,me.children=[copy,sibling],me=copy}sibling.parent=me.parent}while(me.children.length>10);me.parent.maybeSpill()}},iterN:function(at,n,op){for(var i=0,e=this.children.length;e>i;++i){var child=this.children[i],sz=child.chunkSize();if(sz>at){var used=Math.min(n,sz-at);if(child.iterN(at,used,op))return!0;if(0==(n-=used))break;at=0}else at-=sz}}};var nextDocId=0,Doc=CodeMirror.Doc=function(text,mode,firstLine){if(!(this instanceof Doc))return new Doc(text,mode,firstLine);null==firstLine&&(firstLine=0),BranchChunk.call(this,[new LeafChunk([new Line("",null)])]),this.first=firstLine,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=makeHistory(),this.cleanGeneration=1,this.frontier=firstLine;var start=Pos(firstLine,0);this.sel={from:start,to:start,head:start,anchor:start,shift:!1,extend:!1,goalColumn:null},this.id=++nextDocId,this.modeOption=mode,"string"==typeof text&&(text=splitLines(text)),updateDoc(this,{from:start,to:start,text:text},null,{head:start,anchor:start})};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(from,to,op){op?this.iterN(from-this.first,to-from,op):this.iterN(this.first,this.first+this.size,from)},insert:function(at,lines){for(var height=0,i=0,e=lines.length;e>i;++i)height+=lines[i].height;this.insertInner(at-this.first,lines,height)},remove:function(at,n){this.removeInner(at-this.first,n)},getValue:function(lineSep){var lines=getLines(this,this.first,this.first+this.size);return lineSep===!1?lines:lines.join(lineSep||"\n")},setValue:function(code){var top=Pos(this.first,0),last=this.first+this.size-1;makeChange(this,{from:top,to:Pos(last,getLine(this,last).text.length),text:splitLines(code),origin:"setValue"},{head:top,anchor:top},!0)},replaceRange:function(code,from,to,origin){from=clipPos(this,from),to=to?clipPos(this,to):from,replaceRange(this,code,from,to,origin)},getRange:function(from,to,lineSep){var lines=getBetween(this,clipPos(this,from),clipPos(this,to));return lineSep===!1?lines:lines.join(lineSep||"\n")},getLine:function(line){var l=this.getLineHandle(line);return l&&l.text},setLine:function(line,text){isLine(this,line)&&replaceRange(this,text,Pos(line,0),clipPos(this,Pos(line)))},removeLine:function(line){line?replaceRange(this,"",clipPos(this,Pos(line-1)),clipPos(this,Pos(line))):replaceRange(this,"",Pos(0,0),clipPos(this,Pos(1,0)))},getLineHandle:function(line){return isLine(this,line)?getLine(this,line):void 0},getLineNumber:function(line){return lineNo(line)},getLineHandleVisualStart:function(line){return"number"==typeof line&&(line=getLine(this,line)),visualLine(this,line)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(pos){return clipPos(this,pos)},getCursor:function(start){var pos,sel=this.sel;return pos=null==start||"head"==start?sel.head:"anchor"==start?sel.anchor:"end"==start||start===!1?sel.to:sel.from,copyPos(pos)},somethingSelected:function(){return!posEq(this.sel.head,this.sel.anchor)},setCursor:docOperation(function(line,ch,extend){var pos=clipPos(this,"number"==typeof line?Pos(line,ch||0):line);extend?extendSelection(this,pos):setSelection(this,pos,pos)}),setSelection:docOperation(function(anchor,head,bias){setSelection(this,clipPos(this,anchor),clipPos(this,head||anchor),bias)}),extendSelection:docOperation(function(from,to,bias){extendSelection(this,clipPos(this,from),to&&clipPos(this,to),bias)}),getSelection:function(lineSep){return this.getRange(this.sel.from,this.sel.to,lineSep)},replaceSelection:function(code,collapse,origin){makeChange(this,{from:this.sel.from,to:this.sel.to,text:splitLines(code),origin:origin},collapse||"around")},undo:docOperation(function(){makeChangeFromHistory(this,"undo")}),redo:docOperation(function(){makeChangeFromHistory(this,"redo")}),setExtending:function(val){this.sel.extend=val},historySize:function(){var hist=this.history;return{undo:hist.done.length,redo:hist.undone.length}},clearHistory:function(){this.history=makeHistory(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration()},changeGeneration:function(){return this.history.lastOp=this.history.lastOrigin=null,this.history.generation},isClean:function(gen){return this.history.generation==(gen||this.cleanGeneration)},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(histData){var hist=this.history=makeHistory(this.history.maxGeneration);hist.done=histData.done.slice(0),hist.undone=histData.undone.slice(0)},markText:function(from,to,options){return markText(this,clipPos(this,from),clipPos(this,to),options,"range")},setBookmark:function(pos,options){var realOpts={replacedWith:options&&(null==options.nodeType?options.widget:options),insertLeft:options&&options.insertLeft};return pos=clipPos(this,pos),markText(this,pos,pos,realOpts,"bookmark")},findMarksAt:function(pos){pos=clipPos(this,pos);var markers=[],spans=getLine(this,pos.line).markedSpans;if(spans)for(var i=0;i<spans.length;++i){var span=spans[i];(null==span.from||span.from<=pos.ch)&&(null==span.to||span.to>=pos.ch)&&markers.push(span.marker.parent||span.marker)}return markers},getAllMarks:function(){var markers=[];return this.iter(function(line){var sps=line.markedSpans;if(sps)for(var i=0;i<sps.length;++i)null!=sps[i].from&&markers.push(sps[i].marker)}),markers},posFromIndex:function(off){var ch,lineNo=this.first;return this.iter(function(line){var sz=line.text.length+1;return sz>off?(ch=off,!0):(off-=sz,void++lineNo)}),clipPos(this,Pos(lineNo,ch))},indexFromPos:function(coords){coords=clipPos(this,coords);var index=coords.ch;return coords.line<this.first||coords.ch<0?0:(this.iter(this.first,coords.line,function(line){index+=line.text.length+1}),index)},copy:function(copyHistory){var doc=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first);return doc.scrollTop=this.scrollTop,doc.scrollLeft=this.scrollLeft,doc.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},copyHistory&&(doc.history.undoDepth=this.history.undoDepth,doc.setHistory(this.getHistory())),doc},linkedDoc:function(options){options||(options={});var from=this.first,to=this.first+this.size;null!=options.from&&options.from>from&&(from=options.from),null!=options.to&&options.to<to&&(to=options.to);var copy=new Doc(getLines(this,from,to),options.mode||this.modeOption,from);return options.sharedHist&&(copy.history=this.history),(this.linked||(this.linked=[])).push({doc:copy,sharedHist:options.sharedHist}),copy.linked=[{doc:this,isParent:!0,sharedHist:options.sharedHist}],copy},unlinkDoc:function(other){if(other instanceof CodeMirror&&(other=other.doc),this.linked)for(var i=0;i<this.linked.length;++i){var link=this.linked[i];if(link.doc==other){this.linked.splice(i,1),other.unlinkDoc(this);break}}if(other.history==this.history){var splitIds=[other.id];linkedDocs(other,function(doc){splitIds.push(doc.id)},!0),other.history=makeHistory(),other.history.done=copyHistoryArray(this.history.done,splitIds),other.history.undone=copyHistoryArray(this.history.undone,splitIds)}},iterLinkedDocs:function(f){linkedDocs(this,f)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Doc.prototype.eachLine=Doc.prototype.iter;var dontDelegate="iter insert remove copy getEditor".split(" ");for(var prop in Doc.prototype)Doc.prototype.hasOwnProperty(prop)&&indexOf(dontDelegate,prop)<0&&(CodeMirror.prototype[prop]=function(method){return function(){return method.apply(this.doc,arguments)}}(Doc.prototype[prop]));eventMixin(Doc),CodeMirror.e_stop=e_stop,CodeMirror.e_preventDefault=e_preventDefault,CodeMirror.e_stopPropagation=e_stopPropagation;var delayedCallbacks,delayedCallbackDepth=0;CodeMirror.on=on,CodeMirror.off=off,CodeMirror.signal=signal;var scrollerCutOff=30,Pass=CodeMirror.Pass={toString:function(){return"CodeMirror.Pass"}};Delayed.prototype={set:function(ms,f){clearTimeout(this.id),this.id=setTimeout(f,ms)}},CodeMirror.countColumn=countColumn;var spaceStrs=[""],nonASCIISingleCaseWordChar=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,isExtendingChar=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;CodeMirror.replaceGetRect=function(f){getRect=f};var dragAndDrop=function(){if(ie_lt9)return!1;var div=elt("div");return"draggable"in div||"dragDrop"in div}();gecko?spanAffectsWrapping=function(str,i){return 36==str.charCodeAt(i-1)&&39==str.charCodeAt(i)}:safari&&!/Version\/([6-9]|\d\d)\b/.test(navigator.userAgent)?spanAffectsWrapping=function(str,i){return/\-[^ \-?]|\?[^ !\'\"\),.\-\/:;\?\]\}]/.test(str.slice(i-1,i+1))}:webkit&&/Chrome\/(?:29|[3-9]\d|\d\d\d)\./.test(navigator.userAgent)?spanAffectsWrapping=function(str,i){var code=str.charCodeAt(i-1);return code>=8208&&8212>=code}:webkit&&(spanAffectsWrapping=function(str,i){if(i>1&&45==str.charCodeAt(i-1)){if(/\w/.test(str.charAt(i-2))&&/[^\-?\.]/.test(str.charAt(i)))return!0;if(i>2&&/[\d\.,]/.test(str.charAt(i-2))&&/[\d\.,]/.test(str.charAt(i)))return!1}return/[~!#%&*)=+}\]\\|\"\.>,:;][({[<]|-[^\-?\.\u2010-\u201f\u2026]|\?[\w~`@#$%\^&*(_=+{[|><]|[\w~`@#$%\^&*(_=+{[><]/.test(str.slice(i-1,i+1))});var knownScrollbarWidth,zwspSupported,splitLines=3!="\n\nb".split(/\n/).length?function(string){for(var pos=0,result=[],l=string.length;l>=pos;){var nl=string.indexOf("\n",pos);-1==nl&&(nl=string.length);var line=string.slice(pos,"\r"==string.charAt(nl-1)?nl-1:nl),rt=line.indexOf("\r");-1!=rt?(result.push(line.slice(0,rt)),pos+=rt+1):(result.push(line),pos=nl+1)}return result}:function(string){return string.split(/\r\n?|\n/)};CodeMirror.splitLines=splitLines;var hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd}catch(e){return!1}}:function(te){try{var range=te.ownerDocument.selection.createRange()}catch(e){}return range&&range.parentElement()==te?0!=range.compareEndPoints("StartToEnd",range):!1},hasCopyEvent=function(){var e=elt("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};CodeMirror.keyNames=keyNames,function(){for(var i=0;10>i;i++)keyNames[i+48]=String(i);for(var i=65;90>=i;i++)keyNames[i]=String.fromCharCode(i);for(var i=1;12>=i;i++)keyNames[i+111]=keyNames[i+63235]="F"+i}();var bidiOther,bidiOrdering=function(){function charType(code){return 255>=code?lowTypes.charAt(code):code>=1424&&1524>=code?"R":code>=1536&&1791>=code?arabicTypes.charAt(code-1536):code>=1792&&2220>=code?"r":"L"}var lowTypes="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",arabicTypes="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",bidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,isNeutral=/[stwN]/,isStrong=/[LRr]/,countsAsLeft=/[Lb1n]/,countsAsNum=/[1n]/,outerType="L";return function(str){if(!bidiRE.test(str))return!1;for(var type,len=str.length,types=[],i=0;len>i;++i)types.push(type=charType(str.charCodeAt(i)));for(var i=0,prev=outerType;len>i;++i){var type=types[i];"m"==type?types[i]=prev:prev=type}for(var i=0,cur=outerType;len>i;++i){var type=types[i];"1"==type&&"r"==cur?types[i]="n":isStrong.test(type)&&(cur=type,"r"==type&&(types[i]="R"))}for(var i=1,prev=types[0];len-1>i;++i){var type=types[i];"+"==type&&"1"==prev&&"1"==types[i+1]?types[i]="1":","!=type||prev!=types[i+1]||"1"!=prev&&"n"!=prev||(types[i]=prev),prev=type}for(var i=0;len>i;++i){var type=types[i];if(","==type)types[i]="N";else if("%"==type){for(var end=i+1;len>end&&"%"==types[end];++end);for(var replace=i&&"!"==types[i-1]||len-1>end&&"1"==types[end]?"1":"N",j=i;end>j;++j)types[j]=replace;i=end-1}}for(var i=0,cur=outerType;len>i;++i){var type=types[i];"L"==cur&&"1"==type?types[i]="L":isStrong.test(type)&&(cur=type)}for(var i=0;len>i;++i)if(isNeutral.test(types[i])){for(var end=i+1;len>end&&isNeutral.test(types[end]);++end);for(var before="L"==(i?types[i-1]:outerType),after="L"==(len-1>end?types[end]:outerType),replace=before||after?"L":"R",j=i;end>j;++j)types[j]=replace;i=end-1}for(var m,order=[],i=0;len>i;)if(countsAsLeft.test(types[i])){var start=i;for(++i;len>i&&countsAsLeft.test(types[i]);++i);order.push({from:start,to:i,level:0})}else{var pos=i,at=order.length;for(++i;len>i&&"L"!=types[i];++i);for(var j=pos;i>j;)if(countsAsNum.test(types[j])){j>pos&&order.splice(at,0,{from:pos,to:j,level:1});var nstart=j;for(++j;i>j&&countsAsNum.test(types[j]);++j);order.splice(at,0,{from:nstart,to:j,level:2}),pos=j}else++j;i>pos&&order.splice(at,0,{from:pos,to:i,level:1})}return 1==order[0].level&&(m=str.match(/^\s+/))&&(order[0].from=m[0].length,order.unshift({from:0,to:m[0].length,level:0})),1==lst(order).level&&(m=str.match(/\s+$/))&&(lst(order).to-=m[0].length,order.push({from:len-m[0].length,to:len,level:0})),order[0].level!=lst(order).level&&order.push({from:len,to:len,level:order[0].level}),order}}();return CodeMirror.version="3.19.0",CodeMirror}(),define("codemirror",function(global){return function(){var ret;return ret||global.CodeMirror}}(this)),function(){function findMatchingBracket(cm,where,strict){function scan(line,lineNo,start){if(line.text){var pos=forward?0:line.text.length-1,end=forward?line.text.length:-1;if(line.text.length>maxScanLen)return null;for(null!=start&&(pos=start+d);pos!=end;pos+=d){var ch=line.text.charAt(pos);if(re.test(ch)&&cm.getTokenTypeAt(Pos(lineNo,pos+1))==style){var match=matching[ch];if(">"==match.charAt(1)==forward)stack.push(ch);else{if(stack.pop()!=match.charAt(0))return{pos:pos,match:!1};if(!stack.length)return{pos:pos,match:!0}}}}}}var state=cm.state.matchBrackets,maxScanLen=state&&state.maxScanLineLength||1e4,cur=where||cm.getCursor(),line=cm.getLineHandle(cur.line),pos=cur.ch-1,match=pos>=0&&matching[line.text.charAt(pos)]||matching[line.text.charAt(++pos)];if(!match)return null;var forward=">"==match.charAt(1),d=forward?1:-1;if(strict&&forward!=(pos==cur.ch))return null;for(var found,style=cm.getTokenTypeAt(Pos(cur.line,pos+1)),stack=[line.text.charAt(pos)],re=/[(){}[\]]/,i=cur.line,e=forward?Math.min(i+100,cm.lineCount()):Math.max(-1,i-100);i!=e&&!(found=i==cur.line?scan(line,i,pos):scan(cm.getLineHandle(i),i));i+=d);return{from:Pos(cur.line,pos),to:found&&Pos(i,found.pos),match:found&&found.match,forward:forward}}function matchBrackets(cm,autoclear){var maxHighlightLen=cm.state.matchBrackets.maxHighlightLineLength||1e3,found=findMatchingBracket(cm);if(!(!found||cm.getLine(found.from.line).length>maxHighlightLen||found.to&&cm.getLine(found.to.line).length>maxHighlightLen)){var style=found.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",one=cm.markText(found.from,Pos(found.from.line,found.from.ch+1),{className:style}),two=found.to&&cm.markText(found.to,Pos(found.to.line,found.to.ch+1),{className:style});ie_lt8&&cm.state.focused&&cm.display.input.focus();var clear=function(){cm.operation(function(){one.clear(),two&&two.clear()})};return autoclear?void setTimeout(clear,800):clear}}function doMatchBrackets(cm){cm.operation(function(){currentlyHighlighted&&(currentlyHighlighted(),currentlyHighlighted=null),cm.somethingSelected()||(currentlyHighlighted=matchBrackets(cm,!1))})}var ie_lt8=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),Pos=CodeMirror.Pos,matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},currentlyHighlighted=null;CodeMirror.defineOption("matchBrackets",!1,function(cm,val,old){old&&old!=CodeMirror.Init&&cm.off("cursorActivity",doMatchBrackets),val&&(cm.state.matchBrackets="object"==typeof val?val:{},cm.on("cursorActivity",doMatchBrackets))}),CodeMirror.defineExtension("matchBrackets",function(){matchBrackets(this,!0)}),CodeMirror.defineExtension("findMatchingBracket",function(pos,strict){return findMatchingBracket(this,pos,strict)})}(),define("codemirror.matchbrackets",["codemirror"],function(){}),define("general.components/codearea/qlikview-script-mode-constants",[],function(){var REGEXP_WORD=/[^\s\(\)\"\'\,\+\$\*\-\<\>\=\&\/\!\{\}\;\.\:\@\`\\[\]]/,REGEXP_WORD_SEPARATOR=/[\s\(\)\"\'\,\+\$\*\-\<\>\=\&\/\!\{\}\;\.\:\@\`\\[\]]/;return{REGEXP_WORD:REGEXP_WORD,REGEXP_WORD_SEPARATOR:REGEXP_WORD_SEPARATOR}}),define("general.components/codearea/qlikview-script-mode",["./qlikview-script-mode-constants","codemirror"],function(Constants){var REGEXP_WORD=Constants.REGEXP_WORD;return CodeMirror.defineMode("qlikviewscript",function(codemirrorOptions,modeOptions){function chain(stream,state,f){return state.tokenize=f,f(stream,state)}function nextUntilUnescaped(stream,end){for(var next,escaped=!1;null!=(next=stream.next());){if(next==end&&!escaped)return!1;escaped=!escaped&&"\\"==next}return escaped}function ret(tp,style,cont){return type=tp,content=cont,style}function tokenBase(stream,state){if(stream.eatSpace())return null;type="any";var ch=stream.next();if(isQuoteChar.test(ch))return"["===ch?chain(stream,state,tokenString("]")):chain(stream,state,tokenString(ch));if(/[\[\]{}\(\),;\:]/.test(ch))return ret(ch);if("0"==ch&&stream.eat(/x/i))return stream.eatWhile(/[\da-f]/i),ret("number","number");if(/[\.\d]/.test(ch))return stream.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),!stream.eol()&&(ch=stream.peek(),/[A-z]/.test(ch))?"normaltext":"number";if("/"===ch)return stream.eat("*")?chain(stream,state,tokenComment):stream.eat("/")?(stream.skipToEnd(),"comment"):(stream.eatWhile(isOperatorChar),"operator");if(isOperatorChar.test(ch))return stream.eatWhile(isOperatorChar),ret(ch,"operator");if("$"===ch&&stream.match(/^\(=/,!1,!0))return ret("$");if("$"===ch&&stream.match(/^\((MUST_INCLUDE|INCLUDE)=/i,!1,!0))return ret("$");if("$"===ch&&stream.match(/^\(/,!1,!0))return state.tokenize=tokenDollarContent,ret("$(");stream.eatWhile(REGEXP_WORD);var word=stream.current(),lowerCaseWord=word.toLowerCase();return"rem"===lowerCaseWord?chain(stream,state,tokenRemComment):modeOptions.service.isFunction(lowerCaseWord)&&stream.match(/(^\s*\()/,!1,!0)?ret("function","keyword",lowerCaseWord):modeOptions.service.isField(word)?ret("field","field"):modeOptions.service.isVariable(word)?ret("variable","variable"):modeOptions.service.isKeyword(lowerCaseWord)?ret("keyword","keyword"):"normaltext"}function unquote(text){return text.substr(1,text.length-2)}function tokenString(quote){return function(stream,state){if(!nextUntilUnescaped(stream,quote)&&(state.tokenize=tokenBase,"'"!==quote)){var word=unquote(stream.current(),quote);if(modeOptions.service.isField(word))return ret("field","field");if(modeOptions.service.isVariable(word))return ret("variable","variable")}return ret("string","string")}}function tokenComment(stream,state){for(var ch,maybeEnd=!1;ch=stream.next();){if("/"==ch&&maybeEnd){state.tokenize=tokenBase;break}maybeEnd="*"==ch}return ret("comment","comment")}function tokenRemComment(stream,state){for(var ch;ch=stream.next();)if(";"==ch){state.tokenize=tokenBase;break}return ret("comment","comment")}function tokenDollarContent(stream,state){type="any";var ch=stream.next();if(")"==ch&&(state.tokenize=tokenBase),/[\(\),]/.test(ch))return ret(ch);stream.eatWhile(/[^(),]/);var word=stream.current();return!/^\d/.test(word)&&modeOptions.service.isVariable(word)?ret("variable","variable"):"normaltext"}function Lexical(type,prev,info,pos){this.type=type,this.prev=prev,this.info=info,this.pos=pos}function parse(state,style,type,content,stream){var cc=state.cc;for(cx.state=state,cx.stream=stream,cx.marked=null,cx.cc=cc;;){var combinator=cc.length?cc.pop():statement;if(combinator(type,content)){for(;cc.length&&cc[cc.length-1].lex;)cc.pop()();return cx.marked?cx.marked:style}}}function pass(){for(var i=arguments.length-1;i>=0;i--)cx.cc.push(arguments[i])}function cont(){return pass.apply(null,arguments),!0}function pushlex(type,info){var result=function(){var state=cx.state;state.lexical=new Lexical(type,state.lexical,info,cx.stream.pos)};return result.lex=!0,result}function poplex(){var state=cx.state;state.lexical.prev&&(state.lexical=state.lexical.prev)}function expect(wanted){return function(type){return type==wanted?cont():";"==wanted?pass():cont(arguments.callee)}}function until(what,end){return function proceed(type){return type==end?cont():pass(what,proceed)}}function statement(type){return"function"==type?cont(pushlex("qvfunction",content),expect("("),until(statement,")"),poplex):"("===type?cont(until(statement,")")):"$("===type?cont(expect("("),until(statement,")")):cont()}var type,content,isOperatorChar=/[+\-*&=<>]/,isQuoteChar=/[\u0022\u0027\u0060\u00b4[]/,cx={state:null,column:null,marked:null,cc:null};return poplex.lex=!0,{startState:function(){return{tokenize:tokenBase,lastType:null,cc:[],lexical:new Lexical("block")}},token:function(stream,state){var style=state.tokenize(stream,state);return"comment"==type?style:(state.lastType=type,parse(state,style,type,content,stream))},lineComment:"//"}}),{REGEXP_WORD:REGEXP_WORD}}),define("general.components/codearea/codearea-function-tip",["qvangular","general.services/show-service/show-service"],function(qvangular,showService){
"use strict";qvangular.directive("qvCodeareaFunctionTip",function(){return{restrict:"A",require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){var dialogHandle,timeout,HEIGHT_OF_TOOLTIP=22,stopWatch=$scope.$watch($attrs.qvCodeareaFunctionTip,function(functionTipOptions){function findEnclosingQvFunction(){var pos=qvCodearea.codemirror.getCursor(),token=qvCodearea.codemirror.getTokenAt(pos,!0);if("comment"!==token.type){for(var i=0,lex=token.state.lexical;lex&&"qvfunction"!==lex.type||0===i&&lex.info&&token.string.toLowerCase()===lex.info.toLowerCase();)lex=lex.prev,i++;return lex}return void 0}function updateTip(){var lex=findEnclosingQvFunction(),fn=lex?lex.info:void 0,functionTip=fn?functionTipOptions.service.getFunctionTip(fn):void 0;qvangular.$apply(function(){if(dialogHandle&&dialogHandle.destroy(),functionTip){for(var lineContent,substring,position=qvCodearea.codemirror.getCursor();position.line>=0;){if(lineContent=qvCodearea.codemirror.getLine(position.line).toLowerCase(),substring=lineContent.substring(lex.pos-fn.length,lex.pos),substring===fn){position.ch=lex.pos-fn.length;break}position.line-=1}var offset=qvCodearea.codemirror.charCoords(position);offset.top-=qvCodearea.codemirror.defaultTextHeight()+HEIGHT_OF_TOOLTIP,dialogHandle=showService.show(functionTipOptions.view,{content:functionTip,offset:offset})}})}function onCursorActivity(){clearTimeout(timeout),timeout=setTimeout(updateTip,250)}function onBlur(){dialogHandle&&dialogHandle.destroy()}functionTipOptions&&(qvCodearea.codemirror.on("blur",onBlur),qvCodearea.codemirror.on("cursorActivity",onCursorActivity),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("blur",onBlur),qvCodearea.codemirror.off("cursorActivity",onCursorActivity),dialogHandle&&dialogHandle.destroy()}),stopWatch())},!0)}}})}),define("text!general.components/autocomplete-view/autocomplete-view.ng.html",[],function(){return'<div class="qv-autocomplete-container">\r\n	<ul class="codearea-autocomplete-hints">\r\n		<li ng-repeat="item in state.hints track by item.text"\r\n			qva-scroll-into-view="{ scroll: state.selectedHint == $index, scrollSelector: \'.codearea-autocomplete-hints\' }"\r\n			class="codearea-autocomplete-hint"\r\n			ng-class="{ \'codearea-autocomplete-hint-active\': state.selectedHint == $index }"\r\n			ng-mouseover="state.selectedHint = $index;"\r\n			qva-activate="state.choose( $index )">\r\n\r\n			<div class="codearea-autocomplete-hint-text">{{item.text}}</div>\r\n			<div ng-repeat="type in item.types track by $index"\r\n				 class="codearea-autocomplete-hint-type {{type.id}}"\r\n				 q-translation="{{type.key}}"></div>\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("general.components/autocomplete-view/autocomplete-view",["text!./autocomplete-view.ng.html","jquery"],function(template,$){"use strict";function getPosition(listSize,windowSize,cursorPos){var spaceBelow=cursorPos.bottom+listSize.height<=windowSize.height,top=spaceBelow?cursorPos.bottom:cursorPos.top-listSize.height,moveLeft=Math.max(0,cursorPos.left+listSize.width-windowSize.width),left=cursorPos.left-moveLeft;return{top:top,left:left}}function afterDOMUpdate($scope,callback){$scope.$$postDigest(function(){$scope.$$postDigest(callback)})}return{scope:{state:"="},template:template,controller:["$scope","$element",function($scope,$element){function doPosition(){var windowSize={width:$window.width(),height:$window.height()},listSize=containerElement[0].getBoundingClientRect(),cursorPos=$scope.state.cursorPos,pos=getPosition(listSize,windowSize,cursorPos);containerElement.css({left:pos.left,top:pos.top})}var containerElement=$element.find(".qv-autocomplete-container"),$window=$(window);$scope.$watch("state.hints.length",function(){afterDOMUpdate($scope,doPosition)})}]}}),define("general.components/codearea/codearea-autocomplete",["jquery","qvangular","general.services/show-service/show-service","general.components/autocomplete-view/autocomplete-view","core.utils/resize","general.components/codearea/qlikview-script-mode-constants"],function($,qvangular,showService,autocompleteView,resize,Constants){"use strict";function isAtCompleteToken(cm){var type=cm.getTokenAt(cm.getCursor()).type;return"keyword"===type||"field"===type||"variable"===type}function getAutocompleteInfo(cm,options,state){if(cm.somethingSelected()||isAtCompleteToken(cm)&&!state||options.disabled)return null;var data=options.getHints(cm),hints=data.list;if(0===hints.length)return null;hints.length>MAX_HINTS&&(hints=hints.slice(0,MAX_HINTS));var pos=cm.cursorCoords(options.alignWithWord!==!1?data.from:null);return{from:data.from,to:data.to,hints:hints,selectedHint:state?state.selectedHint:0,cursorPos:pos}}function AutocompleteObject(cm,options){function screenAmount(){return 8}this.dialogHandle=null,this.dialogOptions={},this.state=null,this.options=options,this.cm=cm,this.currentOptions=null,this.once=null,this.closingOnBlur=null,this.bound={cursorActivity:this.cursorActivity.bind(this),pick:this.pick.bind(this),close:this.close.bind(this),onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),choose:this.choose.bind(this),showHint:this.showHint.bind(this)};var that=this;this.ourMap={Up:function(){that.changeActive(that.state.selectedHint-1),qvangular.$rootScope.$apply()},Down:function(){that.changeActive(that.state.selectedHint+1),qvangular.$rootScope.$apply()},PageUp:function(){that.changeActive(that.state.selectedHint-screenAmount()),qvangular.$rootScope.$apply()},PageDown:function(){that.changeActive(that.state.selectedHint+screenAmount()),qvangular.$rootScope.$apply()},Home:function(){that.changeActive(0),qvangular.$rootScope.$apply()},End:function(){that.changeActive(that.state.hints.length-1),qvangular.$rootScope.$apply()},Enter:this.bound.pick,Tab:this.bound.pick,Esc:this.bound.close}}function quoteText(text){return"["+text.replace(/\]/g,"]]")+"]"}function getCompletions(token,keywords){function maybeAdd(keyword){"string"==typeof keyword&&(keyword={text:keyword});var str=keyword.text;if(isQuote){if(!typeInfo[keyword.type]||!typeInfo[keyword.type].allowQuote)return;str=quoteText(str)}str&&0===str.toLowerCase().indexOf(start)&&(found[str]||(found[str]={text:keyword.text,types:[],value:str},result.push(found[str])),typeInfo[keyword.type]&&found[str].types.push({id:keyword.type,key:typeInfo[keyword.type].translation}))}function caseInsensitiveSort(a,b){var aText=a.text.toLowerCase(),bText=b.text.toLowerCase();return aText===bText?0:aText>bText?1:-1}var found={},result=[],start=token.toLowerCase(),isQuote="["===token[0];return!isQuote&&REGEXP_WORD_SEPARATOR.test(token)||/^\d+$/.test(token)?[]:(""!==token&&(keywords.forEach(maybeAdd),result.sort(caseInsensitiveSort)),1===result.length&&token===result[0].value&&(result=[]),result)}function scriptHint(editor,keywords){var cursor=editor.getCursor(),token=editor.getTokenAt(cursor),list=getCompletions(token.string,keywords);return{list:list,from:{line:cursor.line,ch:token.start},to:{line:cursor.line,ch:token.end}}}var $timeout=qvangular.getService("$timeout"),MAX_HINTS=100,REGEXP_WORD_SEPARATOR=Constants.REGEXP_WORD_SEPARATOR;AutocompleteObject.prototype.cursorActivity=function(){$timeout.cancel(this.once),this.once=null;var p=this.cm.getCursor();p.line!==this.startLine||this.cm.somethingSelected()?this.close():this.once=$timeout(this.bound.showHint,70)},AutocompleteObject.prototype.choose=function(i){this.changeActive(i),this.pick()},AutocompleteObject.prototype.pick=function(){this.cm.replaceRange(this.state.hints[this.state.selectedHint].value,this.state.from,this.state.to),this.close(),qvangular.$apply(qvangular.$rootScope)},AutocompleteObject.prototype.onBlur=function(){this.closingOnBlur=$timeout(this.bound.close,300)},AutocompleteObject.prototype.onFocus=function(){$timeout.cancel(this.closingOnBlur),this.closingOnBlur=null},AutocompleteObject.prototype.changeActive=function(i){this.state&&(i=Math.max(0,Math.min(i,this.state.hints.length-1)),this.state.selectedHint!==i&&(this.state.selectedHint=i))},AutocompleteObject.prototype.close=function(){$timeout.cancel(this.once),$timeout.cancel(this.startTimeout),this.dialogHandle&&(this.dialogHandle.destroy(),this.dialogHandle=null,this.cm.removeKeyMap(this.ourMap),this.cm.off("cursorActivity",this.bound.cursorActivity),this.cm.off("blur",this.bound.onBlur),this.cm.off("focus",this.bound.onFocus),this.cm.off("scroll",this.bound.close),this.state=null,qvangular.$apply(qvangular.$rootScope))},AutocompleteObject.prototype.open=function(){this.dialogHandle=showService.show(this.options.view,this.dialogOptions),this.startLine=this.cm.getCursor().line,this.cm.addKeyMap(this.ourMap),this.cm.on("cursorActivity",this.bound.cursorActivity),this.cm.on("blur",this.bound.onBlur),this.cm.on("focus",this.bound.onFocus),this.cm.on("scroll",this.bound.close)},AutocompleteObject.prototype.showHint=function(){var oldState=this.state;return this.state=getAutocompleteInfo(this.cm,this.options,oldState),this.state?(this.state.choose=this.bound.choose,this.dialogOptions.state=this.state,void(oldState||this.open())):void(oldState&&this.close())},AutocompleteObject.prototype.start=function(){this.state||(this.startTimeout&&$timeout.cancel(this.startTimeout),this.startTimeout=$timeout(this.bound.showHint,500))};var typeInfo={keyword:{translation:"Common.Keyword",allowQuote:!1},variable:{translation:"Common.Variable",allowQuote:!0},field:{translation:"Common.Field",allowQuote:!0},"function":{translation:"Common.Function",allowQuote:!1}};return qvangular.directive("qvCodeareaAutocomplete",function(){return{restrict:"A",require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){var autocompleteIgnoreKeys=[37,38,39,40,33,34,27],stopWatch=$scope.$watch($attrs.qvCodeareaAutocomplete,function(autocompleteOptions){function qlikviewscriptHint(editor){return scriptHint(editor,autocompleteOptions.service.getAutocompleteList())}function updateTip(){auto.start()}function onKeyup(event,key){-1===$.inArray(key.which,autocompleteIgnoreKeys)&&updateTip()}if(autocompleteOptions){autocompleteOptions.view||(autocompleteOptions.view=autocompleteView),autocompleteOptions.getHints||(autocompleteOptions.getHints=qlikviewscriptHint);var auto=new AutocompleteObject(qvCodearea.codemirror,autocompleteOptions),closeFn=auto.close.bind(auto);qvCodearea.codemirror.on("focus",updateTip),qvCodearea.codemirror.on("keyup",onKeyup),resize.off("end",closeFn),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("focus",updateTip),qvCodearea.codemirror.off("keyup",onKeyup),resize.on("end",closeFn),auto.close()}),stopWatch()}},!0)}}}),{getCompletions:getCompletions}}),define("general.components/codearea/search-cursor",["codemirror"],function(CodeMirror){function SearchCursor(cm,query,pos,caseFold){if(this.atOccurrence=!1,this.cm=cm,null==caseFold&&"string"==typeof query&&(caseFold=!0),pos=pos?cm.clipPos(pos):Pos(0,0),this.pos={from:pos,to:pos},query||(query=""),"string"!=typeof query)query.global||(query=new RegExp(query.source,query.ignoreCase?"ig":"g")),this.matches=function(reverse,pos){var line,match,start;if(reverse){for(query.lastIndex=0,line=cm.getLine(pos.line).slice(0,pos.ch),match=query.exec(line),start=0;match;){start+=match.index+1,line=line.slice(start),query.lastIndex=0;var newmatch=query.exec(line);if(!newmatch)break;match=newmatch}start--}else query.lastIndex=pos.ch,line=cm.getLine(pos.line),match=query.exec(line),start=match&&match.index;return match&&match[0]?{from:Pos(pos.line,start),to:Pos(pos.line,start+match[0].length),match:match}:void 0};else{caseFold&&(query=query.toLowerCase());var fold=caseFold?function(str){return str.toLowerCase()}:function(str){return str},target=query.split("\n");1==target.length?query.length?this.matches=function(reverse,pos){var match,line=fold(cm.getLine(pos.line)),len=query.length;return(reverse?pos.ch>=len&&-1!=(match=line.lastIndexOf(query,pos.ch-len)):-1!=(match=line.indexOf(query,pos.ch)))?{from:Pos(pos.line,match),to:Pos(pos.line,match+len)}:void 0}:this.matches=function(){}:this.matches=function(reverse,pos){var ln=pos.line,idx=reverse?target.length-1:0,match=target[idx],line=fold(cm.getLine(ln)),offsetA=reverse?line.indexOf(match)+match.length:line.lastIndexOf(match);if(!(reverse?offsetA>=pos.ch||offsetA!=match.length:offsetA<=pos.ch||offsetA!=line.length-match.length))for(;;){if(reverse?!ln:ln==cm.lineCount()-1)return;if(line=fold(cm.getLine(ln+=reverse?-1:1)),match=target[reverse?--idx:++idx],!(idx>0&&idx<target.length-1)){var offsetB=reverse?line.lastIndexOf(match):line.indexOf(match)+match.length;if(reverse?offsetB!=line.length-match.length:offsetB!=match.length)return;var start=Pos(pos.line,offsetA),end=Pos(ln,offsetB);return{from:reverse?end:start,to:reverse?start:end}}if(line!=match)return}}}}function getSearchCursor(codemirror,query,pos,caseFold){return new SearchCursor(codemirror,query,pos,caseFold)}var Pos=CodeMirror.Pos;return SearchCursor.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(reverse){function savePosAndFail(line){var p=Pos(line,0);return self.pos={from:p,to:p},self.atOccurrence=!1,!1}for(var self=this,pos=this.cm.clipPos(reverse?this.pos.from:this.pos.to);;){if(this.pos=this.matches(reverse,pos))return this.pos.from&&this.pos.to||window.console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(reverse){if(!pos.line)return savePosAndFail(0);pos=Pos(pos.line-1,this.cm.getLine(pos.line-1).length)}else{var maxLine=this.cm.lineCount();if(pos.line==maxLine-1)return savePosAndFail(maxLine);pos=Pos(pos.line+1,0)}}},from:function(){return this.atOccurrence?this.pos.from:void 0},to:function(){return this.atOccurrence?this.pos.to:void 0},replace:function(newText){if(this.atOccurrence){var lines=CodeMirror.splitLines(newText);this.cm.replaceRange(lines,this.pos.from,this.pos.to),this.pos.to=Pos(this.pos.from.line+lines.length-1,lines[lines.length-1].length+(1==lines.length?this.pos.from.ch:0))}}},{getSearchCursor:getSearchCursor}}),define("scripteditor.utils/string-util",["jquery"],function(){"use strict";function isValidConnectionName(string){var reg=/^[^\\/:*?\"<>|\x00-\x1f]+$/;return"undefined"!=typeof string&&reg.test(string)&&string.length>=_MIN_CONNECTION_NAME_LENGTH&&string.length<=_MAX_CONNECTION_NAME_LENGTH}function _isValidFieldName(name){return!/[\\\*\?"\(\)<>\|' &\$\^\/+\-]+/.test(name)}function isValidUrl(url){return/^(ftp|http|https):\/\/[^ "]+$/.test(url.toLowerCase())}function prefixHttpToUrl(url){return/^.*:\/\//.test(url)?url:"http://"+url}function startsWith(string,prefix){return 0===string.indexOf(prefix)}function endsWith(string,suffix){return-1!==string.indexOf(suffix,string.length-suffix.length)}function arrayToString(array,delimiter){return delimiter||(delimiter=""),array.length>0?array.reduce(function(a,b){return a+delimiter+b}):""}function connectionStringToArray(connectionString){var innerPart=connectionString.replace(/.*\[|\]/gi,""),connArr=innerPart.match(/"[^=]*"|[^;]+/g);return connArr}function getValueFromConnectionString(connectionString,key){var i,connArr=connectionStringToArray(connectionString);if(connArr)for(i=0;i<connArr.length;i++)if(-1!==connArr[i].toLowerCase().indexOf(key.toLowerCase()))return connArr[i].split("=")[1];return""}function combinePath(path,filename){function removeDoubleSlashes(){return(path+"\\"+filename).replace("\\\\","\\")}function uncPath(){return"\\\\"===path.substring(0,2)?"\\"+removeDoubleSlashes():void 0}return uncPath()||removeDoubleSlashes()}function tokenizeConnectionString(connectionString){var pair,connArr=connectionStringToArray(connectionString),resultArr=[];return connArr&&connArr.forEach(function(token){pair=token.split("="),pair&&resultArr.push({key:pair[0],value:pair.length>1?pair[1]:""})}),resultArr}function removeSurroundingSlashes(path){return"\\"===path.charAt(0)&&(path=path.substring(1)),"\\"===path.charAt(path.length-1)&&(path=path.slice(0,-1)),path}function formatDirectoryPathForEngine(path){return"\\"!==path.charAt(path.length-1)&&(path+="\\"),path}function goUpOneFolderLevel(path){var pathitems;return"\\\\"===path.substring(0,2)?(pathitems=removeSurroundingSlashes(path.substring(2)).split("\\"),pathitems.pop(),"\\\\"+arrayToString(pathitems,"\\")):(pathitems=removeSurroundingSlashes(path).split("\\"),pathitems.pop(),arrayToString(pathitems,"\\"))}function expandNumbersForNaturalSorting(str){return str.replace(/[0-9]+/g,function(numberString){var len=numberString.length,lenString=""+len,pad="000",paddedLength=pad.substring(0,pad.length-lenString.length)+lenString;return paddedLength+""+numberString})}function _sortSlightlyMoreNaturallyArray(array,propertyName){array.sort(function(a,b){return _sortSlightlyMoreNaturallySingle(a[propertyName],b[propertyName])})}function _sortSlightlyMoreNaturallySingle(a,b){var aa=expandNumbersForNaturalSorting(a).toLowerCase(),bb=expandNumbersForNaturalSorting(b).toLowerCase();return aa.localeCompare(bb)}function contains(haystack,needle){if(!haystack)throw new Error("Haystack is undefined.");if(!needle)throw new Error("Needle is undefined.");return-1!==haystack.indexOf(needle)}function occurrencesRE(string,subStringQuery){if(string+="",subStringQuery+="",!subStringQuery)return 0;var isRE=subStringQuery.match(/^\/(.*)\/([a-z]*)$/);if(!isRE){string=string.toLowerCase(),subStringQuery=subStringQuery.toLowerCase();for(var n=0,pos=0,step=subStringQuery.length;;){if(pos=string.indexOf(subStringQuery,pos),!(pos>=0))break;n++,pos+=step}return n}try{var query=new RegExp(isRE[1],-1===isRE[2].indexOf("i")?"":"i");return string.split(query).length-1}catch(error){return 0}}function fileNameFromPath(filePath){return filePath.substring(filePath.lastIndexOf("\\")+1,filePath.length)}function fileDirectoryFromPath(filePath){return filePath.substring(0,filePath.lastIndexOf("\\")+1)}function lastFolderFromPath(filePath){var match=filePath.match(/.*\\(.*)\\.*$/);return match||(match=filePath.match(/^(.*)\\.*$/)),match?match[1]:null}var _MIN_CONNECTION_NAME_LENGTH=1,_MAX_CONNECTION_NAME_LENGTH=256,exports={MIN_CONNECTION_NAME_LENGTH:_MIN_CONNECTION_NAME_LENGTH,MAX_CONNECTION_NAME_LENGTH:_MAX_CONNECTION_NAME_LENGTH,isValidConnectionName:isValidConnectionName,isValidFieldName:_isValidFieldName,isValidUrl:isValidUrl,prefixHttpToUrl:prefixHttpToUrl,endsWith:endsWith,startsWith:startsWith,goUpOneFolderLevel:goUpOneFolderLevel,removeSurroundingSlashes:removeSurroundingSlashes,arrayToString:arrayToString,formatDirectoryPathForEngine:formatDirectoryPathForEngine,sortSlightlyMoreNaturallyArray:_sortSlightlyMoreNaturallyArray,sortSlightlyMoreNaturallySingle:_sortSlightlyMoreNaturallySingle,_expandNumbersForNaturalSorting:expandNumbersForNaturalSorting,getValueFromConnectionString:getValueFromConnectionString,tokenizeConnectionString:tokenizeConnectionString,contains:contains,occurrencesRE:occurrencesRE,combinePath:combinePath,fileNameFromPath:fileNameFromPath,fileDirectoryFromPath:fileDirectoryFromPath,lastFolderFromPath:lastFolderFromPath};return exports}),define("general.components/codearea/search-util",["scripteditor.utils/string-util"],function(stringUtil){"use strict";function _getMaxNumberOfHits(stringToSearch,query){var allHits=stringUtil.occurrencesRE(stringToSearch,query),nbrOfHits=allHits>=_MAX_NBR_OF_HITS?_MAX_NBR_OF_HITS:allHits;return nbrOfHits}var _MAX_NBR_OF_HITS=2e3;return{MAX_NBR_OF_HITS:_MAX_NBR_OF_HITS,getMaxNumberOfHits:_getMaxNumberOfHits}}),define("general.components/codearea/searcher",["./search-cursor","./search-util"],function(searchCursorFactory,searchUtil){"use strict";function SearchState(){this.posFrom=this.posTo=this.query=null,this.marked=[]}function createSingleCodeareaSearcher(editor){function getSearchCursor(query,pos){return searchCursorFactory.getSearchCursor(editor,query,pos)}function parseQuery(query){codeSearcher.validQuery=!0;var isRE=!1;try{return isRE?new RegExp(isRE[1],-1===isRE[2].indexOf("i")?"":"i"):query}catch(error){return codeSearcher.validQuery=!1,query}}function clearMarkedSearch(){editor.operation(function(){var i;if(state.query){for(state.query=null,i=0;i<state.marked.length;++i)state.marked[i].clear();state.marked.length=0}}),removeCurrentSelection()}function doSearch(str){var MAX_LINES_TO_MARK=2e3,nbrOfHits=0;return clearMarkedSearch(),str?(editor.operation(function(){if(state.query=parseQuery(str),cursor=getSearchCursor(state.query,{line:0,ch:0}),nbrOfHits=searchUtil.getMaxNumberOfHits(editor.getValue(),str),editor.lineCount()<MAX_LINES_TO_MARK)for(;cursor.findNext();)state.marked.push(editor.markText(cursor.from(),cursor.to(),{className:"cm-searching"}));state.posFrom=state.posTo=editor.getCursor(),cursor=getSearchCursor(state.query,{line:0,ch:0})}),doFindNext(),codeSearcher.hits=nbrOfHits,nbrOfHits):(codeSearcher.hits=0,0)}function removeCurrentSelection(){current&&current.clear()}function setSelection(){removeCurrentSelection(),current=editor.markText(cursor.from(),cursor.to(),{className:"cm-current"}),state.posFrom=cursor.from(),state.posTo=cursor.to()}function doFindNext(rev,overflowFn){var found=cursor.find(rev);return found?setSelection():overflowFn&&overflowFn(),found}function doFindFirst(){return cursor=getSearchCursor(state.query,{line:0,ch:0}),doFindNext(!1)}function doFindLast(){var lastLine=editor.lastLine(),lastChar=editor.getLine(lastLine).length;return cursor=getSearchCursor(state.query,{line:lastLine,ch:lastChar}),doFindNext(!0)}function doReplace(rev,text,overflowFn){var replacement="string"==typeof state.query?text:cursor.pos.match[0].replace(state.query,text);cursor.replace(replacement),codeSearcher.hits--;var found=cursor.find(rev);found?setSelection():overflowFn&&overflowFn()}function doReplaceAll(query,text){if(query){var totalReplaced=0;return query=parseQuery(query),editor.operation(function(){for(cursor=getSearchCursor(query);cursor.findNext();){totalReplaced++;var replacement="string"==typeof state.query?text:cursor.pos.match[0].replace(state.query,text);cursor.replace(replacement)}}),codeSearcher.hits=0,totalReplaced}}var cursor,current,state=new SearchState,codeSearcher={doSearch:doSearch,clearMarkedSearch:clearMarkedSearch,doFindNext:doFindNext,doFindFirst:doFindFirst,doFindLast:doFindLast,doReplaceAll:doReplaceAll,doReplace:doReplace,hits:0,validQuery:!0};return codeSearcher}return{createSingleCodeareaSearcher:createSingleCodeareaSearcher}}),function(){"use strict";function firstNonWS(str){var found=str.search(nonWS);return-1==found?0:found}var noOptions={},nonWS=/[^\s\u00a0]/,Pos=CodeMirror.Pos;CodeMirror.commands.toggleComment=function(cm){var from=cm.getCursor("start"),to=cm.getCursor("end");cm.uncomment(from,to)||cm.lineComment(from,to)},CodeMirror.defineExtension("lineComment",function(from,to,options){options||(options=noOptions);var self=this,mode=self.getModeAt(from),commentString=options.lineComment||mode.lineComment;if(!commentString)return void((options.blockCommentStart||mode.blockCommentStart)&&(options.fullLines=!0,self.blockComment(from,to,options)));var firstLine=self.getLine(from.line);if(null!=firstLine){var end=Math.min(0!=to.ch||to.line==from.line?to.line+1:to.line,self.lastLine()+1),pad=null==options.padding?" ":options.padding,blankLines=options.commentBlankLines||from.line==to.line;self.operation(function(){if(options.indent)for(var baseString=firstLine.slice(0,firstNonWS(firstLine)),i=from.line;end>i;++i){var line=self.getLine(i),cut=baseString.length;(blankLines||nonWS.test(line))&&(line.slice(0,cut)!=baseString&&(cut=firstNonWS(line)),self.replaceRange(baseString+commentString+pad,Pos(i,0),Pos(i,cut)))}else for(var i=from.line;end>i;++i)(blankLines||nonWS.test(self.getLine(i)))&&self.replaceRange(commentString+pad,Pos(i,0))})}}),CodeMirror.defineExtension("blockComment",function(from,to,options){options||(options=noOptions);var self=this,mode=self.getModeAt(from),startString=options.blockCommentStart||mode.blockCommentStart,endString=options.blockCommentEnd||mode.blockCommentEnd;if(!startString||!endString)return void((options.lineComment||mode.lineComment)&&0!=options.fullLines&&self.lineComment(from,to,options));var end=Math.min(to.line,self.lastLine());end!=from.line&&0==to.ch&&nonWS.test(self.getLine(end))&&--end;var pad=null==options.padding?" ":options.padding;from.line>end||self.operation(function(){if(0!=options.fullLines){var lastLineHasText=nonWS.test(self.getLine(end));self.replaceRange(pad+endString,Pos(end)),self.replaceRange(startString+pad,Pos(from.line,0));var lead=options.blockCommentLead||mode.blockCommentLead;if(null!=lead)for(var i=from.line+1;end>=i;++i)(i!=end||lastLineHasText)&&self.replaceRange(lead+pad,Pos(i,0))}else self.replaceRange(endString,to),self.replaceRange(startString,from)})}),CodeMirror.defineExtension("uncomment",function(from,to,options){options||(options=noOptions);var didSomething,self=this,mode=self.getModeAt(from),end=Math.min(to.line,self.lastLine()),start=Math.min(from.line,end),lineString=options.lineComment||mode.lineComment,lines=[],pad=null==options.padding?" ":options.padding;lineComment:if(lineString){for(var i=start;end>=i;++i){var line=self.getLine(i),found=line.indexOf(lineString);if(-1==found&&(i!=end||i==start)&&nonWS.test(line))break lineComment;if(found>-1&&nonWS.test(line.slice(0,found)))break lineComment;lines.push(line)}if(self.operation(function(){for(var i=start;end>=i;++i){var line=lines[i-start],pos=line.indexOf(lineString),endPos=pos+lineString.length;0>pos||(line.slice(endPos,endPos+pad.length)==pad&&(endPos+=pad.length),didSomething=!0,self.replaceRange("",Pos(i,pos),Pos(i,endPos)))}}),didSomething)return!0}var startString=options.blockCommentStart||mode.blockCommentStart,endString=options.blockCommentEnd||mode.blockCommentEnd;if(!startString||!endString)return!1;var lead=options.blockCommentLead||mode.blockCommentLead,startLine=self.getLine(start),endLine=end==start?startLine:self.getLine(end),open=startLine.indexOf(startString),close=endLine.lastIndexOf(endString);return-1==close&&start!=end&&(endLine=self.getLine(--end),close=endLine.lastIndexOf(endString)),-1==open||-1==close?!1:(self.operation(function(){self.replaceRange("",Pos(end,close-(pad&&endLine.slice(close-pad.length,close)==pad?pad.length:0)),Pos(end,close+endString.length));var openEnd=open+startString.length;if(pad&&startLine.slice(openEnd,openEnd+pad.length)==pad&&(openEnd+=pad.length),self.replaceRange("",Pos(start,open),Pos(start,openEnd)),lead)for(var i=start+1;end>=i;++i){var line=self.getLine(i),found=line.indexOf(lead);if(-1!=found&&!nonWS.test(line.slice(0,found))){var foundEnd=found+lead.length;pad&&line.slice(foundEnd,foundEnd+pad.length)==pad&&(foundEnd+=pad.length),self.replaceRange("",Pos(i,found),Pos(i,foundEnd))}}}),!0)})}(),define("codemirror.comment",["codemirror"],function(){}),define("general.components/codearea/codearea-exposed-context-api",["qvangular","codemirror","codemirror.comment"],function(qvangular,CodeMirror){var NEW_LINE="\r\n";qvangular.directive("qvCodeareaExposedContextApi",["$parse","$timeout",function($parse,$timeout){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function($scope,$element,$attrs,controllers){var qvCodeArea=controllers[0],exposedApi=controllers[1];exposedApi._connectCodeArea(qvCodeArea);var gettersetter=$parse($attrs.qvCodeareaExposedContextApi);gettersetter.assign($scope,exposedApi),$scope.$on("$destroy",function(){gettersetter.assign($scope,void 0),exposedApi._connectCodeArea(void 0)})},controller:function(){function _connectCodeArea(codearea){qvCodearea=codearea}function getFunctionNameUnderCursor(){for(var token=qvCodearea.codemirror.getTokenAt(qvCodearea.codemirror.getCursor()),i=0,lex=token.state.lexical;lex&&"qvfunction"!==lex.type||0===i&&lex.info&&token.string.toLowerCase()===lex.info.toLowerCase();)lex=lex.prev,i++;return lex?lex.info:!1}function focus(){qvCodearea.focus()}function undo(){qvCodearea.codemirror.undo()}function redo(){qvCodearea.codemirror.redo()}function comment(){CodeMirror.commands.toggleComment(qvCodearea.codemirror),focus()}function indent(){qvCodearea.codemirror.indentSelection("add"),focus()}function outdent(){qvCodearea.codemirror.indentSelection("subtract"),focus()}function applyToSelection(fn){var selection=qvCodearea.codemirror.getDoc().getSelection(),result=fn(selection);qvCodearea.codemirror.replaceSelection(result)}function insertCode(text){qvCodearea.codemirror.setCursor(qvCodearea.codemirror.getCursor("end"));var lineNbr=qvCodearea.codemirror.getCursor().line,charNbr=qvCodearea.codemirror.getCursor().ch,lineLength=qvCodearea.codemirror.getLine(lineNbr).length;lineLength>0&&(charNbr===lineLength?(qvCodearea.codemirror.setCursor(lineNbr,lineLength),qvCodearea.codemirror.replaceSelection(NEW_LINE)):(qvCodearea.codemirror.setCursor(qvCodearea.codemirror.lineCount(),0),text=NEW_LINE+NEW_LINE+text)),qvCodearea.codemirror.setCursor(qvCodearea.codemirror.getCursor("end")),qvCodearea.codemirror.replaceSelection(text),qvCodearea.focus()}function replaceSelection(text){qvCodearea.codemirror.replaceSelection(text,"end"),qvCodearea.focus()}function gotoLine(lineNbr){$timeout(function(){var lineCount=qvCodearea.codemirror.lineCount();lineCount>lineNbr?qvCodearea.codemirror.setCursor(lineNbr-1,0):qvCodearea.codemirror.setCursor(lineCount-2,0),qvCodearea.focus()})}var qvCodearea,codeareaContextApi={applyToSelection:applyToSelection,focus:focus,undo:undo,redo:redo,comment:comment,indent:indent,outdent:outdent,insertCode:insertCode,replaceSelection:replaceSelection,getFunctionNameUnderCursor:getFunctionNameUnderCursor,gotoLine:gotoLine,_connectCodeArea:_connectCodeArea,codemirror:void 0};return Object.defineProperty(codeareaContextApi,"canUndo",{get:function(){return qvCodearea&&qvCodearea.codemirror&&qvCodearea.codemirror.historySize().undo>0},enumerable:!0}),Object.defineProperty(codeareaContextApi,"canRedo",{get:function(){return qvCodearea&&qvCodearea.codemirror&&qvCodearea.codemirror.historySize().redo>0},enumerable:!0}),codeareaContextApi}}}])}),define("general.components/codearea/codearea-exposed-touch-api",["jquery","qvangular"],function($,qvangular){function diff(targetContent,newContent){var i,targetContentLength=targetContent.length,newContentLength=newContent.length,len=Math.min(targetContent.length,newContent.length);for(i=0;len>i&&targetContent.charAt(i)===newContent.charAt(i);i++);if(i===targetContent.length&&i===newContent.length)return void 0;var targetIndex,sourceIndex,first=i;for(i=0;len>i&&(targetIndex=targetContentLength-i-1,sourceIndex=newContentLength-i-1,!(first>targetIndex||first>sourceIndex))&&targetContent.charAt(targetContentLength-i-1)===newContent.charAt(newContentLength-i-1);i++);var lastDiffingInTarget=targetContentLength-i-1,lastDiffingInNew=newContentLength-i-1;return{start:first,targetRange:{from:first,to:lastDiffingInTarget+1},sourceRange:{from:first,to:lastDiffingInNew+1}}}qvangular.directive("qvCodeareaExposedTouchApi",["$parse","$timeout",function($parse,$timeout){return{require:["qvCodearea","qvCodeareaExposedTouchApi"],link:function($scope,$element,$attrs,controllers){var qvCodeArea=controllers[0],exposedApi=controllers[1];exposedApi._connectCodeArea(qvCodeArea);var gettersetter=$parse($attrs.qvCodeareaExposedTouchApi);gettersetter.assign($scope,exposedApi),$scope.$on("$destroy",function(){gettersetter.assign($scope,void 0),$timeout(function(){exposedApi._connectCodeArea(void 0)})})},controller:["$scope",function($scope){function _connectCodeArea(codearea){qvCodearea=codearea}function scrollTo(top,left){qvCodearea.codemirror.scrollTo(left,top)}function setOverlayFocuser(focusFn){qvCodearea.setCustomFocusFn(focusFn)}function onScroll(scrollFn){function onScrollListener(){var scrollElement=$(qvCodearea.codemirror.getScrollerElement());scrollFn(scrollElement.scrollTop(),scrollElement.scrollLeft())}qvCodearea.codemirror.on("scroll",onScrollListener),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("scroll",onScrollListener),scrollFn=void 0})}function onNewContent(callback){function do_callback(){var selection={anchor:qvCodearea.codemirror.indexFromPos(qvCodearea.codemirror.getCursor("anchor")),
head:qvCodearea.codemirror.indexFromPos(qvCodearea.codemirror.getCursor("head"))};callback(qvCodearea.codemirror.getValue(),selection)}function onChange(){modifiedByMe||do_callback()}do_callback(),qvCodearea.codemirror.on("change",onChange),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("change",onChange),callback=void 0})}function onResize(resizeFn){$scope.$watch(function(){return String(qvCodearea.codemirror.lineCount()).length},function(){$timeout(function(){var gutterWidth=$(qvCodearea.codemirror.getGutterElement()).outerWidth(),margins={top:0,left:gutterWidth,bottom:0,right:0};resizeFn(margins)})}),$scope.$on("$destroy",function(){resizeFn=void 0})}function replicateSelection(selectionStart,selectionEnd,options){qvCodearea&&qvCodearea.codemirror.setSelection(selectionStart,selectionEnd,options)}function replicateContent(event,newContent){var targetContent=qvCodearea.codemirror.getValue("\n"),d=diff(targetContent,newContent);if(d){var modifiedText=newContent.substring(d.sourceRange.from,d.sourceRange.to),from=qvCodearea.codemirror.posFromIndex(d.targetRange.from),to=qvCodearea.codemirror.posFromIndex(d.targetRange.to);modifiedByMe=!0,qvCodearea.codemirror.replaceRange(modifiedText,from,to),modifiedByMe=!1}}function disableSelections(){qvCodearea.cssClasses["qv-codearea-disable-selection"]=!0}function restoreSelections(){qvCodearea.cssClasses["qv-codearea-disable-selection"]=!1}var qvCodearea,modifiedByMe,touchApi={_connectCodeArea:_connectCodeArea,scrollTo:scrollTo,onScroll:onScroll,setOverlayFocuser:setOverlayFocuser,replicateSelection:replicateSelection,replicateContent:replicateContent,onNewContent:onNewContent,onResize:onResize,disableSelections:disableSelections,restoreSelections:restoreSelections};return touchApi}]}}]);var exports={diff:diff};return exports}),define("general.components/codearea/codearea-exposed-search-api",["qvangular","general.components/codearea/searcher"],function(qvangular,searcher){qvangular.directive("qvCodeareaExposedSearchApi",["$parse",function($parse){return{require:"qvCodearea",link:function($scope,$element,$attrs,qvCodeArea){var gettersetter=$parse($attrs.qvCodeareaExposedSearchApi);gettersetter.assign($scope,searcher.createSingleCodeareaSearcher(qvCodeArea.codemirror)),$scope.$on("$destroy",function(){gettersetter.assign($scope,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-accelerators",["qvangular"],function(qvangular){qvangular.directive("qvCodeareaAccelerators",function(){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function($scope,$element,$attrs,controllers){function match(actualEvent,expectedEvent){return actualEvent.keyCode===expectedEvent.keyCode&&actualEvent.ctrlKey===(expectedEvent.ctrlKey||!1)&&actualEvent.shiftKey===(expectedEvent.shiftKey||!1)}function keyDown(codemirror,keyEvent){var accelerators=$scope.$eval($attrs.qvCodeareaAccelerators);for(var i in accelerators){var accelerator=accelerators[i];if(match(keyEvent,accelerator)&&(!accelerator.previous||match(previousKeyEvent,accelerator.previous)))return qvangular.$apply(function(){accelerator.fn(qvCodeareaExposedContextApi)}),previousKeyEvent={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0},void keyEvent.preventDefault()}previousKeyEvent={keyCode:keyEvent.keyCode,ctrlKey:keyEvent.ctrlKey,shiftKey:keyEvent.shiftKey}}var qvCodearea=controllers[0],qvCodeareaExposedContextApi=controllers[1],previousKeyEvent={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0};qvCodearea.codemirror.on("keydown",keyDown),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("keydown",keyDown)})}}})}),define("general.components/codearea/codearea-breakpoints",["jquery","qvangular"],function($,qvangular){function makeMarker(breakpoint){var $marker=$("<div class='qv-codearea-breakpoint-marker' data-icon='debugger-breakpoint'></div>");return $marker.data("breakpoint",breakpoint),$marker[0]}function updateElementStateClass(element,marker){marker.enabled?($(element).addClass("qv-codearea-breakpoint-marker-enabled"),$(element).removeClass("qv-codearea-breakpoint-marker-disabled")):($(element).addClass("qv-codearea-breakpoint-marker-disabled"),$(element).removeClass("qv-codearea-breakpoint-marker-enabled"))}qvangular.directive("qvCodeareaBreakpoints",function(){return{require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){function update(breakpointModelMap){if(breakpointModelMap){latestBreakpointsMap=breakpointModelMap;for(var lineCount=qvCodearea.codemirror.getDoc().lineCount(),lineIndex=0;lineCount>lineIndex;lineIndex++){var lineNbr=lineIndex+1,breakpointModel=breakpointModelMap[lineNbr],gutterMarkers=qvCodearea.codemirror.lineInfo(lineIndex).gutterMarkers,breakpointGutterElement=gutterMarkers&&gutterMarkers["qv-codearea-breakpoint"];breakpointModel?(breakpointGutterElement||(breakpointGutterElement=makeMarker(breakpointModel),qvCodearea.codemirror.setGutterMarker(lineIndex,"qv-codearea-breakpoint",breakpointGutterElement)),updateElementStateClass(breakpointGutterElement,breakpointModel)):breakpointGutterElement&&qvCodearea.codemirror.setGutterMarker(lineIndex,"qv-codearea-breakpoint",null)}}}function onChange(){qvCodearea.supressChangeEvent||qvangular.$apply(function(){var breakpointModelList=latestBreakpointsMap;for(var key in breakpointModelList)breakpointModelList.hasOwnProperty(key)&&delete breakpointModelList[key];for(var lineCount=qvCodearea.codemirror.getDoc().lineCount(),lineIndex=0;lineCount>lineIndex;lineIndex++){var lineNbr=lineIndex+1,gutterMarkers=qvCodearea.codemirror.lineInfo(lineIndex).gutterMarkers,_breakpointGutterElement=gutterMarkers&&gutterMarkers["qv-codearea-breakpoint"];if(_breakpointGutterElement){var breakpointGutterElement=$(_breakpointGutterElement),breakpointInGUI=breakpointGutterElement.data("breakpoint");breakpointInGUI.lineNbr=lineNbr,breakpointModelList[lineNbr]=breakpointInGUI}}})}function onGutterClick(cm,lineIndex){qvCodearea.disabled||$scope.$apply(function(){var lineNbr=lineIndex+1,breakpointModel=latestBreakpointsMap[lineNbr];breakpointModel?delete latestBreakpointsMap[lineNbr]:latestBreakpointsMap[lineNbr]={enabled:!0,lineNbr:lineNbr}})}var latestBreakpointsMap;$scope.$watch($attrs.qvCodeareaBreakpoints,update),$scope.$watch($attrs.qvCodeareaBreakpoints,update,!0),qvCodearea.codemirror.on("change",onChange),qvCodearea.codemirror.on("gutterClick",onGutterClick),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("change",onChange),qvCodearea.codemirror.off("gutterClick",onGutterClick)})}}})}),define("general.components/codearea/codearea-debug-location",["qvangular"],function(qvangular){qvangular.directive("qvCodeareaDebugLocation",function(){return{require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){var lastLine;$scope.$watch($attrs.qvCodeareaDebugLocation,function(params){if(params){var lineCount=qvCodearea.codemirror.lastLine()+1,lineNbr=params.lineNbr;lineNbr>lineCount&&(lineNbr=lineCount),lastLine&&(qvCodearea.codemirror.removeLineClass(lastLine,"background","qv-codearea-current-debug-line"),qvCodearea.codemirror.removeLineClass(lastLine,"background","qv-codearea-current-debug-line-error")),lineNbr>0&&lineCount>=lineNbr&&(qvCodearea.codemirror.addLineClass(lineNbr-1,"background","qv-codearea-current-debug-line"),params.errorMessage&&qvCodearea.codemirror.addLineClass(lineNbr-1,"background","qv-codearea-current-debug-line-error"),qvCodearea.codemirror.scrollIntoView({line:lineNbr-1,ch:0},200),lastLine=qvCodearea.codemirror.getLineHandle(lineNbr-1))}},!0)}}})}),define("general.components/codearea/codearea-code-container",["qvangular"],function(qvangular){qvangular.directive("qvCodeareaCodeContainer",function(){return{require:"qvCodearea",priority:-1,link:function($scope,$element,$attrs,qvCodearea){function setEditorValue(value){qvCodearea.supressChangeEvent=!0,qvCodearea.codemirror.setValue(value),qvCodearea.supressChangeEvent=!1,setTimeout(function(){qvCodearea.codemirror.refresh(qvCodearea.codemirror)},0)}function getEditorValue(){return qvCodearea.codemirror.getValue()}function change(){qvCodearea.supressChangeEvent||(currentTab.content=getEditorValue(),clearTimeout(timeout),timeout=setTimeout(function(){$scope.$apply()},250))}var currentTab;$scope.$watch($attrs.qvCodeareaCodeContainer,function(newTab,oldTab){oldTab&&oldTab!==newTab&&(oldTab.editorState={history:JSON.stringify(qvCodearea.codemirror.getHistory()),selectionFrom:qvCodearea.codemirror.getCursor(!0),selectionTo:qvCodearea.codemirror.getCursor(!1),scrollInfo:qvCodearea.codemirror.getScrollInfo()},oldTab.content=getEditorValue()),newTab&&(setEditorValue(newTab.content||""),newTab.editorState?(qvCodearea.codemirror.setHistory(JSON.parse(newTab.editorState.history)),qvCodearea.codemirror.setSelection(newTab.editorState.selectionFrom,newTab.editorState.selectionTo),qvCodearea.codemirror.scrollTo(newTab.editorState.scrollInfo.left,newTab.editorState.scrollInfo.top)):qvCodearea.codemirror.clearHistory()),currentTab=newTab});var timeout=null;qvCodearea.codemirror.on("change",change),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("change",change)})}}})}),define("general.components/codearea/codearea-errors",["qvangular"],function(qvangular){qvangular.directive("qvCodeareaErrors",function(){return{require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){var lastListOfMarkers=[];$scope.$watch($attrs.qvCodeareaErrors+".content",function(errors){if(errors){var i;for(i=0;i<lastListOfMarkers.length;i++)lastListOfMarkers[i].clear();for(i=0;i<errors.length;i++){var err=errors[i],start={line:err.qLineInTab,ch:err.qColInLine},end={line:err.qLineInTab,ch:err.qColInLine+err.qErrLen},markCss=err.selected?"syntaxContainerErrorMarkSelected":"syntaxContainerErrorMarkGeneral",marker=qvCodearea.codemirror.markText(start,end,{className:markCss});lastListOfMarkers.push(marker)}}},!0),$scope.$on("$destroy",function(){lastListOfMarkers=[]})}}})}),define("general.components/codearea/codemirror-change-limiter",[],function(){function limitChange(codemirror,change,limit){var newText=change.text.join("\n"),oldLength=codemirror.getRange(change.from,change.to).length,newLength=newText.length,diff=newLength-oldLength,total=codemirror.getValue().length;total>=limit&&0===oldLength?change.cancel():total+diff>limit&&(newLength=Math.max(0,limit-total+oldLength),newText=newText.substr(0,newLength),change.update(null,null,newText.split("\n")))}return limitChange}),define("general.components/codearea/codearea-limit",["qvangular","general.components/codearea/codemirror-change-limiter"],function(qvangular,limitChange){qvangular.directive("qvCodeareaLimit",function(){return{require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){function beforeChange(instance,change){var limit=$scope.$eval($attrs.qvCodeareaLimit);limit&&limit>0&&limitChange(instance,change,limit)}qvCodearea.codemirror.on("beforeChange",beforeChange),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("beforeChange",beforeChange)})}}})}),define("general.components/codearea/codearea-help-mode",["qvangular","core.utils/help-url","translator"],function(qvangular,helpUrl,translator){function getMatchingKeywordsInArray(arr,str){var compound,i,j,res=[];for(i=0;i<arr.length;i++)for(compound=arr[i].split(" "),j=0;j<compound.length;j++)compound[j].toLowerCase()===str.toLowerCase()&&(hasCompoundMatch||(hasCompoundMatch=compound.length>1,compoundSecondHalf=j>0),res.push(arr[i]));return res}function handleBlankspaceToken(cm,cursor,token){if(" "===token.string){var nextToken=cm.getTokenAt({ch:token.end+1,line:cursor.line});if(nextToken.string.length>1)return nextToken}return token}function getAdjacentToken(cm,currentToken,cursor,previous){var character=previous?currentToken.end-(currentToken.string.length+1):currentToken.end+2,adjacentToken=cm.getTokenAt({ch:character,line:cursor.line});return adjacentToken}function showHelpForClick(codemirror,event,helpSyntaxGroup,service){var mouseCoords={left:event.pageX,top:event.pageY},charCoords=codemirror.coordsChar(mouseCoords,"window"),currentToken=codemirror.getTokenAt(charCoords);return showHelp(codemirror,currentToken,helpSyntaxGroup,service)}function showHelpForKey(codemirror,event,helpSyntaxGroup,service){var currentToken=codemirror.getTokenAt(codemirror.getCursor());return showHelp(codemirror,currentToken,helpSyntaxGroup,service)}function showHelp(codemirror,currentToken,helpSyntaxGroup,service){hasCompoundMatch=!1,compoundSecondHalf=!1,helpSyntaxGroup=helpSyntaxGroup?helpSyntaxGroup:"scriptsyntax";var lookupKeyword,adjacentToken,secondMatch,url=helpUrl.path+"#"+translator.language+"|"+helpSyntaxGroup+".",matchArr=[];"keyword"===currentToken.type&&(currentToken=handleBlankspaceToken(codemirror,codemirror.getCursor(),currentToken),matchArr=getMatchingKeywordsInArray(service.getAllKeywords(),currentToken.string),hasCompoundMatch?(adjacentToken=getAdjacentToken(codemirror,currentToken,codemirror.getCursor(),compoundSecondHalf),secondMatch=getMatchingKeywordsInArray(matchArr,adjacentToken.string),lookupKeyword=secondMatch.length>0&&adjacentToken.string!==currentToken.string?compoundSecondHalf?adjacentToken.string+"_"+currentToken.string:currentToken.string+"_"+adjacentToken.string:currentToken.string):lookupKeyword=currentToken.string,url+=lookupKeyword,/firefox/.test(window.navigator.userAgent.toLocaleLowerCase())&&helpWindow&&helpWindow.close(),helpWindow=window.open(url,"__qlikviewhelp"))}var hasCompoundMatch,compoundSecondHalf,helpWindow;qvangular.directive("qvCodeareaHelpMode",function(){return{require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){var helpmodeActive,stopOptionsWatch=$scope.$watch($attrs.qvCodeareaHelpModeOptions,function(options){function mousedown(codemirror,event){helpmodeActive&&(event.preventDefault(),showHelpForClick(codemirror,event,options.syntax,options.service))}function keyDown(cm,keyEvent){72!==keyEvent.keyCode&&104!==keyEvent.keyCode||!keyEvent.ctrlKey||(keyEvent.preventDefault(),showHelpForKey(qvCodearea.codemirror,keyEvent,options.syntax,options.service))}stopOptionsWatch(),$scope.$watch($attrs.qvCodeareaHelpMode,function(helpMode){helpmodeActive=helpMode,qvCodearea.cssClasses["qv-codearea-help-mode"]=helpMode}),qvCodearea.codemirror.on("mousedown",mousedown),qvCodearea.codemirror.on("keydown",keyDown),$scope.$on("$destroy",function(){qvCodearea.codemirror.off("keydown",keyDown),qvCodearea.codemirror.off("mousedown",mousedown)})})}}})}),define("general.components/codearea/codearea-touch-overlay",["qvangular"],function(qvangular){qvangular.directive("qvCodeareaTouchOverlay",function(){return{restrict:"E",replace:!0,scope:{codeareaTouchApi:"=",enabled:"=",helpMode:"="},template:'<div class="qv-codearea-touch-overlay-container" ng-style="containerStyle"><textarea class="qv-codearea-touch-overlay" autocorrect="off" autocapitalize="off" autocomplete="off" spellcheck="false" wrap="off"></textarea></div>',link:function($scope,_$element){function setupTouchOverlay(touchApi){function selectionPosToCoords(content,pos){var lines=content.substring(0,pos).split("\n"),line=lines.length-1,ch=lines[lines.length-1].length;return{line:line,ch:ch}}function replicateSelection(){var content=textareaEl.val(),start=textareaEl[0].selectionStart,end=textareaEl[0].selectionEnd,startCoords=selectionPosToCoords(content,start),endCoords=selectionPosToCoords(content,end);touchApi.replicateSelection(startCoords,endCoords,{scroll:!1})}function checkForSelectionChange(){stopSelectionMonitoring||((textareaEl[0].selectionStart!==lastSelectionStart||textareaEl[0].selectionEnd!==lastSelectionEnd)&&(lastSelectionStart=textareaEl[0].selectionStart,lastSelectionEnd=textareaEl[0].selectionEnd,replicateSelection()),setTimeout(checkForSelectionChange,200))}var iOS=/iPad|iPhone|iPod/.test(navigator.userAgent);iOS&&textareaEl.css("padding-left","1px"),touchApi.disableSelections(),$scope.$on("$destroy",function(){touchApi.restoreSelections()}),touchApi.onNewContent(function(content,selection){textareaEl.val(content),textareaEl[0]===document.activeElement&&(textareaEl[0].selectionStart!==selection.anchor||textareaEl[0].selectionEnd!==selection.head)&&(textareaEl[0].selectionStart=selection.anchor,textareaEl[0].selectionEnd=selection.head)}),touchApi.setOverlayFocuser(function(){}),touchApi.onResize(function(size){$scope.containerStyle.left=size.left}),touchApi.onScroll(function(top,left){textareaEl.scrollTop(top),textareaEl.scrollLeft(left),document.activeElement===textareaEl[0]&&(""===textareaEl[0].style.textShadow?textareaEl[0].style.textShadow="rgba(0,0,0,0) 0 0 0":textareaEl[0].style.textShadow="")}),textareaEl.on("scroll",function(){touchApi.scrollTo(textareaEl.scrollTop(),textareaEl.scrollLeft())}),textareaEl.on("input",function(event){var content=textareaEl.val();touchApi.replicateContent(event,content)});var lastSelectionStart,lastSelectionEnd;setTimeout(checkForSelectionChange,200)}var textareaEl=_$element.find("textarea"),stopSelectionMonitoring=!1;$scope.containerStyle={},$scope.$watch("helpMode",function(data){data?_$element.hide():_$element.show()});var stopWatch=$scope.$watch("codeareaTouchApi",function(touchApi){touchApi&&(setupTouchOverlay(touchApi),stopWatch())});$scope.$on("$destroy",function(){stopSelectionMonitoring=!0,textareaEl=void 0})}}})}),define("general.components/codearea/codearea-block-large-pastes",["qvangular"],function(qvangular){"use strict";qvangular.directive("qvCodeareaBlockLargePastes",function(){var upperLimitOfCharacters=function(limit){return""===limit||isNaN(limit)?1e6:limit},lengthOfPaste=function(e){return e.originalEvent.clipboardData?e.originalEvent.clipboardData.getData("text/plain").length:window.clipboardData.getData("Text").length};return{restrict:"A",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$element.find("textarea").on("paste",function(e){lengthOfPaste(e)>upperLimitOfCharacters($attrs.qvCodeareaBlockLargePastes)&&e.preventDefault()}),$scope.$on("$destroy",function(){$element.find("textarea").off("paste")})}]}})}),define("general.components/codearea/codearea-exposed-gutter-width",["jquery","qvangular"],function($,qvangular){qvangular.directive("qvCodeareaExposedGutterWidth",["$parse","$timeout",function($parse,$timeout){return{require:"qvCodearea",link:function($scope,$element,$attrs,qvCodeArea){var gettersetter=$parse($attrs.qvCodeareaExposedGutterWidth);$scope.$watch(function(){return String(qvCodeArea.codemirror.lineCount()).length},function(){var gutterWidth=$(qvCodeArea.codemirror.getGutterElement()).outerWidth();gettersetter.assign($scope,gutterWidth),$timeout(function(){var newGutterWidth=$(qvCodeArea.codemirror.getGutterElement()).outerWidth();gettersetter.assign($scope,newGutterWidth)})}),$scope.$on("$destroy",function(){gettersetter.assign($scope,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-composition-event",["qvangular","jquery","codemirror"],function(qvangular,$,CodeMirror){"use strict";function clearCompositionTextMarkers(cm){var textMarker,textMarkersArray,_i,_len;for(textMarkersArray=cm.getAllMarks(),_i=0,_len=textMarkersArray.length;_len>_i;_i++)textMarker=textMarkersArray[_i],null!=textMarker&&textMarker.className===TEXT_MARKER_CLASS_NAME&&textMarker.clear();return!0}function initCompositionMode(cm,element){function isIE(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");return msie>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)}var qvCodeArea=element;cm.options.enableCompositionMod=!0,mouseDown=function(){postCompositionEnd&&postCompositionEnd(),cm.display.input.blur(),cm.display.input.focus()},keyDown=function(event){if(previousKey=event["char"],postCompositionEnd&&postCompositionEnd(),cm.display.inCompositionMode){var endPos=cm.getCursor(),headPos=cm.display.compositionHead,pixelToTranslate=cm.charCoords(endPos).left-cm.charCoords(headPos).left;pixelToTranslate+=void 0!==previousKey?30:1,cm.display.input.style.width=pixelToTranslate+"px"}},compositionStart=function(){cm.options.enableCompositionMod&&(autocomplete.disabled=!0,cm.display.inCompositionMode=!0,qvCodeAreaOffset=qvCodeArea.offset(),cm.display.inputDiv.classList.add("CodeMirror-input-wrapper"),cm.display.inputDiv.classList.add("in-composition"),cm.setOption("readOnly",!0),cm.somethingSelected()&&cm.replaceSelection(""),cm.display.compositionHead=cm.getCursor(),void 0===previousKey?cm.display.input.value="":" "===previousKey&&compositionUpdate({data:" "}))},compositionUpdate=function(event){var markerRange,pixelToTranslate;if(cm.options.enableCompositionMod&&cm.display.inCompositionMode){var headPos=cm.display.compositionHead;cm.display.textMarkerInComposition?(markerRange=cm.display.textMarkerInComposition.find(),markerRange&&(cm.replaceRange(event.data,headPos,markerRange.to),cm.display.textMarkerInComposition.clear(),cm.display.textMarkerInComposition=void 0)):cm.replaceRange(event.data,headPos,headPos);var endPos=cm.getCursor();pixelToTranslate=cm.charCoords(endPos).left-cm.charCoords(headPos).left,void 0===previousKey&&(pixelToTranslate+=1),cm.display.input.style.width=pixelToTranslate+"px",cm.display.textMarkerInComposition=cm.markText(headPos,endPos,TEXT_MARKER_OPTIONS),updateCurrentOffset()}},compositionEnd=function(event){var _ref;cm.options.enableCompositionMod&&cm.display.inCompositionMode&&(isIE()?"\b"===previousKey&&compositionUpdate(event):compositionUpdate(event),cm.display.inCompositionMode=!1,cm.display.compositionHead=void 0,null!=(_ref=cm.display.textMarkerInComposition)&&_ref.clear(),cm.display.textMarkerInComposition=void 0,cm.setOption("readOnly",!1),cm.display.inputDiv.classList.remove("in-composition"),cm.display.inputDiv.classList.remove("CodeMirror-input-wrapper"),clearCompositionTextMarkers(cm),postCompositionEnd=function(){autocomplete.disabled=!1,CodeMirror.off(cm.display.input,"input",postCompositionEnd),cm.display.inCompositionMode||(cm.display.input.value="",cm.display.input.style.width="0px",postCompositionEnd=void 0)},CodeMirror.on(cm.display.input,"input",postCompositionEnd))},updateCurrentOffset=function(){if(cm.display.inCompositionMode){var posY=cm.charCoords(cm.display.compositionHead).top-qvCodeAreaOffset.top;void 0!==previousKey&&(posY-=1),cm.display.inputDiv.style.top=posY+"px";var posX=cm.charCoords(cm.display.compositionHead).left-qvCodeAreaOffset.left;cm.display.inputDiv.style.left=posX+"px"}},mouseScroll=function(e){var scroller=$(cm.display.scroller);scroller.scrollTop(scroller.scrollTop()-e.wheelDelta)}}var compositionStart,compositionUpdate,compositionEnd,keyDown,mouseDown,postCompositionEnd,previousKey,updateCurrentOffset,qvCodeAreaOffset,mouseScroll,autocomplete,TEXT_MARKER_CLASS_NAME="CodeMirror-text-in-composition",TEXT_MARKER_OPTIONS={inclusiveLeft:!0,inclusiveRight:!0,className:TEXT_MARKER_CLASS_NAME};qvangular.directive("qvCodeareaCompositionEvent",function(){return{restrict:"A",require:"qvCodearea",link:function($scope,$element,$attrs,qvCodearea){initCompositionMode(qvCodearea.codemirror,$element);var input=qvCodearea.codemirror.display.input,stopWatch=$scope.$watch($attrs.qvCodeareaAutocomplete,function(autocompleteoptions){autocomplete=autocompleteoptions,stopWatch()});stopWatch=$scope.$watch("codeareaTouchApi",function(touchApi){touchApi&&(touchApi.onResize(function(){updateCurrentOffset()}),touchApi.onScroll(function(){updateCurrentOffset()}),stopWatch())}),$(window).on("resize",updateCurrentOffset),CodeMirror.on(qvCodearea.codemirror,"mousedown",mouseDown),CodeMirror.on(input,"keydown",keyDown),CodeMirror.on(input,"compositionstart",compositionStart),CodeMirror.on(input,"compositionupdate",compositionUpdate),CodeMirror.on(input,"compositionend",compositionEnd),CodeMirror.on(input,"mousedown",mouseDown),CodeMirror.on(input,"mousewheel",mouseScroll),$scope.$on("$destroy",function(){$(window).off("resize",updateCurrentOffset),CodeMirror.off(qvCodearea.codemirror,"mousedown",mouseDown),CodeMirror.off(input,"compositionstart",compositionStart),CodeMirror.off(input,"keydown",keyDown),CodeMirror.off(input,"compositionupdate",compositionUpdate),CodeMirror.off(input,"compositionend",compositionEnd),CodeMirror.off(input,"input",postCompositionEnd),CodeMirror.off(input,"mousedown",mouseDown),CodeMirror.off(input,"mousewheel",mouseScroll)})}}})}),define("general.components/codearea/codearea",["jquery","qvangular","codemirror","codemirror.matchbrackets","general.components/codearea/qlikview-script-mode","general.components/codearea/codearea-function-tip","general.components/codearea/codearea-autocomplete","general.components/codearea/searcher","general.components/codearea/codearea-exposed-context-api","general.components/codearea/codearea-exposed-touch-api","general.components/codearea/codearea-exposed-search-api","general.components/codearea/codearea-accelerators","general.components/codearea/codearea-breakpoints","general.components/codearea/codearea-debug-location","general.components/codearea/codearea-code-container","general.components/codearea/codearea-errors","general.components/codearea/codearea-limit","general.components/codearea/codearea-help-mode","general.components/codearea/codearea-touch-overlay","general.components/codearea/codearea-block-large-pastes","general.components/codearea/codearea-exposed-gutter-width","general.components/codearea/codearea-composition-event"],function($,qvangular,CodeMirror){qvangular.directive("qvCodearea",function(){return{replace:!0,restrict:"EA",priority:2,scope:{mode:"=",showBreakpointGutter:"=",resizeTrigger:"=",options:"=",showLineNumbers:"@",disabled:"="},template:"<div class='qv-codearea' ng-class='cssClasses'></div>",controller:["$scope","$element","$timeout",function($scope,$element,$timeout){var qvCodearea=this;$scope.cssClasses={},"undefined"==typeof $scope.showLineNumbers&&($scope.showLineNumbers=!0),$element.on("keydown",function(e){e.isDefaultPrevented()&&e.stopPropagation()});var gutters=[],useLineNumbers="true"===$scope.showLineNumbers||$scope.showLineNumbers===!0;useLineNumbers&&gutters.push("CodeMirror-linenumbers"),$scope.showBreakpointGutter&&gutters.push("qv-codearea-breakpoint");var options={lineWrapping:!1,lineNumbers:useLineNumbers,mode:$scope.mode,matchBrackets:!0,gutters:gutters};return $scope.options&&(options=$.extend({},options,$scope.options)),qvCodearea.codemirror=CodeMirror($element[0],options),qvCodearea.cssClasses=$scope.cssClasses,qvCodearea.setCustomFocusFn=function(customfocusFn){qvCodearea.customfocusFn=customfocusFn},qvCodearea.focus=function(){qvCodearea.customfocusFn?qvCodearea.customfocusFn():qvCodearea.codemirror.hasFocus()||qvCodearea.codemirror.focus()},$scope.codemirror=qvCodearea.codemirror,$scope.codemirror.on("drop",function(a,e){e.dataTransfer.files.length>0&&e.preventDefault()}),$scope.$watch("disabled",function(disabled){qvCodearea.disabled=disabled,qvCodearea.cssClasses["qv-codearea-disabled"]=disabled,disabled&&"nocursor"!==qvCodearea.codemirror.getOption("readOnly")?qvCodearea.codemirror.setOption("readOnly","nocursor"):disabled||"nocursor"!==qvCodearea.codemirror.getOption("readOnly")||qvCodearea.codemirror.setOption("readOnly",!1)}),$scope.$watch("resizeTrigger",function(resizeTrigger){resizeTrigger&&$timeout(function(){qvCodearea.codemirror.refresh()})}),$scope.$on("$destroy",function(){$scope.codemirror=void 0,setTimeout(function(){qvCodearea.codemirror=void 0,qvCodearea.overrideCustomFocus=void 0},1e3)}),$timeout(function(){$(".qv-codearea .CodeMirror textarea").css("font-size","13px")}),qvCodearea}]}})}),define("assets/client/dialogs/expression-dialog/expression-dialog",["jquery","core.models/app","core.utils/deferred","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","general.utils/expression-validator","general.components/info-popover/info-popover","general.services/show-service/show-service","text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html","assets/client/dialogs/expression-dialog/expression-dialog-controller","assets/client/dialogs/expression-dialog/expression-validation-info","general.utils/string-limits","client.services/validation","translator","general.components/function-tip-view/function-tip-view","touche","assets/client/dialogs/expression-dialog/expression-bnf","general.components/extract","general.components/codearea/codearea"],function($,App,Deferred,Field,FieldListModel,expressionValidator,infoPopover,showService,template,controller,ValidationInfo,stringLimits,Validation,translator,functionTipView,Touche,ExpressionBnf){function insertTextHandler(scope,event){event.preventDefault();var text=scope.controller.previewText();scope.codearea.contextApi.replaceSelection(text)}function addTooltipToScriptarea($scope,expressionBnfModel){$scope.functionTipOptions={service:expressionBnfModel,view:functionTipView}}function showErrorMessage(element,$scope,errorMsg,event){function focusOnEditor(){close(),$scope.codearea.contextApi.focus()}function close(){$(document).off("keydown",focusOnEditor),wrapper.remove()}if(errorMsg){var wrapper=$("<div />").appendTo(document.body);errorMsg=errorMsg.replace(/\n/g," "),/^(input|textarea)$/i.test(document.activeElement.tagName)&&$.support.touch&&document.activeElement.blur(),wrapper.showComponent(infoPopover,{alignTo:event.target,text:errorMsg,onClose:close,position:"top"}),$(document).one("keydown",{self:this},focusOnEditor)}}function validateExprssion(expression,$scope){var obj={expression:expression,validity:$scope.validity};return Validation.validateExpr(obj,stringLimits)}function show(options){var app=options.app||App.current;return Deferred.all({bnf:ExpressionBnf.get(app),fields:Field.getListLayout(app)}).then(function(args){if(isOpen)return Deferred.reject();var expressionBnfModel=args.bnf,fields=FieldListModel.expand(args.fields),expression=String(options.expr||"");expression=expression.replace(/^=+/,"");var input={title:options.title,allowEmpty:options.allowEmpty,labels:options.labels,expr:expression,mode:options.mode,controller:controller.create({fields:fields,translator:translator}),expressionBnfModel:expressionBnfModel};isOpen=!0;var view=showService.show(component,input);return view.resultPromise})}var isOpen=!1,component={template:template,controller:["$scope","$element",function($scope,$element){function updateExpr(expr){$scope.info.setExpr(expr),$scope.validity.expression||validateExprssion(expr,$scope)}$scope.stringLimits=stringLimits,$scope.controller=$scope.input.controller,$scope.codearea={content:$scope.input.expr};var validator=new expressionValidator.ExpressionValidator(null,$scope.input.mode);$scope.validity={expression:!0},$scope.enableTouchOverlay=Touche.utils.touch,$scope.insertTextHandler=insertTextHandler.bind(null,$scope),$scope.$watch("controller.selectedTable",function(table){$scope.controller.setTableFilter(table)}),$scope.info=ValidationInfo.create({validator:validator,labels:$scope.input.labels}),$scope.info.setExpr($scope.input.expr),$scope.showErrorMessage=showErrorMessage.bind(null,$element,$scope),$scope.qlikviewReloadScriptMode={name:"qlikviewscript",service:$scope.input.expressionBnfModel},$scope.helpModeOptions={syntax:"chartsyntax",service:$scope.input.expressionBnfModel},$scope.autocompleteOptions={completeSingle:!1,service:$scope.input.expressionBnfModel},addTooltipToScriptarea($scope,$scope.input.expressionBnfModel),$scope.cancel=function(){$scope.destroyComponent(),$scope.deferredResult.reject()},$scope.confirm=function(){var expression=$scope.codearea.content,isExprValid=validateExprssion(expression,$scope);(isExprValid||$scope.input.allowEmpty&&""===expression)&&($scope.destroyComponent(),$scope.deferredResult.resolve(expression))},$scope.$watch("codearea.content",updateExpr),$scope.$on("$destroy",function(){isOpen=!1})}]};return{_insertTextHandler:insertTextHandler,show:show}}),define("client.controllers/dimensions-dialog-controller-logic",[],function(){"use strict";function DimensionDialogControllerLogic(directDiscoveryService){function addIconMetaData(field){directDiscoveryService.isDirectDiscoveryField(field)&&(field.dimensionDialogMetaData={
icon:"directdiscovery",iconTooltip:directDiscoveryService.getTypeTranslationKey(field.qTags)})}return{addIconMetaData:addIconMetaData}}return{create:function(directDiscoveryService){return new DimensionDialogControllerLogic(directDiscoveryService)}}}),define("client.controllers/dimensions-dialog-controller",["qvangular","util","assets/client/dialogs/dimension-dialog/dimension-dialog","general.models/library/dimension","assets/client/dialogs/expression-dialog/expression-dialog","general.models/field","general.utils/dimension-utils","client.assets/tab-contents/fields/assets-directdiscovery-service","client.controllers/dimensions-dialog-controller-logic","client.assets/tab-contents/fields/assets-field-list-model"],function(qvangular,util,DimensionsDialog,DimensionModel,ExpressionDialog,Field,dimensionUtils,directDiscoveryService,dimensionDialogControllerLogicFactory,FieldListModel){"use strict";function compare(a,b){return a.localeCompare(b)}function getTableFields(){return Field.getListLayout().then(function(list){var i,j,tables;for(list=util.extend(!0,[],list),list=directDiscoveryService.removeMeasureAndDetailsFields(list),list=FieldListModel.expand(list),tables=[],i=0;i<list.length;++i){var field=list[i];for(j=0;j<field.qSrcTables.length;++j)-1===tables.indexOf(field.qSrcTables[j])&&tables.push(field.qSrcTables[j]);dimensionDialogControllerLogic.addIconMetaData(field)}return tables.sort(compare),list.sort(function(a,b){return a.qName.localeCompare(b.qName)}),{fields:list,tables:tables}})}function openExpressionEditor(fn,index,expression){ExpressionDialog.show({expr:expression,title:expression?"Dimension.Expression.Dialog.Edit.Title":"Dimension.Expression.Dialog.Add.Title"}).then(function(expr){fn(index,expr)})}function show(model,save){getTableFields().then(function(tableData){function callback(data){var dimensionTypes=dimensionUtils.dimensionTypes,DRILLDOWN="drilldown",SINGLE="single";model.qMetaDef={title:data.name,description:data.description,tags:data.tags},model.qDim.title=data.name,model.qDim.qGrouping=data.type===DRILLDOWN?dimensionTypes.drilldown:dimensionTypes.single,model.qDim.qFieldDefs=data.expr,data.type===SINGLE?model.qDim.qFieldLabels=[data.name]:model.qDim.qFieldLabels=[],save()}var add=!model.qInfo.qId,dialogData=util.extend(!0,{},model);dialogData.name=model.qMetaDef.title,dialogData.description=model.qMetaDef.description,dialogData.tags=model.qMetaDef.tags,add?DimensionsDialog.add({dimension:dialogData,tableData:tableData,expressionInterface:openExpressionEditor,callback:callback}):DimensionsDialog.edit({dimension:dialogData,tableData:tableData,expressionInterface:openExpressionEditor,callback:callback})})}function DimensionsDialogController(){return{add:function(fieldname,callback){function save(){return DimensionModel.create(model).then(function(data){qvangular.$rootScope.$emit("clearUndo"),callback&&callback(data)})}var model={qInfo:{qType:"dimension"},qDim:{qGrouping:dimensionTypes.single,qFieldDefs:[]},qMetaDef:{title:"",description:"",tags:[]}};fieldname&&(model.qMetaDef.title=fieldname,model.qDim.qFieldDefs.push(fieldname)),show(model,save)},edit:function(dimensionName,callback){DimensionModel.getProperties(dimensionName).then(function(model){show(model.properties,function(){return model.save().then(function(data){qvangular.$rootScope.$emit("clearUndo"),callback&&callback(data)})})})}}}var dimensionTypes=dimensionUtils.dimensionTypes,dimensionDialogControllerLogic=dimensionDialogControllerLogicFactory.create(directDiscoveryService);return DimensionsDialogController}),define("text!assets/client/dialogs/measure-dialog/measure-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="measure-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<header class="dm-header" q-translation="{{title}}"></header>\r\n	<main class="dm-main">\r\n\r\n		<div class="measure-component">\r\n			<label q-translation="metadata.expression" class="qv-metadatalabel">Expression:</label>\r\n			<tiny-editor class="measureExpArea" value="measure.expression" on-open="openInExpressionDialog( $event )"\r\n				invalid="!measure.validity.expression"></tiny-editor>\r\n		</div>\r\n\r\n		<div class="measure-component">\r\n			<label q-translation="metadata.name" class="qv-metadatalabel">Name:</label>\r\n			<input class="qui-input" ng-model="measure.name" type="text" name="name" maxlength="{{stringLimits.name}}" ng-class="{ \'qui-invalid\': !measure.validity.name }"/>\r\n		</div>\r\n		<div class="measure-component">\r\n			<label q-translation="metadata.description" class="qv-metadatalabel">Description:</label>\r\n			<textarea class="qui-textarea" ng-model="measure.description" maxlength="{{stringLimits.description}}" name="desc" ng-class="{ \'qui-invalid\': !measure.validity.description }"></textarea>\r\n		</div>\r\n		<div class="measure-component">\r\n			<label q-translation="metadata.tags" class="qv-taglabel"></label>\r\n			<qv-tagcloud tags="measure.tags" update="measure.updateTags"></qv-tagcloud>\r\n		</div>\r\n\r\n	</main>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="{{confirmLabel}}"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("text!general.components/tiny-editor/tiny-editor.ng.html",[],function(){return'<div class="tiny-editor qui-textarea" ng-class="{\'qui-invalid\': invalid, \'qui-active\': active}">\r\n	<div class="textarea-wrapper">\r\n		<textarea tid="tiny-editor-text" type="text" maxlength="8192" rows="3" class="wrapped-textarea"\r\n			ng-trim="false" ng-model="value" ng-change="change()" ng-focus="focused()" ng-blur="blurred()">\r\n		</textarea>\r\n	</div>\r\n	<qui-button  button-type="smalliconbutton-fx" tid="tiny-editor-fx-button" class="icon-expression edit-expression active"\r\n		qva-activate="open( $event )"\r\n		q-title-translation="Tooltip.OpenExpressionEditor"></qui-button>\r\n\r\n</div>\r\n'}),define("general.components/tiny-editor/tiny-editor",["assets/qvangular/qvangular-core","text!./tiny-editor.ng.html"],function(qvangular,template){qvangular.directive("tinyEditor",function(){return{template:template,replace:!0,restrict:"E",scope:{value:"=",invalid:"=?",onOpen:"&"},link:function($scope){$scope.focused=function(){$scope.active=!0},$scope.blurred=function(){$scope.active=!1},$scope.open=function($event){$scope.onOpen({$event:$event})}}}})}),define("assets/client/dialogs/measure-dialog/measure-dialog",["qvangular","general.services/show-service/show-service","text!assets/client/dialogs/measure-dialog/measure-dialog.ng.html","general.utils/string-limits","assets/client/dialogs/expression-dialog/expression-dialog","client.services/validation","jquery","assets/client/dialogs/directives/dialog-directives","general.components/tiny-editor/tiny-editor","client.views/tagcloud/tagcloud"],function(qvangular,showService,template,stringLimits,ExpressionDialog,Validation,$){function validate($scope){var isMetadataValid=Validation.validateMetadata($scope.measure,stringLimits),isExprValid=Validation.validateExpr($scope.measure,stringLimits);if(isMetadataValid&&isExprValid){var measure=formData($scope);$scope.deferredResult.resolve(measure)}}function formData($scope){return{name:$scope.measure.name,description:$scope.measure.description,tags:$scope.measure.tags,expr:$scope.measure.expression}}function show(args){var input={title:args.title,confirmLabel:args.confirm,measure:{expression:args.expr,name:args.name,description:args.description,tags:args.tags}};return showService.show(component,input)}var component={scope:{title:"=",confirmLabel:"=",measure:"="},template:template,controller:["$scope","$timeout",function($scope,$timeout){$scope.measure.validity={},$scope.measure.validity.expression=!0,$scope.measure.validity.description=!0,$scope.measure.validity.name=!0,$scope.stringLimits=stringLimits,$scope.cancel=function(){$scope.destroyComponent()},$scope.confirm=function(){$scope.measure.updateTags(),validate($scope)},$scope.openInExpressionDialog=function(event){event.preventDefault(),ExpressionDialog.show({expr:$scope.measure.expression,title:$scope.measure.expression?"Dimension.Expression.Dialog.Edit.Title":"Dimension.Expression.Dialog.Add.Title"}).then(function(expr){$scope.measure.expression=expr})},$scope.$watch("measure.expression",function(){$scope.measure.validity.expression||Validation.validateExpr($scope.measure,stringLimits)}),$scope.$watch("measure.name",function(){$('input[ng-model="measure.name"]').hasClass("qui-invalid")&&Validation.validateMetadata($scope.measure,stringLimits)}),$scope.simFocus=!1,$timeout(function(){$("#measure-dialog-expression-area").on("focus",function(){$scope.simFocus=!0,qvangular.$apply($scope)}).on("blur",function(){$scope.simFocus=!1,qvangular.$apply($scope)})})}]};return{show:show}}),define("assets/client/dialogs/visualization-dialog/visualization-dialog-logic-factory",[],function(){function create(scope,validateForm){function cancel(){scope.destroyComponent()}function save(){if(validateForm()){var visualization=getFormData();scope.destroyComponent(),scope.deferredResult.resolve(visualization)}}function resetValidity(){scope.visualization=scope.visualization||{},scope.visualization.validity={},scope.visualization.validity.name=!0,scope.visualization.validity.description=!0}function getFormData(){return{name:scope.visualization.name,description:scope.visualization.description,tags:scope.visualization.tags}}if(!scope)throw new TypeError("You must pass a scope to this function");if(!validateForm||"function"!=typeof validateForm)throw new TypeError("You must pass a validateForm function to this function");return scope.visualization=scope.input.visualization,resetValidity(),{cancel:cancel,save:save,getFormData:getFormData}}return{create:create}}),define("text!assets/client/dialogs/visualization-dialog/visualization-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="visualization-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<header class="dm-header" q-translation="{{input.title}}"></header>\r\n	<main class="dm-main">\r\n		<div class="visualization-dialog-item">\r\n			<label q-translation="metadata.name">Name:</label>\r\n			<input class="qui-input" ng-model="visualization.name" type="text" name="name" maxlength="{{stringLimits.name}}" ng-class="{ \'qui-invalid\': !visualization.validity.name }"/>\r\n		</div>\r\n		<div class="visualization-dialog-item">\r\n			<label q-translation="metadata.description">Description:</label>\r\n			<textarea class="qui-textarea" ng-model="visualization.description" maxlength="{{stringLimits.description}}" name="desc" ng-class="{ \'qui-invalid\': !visualization.validity.description }"></textarea>\r\n		</div>\r\n		<div class="visualization-dialog-item">\r\n			<label q-translation="metadata.tags" class="qv-taglabel"></label>\r\n			<qv-tagcloud tags="visualization.tags" update="visualization.updateTags"></qv-tagcloud>\r\n		</div>\r\n	</main>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="{{input.confirm}}"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>'}),define("assets/client/dialogs/visualization-dialog/visualization-dialog",["assets/client/dialogs/visualization-dialog/visualization-dialog-logic-factory","general.services/show-service/show-service","text!assets/client/dialogs/visualization-dialog/visualization-dialog.ng.html","general.utils/string-limits","client.services/validation","jquery","assets/client/dialogs/directives/dialog-directives","client.views/tagcloud/tagcloud"],function(visualizationDialogLogicFactory,showService,template,stringLimits,Validation,$){function show(args){var input={title:args.title,confirm:args.confirm,visualization:{name:args.visualization.name,description:args.visualization.description,tags:args.visualization.tags}};return showService.show(component,input)}var component={template:template,controller:["$scope",function($scope){function validateForm(){return Validation.validateMetadata($scope.visualization,stringLimits)}var logic=visualizationDialogLogicFactory.create($scope,validateForm);$scope.stringLimits=stringLimits,$scope.cancel=logic.cancel,$scope.confirm=function(){$scope.visualization.updateTags(),logic.save()},$scope.$watch("visualization.name",function(){$('input[ng-model="visualization.name"]').hasClass("qui-invalid")&&Validation.validateMetadata($scope.visualization,stringLimits)})}]};return{show:show}}),define("client.assets/property-dialog",["qvangular","assets/client/dialogs/measure-dialog/measure-dialog","assets/client/dialogs/visualization-dialog/visualization-dialog","general.models/library/measure","util","core.models/app"],function(qvangular,MeasureDialog,VisualizationDialog,Measure,util){function _saveNewMeasure(data){var props;return props={qInfo:{qType:"measure"},qMetaDef:{title:data.name,description:data.description,tags:data.tags},qMeasure:{qLabel:data.name,qDef:data.expr}},Measure.create(props)}function updateExistingMeasure(props,model,data){return props.qMetaDef.title=data.name,props.qMetaDef.description=data.description,props.qMetaDef.tags=data.tags,props.qMeasure.qLabel=data.name,props.qMeasure.qDef=data.expr,model.save()}function addMeasure(field,app,callback){var view,fieldName=field?field:"",expression=util.escapeField(fieldName);view=MeasureDialog.show({title:"Measure.Dialog.Add.Title",confirm:"Common.Create",name:fieldName,description:"",tags:[],expr:field?"("+expression+")":""}),view.resultPromise.then(function(data){view.destroy(),_saveNewMeasure(data).then(function(data){callback&&callback(data),qvangular.$rootScope.$emit("clearUndo")})})}function editMeasure(id,callback){Measure.get(id).then(function(model){model.getProperties().then(function(props){var init={title:"Measure.Dialog.Edit.Title",confirm:"Common.Save",name:props.qMetaDef.title,description:props.qMetaDef.description,tags:props.qMetaDef.tags,expr:props.qMeasure.qDef},view=MeasureDialog.show(init);view.resultPromise.then(function(data){view.destroy(),updateExistingMeasure(props,model,data).then(function(data){callback&&callback(data),qvangular.$rootScope.$emit("clearUndo")})})})})}function addMetadata(args){var dialog=VisualizationDialog.show({title:"Visualization.Dialog.Add.Title",confirm:"Visualization.Dialog.Saveclose",visualization:{name:args.qMetaDef.title,description:args.qMetaDef.description,tags:args.qMetaDef.tags}});dialog.resultPromise.then(function(visualizationData){args.onSave(visualizationData)})}function breakLink(args){args.onSave({expr:args.expr,path:args.elem.data("path"),pathAttribute:"definition"})}return{addMeasure:addMeasure,editMeasure:editMeasure,addMetadata:addMetadata,breakLink:breakLink}}),define("assets/datamodelviewer/services/dmv-add-dimension-measure-service",["core.models/app","scripteditor.services/explicit-save-service","client.controllers/dimensions-dialog-controller","client.assets/property-dialog"],function(App,explicitSaveService,DimensionDialogController,PropertyDialog){function showAddDimensionDialog(fieldName,callback){callback=callback||function(){},App.get().then(function(){var dialog=new DimensionDialogController;dialog.add(fieldName,function(){explicitSaveService.notifyThatNewChangeIsDoneAndSaveIsRequired(),callback()})})}function showAddMeasureDialog(fieldName,callback){callback=callback||function(){},App.get().then(function(app){PropertyDialog.addMeasure(fieldName,app,function(){explicitSaveService.notifyThatNewChangeIsDoneAndSaveIsRequired(),callback()})})}return{showAddDimensionDialog:showAddDimensionDialog,showAddMeasureDialog:showAddMeasureDialog}}),define("assets/hldm/box-types/load-file",["text!assets/hldm/box-types/load-file.txt","general.utils/property-resolver","assets/datamodelviewer/services/dmv-add-dimension-measure-service"],function(template,propertyResolver,addDimensionMeasureService){var exports={type:"load-file",template:template,definition:{type:"items",component:"accordion",items:{main:{type:"items",translation:"Table settings",grouped:!0,items:{dataconnectorName:{translation:"Dataconnector Name",type:"string",ref:"dataconnectorName"},tableName:{translation:"Table Name",type:"string",ref:"tableName"},ownerName:{translation:"Owner Name",type:"string",ref:"ownerName"}}},fields:{translation:"Fields",type:"array",ref:"fields",component:"list",itemTitleRef:"alias",items:{"add-as-dimension-button":{component:"button",translation:"Add as dimension",action:function(data){addDimensionMeasureService.showAddDimensionDialog(data.name)}},"add-as-measure-button":{component:"button",translation:"Add as measure",action:function(data){addDimensionMeasureService.showAddMeasureDialog(data.name)}},sourceName:{translation:"Original Source Name",type:"string",ref:"name"},fieldName:{translation:"Field Name (Alias)",type:"string",ref:"alias"},selected:{translation:"Selected",type:"boolean",component:"checkbox",ref:"selected"},"field-meta-data-component":{translation:"Meta Data",component:"dataprep-properties-panel-meta-data",isTable:!1}}},calculatedFields:{translation:"Calculated Fields",type:"array",ref:"calculatedFields",component:"list",itemTitleRef:"alias",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"Add calculated field",add:function(){},items:{fieldName:{translation:"Field Name (Alias)",type:"string",ref:"alias"},sourceName:{translation:"Expression",type:"string",expression:"optional",ref:"expr"},selected:{translation:"Selected",type:"boolean",component:"checkbox",ref:"selected"}}},dataCleaning:{translation:"Cleansing data",type:"items",component:"items",items:{keep:{translation:"Keep data based on other table",type:"boolean",component:"checkbox",ref:"dependencies.keep.enabled"},keepTable:{translation:"Keep data based on other table",type:"string",component:"table-dropdown",ref:"dependencies.keep.key",show:function(data){return propertyResolver.getValue(data,"dependencies.keep.enabled",!1)}}}},"field-meta-data-component":{translation:"Meta Data",component:"dataprep-properties-panel-meta-data",isTable:!0}}},initialProperties:{}};return exports}),define("text!assets/hldm/box-types/load-sql.txt",[],function(){return"LIB CONNECT TO [{{dataconnectorName}}];\r\n{{#each calculatedFields}}\r\n	LOAD *, {{expr}} AS [{{alias}}];\r\n{{/each}}\r\n{{#each inject.prefix}}\r\n{{.}}\r\n{{/each}}\r\n{{#if dependencies.keep.enabled}}\r\nLEFT KEEP ([{{dependencies.keep.model.tableAlias}}])\r\n{{/if}}\r\nLOAD {{load-field-list fields}};\r\nSQL SELECT {{sql-field-list fields connectionInfo}}\r\nFROM {{database-owner-table databaseName ownerName tableName connectionInfo.dbInfo}};\r\n"}),define("assets/hldm/box-types/load-sql",["text!assets/hldm/box-types/load-sql.txt","general.utils/property-resolver","assets/datamodelviewer/services/dmv-add-dimension-measure-service"],function(template,propertyResolver,addDimensionMeasureService){var exports={type:"load-sql",template:template,definition:{type:"items",component:"accordion",items:{general:{translation:"General",items:{keep:{translation:"Table Name",type:"string",ref:"tableAlias"}}},fields:{translation:"Data Fields",type:"array",ref:"fields",component:"list",itemTitleRef:"alias",hideAdd:!0,allowAdd:!1,allowRemove:!0,allowMove:!1,items:{"add-as-dimension-button":{component:"button",translation:"Add as dimension",action:function(data){addDimensionMeasureService.showAddDimensionDialog(data.name)}},"add-as-measure-button":{component:"button",translation:"Add as measure",action:function(data){addDimensionMeasureService.showAddMeasureDialog(data.name)}},fieldName:{translation:"Name",type:"string",ref:"alias"},sourceName:{type:"string",component:"text",label:function(data){return"(Renamed from "+data.name+")"},show:function(data){return data.alias!==data.name}},selected:{translation:"Selected",type:"boolean",component:"checkbox",ref:"selected"},"field-meta-data-component":{translation:"Meta Data",component:"dataprep-properties-panel-meta-data",isTable:!1}}},calculatedFields:{translation:"Calculated Fields",type:"array",ref:"calculatedFields",component:"list",itemTitleRef:"alias",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"Add calculated field",add:function(){},items:{fieldName:{translation:"Name",type:"string",ref:"alias"},sourceName:{translation:"Expression",type:"string",expression:"optional",ref:"expr"},selected:{translation:"Selected",type:"boolean",component:"checkbox",ref:"selected"}}},dataCleaning:{translation:"Data consistency",type:"items",component:"items",items:{keep:{translation:"Keep data based on other table",type:"boolean",component:"checkbox",ref:"dependencies.keep.enabled"},keepTable:{translation:"Keep data based on other table",type:"string",component:"table-dropdown",ref:"dependencies.keep.key",show:function(data){return propertyResolver.getValue(data,"dependencies.keep.enabled",!1)}}}},"field-table-meta-data-component":{translation:"Meta Data",component:"dataprep-properties-panel-meta-data",isTable:!0}}},initialProperties:{}};return exports}),define("assets/hldm/box-types/join",[],function(){var exports={type:"join",template:"//Joined {{dependencies.from.model.tableAlias}} with {{dependencies.to.model.tableAlias}}",inject:{from:{type:"table",prefix:"JOIN ([{{dependencies.to.model.tableAlias}}])"},to:{type:"table",prefix:"/* Join target for key */"}},sideeffects:{from:{type:"newGeneration",fields:function(model){return model.dependencies.from.model.fields.concat(model.dependencies.to.model.fields)}},to:{type:"destroyed"}},crossDependencies:{from:"to"},definition:{type:"items",component:"accordion",items:{main:{type:"items",translation:"Tables to join",grouped:!0,items:{name:{translation:"From Table Jey",type:"string",component:"table-dropdown",ref:"dependencies.from.key"},description:{translation:"To Table Key",type:"string",component:"table-dropdown",ref:"dependencies.to.key"}}}}},initialProperties:{boxType:"join",category:"join",joinType:"left",dependencies:{from:{key:"Documents:gitignore_global.txt:TYPE9_CSV:gitignore_global.txt"},to:{key:"NorthWind:C:\\QVFiles\\Northwind.mdb:undefined:Q_Orders"}}},run:function(){}};return exports}),define("assets/hldm/box-types/new-generation",[],function(){var exports={type:"newGeneration",template:"/*new version of a table {{tableName}}: {{key}}. Depends on transformation {{dependencies.parent.key}}. \n New fields list:\n {{load-field-list fields}} \n*/",definition:{type:"items",component:"accordion",items:{}},initialProperties:{boxType:"newGeneration",dependencies:{}}};return exports}),/*!

 handlebars v2.0.0

Copyright (C) 2011-2014 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
function(root,factory){"function"==typeof define&&define.amd?define("handlebars",[],factory):"object"==typeof exports?module.exports=factory():root.Handlebars=root.Handlebars||factory()}(this,function(){var __module4__=function(){"use strict";function SafeString(string){this.string=string}var __exports__;return SafeString.prototype.toString=function(){return""+this.string},__exports__=SafeString}(),__module3__=function(__dependency1__){"use strict";function escapeChar(chr){return escape[chr]}function extend(obj){for(var i=1;i<arguments.length;i++)for(var key in arguments[i])Object.prototype.hasOwnProperty.call(arguments[i],key)&&(obj[key]=arguments[i][key]);return obj}function escapeExpression(string){return string instanceof SafeString?string.toString():null==string?"":string?(string=""+string,possible.test(string)?string.replace(badChars,escapeChar):string):string+""}function isEmpty(value){return value||0===value?isArray(value)&&0===value.length?!0:!1:!0}function appendContextPath(contextPath,id){return(contextPath?contextPath+".":"")+id}var __exports__={},SafeString=__dependency1__,escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},badChars=/[&<>"'`]/g,possible=/[&<>"'`]/;__exports__.extend=extend;var toString=Object.prototype.toString;__exports__.toString=toString;var isFunction=function(value){return"function"==typeof value};isFunction(/x/)&&(isFunction=function(value){return"function"==typeof value&&"[object Function]"===toString.call(value)});var isFunction;__exports__.isFunction=isFunction;var isArray=Array.isArray||function(value){return value&&"object"==typeof value?"[object Array]"===toString.call(value):!1};return __exports__.isArray=isArray,__exports__.escapeExpression=escapeExpression,__exports__.isEmpty=isEmpty,__exports__.appendContextPath=appendContextPath,__exports__}(__module4__),__module5__=function(){"use strict";function Exception(message,node){var line;node&&node.firstLine&&(line=node.firstLine,message+=" - "+line+":"+node.firstColumn);for(var tmp=Error.prototype.constructor.call(this,message),idx=0;idx<errorProps.length;idx++)this[errorProps[idx]]=tmp[errorProps[idx]];line&&(this.lineNumber=line,this.column=node.firstColumn)}var __exports__,errorProps=["description","fileName","lineNumber","message","name","number","stack"];return Exception.prototype=new Error,__exports__=Exception}(),__module2__=function(__dependency1__,__dependency2__){"use strict";function HandlebarsEnvironment(helpers,partials){this.helpers=helpers||{},this.partials=partials||{},registerDefaultHelpers(this)}function registerDefaultHelpers(instance){instance.registerHelper("helperMissing",function(){if(1===arguments.length)return void 0;throw new Exception("Missing helper: '"+arguments[arguments.length-1].name+"'")}),instance.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse,fn=options.fn;if(context===!0)return fn(this);if(context===!1||null==context)return inverse(this);if(isArray(context))return context.length>0?(options.ids&&(options.ids=[options.name]),instance.helpers.each(context,options)):inverse(this);if(options.data&&options.ids){var data=createFrame(options.data);data.contextPath=Utils.appendContextPath(options.data.contextPath,options.name),options={data:data}}return fn(context,options)}),instance.registerHelper("each",function(context,options){if(!options)throw new Exception("Must pass iterator to #each");var data,contextPath,fn=options.fn,inverse=options.inverse,i=0,ret="";if(options.data&&options.ids&&(contextPath=Utils.appendContextPath(options.data.contextPath,options.ids[0])+"."),isFunction(context)&&(context=context.call(this)),options.data&&(data=createFrame(options.data)),context&&"object"==typeof context)if(isArray(context))for(var j=context.length;j>i;i++)data&&(data.index=i,data.first=0===i,data.last=i===context.length-1,contextPath&&(data.contextPath=contextPath+i)),ret+=fn(context[i],{data:data});else for(var key in context)context.hasOwnProperty(key)&&(data&&(data.key=key,data.index=i,data.first=0===i,contextPath&&(data.contextPath=contextPath+key)),ret+=fn(context[key],{data:data}),i++);return 0===i&&(ret=inverse(this)),ret}),instance.registerHelper("if",function(conditional,options){return isFunction(conditional)&&(conditional=conditional.call(this)),!options.hash.includeZero&&!conditional||Utils.isEmpty(conditional)?options.inverse(this):options.fn(this)}),instance.registerHelper("unless",function(conditional,options){return instance.helpers["if"].call(this,conditional,{fn:options.inverse,inverse:options.fn,hash:options.hash})}),instance.registerHelper("with",function(context,options){isFunction(context)&&(context=context.call(this));var fn=options.fn;if(Utils.isEmpty(context))return options.inverse(this);if(options.data&&options.ids){var data=createFrame(options.data);data.contextPath=Utils.appendContextPath(options.data.contextPath,options.ids[0]),options={data:data}}return fn(context,options)}),instance.registerHelper("log",function(message,options){var level=options.data&&null!=options.data.level?parseInt(options.data.level,10):1;instance.log(level,message)}),instance.registerHelper("lookup",function(obj,field){return obj&&obj[field]})}var __exports__={},Utils=__dependency1__,Exception=__dependency2__,VERSION="2.0.0";__exports__.VERSION=VERSION;var COMPILER_REVISION=6;__exports__.COMPILER_REVISION=COMPILER_REVISION;var REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};__exports__.REVISION_CHANGES=REVISION_CHANGES;var isArray=Utils.isArray,isFunction=Utils.isFunction,toString=Utils.toString,objectType="[object Object]";__exports__.HandlebarsEnvironment=HandlebarsEnvironment,HandlebarsEnvironment.prototype={constructor:HandlebarsEnvironment,logger:logger,log:log,registerHelper:function(name,fn){if(toString.call(name)===objectType){if(fn)throw new Exception("Arg not supported with multiple helpers");Utils.extend(this.helpers,name)}else this.helpers[name]=fn},unregisterHelper:function(name){delete this.helpers[name]},registerPartial:function(name,partial){toString.call(name)===objectType?Utils.extend(this.partials,name):this.partials[name]=partial},unregisterPartial:function(name){delete this.partials[name]}};var logger={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(level,message){if(logger.level<=level){var method=logger.methodMap[level];"undefined"!=typeof console&&console[method]&&console[method].call(console,message)}}};__exports__.logger=logger;var log=logger.log;__exports__.log=log;var createFrame=function(object){var frame=Utils.extend({},object);return frame._parent=object,frame};return __exports__.createFrame=createFrame,__exports__}(__module3__,__module5__),__module6__=function(__dependency1__,__dependency2__,__dependency3__){"use strict";function checkRevision(compilerInfo){var compilerRevision=compilerInfo&&compilerInfo[0]||1,currentRevision=COMPILER_REVISION;if(compilerRevision!==currentRevision){if(currentRevision>compilerRevision){var runtimeVersions=REVISION_CHANGES[currentRevision],compilerVersions=REVISION_CHANGES[compilerRevision];throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").")}throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+compilerInfo[1]+").")}}function template(templateSpec,env){if(!env)throw new Exception("No environment passed to template");if(!templateSpec||!templateSpec.main)throw new Exception("Unknown template object: "+typeof templateSpec);env.VM.checkRevision(templateSpec.compiler);var invokePartialWrapper=function(partial,indent,name,context,hash,helpers,partials,data,depths){hash&&(context=Utils.extend({},context,hash));var result=env.VM.invokePartial.call(this,partial,name,context,helpers,partials,data,depths);if(null==result&&env.compile){var options={helpers:helpers,partials:partials,data:data,depths:depths};partials[name]=env.compile(partial,{data:void 0!==data,compat:templateSpec.compat},env),result=partials[name](context,options)}if(null!=result){if(indent){for(var lines=result.split("\n"),i=0,l=lines.length;l>i&&(lines[i]||i+1!==l);i++)lines[i]=indent+lines[i];result=lines.join("\n")}return result}throw new Exception("The partial "+name+" could not be compiled when running in runtime-only mode")},container={lookup:function(depths,name){for(var len=depths.length,i=0;len>i;i++)if(depths[i]&&null!=depths[i][name])return depths[i][name]},lambda:function(current,context){return"function"==typeof current?current.call(context):current},escapeExpression:Utils.escapeExpression,invokePartial:invokePartialWrapper,fn:function(i){return templateSpec[i]},programs:[],program:function(i,data,depths){var programWrapper=this.programs[i],fn=this.fn(i);return data||depths?programWrapper=program(this,i,fn,data,depths):programWrapper||(programWrapper=this.programs[i]=program(this,i,fn)),programWrapper},data:function(data,depth){for(;data&&depth--;)data=data._parent;return data},merge:function(param,common){var ret=param||common;return param&&common&&param!==common&&(ret=Utils.extend({},common,param)),ret},noop:env.VM.noop,compilerInfo:templateSpec.compiler},ret=function(context,options){options=options||{};var data=options.data;ret._setup(options),!options.partial&&templateSpec.useData&&(data=initData(context,data));var depths;return templateSpec.useDepths&&(depths=options.depths?[context].concat(options.depths):[context]),templateSpec.main.call(container,context,container.helpers,container.partials,data,depths)};return ret.isTop=!0,ret._setup=function(options){options.partial?(container.helpers=options.helpers,container.partials=options.partials):(container.helpers=container.merge(options.helpers,env.helpers),templateSpec.usePartial&&(container.partials=container.merge(options.partials,env.partials)))},ret._child=function(i,data,depths){if(templateSpec.useDepths&&!depths)throw new Exception("must pass parent depths");return program(container,i,templateSpec[i],data,depths)},ret}function program(container,i,fn,data,depths){var prog=function(context,options){return options=options||{},fn.call(container,context,container.helpers,container.partials,options.data||data,depths&&[context].concat(depths))};return prog.program=i,prog.depth=depths?depths.length:0,prog}function invokePartial(partial,name,context,helpers,partials,data,depths){var options={partial:!0,helpers:helpers,partials:partials,data:data,depths:depths};if(void 0===partial)throw new Exception("The partial "+name+" could not be found");return partial instanceof Function?partial(context,options):void 0}function noop(){return""}function initData(context,data){return data&&"root"in data||(data=data?createFrame(data):{},data.root=context),data}var __exports__={},Utils=__dependency1__,Exception=__dependency2__,COMPILER_REVISION=__dependency3__.COMPILER_REVISION,REVISION_CHANGES=__dependency3__.REVISION_CHANGES,createFrame=__dependency3__.createFrame;return __exports__.checkRevision=checkRevision,__exports__.template=template,__exports__.program=program,__exports__.invokePartial=invokePartial,__exports__.noop=noop,__exports__}(__module3__,__module5__,__module2__),__module1__=function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__){"use strict";var __exports__,base=__dependency1__,SafeString=__dependency2__,Exception=__dependency3__,Utils=__dependency4__,runtime=__dependency5__,create=function(){var hb=new base.HandlebarsEnvironment;return Utils.extend(hb,base),hb.SafeString=SafeString,hb.Exception=Exception,hb.Utils=Utils,hb.escapeExpression=Utils.escapeExpression,hb.VM=runtime,hb.template=function(spec){return runtime.template(spec,hb)},hb},Handlebars=create();return Handlebars.create=create,Handlebars["default"]=Handlebars,__exports__=Handlebars}(__module2__,__module4__,__module5__,__module3__,__module6__),__module7__=function(__dependency1__){"use strict";function LocationInfo(locInfo){locInfo=locInfo||{},this.firstLine=locInfo.first_line,this.firstColumn=locInfo.first_column,this.lastColumn=locInfo.last_column,this.lastLine=locInfo.last_line}var __exports__,Exception=__dependency1__,AST={ProgramNode:function(statements,strip,locInfo){LocationInfo.call(this,locInfo),this.type="program",this.statements=statements,this.strip=strip},MustacheNode:function(rawParams,hash,open,strip,locInfo){if(LocationInfo.call(this,locInfo),this.type="mustache",this.strip=strip,null!=open&&open.charAt){var escapeFlag=open.charAt(3)||open.charAt(2);this.escaped="{"!==escapeFlag&&"&"!==escapeFlag}else this.escaped=!!open;rawParams instanceof AST.SexprNode?this.sexpr=rawParams:this.sexpr=new AST.SexprNode(rawParams,hash),this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(rawParams,hash,locInfo){LocationInfo.call(this,locInfo),this.type="sexpr",this.hash=hash;var id=this.id=rawParams[0],params=this.params=rawParams.slice(1);this.isHelper=!(!params.length&&!hash),this.eligibleHelper=this.isHelper||id.isSimple},PartialNode:function(partialName,context,hash,strip,locInfo){LocationInfo.call(this,locInfo),this.type="partial",this.partialName=partialName,this.context=context,this.hash=hash,this.strip=strip,this.strip.inlineStandalone=!0},BlockNode:function(mustache,program,inverse,strip,locInfo){LocationInfo.call(this,locInfo),this.type="block",this.mustache=mustache,this.program=program,this.inverse=inverse,this.strip=strip,inverse&&!program&&(this.isInverse=!0)},RawBlockNode:function(mustache,content,close,locInfo){if(LocationInfo.call(this,locInfo),mustache.sexpr.id.original!==close)throw new Exception(mustache.sexpr.id.original+" doesn't match "+close,this);content=new AST.ContentNode(content,locInfo),this.type="block",this.mustache=mustache,this.program=new AST.ProgramNode([content],{},locInfo)},ContentNode:function(string,locInfo){LocationInfo.call(this,locInfo),this.type="content",this.original=this.string=string},HashNode:function(pairs,locInfo){LocationInfo.call(this,locInfo),this.type="hash",this.pairs=pairs},IdNode:function(parts,locInfo){LocationInfo.call(this,locInfo),this.type="ID";for(var original="",dig=[],depth=0,depthString="",i=0,l=parts.length;l>i;i++){var part=parts[i].part;if(original+=(parts[i].separator||"")+part,".."===part||"."===part||"this"===part){if(dig.length>0)throw new Exception("Invalid path: "+original,this);".."===part?(depth++,depthString+="../"):this.isScoped=!0}else dig.push(part)}this.original=original,this.parts=dig,this.string=dig.join("."),this.depth=depth,this.idName=depthString+this.string,this.isSimple=1===parts.length&&!this.isScoped&&0===depth,this.stringModeValue=this.string},PartialNameNode:function(name,locInfo){LocationInfo.call(this,locInfo),this.type="PARTIAL_NAME",this.name=name.original},DataNode:function(id,locInfo){LocationInfo.call(this,locInfo),this.type="DATA",this.id=id,this.stringModeValue=id.stringModeValue,this.idName="@"+id.stringModeValue},StringNode:function(string,locInfo){LocationInfo.call(this,locInfo),this.type="STRING",this.original=this.string=this.stringModeValue=string},NumberNode:function(number,locInfo){LocationInfo.call(this,locInfo),this.type="NUMBER",this.original=this.number=number,this.stringModeValue=Number(number)},BooleanNode:function(bool,locInfo){LocationInfo.call(this,locInfo),this.type="BOOLEAN",this.bool=bool,this.stringModeValue="true"===bool},CommentNode:function(comment,locInfo){LocationInfo.call(this,locInfo),this.type="comment",this.comment=comment,this.strip={inlineStandalone:!0}}};return __exports__=AST}(__module5__),__module9__=function(){"use strict";var __exports__,handlebars=function(){function Parser(){this.yy={}}var parser={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,CONTENT:12,COMMENT:13,openRawBlock:14,END_RAW_BLOCK:15,OPEN_RAW_BLOCK:16,sexpr:17,CLOSE_RAW_BLOCK:18,openBlock:19,block_option0:20,closeBlock:21,openInverse:22,block_option1:23,OPEN_BLOCK:24,CLOSE:25,OPEN_INVERSE:26,inverseAndProgram:27,INVERSE:28,OPEN_ENDBLOCK:29,path:30,OPEN:31,OPEN_UNESCAPED:32,CLOSE_UNESCAPED:33,OPEN_PARTIAL:34,partialName:35,param:36,partial_option0:37,partial_option1:38,sexpr_repetition0:39,sexpr_option0:40,dataName:41,STRING:42,NUMBER:43,BOOLEAN:44,OPEN_SEXPR:45,CLOSE_SEXPR:46,hash:47,hash_repetition_plus0:48,hashSegment:49,ID:50,EQUALS:51,DATA:52,pathSegments:53,SEP:54,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"CONTENT",13:"COMMENT",15:"END_RAW_BLOCK",16:"OPEN_RAW_BLOCK",18:"CLOSE_RAW_BLOCK",24:"OPEN_BLOCK",25:"CLOSE",26:"OPEN_INVERSE",28:"INVERSE",29:"OPEN_ENDBLOCK",31:"OPEN",32:"OPEN_UNESCAPED",33:"CLOSE_UNESCAPED",34:"OPEN_PARTIAL",42:"STRING",43:"NUMBER",44:"BOOLEAN",45:"OPEN_SEXPR",46:"CLOSE_SEXPR",50:"ID",51:"EQUALS",52:"DATA",54:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[10,3],[14,3],[9,4],[9,4],[19,3],[22,3],[27,2],[21,3],[8,3],[8,3],[11,5],[11,4],[17,3],[17,1],[36,1],[36,1],[36,1],[36,1],[36,1],[36,3],[47,1],[49,3],[35,1],[35,1],[35,1],[41,2],[30,1],[53,3],[53,1],[6,0],[6,2],[20,0],[20,1],[23,0],[23,1],[37,0],[37,1],[38,0],[38,1],[39,0],[39,2],[40,0],[40,1],[48,1],[48,2]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return yy.prepareProgram($$[$0-1].statements,!0),$$[$0-1];case 2:this.$=new yy.ProgramNode(yy.prepareProgram($$[$0]),{},this._$);break;case 3:this.$=$$[$0];break;case 4:this.$=$$[$0];break;case 5:this.$=$$[$0];break;case 6:this.$=$$[$0];break;case 7:this.$=new yy.ContentNode($$[$0],this._$);break;case 8:this.$=new yy.CommentNode($$[$0],this._$);break;case 9:this.$=new yy.RawBlockNode($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 10:this.$=new yy.MustacheNode($$[$0-1],null,"","",this._$);break;case 11:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],!1,this._$);break;case 12:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],!0,this._$);break;case 13:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 14:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 15:this.$={strip:yy.stripFlags($$[$0-1],$$[$0-1]),program:$$[$0]};break;case 16:this.$={path:$$[$0-1],strip:yy.stripFlags($$[$0-2],$$[$0])};break;case 17:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 18:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 19:this.$=new yy.PartialNode($$[$0-3],$$[$0-2],$$[$0-1],yy.stripFlags($$[$0-4],$$[$0]),this._$);break;case 20:this.$=new yy.PartialNode($$[$0-2],void 0,$$[$0-1],yy.stripFlags($$[$0-3],$$[$0]),this._$);break;case 21:this.$=new yy.SexprNode([$$[$0-2]].concat($$[$0-1]),$$[$0],this._$);break;case 22:this.$=new yy.SexprNode([$$[$0]],null,this._$);break;case 23:this.$=$$[$0];break;case 24:this.$=new yy.StringNode($$[$0],this._$);break;case 25:this.$=new yy.NumberNode($$[$0],this._$);break;case 26:this.$=new yy.BooleanNode($$[$0],this._$);break;case 27:this.$=$$[$0];break;case 28:$$[$0-1].isHelper=!0,this.$=$$[$0-1];break;case 29:this.$=new yy.HashNode($$[$0],this._$);break;case 30:this.$=[$$[$0-2],$$[$0]];break;case 31:this.$=new yy.PartialNameNode($$[$0],this._$);break;case 32:this.$=new yy.PartialNameNode(new yy.StringNode($$[$0],this._$),this._$);break;case 33:this.$=new yy.PartialNameNode(new yy.NumberNode($$[$0],this._$));break;case 34:this.$=new yy.DataNode($$[$0],this._$);break;case 35:this.$=new yy.IdNode($$[$0],this._$);break;case 36:$$[$0-2].push({part:$$[$0],separator:$$[$0-1]}),this.$=$$[$0-2];break;case 37:this.$=[{part:$$[$0]}];break;case 38:this.$=[];break;case 39:$$[$0-1].push($$[$0]);break;case 48:this.$=[];break;case 49:$$[$0-1].push($$[$0]);break;case 52:this.$=[$$[$0]];break;case 53:$$[$0-1].push($$[$0])}},table:[{3:1,4:2,5:[2,38],6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],31:[2,38],32:[2,38],34:[2,38]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:[1,10],13:[1,11],14:16,16:[1,20],19:14,22:15,24:[1,18],26:[1,19],28:[2,2],29:[2,2],31:[1,12],32:[1,13],34:[1,17]},{1:[2,1]},{5:[2,39],12:[2,39],13:[2,39],16:[2,39],24:[2,39],26:[2,39],28:[2,39],29:[2,39],31:[2,39],32:[2,39],34:[2,39]},{5:[2,3],12:[2,3],13:[2,3],16:[2,3],24:[2,3],26:[2,3],28:[2,3],29:[2,3],31:[2,3],32:[2,3],34:[2,3]},{5:[2,4],12:[2,4],13:[2,4],16:[2,4],24:[2,4],26:[2,4],28:[2,4],29:[2,4],31:[2,4],32:[2,4],34:[2,4]},{5:[2,5],12:[2,5],13:[2,5],16:[2,5],24:[2,5],26:[2,5],28:[2,5],29:[2,5],31:[2,5],32:[2,5],34:[2,5]},{5:[2,6],12:[2,6],13:[2,6],16:[2,6],24:[2,6],26:[2,6],28:[2,6],29:[2,6],31:[2,6],32:[2,6],34:[2,6]},{5:[2,7],12:[2,7],13:[2,7],16:[2,7],24:[2,7],26:[2,7],28:[2,7],29:[2,7],31:[2,7],32:[2,7],34:[2,7]},{5:[2,8],12:[2,8],13:[2,8],16:[2,8],24:[2,8],26:[2,8],28:[2,8],29:[2,8],31:[2,8],32:[2,8],34:[2,8]},{17:21,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:27,30:22,41:23,50:[1,26],52:[1,25],53:24},{4:28,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{4:29,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{12:[1,30]},{30:32,35:31,42:[1,33],43:[1,34],50:[1,26],53:24},{17:35,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:36,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:37,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[1,38]},{18:[2,48],25:[2,48],33:[2,48],39:39,42:[2,48],43:[2,48],44:[2,48],45:[2,48],46:[2,48],50:[2,48],52:[2,48]},{18:[2,22],25:[2,22],33:[2,22],46:[2,22]},{18:[2,35],25:[2,35],33:[2,35],42:[2,35],43:[2,35],44:[2,35],45:[2,35],46:[2,35],50:[2,35],52:[2,35],54:[1,40]},{30:41,50:[1,26],53:24},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],52:[2,37],54:[2,37]},{33:[1,42]},{20:43,27:44,28:[1,45],29:[2,40]},{23:46,27:47,28:[1,45],29:[2,42]},{15:[1,48]},{25:[2,46],30:51,36:49,38:50,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],47:57,48:58,49:60,50:[1,59],52:[1,25],53:24},{25:[2,31],42:[2,31],43:[2,31],44:[2,31],45:[2,31],50:[2,31],52:[2,31]},{25:[2,32],42:[2,32],43:[2,32],44:[2,32],45:[2,32],50:[2,32],52:[2,32]},{25:[2,33],42:[2,33],43:[2,33],44:[2,33],45:[2,33],50:[2,33],52:[2,33]},{25:[1,61]},{25:[1,62]},{18:[1,63]},{5:[2,17],12:[2,17],13:[2,17],16:[2,17],24:[2,17],26:[2,17],28:[2,17],29:[2,17],31:[2,17],32:[2,17],34:[2,17]},{18:[2,50],25:[2,50],30:51,33:[2,50],36:65,40:64,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],46:[2,50],47:66,48:58,49:60,50:[1,59],52:[1,25],53:24},{50:[1,67]},{18:[2,34],25:[2,34],33:[2,34],42:[2,34],43:[2,34],44:[2,34],45:[2,34],46:[2,34],50:[2,34],52:[2,34]},{5:[2,18],12:[2,18],13:[2,18],16:[2,18],24:[2,18],26:[2,18],28:[2,18],29:[2,18],31:[2,18],32:[2,18],34:[2,18]},{21:68,29:[1,69]},{29:[2,41]},{4:70,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{21:71,29:[1,69]},{29:[2,43]},{5:[2,9],12:[2,9],13:[2,9],16:[2,9],24:[2,9],26:[2,9],28:[2,9],29:[2,9],31:[2,9],32:[2,9],34:[2,9]},{25:[2,44],37:72,47:73,48:58,49:60,50:[1,74]},{25:[1,75]},{18:[2,23],25:[2,23],33:[2,23],42:[2,23],43:[2,23],44:[2,23],45:[2,23],46:[2,23],50:[2,23],52:[2,23]},{18:[2,24],25:[2,24],33:[2,24],42:[2,24],43:[2,24],44:[2,24],45:[2,24],46:[2,24],50:[2,24],52:[2,24]},{18:[2,25],25:[2,25],33:[2,25],42:[2,25],43:[2,25],44:[2,25],45:[2,25],46:[2,25],50:[2,25],52:[2,25]},{18:[2,26],25:[2,26],33:[2,26],42:[2,26],43:[2,26],44:[2,26],45:[2,26],46:[2,26],50:[2,26],52:[2,26]},{18:[2,27],25:[2,27],33:[2,27],42:[2,27],43:[2,27],44:[2,27],45:[2,27],46:[2,27],50:[2,27],52:[2,27]},{17:76,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[2,47]},{18:[2,29],25:[2,29],33:[2,29],46:[2,29],49:77,50:[1,74]},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],51:[1,78],52:[2,37],54:[2,37]},{18:[2,52],25:[2,52],33:[2,52],46:[2,52],50:[2,52]},{12:[2,13],13:[2,13],16:[2,13],24:[2,13],26:[2,13],28:[2,13],29:[2,13],31:[2,13],32:[2,13],34:[2,13]},{12:[2,14],13:[2,14],16:[2,14],24:[2,14],26:[2,14],28:[2,14],29:[2,14],31:[2,14],32:[2,14],34:[2,14]},{12:[2,10]},{18:[2,21],25:[2,21],33:[2,21],46:[2,21]},{18:[2,49],25:[2,49],33:[2,49],42:[2,49],43:[2,49],44:[2,49],45:[2,49],46:[2,49],50:[2,49],52:[2,49]},{18:[2,51],25:[2,51],33:[2,51],46:[2,51]},{18:[2,36],25:[2,36],33:[2,36],42:[2,36],43:[2,36],44:[2,36],45:[2,36],46:[2,36],50:[2,36],52:[2,36],54:[2,36]},{5:[2,11],12:[2,11],13:[2,11],16:[2,11],24:[2,11],26:[2,11],28:[2,11],29:[2,11],31:[2,11],32:[2,11],34:[2,11]},{30:79,50:[1,26],53:24},{29:[2,15]},{5:[2,12],12:[2,12],13:[2,12],16:[2,12],24:[2,12],26:[2,12],28:[2,12],29:[2,12],31:[2,12],32:[2,12],34:[2,12]},{25:[1,80]},{25:[2,45]},{51:[1,78]},{5:[2,20],12:[2,20],13:[2,20],16:[2,20],24:[2,20],26:[2,20],28:[2,20],29:[2,20],31:[2,20],32:[2,20],34:[2,20]},{46:[1,81]},{18:[2,53],25:[2,53],33:[2,53],46:[2,53],50:[2,53]},{30:51,36:82,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],50:[1,26],52:[1,25],53:24},{25:[1,83]},{5:[2,19],12:[2,19],13:[2,19],16:[2,19],24:[2,19],26:[2,19],28:[2,19],29:[2,19],31:[2,19],32:[2,19],34:[2,19]},{18:[2,28],25:[2,28],33:[2,28],42:[2,28],43:[2,28],44:[2,28],45:[2,28],46:[2,28],50:[2,28],52:[2,28]},{18:[2,30],25:[2,30],33:[2,30],46:[2,30],50:[2,30]},{5:[2,16],12:[2,16],13:[2,16],16:[2,16],24:[2,16],26:[2,16],28:[2,16],29:[2,16],31:[2,16],32:[2,16],34:[2,16]}],defaultActions:{4:[2,1],44:[2,41],47:[2,43],57:[2,47],63:[2,10],70:[2,15],73:[2,45]},parseError:function(str,hash){throw new Error(str)},parse:function(input){function lex(){var token;return token=self.lexer.lex()||1,"number"!=typeof token&&(token=self.symbols_[token]||token),token}var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0;this.lexer.setInput(input),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var symbol,preErrorSymbol,state,action,r,p,len,newState,expected,yyval={};;){if(state=stack[stack.length-1],this.defaultActions[state]?action=this.defaultActions[state]:((null===symbol||"undefined"==typeof symbol)&&(symbol=lex()),action=table[state]&&table[state][symbol]),"undefined"==typeof action||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])this.terminals_[p]&&p>2&&expected.push("'"+this.terminals_[p]+"'");errStr=this.lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(this.lexer.yytext),lstack.push(this.lexer.yylloc),stack.push(action[1]),symbol=null,preErrorSymbol?(symbol=preErrorSymbol,preErrorSymbol=null):(yyleng=this.lexer.yyleng,yytext=this.lexer.yytext,yylineno=this.lexer.yylineno,yyloc=this.lexer.yylloc,recovering>0&&recovering--);break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack),"undefined"!=typeof r)return r;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}},lexer=function(){var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input){return this._input=input,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);return lines?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len-1),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this},more:function(){return this._more=!0,this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var token,match,tempMatch,index,lines;this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length&&(tempMatch=this._input.match(this.rules[rules[i]]),!tempMatch||match&&!(tempMatch[0].length>match[0].length)||(match=tempMatch,index=i,this.options.flex));i++);return match?(lines=match[0].match(/(?:\r\n?|\n).*/g),lines&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token?token:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,
line:this.yylineno})},lex:function(){var r=this.next();return"undefined"!=typeof r?r:this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(condition){this.begin(condition)}};return lexer.options={},lexer.performAction=function(yy,yy_,$avoiding_name_collisions,YY_START){function strip(start,end){return yy_.yytext=yy_.yytext.substr(start,yy_.yyleng-end)}switch($avoiding_name_collisions){case 0:if("\\\\"===yy_.yytext.slice(-2)?(strip(0,1),this.begin("mu")):"\\"===yy_.yytext.slice(-1)?(strip(0,1),this.begin("emu")):this.begin("mu"),yy_.yytext)return 12;break;case 1:return 12;case 2:return this.popState(),12;case 3:return yy_.yytext=yy_.yytext.substr(5,yy_.yyleng-9),this.popState(),15;case 4:return 12;case 5:return strip(0,4),this.popState(),13;case 6:return 45;case 7:return 46;case 8:return 16;case 9:return this.popState(),this.begin("raw"),18;case 10:return 34;case 11:return 24;case 12:return 29;case 13:return this.popState(),28;case 14:return this.popState(),28;case 15:return 26;case 16:return 26;case 17:return 32;case 18:return 31;case 19:this.popState(),this.begin("com");break;case 20:return strip(3,5),this.popState(),13;case 21:return 31;case 22:return 51;case 23:return 50;case 24:return 50;case 25:return 54;case 26:break;case 27:return this.popState(),33;case 28:return this.popState(),25;case 29:return yy_.yytext=strip(1,2).replace(/\\"/g,'"'),42;case 30:return yy_.yytext=strip(1,2).replace(/\\'/g,"'"),42;case 31:return 52;case 32:return 44;case 33:return 44;case 34:return 43;case 35:return 50;case 36:return yy_.yytext=strip(1,2),50;case 37:return"INVALID";case 38:return 5}},lexer.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],lexer.conditions={mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,38],inclusive:!0}},lexer}();return parser.lexer=lexer,Parser.prototype=parser,parser.Parser=Parser,new Parser}();return __exports__=handlebars}(),__module10__=function(__dependency1__){"use strict";function stripFlags(open,close){return{left:"~"===open.charAt(2),right:"~"===close.charAt(close.length-3)}}function prepareBlock(mustache,program,inverseAndProgram,close,inverted,locInfo){if(mustache.sexpr.id.original!==close.path.original)throw new Exception(mustache.sexpr.id.original+" doesn't match "+close.path.original,mustache);var inverse=inverseAndProgram&&inverseAndProgram.program,strip={left:mustache.strip.left,right:close.strip.right,openStandalone:isNextWhitespace(program.statements),closeStandalone:isPrevWhitespace((inverse||program).statements)};if(mustache.strip.right&&omitRight(program.statements,null,!0),inverse){var inverseStrip=inverseAndProgram.strip;inverseStrip.left&&omitLeft(program.statements,null,!0),inverseStrip.right&&omitRight(inverse.statements,null,!0),close.strip.left&&omitLeft(inverse.statements,null,!0),isPrevWhitespace(program.statements)&&isNextWhitespace(inverse.statements)&&(omitLeft(program.statements),omitRight(inverse.statements))}else close.strip.left&&omitLeft(program.statements,null,!0);return inverted?new this.BlockNode(mustache,inverse,program,strip,locInfo):new this.BlockNode(mustache,program,inverse,strip,locInfo)}function prepareProgram(statements,isRoot){for(var i=0,l=statements.length;l>i;i++){var current=statements[i],strip=current.strip;if(strip){var _isPrevWhitespace=isPrevWhitespace(statements,i,isRoot,"partial"===current.type),_isNextWhitespace=isNextWhitespace(statements,i,isRoot),openStandalone=strip.openStandalone&&_isPrevWhitespace,closeStandalone=strip.closeStandalone&&_isNextWhitespace,inlineStandalone=strip.inlineStandalone&&_isPrevWhitespace&&_isNextWhitespace;strip.right&&omitRight(statements,i,!0),strip.left&&omitLeft(statements,i,!0),inlineStandalone&&(omitRight(statements,i),omitLeft(statements,i)&&"partial"===current.type&&(current.indent=/([ \t]+$)/.exec(statements[i-1].original)?RegExp.$1:"")),openStandalone&&(omitRight((current.program||current.inverse).statements),omitLeft(statements,i)),closeStandalone&&(omitRight(statements,i),omitLeft((current.inverse||current.program).statements))}}return statements}function isPrevWhitespace(statements,i,isRoot){void 0===i&&(i=statements.length);var prev=statements[i-1],sibling=statements[i-2];return prev?"content"===prev.type?(sibling||!isRoot?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(prev.original):void 0:isRoot}function isNextWhitespace(statements,i,isRoot){void 0===i&&(i=-1);var next=statements[i+1],sibling=statements[i+2];return next?"content"===next.type?(sibling||!isRoot?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(next.original):void 0:isRoot}function omitRight(statements,i,multiple){var current=statements[null==i?0:i+1];if(current&&"content"===current.type&&(multiple||!current.rightStripped)){var original=current.string;current.string=current.string.replace(multiple?/^\s+/:/^[ \t]*\r?\n?/,""),current.rightStripped=current.string!==original}}function omitLeft(statements,i,multiple){var current=statements[null==i?statements.length-1:i-1];if(current&&"content"===current.type&&(multiple||!current.leftStripped)){var original=current.string;return current.string=current.string.replace(multiple?/\s+$/:/[ \t]+$/,""),current.leftStripped=current.string!==original,current.leftStripped}}var __exports__={},Exception=__dependency1__;return __exports__.stripFlags=stripFlags,__exports__.prepareBlock=prepareBlock,__exports__.prepareProgram=prepareProgram,__exports__}(__module5__),__module8__=function(__dependency1__,__dependency2__,__dependency3__,__dependency4__){"use strict";function parse(input){return input.constructor===AST.ProgramNode?input:(parser.yy=yy,parser.parse(input))}var __exports__={},parser=__dependency1__,AST=__dependency2__,Helpers=__dependency3__,extend=__dependency4__.extend;__exports__.parser=parser;var yy={};return extend(yy,Helpers,AST),__exports__.parse=parse,__exports__}(__module9__,__module7__,__module10__,__module3__),__module11__=function(__dependency1__,__dependency2__){"use strict";function Compiler(){}function precompile(input,options,env){if(null==input||"string"!=typeof input&&input.constructor!==env.AST.ProgramNode)throw new Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+input);options=options||{},"data"in options||(options.data=!0),options.compat&&(options.useDepths=!0);var ast=env.parse(input),environment=(new env.Compiler).compile(ast,options);return(new env.JavaScriptCompiler).compile(environment,options)}function compile(input,options,env){function compileInput(){var ast=env.parse(input),environment=(new env.Compiler).compile(ast,options),templateSpec=(new env.JavaScriptCompiler).compile(environment,options,void 0,!0);return env.template(templateSpec)}if(null==input||"string"!=typeof input&&input.constructor!==env.AST.ProgramNode)throw new Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);options=options||{},"data"in options||(options.data=!0),options.compat&&(options.useDepths=!0);var compiled,ret=function(context,options){return compiled||(compiled=compileInput()),compiled.call(this,context,options)};return ret._setup=function(options){return compiled||(compiled=compileInput()),compiled._setup(options)},ret._child=function(i,data,depths){return compiled||(compiled=compileInput()),compiled._child(i,data,depths)},ret}function argEquals(a,b){if(a===b)return!0;if(isArray(a)&&isArray(b)&&a.length===b.length){for(var i=0;i<a.length;i++)if(!argEquals(a[i],b[i]))return!1;return!0}}var __exports__={},Exception=__dependency1__,isArray=__dependency2__.isArray,slice=[].slice;return __exports__.Compiler=Compiler,Compiler.prototype={compiler:Compiler,equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len)return!1;for(var i=0;len>i;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||!argEquals(opcode.args,otherOpcode.args))return!1}for(len=this.children.length,i=0;len>i;i++)if(!this.children[i].equals(other.children[i]))return!1;return!0},guid:0,compile:function(program,options){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=options,this.stringParams=options.stringParams,this.trackIds=options.trackIds;var knownHelpers=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0,lookup:!0},knownHelpers)for(var name in knownHelpers)this.options.knownHelpers[name]=knownHelpers[name];return this.accept(program)},accept:function(node){return this[node.type](node)},program:function(program){for(var statements=program.statements,i=0,l=statements.length;l>i;i++)this.accept(statements[i]);return this.isSimple=1===l,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(program){var depth,result=(new this.compiler).compile(program,this.options),guid=this.guid++;this.usePartial=this.usePartial||result.usePartial,this.children[guid]=result;for(var i=0,l=result.depths.list.length;l>i;i++)depth=result.depths.list[i],2>depth||this.addDepth(depth-1);return guid},block:function(block){var mustache=block.mustache,program=block.program,inverse=block.inverse;program&&(program=this.compileProgram(program)),inverse&&(inverse=this.compileProgram(inverse));var sexpr=mustache.sexpr,type=this.classifySexpr(sexpr);"helper"===type?this.helperSexpr(sexpr,program,inverse):"simple"===type?(this.simpleSexpr(sexpr),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("blockValue",sexpr.id.original)):(this.ambiguousSexpr(sexpr,program,inverse),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(hash){var i,l,pairs=hash.pairs;for(this.opcode("pushHash"),i=0,l=pairs.length;l>i;i++)this.pushParam(pairs[i][1]);for(;i--;)this.opcode("assignToHash",pairs[i][0]);this.opcode("popHash")},partial:function(partial){var partialName=partial.partialName;this.usePartial=!0,partial.hash?this.accept(partial.hash):this.opcode("push","undefined"),partial.context?this.accept(partial.context):(this.opcode("getContext",0),this.opcode("pushContext")),this.opcode("invokePartial",partialName.name,partial.indent||""),this.opcode("append")},content:function(content){content.string&&this.opcode("appendContent",content.string)},mustache:function(mustache){this.sexpr(mustache.sexpr),mustache.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(sexpr,program,inverse){var id=sexpr.id,name=id.parts[0],isBlock=null!=program||null!=inverse;this.opcode("getContext",id.depth),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.ID(id),this.opcode("invokeAmbiguous",name,isBlock)},simpleSexpr:function(sexpr){var id=sexpr.id;"DATA"===id.type?this.DATA(id):id.parts.length?this.ID(id):(this.addDepth(id.depth),this.opcode("getContext",id.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(sexpr,program,inverse){var params=this.setupFullMustacheParams(sexpr,program,inverse),id=sexpr.id,name=id.parts[0];if(this.options.knownHelpers[name])this.opcode("invokeKnownHelper",params.length,name);else{if(this.options.knownHelpersOnly)throw new Exception("You specified knownHelpersOnly, but used the unknown helper "+name,sexpr);id.falsy=!0,this.ID(id),this.opcode("invokeHelper",params.length,id.original,id.isSimple)}},sexpr:function(sexpr){var type=this.classifySexpr(sexpr);"simple"===type?this.simpleSexpr(sexpr):"helper"===type?this.helperSexpr(sexpr):this.ambiguousSexpr(sexpr)},ID:function(id){this.addDepth(id.depth),this.opcode("getContext",id.depth);var name=id.parts[0];name?this.opcode("lookupOnContext",id.parts,id.falsy,id.isScoped):this.opcode("pushContext")},DATA:function(data){this.options.data=!0,this.opcode("lookupData",data.id.depth,data.id.parts)},STRING:function(string){this.opcode("pushString",string.string)},NUMBER:function(number){this.opcode("pushLiteral",number.number)},BOOLEAN:function(bool){this.opcode("pushLiteral",bool.bool)},comment:function(){},opcode:function(name){this.opcodes.push({opcode:name,args:slice.call(arguments,1)})},addDepth:function(depth){0!==depth&&(this.depths[depth]||(this.depths[depth]=!0,this.depths.list.push(depth)))},classifySexpr:function(sexpr){var isHelper=sexpr.isHelper,isEligible=sexpr.eligibleHelper,options=this.options;if(isEligible&&!isHelper){var name=sexpr.id.parts[0];options.knownHelpers[name]?isHelper=!0:options.knownHelpersOnly&&(isEligible=!1)}return isHelper?"helper":isEligible?"ambiguous":"simple"},pushParams:function(params){for(var i=0,l=params.length;l>i;i++)this.pushParam(params[i])},pushParam:function(val){this.stringParams?(val.depth&&this.addDepth(val.depth),this.opcode("getContext",val.depth||0),this.opcode("pushStringParam",val.stringModeValue,val.type),"sexpr"===val.type&&this.sexpr(val)):(this.trackIds&&this.opcode("pushId",val.type,val.idName||val.stringModeValue),this.accept(val))},setupFullMustacheParams:function(sexpr,program,inverse){var params=sexpr.params;return this.pushParams(params),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),sexpr.hash?this.hash(sexpr.hash):this.opcode("emptyHash"),params}},__exports__.precompile=precompile,__exports__.compile=compile,__exports__}(__module5__,__module3__),__module12__=function(__dependency1__,__dependency2__){"use strict";function Literal(value){this.value=value}function JavaScriptCompiler(){}var __exports__,COMPILER_REVISION=__dependency1__.COMPILER_REVISION,REVISION_CHANGES=__dependency1__.REVISION_CHANGES,Exception=__dependency2__;JavaScriptCompiler.prototype={nameLookup:function(parent,name){return JavaScriptCompiler.isValidJavaScriptVariableName(name)?parent+"."+name:parent+"['"+name+"']"},depthedLookup:function(name){return this.aliases.lookup="this.lookup",'lookup(depths, "'+name+'")'},compilerInfo:function(){var revision=COMPILER_REVISION,versions=REVISION_CHANGES[revision];return[revision,versions]},appendToBuffer:function(string){return this.environment.isSimple?"return "+string+";":{appendToBuffer:!0,content:string,toString:function(){return"buffer += "+string+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment,this.options=options,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!asObject,this.name=this.environment.name,this.isChild=!!context,this.context=context||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(environment,options),this.useDepths=this.useDepths||environment.depths.list.length||this.options.compat;var opcode,i,l,opcodes=environment.opcodes;for(i=0,l=opcodes.length;l>i;i++)opcode=opcodes[i],this[opcode.opcode].apply(this,opcode.args);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new Exception("Compile completed with content left on stack");var fn=this.createFunctionContext(asObject);if(this.isChild)return fn;var ret={compiler:this.compilerInfo(),main:fn},programs=this.context.programs;for(i=0,l=programs.length;l>i;i++)programs[i]&&(ret[i]=programs[i]);return this.environment.usePartial&&(ret.usePartial=!0),this.options.data&&(ret.useData=!0),this.useDepths&&(ret.useDepths=!0),this.options.compat&&(ret.compat=!0),asObject||(ret.compiler=JSON.stringify(ret.compiler),ret=this.objectLiteral(ret)),ret},preamble:function(){this.lastContext=0,this.source=[]},createFunctionContext:function(asObject){var varDeclarations="",locals=this.stackVars.concat(this.registers.list);locals.length>0&&(varDeclarations+=", "+locals.join(", "));for(var alias in this.aliases)this.aliases.hasOwnProperty(alias)&&(varDeclarations+=", "+alias+"="+this.aliases[alias]);var params=["depth0","helpers","partials","data"];this.useDepths&&params.push("depths");var source=this.mergeSource(varDeclarations);return asObject?(params.push(source),Function.apply(this,params)):"function("+params.join(",")+") {\n  "+source+"}"},mergeSource:function(varDeclarations){for(var buffer,appendFirst,source="",appendOnly=!this.forceBuffer,i=0,len=this.source.length;len>i;i++){var line=this.source[i];line.appendToBuffer?buffer=buffer?buffer+"\n    + "+line.content:line.content:(buffer&&(source?source+="buffer += "+buffer+";\n  ":(appendFirst=!0,source=buffer+";\n  "),buffer=void 0),source+=line+"\n  ",this.environment.isSimple||(appendOnly=!1))}return appendOnly?(buffer||!source)&&(source+="return "+(buffer||'""')+";\n"):(varDeclarations+=", buffer = "+(appendFirst?"":this.initializeBuffer()),source+=buffer?"return buffer + "+buffer+";\n":"return buffer;\n"),varDeclarations&&(source="var "+varDeclarations.substring(2)+(appendFirst?"":";\n  ")+source),source},blockValue:function(name){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var params=[this.contextName(0)];this.setupParams(name,0,params);var blockName=this.popStack();params.splice(1,0,blockName),this.push("blockHelperMissing.call("+params.join(", ")+")")},ambiguousBlockValue:function(){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var params=[this.contextName(0)];this.setupParams("",0,params,!0),this.flushInline();var current=this.topStack();params.splice(1,0,current),this.pushSource("if (!"+this.lastHelper+") { "+current+" = blockHelperMissing.call("+params.join(", ")+"); }")},appendContent:function(content){this.pendingContent&&(content=this.pendingContent+content),this.pendingContent=content},append:function(){this.flushInline();var local=this.popStack();this.pushSource("if ("+local+" != null) { "+this.appendToBuffer(local)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(depth){this.lastContext=depth},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(parts,falsy,scoped){var i=0,len=parts.length;for(scoped||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(parts[i++]));len>i;i++)this.replaceStack(function(current){var lookup=this.nameLookup(current,parts[i],"context");return falsy?" && "+lookup:" != null ? "+lookup+" : "+current})},lookupData:function(depth,parts){depth?this.pushStackLiteral("this.data(data, "+depth+")"):this.pushStackLiteral("data");for(var len=parts.length,i=0;len>i;i++)this.replaceStack(function(current){return" && "+this.nameLookup(current,parts[i],"data")})},resolvePossibleLambda:function(){this.aliases.lambda="this.lambda",this.push("lambda("+this.popStack()+", "+this.contextName(0)+")")},pushStringParam:function(string,type){this.pushContext(),this.pushString(type),"sexpr"!==type&&("string"==typeof string?this.pushString(string):this.pushStackLiteral(string))},emptyHash:function(){this.pushStackLiteral("{}"),this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var hash=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push("{"+hash.ids.join(",")+"}"),this.stringParams&&(this.push("{"+hash.contexts.join(",")+"}"),this.push("{"+hash.types.join(",")+"}")),this.push("{\n    "+hash.values.join(",\n    ")+"\n  }")},pushString:function(string){this.pushStackLiteral(this.quotedString(string))},push:function(expr){return this.inlineStack.push(expr),expr},pushLiteral:function(value){this.pushStackLiteral(value)},pushProgram:function(guid){null!=guid?this.pushStackLiteral(this.programExpression(guid)):this.pushStackLiteral(null)},invokeHelper:function(paramSize,name,isSimple){this.aliases.helperMissing="helpers.helperMissing";var nonHelper=this.popStack(),helper=this.setupHelper(paramSize,name),lookup=(isSimple?helper.name+" || ":"")+nonHelper+" || helperMissing";this.push("(("+lookup+").call("+helper.callParams+"))")},invokeKnownHelper:function(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(helper.name+".call("+helper.callParams+")")},invokeAmbiguous:function(name,helperCall){this.aliases.functionType='"function"',this.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var nonHelper=this.popStack();this.emptyHash();var helper=this.setupHelper(0,name,helperCall),helperName=this.lastHelper=this.nameLookup("helpers",name,"helper");this.push("((helper = (helper = "+helperName+" || "+nonHelper+") != null ? helper : helperMissing"+(helper.paramsInit?"),("+helper.paramsInit:"")+"),(typeof helper === functionType ? helper.call("+helper.callParams+") : helper))")},invokePartial:function(name,indent){var params=[this.nameLookup("partials",name,"partial"),"'"+indent+"'","'"+name+"'",this.popStack(),this.popStack(),"helpers","partials"];this.options.data?params.push("data"):this.options.compat&&params.push("undefined"),this.options.compat&&params.push("depths"),this.push("this.invokePartial("+params.join(", ")+")")},assignToHash:function(key){var context,type,id,value=this.popStack();this.trackIds&&(id=this.popStack()),this.stringParams&&(type=this.popStack(),context=this.popStack());var hash=this.hash;context&&hash.contexts.push("'"+key+"': "+context),type&&hash.types.push("'"+key+"': "+type),id&&hash.ids.push("'"+key+"': "+id),hash.values.push("'"+key+"': ("+value+")")},pushId:function(type,name){"ID"===type||"DATA"===type?this.pushString(name):"sexpr"===type?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){for(var child,compiler,children=environment.children,i=0,l=children.length;l>i;i++){child=children[i],compiler=new this.compiler;var index=this.matchExistingProgram(child);null==index?(this.context.programs.push(""),index=this.context.programs.length,child.index=index,child.name="program"+index,this.context.programs[index]=compiler.compile(child,options,this.context,!this.precompile),this.context.environments[index]=child,this.useDepths=this.useDepths||compiler.useDepths):(child.index=index,child.name="program"+index)}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;len>i;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child))return i}},programExpression:function(guid){var child=this.environment.children[guid],useDepths=(child.depths.list,this.useDepths),programParams=[child.index,"data"];return useDepths&&programParams.push("depths"),"this.program("+programParams.join(", ")+")"},useRegister:function(name){this.registers[name]||(this.registers[name]=!0,this.registers.list.push(name))},pushStackLiteral:function(item){return this.push(new Literal(item))},pushSource:function(source){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),source&&this.source.push(source)},pushStack:function(item){this.flushInline();var stack=this.incrStack();return this.pushSource(stack+" = "+item+";"),this.compileStack.push(stack),stack},replaceStack:function(callback){var stack,createdStack,usedLiteral,prefix="";this.isInline();if(!this.isInline())throw new Exception("replaceStack on non-inline");var top=this.popStack(!0);if(top instanceof Literal)prefix=stack=top.value,usedLiteral=!0;else{createdStack=!this.stackSlot;var name=createdStack?this.incrStack():this.topStackName();prefix="("+this.push(name)+" = "+top+")",stack=this.topStack()}var item=callback.call(this,stack);usedLiteral||this.popStack(),createdStack&&this.stackSlot--,this.push("("+prefix+item+")")},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var inlineStack=this.inlineStack;if(inlineStack.length){this.inlineStack=[];for(var i=0,len=inlineStack.length;len>i;i++){var entry=inlineStack[i];entry instanceof Literal?this.compileStack.push(entry):this.pushStack(entry)}}},isInline:function(){return this.inlineStack.length},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&item instanceof Literal)return item.value;if(!inline){if(!this.stackSlot)throw new Exception("Invalid stack pop");this.stackSlot--}return item},topStack:function(){var stack=this.isInline()?this.inlineStack:this.compileStack,item=stack[stack.length-1];return item instanceof Literal?item.value:item},contextName:function(context){return this.useDepths&&context?"depths["+context+"]":"depth"+context},quotedString:function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(obj){var pairs=[];for(var key in obj)obj.hasOwnProperty(key)&&pairs.push(this.quotedString(key)+":"+obj[key]);return"{"+pairs.join(",")+"}"},setupHelper:function(paramSize,name,blockHelper){var params=[],paramsInit=this.setupParams(name,paramSize,params,blockHelper),foundHelper=this.nameLookup("helpers",name,"helper");return{params:params,paramsInit:paramsInit,name:foundHelper,callParams:[this.contextName(0)].concat(params).join(", ")}},setupOptions:function(helper,paramSize,params){var param,inverse,program,options={},contexts=[],types=[],ids=[];options.name=this.quotedString(helper),options.hash=this.popStack(),this.trackIds&&(options.hashIds=this.popStack()),this.stringParams&&(options.hashTypes=this.popStack(),options.hashContexts=this.popStack()),inverse=this.popStack(),program=this.popStack(),(program||inverse)&&(program||(program="this.noop"),inverse||(inverse="this.noop"),options.fn=program,options.inverse=inverse);for(var i=paramSize;i--;)param=this.popStack(),params[i]=param,this.trackIds&&(ids[i]=this.popStack()),this.stringParams&&(types[i]=this.popStack(),contexts[i]=this.popStack());return this.trackIds&&(options.ids="["+ids.join(",")+"]"),this.stringParams&&(options.types="["+types.join(",")+"]",options.contexts="["+contexts.join(",")+"]"),this.options.data&&(options.data="data"),options},setupParams:function(helperName,paramSize,params,useRegister){var options=this.objectLiteral(this.setupOptions(helperName,paramSize,params));return useRegister?(this.useRegister("options"),params.push("options"),"options="+options):(params.push(options),"")}};for(var reservedWords="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),compilerWords=JavaScriptCompiler.RESERVED_WORDS={},i=0,l=reservedWords.length;l>i;i++)compilerWords[reservedWords[i]]=!0;return JavaScriptCompiler.isValidJavaScriptVariableName=function(name){return!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name)},__exports__=JavaScriptCompiler}(__module2__,__module5__),__module0__=function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__){"use strict";var __exports__,Handlebars=__dependency1__,AST=__dependency2__,Parser=__dependency3__.parser,parse=__dependency3__.parse,Compiler=__dependency4__.Compiler,compile=__dependency4__.compile,precompile=__dependency4__.precompile,JavaScriptCompiler=__dependency5__,_create=Handlebars.create,create=function(){var hb=_create();return hb.compile=function(input,options){return compile(input,options,hb)},hb.precompile=function(input,options){return precompile(input,options,hb)},hb.AST=AST,hb.Compiler=Compiler,hb.JavaScriptCompiler=JavaScriptCompiler,hb.Parser=Parser,hb.parse=parse,hb};return Handlebars=create(),Handlebars.create=create,Handlebars["default"]=Handlebars,__exports__=Handlebars}(__module1__,__module7__,__module8__,__module11__,__module12__);return __module0__}),define("assets/hldm/templating/template-runner",["handlebars"],function(handlebars){function render(template,data){var result=handlebars.compile(template,{noEscape:!0})(data);return result}var exports={render:render};return exports}),define("text!assets/hldm/templating/partials/load-field-list.txt",[],function(){return"{{#comma-separated fields}}\r\n{{#if selected}}{{quote name}}{{#alias}} AS {{quote .}}{{/alias}}{{/if}}\r\n{{/comma-separated}}"}),define("text!assets/hldm/templating/partials/sql-field-list.txt",[],function(){return"{{#comma-separated fields}}\r\n {{#if selected}}{{sql-quote name ../../connectionInfo.dbInfo}}{{/if}}\r\n{{/comma-separated}}"}),define("assets/hldm/templating/template-helpers",["util","handlebars","assets/hldm/templating/template-runner","text!assets/hldm/templating/partials/load-field-list.txt","text!assets/hldm/templating/partials/sql-field-list.txt"],function(util,handlebars,templateRunner,loadFieldListTemplate,sqlFieldListTemplate,sqlLoadTemplate){handlebars.registerPartial("sql-load",sqlLoadTemplate),handlebars.registerHelper("comma-separated",function(context,block){var ret="";if(context)for(var i=0,j=context.length;j>i;i++){var row=block.fn(context[i]);row.length>0&&"\n"===row[row.length-1]&&(row=row.substring(0,row.length-1)),row.length>0&&"\r"===row[row.length-1]&&(row=row.substring(0,row.length-1)),ret+=row,j-1>i&&(ret+=",\n	")}return ret}),handlebars.registerHelper("quote",function(context){return util.qouteScript(context)}),handlebars.registerHelper("load-file-from-lib",function(dataconnectorName,databaseName){return databaseName?util.qouteScript("lib://"+dataconnectorName+"/"+databaseName):util.qouteScript("lib://"+dataconnectorName)}),handlebars.registerHelper("sql-quote",function(name,connectionInfo){return connectionInfo.quoteprefix+name+connectionInfo.quotesuffix}),handlebars.registerHelper("sql-field-list",function(fields,connectionInfo){var result=templateRunner.render(sqlFieldListTemplate,{fields:fields,connectionInfo:connectionInfo});return result}),handlebars.registerHelper("load-field-list",function(fields){var result=templateRunner.render(loadFieldListTemplate,{fields:fields});return result}),handlebars.registerHelper("database-owner-table",function(databaseName,ownerName,tableName,dsInfo){function maybeQuote(x){return dsInfo.quoteprefix+x+dsInfo.quotesuffix;
}var result="",access="ACCESS"===(dsInfo.dbmsname||"").toUpperCase();return dsInfo.dbfirst?(dsInfo.dbusage&&!access&&databaseName&&(result+=maybeQuote(databaseName)+dsInfo.dbseparator),dsInfo.ownerusage&&ownerName&&(result+=maybeQuote(ownerName)+dsInfo.ownerseparator),result+=maybeQuote(tableName)):(dsInfo.ownerusage&&ownerName&&(result+=maybeQuote(ownerName)+dsInfo.ownerseparator),result+=maybeQuote(tableName),dsInfo.dbusage&&databaseName&&(result+=dsInfo.dbseparator+maybeQuote(databaseName))),result})}),define("assets/hldm/box-types/interval-match",[],function(){var exports={type:"join",template:"{{tableName}}:IntervalMatch ({{dependencies.events.model.event}}) Load distinct {{intervalStart}}, {{intervalEnd}} resident {{dependencies.intervals.model.tableName}};",inject:{from:{type:"table",prefix:"JOIN ({{dependencies.to.model.tableName}})"},to:{type:"table",prefix:"/* Join target for key */"}},sideeffects:{from:{type:"newGeneration",fields:function(model){return model.dependencies.from.model.fields.concat(model.dependencies.to.model.fields)}},to:{type:"destroyed"}},crossDependencies:{from:"to"},definition:{type:"items",component:"accordion",items:{settings:{type:"items",component:"expandable-items",translation:"Common.Appearance",items:{metadata:{type:"items",translation:"properties.metadata",grouped:!0,items:{name:{translation:"From Table Jey",type:"string",ref:"dependencies.from.key"},description:{translation:"To Table Key",type:"string",component:"string",ref:"dependencies.to.key",maxlength:512}}}}}}},initialProperties:{boxType:"join",category:"join",joinType:"left",dependencies:{from:{key:"Documents:gitignore_global.txt:TYPE9_CSV:gitignore_global.txt"},to:{key:"NorthWind:C:\\QVFiles\\Northwind.mdb:undefined:Q_Orders"}}},run:function(){}};return exports}),define("assets/hldm/models/box-types-model",["assets/hldm/box-types/load-file","assets/hldm/box-types/load-sql","assets/hldm/box-types/join","assets/hldm/box-types/new-generation","assets/hldm/templating/template-helpers","assets/hldm/box-types/interval-match"],function(loadFile,loadSql,join,newGeneration){function getBoxType(boxType){return boxTypes[boxType]}var boxTypes={};boxTypes[loadFile.type]=loadFile,boxTypes[loadSql.type]=loadSql,boxTypes[join.type]=join,boxTypes[newGeneration.type]=newGeneration;var exports={getBoxType:getBoxType};return exports}),define("assets/hldm/models/load-model-traverser",["jquery","assets/hldm/models/box-types-model"],function($,boxTypesModel){function prepareLoadModelForTraversal(loadModel){var inputs=loadModel.tableModels.map(function(tableModel){var result=$.extend(!0,{},tableModel.data,{connectionInfo:loadModel.getConnectionMetaDataModel(tableModel.data.dataconnectorName)});return result.fields=result.fields.filter(function(field){return field.selected}),result.fields.forEach(function(field){Object.defineProperty(field,"actualName",{set:function(fieldName){this.alias=fieldName,tableModel.setFieldAlias(this.name,fieldName)},get:function(){return this.alias||this.name}}),field.alias===field.name&&delete field.alias}),result.originalModel=tableModel,Object.defineProperty(result,"assocloc",{set:function(assocloc){tableModel.data.assocloc=assocloc},get:function(){return tableModel.data.assocloc}}),result}),transformations=loadModel.transformations.map(function(transformation){var result=$.extend(!0,{},transformation.data,{});return result.originalModel=transformation,result}),all=[].concat(inputs,transformations);for(var i in all)all[i].dependants=[],all[i].dependencies=all[i].dependencies||[],all[i].implicitDependencies=[],all[i].boxTypeDef=boxTypesModel.getBoxType(all[i].boxType),all[i].sufferedSideEffects={neverExisted:!1,newGeneration:!1};return all}function fillInNewGenerations(list){function defineDynamicFields(_newModel,_sideEffect,_step,_affectedModel){function getFields(){try{var result=_sideEffect.fields?_sideEffect.fields(_step):_affectedModel.fields;return result}catch(e){return[]}}_newModel.isFieldsDynamic=!0,_newModel.getFields=getFields}function find(key){for(i in list)if(list[i].key===key)return list[i];return void 0}for(var i in list){var step=list[i];if(step.boxTypeDef.sideeffects)for(var dependency in step.boxTypeDef.sideeffects){var sideEffectType=step.boxTypeDef.sideeffects[dependency].type,sideEffect=step.boxTypeDef.sideeffects[dependency],dependencyKey=step.dependencies[dependency].key;if("newGeneration"===sideEffectType){var affectedModel=find(dependencyKey);if(affectedModel){affectedModel.generation=affectedModel.generation||1;var newModel={boxType:"newGeneration",key:dependencyKey+"|"+step.key,tableName:affectedModel.tableName,tableAlias:affectedModel.tableName,dependencies:{parent:{key:step.key,type:"table"}},dependants:[],implicitDependencies:[],boxTypeDef:boxTypesModel.getBoxType("newGeneration"),sufferedSideEffects:{neverExisted:!1,newGeneration:!1},generation:affectedModel.generation+1,originalModel:{}};step.generation=newModel.generation,defineDynamicFields(newModel,sideEffect,step,affectedModel),list.push(newModel)}else window.console.log("Could not find model,",dependencyKey)}}}}function layoutDependencies(list){function find(key){for(i in list)if(list[i].key===key)return list[i];return void 0}for(var i in list){var transformation=list[i];if(transformation.dependencies)for(var j in transformation.dependencies){var dependency=transformation.dependencies[j],dependencyModelData=find(dependency.key);dependencyModelData&&(dependency.model=dependencyModelData,dependencyModelData.dependants.push(transformation))}}}function layoutImplicitCrossDependencies(list){for(var i in list){var transformation=list[i];if(transformation.dependencies){var boxType=boxTypesModel.getBoxType(transformation.boxType);for(var from in boxType.crossDependencies){var to=boxType.crossDependencies[from],toModel=transformation.dependencies[to].model,fromModel=transformation.dependencies[from].model;toModel&&fromModel?(toModel.dependants.push(fromModel),fromModel.implicitDependencies.push(toModel)):window.console.log("Dependencies not found")}}}}function sortModelsForInjections(list){function traverseModel(model){if(model&&!model.alreadyInjected){model.alreadyInjected=!0;for(var i in model.dependants){var dependant=model.dependants[i];dependant.boxTypeDef.sideeffects&&window.console.log("Sideffect dependant found on ",model.key),traverseModel(dependant)}sorted.push(model)}}var sorted=[];for(var i in list)traverseModel(list[i]);return sorted}function sortModelsForOutput(list){function traverseModel(model){if(model&&!model.alreadyOutput){model.alreadyOutput=!0;for(i in model.dependencies)dependant=model.dependencies[i].model,traverseModel(dependant);for(i in model.implicitDependencies)dependant=model.implicitDependencies[i],traverseModel(dependant);sorted.push(model)}}var i,dependant,sorted=[];for(i in list)traverseModel(list[i]);return sorted}function applySideEffects(sortedForOutput){for(var i in sortedForOutput){var step=sortedForOutput[i];if(step.boxTypeDef.sideeffects)for(var dependency in step.boxTypeDef.sideeffects){var sideEffectType=step.boxTypeDef.sideeffects[dependency].type,affectedModel=step.dependencies[dependency].model;affectedModel&&(affectedModel.sufferedSideEffects[sideEffectType]=!0)}step.isFieldsDynamic&&(step.fields=step.getFields())}}function compileToLoadExecutionModel(loadModel){var steps=prepareLoadModelForTraversal(loadModel);fillInNewGenerations(steps),layoutDependencies(steps),layoutImplicitCrossDependencies(steps);var sortedForInjections=sortModelsForInjections(steps),sortedForOutput=sortModelsForOutput(steps);return applySideEffects(sortedForOutput),{sortedForInjections:sortedForInjections,sortedForOutput:sortedForOutput}}function compiledTables(loadModel){var loadExecutionModel=compileToLoadExecutionModel(loadModel);return loadExecutionModel.sortedForOutput.filter(function(step){return!(step.sufferedSideEffects&&(step.sufferedSideEffects.destroyed||step.sufferedSideEffects.newGeneration||step.sufferedSideEffects.neverExisted))&&step.fields&&step.fields.length>0})}var exports={compiledTables:compiledTables,compileToLoadExecutionModel:compileToLoadExecutionModel};return exports}),define("assets/hldm/models/load-model-compiler",["ng!$q","assets/hldm/templating/template-runner","assets/hldm/models/box-types-model","assets/hldm/models/load-model-traverser","util"],function($q,templateRunner,boxTypesModel,loadModelTraverser,util){function compileLoadModelToScript(loadModel,dataconnectorsModel){function renderModel(step){var serversideProxy,connection=dataconnectorsModel.getConnectionFromModel(step.dataconnectorName);return connection&&connection.connectorMain&&connection.connectorMain.generateSelectScript?(serversideProxy=dataconnectorsModel.getConnectionServersideProxy(step.connectionInfo.type,step.connectionInfo),connection.connectorMain.generateSelectScript(serversideProxy,step)):connection&&connection.connectorMain&&connection.connectorMain.getScriptTemplate?(serversideProxy=dataconnectorsModel.getConnectionServersideProxy(step.connectionInfo.type,step.connectionInfo),$q.when(connection.connectorMain.getScriptTemplate(serversideProxy,step)).then(function(template){return templateRunner.render(template)})):$q.when(templateRunner.render(boxTypesModel.getBoxType(step.boxType).template,step))}function performScriptInjections(modelsList){for(i in modelsList){var model=modelsList[i];for(var d in model.dependencies){var dependency=model.dependencies[d],injects=model.boxTypeDef.inject?model.boxTypeDef.inject[d]:[];for(var i in injects)if(dependency.model){dependency.model.inject=dependency.model.inject||[],dependency.model.inject[i]=dependency.model.inject[i]||[];var injectTemplate=injects[i];dependency.model.inject[i].push(templateRunner.render(injectTemplate,model))}}}}function renderFullScript(sortedForOutput){var arrayOfPromisedScriptSnippets=$q.all(sortedForOutput.map(function(step){return renderModel(step).then(function(stepScript){var stepName=step.tableAlias||step.tableName;return stepName&&(stepScript=util.qouteScript(stepName)+":\n"+stepScript),stepScript})}));return arrayOfPromisedScriptSnippets.then(function(scriptSnippetArray){return scriptSnippetArray.length>0?scriptSnippetArray.reduce(function(previousValue,currentValue){return previousValue+"\n\n"+currentValue}):""})}function generateRunScript(){var loadExecutionModel=loadModelTraverser.compileToLoadExecutionModel(loadModel);return performScriptInjections(loadExecutionModel.sortedForInjections),renderFullScript(loadExecutionModel.sortedForOutput)}return generateRunScript()}var exports={compileLoadModelToScript:compileLoadModelToScript};return exports}),define("assets/scripteditor/models/qscript-serializer",["translator","pubsub"],function(translator){"use strict";function stringify(tabs){var i,totalScript="";for(i=0;i<tabs.length;i++)i>0&&(totalScript+="\r\n"),totalScript+=TABSTART,totalScript+=tabs[i].name,totalScript+="\r\n",tabs[i].autogenerated&&(totalScript+="///$autogenerated",totalScript+="\r\n"),totalScript+=tabs[i].content;return totalScript.replace(/\n/g,"\r\n").replace(/\r\r\n/g,"\r\n")}function parse(s){function getTabStartLength(s,ix){var i,tabStart="///$tab ",tabLen=0;for(10===s.charCodeAt(ix)&&(tabLen+=1,ix+=1),i=0;i<tabStart.length;i++){if(tabStart.charCodeAt(i)!==s.charCodeAt(ix+i))return 0;tabLen++}return tabLen}function getTabName(s,ix){for(var cc,name="";ix<s.length;){if(cc=s.charCodeAt(ix),10===cc){ix++;break}name+=s.charAt(ix),ix++}return{name:name,pos:ix}}function getAutoGenerated(s,ix){var autoGeneratedToken="///$autogenerated",i=0;for(10===s.charCodeAt(ix)&&(ix+=1);i<autoGeneratedToken.length;){if(s.charCodeAt(ix+i)!==autoGeneratedToken.charCodeAt(i))return{autogenerated:!1,pos:ix};i++}return{autogenerated:!0,pos:ix+i+1}}function addTab(tabArr,tabName,autogenerated){tabArr[tabArr.length]={name:tabName,content:"",isHidden:!1,matches:0,autogenerated:autogenerated}}s=s.replace(/\r\n/g,"\n"),s=s.replace(/\r\n/g,"\n"),s=s.replace(/\r/g,"\n");for(var x,y,tabStartLen,pos=0,tabs=[];pos<s.length;)tabStartLen=getTabStartLength(s,pos),tabStartLen>0?(pos+=tabStartLen,x=getTabName(s,pos),pos=x.pos,y=getAutoGenerated(s,pos),pos=y.pos,addTab(tabs,x.name,y.autogenerated)):(0===tabs.length&&addTab(tabs,DEFAULT_TABNAME),tabs[tabs.length-1].content+=s.charAt(pos),pos++);return 0===tabs.length&&addTab(tabs,DEFAULT_TABNAME),tabs}var TABSTART="///$tab ",DEFAULT_TABNAME=translator.get("scripteditor.vtabs.newtabname");return pubsub.subscribe("/language/dataSet",function(){DEFAULT_TABNAME=translator.get("scripteditor.vtabs.newtabname")}),{stringify:stringify,parse:parse}}),define("assets/scripteditor/models/qscript-tab-error-model",[],function(){"use strict";function createQScriptTabErrorModel(){function _clearErrors(){tabErrors.content=[]}function _addError(error){tabErrors.content.push(error)}function _errorsUpdated(){tabErrors.currentErrorIndex>tabErrors.content.length&&(tabErrors.currentErrorIndex=tabErrors.content.length>0?tabErrors.content.length-1:0),distributeSelectionInfoToErrorArray()}function distributeSelectionInfoToErrorArray(){for(var i=0;i<tabErrors.content.length;i++)tabErrors.content[i].selected=i===tabErrors.currentErrorIndex}function selectNextError(overflowFn){tabErrors.currentErrorIndex<tabErrors.content.length-1?(tabErrors.currentErrorIndex++,distributeSelectionInfoToErrorArray()):(tabErrors.currentErrorIndex=0,distributeSelectionInfoToErrorArray(),overflowFn())}function selectPreviousError(overflowFn){tabErrors.currentErrorIndex>0?(tabErrors.currentErrorIndex--,distributeSelectionInfoToErrorArray()):(tabErrors.currentErrorIndex=tabErrors.content.length>0?tabErrors.content.length-1:0,distributeSelectionInfoToErrorArray(),overflowFn())}function selectFirstError(){tabErrors.currentErrorIndex=0}function selectLastError(){tabErrors.currentErrorIndex=tabErrors.content.length-1,tabErrors.currentErrorIndex<0&&(tabErrors.currentErrorIndex=0)}var tabErrors={content:[],currentErrorIndex:0,_clearErrors:_clearErrors,_addError:_addError,_errorsUpdated:_errorsUpdated,selectFirstError:selectFirstError,selectLastError:selectLastError,selectNextError:selectNextError,selectPreviousError:selectPreviousError};return tabErrors}var exports={createQScriptTabErrorModel:createQScriptTabErrorModel};return exports}),define("assets/scripteditor/models/qscript-tab-model",["assets/scripteditor/models/qscript-tab-error-model"],function(tabErrorModelModule){"use strict";function createQScriptTabModel(inputData,tabDataIsSaved){function toData(){return tabData}function calculateRowCount(){tab.lineCount=tab.content.split("\n").length}function setCurrentlyRunningLocalLineNbr(localLineNbr){tab.debugLineNbr=localLineNbr}function isModified(){return tabData.content!==savedTabData.content||tabData.name!==savedTabData.name||tabData.autogenerated!==savedTabData.autogenerated}function resetModified(){savedTabData={name:tabData.name,content:tabData.content,autogenerated:tabData.autogenerated||!1}}function addIncludedFileTab(includedFileTab){-1===tab.includedFileTabs.indexOf(includedFileTab)&&tab.includedFileTabs.push(includedFileTab)}var savedTabData,tabData={name:inputData.name,content:inputData.content,autogenerated:inputData.autogenerated||!1},errorModel=tabErrorModelModule.createQScriptTabErrorModel();savedTabData=tabDataIsSaved?{name:inputData.name,content:inputData.content,autogenerated:inputData.autogenerated||!1}:{name:void 0,content:void 0,autogenerated:void 0};var tab={lineCount:void 0,errors:errorModel,nbrOfSearchHits:0,headerSize:1,type:"qscript",breakpoints:inputData.breakpoints||{},debugLineNbr:void 0,setCurrentlyRunningLocalLineNbr:setCurrentlyRunningLocalLineNbr,isModified:isModified,resetModified:resetModified,toData:toData,calculateRowCount:calculateRowCount,readOnly:inputData.autogenerated,includedFileTabs:[],addIncludedFileTab:addIncludedFileTab};return Object.defineProperty(tab,"modified",{get:function(){return isModified()},enumerable:!0}),Object.defineProperty(tab,"content",{set:function(newValue){tabData.content=newValue},get:function(){return tabData.content},enumerable:!0}),Object.defineProperty(tab,"name",{set:function(newValue){tabData.name=newValue},get:function(){return tabData.name},enumerable:!0}),Object.defineProperty(tab,"autogenerated",{set:function(newValue){tabData.autogenerated=newValue},get:function(){return tabData.autogenerated},enumerable:!0}),tab}function createQScriptTabModelFromData(data){return createQScriptTabModel(data,!0)}function createTabForEmptyScript(){return createQScriptTabModel({name:"Main",content:""},!1)}function createNewQScriptTabModel(name){return createQScriptTabModel({name:name,content:""},!1)}var exports={createQScriptTabModelFromData:createQScriptTabModelFromData,createNewQScriptTabModel:createNewQScriptTabModel,createTabForEmptyScript:createTabForEmptyScript};return exports}),define("scripteditor.services/debugger-variables-service",[],function(){function findProcessedVariable(prop,propVal,list){var i,res=null;if(list)for(i=0;i<list.length;i++)if(list[i][prop]===propVal){res=list[i];break}return res}function processVariables(rawVariables,previousProcessed){var processed=[];return rawVariables&&(processed=rawVariables.map(function(variable){var previousVar=findProcessedVariable("key",variable.qTag,previousProcessed),result={key:variable.qTag,current:variable.qDisplayString,refSeq:variable.qRefSeqNo,setSeq:variable.qSetSeqNo,type:variable.qIsSystem&&variable.qIsSystem===!0?"system":variable.qIsReserved&&variable.qIsReserved===!0?"reserved":"user",previous:previousVar&&previousVar.current!==variable.qDisplayString?previousVar.current:previousVar?previousVar.previous:null};return result})),updateVariableSorting(processed)}function updateVariableSorting(variables){return variables.sort(function(a,b){return a.setSeq<b.setSeq?1:a.setSeq>b.setSeq?-1:a.refSeq<b.refSeq?1:a.refSeq>b.refSeq?-1:0}),variables}return{processVariables:processVariables,updateVariableSorting:updateVariableSorting}}),define("scripteditor.services/console-output-service",["assets/datamodelviewer/services/dmv-observer-service","translator"],function(observerService,translator){function isValidMessageType(type){for(var i in MESSAGE_TYPE)if(type===MESSAGE_TYPE[i])return!0;return!1}function addMessage(type,text,created){var message=createOutputMessage(type,text,created);return messages.push(message),notifyAll(),message}function notifyAll(){observerService.notifyAll(OBSERVER_KEY,messages)}function createOutputMessage(type,text,created){created||(created=Math.round((new Date).getTime()/1e3)),type===MESSAGE_TYPE.EMPTY&&(text=EMPTY_ROW_DELIMITER);var OutputMessage=function(){};Object.defineProperty(OutputMessage.prototype,"type",{set:function(type){if(!type)throw new Error("Message type is undefined.");if(!isValidMessageType(type))throw new Error('Invalid message type "'+type+'".');this._type=type},get:function(){return this._type}}),Object.defineProperty(OutputMessage.prototype,"text",{set:function(text){if(!text)throw new Error("Text is undefined.");this._text=text},get:function(){return this._text}}),Object.defineProperty(OutputMessage.prototype,"created",{set:function(created){if(!created)throw new Error("Created is undefined.");this._created=created},get:function(){return this._created}});var message=new OutputMessage;return message.type=type,message.text=text,message.created=created,message}function removeMessage(message){var index=messages.indexOf(message);if(-1===index)throw new Error("Unknown message to remove.");messages.splice(index,1),notifyAll()}function onMessagesUpdated(observer){observerService.addObserver(OBSERVER_KEY,observer)}function getMessages(){return messages}function clear(){messages=[],addMessage(MESSAGE_TYPE.DEFAULT,translator.get("scripteditor.console.outputcleared"))}function messagesHasBeenUpdated(){notifyAll()}function removeObserver(observer){observerService.removeObserver(OBSERVER_KEY,observer)}var messages=[],MESSAGE_TYPE={DEFAULT:"default",WARNING:"warning",ERROR:"error",EMPTY:"empty"},OBSERVER_KEY="scripteditor.bottompane.output",EMPTY_ROW_DELIMITER="---",exports={MESSAGE_TYPE:MESSAGE_TYPE,addMessage:addMessage,removeMessage:removeMessage,clear:clear,onMessagesUpdated:onMessagesUpdated,messagesHasBeenUpdated:messagesHasBeenUpdated,getMessages:getMessages,removeObserver:removeObserver};return exports}),define("assets/scripteditor/views/progressindicator/progressindicator-helper",["translator"],function(translator){"use strict";function keyFrom(messageCode){return"MessageCode."+(messageCode||0)}function translateMessage(message){var translatedMessage=translator.get(keyFrom(message.qMessageCode),message.qMessageParameters);return translatedMessage}function translateMessageArray(messageArray){var returnMessages="";if(messageArray)for(var i in messageArray)returnMessages+=translateMessage(messageArray[i]),i<messageArray.length-1&&(returnMessages+="\n");return returnMessages}function formatNum(n){return n=Math.floor(n),n>9?""+n:"0"+n}function filterOutDuplicates(errorData){var i,val,result=[],lineHasAssociatedErrorString=[];for(i in errorData)val=errorData[i],val.qErrorString&&val.qLine&&(lineHasAssociatedErrorString[val.qLine]=!0);for(i in errorData)val=errorData[i],(val.qErrorString||!lineHasAssociatedErrorString[val.qLine])&&result.push(val);return result}return{translateMessage:translateMessage,translateMessageArray:translateMessageArray,formatNum:formatNum,filterOutDuplicates:filterOutDuplicates}}),define("assets/scripteditor/models/qscript-debug-driver",["jquery","ng!$q","ng!$timeout","scripteditor.services/debugger-variables-service","scripteditor.services/console-output-service","assets/scripteditor/views/progressindicator/progressindicator-helper","translator"],function($,$q,$timeout,debuggerVariablesHelper,consoleOutputService,progressIndicatorHelper,translator){"use strict";function createNextLineContentContainer(qDef){return{content:qDef.qLine}}function createDebugDriver(scriptModel,global,app,startRunning){function ensureBufferPathTabPresent(qDef){var defer=$q.defer();return qDef.qPath&&!scriptModel.getTabForIncludeFile(qDef.qPath)?app.getIncludeFileContent(qDef.qPath).then(function(result){scriptModel.createIncludeTabForIncludeFile(qDef.qPath,result.qContent),defer.resolve(qDef)},function(){scriptModel.createIncludeTabForIncludeFile(qDef.qPath,"")}):defer.resolve(qDef),defer.promise}function step(){return debugDriver.idle=!1,interactDone_Normal().then(getProgressAndThenGetInteract).then(updateVariables).then(ensureBufferPathTabPresent).then(function(qDef){return"IT_END"===qDef.qType?(debugDriver.errorInLastStep=void 0,interactDone_Normal().then(function(){return debugDriver.idle=!0,scriptModel.distributeDebugRunInfo(void 0,void 0),scriptModel._removeDebugger(),qDef})):"IT_MSGBOX"===qDef.qType?(debugDriver.errorInLastStep=qDef.qMsg,debugDriver.idle=!0,qDef):(debugDriver.pauseRequested=!1,debugDriver.errorInLastStep=void 0,debugDriver.idle=!0,scriptModel.distributeDebugRunInfo(qDef.qNewLineNr,qDef.qPath),debugDriver.nextLine=createNextLineContentContainer(qDef),qDef)})}function handleInteractionEnd(){return debugDriver.errorInLastStep=void 0,interactDone_Normal().then(updateVariables).then(function(){debugDriver.idle=!0,scriptModel.distributeDebugRunInfo(void 0),scriptModel._removeDebugger()})}function runToBreakpoint(){function handleStepDone(qDef){return"IT_END"===qDef.qType?handleInteractionEnd():void("IT_MSGBOX"===qDef.qType?(debugDriver.errorInLastStep=qDef.qMsg,updateVariables().then(function(){debugDriver.idle=!0,deferredResult.resolve(qDef)})):(debugDriver.errorInLastStep=void 0,scriptModel.distributeDebugRunInfo(qDef.qNewLineNr,qDef.qPath),scriptModel.isOnBreakpoint(qDef.qNewLineNr,qDef.qOldLineNr)||debugDriver.pauseRequested?(debugDriver.pauseRequested=!1,updateVariables().then(function(){debugDriver.idle=!0,debugDriver.nextLine=createNextLineContentContainer(qDef),deferredResult.resolve(qDef)})):(debugDriver.nextLine=createNextLineContentContainer(qDef),interactDone_Normal().then(getProgressAndThenGetInteract).then(ensureBufferPathTabPresent).then(handleStepDone))))}var deferredResult=$q.defer();return debugDriver.idle=!1,interactDone_Normal().then(getProgressAndThenGetInteract).then(ensureBufferPathTabPresent).then(handleStepDone),deferredResult.promise}function pause(){debugDriver.pauseRequested=!0}function updateVariables(previousResult){return app.getTextMacros().then(function(macrosResult){var newVariablesList=debuggerVariablesHelper.processVariables(macrosResult.qMacros,scriptModel.variables);return scriptModel.distributeVariableList(newVariablesList),previousResult})}function cancel(){debugDriver.cancelRequested=!0;var defer=$q.defer();return global.cancelReload().then(function(){function turnOffDebugger(){debugDriver.cancelRequested=!1,debugDriver.idle=!0,scriptModel.distributeDebugRunInfo(void 0,void 0),scriptModel._removeDebugger(),defer.resolve()}reloadPromise.then(turnOffDebugger,turnOffDebugger)}),defer.promise}function interactDone_Normal(){return global.interactDone({qRequestId:protocolRequestId,qDef:debugDriver.errorInLastStep?continueAfterErrorDef:contineExecutionDef}).then(function(result){return result})}function extractAndTranslateMessages(persistentProgressMessages){var messages=[];for(var i in persistentProgressMessages){var progressMessage=persistentProgressMessages[i],message=progressIndicatorHelper.translateMessage(progressMessage);message.trim()&&messages.push(message)}return messages}function getAppropriateMessageType(message){return/\$Syn \d+ =/gi.test(message)?consoleOutputService.MESSAGE_TYPE.WARNING:consoleOutputService.MESSAGE_TYPE.DEFAULT}function reportErrorMessageToConsole(error){var errorMessage=error.qErrorString+(error.qLine?": "+error.qLine:"");"EDC_CIRCULAR_REFERENCE"===error.qErrorDataCode?(consoleOutputService.addMessage(consoleOutputService.MESSAGE_TYPE.WARNING,translator.get("scripteditor.progressindicator.edc_circular_referencesummary")+":"),consoleOutputService.addMessage(consoleOutputService.MESSAGE_TYPE.WARNING,errorMessage)):consoleOutputService.addMessage(consoleOutputService.MESSAGE_TYPE.ERROR,errorMessage)}function getProgressUntilStable(){function handleResultFromGetProgress(result){var progressData=result.qProgressData;if(progressData.qTransientProgress)lastTransientMessage&&consoleOutputService.removeMessage(lastTransientMessage),lastTransientMessage=consoleOutputService.addMessage(consoleOutputService.MESSAGE_TYPE.DEFAULT,progressData.qTransientProgress);else if(progressData.qPersistentProgress){lastTransientMessage&&consoleOutputService.removeMessage(lastTransientMessage);var messages=extractAndTranslateMessages(progressData.qPersistentProgressMessages);for(var i in messages){var message=messages[i],messageType=getAppropriateMessageType(message);consoleOutputService.addMessage(messageType,message)}lastTransientMessage=void 0}if(progressData.qErrorData&&progressData.qErrorData.length)for(var j in progressData.qErrorData){var error=progressData.qErrorData[j];reportErrorMessageToConsole(error)}result.qProgressData.qUserInteractionWanted||result.qProgressData.qFinished?resultDefer.resolve(result.qProgressData):$timeout(function(){global.getProgress(protocolRequestId).then(handleResultFromGetProgress)},1.3*TIME_TO_WAIT)}var lastTransientMessage,resultDefer=$q.defer(),TIME_TO_WAIT=200;return global.getProgress(protocolRequestId).then(handleResultFromGetProgress),resultDefer.promise}function getProgressAndThenGetInteract(){return getProgressUntilStable().then(function(){return global.getInteract(protocolRequestId).then(function(result){return result.qDef})})}function startDebugger(){return scriptModel.distributeVariableList([]),scriptModel.setScript().then(function(){return global.configureReload(!1,!0,!0)}).then(function(){debugDriver.idle=!1,debugDriver.errorInLastStep=void 0,reloadPromise=app.doReload({qMode:0,qPartial:!1,qDebug:!0}),protocolRequestId=reloadPromise.__protocolRequestId,app.setFetchLimit({qLimit:scriptModel.debugLimitedLoadEnabled?Number(scriptModel.debugLimitedLoadValue):-1}).then(getProgressAndThenGetInteract).then(updateVariables).then(function(qDef){scriptModel.distributeDebugRunInfo(qDef.qNewLineNr,qDef.qPath),debugDriver.nextLine=createNextLineContentContainer(qDef),"IT_END"===qDef.qType?handleInteractionEnd():startRunning&&!scriptModel.isOnBreakpoint()?runToBreakpoint():debugDriver.idle=!0})})}function onGotoHighligtedRow(){alert("Not yet implemented: Go to highlighted row.")}var reloadPromise,protocolRequestId,debugDriver={idle:!1,step:step,runToBreakpoint:runToBreakpoint,pause:pause,cancel:cancel,onGotoHighligtedRow:onGotoHighligtedRow,errorInLastStep:!1,lineContent:void 0,pauseRequested:!1,cancelRequested:!1};return startDebugger(),debugDriver}var standardParams={qType:0,qTitle:"",qMsg:"",qButtons:0,qLine:"",qOldLineNr:0,qNewLineNr:0,qPath:"",qHidden:!1,qInput:""},contineExecutionDef=$.extend({},standardParams,{qResult:0}),continueAfterErrorDef=$.extend({},standardParams,{qResult:1}),exports={createDebugDriver:createDebugDriver};return exports}),define("scripteditor.services/local-storage-service",["underscore","scripteditor.utils/string-util"],function(underscore,stringUtil){function getKeyName(key){if(!underscore.isString(key))throw'The key "'+key+'" is not a String.';return LOCAL_STORAGE_SERVICE_PREFIX+"."+key}function set(key,value,timeToLive){var jsonValue,data,currentTimeInMS=(new Date).getTime();if(!underscore.isString(key))throw'The key "'+key+'" is not a String.';if(!underscore.isObject(value))throw'The value "'+value+'" for the key "'+key+'" is not valid object.';if(timeToLive){if(!underscore.isNumber(timeToLive))throw'The time to live value "'+timeToLive+'" is not numeric.';timeToLive+=currentTimeInMS}data={timeToLive:timeToLive,value:value},jsonValue=JSON.stringify(data),localStorage[getKeyName(key)]=jsonValue}function contains(key){if(!underscore.isString(key))throw'The key "'+key+'" is not a String.';var isEmpty=underscore.isEmpty(localStorage[getKeyName(key)]);return!isEmpty}function get(key,defaultValue){if(!underscore.isString(key))throw'The key "'+key+'" is not a String.';if(!contains(key)){if(void 0!==defaultValue)return defaultValue;throw'There is no data set for the key "'+key+'". Please use contains() first to verify you should actually do a get().'}var data=getDataObject(key);return data.value}function getDataObject(key){var data=JSON.parse(localStorage[getKeyName(key)]);return data}function remove(key){if(!underscore.isString(key))throw'The key "'+key+'" is not a String.';if(!contains(key))throw'There is no data set for the key "'+key+'". Please use contains() first to verify you should actually do a get().';delete localStorage[getKeyName(key)]}function clean(){var key,data,currentTimeMS;for(key in localStorage)stringUtil.startsWith(key,LOCAL_STORAGE_SERVICE_PREFIX)&&(key=key.substring(LOCAL_STORAGE_SERVICE_PREFIX.length+1),data=getDataObject(key),currentTimeMS=(new Date).getTime(),underscore.isNumber(data.timeToLive&&currentTimeMS>data.timeToLive)&&remove(key))}var LOCAL_STORAGE_SERVICE_PREFIX="localstorageservice";return{set:set,get:get,contains:contains,clean:clean,remove:remove}}),define("assets/scripteditor/services/settings-service",["scripteditor.services/local-storage-service"],function(localStorageService){function createSettings(prefix){function valueObject(value){return{value:value}}function nameWithPrefix(name){return prefix?prefix+name:name}function get(key){try{return localStorageService.get(nameWithPrefix(key)).value}catch(err){}}function set(name,value){return localStorageService.set(nameWithPrefix(name),valueObject(value)),value}function register(name,defaultValue){return localStorageService.contains(nameWithPrefix(name))||set(name,defaultValue),get(name)}function registerWatcher(scope,name,defaultValue){return scope.$watch(name,function(newValue){set(name,newValue)}),register(name,defaultValue)}var settings={registerWatcher:registerWatcher,register:register,get:get,set:set};return settings}function forAppName(prefix){return appsWithSettings[prefix]||(appsWithSettings[prefix]=createSettings(prefix)),
appsWithSettings[prefix]}var appsWithSettings={},exports={forAppName:forAppName,global:forAppName("globalSettings")};return exports}),define("assets/scripteditor/services/application-settings-service",["assets/scripteditor/services/settings-service","util"],function(settingsService,util){function removePathFromApp(full_path){return full_path?full_path.replace(/.*\\/g,""):void 0}return settingsService.forAppName(removePathFromApp(util.getParameterByName("app"))+".")}),define("general.services/cross-product-part-notification-service",["jquery","assets/datamodelviewer/services/dmv-observer-service","assets/datamodelviewer/utils/dmv-crypto-util"],function($,observerService,cryptoUtil){function _publish(externalKey){if(!_LOCAL_STORAGE_KEY)throw new Error("LOCAL_STORAGE_KEY is undefined. Forgot to run init?");localStorage[_LOCAL_STORAGE_KEY]=externalKey}function _subscribe(externalKey,observer){var fullObserverKey=_createFullObserverKey(externalKey);observerService.addObserver(fullObserverKey,observer)}function _createFullObserverKey(externalKey){return OBSERVER_KEY+"."+externalKey}function _init(appID){if(!appID)throw new Error("App ID is undefined.");_LOCAL_STORAGE_KEY="cppns."+cryptoUtil.sha256(appID),$(window).on("storage",function(event){var key=event.originalEvent.key,observerKeyValue=event.originalEvent.newValue;if(key&&key===_LOCAL_STORAGE_KEY&&observerKeyValue){delete localStorage[_LOCAL_STORAGE_KEY];var fullObserverKey=_createFullObserverKey(observerKeyValue);observerService.notifyAll(fullObserverKey)}})}var _LOCAL_STORAGE_KEY,OBSERVER_KEY="cppns";return{init:_init,publish:_publish,subscribe:_subscribe}}),define("assets/datamodelviewer/observers/dmv-data-load-editor-has-done-save-observer",["general.services/cross-product-part-notification-service"],function(crossProductPartNotificationService){function _saveDone(){crossProductPartNotificationService.publish(SUBSCRIPTION_KEY)}function _onSaveDone(observer){crossProductPartNotificationService.subscribe(SUBSCRIPTION_KEY,observer)}var SUBSCRIPTION_KEY="save-done-by-data-load-editor",exports={saveDone:_saveDone,onSaveDone:_onSaveDone};return exports}),define("assets/scripteditor/models/qscript-model",["ng!$timeout","translator","scripteditor.services/explicit-save-service","assets/scripteditor/models/qscript-serializer","assets/scripteditor/models/qscript-tab-model","assets/scripteditor/models/qscript-debug-driver","scripteditor.services/console-output-service","assets/scripteditor/services/application-settings-service","assets/datamodelviewer/observers/dmv-data-load-editor-has-done-save-observer","general.components/codearea/search-util"],function($timeout,translator,explicitSaveService,serializer,qscriptTabModelModule,debugDriverModule,consoleOutputService,appSettings,dataLoadEditorHasDoneSaveObserver,searchUtil){"use strict";function createQScriptModelFromTabDataArray(global,app,originalTabDataArray,savedBreakpoints,savedVariableFavorites){function overwriteTabsWithRawScript(rawScript,currentlySelectedTab){var oldTabIndex=scriptModel.tabs.indexOf(currentlySelectedTab),newTabs=serializer.parse(rawScript).map(qscriptTabModelModule.createQScriptTabModelFromData);return Array.prototype.splice.apply(scriptModel.tabs,[0,scriptModel.tabs.length].concat(newTabs)),oldTabIndex>=0&&scriptModel.tabs.length>oldTabIndex?scriptModel.tabs[oldTabIndex]:scriptModel.tabs[0]}function convertGlobalToLocal(globalLineNbr){for(var globalLineNbrBase=0,localLineNbrBase=1,totalLinesInPreviousTabs=0,globalLineNbrZeroBased=globalLineNbr-globalLineNbrBase,tabIndex=0;tabIndex<tabs.length;tabIndex++){var currentTabsTotalLineCount=tabs[tabIndex].lineCount+tabs[tabIndex].headerSize;if(totalLinesInPreviousTabs+currentTabsTotalLineCount>globalLineNbrZeroBased){var location={tabIndex:tabIndex,lineNbr:globalLineNbrZeroBased-totalLinesInPreviousTabs-tabs[tabIndex].headerSize+localLineNbrBase,globalLineNbr:globalLineNbrZeroBased};return location}totalLinesInPreviousTabs+=currentTabsTotalLineCount}}function addBreakpointsToTabs(tabs,breakpoints){for(var breakpointIndex=0;breakpointIndex<breakpoints.length;breakpointIndex++)for(var globalLineNbr=breakpoints[breakpointIndex].qlineIx,breakpointPosition=convertGlobalToLocal(globalLineNbr),tabIndex=0;tabIndex<tabs.length;tabIndex++)breakpointPosition.tabIndex===tabIndex&&(tabs[tabIndex].breakpoints[breakpointPosition.lineNbr]={lineNbr:breakpointPosition.lineNbr,enabled:breakpoints[breakpointIndex].qEnabled||!1})}function isModified(){for(var tabIndex=0;tabIndex<scriptModel.tabs.length;tabIndex++)if(scriptModel.tabs[tabIndex].isModified())return!0;return tabOrderModified}function getTabsAndIncludedFiles(){_allTabs.splice(0,_allTabs.length),Array.prototype.push.apply(_allTabs,scriptModel.tabs);for(var bufferPath in scriptModel.includeFileTabs)_allTabs.push(scriptModel.includeFileTabs[bufferPath]);return _allTabs}function resetModified(){for(var tabIndex=0;tabIndex<scriptModel.tabs.length;tabIndex++)scriptModel.tabs[tabIndex].resetModified();tabOrderModified=!1}function getTabForIncludeFile(bufferPath){return scriptModel.includeFileTabs[bufferPath]}function createIncludeTabForIncludeFile(bufferPath,content){scriptModel.includeFileTabs[bufferPath]=qscriptTabModelModule.createQScriptTabModelFromData({name:bufferPath,content:content}),scriptModel.includeFileTabs[bufferPath].readOnly=!0,lastExecutedNonIncludeTab.addIncludedFileTab(scriptModel.includeFileTabs[bufferPath])}function distributeDebugRunInfo(globalLineNbr,bufferPath){scriptModel.currentlyExecutingTab=void 0,scriptModel.lastLocation=scriptModel.currentLocation;for(var allTabs=scriptModel.tabsAndIncludedFiles,tabIndex=0;tabIndex<allTabs.length;tabIndex++)allTabs[tabIndex].setCurrentlyRunningLocalLineNbr(void 0);if(bufferPath){var includedTab=getTabForIncludeFile(bufferPath);includedTab.setCurrentlyRunningLocalLineNbr(globalLineNbr+1),scriptModel.currentlyExecutingTab=includedTab,scriptModel.currentLocation={tabIndex:bufferPath,lineNbr:globalLineNbr+1,globalLineNbr:globalLineNbr+1}}else if(globalLineNbr){var currentLocation=globalLineNbr>=0?convertGlobalToLocal(globalLineNbr):void 0;tabs[currentLocation.tabIndex].setCurrentlyRunningLocalLineNbr(currentLocation.lineNbr),scriptModel.currentlyExecutingTab=tabs[currentLocation.tabIndex],scriptModel.currentLocation=currentLocation,lastExecutedNonIncludeTab=tabs[currentLocation.tabIndex]}}function isOnBreakpoint(){if(scriptModel.currentlyExecutingTab&&scriptModel.currentlyExecutingTab.debugLineNbr){for(var breakpointLineNbrString in scriptModel.currentlyExecutingTab.breakpoints){var breakpointLineNbr=parseInt(breakpointLineNbrString,10),isEnabled=scriptModel.currentlyExecutingTab.breakpoints[breakpointLineNbr].enabled;if(isEnabled&&scriptModel.currentLocation.lineNbr===breakpointLineNbr)return!0}return!1}return!1}function checkScriptSyntax(){return app.checkScriptSyntax().then(function(result){return distributeSyntaxCheckResult(result.qErrors),{clear:function(){distributeSyntaxCheckResult([])}}})}function distributeSyntaxCheckResult(errors){scriptModel.errorCount=errors.length;var i;for(i in scriptModel.tabs)scriptModel.tabs[i].errors._clearErrors();for(i in errors){var error=errors[i],tabIndex=errors[i].qTabIx;tabIndex<scriptModel.tabs.length&&scriptModel.tabs[tabIndex].errors._addError(error)}for(i in scriptModel.tabs)scriptModel.tabs[i].errors._errorsUpdated()}function toData(){return tabs.map(function(tab){return tab.toData()})}function setScript(){var rawScript=serializer.stringify(toData());return app.setScript({qScript:rawScript})}function fastSave(){return saveBreakPoints().then(saveFavoriteVariables).then(setScript)}function saveBreakPoints(){function mapModelBreakpointToSaveBreakpoint(breakpoint){return{qlineIx:breakpoint.lineNbr+totalLinesInPreviousTabs,qEnabled:breakpoint.enabled}}for(var breakpointsToSave=[],tabBreakpoints=[],totalLinesInPreviousTabs=0,tabs=scriptModel.tabs,i=0;i<tabs.length;i++){var tabsAsArr=[];tabs[i].calculateRowCount();for(var key in tabs[i].breakpoints)tabsAsArr.push(tabs[i].breakpoints[key]);tabBreakpoints=tabsAsArr.map(mapModelBreakpointToSaveBreakpoint),breakpointsToSave=breakpointsToSave.concat(tabBreakpoints),totalLinesInPreviousTabs+=tabs[i].lineCount+tabs[i].headerSize}return app.setScriptBreakpoints({qBreakpoints:breakpointsToSave})}function saveFavoriteVariables(){return app.setFavoriteVariables({qNames:scriptModel._savedFavoriteVariables})}function variableIsFavorite(key){return scriptModel._savedFavoriteVariables.indexOf(key)>-1}function updateFavoriteVariables(variable){var foundIndex=scriptModel._savedFavoriteVariables.indexOf(variable.key);foundIndex>-1?scriptModel._savedFavoriteVariables.splice(foundIndex,1):scriptModel._savedFavoriteVariables.push(variable.key)}function setAndPersistScript(){return saveBreakPoints().then(saveFavoriteVariables).then(setScript).then(function(){return explicitSaveService.saveApp(function(){consoleOutputService.addMessage(consoleOutputService.MESSAGE_TYPE.DEFAULT,translator.get("scripteditor.console.appsuccessfullysaved")),dataLoadEditorHasDoneSaveObserver.saveDone()})})}function run(){return global.configureReload(!0,!0,!1).then(function(){return app.doReload()})}function markGlobalFindings(query){for(var total=0,tabIndex=0;tabIndex<scriptModel.tabs.length;tabIndex++){var tab=scriptModel.tabs[tabIndex];query?tab.nbrOfSearchHits=searchUtil.getMaxNumberOfHits(tab.content,query):tab.nbrOfSearchHits=0,total+=tab.nbrOfSearchHits}return total}function clearGlobalFindings(){for(var tabIndex=0;tabIndex<scriptModel.tabs.length;tabIndex++){var tab=scriptModel.tabs[tabIndex];tab.nbrOfSearchHits=0}}function calculateRowCounts(){for(var i in tabs)tabs[i].calculateRowCount()}function startDebugDriver(startRunning){return calculateRowCounts(),$timeout(function(){scriptModel.debugDriver=debugDriverModule.createDebugDriver(scriptModel,global,app,startRunning)})}function tabNameExists(name){for(var i in scriptModel.tabs)if(tabs[i].name===name)return!0;return!1}function findNextFreeTabName(){var tabName=translator.get("scripteditor.vtabs.newtabname");if(!tabNameExists(tabName))return tabName;for(var i=2;;){var numberedTabName=tabName+" "+i;if(!tabNameExists(numberedTabName))return numberedTabName;i++}}function addNewTab(index){scriptModel.tabs.splice(index,0,qscriptTabModelModule.createNewQScriptTabModel(findNextFreeTabName()))}function moveTab(fromIndex,toIndex){tabOrderModified=!0,scriptModel.tabs.splice(toIndex,0,scriptModel.tabs.splice(fromIndex,1)[0])}function removeTab(tab){tabOrderModified=!0,scriptModel.tabs.splice(scriptModel.tabs.indexOf(tab),1)}function replaceTabsWithRawScript(rawScript){scriptModel.tabs.splice(0,scriptModel.tabs.length);var newTabs=serializer.parse(rawScript),newTabsModel=newTabs.map(qscriptTabModelModule.createQScriptTabModelFromData);Array.prototype.push.apply(scriptModel.tabs,newTabsModel)}function distributeVariableList(variableList){scriptModel.variables=variableList}function _removeDebugger(){scriptModel.debugDriver=void 0}function _alwaysTrue(){return!0}function getNextTab(tab,tabFilterFn){tabFilterFn=tabFilterFn||_alwaysTrue;var result=tab;do{var i=scriptModel.tabs.indexOf(result);result=i>=0&&i<scriptModel.tabs.length-1?scriptModel.tabs[i+1]:scriptModel.tabs[0]}while(!tabFilterFn(result)&&result!==tab);return result}function getPreviousTab(tab,tabFilterFn){tabFilterFn=tabFilterFn||_alwaysTrue;var result=tab;do{var i=scriptModel.tabs.indexOf(result);result=i>0&&i<scriptModel.tabs.length?scriptModel.tabs[i-1]:scriptModel.tabs[scriptModel.tabs.length-1]}while(!tabFilterFn(result)&&result!==tab);return result}function getTabToFocusAfterDebugExit(){return lastExecutedNonIncludeTab?lastExecutedNonIncludeTab:scriptModel.tabs[scriptModel.tabs-length-1]}var lastExecutedNonIncludeTab,_allTabs=[],tabOrderModified=!1,tabs=originalTabDataArray.map(qscriptTabModelModule.createQScriptTabModelFromData);0===tabs.length&&tabs.push(qscriptTabModelModule.createTabForEmptyScript()),savedBreakpoints&&(calculateRowCounts(),addBreakpointsToTabs(tabs,savedBreakpoints));var scriptModel={tabs:tabs,includeFileTabs:{},setScript:setScript,setAndPersistScript:setAndPersistScript,fastSave:fastSave,toData:toData,run:run,variables:[],currentLocation:void 0,lastLocation:void 0,errorCount:0,currentlyExecutingTab:void 0,calculateRowCounts:calculateRowCounts,distributeDebugRunInfo:distributeDebugRunInfo,distributeSyntaxCheckResult:distributeSyntaxCheckResult,distributeVariableList:distributeVariableList,getTabForIncludeFile:getTabForIncludeFile,createIncludeTabForIncludeFile:createIncludeTabForIncludeFile,updateFavoriteVariables:updateFavoriteVariables,variableIsFavorite:variableIsFavorite,_removeDebugger:_removeDebugger,_savedFavoriteVariables:savedVariableFavorites||[],isOnBreakpoint:isOnBreakpoint,checkScriptSyntax:checkScriptSyntax,startDebugDriver:startDebugDriver,addNewTab:addNewTab,moveTab:moveTab,removeTab:removeTab,replaceTabsWithRawScript:replaceTabsWithRawScript,getNextTab:getNextTab,getPreviousTab:getPreviousTab,debugDriver:void 0,debugLimitedLoadValue:appSettings.register("scriptModel.debugLimitedLoadValue",100),debugLimitedLoadEnabled:appSettings.register("scriptModel.debugLimitedLoadEnabled",!1),markGlobalFindings:markGlobalFindings,clearGlobalFindings:clearGlobalFindings,resetModified:resetModified,getTabToFocusAfterDebugExit:getTabToFocusAfterDebugExit,overwriteTabsWithRawScript:overwriteTabsWithRawScript};return Object.defineProperty(scriptModel,"modified",{get:function(){return isModified()},enumerable:!0}),Object.defineProperty(scriptModel,"tabsAndIncludedFiles",{get:function(){return getTabsAndIncludedFiles()},enumerable:!0}),scriptModel}function createQScriptModelFromRawText(global,app,rawScript,savedBreakpoints,savedVariableFavorites){var tabs=serializer.parse(rawScript);return createQScriptModelFromTabDataArray(global,app,tabs,savedBreakpoints,savedVariableFavorites)}var exports={createQScriptModelFromRawText:createQScriptModelFromRawText,createQScriptModelFromTabDataArray:createQScriptModelFromTabDataArray};return exports}),define("assets/hldm/services/entrypoints",[],function(){var exports={openLoadWizard:function(){},openDataSpaceWithTableModel:function(){},getTableModelWithName:function(){},quickLoadFile:function(){},resetLoadModel:function(){},reloadData:function(){}};return window.entrypoint=exports,exports}),define("assets/hldm/models/load-model-script-tab-updater",["assets/scripteditor/models/qscript-model","translator","assets/hldm/services/entrypoints"],function(ScriptModel,translator){function createUpdater(global,app){function getScriptModelPromise(){return app.getScript().then(function(currentScriptResult){return ScriptModel.createQScriptModelFromRawText(global,app,currentScriptResult.qScript,[],[])})}function updateLoadModelScript(script){return getScriptModelPromise().then(function(currentModel){function findTab(){for(var i in currentModel.tabs)if(currentModel.tabs[i].autogenerated)return currentModel.tabs[i]}function removeTab(){for(var i in currentModel.tabs)if(currentModel.tabs[i].autogenerated){currentModel.tabs.splice(i,1);break}}var SPECIAL_TAB_NAME=translator.get("scripteditor.autogeneratedSection"),tab=findTab();return tab&&""!==script?tab.content=script:tab||""===script?tab&&""===script&&removeTab():(currentModel.addNewTab(currentModel.tabs.length),currentModel.tabs[currentModel.tabs.length-1].name=SPECIAL_TAB_NAME,currentModel.tabs[currentModel.tabs.length-1].autogenerated=!0,tab=currentModel.tabs[currentModel.tabs.length-1],tab.content=script),currentModel.setAndPersistScript().then(function(){return!0})})}var updater={updateLoadModelScript:updateLoadModelScript,getScriptModelPromise:getScriptModelPromise};return updater}var exports={createUpdater:createUpdater};return exports}),define("text!assets/scripteditor/views/quickimportprogressindicator/quickimportprogressindicator.ng.html",[],function(){return'<div class="qv-quickimportprogressindicator qv-modal-container qui-modalbackground" qva-outside-ignore-for="allOutside" ng-style="containerStyle">\r\n	<div class="qui-delayedModal" qv-global-escape="onEscape()" qv-global-enter="onEnter()">\r\n        <header class="dm-header" q-translation="{{getHeading()}}"></header>\r\n\r\n		<main class="dm-main">\r\n			<div class="section clearfix">\r\n				<div class="elapsed">\r\n					<span q-translation="scripteditor.progressindicator.elapsedtime"></span>\r\n					<span class="time" ng-class="!succeded && !running ? \'error\' : \'\' ">{{elapsedTime}}</span>\r\n				</div>\r\n\r\n\r\n				<div class="qv-loader" ng-if="running"></div>\r\n\r\n				<div ng-if="!running">\r\n					<div class="userguide" ng-if="warnings">\r\n						<span class="bold" q-translation="quickdataimport.progressindicator.followingwarning"></span>\r\n\r\n						<ul class="steps">\r\n							<li ng-repeat="warning in warningInfo">\r\n								{{warning.text}}\r\n								<span data-icon="help" data-qva-activate="openHelpWindow(warning.url)" q-title-translation="{{warning.helpTooltip}}"></span>\r\n							</li>\r\n						</ul>\r\n\r\n						<br/>\r\n					</div>\r\n\r\n					<div ng-if="newSheetCreated">\r\n						<div q-translation="quickdataimport.progressindicator.newsheetcreated"></div>\r\n						<br/>\r\n					</div>\r\n\r\n					<div class="bold" q-translation="{{progressText()}}"></div>\r\n				</div>\r\n			</div>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<div class="button-wrap">\r\n                <qui-button ng-repeat="button in buttons()" tid="{{ button.tid }}" class=" qui-button" qva-activate="button.eventHandler()" ng-disabled="button.disabled" q-translation="{{ button.title }}" q-title-translation="{{ button.title }}" qva-focus="button.focus"></qui-button>\r\n			</div>\r\n		</footer>\r\n	</div>\r\n</div>\r\n\r\n<div id="closeProgressContainer"></div>\r\n'}),define("scripteditor.services/timer",[],function(){function updateCurrentTime(){currentTime=(Date.now()-startTime)/1e3}function paddNumber(number){return number=Math.floor(number),10>number&&(number="0"+number),number}function getHour(){return paddNumber(currentTime/3600)}function getMinutes(){return paddNumber(currentTime%3600/60)}function getSeconds(){return paddNumber(currentTime%60)}function getElapsedTime(){return running&&updateCurrentTime(),getHour()+":"+getMinutes()+":"+getSeconds()}function start(){running=!0,reset()}function stop(){updateCurrentTime(),running=!1}function reset(){startTime=Date.now(),updateCurrentTime()}var startTime=0,currentTime=startTime,running=!1;return{getElapsedTime:getElapsedTime,start:start,stop:stop,reset:reset}}),define("storytelling.utils/storytelling-helper",["jquery","qvangular"],function($,qvangular){function getContainmentOnElement(elem,cell){var grid=$(".qv-grid-story"),left=grid.offset().left+1*cell.width-elem.outerWidth(),right=grid.outerWidth()+grid.offset().left-1*cell.width,top=grid.offset().top+1*cell.height-elem.outerHeight(),bottom=grid.offset().top+grid.outerHeight()-1*cell.height;return[left,top,right,bottom]}function slideItemOutsideSlide(elem,grid,cellSize){var diff,elemHeight=elem.outerHeight(),elemWidth=elem.outerWidth(),elemOffset=elem.offset(),gridOffset=grid.offset(),gridHeight=grid.outerHeight(),gridWidth=grid.outerWidth();elemOffset.left+elemWidth<gridOffset.left+1*cellSize.width&&(diff=gridOffset.left+1*cellSize.width-(elemOffset.left+elemWidth),elem.css("left","+="+diff)),elemOffset.top+elemHeight<gridOffset.top+1*cellSize.height&&(diff=gridOffset.top+1*cellSize.height-(elemOffset.top+elemHeight),elem.css("top","+="+diff)),elemOffset.left+1*cellSize.width>gridOffset.left+gridWidth&&(diff=elemOffset.left+1*cellSize.width-(gridOffset.left+gridWidth),elem.css("left","-="+diff)),elemOffset.top+1*cellSize.height>gridOffset.top+gridHeight&&(diff=elemOffset.top+1*cellSize.width-(gridOffset.top+gridHeight),elem.css("top","-="+diff))}function decreaseValueUntilEvenSplit(value,splitBy){for(;value%splitBy!==0&&value>splitBy;)value--;return splitBy>value?splitBy:value}function increaseValueUntilEvenSplit(value,splitBy){for(;value%splitBy!==0&&value>0;)value++;return value}function getElementPosition(elem,options){var top,left,width,height,percentTop,percentLeft,percentWidth,percentHeight,position;return options.snapGrid?(top=Math.round(elem.position().top/options.cellSize.height)*options.cellSize.height,left=Math.round(elem.position().left/options.cellSize.width)*options.cellSize.width,width=Math.round(parseInt(elem.css("width"),10)/options.cellSize.width)*options.cellSize.width,height=Math.round(parseInt(elem.css("height"),10)/options.cellSize.height)*options.cellSize.height):(top=elem.position().top,left=elem.position().left,width=elem.outerWidth(),height=elem.outerHeight()),percentTop=(100*top/elem.offsetParent().height()).toFixed(2)+"%",percentLeft=(100*left/elem.offsetParent().width()).toFixed(2)+"%",percentWidth=(100*width/elem.offsetParent().width()).toFixed(2)+"%",percentHeight=(100*height/elem.offsetParent().height()).toFixed(2)+"%",position={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,"z-index":parseInt(elem.css("z-index"),10)},elem.css(position),position}function getHelperPosition(elem){var top,left,percentTop,percentLeft,width,height,percentWidth,percentHeight,position,grid=$("#qv-storytelling .qv-grid-story");return top=elem.offset().top-grid.offset().top,left=elem.offset().left-grid.offset().left,width=parseInt(elem.css("width"),10),height=parseInt(elem.css("height"),10),percentTop=(top/grid.height()*100).toFixed(2)+"%",percentLeft=(left/grid.width()*100).toFixed(2)+"%",percentWidth=(width/grid.width()*100).toFixed(2)+"%",percentHeight=(height/grid.height()*100).toFixed(2)+"%",position={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,"z-index":parseInt(elem.css("z-index"),10)}}function getGridOptions(){return gridOptions}function setGridOptions(options){gridOptions=options}function setPublishState(state){isPublished=state}function getPublishState(){return isPublished}function setSelectedSlideItemElem(elem){selectedSlideItemElem=elem,angular.element(".qv-storytelling-edit-toolbar").scope().$broadcast(elem?"slideItemSelected":"slideItemDeselected")}function getSelectedSlideItemElem(){return selectedSlideItemElem}function sortSlidesByRank(slides){function compare(a,b){return a.qData.rank<b.qData.rank?-1:a.qData.rank>b.qData.rank?1:0}return Array.isArray(slides)&&slides.length>0?slides.sort(compare):slides}function createSlideThumbnail(element,slideId){var $compile=qvangular.getService("$compile"),$rootScope=qvangular.getService("$rootScope"),elem="<div storytelling-thumbnail />",$scope=$rootScope.$new();$scope.slide={qInfo:{qId:slideId}},element.empty(),element.append($compile(elem)($scope))}var gridOptions={},isPublished=!1,isViewingSource=!1,currentStoryId=null,currentSlideId=null,selectedSlideItemElem=null,availableRatios={wide:{w:16,h:9},regular:{w:4,h:3}},lastObjPasted={id:"",slide:"",action:""},lastObjAdded={id:null},pasteOffset=0,maxNumberOfSlideItems=199,selectionState={};return{getContainmentOnElement:getContainmentOnElement,slideItemOutsideSlide:slideItemOutsideSlide,decreaseValueUntilEvenSplit:decreaseValueUntilEvenSplit,increaseValueUntilEvenSplit:increaseValueUntilEvenSplit,getElementPosition:getElementPosition,getHelperPosition:getHelperPosition,getGridOptions:getGridOptions,setGridOptions:setGridOptions,setPublishState:setPublishState,getPublishState:getPublishState,sortSlidesByRank:sortSlidesByRank,setSelectedSlideItemElem:setSelectedSlideItemElem,getSelectedSlideItemElem:getSelectedSlideItemElem,currentStoryId:currentStoryId,currentSlideId:currentSlideId,createSlideThumbnail:createSlideThumbnail,availableRatios:availableRatios,pasteOffset:pasteOffset,lastObjPasted:lastObjPasted,lastObjAdded:lastObjAdded,isViewingSource:isViewingSource,maxNumberOfSlideItems:maxNumberOfSlideItems,selectionState:selectionState}}),define("storytelling.models/slide-model",["jquery","core.models/generic-object","storytelling.utils/storytelling-helper"],function($,GenericObject,stHelper){"use strict";var Slide;return Slide=GenericObject.extend("Slide",{duplicate:function(story){var rank,obj=this;story.getLayout().then(function(layout){for(var items=stHelper.sortSlidesByRank(layout.qChildList.qItems.slice()),i=0;i<items.length;i++){var item=items[i];if(item.qInfo.qId===obj.id){var prev=items[i],next=items[i+1];(next||prev)&&(rank=next&&!prev?next.qData.rank-1:!next&&prev?prev.qData.rank+1:(prev.qData.rank+next.qData.rank)/2)}}Slide.create(story,{rank:rank}).then(function(nSlide){nSlide.copyFrom(obj.id).then(function(){nSlide.getProperties().then(function(item){item.rank=rank,nSlide.save()})})})})}}),Slide.create=function(story,opts){var data={qInfo:{qType:"slide"},rank:-1,qChildListDef:{qData:{title:"/title",sheetId:"/sheetId",ratio:"/ratio",position:"/position",dataPath:"/dataPath",srcPath:"/srcPath",visualization:"/visualization",visualizationType:"/visualizationType",style:"/style"}}};return story.createChild($.extend(!0,data,opts),null,Slide)},Slide}),define("client.models/story",["jquery","core.models/generic-object","storytelling.models/slide-model"],function($,GenericObject,SlideModel){"use strict";var Story;return Story=GenericObject.extend("Story",{addSlide:function(slide,Model){var that=this;return slide.getProperties().then(function(init){return that.getProperties().then(function(props){return that.createChild(init,props,Model)})})}},{listProperties:{qAppObjectListDef:{qType:"story",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",rank:"/rank"}}}}),Story.create=function(opts,app){var data={qMetaDef:{title:"",description:""},rank:-1,thumbnail:{qStaticContentUrlDef:null},qChildListDef:{qData:{title:"/title",rank:"/rank"}}};return GenericObject.create.call(Story,$.extend(!0,data,opts),app).then(function(newStory){return SlideModel.create(newStory,{rank:1})})},Story}),define("client.models/sheet",["jquery","core.models/generic-object","general.utils/visualizations","util","core.utils/deferred"],function($,GenericObject,Visualizations,util,Deferred){"use strict";function objIndex(sheet,pos){var i,child;for(i=0;i<sheet.cells.length;++i)if(child=sheet.cells[i],child.col===pos.col&&child.row===pos.row)return i;return-1}function getObject(sheet,pos,allowMissing){var index=objIndex(sheet,pos);if(-1===index){if(allowMissing)return null;throw new Error("invalid pos")}return sheet.cells[index]}function moveObject(obj,newPos){obj.col=newPos.col,obj.row=newPos.row,obj.colspan=newPos.colspan,obj.rowspan=newPos.rowspan}function setObject(sheet,pos,id,type){var obj=getObject(sheet,pos,!0),oldId=obj?obj.name:null;return obj?(obj.name=id,obj.type=type):sheet.cells.push({name:id,type:type,col:pos.col,row:pos.row,colspan:pos.colspan,rowspan:pos.rowspan}),oldId}function splitPos(pos,direction){var pos1={col:pos.col,row:pos.row,colspan:pos.colspan,rowspan:pos.rowspan},pos2={col:pos.col,row:pos.row,colspan:pos.colspan,rowspan:pos.rowspan};if("left"===direction||"right"===direction){var colspan=Math.ceil(pos.colspan/2);pos1.colspan-=colspan,pos2.col+=pos.colspan-colspan,pos2.colspan=colspan}if("top"===direction||"bottom"===direction){var rowspan=Math.ceil(pos.rowspan/2);pos1.rowspan-=rowspan,pos2.row+=pos.rowspan-rowspan,pos2.rowspan=rowspan}if("top"===direction||"left"===direction){var temp=pos1;pos1=pos2,pos2=temp}return{pos1:pos1,pos2:pos2}}function splitCell(props,pos,direction){var cell=getObject(props,pos,!1);if(!cell||cell.colspan!==pos.colspan||cell.rowspan!==pos.rowspan)return!1;var split=splitPos(cell,direction);return moveObject(cell,split.pos1),split.pos2}function findCellForId(id,cells){return cells.filter(function(cell){return cell.name===id})[0]}function addChildrenToObject(obj,children){for(var i=0;i<children.length;i++){var childProps=children[i];childProps.qInfo.qId=util.generateId(),obj.qChildren.push({qChildren:[],qProperty:childProps})}}var Sheet;return Sheet=GenericObject.extend("Sheet",{edit:function(modify){var that=this;return that.getProperties().then(function(props){return modify(props),that.save()})},getObject:function(pos,allowMissing){return this.getLayout().then(function(layout){return getObject(layout,pos,allowMissing)})},moveObject:function(originalPos,newPos){return this.edit(function(props){var obj=getObject(props,originalPos);return newPos.split&&(newPos=splitCell(props,newPos.pos,newPos.split),!newPos)?Deferred.reject():void moveObject(obj,newPos)})},swapObjects:function(srcPos,targetPos){return this.edit(function(props){var srcObj=getObject(props,srcPos),targetObj=getObject(props,targetPos,!0);moveObject(srcObj,targetPos),targetObj&&moveObject(targetObj,srcPos)})},addObject:function(args){var initProps,that=this,type=args.template,pos=args.cell.pos,vis=Visualizations.getType(type),init=args.init,children=args.children||[];return initProps=init.qExtendsId?Deferred.resolve(util.extend({qInfo:{qType:type}},init)):vis.getInitialProperties(init),Deferred.all({initProps:initProps,props:that.getFullPropertyTree()}).then(function(args){var visProps=args.initProps,sheetPropTree=args.props;if(pos.split&&(pos=splitCell(sheetPropTree.qProperty,pos.pos,pos.split),!pos))return Deferred.reject();visProps.qInfo.qId=util.generateId();var oldId=setObject(sheetPropTree.qProperty,pos,visProps.qInfo.qId,visProps.qInfo.qType);if(oldId){for(var i=0;i<sheetPropTree.qChildren.length;i++)if(sheetPropTree.qChildren[i].qProperty.qInfo.qId===oldId){sheetPropTree.qChildren[i].qProperty=visProps,sheetPropTree.qChildren[i].qChildren=[],addChildrenToObject(sheetPropTree.qChildren[i],children);break}}else{var len=sheetPropTree.qChildren.push({qChildren:[],qProperty:visProps});addChildrenToObject(sheetPropTree.qChildren[len-1],children)}return that.saveTree()})},getObjectById:function(objId){var i,child,cells=this.layout.cells;for(i=0;i<cells.length;++i)if(child=cells[i],objId===child.name)return child;return null},removeObject:function(pos){var that=this;return that.getProperties().then(function(props){var index=objIndex(props,pos),id=props.cells[index].name;if(-1===index)throw new Error("invalid pos");props.cells.splice(index,1),that.removeChild(id,props)})},setCloneChildrenInfos:function(newSheet){var oldSheet=this;return Deferred.all([oldSheet.getChildInfos(),newSheet.getChildInfos(),newSheet.getProperties()]).then(function(args){var oldChilds=args[0],newChilds=args[1],newProperties=args[2];return oldChilds.forEach(function(child,i){var cell=findCellForId(child.qId,newProperties.cells);cell&&(cell.name=newChilds[i].qId)}),newSheet.save().then(function(){return newSheet})})},clone:function(){var oldSheet=this;return this._super().then(function(newSheet){return oldSheet.setCloneChildrenInfos(newSheet)})},draft:function(app){var oldSheet=this;return app.rpc("CreateDraft","qDraftId",[this.id]).then(function(draftId){return Sheet.get(draftId).then(function(newSheet){return oldSheet.setCloneChildrenInfos(newSheet)})})}},{listProperties:{qAppObjectListDef:{qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}}}),Sheet.create=function(opts,app){var data={qMetaDef:{title:"",description:""},rank:-1,thumbnail:{qStaticContentUrlDef:null},columns:24,rows:12,cells:[]};return GenericObject.create.call(Sheet,$.extend(!0,data,opts),app)},Sheet.splitPos=splitPos,Sheet}),define("general.utils/name-generator",["util"],function(util){"use strict";var nameGenerator={};return nameGenerator.nextIndex=function(names,name){var re,highestIndex=1;return re=""===name?new RegExp("^\\((\\d+)\\)$"):new RegExp("^"+util.escapeRegExp(name)+" \\((\\d+)\\)$"),names.forEach(function(n){var res=re.exec(n);if(res&&2===res.length){var index=parseInt(res[1],10);highestIndex=Math.max(index+1,highestIndex)}}),highestIndex},nameGenerator.generateUniqueName=function(names,name){var nextIndex=nameGenerator.nextIndex(names,name);return""===name?"("+nextIndex+")":name+" ("+nextIndex+")"},nameGenerator}),define("client.views/app-overview/app-overview-state",["core.utils/notification","client.utils/state","general.utils/responsive-state"],function(Notification,State,ResponsiveState){
"use strict";var currentViewMode,currentNavigationMode,addingItem,duplicatingItem,viewModeBeforeEnterSmallDevice,AppOverviewState={};return AppOverviewState.ViewMode={grid:0,list:1},AppOverviewState.NavigationMode={sheet:"sheet",bookmark:"bookmark",story:"story"},currentViewMode=AppOverviewState.ViewMode.grid,currentNavigationMode=AppOverviewState.NavigationMode.sheet,viewModeBeforeEnterSmallDevice=currentViewMode,addingItem=!1,Notification.mixin(AppOverviewState),AppOverviewState.notification("ViewModeChanged"),AppOverviewState.notification("NavigationModeChanged"),AppOverviewState.notification("AddingItemChanged"),AppOverviewState.setViewMode=function(mode){mode!==currentViewMode&&(currentViewMode=mode,AppOverviewState.ViewModeChanged.emit(currentViewMode))},AppOverviewState.setNavigationMode=function(mode){mode!==currentNavigationMode&&(currentNavigationMode=mode,AppOverviewState.NavigationModeChanged.emit(currentNavigationMode))},AppOverviewState.setAddingItem=function(state){state!==addingItem&&(addingItem=state,AppOverviewState.AddingItemChanged.emit(addingItem))},AppOverviewState.setDuplicatingItem=function(state){state!==duplicatingItem&&(duplicatingItem=state)},State.StateChanged.bind(function(newView){newView===State.Views.sheet?AppOverviewState.setNavigationMode(AppOverviewState.NavigationMode.sheet):newView===State.Views.story&&AppOverviewState.setNavigationMode(AppOverviewState.NavigationMode.story)}),ResponsiveState.ViewChanged.bind(function(isSmallDevice){isSmallDevice&&(viewModeBeforeEnterSmallDevice=currentViewMode)}),Object.defineProperties(AppOverviewState,{viewMode:{get:function(){return currentViewMode}},navigationMode:{get:function(){return currentNavigationMode}},viewModeBeforeEnterSmallDevice:{get:function(){return viewModeBeforeEnterSmallDevice}},addingItem:{get:function(){return addingItem}},duplicatingItem:{get:function(){return duplicatingItem}}}),AppOverviewState}),define("general.models/items",["client.models/story","core.models/app","client.models/sheet","translator","general.utils/string-limits","util","general.utils/name-generator","core.utils/deferred","client.views/app-overview/app-overview-state"],function(Story,App,Sheet,translator,stringLimits,util,nameGenerator,Deferred,AppOverviewState){"use strict";function addItem(model,title,rank){var deferred=Deferred();return model.getList().then(function(list){list.getLayout().then(function(layout){var privateItemNames=[],titleExists=!1;layout.forEach(function(o){o.qMeta.published||(privateItemNames.push(o.qData.title),o.qData.title===title&&(titleExists=!0))});var nextIndex=nameGenerator.nextIndex(privateItemNames,title);(1!==nextIndex||titleExists)&&(title=title+" ("+nextIndex+")"),title=util.crop(title,stringLimits.name),model.create({rank:rank,qMetaDef:{title:title}}).then(function(newItem){deferred.resolve(newItem)})})}),deferred.promise}function duplicateItem(item,model){var deferred=Deferred();return AppOverviewState.duplicatingItem?deferred.reject():(AppOverviewState.setDuplicatingItem(!0),item.clone().then(function(newItem){newItem.getProperties().then(function(props){var changedProps={},newRank=0,title=props.qMetaDef.title;model.getList().then(function(list){list.getLayout().then(function(layout){var privateItems=[],privateItemNames=[];layout.forEach(function(o){o.qMeta.published||(privateItems.push(o),privateItemNames.push(o.qData.title))}),privateItems.forEach(function(o){o.qData.rank>newRank&&(newRank=o.qData.rank)});var newTitle=nameGenerator.generateUniqueName(privateItemNames,title);newTitle=util.crop(newTitle,stringLimits.name),AppOverviewState.newRank=newRank+1,changedProps=util.extend(!0,props,{qMetaDef:{title:newTitle},rank:AppOverviewState.newRank}),AppOverviewState.setDuplicatingItem(!1),newItem.setProperties(changedProps).then(function(){deferred.resolve(newItem)})})})})}),deferred.promise)}function draftItem(item,model){var deferred=Deferred();return item.draft(App.current).then(function(newItem){newItem.getProperties().then(function(props){var changedProps={},newRank=0;model.getList().then(function(list){list.getLayout().then(function(layout){var privateItems=layout.filter(function(o){return!o.qMeta.published});privateItems.forEach(function(o){o.qData.rank>newRank&&(newRank=o.qData.rank)}),changedProps=util.extend(!0,props,{rank:newRank+1}),newItem.setProperties(changedProps).then(function(){deferred.resolve(newItem.id)})})})})}),deferred.promise}var Items={};return Items.addSheet=function(rank){return addItem(Sheet,translator.get("SheetItem.myNewSheet"),rank)},Items.addStory=function(rank){return addItem(Story,translator.get("Storytelling.CreateNew"),rank)},Items.duplicateSheet=function(item){return duplicateItem(item,Sheet)},Items.duplicateStory=function(item){return duplicateItem(item,Story)},Items.draftSheet=function(itemId){return draftItem(itemId,Sheet)},Items}),define("scripteditor.utils/current-position",["util","client.utils/state"],function(util,state){"use strict";function toString(){var result;return result="sense"===util.project?state.view===state.Views.story?"storyview":state.view===state.Views.sheet||state.view===state.Views.masterObject||state.view===state.Views.object?state.isInEditMode()?"editsheetview":"sheetview":state.view===state.Views.dataSpace?"dataspace":"appview":util.project}return{toString:toString}}),define("scripteditor.views/quickimportprogressindicator/quickimportprogressindicator",["jquery","text!assets/scripteditor/views/quickimportprogressindicator/quickimportprogressindicator.ng.html","qvangular","translator","core.models/engine","general.views/confirm-dialog/confirm-dialog","assets/scripteditor/views/progressindicator/progressindicator-helper","scripteditor.services/timer","general.models/items","client.models/sheet","client.utils/routing","scripteditor.utils/current-position","core.utils/help-url","scripteditor.services/explicit-save-service"],function($,template,qvangular,translator,engine,confirmDialog,helper,timer,items,sheet,routing,currentPosition,helpUrl,explicitSaveService){"use strict";return{template:template,controller:["$scope","$timeout","$window",function($scope,$timeout,$window){function resultText(){var numberOfSheetKey="",calledFromAppView="";return"appview"===currentPosition.toString()&&(calledFromAppView=".appview",hasMultipleSheets&&(numberOfSheetKey=".hasmultiplesheets")),aborted?"quickdataimport.progressindicator.resulttext.aborted":$scope.succeded&&!$scope.warnings?"quickdataimport.progressindicator.resulttext"+calledFromAppView+".succeded"+numberOfSheetKey:$scope.succeded&&$scope.warnings?"quickdataimport.progressindicator.resulttext"+calledFromAppView+".warnings"+numberOfSheetKey:"quickdataimport.progressindicator.resulttext.failed"}function resetToDefault(){$scope.running=!1,$scope.succeded=!1,$scope.warnings=!1,$scope.warningInfo=[],syntheticCount=0,hasCircularRef=!1,aborted=!1}function generateWarningInfo(){if($scope.warnings&&($scope.warningInfo=[],hasCircularRef&&$scope.warningInfo.push({text:translator.get("scripteditor.progressindicator.edc_circular_referencesummary"),url:helpUrl.path+"#"+translator.language+"|QuickDataLoad_CircularReference",helpTooltip:translator.get("quickdataimport.progressindicator.readmoreaboutcircularreference")}),syntheticCount>0)){var syntheticKeyWarningText=translator.get("scripteditor.progressindicator.one_synthetic_keysummary");syntheticCount>1&&(syntheticKeyWarningText=translator.get("scripteditor.progressindicator.multiple_synthetic_keysummary",[syntheticCount])),$scope.warningInfo.push({text:syntheticKeyWarningText,url:helpUrl.path+"#"+translator.language+"|QuickDataLoad_SyntheticKey",helpTooltip:translator.get("quickdataimport.progressindicator.readmoreaboutsynthetickey")})}}function updateElapsedTime(){$scope.elapsedTime=timer.getElapsedTime()}function startTimer(){updateElapsedTime(),intervalID=$timeout(startTimer,500)}function startGettingProgressForLoad(){progressIntervalID=$timeout(function func(){engine.global.getProgress(0).then(handleProgress),progressIntervalID=$timeout(func,1e3)},1e3)}function stopGettingProgressForLoad(){$timeout.cancel(progressIntervalID)}function startProgress(){resetToDefault(),$scope.running=!0,timer.start(),abortButton.focus=!0,buttons=[abortButton],closeButton.disabled=!0,abortButton.disabled=!1,startTimer(),startGettingProgressForLoad()}function stopProgress(){closeButton.disabled=!1,closeButton.focus=!0,abortButton.disabled=!0,buttons=[closeButton],$scope.running=!1,$timeout.cancel(intervalID),timer.stop(),updateElapsedTime()}function handleProgress(result){var persistentProgressMessages=result.qProgressData.qPersistentProgressMessages,errorData=result.qProgressData.qErrorData;if(persistentProgressMessages&&persistentProgressMessages.length>0){var message=helper.translateMessageArray(persistentProgressMessages),isSynthetic=/\$Syn \d+ =/gm.test(message),synCount=isSynthetic?message.match(/\$Syn \d+ =/gm).length:0;isSynthetic&&(syntheticCount+=synCount,$scope.warnings=!0)}errorData&&errorData.forEach(function(error){"EDC_CIRCULAR_REFERENCE"===error.qErrorDataCode?($scope.warnings=!0,hasCircularRef=!0):$scope.succeded=!1})}function onSuccessfullLoad(){closeButton.focus=!0,buttons=[closeButton],("appview"===currentPosition.toString()||"storyview"===currentPosition.toString())&&sheet.getList().then(function(list){editSheetButton.disabled=!1,editSheetButton.focus=!0,buttons=[closeButton,editSheetButton],0===list.strippedLayout.length&&(items.addSheet(null),$scope.newSheetCreated=!0),list.strippedLayout.length>1&&(closeButton.focus=!0,buttons=[closeButton],hasMultipleSheets=!0)}),$scope.succeded=!0}function handleErrors(){$scope.succeded=!1,stopProgress()}function startRun(){startProgress(),$scope.input.executeBeforeRun.then(function(scriptModel){$scope.input.scriptModel=scriptModel,$scope.input.scriptModel.run().then(function(successful){return engine.global.getProgress(0).then(function(result){return stopGettingProgressForLoad(),handleProgress(result),$scope.dialogHandle&&($scope.dialogHandle.destroy(),abortButton.disabled=!0),generateWarningInfo(),successful?explicitSaveService.saveApp(function(){stopProgress(),onSuccessfullLoad()}):(stopProgress(),qvangular.promise())},handleErrors)},handleErrors)},handleErrors)}var intervalID,progressIntervalID;$scope.progressText=function(){return $scope.running?"quickdataimport.progressindicator.inprogress":resultText()},$scope.getHeading=function(){return $scope.running?"quickdataimport.progressindicator.headingdataimportinprogress":aborted?"quickdataimport.progressindicator.headingdataimportaborted":$scope.succeded&&!$scope.warnings?"quickdataimport.progressindicator.headingdataimportcompletedsuccessfully":$scope.succeded&&$scope.warnings?"quickdataimport.progressindicator.headingdataimportcompletedwithwarnings":"quickdataimport.progressindicator.headingdataimportfailed"},$scope.running=!1,$scope.succeded=!1,$scope.warnings=!1,$scope.warningInfo=[];var syntheticCount=0,hasCircularRef=!1,aborted=!1;$scope.openHelpWindow=function(url){$window.open(url)};var abortButton={title:"scripteditor.progressindicator.abortbutton",disabled:!0,eventHandler:function(){$scope.onAbortClicked()}},closeButton={title:"Common.Close",disabled:!1,focus:!1,eventHandler:function(){$scope.onCloseClicked()}},editSheetButton={title:"Dialog.Button.StartEditSheet",disabled:!1,focus:!1,eventHandler:function(){$scope.onCloseClicked(),sheet.getList().then(function(list){1===list.strippedLayout.length&&routing.goToSheet(list.strippedLayout[0].qInfo.qId,"edit")})}};$scope.newSheetCreated=!1;var hasMultipleSheets=!1,buttons=[closeButton];return $scope.buttons=function(){return buttons},$scope.onEnter=function(){closeButton.disabled||$scope.onEscape()},$scope.onCloseClicked=$scope.onEscape=function(){$scope.running?$scope.abortDialogActive||$scope.onAbortClicked():($scope.destroyComponent(),$scope.deferredResult.resolve())},$scope.onAbortClicked=function(){$scope.abortDialogActive=!0,abortButton.focus=!1,$scope.dialogHandle=confirmDialog.confirmAction({header:"scripteditor.cancelscriptrundialog.title",content:"scripteditor.cancelscriptrundialog.content",confirmButtonTitle:"Common.Yes",declineButtonTitle:"Common.No"}),$scope.dialogHandle.resultPromise.then(function(){aborted=!0,engine.global.cancelReload(),stopProgress()}),$scope.dialogHandle.resultPromise["finally"](function(){$scope.abortDialogActive=!1,$(".qv-quickimportprogressindicator .qui-delayedModal").focus(),abortButton.focus=!0})},startRun()}]}}),define("assets/hldm/models/load-model-runner",["assets/hldm/models/load-model","assets/hldm/models/load-model-compiler","assets/hldm/models/load-model-script-tab-updater","assets/scripteditor/views/progressindicator/progressindicator-helper","scripteditor.views/quickimportprogressindicator/quickimportprogressindicator","general.services/show-service/show-service","ng!$timeout"],function(LoadModel,loadModelCompiler,LoadModelScriptTabUpdater,helper,quickimportprogressindicator,showService,$timeout){function createLoadModelRunner(global,app,mainLoadModel,dataconnectorsModel){function runLoadModel(loadModel,logProgress,profilers,graphic){function handleProgress(result){var persistentProgressMessages=result.qProgressData.qPersistentProgressMessages,transientProgressMessage=result.qProgressData.qTransientProgressMessage,errorData=result.qProgressData.qErrorData;if(persistentProgressMessages&&persistentProgressMessages.length>0){var message=helper.translateMessageArray(persistentProgressMessages),isSynthetic=/\$Syn \d+ =/gi.test(message),syntheticCount=isSynthetic?message.match(/\$Syn \d+ =/gi).length:0;logProgress({content:message,type:isSynthetic?"synthetic_key":"",count:syntheticCount})}else transientProgressMessage&&logProgress({content:helper.translateMessage(transientProgressMessage),type:"transient"});errorData&&helper.filterOutDuplicates(errorData).forEach(function(val){logProgress({content:(val.qErrorString?val.qErrorString+"\n":"")+(val.qLine?val.qLine+val.qLineEnd:""),type:val.qErrorDataCode.toLowerCase()})})}var compileLoadModelToScriptPromise=loadModelCompiler.compileLoadModelToScript(loadModel,dataconnectorsModel).then(function(script){if(profilers)for(var i in profilers)profilers[i].getLoadScript&&(script+="\n\n"+profilers[i].getLoadScript());return script});if(graphic){var executeBeforeRunPromise=compileLoadModelToScriptPromise.then(function(script){return loadModelScriptTabUpdater.updateLoadModelScript(script).then(function(){return LoadModel.updateProperties(loadModel.serialize()).then(function(){return loadModelScriptTabUpdater.getScriptModelPromise()})})});return showService.show(quickimportprogressindicator,{executeBeforeRun:executeBeforeRunPromise,global:global}).resultPromise}return compileLoadModelToScriptPromise.then(function(script){return loadModelScriptTabUpdater.updateLoadModelScript(script).then(function(){var progressIntervalID=$timeout(function func(){global.getProgress(0).then(handleProgress),progressIntervalID=$timeout(func,250)},250);return logProgress({content:"Starting reload...",type:""}),global.configureReload(!0,!0,!1).then(function(){return app.doReload()}).then(function(){return $timeout.cancel(progressIntervalID),global.getProgress(0).then(handleProgress).then(function(){logProgress({content:"Load OK",type:""})}),!0},function(){return $timeout.cancel(progressIntervalID),global.getProgress(0).then(handleProgress).then(function(){logProgress({content:"Load Failed",type:""})}),!1})})})}function runMainLoadModel(infoCallback){return runLoadModel(mainLoadModel,infoCallback)}function runMainLoadModelGraphically(){return runLoadModel(mainLoadModel,function(){},[],!0)}function runLoadModelWithProfiling(loadModel,infoCallback,profilers){return runLoadModel(loadModel,infoCallback,profilers)}function getMainLoadModelScript(){return loadModelCompiler.compileLoadModelToScript(mainLoadModel,dataconnectorsModel)}var loadModelScriptTabUpdater=LoadModelScriptTabUpdater.createUpdater(global,app),loadModelRunner={runMainLoadModel:runMainLoadModel,getMainLoadModelScript:getMainLoadModelScript,runLoadModelWithProfiling:runLoadModelWithProfiling,runMainLoadModelGraphically:runMainLoadModelGraphically};return loadModelRunner}var exports={createLoadModelRunner:createLoadModelRunner};return exports}),define("assets/hldm/models/dataconnectors-model",["core.utils/deferred","require"],function(Deferred,require){function createDataconnectorsModel(engine,app,dataconnectorService,createPrivileges){function createConnectorMainObject(connectorType){var typeName=connectorType.provider;if(!connectorMainByTypeNamePromises[typeName]){var connectorMainDeferred=new Deferred;connectorMainByTypeNamePromises[typeName]=connectorMainDeferred.promise,require([connectorType.connectorMain],function(connectorMain){connectorMain&&connectorMain.create?Deferred.when(connectorMain.create(dataconnectorService.getServersideConnectorProxy(connectorType))).then(function(connectorMain){connectorMainDeferred.resolve(connectorMain)},function(){connectorMainDeferred.resolve(void 0)}):connectorMainDeferred.resolve(void 0)},function(){connectorMainDeferred.resolve(void 0)})}return connectorMainByTypeNamePromises[typeName]}function fetchCompleteConnectorFromConnectorType(connectorType){return createConnectorMainObject(connectorType).then(function(connectorMain){var connector={connectorType:connectorType,connectorMain:connectorMain};return connector},function(){return void 0})}function filterBadConnectors(allConnectors){return allConnectors.filter(function(connector){return connector&&connector.connectorMain&&connector.connectorMain.entrypoints})}function filterBadConnections(allConnections){return allConnections.filter(function(connection){return connection&&connection.connectorMain})}function fetchConnectors(){return dataconnectorService.getDataconnectorTypes().then(function(dataconnectorTypes){var connectorTypesToUse=dataconnectorTypes.filter(function(dataconnectorType){return dataconnectorService.hasConnectPrivileges(createPrivileges,dataconnectorType.type.toLowerCase())});return Deferred.all(connectorTypesToUse.map(fetchCompleteConnectorFromConnectorType)).then(filterBadConnectors)})}function getCompleteConnectionFromConnectorInstance(connectorInstance){if(!completeConnectionPromises[connectorInstance.name]){var def=new Deferred;completeConnectionPromises[connectorInstance.name]=def.promise,connectorInstance.type?createConnectorMainObject(connectorInstance.type).then(function(connectorMain){var connector={connectorInstance:connectorInstance,connectorMain:connectorMain};def.resolve(connector)},function(){def.resolve(void 0)}):def.resolve(void 0)}return completeConnectionPromises[connectorInstance.name]}function populateList(){return model.selectDialogsEnabled=!1,model.addButtonEnabled=!1,model.connectorTypesByName={},fetchConnectors().then(function(connectors){model.connectors=connectors;var allConnectorEntrypoints={database:[],file:[],web:[],datamarket:[]},connectorMainsByConnectorTypeName={};for(var i in connectors){var connectorMain=connectors[i].connectorMain;for(var j in connectorMain.entrypoints){var entrypoint=connectorMain.entrypoints[j];allConnectorEntrypoints[entrypoint.category]=allConnectorEntrypoints[entrypoint.category]||[],dataconnectorService.hasConnectPrivileges(createPrivileges,connectors[i].connectorType.type.toLowerCase())&&allConnectorEntrypoints[entrypoint.category].push({entrypoint:entrypoint,connectorMain:connectorMain,connectorType:connectors[i].connectorType})}connectorMainsByConnectorTypeName[connectors[i].connectorType.type]=connectorMain}return dataconnectorService.getDataconnectorInstances().then(function(connectorInstances){return Deferred.all(connectorInstances.map(getCompleteConnectionFromConnectorInstance)).then(filterBadConnections).then(function(conns){return model.connections=conns,model.allConnectorEntrypoints=allConnectorEntrypoints,model.completeConnectionPromises=completeConnectionPromises,model})})})}function getConnectionServersideProxy(connectorType,connectorInstance){return dataconnectorService.getServersideConnectorProxy(connectorType,connectorInstance)}function getConnectionFromServer(connectionName,usingExisting){return dataconnectorService.getDataconnectorInstances().then(function(list){for(var i=0;i<list.length;i++){var nameToLookFor=usingExisting?connectionName:dataconnectorService.appendUsernameSuffix(connectionName);if(list[i].name===nameToLookFor)return list[i]}return void 0})}function getConnectionFromModel(connectionName){for(var i in model.connections)if(model.connections[i].connectorInstance.name===connectionName)return model.connections[i]}var connectorMainByTypeNamePromises={},completeConnectionPromises={},model={connectors:[],connections:[],completeConnectionPromises:{},allConnectorEntrypoints:[],populateList:populateList,getConnectionServersideProxy:getConnectionServersideProxy,getConnectionFromServer:getConnectionFromServer,getConnectionFromModel:getConnectionFromModel,getCompleteConnectionInstance:getCompleteConnectionFromConnectorInstance};return populateList().then(function(model){return model})}var exports={createDataconnectorsModel:createDataconnectorsModel};return exports}),define("assets/datamodelviewer/constants/dmv-global-constants",[],function(){var exports={OFFSET_BETWEEN_TABLE_BOTTOM_AND_UL_BOTTOM:18,MIN_TABLE_RESIZE_WIDTH:150,TABLE_MINIMIZE_HEIGHT:28};return exports}),define("assets/datamodelviewer/utils/dmv-table-util",["jquery","assets/datamodelviewer/constants/dmv-global-constants","core.utils/deferred","assets/datamodelviewer/constants/dmv-global-constants","qvangular","general.services/loader/loader"],function($,globalConstants,Deferred,dmvConstants,qvangular){function _encodeTableName(tableName){return tableName=tableName.replace(/\$/g,"[dollar]"),tableName=tableName.replace(/\\/g,"[slash]")}function _decodeTableName(tableName){return tableName=tableName.replace(/\[dollar\]/g,"$"),tableName=tableName.replace(/\[slash\]/g,"\\")}function _decodeFieldName(fieldName){return fieldName}function _getTableElement(tableName){tableName=tableName.replace(/'/g,"\\'"),tableName=tableName.replace(/"/g,'\\"');var $table=$("div[name='"+tableName+"']");if(1!==$table.size())throw new Error('Could not find the table "'+tableName+'".');return $table}function _getAllTableElements(){var $tables=$("div[table]");return $tables}function _getFieldElement(tableName,fieldName){var $field=_getTableElement(tableName).find("li[data-name='"+fieldName+"']");if(1!==$field.size())throw new Error('Could not find the field "'+fieldName+'" in the table "'+tableName+'".');return $field}function _getTableHeaderByTableName(tableName){var $table=_getTableElement(tableName);return _getTableHeader($table)}function _getTableHeader($table){return $table.find("h1")}function _getTableHeaderHeightByTableName(tableName){var $table=_getTableElement(tableName);return _getTableHeaderHeight($table)}function _getTableHeaderHeight($table){return _getTableHeader($table).outerHeight()}function _getULHeight(tableName,tableHeight){return tableHeight-globalConstants.OFFSET_BETWEEN_TABLE_BOTTOM_AND_UL_BOTTOM-_getTableHeaderHeightByTableName(tableName)}function _getTableHeightByTableName(tableName){return _getTableElement(tableName).height()}function _getTableWidthByTableName(tableName){var $table=_getTableElement(tableName);return _getTableWidth($table)}function _getTableWidth($table){return $table.width()}function _setTablePosition(tableName,top,left){var deferred=new Deferred,properties={top:top,left:left};return _getTableElement(tableName).animate(properties,{duration:750,complete:function(){return deferred.resolve()}}),deferred.promise}function _setTableSize(tableName,height,width){var deferred=new Deferred,maxHeight=_getMaxHeightForTable(_getTableElement(tableName)),minWidth=_getMinWidthForTable(_getTableElement(tableName)),maxWidth=_getMaxWidthForTable(_getTableElement(tableName));height>maxHeight&&(height=maxHeight),width>maxWidth&&(width=maxWidth),minWidth>width&&(width=minWidth);var properties={height:height,width:width};return _getTableElement(tableName).animate(properties,{duration:750,progress:function(){_updateULHeightBasedOnTableHeight(tableName)},complete:function(){return _updateULHeightBasedOnTableHeight(tableName),deferred.resolve()}}),deferred.promise}function _updateULHeightBasedOnTableHeight(tableName){var height=_getTableHeightByTableName(tableName)-_getTableHeaderHeightByTableName(tableName)-dmvConstants.OFFSET_BETWEEN_TABLE_BOTTOM_AND_UL_BOTTOM;return _getTableElement(tableName).find("ul").height(height),Deferred.resolve()}function _getTableElementTop(tableName){var $table=_getTableElement(tableName),top=parseInt($table.css("top"),10);return top}function _getTableElementHeight($table){return $table.height()}function _getTableElementLeft(tableName){var $table=_getTableElement(tableName),left=parseInt($table.css("left"),10);return left}function _setTableContainerElementOpacity(opacity){var $element=$(".table-container");$element.css("opacity",opacity)}function _fadeInLines(){$("svg.dmv").fadeIn(750)}function _fadeOutLines(){var deferred=new Deferred;return $("svg.dmv").fadeOut(750,function(){return deferred.resolve()}),deferred.promise}function _fadeInWorkingOverlay(reloading){if(void 0===reloading)throw new Error("Reloading is undefined.");var qvLoader=qvangular.getService("qvLoader");qvLoader.close().then(function(){var translationID=reloading?"DataModelViewer.ReloadInProgress":"DataModelViewer.RefreshingDataModel";qvLoader.show({messageObj:{task:translationID},transparentBackground:!0})})}function _fadeOutWorkingOverlay(){var qvLoader=qvangular.getService("qvLoader");qvLoader.close()}function _getHighestHeightForAllTables(){var left=0,top=0,width=0,height=0,furthestLeft=Number.MAX_VALUE,furthestTop=Number.MAX_VALUE;return _getAllTableElements().each(function(index,element){var $element=$(element);left=Math.max(left,parseInt($element.css("left"),10)),top=Math.max(top,parseInt($element.css("top"),10)),width=Math.max(width,$element.width()),height=Math.max(height,$element.height()),furthestLeft=Math.min(furthestLeft,parseInt($element.css("left"),10)),furthestTop=Math.min(furthestTop,parseInt($element.css("top"),10))}),{left:left,top:top,width:width,height:height,bottom:top+height,right:left+width,furthestLeft:furthestLeft,furthestTop:furthestTop}}function _getMaxHeightForTable($table){var previousWidthValueTable=$table.css("height"),previousWidthValueUL=$table.find("ul").css("height");$table.css("height","auto"),$table.find("ul").css("height","auto");var maxHeight=$table.outerHeight();return $table.css("height",previousWidthValueTable),$table.find("ul").css("height",previousWidthValueUL),maxHeight}function _getMaxHeightForTableByName(tableName){var $table=_getTableElement(tableName);return _getMaxHeightForTable($table)}function _getMaxWidthForTable($table){var previousWidthValue=$table.css("width");$table.css("width","auto");var maxWidth=$table.outerWidth();return $table.css("width",previousWidthValue),maxWidth}function _getMaxWidthForTableByName(tableName){var $table=_getTableElement(tableName);return _getMaxWidthForTable($table)}function _getMinWidthForTable($table){var minWidth=Math.min(dmvConstants.MIN_TABLE_RESIZE_WIDTH,_getMaxWidthForTable($table));return minWidth}function _getMinHeightForTable($table){return _getTableHeaderHeight($table)}var exports={encodeTableName:_encodeTableName,decodeTableName:_decodeTableName,decodeFieldName:_decodeFieldName,setTablePosition:_setTablePosition,setTableSize:_setTableSize,setTableContainerElementOpacity:_setTableContainerElementOpacity,getTableWidth:_getTableWidth,getTableWidthByTableName:_getTableWidthByTableName,getTableElementHeight:_getTableElementHeight,getMaxHeightForTable:_getMaxHeightForTable,getMaxWidthForTable:_getMaxWidthForTable,getMinWidthForTable:_getMinWidthForTable,getTableElement:_getTableElement,getFieldElement:_getFieldElement,getMinHeightForTable:_getMinHeightForTable,getTableHeader:_getTableHeaderByTableName,getTableHeaderHeightByTableName:_getTableHeaderHeightByTableName,getULHeight:_getULHeight,getTableHeightByTableName:_getTableHeightByTableName,getTableElementTop:_getTableElementTop,getTableElementLeft:_getTableElementLeft,getAllTableElements:_getAllTableElements,getHighestHeightForAllTables:_getHighestHeightForAllTables,getMaxHeightForTableByName:_getMaxHeightForTableByName,getMaxWidthForTableByName:_getMaxWidthForTableByName,updateULHeightBasedOnTableHeight:_updateULHeightBasedOnTableHeight,fadeInLines:_fadeInLines,fadeOutLines:_fadeOutLines,fadeInWorkingOverlay:_fadeInWorkingOverlay,fadeOutWorkingOverlay:_fadeOutWorkingOverlay};return exports}),define("assets/datamodelviewer/services/dmv-data-raw-engine-service",["jquery","core.models/engine","assets/datamodelviewer/utils/dmv-table-util","core.utils/deferred","autogenerated/qix/engine-enums"],function($,engine,dmvDataTableService,Deferred,engineEnums){function _getTablesAndKeys(internalTableView){if(cachedTablesAndKeysData)return Deferred.resolve(cachedTablesAndKeysData);var deferred=new Deferred,MARGIN_WIDTH=200,PADDING_HEIGHT=30,canvasWidth=$(".table-container").width()-MARGIN_WIDTH,canvasHeight=$(".table-container").height()-PADDING_HEIGHT+$("#datamodelviewer_footer").height(),qWindowSize={qcx:canvasWidth,qcy:canvasHeight},qNullSize={qcx:0,qcy:0},qCellHeight=30,qSyntheticMode=internalTableView,qIncludeSysVars=!1;return engine.currentApp.getTablesAndKeys(qWindowSize,qNullSize,qCellHeight,qSyntheticMode,qIncludeSysVars).then(function(data){return cachedTablesAndKeysData=data,superSecretCachedTablesAndKeysData=data,deferred.resolve(data)},function(error){return error.code===engineEnums.LOCERR_RELOAD_IN_PROGRESS&&(error.isHandled=!0),deferred.resolve(superSecretCachedTablesAndKeysData)}),deferred.promise}function _getLooselyCoupledVector(callbackFunction){return cachedLooselyCoupledVectorData?void callbackFunction(cachedLooselyCoupledVectorData):void engine.currentApp.getLooselyCoupledVector().then(function(data){cachedLooselyCoupledVectorData=data,callbackFunction(data)})}function _getTableData(internalTableView,tableName){if(!tableName)throw"Table name is empty.";var qOffset=-1,qRows=NBR_OF_ROWS_DATA_PREVIEW,qSyntheticMode=internalTableView,qTableName=dmvDataTableService.decodeTableName(tableName);return engine.currentApp.getTableData(qOffset,qRows,qSyntheticMode,qTableName)}function _getTableBounds(){return engine.currentApp.getViewDlgSaveInfo()}function _setTableBounds(requestData){return engine.currentApp.setViewDlgSaveInfo(requestData)}function _clearAllCaches(){cachedTablesAndKeysData=void 0,cachedLooselyCoupledVectorData=void 0}function _setDerivedField(fieldName,templateNames){return engine.currentApp.assignDerivedFieldFor(fieldName,templateNames)}function _hasAppGotData(){return engine.currentApp.getAppLayout().then(function(result){return!!result.qLayout.qHasData})}var cachedTablesAndKeysData,superSecretCachedTablesAndKeysData,cachedLooselyCoupledVectorData,NBR_OF_ROWS_DATA_PREVIEW=61,exports={getTablesAndKeys:_getTablesAndKeys,getLooselyCoupledVector:_getLooselyCoupledVector,getTableData:_getTableData,getTablePositions:_getTableBounds,setTablePositions:_setTableBounds,clearAllCaches:_clearAllCaches,setDerivedField:_setDerivedField,hasAppGotData:_hasAppGotData};return exports}),define("assets/hldm/services/hldm-data-preview-service",["core.utils/deferred","underscore","assets/datamodelviewer/services/dmv-data-raw-engine-service"],function(Deferred,underscore,realDMVDataRawEngineService){function _getDataPreview(isInternalView,options,_dmvDataRawEngineService){if(_dmvDataRawEngineService||(_dmvDataRawEngineService=realDMVDataRawEngineService),void 0===isInternalView)throw new Error("Internal view is not specified.");if(!underscore.isArray(options))throw new Error("Options is not an array.");for(var promises=[],results=[],i=0;i<options.length;i++){var tableOption=options[i];promises.push(_getFormattedDataPreview(_dmvDataRawEngineService,results,isInternalView,tableOption))}return Deferred.all(promises).then(function(){
return Deferred.resolve(results)})}function _findFieldIndexInRawData(rawData,wantedFieldName){for(var i=0;i<rawData.qData[0].qValue.length;i++)if(rawData.qData[0].qValue[i].qText===wantedFieldName)return i;return void 0}function _getFormattedDataPreview(_dmvDataRawEngineService,results,isInternalView,tableOption){var deferredPerTable=new Deferred,tableName=tableOption.tableName;return _dmvDataRawEngineService.getTableData(isInternalView,tableName).then(function(rawData){for(var resultTable={tableName:tableName,exists:!0,fields:[]},f=0;f<tableOption.fields.length;f++){var fieldName=tableOption.fields[f],fieldIndexInRawData=_findFieldIndexInRawData(rawData,fieldName);if(void 0===fieldIndexInRawData)resultTable.fields.push({fieldName:fieldName,exists:!1});else{for(var resultField={fieldName:fieldName,exists:!0,values:[]},k=1;k<rawData.qData.length;k++)resultField.values.push({text:rawData.qData[k].qValue[fieldIndexInRawData].qText,numeric:rawData.qData[k].qValue[fieldIndexInRawData].qIsNumeric,number:rawData.qData[k].qValue[fieldIndexInRawData].qNumber});resultTable.fields.push(resultField)}}results.push(resultTable),deferredPerTable.resolve()},function(error){error.isHandled=!0,results.push({tableName:tableName,exists:!1,fields:[]}),deferredPerTable.resolve()}),deferredPerTable.promise}return{getDataPreview:_getDataPreview}}),define("assets/hldm/profilers/simple-associations-hypercube",[],function(){var hyperCubeProperties={qInfo:{qType:"simple-assocations-profiler"},qMetaDef:{},qHyperCubeDef:{qDimensions:[{qDef:{qGrouping:"N",qFieldDefs:["Profiling_ExistingColumn"],qFieldLabels:[""],qSortCriterias:[{qSortByAscii:1,qSortByLoadOrder:1,qExpression:{}}],qNumberPresentations:[],qActiveField:0},qOtherTotalSpec:{qOtherMode:"OTHER_OFF",qOtherCounted:{qv:"10"},qOtherLimit:{qv:"0"},qOtherLimitMode:"OTHER_GE_LIMIT",qForceBadValueKeeping:!0,qApplyEvenWhenPossiblyWrongResult:!0,qOtherSortMode:"OTHER_SORT_DESCENDING",qTotalMode:"TOTAL_OFF",qReferencedExpression:{}}},{qDef:{qGrouping:"N",qFieldDefs:["Profiling_NewColumn"],qFieldLabels:[""],qSortCriterias:[{qSortByAscii:1,qSortByLoadOrder:1,qExpression:{}}],qNumberPresentations:[],qActiveField:0},qOtherTotalSpec:{qOtherMode:"OTHER_OFF",qOtherCounted:{qv:"10"},qOtherLimit:{qv:"0"},qOtherLimitMode:"OTHER_GE_LIMIT",qForceBadValueKeeping:!0,qApplyEvenWhenPossiblyWrongResult:!0,qOtherSortMode:"OTHER_SORT_DESCENDING",qTotalMode:"TOTAL_OFF",qReferencedExpression:{}}}],qMeasures:[{qDef:{qLabel:"MatchPoint",qTags:[],qGrouping:"N",qDef:"Sum([Profiling_ExistingColumnValueCount]) / Sum(total <Profiling_NewColumn>[Profiling_NewColumnValueCount])\n*\nSum([Profiling_NewColumnValueCount]) / Sum(total <Profiling_ExistingColumn>[Profiling_ExistingColumnValueCount])",qNumFormat:{qType:"F",qnDec:2,qUseThou:0,qFmt:"0%",qDec:",",qThou:" "},qAggrFunc:"0",qAccumulate:0,qActiveExpression:0,qExpressions:[]},qSortBy:{qSortByNumeric:-1,qSortByLoadOrder:1,qExpression:{}},qAttributeExpressions:[{},{}]},{qDef:{qLabel:"Count New",qTags:[],qGrouping:"N",qDef:"Sum(Profiling_NewColumnValueCount)",qNumFormat:{qType:"U",qnDec:10,qUseThou:0},qAggrFunc:"0",qAccumulate:0,qActiveExpression:0,qExpressions:[]},qSortBy:{qSortByNumeric:-1,qSortByLoadOrder:1,qExpression:{}},qAttributeExpressions:[{},{}]},{qDef:{qLabel:"Total New",qTags:[],qGrouping:"N",qDef:"Sum(total <Profiling_NewColumn>[Profiling_NewColumnValueCount])",qNumFormat:{qType:"U",qnDec:10,qUseThou:0},qAggrFunc:"0",qAccumulate:0,qActiveExpression:0,qExpressions:[]},qSortBy:{qSortByNumeric:-1,qSortByLoadOrder:1,qExpression:{}},qAttributeExpressions:[{},{}]},{qDef:{qLabel:"Count Existing",qTags:[],qGrouping:"N",qDef:"Sum(Profiling_ExistingColumnValueCount)",qNumFormat:{qType:"U",qnDec:10,qUseThou:0},qAggrFunc:"0",qAccumulate:0,qActiveExpression:0,qExpressions:[]},qSortBy:{qSortByNumeric:-1,qSortByLoadOrder:1,qExpression:{}},qAttributeExpressions:[{},{}]},{qDef:{qLabel:"Total Existing",qTags:[],qGrouping:"N",qDef:"Sum(total <Profiling_ExistingColumn>[Profiling_ExistingColumnValueCount])",qNumFormat:{qType:"U",qnDec:10,qUseThou:0},qAggrFunc:"0",qAccumulate:0,qActiveExpression:0,qExpressions:[]},qSortBy:{qSortByNumeric:-1,qSortByLoadOrder:1,qExpression:{}},qAttributeExpressions:[{},{}]}],qInterColumnSortOrder:[2,4,6,3,5,0,1],qSuppressMissing:!0,qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:10,qHeight:10}],qReductionMode:"N",qMode:"S",qPseudoDimPos:-1,qNoOfLeftDims:-1,qMaxStackedCells:5e3,qLayoutExclude:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qInitialDataFetch:[],qReductionMode:"N",qMode:"S",qPseudoDimPos:-1,qNoOfLeftDims:-1,qMaxStackedCells:5e3}}}},exports={hyperCubeProperties:hyperCubeProperties};return exports}),define("assets/hldm/profilers/simple-associations-profiler",["core.models/app","core.models/generic-object","assets/hldm/templating/template-runner","assets/hldm/profilers/simple-associations-hypercube","assets/hldm/templating/template-helpers"],function(App,GenericObject,templateRunner,hyperCubeDef){function getOrCreateHypercube(){return App.get().then(function(app){return app.createSessionObject(hyperCubeDef.hyperCubeProperties).then(function(result){return new GenericObject({id:null,handle:result.qHandle,session:app.session})}).then(function(model){return model})})}function translateToResult(tableOfInterest,correlationsList){var i,field,result={type:"",table:tableOfInterest,likelyhood:0,associations:[],nonassociations:[],rawData:{correlationsList:correlationsList}};if(correlationsList[0].match>.4){result.type="associated",result.likelyhood=correlationsList[0].match;for(i in correlationsList)field=correlationsList[i],field.match>.4?result.associations.push({name:field.name,alias:field.alias}):field.match<.4&&field.name===field.alias&&result.nonassociations.push({name:field.name})}else{result.likelyhood=isNaN(correlationsList[0].match)?0:1-correlationsList[0].match,result.type="unassociated";for(i in correlationsList)field=correlationsList[i],field.name===field.alias&&result.nonassociations.push({name:field.name})}return result}function layoutToCorrelationsList(layout){return layout.qHyperCube.qDataPages[0].qMatrix.map(function(row){return{name:row[0].qText,alias:row[1].qText,match:row[2].qNum,matchTxt:row[2].qText,newCount:row[3]?row[3].qNum:0,newCountTotal:row[4]?row[4].qNum:0,existingCount:row[5]?row[5].qNum:0,existingCountTotal:row[6]?row[6].qNum:0}})}function createProfiler(loadModel,tableOfInterest){function getLoadScript(){var data={allTables:loadModel.tableModels.map(function(tableModel){return tableModel.data.tableAlias}),tableOfInterest:tableOfInterest};return templateRunner.render("",data)}function getResult(){return getOrCreateHypercube().then(function(model){return model.getLayout().then(function(layout){return translateToResult(tableOfInterest,layoutToCorrelationsList(layout))})})}var profiler={getLoadScript:getLoadScript,getResult:getResult};return profiler}var exports={createProfiler:createProfiler,_translateToResult:translateToResult};return exports}),define("assets/hldm/models/preview-model",["assets/hldm/profilers/simple-associations-profiler"],function(SimpleAssociationsProfiler){function createPreviewModel(newLoadModel,loadModelRunner){function runProfiling(tableOfInterest){var simpleAssociationsProfiler=SimpleAssociationsProfiler.createProfiler(newLoadModel,tableOfInterest);return loadModelRunner.runLoadModelWithProfiling(newLoadModel,[simpleAssociationsProfiler]).then(function(){return simpleAssociationsProfiler.getResult()})}var loadModelAnalyzer={runProfiling:runProfiling};return loadModelAnalyzer}var exports={createPreviewModel:createPreviewModel};return exports}),define("assets/datamodelviewer/services/dmv-data-preview-service",["assets/datamodelviewer/services/dmv-data-raw-engine-service"],function(dmvDataRawEngineService){function _getDataPreviewForTable(internalTableView,tableName,fields){if(void 0===internalTableView)throw new Error("Internal view is undefined.");if(!tableName)throw"Table name is empty.";if(void 0===fields)throw new Error("Fields are undefined.");return dmvDataRawEngineService.getTableData(internalTableView,tableName).then(function(response){var previewData=[],responseData=response.qData,colID=0;for(var i in fields){var fieldName=fields[i],columnIndexInResponseData=_getcolumnIndexInResponseData(fieldName,responseData);if(-1!==columnIndexInResponseData){for(var rowNbr=0;rowNbr<responseData.length;rowNbr++){void 0===previewData[rowNbr]&&(previewData[rowNbr]=[]);var responseValue=responseData[rowNbr].qValue[columnIndexInResponseData].qText,isNumeric=responseData[rowNbr].qValue[columnIndexInResponseData].qIsNumeric;previewData[rowNbr][colID]={label:responseValue,isNumeric:isNumeric}}colID++}}return previewData})}function _getcolumnIndexInResponseData(fieldName,responseData){for(var i in responseData[0].qValue){var responseFieldName=responseData[0].qValue[i].qText;if(responseFieldName===fieldName)return i}return-1}return{getDataPreviewForTable:_getDataPreviewForTable}}),define("text!assets/hldm/views/wizard/wizard.ng.html",[],function(){return'<div class="qv-hdlm-wizard modal-container qui-modalbackground-centered"\r\n	 tabindex="-1"\r\n	 tid="hdlm-wizard" ng-class="{\'opening\': opening, \'closing\': !opening}" qv-tabbable-container>\r\n\r\n	<div class="hdlm-title">\r\n		<h2 class="q-header" q-translation="{{wizardTitle}}"></h2>\r\n\r\n		<div class=\'qui-btn-icn icon-close\' q-title-translation="Common.Close" qva-activate="close()" tid="hdlm-quit"></div>\r\n	</div>\r\n\r\n	<div ng-if="initializing" class="loading-screen">\r\n		<div class="spinner">\r\n			<div class="qv-loader"></div>\r\n		</div>\r\n		<div q-translation="quickdataload.initializeWizard"></div>\r\n	</div>\r\n\r\n	<div class="main-step-container" ng-repeat="step in steps" qva-activate="onOut($event)" ng-class="step.input.qvDialogContext.cstmClass" qva-wizard-steps>\r\n		<div class="inner-container">\r\n			<div class="qui-whiteModal main-step"\r\n				 id="qv-animation-frame"\r\n				 ng-style="step.input.qvDialogContext.customCss"\r\n				 ng-class="{\'sizeS\': step.input.qvDialogContext.size == \'S\',\r\n			 \'sizeM\': step.input.qvDialogContext.size == \'M\',\r\n			 \'sizeL\': step.input.qvDialogContext.size == \'L\'}"\r\n				 qva-report-element-size="step.stepSize">\r\n				<div class="qv-header main-step-title">{{step.input.qvDialogContext.title|translate}}\r\n					<i class="icon-info" ng-show="!!step.input.qvDialogContext.stepInfo" qva-activate="toggleInfoView(step)" q-title-translation="quickdataload.infoText"></i>\r\n				</div>\r\n\r\n				<div class="qv-info" ng-show="!!step.input.qvDialogContext.stepInfo && step.input.qvDialogContext.stepInfo.show">\r\n					<div class="qv-info-content" ng-include="step.input.qvDialogContext.stepInfo.templateUrl"></div>\r\n					<div class="qv-info-actions">\r\n					<div qva-activate="toggleInfoView(step, true)" class="icon-move-direction" q-title-translation="quickdataload.hideInfoText"></div>\r\n					</div>\r\n				</div>\r\n\r\n				<div class="qv-content">\r\n					<qv-include-wizard-step data-qv-dialog-context="step.qvDialogContext" data-component="step.component" data-input="step.input"/>\r\n				</div>\r\n				<div class="footer-info" ng-if="step.input.qvDialogContext.showLink">\r\n  					<a href="{{qvLinkUrl}}" target="_blank" q-translation="quickdataload.download"></a>\r\n				</div>\r\n				<div class="footer-info" ng-if="step.input.qvDialogContext.showDatamarketDisclaimer">\r\n					<span q-translation="datamarket.disclaimer"></span>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div class="qv-wizard-nav-area">\r\n			<div class="wizard-nav-area-outsides"></div>\r\n			<div class="wizard-nav-area-center">\r\n				<div class="wizard-button-block">\r\n					<qui-button-outline-round tid="hdlm-prev" q-title-translation="quickdataload.wizardBackBtn" ng-disabled="wizardData.disableBack" ng-style="{ visibility: wizardData.showBack ? \'visible\' : \'hidden\' }" qva-activate="step.input.qvDialogContext.back()" class-icon="icon-hub-previous"/>\r\n				</div>\r\n				<div class="fake-button-block"></div>\r\n				<!--this is to force the css to center this area as if there was a button here -->\r\n\r\n			</div>\r\n			<div class="wizard-nav-area-outsides subract-wizard-button-margin">\r\n				<div class="wizard-button-block">\r\n					<qui-button-outline-round tid="hdlm-next" q-title-translation="{{step.input.qvDialogContext.nextText?step.input.qvDialogContext.nextText:\'quickdataload.wizardNextBtn\'}}" ng-disabled="wizardData.disableNext" ng-style="{ visibility: wizardData.showNext ? \'visible\' : \'hidden\' }" qva-activate="step.input.qvDialogContext.next()" class-icon="icon-hub-next" qva-button-pre-icon-text="step.input.qvDialogContext.nextText"/>\r\n				</div>\r\n				<div class="wizard-button-block">\r\n					<qui-button-outline-round q-title-translation="quickdataload.loadAndFinish" ng-disabled="wizardData.disableFinish" ng-style="{ visibility: wizardData.showFinish ? \'visible\' : \'hidden\' }" qva-button-text="quickdataload.loadAndFinish" qva-activate="step.input.qvDialogContext.finish()"/>\r\n				</div>\r\n			</div>\r\n		</div>\r\n\r\n	</div>\r\n\r\n</div>'}),define("assets/scripteditor/directives/sizing-directives",["qvangular","ng!$rootScope","ng!$timeout","ng!$parse","core.utils/resize"],function(qvangular,$rootScope,$timeout,$parse,Resize){function resizeTriggerCounter(){return $rootScope.qvReadableResizeTriggerCounter}return $rootScope.qvResizeTriggerCounter=0,$rootScope.qvReadableResizeTriggerCounter=0,$rootScope.$watch("qvResizeTriggerCounter",function(){$timeout(function(){$rootScope.qvReadableResizeTriggerCounter++},0)}),qvangular.directive("qvaTriggersResizingAfterTransition",function(){return{restrict:"A",link:function(scope,elem){elem.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend msTransitionEnd",function(){qvangular.$apply(function(){$rootScope.qvResizeTriggerCounter++})})}}}),qvangular.directive("qvaTriggersResizing",function(){return{restrict:"A",link:function(scope,elem,attr){scope.$watch(attr.qvaTriggersResizing,function(value){"undefined"!=typeof value&&$rootScope.qvResizeTriggerCounter++})}}}),qvangular.directive("qvaTriggersResizingDeep",function(){return{restrict:"A",link:function(scope,elem,attr){scope.$watch(attr.qvaTriggersResizingDeep,function(value){"undefined"!=typeof value&&$rootScope.qvResizeTriggerCounter++},!0)}}}),qvangular.directive("qvaTriggersResizingCollection",function(){return{restrict:"A",link:function(scope,elem,attr){scope.$watchCollection(attr.qvaTriggersResizingCollection,function(value){"undefined"!=typeof value&&$rootScope.qvResizeTriggerCounter++})}}}),Resize.on("end",function(){qvangular.$apply(function(){$rootScope.qvReadableResizeTriggerCounter++})}),qvangular.directive("qvaReportElementSize",function(){return{restrict:"A",link:function(scope,elem,attr){var lastWidth,lastHeight,assignValue=$parse(attr.qvaReportElementSize).assign;scope.$watch(function(){return $rootScope.qvReadableResizeTriggerCounter},function(){var height=elem.outerHeight(),width=elem.outerWidth();if(height!==lastHeight||width!==lastWidth){var newSize={width:width,height:height};lastHeight=height,lastWidth=width,assignValue(scope,newSize)}})}}}),{resizeTriggerCounter:resizeTriggerCounter}}),define("text!general.services/fullscreen-message/fullscreen-message-snp.ng.html",[],function(){return'<div class="qv-block-ui qv-size-warning">\r\n	<div class="w-msg" q-translation="{{message}}"></div>\r\n\r\n	<qui-button\r\n			ng-if="button"\r\n			qva-activate="button.callback()"\r\n			q-translation="{{button.name}}"\r\n			light\r\n			></qui-button>\r\n</div>'}),define("general.services/fullscreen-message/fullscreen-message-snp",["qvangular","text!general.services/fullscreen-message/fullscreen-message-snp.ng.html"],function(qvangular,template){function show(args){thisIsOpen||(thisIsOpen=!0,scope=args.scope.$new(),scope.mode=args.mode,scope.message=args.message,scope.button=args.button||!1,elem=$compile(template)(scope).appendTo("body"),scope.$on("$destroy",close))}function close(){thisIsOpen&&(elem&&elem.length&&elem.remove(),thisIsOpen=!1,scope.$destroy(),scope=null,elem=null)}var elem,scope,$compile=qvangular.getService("$compile"),thisIsOpen=!1;qvangular.service("qvSizeNotSupported",[function(){return{show:show,close:close,isOpen:function(){return thisIsOpen}}}])}),define("assets/hldm/views/wizard/wizard-animations",["qvangular"],function(qvangular){var transition="all 500ms ease";qvangular.directive("qvaWizardSteps",["$timeout","qvWizardService",function($timeout,qvWizardService){return{restrict:"A",link:function($scope,$element){function setAnimationOnWizardStep(newIndex,oldIndex){newIndex===oldIndex||0>oldIndex||($scope.$index===$scope.currentIndex?animateToActive():oldIndex>newIndex?middleToRight():middleToLeft())}function setBackAndNextButtonsVisibiltyAndEnabledState(){$scope.wizardData.showBack=$scope.$index>0&&$scope.$index===$scope.currentIndex,$scope.wizardData.disableBack=!$scope.wizardData.showBack||$scope.wizardData.showBack&&$scope.step.input.qvDialogContext.backDisabled(),$scope.wizardData.showNext=($scope.step.input.qvDialogContext.hasNextStep||$scope.$index<$scope.steps.length-1)&&$scope.$index===$scope.currentIndex,$scope.wizardData.disableNext=!$scope.wizardData.showNext||$scope.wizardData.showNext&&$scope.step.input.qvDialogContext.nextDisabled(),$scope.wizardData.showFinish=$scope.$index===$scope.currentIndex&&$scope.step.input.qvDialogContext.finish,$scope.wizardData.disableFinish=!$scope.wizardData.showFinish||$scope.wizardData.showFinish&&$scope.step.input.qvDialogContext.finishDisabled()}function checkWizardButtonWatchers(){nextDialogWatcher(),backDialogWatcher(),finishDialogWatcher()}function destroy(){animationElem.off(".anime"),animationElem=null,$timeout.cancel(timer),timer=null,colWatcherDestroy(),checkWizardButtonWatchers()}function animate(opacity,transform,transition){qvWizardService.setupTransition(animationElem[0],transition),qvWizardService.startAnimation(animationElem[0],opacity,transform),$element[0].style["z-index"]=opacity?200:100}function animateToActive(){animate(1,"translate(0px, 0px)",transition)}function middleToRight(){animate(0,"translate(200%, 0px)",transition)}function middleToLeft(){animate(0,"translate(-200%, 0px)",transition)}function animationDone(){animationElem.off(".anime"),qvWizardService.clearTransitions(animationElem[0])}var colWatcherDestroy,nextDialogWatcher,backDialogWatcher,finishDialogWatcher,timer,animationElem=$element.find("#qv-animation-frame");$scope.wizardData={showBack:!1,disableBack:!1,showNext:!1,disableNext:!1,showFinish:!1,disableFinish:!0},colWatcherDestroy=$scope.$watchCollection("[currentIndex, step.input.qvDialogContext.hasNextStep]",function(newArgs,oldArgs){($scope.$index===newArgs[0]||$scope.$index===oldArgs[0])&&(setBackAndNextButtonsVisibiltyAndEnabledState(),setAnimationOnWizardStep(newArgs[0],oldArgs[0]))}),nextDialogWatcher=$scope.$watch(function(){return $scope.step.input&&$scope.step.input.qvDialogContext&&$scope.step.input.qvDialogContext.nextDisabled?$scope.step.input.qvDialogContext.nextDisabled():!1},setBackAndNextButtonsVisibiltyAndEnabledState),backDialogWatcher=$scope.$watch(function(){return $scope.step.input&&$scope.step.input.qvDialogContext&&$scope.step.input.qvDialogContext.backDisabled?$scope.step.input.qvDialogContext.backDisabled():!1},setBackAndNextButtonsVisibiltyAndEnabledState),finishDialogWatcher=$scope.$watch(function(){return $scope.step.input&&$scope.step.input.qvDialogContext&&$scope.step.input.qvDialogContext.finishDisabled?$scope.step.input.qvDialogContext.finishDisabled():!1},setBackAndNextButtonsVisibiltyAndEnabledState),animate(0,"translate(200%, 0px)","all 0ms ease"),timer=$timeout(animateToActive,25),qvWizardService.isFirstTimeRendering()&&(qvWizardService.setFirstTimeRenderingToNewValue(!1),animationElem.on("transitionend.anime webkitTransitionEnd.anime MSTransitionEnd.anime",animationDone)),$scope.$on("$destroy",destroy)}}}])}),define("assets/hldm/views/wizard/wizard-service",["qvangular"],function(qvangular){qvangular.service("qvWizardService",function(){var firstTimeRender=!0,canStep=!0;return{canStep:function(){return canStep?(setTimeout(function(){canStep=!0},300),canStep=!1,!0):!1},clearTransitions:function(elem){this.setupTransition(elem,""),this.startAnimation(elem,null,"")},setupTransition:function(elem,transition){elem.style.transition=elem.style.webkitTransition=elem.style.mozTransition=elem.style.msTransition=transition},startAnimation:function(elem,opacity,transform){null!==opacity&&(elem.style.opacity=opacity,elem.style.visibility=opacity?"visible":"hidden"),elem.style.transform=elem.style.webkitTransform=elem.style.mozTransform=elem.style.msTransform=transform},isFirstTimeRendering:function(){return firstTimeRender},setFirstTimeRenderingToNewValue:function(value){firstTimeRender=value},destroy:function(){firstTimeRender=!0}}})}),define("assets/hldm/views/wizard/wizard",["qvangular","text!./wizard.ng.html","general.utils/responsive-state","general.utils/dom-util","core.utils/help-url","assets/scripteditor/directives/sizing-directives","general.services/fullscreen-message/fullscreen-message-snp","./wizard-animations","./wizard-service","assets/client/dialogs/directives/tabbable-container"],function(qvangular,template,ResponsiveState,DOMUtil,helpUrl){qvangular.componentDirective("qvIncludeWizardStep",{});var component={replace:!0,restrict:"EA",scope:{wizardControl:"="},template:template,controller:["$scope","$timeout","$document","$element","qvSizeNotSupported","$delayedModal","qvWizardService",function($scope,$timeout,$document,$element,qvSizeNotSupported,$delayedModal,qvWizardService){function yourScreenIsToSmallWarning(isSmall){isSmall?(qvSizeNotSupported.show({mode:"warning",message:"Fullscreen.SizeNotSupported",scope:$scope}),arrowNavigationProhibited=!0):(arrowNavigationProhibited=!1,qvSizeNotSupported.close())}function nextStep(){var step=$scope.steps[$scope.currentIndex];return step&&step.input.qvDialogContext.hasNextStep&&!step.input.qvDialogContext.nextDisabled()||$scope.currentIndex<$scope.steps.length-1?(step.input.qvDialogContext.onBeforeNext&&step.input.qvDialogContext.onBeforeNext(),step.input.qvDialogContext.next(),$scope.$digest(),!0):!1}function prevStep(){var step=$scope.steps[$scope.currentIndex];return step&&!step.input.qvDialogContext.backDisabled()&&$scope.currentIndex>0?(step.input.qvDialogContext.onBeforeBack&&step.input.qvDialogContext.onBeforeBack(),step.input.qvDialogContext.back(),$scope.$digest(),!0):!1}function pushStep(step,input){pushStepInstance(createStepFromStepComponent(step,input||{}))}function pushStepInstance(step){$scope.steps.splice($scope.currentIndex+1,$scope.steps.length-1-$scope.currentIndex),$scope.steps.push(step),step.mainStepVisible=!1,step.mainStepHidden=!1,$timeout(function(){$timeout(function(){$scope.currentIndex=$scope.steps.length-1,step.mainStepVisible=!0})})}function popStep(){0===$scope.currentIndex?close():$timeout(function(){$scope.steps[$scope.currentIndex].input.qvDialogContext.runBeforeBack&&$scope.steps[$scope.currentIndex].input.qvDialogContext.runBeforeBack($scope.steps[$scope.currentIndex-1]),$scope.currentIndex--})}function cleanup(isFinishing){for(var i=0;i<$scope.steps.length;i++)$scope.steps[i].input.qvDialogContext.cleanup&&$scope.steps[i].input.qvDialogContext.cleanup(isFinishing)}function close(isFinishing){if(!isClosedAlready){cleanup(isFinishing);var $body=$document.find("body");$scope.opening=!1,$body.addClass("closing"),qvWizardService.destroy(),yourScreenIsToSmallWarning(!1),ResponsiveState.ViewChanged.unbind(yourScreenIsToSmallWarning),$document.off(".navigateQDLWizard"),$timeout(function(){$body.removeClass("wizard-open closing"),$body=null,$scope.destroyComponent()},251),isClosedAlready=!0}}function clearFuture(){$scope.steps.splice($scope.currentIndex+1,$scope.steps.length-1-$scope.currentIndex)}function backToTheFuture(){$scope.currentIndex<$scope.steps.length&&$scope.currentIndex++}function createStepFromStepComponent(stepComponent,input){input.qvDialogContext=input.qvDialogContext||{},input.qvDialogContext.size=input.qvDialogContext.size||"L",input.qvDialogContext.title=input.qvDialogContext.title||"",input.qvDialogContext.customCss=input.qvDialogContext.customCss||{},input.qvDialogContext.cstmClass=input.qvDialogContext.cstmClass||{},input.qvDialogContext.pushStep=pushStep,input.qvDialogContext.popStep=popStep,input.qvDialogContext.close=close,input.qvDialogContext.clearFuture=clearFuture,input.qvDialogContext.backToTheFuture=backToTheFuture,input.qvDialogContext.nextDisabled=input.qvDialogContext.nextDisabled||function(){return!1},input.qvDialogContext.backDisabled=input.qvDialogContext.backDisabled||function(){return!1},input.qvDialogContext.finishDisabled=input.qvDialogContext.finishDisabled||function(){return!1},input.qvDialogContext.nextText=input.qvDialogContext.nextText||"",input.qvDialogContext.hasNextStep="undefined"!=typeof input.qvDialogContext.hasNextStep?input.qvDialogContext.hasNextStep:!0,input.qvDialogContext.onBeforeNext=input.qvDialogContext.onBeforeNext||null,input.qvDialogContext.next=input.qvDialogContext.next||backToTheFuture,input.qvDialogContext.onBeforeBack=input.qvDialogContext.onBeforeBack||null,input.qvDialogContext.back=input.qvDialogContext.back||popStep;var step={component:stepComponent,input:input};return step}function getHelpUrlRoot(baseUrl){for(var rootUrl=baseUrl,slashCount=0,slashIndex=0,startSearchIndex=0;3>slashCount&&(slashIndex=rootUrl.indexOf("/",startSearchIndex),++slashCount,-1!==slashIndex);)startSearchIndex=slashIndex+1;return-1!==slashIndex?rootUrl.substring(0,slashIndex+1):rootUrl}var arrowNavigationProhibited=!1,isClosedAlready=!1;$scope.opening=!0,$scope.initializing=!0,$scope.currentIndex=-1,$scope.wizardControl.init=function(input){$scope.initializing=!1,$scope.firstStep=input.firstStep,$scope.firstStepInput=input.firstStepInput,$scope.wizardTitle=input.wizardTitle,$scope.wizardTitle=$scope.wizardTitle?$scope.wizardTitle:"quickdataload.wizardTitle.AddData",pushStep($scope.firstStep,$scope.firstStepInput)},ResponsiveState.ViewChanged.bind(yourScreenIsToSmallWarning),$timeout(function(){$document.find("body").addClass("wizard-open")}),$document.on("keydown.navigateQDLWizard",function(e){if(!(e.ctrlKey||e.altKey||e.shiftKey||arrowNavigationProhibited||$delayedModal.isOpened||DOMUtil.isInput(document.activeElement)))switch(e.keyCode){case 27:close();break;case 37:qvWizardService.canStep()&&prevStep();break;case 39:qvWizardService.canStep()&&nextStep()}}),$scope.close=close,$scope.qvLinkUrl=getHelpUrlRoot(helpUrl.path)+"sense/client/#en-US&mod=connectors|",$scope.wizardControl.pushStep=pushStep,$scope.wizardControl.close=close,$scope.wizardControl.popStep=popStep,$scope.steps=[],$scope.toggleInfoView=function(step,close){var show=close?!1:!step.input.qvDialogContext.stepInfo.show;step.input.qvDialogContext.stepInfo.show=show,show&&step.input.qvDialogContext.stepInfo.onShow&&step.input.qvDialogContext.stepInfo.onShow(),!show&&step.input.qvDialogContext.stepInfo.onHide&&step.input.qvDialogContext.stepInfo.onHide()}}]};return component}),define("assets/hldm/services/upload-data-files-service",["jquery","qvangular","util","xsrfplugin","core.models/engine","translator"],function($,qvangular,Util,xsrfplugin,engine,translator){function isUploadFolderConnection(connectorInstance){return connectorInstance.id===InternalFileUploadConnectionID}function selectFile(){return lastFileSelectDeferred&&lastFileSelectDeferred.reject(null),lastFileSelectDeferred=qvangular.defer(),elFileInput||(elFileInput=$("<input type='file' style='display: none;'/>").appendTo($("body")).change(function(){lastFileSelectDeferred&&(lastFileSelectDeferred.resolve(elFileInput[0].files[0]),lastFileSelectDeferred=null,elFileInput.remove(),elFileInput=null)})),qvangular.getService("$timeout")(function(){elFileInput[0].click()},0),lastFileSelectDeferred.promise}function buildAppContentActionUrl(action,params){var url=(Util.basePath||"/")+"qrs/appcontent/"+Util.getParameterByName("app")+"/"+action+"?";return params=params||{},url+=Object.keys(params).map(function(key){return encodeURIComponent(key)+"="+encodeURIComponent(params[key])}).join("&")}function uploadFile(file){function uploadProgress(e){if(e.lengthComputable){var progress=e.loaded/Math.max(Math.max(e.total,e.loaded),1);d.notify(progress)}}function uploadFinish(){d.resolve(file)}function uploadError(){d.reject()}function uploadAbort(){d.resolve(null)}var d=qvangular.defer(),xhr=new XMLHttpRequest;if(xhr.upload){xhr.upload.addEventListener("progress",uploadProgress,!1),xhr.addEventListener("load",uploadFinish,!1),xhr.addEventListener("error",uploadError,!1),xhr.addEventListener("abort",uploadAbort,!1);var path=buildAppContentActionUrl("uploadfile",{externalpath:file.name,overwrite:!0,xrfkey:XrfKey});xhr.open("POST",path,!0),xhr.setRequestHeader("X-Qlik-XrfKey",XrfKey);var formData=new FormData;formData.append("file",file),xhr.send(formData)}return d.promise}function deleteFile(fileName){function deleteFinish(){d.resolve()}function deleteError(){d.reject()}var d=qvangular.defer(),xhr=new XMLHttpRequest;xhr.addEventListener("load",deleteFinish,!1),xhr.addEventListener("error",deleteError,!1);var path=buildAppContentActionUrl("deletecontent",{externalpath:fileName,xrfkey:XrfKey});return xhr.open("DELETE",path,!0),xhr.setRequestHeader("X-Qlik-XrfKey",XrfKey),xhr.send(),d.promise}function isFileUploadSupported(){return isUploadSupported}function formatSize(size,roundFunc){var scale=[translator.get("UploadedFilesFolder.FileSizeUnit.Bytes"),translator.get("UploadedFilesFolder.FileSizeUnit.KB"),translator.get("UploadedFilesFolder.FileSizeUnit.MB")],formattedSize=translator.get("UploadedFilesFolder.FileSize.NA");if(size>0){var log1024=Math.max(Math.floor(Math.log(size)/Math.log(1024)),scale.length-1);formattedSize=roundFunc(size/Math.pow(1024,log1024)*10)/10+scale[log1024]}return formattedSize}function getFormattedFileSize(fileSize){return formatSize(fileSize,Math.ceil)}function getFormattedAvailableSpace(availableSpace){return formatSize(availableSpace,Math.floor)}function getAppStoreLibrary(){return lastAppStoreLibraryPromise=engine.currentApp.getContentLibraries().then(function(libraries){return libraries.qList.qItems.filter(function(lib){return lib.qAppSpecific})[0]})}function getUserPermissions(){return(lastAppStoreLibraryPromise||getAppStoreLibrary()).then(function(lib){return lib.qMeta.privileges})}function canUserReadAppStore(){return getUserPermissions().then(function(permissions){return permissions&&permissions.indexOf("read")>=0})}function canUserModifyAppStore(){return getUserPermissions().then(function(permissions){return permissions&&permissions.indexOf("update")>=0})}function isFileUploadEnabled(){return null==configPromise&&(configPromise=engine.global.getConfiguration()),configPromise.then(function(result){var isDesktopMode=!1;return result.qConfig.qFeatures&&(isDesktopMode=result.qConfig.qFeatures.qIsDesktop),!isDesktopMode})}function isAllowedFileType(file){if(file&&file.name){var m=file.name.match(/[0-9a-z]+$/i);if(m)return blackListFileExtensions.indexOf(m[0].toLowerCase())<0}return!0}function adjustConnectionProperties(conn){isUploadFolderConnection(conn)&&(conn.displayName=translator.get("UploadedFilesFolder.DisplayName"),conn.privileges&&conn.privileges.indexOf("read")>-1?conn.privileges=["read"]:conn.privileges=[])}var InternalFileUploadConnectionID="47a1cfd8-f70e-4a98-a00d-00fca6c8e253",XrfKey=xsrfplugin.getRandomString(16),elFileInput=null,lastFileSelectDeferred=null,isUploadSupported=(new XMLHttpRequest).upload,lastAppStoreLibraryPromise=null,configPromise=null,blackListFileExtensions="zip,exe,com,bat,mdb".split(",");return{isFileUploadEnabled:isFileUploadEnabled,getAppStoreLibrary:getAppStoreLibrary,canUserReadAppStore:canUserReadAppStore,canUserModifyAppStore:canUserModifyAppStore,isFileUploadSupported:isFileUploadSupported,selectFile:selectFile,
uploadFile:uploadFile,deleteFile:deleteFile,getFormattedFileSize:getFormattedFileSize,getFormattedAvailableSpace:getFormattedAvailableSpace,isUploadFolderConnection:isUploadFolderConnection,adjustConnectionProperties:adjustConnectionProperties,isAllowedFileType:isAllowedFileType}}),define("text!assets/hldm/add-data-wizard/select-kind-step-two/select-kind-step-two.ng.html",[],function(){return'<div class="qv-hdlm-select-kind-step-two" tabindex="-1" tid="hdlm-kind-select">\r\n	<div class="categories" qva-delegated-activate=".category#categoryClicked($event)">\r\n		<div class="category" ng-class="{\'active\': category.active}" ng-repeat="category in views.orderedCategories" ng-show="category.show" tid="qdl.{{category.translationKey}}">\r\n			<div class="icon" ng-if="category.dataIcon" ng-class="category.dataIcon"></div>\r\n			<img class="icon" ng-if="category.iconUrl" ng-src={{category.iconUrl}}>\r\n			<div class="text">{{category.translationKey|translate}}</div>\r\n		</div>\r\n	</div>\r\n	<div class="category-view" ng-include="activeView"></div>\r\n</div>'}),define("text!assets/hldm/add-data-wizard/select-kind-step-two/categories/connectors-view.ng.html",[],function(){return'<div class="connectors" qva-delegated-activate=".list-item#connectorClicked($event)">\r\n	<div ng-repeat="connector in views.connectors track by $index" class="list-item" ng-class="{ active: connector === views.categories.connectors.activeItem }" tid="qdl.connector.{{connector.entrypoint.name}}">\r\n		<div class="name" title="{{connector.entrypoint.name}}">{{connector.entrypoint.name}}</div>\r\n	</div>\r\n</div>\r\n'}),define("text!assets/hldm/add-data-wizard/select-kind-step-two/categories/data-market-view.ng.html",[],function(){return'<div class="data-market-view" qva-delegated-activate=".data-market-item-box#connectorClicked($event)">\r\n	<div ng-repeat="connector in views.datamarket track by $index" class="data-market-wrapper">\r\n		<div class="data-market-item-box" ng-class="{ active: connector === views.categories.datamarket.activeItem }">\r\n			<div class="icon" ng-class="connector.entrypoint.id.toLowerCase()"></div>\r\n			<div class="text">\r\n				<div class="title">{{connector.entrypoint.name}}</div>\r\n				<div class="descr">{{connector.entrypoint.description}}</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n  </div>\r\n\r\n<!-- translation strings for data market connector, to avoid that planemo fails on these strings\r\n datamarket.conndialog.getdataset\r\n datamarket.conndialog.source\r\n datamarket.conndialog.measures\r\n datamarket.notsupported\r\n datamarket.onlyqdlnotdle\r\n datamarket.selectdialog.selectdataload\r\n datamarket.selectdialog.scriptconfirmation\r\n datamarket.selectdialog.regenerate\r\n datamarket.selectdialog.mustselect\r\n datamarket.selectdialog.mustselectfrom\r\n datamarket.selectdialog.incompleteselection\r\n datamarket.selectdialog.measurelabel\r\n datamarket.selectdialog.createbtn\r\n datamarket.conndialog.premiumlabel\r\n datamarket.conndialog.lastupdated\r\n datamarket.conndialog.provider\r\n datamarket.conndialog.units\r\n datamarket.conndialog.metricsvalues\r\n datamarket.conndialog.timegranularity\r\n datamarket.conndialog.year\r\n datamarket.conndialog.quarter\r\n datamarket.conndialog.month\r\n datamarket.conndialog.week\r\n datamarket.conndialog.day\r\n datamarket.conndialog.date_and_time\r\n datamarket.conndialog.license\r\n datamarket.conndialog.license_summary\r\n datamarket.conndialog.termsnotaccepted\r\n datamarket.selectdialog.nodataforselection\r\n datamarket.selectdialog.incompleteselection\r\n  -->\r\n'}),define("text!assets/hldm/add-data-wizard/select-kind-step-two/categories/existing-connections-view.ng.html",[],function(){return'<div class="connectors" qva-delegated-activate=".list-item#connectionClicked($event)">\r\n	<div ng-repeat="connection in views.existingConnections track by $index" class="list-item" ng-class="{ active: connection === views.categories.connections.activeItem }" tid="qdl.connection.{{connection.connectorInstance.name}}">\r\n		<span class="icon" ng-class="(\'icon-\' + connection.connectorInstance.typeName)"/>\r\n\r\n		<div class="name" title="{{connection.connectorInstance.name}}">{{connection.connectorInstance.name}}</div>\r\n	</div>\r\n</div>'}),define("text!assets/hldm/add-data-wizard/select-kind-step-two/categories/attached-data-view.ng.html",[],function(){return'<qv-uploaded-data-files-view class="attached-data-view"\r\n		upload-folder-connection="uploadFolderConnection.connectorInstance"\r\n		on-file-selected="onUploadedFileSelected(name)"\r\n		selected-file-name="selectedFileName"\r\n		></qv-uploaded-data-files-view>\r\n\r\n'}),define("text!assets/hldm/add-data-wizard/align-tables-step/align-tables-step.ng.html",[],function(){return'<div class="qv-hldm-align-tables-step" tabindex="-1">\r\n	\r\n	<div ng-show="status" class="qv-hldm-recommendations-status">{{status}}</div><!-- very temporary way of showing what is going on -->\r\n    <div ng-show="status" class="qv-hldm-recommendations-errormessage">{{errorMessage}}</div>\r\n    <div ng-show="status" class="qv-hldm-recommendations-errormessage" ng-repeat="errorText in errorData">{{errorText}} </div>\r\n	\r\n	<div ng-show="!isProfiling && !!recommendations.length" class="qv-hldm-recommendations">\r\n		\r\n		<div class="qv-hldm-recommendation">\r\n			<div class="qv-hldm-profile">\r\n				<div class="qv-hldm-table-pair">					\r\n					<div class="recommendations-nav">\r\n						<div class="qui-buttongroup">\r\n							<qui-button outline qva-activate="onShowTablesPopOver($event)" class="recommendations-dropdown" title="{{currentRecommendation.name}}">							\r\n								<div class="current-recommendation-selected" data-icon="{{currentRecommendation.isGood() ? \'tick\' : \'warning-triangle\'}}">{{currentRecommendation.name}}</div>\r\n								<div class="icon-triangle-bottom"></div>\r\n							</qui-button>\r\n							<qui-button outline ng-disabled="!nav.hasPrev()" qva-activate="nav.prev()" data-icon="arrow-up" q-title-translation="DataPrep.PreviousTablePair"></qui-button>\r\n							<qui-button outline ng-disabled="!nav.hasNext()" qva-activate="nav.next()" data-icon="arrow-down" q-title-translation="DataPrep.NextTablePair"></qui-button>\r\n						</div>\r\n						<h2 class="current-nav-page">{{selectedPair}}</h2>\r\n					</div>\r\n					<div class="warnings-right">\r\n						<span class="warnings-count" ng-show="warningsCount > 0" data-icon="{{warningsCount === 0? \'tick\' : \'warning-triangle\'}}">\r\n							{{warningsCountMessage}}\r\n						</span>\r\n						<span class="warnings-count" ng-show="warningsCount === 0">\r\n							{{warningsCountMessage}}\r\n						</span>\r\n					</div>\r\n				</div>\r\n				<div class="qv-hldm-associations" qv-dynamic-content-pager >\r\n					<ul>\r\n						<div class="qv-associations-title-container">\r\n							<div class="qv-associations-title" q-translation="DataPrep.Recommendations.current"></div>\r\n						</div>					\r\n						<li class="qv-associationChicklet" ng-repeat="assoc in defaultAssociations"\r\n							ng-class="{\'qv-hldm-focused\': assoc===currentFieldAssociationFocused, \'selected\': assoc===currentFieldAssociationSelected, \'disabled\': assoc!==currentFieldAssociation && currentRecommendation.resolved}" \r\n							qva-activate="onFieldAssociationClick(assoc);" ng-include src="assoc.templateSrc"> \r\n						</li>\r\n						<li class="qv-associations-divider">&nbsp;</li>\r\n						<div class="qv-associations-title-container">\r\n							<div class="qv-associations-title" q-translation="DataPrep.Recommendations.recommendations"></div>\r\n						</div>						\r\n						<li class="qv-associationChicklet" ng-repeat="assoc in recommendedAssociations"\r\n							ng-class="{\'qv-hldm-focused\': assoc===currentFieldAssociationFocused, \'selected\': assoc===currentFieldAssociationSelected, \'disabled\': assoc!==currentFieldAssociation && currentRecommendation.resolved}"\r\n							qva-activate="onFieldAssociationClick(assoc);" ng-include src="assoc.templateSrc">\r\n						</li>\r\n\r\n					</ul>\r\n					<a class="qv-pager-nav inverted qv-pager-previous" qva-activate="prevPage()" q-title-translation="Tooltip.Previous"><i class="icon-hub-previous"></i></a>\r\n					<a class="qv-pager-nav inverted qv-pager-next" qva-activate="nextPage()" q-title-translation="Tooltip.Next"><i class="icon-hub-next"></i></a>\r\n				</div>\r\n				<div class="qv-hldm-association-action-container">\r\n					<div class="qv-hldm-association-msg ta-center" ng-class="{\'active\': currentFieldAssociationFocused != currentFieldAssociation}">\r\n					\r\n						<p>{{associationMessage.info}}</p>\r\n						<p ng-show="associationMessage.action">{{associationMessage.action}}</p>\r\n					</div>\r\n\r\n					<div class="qv-hldm-actions" ng-switch="currentFieldAssociation.type" ng-class="{\'active\': currentFieldAssociationFocused != currentFieldAssociation}" ng-show="currentFieldAssociation.type === -2 || currentFieldAssociation.type === 2 || currentFieldAssociation.type === 3">\r\n						<div ng-switch-when="2" class="qv-hldm-actions-recommend">\r\n							<div class="resolve-actions-container">\r\n								<div class="btn-container ta-right">\r\n									<qui-button\r\n											ng-class="{\'selected\': currentFieldAssociation.status.resolution === associationMessage.leftName}"\r\n											ng-disabled="currentRecommendation.resolved"\r\n											qva-activate="useFieldName(associationMessage.leftName, true)">{{associationMessage.leftName}}</qui-button>\r\n								</div>\r\n								<div class="input-container">\r\n									<input type="text" class="qui-input"\r\n										   ng-class="{\'qui-invalid\':badFieldName}"\r\n										   q-placeholder="DataPrep.Recommendations.CustomField"\r\n										   ng-disabled="currentRecommendation.resolved"										   \r\n										   ng-model="currentFieldAssociation.customName" ng-keypress="handleInputKeyPress( $event )"><qui-button class="qv-htdm-association-custom-name-button" data-icon="enter-submit"\r\n											ng-disabled="currentRecommendation.resolved || !currentFieldAssociation.customName "\r\n											qva-activate="useFieldName(currentFieldAssociation.customName)" q-title-translation="DataPrep.Recommendations.Enter">\r\n									</qui-button>\r\n\r\n									<div ng-show="badFieldName" class="qv-hldm-error-message" q-translation="DataPrep.Recommendations.FieldNameInUse.Info"></div>\r\n									<div ng-show="badFieldName" class="qv-hldm-error-message" q-translation="DataPrep.Recommendations.FieldNameInUse.Action"></div>\r\n								</div>\r\n								<div class="btn-container ta-left">\r\n									<qui-button \r\n										ng-class="{\'selected\': currentFieldAssociation.status.resolution === associationMessage.rightName}"\r\n										ng-disabled="currentRecommendation.resolved"\r\n										qva-activate="useFieldName(associationMessage.rightName, true)">{{associationMessage.rightName}}</qui-button>\r\n								</div>\r\n							</div>\r\n						</div>\r\n						<div ng-switch-when="-2" class="qv-hldm-actions-confirm ta-center">\r\n							<qui-button qva-activate="breakAssociation(currentRecommendation,currentFieldAssociation)"\r\n										ng-disabled="currentRecommendation.resolved"\r\n										q-translation="DataPrep.Recommendations.BreakAssociationAction">\r\n							</qui-button>\r\n						</div>\r\n						<div ng-switch-when="3" class="qv-hldm-actions-confirm ta-center">\r\n							<qui-button qva-activate="keepAssociation(currentRecommendation,currentFieldAssociation)"\r\n										ng-disabled="currentRecommendation.resolved"\r\n										q-translation="DataPrep.Recommendations.KeepAssociationAction">\r\n							</qui-button>\r\n						</div>\r\n						<div class="actions-container">\r\n							<qui-button	class="q-rec-undo-btn" ng-disabled="!currentFieldAssociation.status.resolved"\r\n										ng-show="currentFieldAssociation.type === -2 || currentFieldAssociation.type === 2 || currentFieldAssociation.type === 3"\r\n										qva-activate="onRevertFieldsRecommendation()" q-title-translation="DataPrep.Recommendations.UndoRecommendation">\r\n								<i class="icon-toolbar-back"></i>\r\n								{{"DataPrep.Recommendations.UndoRecommendation" | translate}}\r\n							</qui-button>\r\n						</div>\r\n					</div>\r\n				</div>\r\n				<div class="qv-hldm-table-titles">\r\n					<div>{{leftPreviewTable.name}}</div>\r\n					<div>{{rightPreviewTable.name}}</div>\r\n				</div>\r\n				\r\n			</div>\r\n			\r\n			<div class="qv-hldm-preview" ng-class="{\r\n					\'qv-hldm-bad\': currentFieldAssociation.type === 0 || currentFieldAssociation.type === -3,\r\n					\'qv-hldm-good\': currentFieldAssociation.type === 2,\r\n					\'qv-hldm-neutral\': currentFieldAssociation.type === -2}">\r\n				<div class="primary-table-container table-container">\r\n					<div class="flex-scroll-workaround">\r\n						<qv-hldm-table-preview table="leftPreviewTable"\r\n											   association="currentFieldAssociation.left"\r\n											   affected="currentFieldAssociation.affected.left"></qv-hldm-table-preview>\r\n					</div>\r\n				</div>\r\n				\r\n				<div class="secondary-table-container table-container">\r\n					<div class="flex-scroll-workaround">\r\n						<qv-hldm-table-preview table="rightPreviewTable"\r\n											   association="currentFieldAssociation.right"\r\n											   affected="currentFieldAssociation.affected.right"></qv-hldm-table-preview>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("assets/hldm/models/load-model-to-dataprep-model",["angular","ng!$q","assets/hldm/templating/template-runner","assets/hldm/models/box-types-model","assets/scripteditor/models/qscript-model"],function(angular,$q,templateRunner,boxTypesModel,ScriptModel){function compileLoadModelToDataPrepModel(global,app,loadModel,dataconnectorsModel){function getScriptModel(){return app.getScript().then(function(currentScriptResult){return ScriptModel.createQScriptModelFromRawText(global,app,currentScriptResult.qScript,[],[])})}function generatePrefixAndSuffix(){return getScriptModel().then(function(scriptModel){var result={prefix:[],suffix:[]},current=result.prefix;return scriptModel.tabs.forEach(function(tab){tab.autogenerated?current=result.suffix:current.push({type:"verbatimStatement",content:"///$tab "+tab.name+"\n"+tab.content})}),result})}function getUsedSources(){var sources=loadModel.tableModels.map(function(tableModel){var result=angular.extend({},tableModel.data,{dataconnectorName:tableModel.data.dataconnectorName,connectionInfo:loadModel.getConnectionMetaDataModel(tableModel.data.dataconnectorName)});return result.fields=result.fields.filter(function(field){return field.selected}),result}).filter(function(table){return table&&table.connectionInfo&&table.fields.length>0});return sources}function renderSourceScript(sourceData){var serversideProxy,connection=dataconnectorsModel.getConnectionFromModel(sourceData.dataconnectorName);return connection&&connection.connectorMain&&connection.connectorMain.generateSelectScript?(serversideProxy=dataconnectorsModel.getConnectionServersideProxy(sourceData.connectionInfo.type,sourceData.connectionInfo),connection.connectorMain.generateSelectScript(serversideProxy,sourceData)):connection&&connection.connectorMain&&connection.connectorMain.getScriptTemplate?(serversideProxy=dataconnectorsModel.getConnectionServersideProxy(sourceData.connectionInfo.type,sourceData.connectionInfo),$q.when(connection.connectorMain.getScriptTemplate(serversideProxy,sourceData)).then(function(template){return templateRunner.render(template)})):$q.when(templateRunner.render(boxTypesModel.getBoxType(sourceData.boxType).template,sourceData))}function cleanNameForId(name){return name.replace(/[ \.]/g,"")}function buildInputSource(context,sourceData){for(var baseName=sourceData.tableAlias||sourceData.tableName,uniqueName=baseName,counter=1;context.journal[uniqueName];)uniqueName=baseName+"-"+counter++;return context.journal[uniqueName]=!0,renderSourceScript(sourceData).then(function(script){var sourceId=DSMTypes.DataSourceDescriptor.prefix+"."+cleanNameForId(uniqueName),source={id:sourceId,type:DSMTypes.DataSourceDescriptor.name,name:uniqueName,provider:sourceData.dataconnectorName,options:{key:sourceData.key,databaseName:sourceData.databaseName,formatSpec:sourceData.formatSpec,ownerName:sourceData.ownerName},loadSelectStatement:script,fields:sourceData.fields.map(function(fieldData){var field={type:DSMTypes.SourceField.name,name:fieldData.alias||fieldData.name,sourceName:fieldData.name};return field.id=sourceId+"."+cleanNameForId(field.name),field})};return source})}function generateInputSources(context){return $q.all(getUsedSources().map(function(sourceData){return buildInputSource(context,sourceData)}))}function generateSimpleQueries(context,sources){return sources.map(function(source){var queryId=DSMTypes.Query.prefix+"."+cleanNameForId(source.name),query={id:queryId,type:DSMTypes.Query.name,name:source.name,tableRef:source.id,fields:source.fields.map(function(sourceField){var field={id:queryId+"."+cleanNameForId(sourceField.name),type:DSMTypes.QueryField.name,name:sourceField.name,fieldRef:sourceField.id};return field})};return query})}var DSMTypes={DataSourceDescriptor:{name:"DataSourceDescriptor",prefix:"dsd"},SourceField:{name:"SourceField"},Query:{name:"Query",prefix:"query"},QueryField:{name:"QueryField"}},context={journal:{}};return $q.all([generatePrefixAndSuffix(context),generateInputSources(context)]).then(function(resolved){var dataPrepModel={schemaVersion:1,prefix:resolved[0].prefix,suffix:resolved[0].suffix,sources:resolved[1]};return dataPrepModel.queries=generateSimpleQueries(context,dataPrepModel.sources),dataPrepModel})}var exports={compileLoadModelToDataPrepModel:compileLoadModelToDataPrepModel};return exports}),define("assets/hldm/services/data-prep-service",["core.utils/class","core.models/engine","client.models/rpc-session","core.utils/deferred","util","translator"],function(Class,engine,RPCSession,Deferred,Util,translator){"use strict";var _cache={},DataPrepService=Class.extend("DataPrepService",{init:function(appName,options){function connectionLostError(){self.waitForOpen.reject({error:translator.get("DataPrep.Recommendations.ConnectionLostToDPS")})}function connectionOpen(){self.waitForOpen.resolve(self)}function onError(error){error&&error.error&&-32e3===error.error.code&&(error.error.isHandled=!0)}appName=appName||Util.getParameterByName("app"),options=options||DataPrepService.connectOptions,this.session=RPCSession.get(appName,options);var self=this;this.waitForOpen=new Deferred,this.session.Close.bind(connectionLostError),this.session.Open.bind(connectionOpen),this.session.Error.bind(onError);try{this.session.open()}catch(error){this.waitForOpen.reject({error:error})}},rpc:function(method,params){var data={method:method,params:params||[]};return this.session.rpc(data)},getModel:function(){return this.rpc("getModel")},setModel:function(model){return this.rpc("setModel",[model])},getRecommendations:function(dataPrepModel,algorithm,threshold,minCR,analyzeAllTables){return this.rpc("getRecommendations",[dataPrepModel,algorithm||"",threshold||0,minCR||0,analyzeAllTables])},getDataPreview:function(inParam){return this.rpc("getDataPreview",[inParam])}});return DataPrepService.getConnectOptions=function(){if(DataPrepService.connectOptions){var def=new Deferred;return def.resolve(DataPrepService.connectOptions),def.promise}return engine.global.getConfiguration().then(function(result){var isDesktopMode=!1;result.qConfig.qFeatures&&(isDesktopMode=result.qConfig.qFeatures.qIsDesktop);var dpConfig,port="4949";if(isDesktopMode&&result.qConfig.qServices.forEach(function(serviceConfig){"DataPrep"===serviceConfig.qName&&(dpConfig=serviceConfig)}),dpConfig){var urlPattern=/((\w+):\/\/)?([^:\/\s]+):(\d+)/,match=dpConfig.qUrl.match(urlPattern);match&&match.length>4&&(port=match[4])}return DataPrepService.connectOptions={host:Util.hostname,isSecure:Util.isSecure,prefix:Util.basePath,port:isDesktopMode?port:void 0,subpath:isDesktopMode?void 0:"dataprepservice"},DataPrepService.connectOptions})},DataPrepService.get=function(appName,options){return DataPrepService.getConnectOptions(options).then(function(connectOptions){appName=appName||Util.getParameterByName("app");var dp=_cache[appName.toLowerCase()]=_cache[appName.toLowerCase()]||new DataPrepService(appName,connectOptions);return dp.waitForOpen.promise})},DataPrepService}),define("text!assets/hldm/add-data-wizard/align-tables-step/table-pair-popover.ng.html",[],function(){return'<immidiate-contextual width="300" align-to="alignTo" position="\'bottom\'" on-close-view="onClose()" class="qv-associations-page-context">\r\n	<ul class="qui-icontextlist qv-associations-page">\r\n		<li ng-repeat="item in items" qva-activate="onItemClicked($event,item);" data-icon="{{item.isGood() ? \'tick\' : \'warning-triangle\'}}">\r\n			<span class="qui-textlist-text" ng-class="{\'selected\': $parent.selected==$index}" title="{{item.name}}">{{item.name}}</span>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>'}),define("assets/hldm/add-data-wizard/align-tables-step/table-pair-popover",["text!./table-pair-popover.ng.html"],function(tablePairsTemplate){return{template:tablePairsTemplate,controller:["$scope",function(){}],scope:{items:"=",alignTo:"=",onItemClicked:"=",onClose:"=",selected:"="}}}),define("assets/hldm/add-data-wizard/align-tables-step/recommendations-handler",["translator"],function(translator){"use strict";function getAssociationId(af){var ends=[af.fieldL.tableName+"."+af.fieldL.fieldName,af.fieldR.tableName+"."+af.fieldR.fieldName];return ends.sort(),ends.join(";")}function getAssociationGroupId(leftTable,rightTable){var ends=[leftTable,rightTable];return ends.sort(),ends.join(";")}function Association(af,tableModelLeft,tableModelRight){af&&(this.id=getAssociationId(af),this.groupId=getAssociationGroupId(af.fieldL.tableName,af.fieldR.tableName),this.score=af.associationScore,this.scoreTxt=Math.round(100*af.associationScore)+"%",this.type=af.associationStatus,this.show=!0,this.left={table:af.fieldL.tableName,field:af.fieldL.fieldName,originalFieldName:tableModelLeft.getOriginalFieldNameFromAlias(af.fieldL.fieldName),type:af.associationStatus},this.right={table:af.fieldR.tableName,field:af.fieldR.fieldName,originalFieldName:tableModelRight.getOriginalFieldNameFromAlias(af.fieldR.fieldName),type:af.associationStatus},this.affected={left:null,right:null},this.status={resolved:!1,resolution:void 0},this.templateSrc=this.type===ASSOCIATION.BAD?"association-bad.ng.html":"association-recommendation.ng.html")}function SyntheticAssociation(assocList){var fields=assocList.map(function(a){return a.left.field}),first=assocList[0];this.groupId=getAssociationGroupId(first.left.table,first.right.table),this.id=this.groupId+":key:"+fields.join(","),this.score=assocList.reduce(function(score,assoc){return Math.min(assoc.score,score)},1),this.scoreTxt=Math.round(100*this.score)+"%",this.type=ASSOCIATION.GOODGROUP,assocList.some(function(assoc){return assoc.type!==ASSOCIATION.GOOD&&assoc.type!==ASSOCIATION.KEEP})&&(this.type=ASSOCIATION.BADGROUP),this.text=fields.slice(0,3).join(", "),fields.length>3&&(this.text+=",  "+translator.get("DataPrep.Recommendations.NMore",fields.length-3)),this.show=!0,this.left={table:first.left.table,fields:assocList.map(function(assoc){return assoc.left})},this.right={table:first.right.table,fields:assocList.map(function(assoc){return assoc.right})},this.status={resolved:!1,resolution:void 0},this.templateSrc=this.type===ASSOCIATION.BADGROUP?"association-group-bad.ng.html":"association-group-good.ng.html"}function BreakAssociationRecommendation(assocList){var fields=assocList.map(function(a){return a.left.field}),first=assocList[0];this.groupId=getAssociationGroupId(first.left.table,first.right.table),this.id=this.groupId+":break:"+fields.join(","),this.score=0,this.scoreTxt="",this.type=ASSOCIATION.BREAK,this.text=translator.get("DataPrep.Recommendations.BreakAssociation"),this.show=!0,this.left={table:first.left.table,fields:assocList.map(function(assoc){return assoc.left})},this.right={table:first.right.table,fields:assocList.map(function(assoc){return assoc.right})},this.status={resolved:!1,resolution:void 0},this.templateSrc="association-message.ng.html"}function NoDefaultAssociation(leftTable,rightTable){this.groupId=getAssociationGroupId(leftTable,rightTable),this.id=this.groupId+":none",this.score=0,this.type=ASSOCIATION.NONE,this.text=translator.get("DatePrep.Recommendations.NoAssociation"),this.show=!0,this.left={table:leftTable},this.right={table:rightTable},this.status={resolved:!1,resolution:void 0},this.templateSrc="association-message.ng.html"}function AssociationGroup(assoc){assoc&&(this.id=assoc.groupId,this.leftTable=assoc.left.table,this.rightTable=assoc.right.table,this.associations=[],this.name=assoc.left.table+"   -   "+assoc.right.table,this.resolved=!1,this.doNotShowWarning=!1)}function createRecommendationsHandler(loadModel){function clear(){recommendations.length=0,associations.length=0,resolvedPairs={}}function getTableModel(name){return loadModel.getTableModelWithName(name)}function setRecommendations(rec){clear();var associationsById={};rec.associatedFields.forEach(function(af){var id=getAssociationId(af);if(!(id in associationsById)){var ltm=getTableModel(af.fieldL.tableName),rtm=getTableModel(af.fieldR.tableName);if(ltm&&rtm){var assoc=new Association(af,ltm,rtm);associationsById[id]=assoc,associations.push(assoc)}}})}function groupAssociationsByTablePairs(){var groupsById={};recommendations.length=0,associations.forEach(function(a){var group=groupsById[a.groupId];group||(groupsById[a.groupId]=group=new AssociationGroup(a),group.doNotShowWarning=!!resolvedPairs[group.id],recommendations.push(group))}),associations.filter(function(a){return a.sameFieldNames()||a.type!==ASSOCIATION.BAD}).forEach(function(a){var assoc=a.cloneForEditing();assoc.sameFieldNames()&&assoc.type===ASSOCIATION.RECOMMENDATION&&(assoc.type=ASSOCIATION.GOOD);var group=groupsById[assoc.groupId];group.associations.push(assoc)}),recommendations.forEach(function(rec){rec.associations.sort(function(a,b){return b.score-a.score});var defaultList=rec.associations.filter(function(a){return a.sameFieldNames()});defaultList.length>1&&(defaultList.forEach(function(a){a.type===ASSOCIATION.GOOD?(a.type=ASSOCIATION.KEEP,a.show=!0):a.show=!1}),rec.associations.unshift(new SyntheticAssociation(defaultList))),rec.associations.filter(function(a){return a.type===ASSOCIATION.GOOD&&!a.isDefault()}).forEach(function(a){a.type=ASSOCIATION.RECOMMENDATION}),0===defaultList.length?rec.associations.unshift(new NoDefaultAssociation(rec.leftTable,rec.rightTable)):rec.associations.push(new BreakAssociationRecommendation(defaultList));var defaultLeft=defaultList.map(function(a){return a.left}),defaultRight=defaultList.map(function(a){return a.right});rec.associations.filter(function(a){return a.type===ASSOCIATION.RECOMMENDATION||a.type===ASSOCIATION.KEEP}).forEach(function(a){a.affected.left=defaultLeft,a.affected.right=defaultRight})})}function getNewAssociationId(fieldName,table1,table2){var tables=[table1,table2];return tables.sort(),fieldName+":"+tables.join(",")}function getNewAssociations(){return associations.reduce(function(map,assoc){if(assoc.sameFieldNames()){var key=getNewAssociationId(assoc.left.field,assoc.left.table,assoc.right.table);map[key]=assoc}return map},{})}function getAllFieldsByName(name){return loadModel.tableModels.map(function(table){var field=table.data.fields.filter(function(f){return f.alias===name})[0];return field?{table:table,field:field}:null}).filter(function(field){return!!field})}function qualifyTableField(table,fieldName,exceptTables){var changes=[],newAssociations=getNewAssociations(),lockedTables=exceptTables.reduce(function(map,tableName){return map[tableName]=!0,map},{});getAllFieldsByName(fieldName).forEach(function(tableField){var tableName=tableField.table.getTableAlias();if(!lockedTables[tableName]){var assoc=newAssociations[getNewAssociationId(fieldName,table.getTableAlias(),tableName)];assoc&&assoc.type===ASSOCIATION.BAD&&(lockedTables[tableName]=!0)}});var qualifiedName=table.getTableAlias()+"."+fieldName;return getAllFieldsByName(fieldName).forEach(function(tableField){var tableName=tableField.table.getTableAlias();if(!lockedTables[tableName]){var skip=table!==tableField.table&&Object.keys(lockedTables).some(function(skipName){return!newAssociations[getNewAssociationId(fieldName,tableName,skipName)]});skip||changes.push(renameField(getTableModel(tableName),fieldName,qualifiedName))}}),changes}function renameTableField(table,fieldName,newName){var changes=[],newAssociations=getNewAssociations(),lockedTables={};return getAllFieldsByName(fieldName).forEach(function(tableField){var tableName=tableField.table.getTableAlias();if(!lockedTables[tableName]){var assoc=newAssociations[getNewAssociationId(fieldName,table.getTableAlias(),tableName)];assoc&&assoc.type===ASSOCIATION.BAD&&(lockedTables[tableName]=!0)}}),getAllFieldsByName(fieldName).forEach(function(tableField){var tableName=tableField.table.getTableAlias();if(!lockedTables[tableName]){var skip=Object.keys(lockedTables).some(function(skipName){return!newAssociations[getNewAssociationId(fieldName,tableName,skipName)]});skip||changes.push(renameField(getTableModel(tableName),fieldName,newName))}}),changes}function renameField(table,fieldName,newName){var originalName=table.getOriginalFieldNameFromAlias(fieldName);table.changeFieldAlias(fieldName,newName);var change={table:table.getTableAlias(),name:originalName,from:fieldName,to:newName};return associations.forEach(function(assoc){assoc.left.table===table.getTableAlias()&&assoc.left.originalFieldName===originalName&&(assoc.left.field=newName),assoc.right.table===table.getTableAlias()&&assoc.right.originalFieldName===originalName&&(assoc.right.field=newName)}),change}function resolve(pair,assoc){if(!pair.resolved){pair.resolving=!0;var tLeft=getTableModel(pair.leftTable),tRight=getTableModel(pair.rightTable),changed=[];assoc.type===ASSOCIATION.RECOMMENDATION?(pair.associations.filter(function(a){return a!==assoc&&a instanceof Association&&a.sameFieldNames()}).forEach(function(a){a.left.field!==assoc.left.field&&(changed=changed.concat(qualifyTableField(tLeft,a.left.field,[tRight.getTableAlias()]))),a.right.field!==assoc.right.field&&(changed=changed.concat(qualifyTableField(tRight,a.right.field,[tLeft.getTableAlias()])))}),assoc.status.resolution!==assoc.left.field&&(changed=changed.concat(renameTableField(tLeft,assoc.left.field,assoc.status.resolution))),assoc.status.resolution!==assoc.right.field&&(changed=changed.concat(renameTableField(tRight,assoc.right.field,assoc.status.resolution)))):(assoc.type===ASSOCIATION.BREAK||assoc.type===ASSOCIATION.KEEP)&&pair.associations.filter(function(a){return a!==assoc&&a instanceof Association&&a.sameFieldNames()}).forEach(function(a){changed=changed.concat(qualifyTableField(tLeft,a.left.field,[tRight.getTableAlias()]),qualifyTableField(tRight,a.right.field,[tLeft.getTableAlias()]))}),pair.appliedChanges=changed,pair.resolved=!0,pair.resolving=!1,assoc.status.resolved=!0,resolvedPairs[pair.id]=!0,groupAssociationsByTablePairs()}}function reset(pair){if(pair.resolved&&pair.appliedChanges){var changes=pair.appliedChanges;changes.reverse(),changes.forEach(function(change){renameField(getTableModel(change.table),change.to,change.from)}),pair.associations.forEach(function(assoc){assoc.status&&(assoc.status.resolved=!1,assoc.status.resolution=void 0,assoc.customName=void 0)}),pair.resolved=!1,pair.appliedChanges=null,resolvedPairs[pair.id]=!1,groupAssociationsByTablePairs()}}var recommendations=[],associations=[],resolvedPairs={};return{resolve:resolve,reset:reset,setRecommendations:setRecommendations,groupAssociationsByTablePairs:groupAssociationsByTablePairs,clear:clear,recommendations:recommendations}}var ASSOCIATION={BAD:0,GOOD:1,RECOMMENDATION:2,
KEEP:3,NONE:-1,BREAK:-2,BADGROUP:-3,GOODGROUP:-4};return Association.prototype.sameFieldNames=function(){return this.left.field===this.right.field},Association.prototype.isDefault=function(){return this.sameFieldNames()&&this.type!==ASSOCIATION.KEEP},Association.prototype.cloneForEditing=function(){var assoc=new Association;return assoc.id=this.id,assoc.groupId=this.groupId,assoc.type=this.type,assoc.score=this.score,assoc.scoreTxt=this.scoreTxt,assoc.show=this.show,assoc.left=this.left,assoc.right=this.right,assoc.status={resolved:!1,resolution:void 0},assoc.affected={left:this.affected.left,right:this.affected.right},assoc.templateSrc=this.templateSrc,assoc},SyntheticAssociation.prototype.isDefault=function(){return!0},BreakAssociationRecommendation.prototype.isDefault=function(){return!1},NoDefaultAssociation.prototype.isDefault=function(){return!0},AssociationGroup.prototype.add=function(assoc){this.associations.push(assoc)},AssociationGroup.prototype.hasSyntheticKey=function(){return this.associations.some(function(assoc){return assoc instanceof SyntheticAssociation})},AssociationGroup.prototype.isGood=function(){return this.doNotShowWarning||this.resolved||!this.hasRecommendations()||this.hasGoodDefault()},AssociationGroup.prototype.hasGoodDefault=function(){return this.associations.some(function(assoc){return assoc.isDefault()&&(assoc.type===ASSOCIATION.GOOD||assoc.type===ASSOCIATION.GOODGROUP)})},AssociationGroup.prototype.hasRecommendations=function(){return this.associations.some(function(a){return a.type===ASSOCIATION.BREAK||a.type===ASSOCIATION.RECOMMENDATION||a.type===ASSOCIATION.KEEP})},AssociationGroup.prototype.cloneForEditing=function(){var clone=new AssociationGroup;return clone.id=this.id,clone.leftTable=this.leftTable,clone.rightTable=this.rightTable,clone.associations=this.associations,clone.name=this.name,clone.resolved=this.resolved,clone.doNotShowWarning=this.doNotShowWarning,clone},{create:createRecommendationsHandler,ASSOCIATION:ASSOCIATION}}),define("text!assets/hldm/add-data-wizard/align-tables-step/recommendations-info.ng.html",[],function(){return'<div class="qv-info-recommendations">\r\n	<div>\r\n		<p q-translation="DataPrep.Recommendations.Info"></p>\r\n		<p q-translation="DataPrep.Recommendations.Action"></p>\r\n	</div>\r\n</div>'}),define("text!assets/hldm/add-data-wizard/align-tables-step/association-types/recommendation.ng.html",[],function(){return'<div class="qv-associationChicklet-holder">\r\n	<div class="qv-inner-associationChicklet">\r\n	    <span title="{{assoc.left.field}}">{{assoc.left.field}}</span>\r\n	    <span ng-hide="assoc.left.field === assoc.right.field" title="{{assoc.right.field}}">{{assoc.right.field}}</span>\r\n    </div>\r\n    <span class="qv-hldm-field-score recommend">{{assoc.scoreTxt}}</span>\r\n    <span class="qv-hldm-field-match-remainder"></span><span class="qv-hldm-field-match recommend" ng-style="{width: assoc.scoreTxt}"></span>\r\n    <i class="icon-tick recommend" ng-show="assoc.status.resolved"></i>\r\n</div>\r\n'}),define("text!assets/hldm/add-data-wizard/align-tables-step/association-types/message.ng.html",[],function(){return'<div class="qv-associationChicklet-holder message-container">\r\n  <span title="{{assoc.text}}">{{assoc.text}}</span>\r\n  <i class="icon-tick recommend" ng-show="assoc.status.resolved"></i>\r\n</div>\r\n'}),define("text!assets/hldm/add-data-wizard/align-tables-step/association-types/bad.ng.html",[],function(){return'<div class="qv-associationChicklet-holder">\r\n	<div class="qv-inner-associationChicklet">\r\n	    <span title="{{assoc.left.field || assoc.text}}">{{assoc.left.field || assoc.text}}</span>\r\n    	<span ng-if="assoc.text2" title="{{assoc.text2}}">{{assoc.text2}}</span>\r\n    </div>\r\n    <span class="qv-hldm-field-score warn" ng-if="!assoc.text2">{{assoc.scoreTxt}}</span>\r\n    <span class="qv-hldm-field-match warn" ng-style="{width: assoc.scoreTxt}" ng-if="!assoc.text2"></span>\r\n    <i class="icon-warning-triangle warn"></i>    \r\n</div>'}),define("text!assets/hldm/add-data-wizard/align-tables-step/association-types/group-good.ng.html",[],function(){return'<div class="qv-associationChicklet-holder">\r\n	<div class="qv-inner-associationChicklet">\r\n    	<span class="group-text" title="{{assoc.text}}">{{assoc.text}}</span>\r\n    </div>\r\n    <span class="qv-hldm-field-score recommend">{{assoc.scoreTxt}}</span>\r\n    <span class="qv-hldm-field-match recommend" ng-style="{width: assoc.scoreTxt}"></span>\r\n    <i class="icon-tick recommend" ng-show="assoc.status.resolved"></i>\r\n</div>\r\n'}),define("text!assets/hldm/add-data-wizard/align-tables-step/association-types/group-bad.ng.html",[],function(){return'<div class="qv-associationChicklet-holder">\r\n	<div class="qv-inner-associationChicklet">\r\n    	<span class="group-text" title="{{assoc.text}}">{{assoc.text}}</span>\r\n    </div>\r\n    <span class="qv-hldm-field-score warn">{{assoc.scoreTxt}}</span>\r\n    <span class="qv-hldm-field-match warn" ng-style="{width: assoc.scoreTxt}"></span>\r\n    <i class="icon-warning-triangle warn"></i>\r\n</div>\r\n'}),define("text!general.services/loader/default-loader.ng.html",[],function(){return'<div class="qv-block-ui" ng-class="{\'qv-fade-out\': fadeOut}">\r\n	<div class="qv-loader-container" ng-class="ngClasses">\r\n		<div class="qv-loader"></div>\r\n	</div>\r\n	<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\r\n		<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\r\n		<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\r\n	</div>\r\n</div>\r\n'}),define("general.components/pager/dynamic-content-pager",["jquery","qvangular","util","core.utils/resize"],function($,qvangular,util,resize){var positionProperty="",sizeProperty="",itemSelector=">li",currentFirstDisplayItemIndex=0,qvPagerOrientation="horizontal",listToScroll=null,listToScrollElem=null;qvangular.directive("qvDynamicContentPager",["$timeout",function($timeout){return{restrict:"A",priority:0,link:function(scope,elem,attrs){function getNextItemToDisplay(pageDir){var itemIndex=currentFirstDisplayItemIndex;pageDir=pageDir>0?1:-1;var containerSize=elem.parent()[sizeProperty](),listItems=listToScroll.find(itemSelector),usedSize=0,curElement=$(listItems[currentFirstDisplayItemIndex]);for(usedSize+=curElement[sizeProperty]();containerSize>usedSize&&itemIndex>=0&&itemIndex<listItems.length;)itemIndex+=pageDir,itemIndex===listItems.length?curElement=null:itemIndex>=0&&(curElement=$(listItems[itemIndex]),usedSize+=curElement[sizeProperty]());return{itemIndex:Math.max(0,itemIndex),element:curElement}}function goToPage(pageDir){var elemObj=getNextItemToDisplay(pageDir),curElementPos=elemObj.element.position();currentFirstDisplayItemIndex=elemObj.itemIndex,listToScrollElem.css(positionProperty,-Math.max(0,curElementPos[positionProperty]))}function goToNextPage(){goToPage(1)}function goToPreviousPage(){goToPage(-1)}function moreItemsToDisplay(){var retVal=!1,elemObj=getNextItemToDisplay(1);return elemObj.element&&(retVal=!0),retVal}function refreshPager(){scope.refreshPager()}qvPagerOrientation=attrs.qvPagerOrientation?attrs.qvPagerOrientation:qvPagerOrientation,itemSelector=attrs.qvItemSelector?attrs.qvItemSelector:itemSelector,currentFirstDisplayItemIndex=0,util.isTouchDevice()&&("horizontal"===qvPagerOrientation?elem.css("overflow-x","auto"):elem.css("overflow-y","auto")),positionProperty="horizontal"===qvPagerOrientation?"left":"top",sizeProperty="horizontal"===qvPagerOrientation?"outerWidth":"outerHeight",elem.addClass("qv-pager"),listToScroll=elem.children()?elem.children().first():null,listToScroll&&(listToScrollElem=$(listToScroll),listToScrollElem.css(positionProperty,0),listToScrollElem.addClass("qv-scrolling-container-"+("horizontal"===qvPagerOrientation?"left":"top"))),scope.nextPage=function(){$timeout(function(){goToNextPage(),scope.refreshPager(!0)})},scope.prevPage=function(){$timeout(function(){goToPreviousPage(),scope.refreshPager(!0)})},scope.refreshPager=function(){var classes="";elem.removeClass("qv-pager-back qv-pager-forward"),0!==currentFirstDisplayItemIndex?(scope.showShadow=!0,classes+="qv-pager-back "):scope.showShadow=!1,moreItemsToDisplay()&&(classes+="qv-pager-forward "),elem.addClass(classes)},scope.$on("refreshPager",refreshPager),scope.$on("$destroy",function(){resize.off("end",refreshPager)})}}}])}),define("text!assets/hldm/add-data-wizard/align-tables-step/table-preview.ng.html",[],function(){return'<table>\r\n    <colgroup>\r\n        <col ng-repeat="field in table.fields" ng-class="getClass(field, association)"/>\r\n    </colgroup>\r\n    <thead>\r\n        <tr>\r\n            <th move-into-view ng-repeat="field in table.fields"\r\n                ng-class="getClass(field)"\r\n                title="{{field.alias}}">{{field.alias}}&nbsp;</td>\r\n        </tr>\r\n    </thead>\r\n    <tbody qv-generate-cells>\r\n    </tbody>\r\n</table>'}),define("assets/hldm/add-data-wizard/align-tables-step/table-preview",["jquery","qvangular","text!./table-preview.ng.html"],function($,qvangular,template){qvangular.directive("qvHldmTablePreview",["$timeout",function($timeout){return{restrict:"E",replace:!0,template:template,scope:{table:"=",association:"=",affected:"="},controller:["$scope","$element",function($scope,$element){var timer;this.scrollHighlightedColumnIntoView=function(){$timeout.cancel(timer),$scope.table.name&&($scope.table.isLoaded=!0,timer=$timeout(function(){var pw,s,w,m,p=$("th.highlighted",$element[0]);p.length&&(pw=p[0].clientWidth,p=p.position().left,w=$element[0].parentElement||0,w&&(w=$element[0].parentElement.clientWidth,m=pw>w?0:w/2+pw/2,s=$element[0].parentElement.scrollLeft+p-m,$($element[0].parentElement).animate({scrollLeft:s})))}))},$scope.$watchCollection("association",this.scrollHighlightedColumnIntoView),$scope.highlight=function(field,fieldsToHighligt){return Array.isArray(fieldsToHighligt)?fieldsToHighligt.indexOf(field.name)>=0:field.name===fieldsToHighligt},$scope.getClass=function(field){var f,type,association=$scope.association,affected=$scope.affected;association.fields?(f=association.fields.filter(function(ff){return ff.field===field.alias})[0],type=f?f.type:-1):field.alias===association.field&&(type=association.type);var cssClass="";return type>=0?cssClass="highlighted highlight-"+(0===type?"bad":"good"):affected&&affected.some(function(ff){return field.alias===ff.field})&&(cssClass="highlight-affected"),cssClass}}]}}]),qvangular.directive("moveIntoView",["$timeout",function($timeout){return{require:"^qvHldmTablePreview",link:function(scope,elem,attr,prevCtrl){scope.$last&&$timeout(function(){prevCtrl.scrollHighlightedColumnIntoView(!0)})}}}]),qvangular.directive("qvGenerateCells",function(){return{replace:!1,restrict:"A",link:function(scope,elem){function generateCells(){for(var last,row,tr,td,r,c,frag=document.createDocumentFragment();last=elem[0].lastChild;)elem[0].removeChild(last);if(scope.table&&scope.table.rows&&scope.table.rows.length)for(r=0;r<scope.table.rows.length;r++){for(row=scope.table.rows[r],tr=document.createElement("tr"),c=0;c<row.length;c++)td=document.createElement("td"),td.textContent=row[c].value,tr.appendChild(td);frag.appendChild(tr)}elem[0].appendChild(frag)}scope.$watch("table",function(){generateCells()})}}})}),define("assets/hldm/add-data-wizard/align-tables-step/align-tables-step",["qvangular","core.models/engine","text!./align-tables-step.ng.html","core.utils/resize","translator","assets/hldm/models/load-model-to-dataprep-model","assets/hldm/services/data-prep-service","general.services/show-service/show-service","./table-pair-popover","./recommendations-handler","text!./recommendations-info.ng.html","text!./association-types/recommendation.ng.html","text!./association-types/message.ng.html","text!./association-types/bad.ng.html","text!./association-types/group-good.ng.html","text!./association-types/group-bad.ng.html","text!general.services/loader/default-loader.ng.html","general.components/pager/dynamic-content-pager","./table-preview"],function(qvangular,Engine,template,resize,translator,loadModelToDataPrepModel,DPS,showService,tablePopOverComponent,recommendationsHandler,infoTemplate,recommendationTemplate,messageTemplate,badTemplate,groupGoodTemplate,groupBadTemplate,spinningCircleLoaderTemplate){var $templateCache=qvangular.getService("$templateCache");$templateCache.put("wizard-recommendations-info.ng.html",infoTemplate),$templateCache.put("association-recommendation.ng.html",recommendationTemplate),$templateCache.put("association-message.ng.html",messageTemplate),$templateCache.put("association-bad.ng.html",badTemplate),$templateCache.put("association-group-bad.ng.html",groupBadTemplate),$templateCache.put("association-group-good.ng.html",groupGoodTemplate);var ASSOCIATION=recommendationsHandler.ASSOCIATION,component={template:template,scope:{qvDialogContext:"=",qvInternals:"=",analyzeAllTables:"="},controller:["$scope","$element","$timeout",function($scope,$element,$timeout){function updatePreviewTable(previewTable){var tName=previewTable.name,tm=getTableModel(tName);previewTable.fields.forEach(function(f,i,arr){var alias=f.name,name=f.name;cacheOfFieldAliases&&(name=cacheOfFieldAliases[tName+"."+alias]||alias),arr[i].alias=tm.getFieldAlias(name),arr[i].alias||(arr[i].alias=name)})}function resolve(recommendation,association){recHandler.resolve(recommendation,association),$scope.currentFieldAssociationSelected=$scope.currentFieldAssociationFocused,updatePreviewTable($scope.leftPreviewTable),updatePreviewTable($scope.rightPreviewTable)}function revert(recommendation){recommendation.resolved&&(recHandler.reset(recommendation),updatePreviewTable($scope.leftPreviewTable),updatePreviewTable($scope.rightPreviewTable))}function updateAssociationMessage(){var info="",action="";$scope.currentFieldAssociation&&($scope.currentFieldAssociation.type===ASSOCIATION.BAD||$scope.currentFieldAssociation.type===ASSOCIATION.BADGROUP?info=translator.get("DataPrep.Recommendations.BadAssociation.Info"):$scope.currentFieldAssociation.type===ASSOCIATION.GOODGROUP?info=translator.get("DataPrep.Recommendations.ValidAssociation.Info"):$scope.currentFieldAssociation.type===ASSOCIATION.KEEP?info=translator.get("DataPrep.Recommendations.ValidAssociationPart.Info"):$scope.currentFieldAssociation.type===ASSOCIATION.GOOD?info=translator.get("DataPrep.Recommendations.ValidAssociation.Info"):$scope.currentFieldAssociation.type===ASSOCIATION.RECOMMENDATION?info=translator.get("DataPrep.Recommendations.RenameTo"):$scope.currentFieldAssociation.type===ASSOCIATION.NONE?$scope.currentRecommendation.associations.length>1?(info=translator.get("DataPrep.Recommendations.NoAssociation.Info"),action=translator.get("DataPrep.Recommendations.Associate")):info=translator.get("DataPrep.Recommendations.NoAssociation.InfoNoRecommendations"):$scope.currentFieldAssociation.type===ASSOCIATION.BREAK&&(info=translator.get("DataPrep.Recommendations.BreakAssociation.Info"))),$scope.associationMessage.info=info,$scope.associationMessage.action=action,$scope.associationMessage.leftName=$scope.currentFieldAssociation.left.field,$scope.associationMessage.rightName=$scope.currentFieldAssociation.right.field}function getTableModel(name){return $scope.qvInternals.newLoadModel.getTableModelWithName(name)}function getNormalizedTable(name,preview){var table={isLoaded:!1,name:name,fields:preview[0].qValues.map(function(field){return{name:field,alias:field}})},rows=[];return preview.slice(1).forEach(function(row,i){var r=row.qValues.map(function(v,j){return{cellNr:"_"+j,value:v}});r.rowNr=i,rows.push(r)}),table.rows=rows,table}function getTablePreview(table){return DPS.get().then(function(dps){return dps.getDataPreview({tableName:table.getTableAlias(),numberOfRows:20,syntheticMode:!1}).then(function(res){return res.result})})}function showPreview(tableLeft,tableRight){var table,table2;tableLeft!==$scope.leftPreviewTable.name&&($scope.leftPreviewTable={},table=getTableModel(tableLeft),table&&getTablePreview(table).then(function(result){$scope.leftPreviewTable=getNormalizedTable(tableLeft,result.qPreview),updatePreviewTable($scope.leftPreviewTable)})),tableRight!==$scope.rightPreviewTable.name&&($scope.rightPreviewTable={},table2=getTableModel(tableRight),table2&&getTablePreview(table2).then(function(result){$scope.rightPreviewTable=getNormalizedTable(tableRight,result.qPreview),updatePreviewTable($scope.rightPreviewTable)}))}function showTypePopover(event){tablePairsPopOver=showService.show(tablePopOverComponent,{items:recHandler.recommendations,selected:recHandler.recommendations.indexOf(recHandler.recommendations.filter(function(rec){return rec.id===$scope.currentRecommendation.id})[0]),alignTo:event.currentTarget,onItemClicked:function(e,item){closeTablePairPopover(e),$scope.showFieldAssociationsForRecommendation(item)},onClose:function(){closeTablePairPopover()}})}function closeTablePairPopover(){tablePairsPopOver&&(tablePairsPopOver.destroy(),tablePairsPopOver=null)}function getDataPrepModel(loadModel){return loadModelToDataPrepModel.compileLoadModelToDataPrepModel(Engine.global,Engine.getCurrentApp(),loadModel,$scope.qvInternals.dataconnectorsModel)}function cacheFieldAliases(){cacheOfFieldAliases={},$scope.qvInternals.newLoadModel.tableModels.forEach(function(table){var tName=table.getTableAlias();table.data.fields.forEach(function(field){cacheOfFieldAliases[tName+"."+table.getFieldAlias(field.name)]=field.name})})}function profileAllNewTables(){$scope.isProfiling=!0,qvLoader.show({template:spinningCircleLoaderTemplate,messageObj:{task:"DataPrep.Recommendations.Profiling"},appendTo:$element}),DPS.get().then(function(dps){recHandler.clear(),getDataPrepModel($scope.qvInternals.newLoadModel).then(function(dpm){return cacheFieldAliases(),dps.getRecommendations(dpm,null,.5,.5,$scope.analyzeAllTables)}).then(function(res){recHandler.setRecommendations(res.result),recHandler.groupAssociationsByTablePairs(),qvLoader.close(!0),$scope.isProfiling=!1,recHandler.recommendations.length?$scope.showFieldAssociationsForRecommendation(recHandler.recommendations[0]):$scope.status=translator.get("DataPrep.Recommendations.NoRecommendationsFromDPS")},processError)},function(){$scope.status=translator.get("DataPrep.Recommendations.ErrorConnectingToDPS"),$scope.isProfiling=!1,qvLoader.close(!0)})}function processError(error){if($scope.status=translator.get("DataPrep.Recommendations.ProfilingFailed"),error.error&&error.error.name){var errorMessage=translator.get(error.error.name,error.error.parameters);errorMessage!==error.error.name&&($scope.errorMessage=errorMessage),error.error.data&&(Array.isArray(error.error.data)?$scope.errorData=error.error.data:$scope.errorData=[error.error.data]),error.isHandled=!0}$scope.isProfiling=!1,qvLoader.close(!0)}$scope.qvDialogContext.title="DataPrep.Recommendations",$scope.qvDialogContext.stepInfo={templateUrl:"wizard-recommendations-info.ng.html",show:!1},$scope.currentFieldAssociationSelected=null,$scope.currentFieldAssociationFocused=null,$scope.nav={hasPrev:function(){return $scope.currentRecommendationIndex>0},hasNext:function(){return $scope.currentRecommendationIndex<$scope.recommendations.length-1},prev:function(){this.hasPrev()&&$scope.showFieldAssociationsForRecommendation(recHandler.recommendations[$scope.currentRecommendationIndex-1])},next:function(){this.hasNext()&&$scope.showFieldAssociationsForRecommendation(recHandler.recommendations[$scope.currentRecommendationIndex+1])}};var qvLoader=qvangular.getService("qvLoader"),recHandler=recommendationsHandler.create($scope.qvInternals.newLoadModel);$scope.recommendations=recHandler.recommendations,$scope.associationMessage={info:"",action:"",leftName:"",rightName:""},$scope.isProfiling=!1,$scope.defaultAssociations=[],$scope.recommendedAssociation=[],$scope.leftPreviewTable={},$scope.rightPreviewTable={},$scope.$watch("getWarningsCount()",function(value){$scope.warningsCount=value,1===value?$scope.warningsCountMessage=translator.get("DataPrep.Recommendations.SingleWarning",[value]):value>1?$scope.warningsCountMessage=translator.get("DataPrep.Recommendations.PluralWarnings",[value]):$scope.warningsCountMessage=translator.get("DataPrep.Recommendations.NoWarnings")}),$scope.getWarningsCount=function(){return recHandler.recommendations.filter(function(pair){return!pair.isGood()}).length},$scope.breakAssociation=function(rec,assoc){resolve(rec,assoc)},$scope.keepAssociation=function(rec,assoc){resolve(rec,assoc),$scope.currentFieldAssociation.left.timeStamp=(new Date).getTime(),$scope.currentFieldAssociation.right.timeStamp=(new Date).getTime()},$scope.qvDialogContext.nextDisabled=function(){return $scope.isProfiling},$scope.qvDialogContext.finishDisabled=function(){return $scope.isProfiling},$scope.qvDialogContext.backDisabled=function(){return $scope.isProfiling},$scope.qvDialogContext.onBeforeNext=function(){closeTablePairPopover()},$scope.qvDialogContext.onBeforeBack=function(){closeTablePairPopover()},$scope.handleInputKeyPress=function(event){13===event.which&&(event.stopPropagation(),$scope.useFieldName($scope.currentFieldAssociation.customName))},$scope.useFieldName=function(name,fromExistingField){$scope.currentFieldAssociation.status.resolved="undefined"!=typeof name&&""!==name,$scope.currentFieldAssociation.status.resolution=name,$scope.currentFieldAssociationSelected=$scope.currentFieldAssociationFocused;var isInUse=!1;if(fromExistingField||(fromExistingField=name===$scope.currentFieldAssociation.left.field||name===$scope.currentFieldAssociation.right.field),fromExistingField&&void 0!==$scope.currentFieldAssociation.customName&&($scope.currentFieldAssociation.customName=void 0),fromExistingField||(isInUse=$scope.qvInternals.newLoadModel.isFieldNameInUse(name)),isInUse){$scope.currentFieldAssociation.status.resolved=!1,$scope.badFieldName=!0;var input=$element.find(".input-container input")[0];return void(input&&(input.focus(),input.select()))}$scope.badFieldName=!1;var alias=$scope.currentFieldAssociation.status.resolution;alias?resolve($scope.currentRecommendation,$scope.currentFieldAssociation):revert($scope.currentRecommendation),$scope.currentFieldAssociation.left.timeStamp=(new Date).getTime(),$scope.currentFieldAssociation.right.timeStamp=(new Date).getTime(),$scope.currentFieldAssociation.left.alias=alias,$scope.currentFieldAssociation.right.alias=alias},$scope.onRevertFieldsRecommendation=function(){$scope.currentRecommendation&&(revert($scope.currentRecommendation),$scope.currentFieldAssociation.left.timeStamp=(new Date).getTime(),$scope.currentFieldAssociation.right.timeStamp=(new Date).getTime(),$scope.currentFieldAssociationSelected=$scope.currentRecommendation.associations.filter(function(a){return a.isDefault()&&a.show})[0]||$scope.currentRecommendation.associations[0])},$scope.onRecommendationClick=function(rec){var newIndex=$scope.recommendations.indexOf(rec);$scope.currentRecommendationIndex!==newIndex&&$scope.showFieldAssociationsForRecommendation(rec)},$scope.showFieldAssociationsForRecommendation=function(rec){var newIndex=$scope.recommendations.indexOf(rec);return $scope.currentRecommendationIndex===newIndex?void($scope.selectedPair=translator.get("CurrentSelections.Of",[newIndex+1,recHandler.recommendations.length])):($scope.currentRecommendation=rec.cloneForEditing(),$scope.currentRecommendationIndex=newIndex,$scope.currentRecommendation&&($scope.defaultAssociations=$scope.currentRecommendation.associations.filter(function(assoc){return assoc.show&&assoc.isDefault()}),$scope.recommendedAssociations=$scope.currentRecommendation.associations.filter(function(assoc){return assoc.show&&!assoc.isDefault()}),$scope.selectedPair=translator.get("CurrentSelections.Of",[newIndex+1,recHandler.recommendations.length]),$scope.currentFieldAssociation=$scope.currentFieldAssociationSelected=$scope.currentFieldAssociationFocused=$scope.currentRecommendation.associations.filter(function(a){return a.isDefault()&&a.show})[0]||$scope.currentRecommendation.associations[0],showPreview($scope.currentRecommendation.leftTable,$scope.currentRecommendation.rightTable),updateAssociationMessage()),void $timeout(function(){$scope.$broadcast("refreshPager")}))},$scope.onFieldAssociationClick=function(assoc){$scope.currentFieldAssociation&&$scope.currentFieldAssociation.status.resolved||($scope.currentFieldAssociationFocused=assoc,$timeout(function(){$scope.currentFieldAssociation=assoc,updateAssociationMessage()},300))},$scope.showLoader=function(table){return!table.isLoaded};var tablePairsPopOver;$scope.onShowTablesPopOver=function(e){showTypePopover(e)};var cacheOfFieldAliases=null;profileAllNewTables(),resize.on("end",function(){$scope.$broadcast("refreshPager")})}]};return component}),define("scripteditor.services/file-formats",[],function(){var fileFilters=[{title:"scripteditor.flatfilechooser.files.tables",titleShort:"scripteditor.flatfilechooser.files.tablesShort",regexps:[new RegExp("\\.csv$","i"),new RegExp("\\.txt$","i"),new RegExp("\\.tab$","i"),new RegExp("\\.qvo$","i"),new RegExp("\\.mem$","i"),new RegExp("\\.skv$","i"),new RegExp("\\.prn$","i"),new RegExp("\\.log$","i"),new RegExp("\\.xls$","i"),new RegExp("\\.xlw$","i"),new RegExp("\\.xlsx$","i"),new RegExp("\\.xlsm$","i"),new RegExp("\\.html$","i"),new RegExp("\\.htm$","i"),new RegExp("\\.php$","i"),new RegExp("\\.fix$","i"),new RegExp("\\.dat$","i"),new RegExp("\\.qvd$","i"),new RegExp("\\.qvx$","i"),new RegExp("\\.xml$","i"),new RegExp("\\.html$","i"),new RegExp("\\.kml$","i")]},{title:"scripteditor.flatfilechooser.files.delimited",titleShort:"scripteditor.flatfilechooser.files.delimitedShort",regexps:[new RegExp("\\.csv$","i"),new RegExp("\\.txt$","i"),new RegExp("\\.tab$","i"),new RegExp("\\.qvo$","i"),new RegExp("\\.mem$","i"),new RegExp("\\.skv$","i"),new RegExp("\\.prn$","i"),new RegExp("\\.log$","i")]},{title:"scripteditor.flatfilechooser.files.excel",titleShort:"scripteditor.flatfilechooser.files.excelShort",regexps:[new RegExp("\\.xls$","i"),new RegExp("\\.xlw$","i"),new RegExp("\\.xlsx$","i"),new RegExp("\\.xlsm$","i")]},{title:"scripteditor.flatfilechooser.files.html",titleShort:"scripteditor.flatfilechooser.files.htmlShort",regexps:[new RegExp("\\.html$","i"),new RegExp("\\.htm$","i"),new RegExp("\\.php$","i")]},{title:"scripteditor.flatfilechooser.files.kml",titleShort:"scripteditor.flatfilechooser.files.kmlShort",regexps:[new RegExp("\\.kml$","i")]},{title:"scripteditor.flatfilechooser.files.fix",titleShort:"scripteditor.flatfilechooser.files.fixShort",regexps:[new RegExp("\\.fix$","i"),new RegExp("\\.dat$","i")]},{title:"scripteditor.flatfilechooser.files.qvd",titleShort:"scripteditor.flatfilechooser.files.qvdShort",regexps:[new RegExp("\\.qvd$","i")]},{title:"scripteditor.flatfilechooser.files.qvx",titleShort:"scripteditor.flatfilechooser.files.qvxShort",regexps:[new RegExp("\\.qvx$","i")]},{title:"scripteditor.flatfilechooser.files.xml",titleShort:"scripteditor.flatfilechooser.files.xmlShort",regexps:[new RegExp("\\.xml$","i"),new RegExp("\\.html$","i")]},{title:"scripteditor.flatfilechooser.files.all",titleShort:"scripteditor.flatfilechooser.files.allShort",regexps:[new RegExp(".*","i")]}];return{getFileFilters:function(){return fileFilters}}}),define("scripteditor.utils/directory-arranger",["scripteditor.utils/string-util"],function(stringUtil){function postProcessDriveListing(drivers){function qDrivesToViewDrives(drive){return{name:stringUtil.removeSurroundingSlashes(drive.qDrive),extraInfo:drive.qName,path:drive.qDrive,isFile:!1}}drivers=drivers||[];var folderItems=drivers.map(qDrivesToViewDrives);return _groupByFolderAndFilesThenSortAlphabetically(folderItems),_addBackToParentFolder(folderItems,""),folderItems}function _isFileMatchingFileFilter(name,fileFilters){if(void 0===fileFilters)return!0;for(var i=0;i<fileFilters.length;i++)if(name.match(fileFilters[i]))return!0;return!1}function _groupByFolderAndFilesThenSortAlphabetically(items){items.sort(function(a,b){return a.isFile===b.isFile?stringUtil.sortSlightlyMoreNaturallySingle(a.name,b.name):a.isFile?1:-1})}function _addBackToParentFolder(items,subdir){items.unshift({name:"",path:stringUtil.goUpOneFolderLevel(subdir),isFile:!1,disabled:0===subdir.length})}function regExpArrayToFilter(arrayOfRegExToFilterFiles){function _filter(item){return!item.isFile||_isFileMatchingFileFilter(item.name,arrayOfRegExToFilterFiles)}return _filter}function postProcessDirectoryListing(subdir,folderItems,arrayOfRegExToFilterFiles){function qFileItemToViewFileItem(item){return{name:item.qName,path:subdir+(stringUtil.endsWith(subdir,"\\")?"":"\\")+item.qName,isFile:"FILE"===item.qType}}var items=folderItems.map(qFileItemToViewFileItem).filter(regExpArrayToFilter(arrayOfRegExToFilterFiles));return _groupByFolderAndFilesThenSortAlphabetically(items),_addBackToParentFolder(items,subdir),items}var exports={postProcessDirectoryListing:postProcessDirectoryListing,postProcessDriveListing:postProcessDriveListing};return exports}),define("text!assets/hldm/add-data-wizard/components/uploaded-data-files-view.ng.html",[],function(){return'<div class="uploaded-data-files" ng-class="{\'dragging-over\':draggingOver}">\r\n	<div class="file-list">\r\n		<ul vs-repeat vs-scroll-parent=".file-list">\r\n			<li class="qui-menu-item" ng-disabled="item.disabled" ng-repeat="item in uploadedFiles"\r\n				ng-class="{fileselected:( item.isFile && item.name == selectedFileName.name)}"\r\n				qva-activate="onFileClicked(item)" qva-dblclick="onFileDblClick(item)" title="{{item.path}}">\r\n				<span class="used-file-indicator" ng-class="{\'file-in-use\':item.usedInLoadModel}"\r\n					  title="{{getFileInUseTitle(item)}}"></span>\r\n				<span class="file-name">{{item.name}}</span>\r\n				<span ng-if="canUserModifyAppStore" class="delete-btn icon-bin" qva-activate="onDeleteFileClicked(item)" q-title-translation="UploadedFilesFolder.DeleteFileButton.Title"></span>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n	<!-- <div class="text" q-translation="scripteditor.flatfilechooser.filetype"></div> -->\r\n	<qui-select class="file-type"\r\n				qui-model="selectedFileFilter"\r\n				qui-options="option.title|translate for option in fileFilters"></qui-select>\r\n	<div ng-if="canUserModifyAppStore" class="upload-drop-zone" qva-activate="selectFile()">\r\n		<span class="text drag-and-drop-label" q-translation="uploadfile.selectfiledialog.draganddropfilehere"></span>\r\n	</div>\r\n	<div ng-if="availableSpace != null" class="store-status">\r\n		<span class="text" q-translation="UploadedFilesFolder.Status.AvailableSpace, {{availableSpace}}"></span>\r\n	</div>\r\n	<div class="file-info" ng-show="uploading || draggingOver">\r\n		<div class="overlay"></div>\r\n		<div class="dragging-circle centered">\r\n			<div class="upload-icon centered" ng-show="draggingOver"></div>\r\n			<div class="text upload-progress centered" ng-show="uploading">{{uploadingProgress}}%</div>\r\n		</div>\r\n		<div class="text upload-message centered" ng-show="draggingOver" q-translation="uploadfile.selectfiledialog.dropfilehere"></div>\r\n		<div class="text upload-message centered" ng-show="uploading">{{uploadingFileName}} ({{uploadingFileSize}})</div>\r\n	</div>\r\n</div>\r\n'}),define("assets/hldm/add-data-wizard/components/uploaded-data-files-view",["jquery","qvangular","translator","touche","core.models/engine","scripteditor.utils/string-util","scripteditor.services/file-formats","scripteditor.utils/directory-arranger","client.controllers/error-handler-controller","../../services/upload-data-files-service","assets/hldm/models/load-model","text!./uploaded-data-files-view.ng.html"],function($,qvangular,translator,Touche,engine,stringUtil,fileFormats,directoryArranger,errorHandler,uploadDataFilesService,loadModel,template){qvangular.directive("qvUploadedDataFilesView",function(){return{restrict:"E",replace:!0,template:template,scope:{uploadFolderConnection:"=",onFileSelected:"&",selectedFileName:"="},controller:["$scope","$element","$timeout","$delayedModal",function($scope,$element,$timeout,$delayedModal){
function refreshAvailableSpace(){uploadDataFilesService.getAppStoreLibrary().then(function(appStore){appStore&&($scope.availableSpace=uploadDataFilesService.getFormattedAvailableSpace(appStore.qMeta.remainingLibrarySpace))})}function markFilesUsedInLoadModel(files){return serializedLoadModel.then(function(model){var filesInModel={};model&&model.tables&&model.connectionMetaDataModels&&model.tables.filter(function(t){return"load-file"===t.boxType&&uploadDataFilesService.isUploadFolderConnection(model.connectionMetaDataModels[t.dataconnectorName])}).forEach(function(t){filesInModel[t.databaseName.toLowerCase()]=!0}),files.forEach(function(f){f.usedInLoadModel=!!filesInModel[f.name.toLowerCase()]})})}function reloadFilesList(){$scope.uploadFolderConnection&&engine.currentApp.getFolderItemsForConnection({qConnectionId:$scope.uploadFolderConnection.id}).then(function(files){$scope.allUploadedFiles=files.qFolderItems,updateFilesList($scope.allUploadedFiles)},function(error){$scope.allUploadedFiles=null,handleErrorsFileList(error)})}function updateFilesList(files){var uploadedFiles=directoryArranger.postProcessDirectoryListing("",files,$scope.selectedFileFilter.regexps).filter(function(item){return item.isFile});markFilesUsedInLoadModel(uploadedFiles).then(function(){$scope.uploadedFiles=uploadedFiles})}function handleErrorsFileList(error){$scope.uploadedFiles=null,error.isHandled=!0}function getFileFromDragEvent(event){var dataTransfer=event.dataTransfer||event.originalEvent&&event.originalEvent.dataTransfer,files=event.target.files||dataTransfer.files;return files?files[0]:null}function onDragOver(event){event.stopPropagation(),event.preventDefault(),leavingTimeout&&($timeout.cancel(leavingTimeout),leavingTimeout=null),$scope.$apply(function(){$scope.draggingOver=!0})}function onDragLeave(event){event.stopPropagation(),event.preventDefault(),event.relatedTarget||(leavingTimeout&&$timeout.cancel(leavingTimeout),leavingTimeout=$timeout(function(){$scope.draggingOver=!1},100))}function onDrop(event){event.stopPropagation(),event.preventDefault();var file=getFileFromDragEvent(event);$scope.$apply(function(){$scope.draggingOver=!1,uploadFile(file)})}function checkUploadQuota(file){var d=qvangular.defer();return uploadDataFilesService.getAppStoreLibrary().then(function(appStore){if(appStore){var maxFileSize=appStore.qMeta.maxFileSize,availableSpace=appStore.qMeta.remainingLibrarySpace,formattedFileSize=uploadDataFilesService.getFormattedFileSize(file.size);"number"==typeof maxFileSize&&maxFileSize>0&&file.size>maxFileSize?d.reject({message:translator.get("UploadedFilesFolder.Error.MaxFileSizeExceeded",[file.name,formattedFileSize,uploadDataFilesService.getFormattedFileSize(maxFileSize)])}):"number"==typeof availableSpace&&file.size>availableSpace?d.reject({message:translator.get("UploadedFilesFolder.Error.AvailableSpaceExceeded",[file.name,formattedFileSize,uploadDataFilesService.getFormattedAvailableSpace(availableSpace)])}):d.resolve()}},function(error){d.reject(error)}),d.promise}function checkFileOverwrite(file){var d=qvangular.defer();return $scope.allUploadedFiles&&$scope.allUploadedFiles.some(function(f){return f.qName===file.name})?$delayedModal.open({title:"UploadedFilesFolder.Confirm.Overwrite.Title",content:translator.get("UploadedFilesFolder.Confirm.Overwrite.Description",[file.name]),buttons:[{name:"Common.Cancel",callback:function(){d.reject()}},{name:"UploadedFilesFolder.Button.Overwrite",defaultButton:!0,callback:function(){d.resolve(!0)}}]}):d.resolve(!0),d.promise}function uploadFile(file){return uploadDataFilesService.isAllowedFileType(file)?void(file&&checkUploadQuota(file).then(function(){checkFileOverwrite(file).then(function(){$scope.uploading=!0,$scope.uploadingFileName=file.name,$scope.uploadingFileSize=uploadDataFilesService.getFormattedFileSize(file.size),$scope.uploadingProgress=0,uploadDataFilesService.uploadFile(file).then(onFileUploaded,onUploadError,onUploadProgress)})},onUploadError)):void onUploadError({message:translator.get("UploadedFilesFolder.Error.NotAllowedFileType",[file.name])})}function onFileUploaded(file){reloadFilesList(),refreshAvailableSpace(),$scope.uploadingProgress=100,$timeout(function(){$scope.uploading=!1,$scope.onFileSelected&&$scope.onFileSelected({name:file.name})},800)}function onUploadError(error){$scope.uploading=!1,error||(error={code:500}),errorHandler.showDialog(error)}function onUploadProgress(doneAmount){$scope.uploadingProgress=Math.round(100*doneAmount)}function deleteFile(file){var message=file&&file.usedInLoadModel?translator.get("UploadedFilesFolder.Confirm.DeleteUsedFile.Description",[file.name]):translator.get("UploadedFilesFolder.Confirm.DeleteNotUsedFile.Description",[file.name]);$delayedModal.open({title:"UploadedFilesFolder.Confirm.Delete.Title",content:message,buttons:[{name:"Common.Cancel",callback:function(){}},{name:"Common.Delete",defaultButton:!0,callback:function(){file.deleting=!0,uploadDataFilesService.deleteFile(file.name).then(function(){onFileDeleted(file)},function(error){file.deleting=!1,onFileDeleteError(file,error)})}}]})}function onFileDeleted(){reloadFilesList(),refreshAvailableSpace()}function onFileDeleteError(file){errorHandler.showDialog({message:translator.get("UploadedFilesFolder.Error.CannotDeleteFile",[file.name])})}$scope.allUploadedFiles=null,$scope.uploadedFiles=null,$scope.fileFilters=fileFormats.getFileFilters(),$scope.selectedFileFilter=$scope.fileFilters[0],$scope.uploading=!1,$scope.draggingOver=!1,$scope.uploadingFileName=null,$scope.uploadingFileSize=null,$scope.uplodingProgress=0,$scope.canUserModifyAppStore=!1,$scope.availableSpace=null,uploadDataFilesService.canUserModifyAppStore().then(function(canWrite){$scope.canUserModifyAppStore=canWrite});var $body=$("body");$scope.$watch("uploadFolderConnection",function(){reloadFilesList(),refreshAvailableSpace()}),$scope.$watch("selectedFileFilter",function(){$scope.allUploadedFiles&&updateFilesList($scope.allUploadedFiles)});var serializedLoadModel=loadModel.getLoadModel(function(){}).then(function(model){return model.serialize()}),leavingTimeout=null;$body.on("dragover",onDragOver),$body.on("dragleave",onDragLeave),$body.on("drop",onDrop),$element.on("$destroy",function(){$body.off("dragover",onDragOver),$body.off("dragleave",onDragLeave),$body.off("drop",onDrop)}),$scope.onFileClicked=function(file){$scope.selectedFileName.name=file.name},$scope.onFileDblClick=function(file){$scope.onFileSelected&&$scope.onFileSelected({name:stringUtil.removeSurroundingSlashes(file.name)})},$scope.onDeleteFileClicked=function(file){deleteFile(file)},$scope.selectFile=function(){uploadDataFilesService.selectFile().then(function(file){file&&uploadFile(file)})},$scope.getFileInUseTitle=function(file){return file&&file.usedInLoadModel?translator.get("UploadedFilesFolder.FileInUseIndicator.Title"):translator.get("UploadedFilesFolder.FileNotInUseIndicator.Title")},Touche($element.find(".file-list")[0]).swipe({options:{preventDefault:!1},end:function(){Touche.preventGestures(this.gestureHandler)}})}]}})}),define("assets/hldm/add-data-wizard/select-kind-step-two/select-kind-step-two",["jquery","translator","scripteditor.utils/string-util","../../services/upload-data-files-service","text!./select-kind-step-two.ng.html","text!./categories/connectors-view.ng.html","text!./categories/data-market-view.ng.html","text!./categories/existing-connections-view.ng.html","text!./categories/attached-data-view.ng.html","ng!$templateCache","assets/hldm/add-data-wizard/align-tables-step/align-tables-step","general.services/show-service/show-service","./../components/uploaded-data-files-view"],function($,translator,stringUtil,uploadFilesService,template,connectorsTemplate,datamarketTemplate,connectionsTemplate,attachedDataTemplate,$templateCache){function setActiveCategory($scope,id){Object.keys($scope.views.categories).forEach(function(key){key===id?($scope.views.categories[key].active=!0,$scope.activeView=$scope.views.categories[key].id):$scope.views.categories[key].active=!1}),$scope.qvDialogContext.showDatamarketDisclaimer="en-US"!==translator.language&&id===CATEGORY_DATAMARKET}function setActiveItem($scope,id,item){Object.keys($scope.views.categories).forEach(function(key){$scope.views.categories[key].activeItem=key===id?item:void 0})}function clearActiveItem($scope){Object.keys($scope.views.categories).forEach(function(key){$scope.views.categories[key].activeItem=void 0})}function getCategories($scope){$scope.views.categories=hardCodedCategories,$scope.views.orderedCategories=Object.keys(hardCodedCategories).map(function(key){return hardCodedCategories[key]}).sort(function(c1,c2){return c1.order-c2.order}),setActiveCategory($scope,CATEGORY_CONNECTIONS)}function getConnectors($scope){$scope.views.categories.datamarket.show=!1,$scope.views.connectors=[];var all=$scope.dataconnectorsModel.allConnectorEntrypoints;Object.keys(all).forEach(function(key){if(key===CATEGORY_DATAMARKET)return void(all[key].length>0&&($scope.views.categories.datamarket.show=!0));for(var i=0;i<all[key].length;++i){var connector=all[key][i];connector.active=!1,$scope.views.connectors.push(connector)}}),$scope.views.connectors.sort(function(a,b){return a.entrypoint.name<b.entrypoint.name?-1:a.entrypoint.name>b.entrypoint.name?1:0})}function getExistingConnections($scope){return uploadFilesService.isFileUploadEnabled().then(function(enabled){enabled&&($scope.uploadFolderConnection=$scope.dataconnectorsModel.connections.filter(function(conn){return uploadFilesService.isUploadFolderConnection(conn.connectorInstance)})[0],null!=$scope.uploadFolderConnection?uploadFilesService.canUserReadAppStore().then(function(canRead){$scope.views.categories[CATEGORY_ATTACHMENTS].show=canRead}):$scope.views.categories[CATEGORY_ATTACHMENTS].show=!1)}),$scope.views.existingConnections=$scope.dataconnectorsModel.connections.filter(function(conn){var visible=!("QvDataMarketConnector.exe"===conn.connectorInstance.typeName||uploadFilesService.isUploadFolderConnection(conn.connectorInstance));return visible}),0===$scope.views.existingConnections.length?($scope.views.categories.connections.show=!1,void setActiveCategory($scope,CATEGORY_CONNECTORS)):void($scope.views.categories.connections.show=!0)}function getDataMarketData($scope){var datamarketConnectors=$scope.dataconnectorsModel.allConnectorEntrypoints.datamarket;$scope.views.datamarket=[];for(var i=0;i<datamarketConnectors.length;++i)$scope.views.datamarket.push(datamarketConnectors[i])}var CONNECTOR_TYPE_FOLDER="folder",CATEGORY_CONNECTIONS="connections",CATEGORY_CONNECTORS="connectors",CATEGORY_DATAMARKET="datamarket",CATEGORY_ATTACHMENTS="attachments",CATEGORY_WEB="web",hardCodedCategories={};hardCodedCategories[CATEGORY_CONNECTIONS]={order:1,dataIcon:"icon-connector",show:!1,translationKey:"quickdataload.connections",id:"connections.html",template:connectionsTemplate,active:!1},hardCodedCategories[CATEGORY_CONNECTORS]={order:2,dataIcon:"icon-connect-to-data",show:!0,translationKey:"quickdataload.connectors",id:"connectors.ng.html",template:connectorsTemplate,active:!1},hardCodedCategories[CATEGORY_DATAMARKET]={order:3,dataIcon:"icon-datamarket",show:!1,translationKey:"quickdataload.datamarket",id:"qlik-data-market.html",template:datamarketTemplate,active:!1},hardCodedCategories[CATEGORY_ATTACHMENTS]={order:4,dataIcon:"icon-attachments",show:!1,translationKey:"quickdataload.attachments",id:"attached-data-view.ng.html",template:attachedDataTemplate,active:!1};for(var g_key in hardCodedCategories)if(hardCodedCategories.hasOwnProperty(g_key)){var g_cat=hardCodedCategories[g_key];g_cat.key=g_key,$templateCache.put(g_cat.id,g_cat.template)}return{template:template,scope:{dataconnectorsModel:"=",newLoadModel:"=",existingLoadModel:"=",loadModelAnalyzer:"=",qvDialogContext:"=",qvInternals:"=",continueWithNewConnection:"=",selectFromConnection:"="},controller:["$scope",function($scope){$scope.qvDialogContext.title="quickdataload.selectsource",$scope.qvDialogContext.size="M",$scope.selectedConnectorMain=null,$scope.selectedFileName={name:null},$scope.qvDialogContext.nextDisabled=function(){return null==$scope.selectedConnectorMain&&null==$scope.selectedFileName.name?!0:!1},$scope.views={},$scope.uploadFolderConnection=null,getCategories($scope),clearActiveItem($scope),getConnectors($scope),getExistingConnections($scope),$scope.views.categories.datamarket.show&&getDataMarketData($scope),$scope.categoryClicked=function(event){var localscope=$(event.currentTarget).scope(),category=localscope.category;category.active||setActiveCategory($scope,category.key)},$scope.connectorClicked=function(event){var connector=$(event.currentTarget).scope().connector;setActiveItem($scope,connector.entrypoint.category===CATEGORY_DATAMARKET?CATEGORY_DATAMARKET:CATEGORY_CONNECTORS,connector),$scope.selectedFileName={name:null},$scope.selectedConnectorMain=connector.connectorMain;var input={qvxSelectedEntrypoint:connector.entrypoint,continueWithNewConnection:function(connectionInput){$scope.continueWithNewConnection($scope.selectedConnectorMain,connectionInput)},serverside:$scope.dataconnectorsModel.getConnectionServersideProxy(connector.connectorType)};connector.entrypoint.category===CATEGORY_WEB&&(input.qvDialogContext={customCss:{"max-height":"200px","min-height":"200px"}}),$scope.qvDialogContext.pushStep(connector.entrypoint.initialConnectStep,input)},$scope.connectionClicked=function(event){var connection=$(event.currentTarget).scope().connection;if(setActiveItem($scope,CATEGORY_CONNECTIONS,connection),$scope.selectedFileName={name:null},$scope.selectedConnectorMain=connection.connectorMain,connection.connectorInstance.typeName!==CONNECTOR_TYPE_FOLDER)$scope.selectFromConnection(connection.connectorMain,connection.connectorInstance);else{var entrypointEntry=connection.connectorMain.entrypoints[0];$scope.qvDialogContext.pushStep(entrypointEntry.initialConnectStep,{qvxSelectedEntrypoint:entrypointEntry,dataconnectorInstance:connection.connectorInstance,continueWithNewConnection:function(connectionInput){$scope.continueWithNewConnection(connection.connectorMain,connectionInput)},serverside:$scope.dataconnectorsModel.getConnectionServersideProxy(connection.connectorInstance.connectorType)})}},$scope.$watch("dataconnectorsModel.connections",function(newConnectionList){var length=0;Object.keys($scope.views.existingConnections).forEach(function(key){length+=$scope.views.existingConnections[key].length}),newConnectionList.length!==length&&getExistingConnections($scope)}),$scope.qvDialogContext.next=function(){$scope.selectedFileName.name?$scope.onUploadedFileSelected(stringUtil.removeSurroundingSlashes($scope.selectedFileName.name)):$scope.qvDialogContext.backToTheFuture()},$scope.onUploadedFileSelected=function(fileName){$scope.continueWithNewConnection($scope.uploadFolderConnection.connectorMain,{connectionName:$scope.uploadFolderConnection.connectorInstance.name,singleFileName:fileName,usingExisting:!0})}}]}}),define("scripteditor.services/dataconnector-service",["qvangular","general.views/confirm-dialog/confirm-dialog","core.models/engine","scripteditor.utils/string-util","core.utils/authentication","translator","core.utils/help-url","ng!$window"],function(qvangular,confirmDialog,engine,stringUtil,authentication,translator,helpUrl,$window){function removeFileEnding(input){return input.substr(0,input.lastIndexOf("."))||input}function appendUsernameSuffix(connectionName){var suffix=username?" ("+userDirectory.toLowerCase()+"_"+username.toLowerCase()+")":"";return stringUtil.endsWith(connectionName,suffix)?connectionName:connectionName+suffix}function getArchitectureInfo(machineMode){var architectureInfo={};return"CONNECT_64"===machineMode?architectureInfo.path=64:"CONNECT_32"===machineMode&&(architectureInfo.path=32),architectureInfo.text=translator.get("Common."+architectureInfo.path+"bit"),architectureInfo}function getDataConnectorTypeName(connectorType){return connectorType&&connectorType.displayName?connectorType.displayName:translator.get("scripteditor.dataconnectors.add.error.unknownconnector")}var connectorTypes,username,userDirectory,connectorTypesPromise,connectorTypesMap={};authentication.onDataReceived.then(function(data){"NONE"!==data.userDirectory&&(username=data.userId,userDirectory=data.userDirectory)});var dataconnectorsService={x:function(){},y:""};return dataconnectorsService.appendUsernameSuffix=appendUsernameSuffix,dataconnectorsService.showConnectorErrorMessage=function(connectorType){var _dialog=confirmDialog.confirmAction({header:translator.get("scripteditor.dataconnectors.add.error.title",[getDataConnectorTypeName(connectorType)]),content:"scripteditor.dataconnectors.add.error.message",moreContent:"scripteditor.dataconnectors.add.error.suggestion",confirmButtonTitle:"Go to help",declineButtonTitle:"Common.Close",showDeclineButton:!0});_dialog.resultPromise.then(function(){$window.open(helpUrl.path+"#"+translator.language+"|Troubleshooting_CustomConnector")})},dataconnectorsService.hasConnectPrivileges=function(createPrivileges,type){if(!createPrivileges)return!0;for(var i=0;i<createPrivileges.length;i++)if(createPrivileges[i].resource===type+"connection")return createPrivileges[i].canCreate},dataconnectorsService.getDataconnectorTypes=function(){return connectorTypesPromise||(connectorTypesPromise=engine.global.getCustomConnectors().then(function(result){var fixedProviders=[{provider:"folder",type:"folder",displayName:"scripteditor.dataconnectors.filedirectory",connectDialog:"scripteditor.views/fileconnectdialog/fileconnectdialog",selectDialog:"scripteditor.views/fileselectdialog/fileselectdialog",connectorMain:"assets/hldm/data-connectors/native-file-connector/connector-main",needsConnect:!1,isStandardConnector:!0},{provider:"ODBC",type:"ODBC",displayName:"scripteditor.dataconnectors.ODBC",connectDialog:"scripteditor.views/odbcconnectdialog/odbcconnectdialog",selectDialog:"scripteditor.views/odbcselectdialog/odbcselectdialog",connectorMain:"assets/hldm/data-connectors/native-odbc-connector/connector-main",needsConnect:!0,isStandardConnector:!0},{provider:"OLEDB",type:"OLEDB",displayName:"scripteditor.dataconnectors.OLEDB",connectDialog:"scripteditor.views/oledbconnectdialog/oledbconnectdialog",selectDialog:"scripteditor.views/odbcselectdialog/odbcselectdialog",connectorMain:"assets/hldm/data-connectors/native-oledb-connector/connector-main",needsConnect:!0,isStandardConnector:!0},{provider:"internet",type:"internet",displayName:"scripteditor.dataconnectors.webfile",selectDialog:"scripteditor.views/fileselectdialog/fileselectdialog",connectDialog:"scripteditor.views/webfilechooser/webfilechooser",connectorMain:"assets/hldm/data-connectors/native-webfile-connector/connector-main",needsConnect:!1,isStandardConnector:!0}],customProviders=result.qConnectors.map(function(qCustomconnector){var connector={provider:qCustomconnector.qProvider,type:"custom",name:removeFileEnding(qCustomconnector.qParent),displayName:qCustomconnector.qDisplayName,connectDialog:qCustomconnector.qConnectDialog,selectDialog:qCustomconnector.qSelectDialog,needsConnect:qCustomconnector.qNeedsConnect,architecture:getArchitectureInfo(qCustomconnector.qMachineMode),isStandardConnector:!1};if(!connector.connectDialog){var providerWebroot=connector.name+".webroot",paths={};paths[providerWebroot]="../customdata/"+connector.architecture.path+"/"+connector.name+"/web",require.config({paths:paths}),connector.connectDialog=providerWebroot+"/connectdialog",connector.selectDialog=providerWebroot+"/selectdialog",connector.connectorMain=providerWebroot+"/connector-main",connector.needsConnect=!0}return connector});return connectorTypes=fixedProviders.concat(customProviders),connectorTypes.forEach(function(connectorType){connectorTypesMap[connectorType.provider]=connectorType,connectorTypesMap[connectorType.displayName]=connectorType,connectorType.needsConnect&&(connectorType.title="scripteditor.accordion.draganddrop")}),connectorTypesMap.file=connectorTypesMap.folder,connectorTypes})),connectorTypesPromise},dataconnectorsService.getDataconnectorInstances=function(){return this.getDataconnectorTypes().then(function(){return engine.currentApp.getConnections().then(function(result){var instances=result.qConnections.map(function(qConnector){return{name:qConnector.qName,id:qConnector.qId,type:connectorTypesMap[qConnector.qType],typeName:qConnector.qType,privileges:qConnector.qMeta.privileges,canDelete:!0}});return stringUtil.sortSlightlyMoreNaturallyArray(instances,"name"),instances})})},dataconnectorsService.getConnection=function(id){return engine.currentApp.getConnection(id)},dataconnectorsService.getServersideConnectorProxy=function(connectorType,connectorInstance){return{sendJsonRequest:function(){var method=arguments[0],parameters=Array.prototype.slice.call(arguments,1).map(function(item){return"object"==typeof item?JSON.stringify(item):item}),args={qProvider:connectorType.provider,qMethod:method,qParameters:parameters,qCommand:"JsonRequest",qAppendConnection:connectorInstance?connectorInstance.name:""};return engine.currentApp.sendGenericCommandToCustomConnector(args).then(function(result){var returnValue={},connectorResponse=result||{};if(connectorResponse)try{returnValue=JSON.parse(connectorResponse)}catch(e){window.console.log(e)}return returnValue})},createNewConnectionAPI:function(name,connectionstring,type,username,password){return name=appendUsernameSuffix(name),engine.currentApp.createConnection({qConnection:{qName:name,qConnectionString:connectionstring,qType:type,qUserName:username,qPassword:password}}).then(function(result){return qvangular.$rootScope.$broadcast("connectionListModified"),result})},removeConnection:function(connectionId){return engine.currentApp.deleteConnection(connectionId).then(function(){qvangular.$rootScope.$broadcast("connectionListModified")})},getConnections:function(){return engine.currentApp.getConnections()},getConnection:function(id){return engine.currentApp.getConnection(id).then(function(result){return result},function(){return!1})},modifyConnection:function(id,name,connectionstring,type,overridecredentials,username,password){return name=appendUsernameSuffix(name),engine.currentApp.modifyConnection({qConnectionId:id,qConnection:{qName:name,qConnectionString:connectionstring,qType:type,qUserName:username,qPassword:password},qOverrideCredentials:overridecredentials}).then(function(result){return qvangular.$rootScope.$broadcast("connectionListModified"),result})},createNewRawConnection:function(name,connectionstring,type){return this.createNewConnectionAPI(name,connectionstring,type,"","")},createNewConnection:function(name,connectionstring,username,password){var regex=/provider=([^;]*)/,provider=regex.test(connectionstring)?connectionstring.match(regex)[1]:"";return this.createNewConnectionAPI(name,connectionstring,provider,username,password)},getErrorContent:function(error){var code=error&&!isNaN(error.code)?error.code:0;return translator.get("ErrorCode."+code)}}},dataconnectorsService}),define("scripteditor.utils/unique-connector-name-util",[],function(){"use strict";function defaultName(){return _prefix||"Connector"}function generateName(count){return count?defaultName()+" "+count:defaultName()}function isNameUnique(name){for(var i=0;i<_connections.length;i++)if(_connections[i].qName===name)return!1;return!0}function stripFromIllegalCharacters(name){return name?name.replace(/<|\>|\:|\\|\*|\?|\"|\||\//g,""):null}function getName(prefix,connections){_connections=connections,_prefix=stripFromIllegalCharacters(prefix);var name=generateName();if(_connections)for(var count=_connections.length+1;!isNameUnique(name);)name=generateName(count),count+=1;return name}var _connections,_prefix;return{getName:getName}}),define("scripteditor.services/quick-load-connector-service",["qvangular","scripteditor.utils/string-util","scripteditor.utils/unique-connector-name-util","underscore"],function(qvangular,stringUtil,uniqueConnectorNameUtil,underscore){function createConnector(serversideConnectorProxy,filePath){return serversideConnectorProxy.getConnections().then(function(result){var connectionName=uniqueConnectorNameUtil.getName(stringUtil.lastFolderFromPath(filePath),result.qConnections),folderDirectoryPath=stringUtil.fileDirectoryFromPath(filePath),existingConnection=underscore.find(result.qConnections,function(connection){return connection.qConnectionString===folderDirectoryPath});return existingConnection?qvangular.promise({name:existingConnection.qName,type:existingConnection.qType,id:existingConnection.qId,existedPreviously:!0}):serversideConnectorProxy.createNewRawConnection(connectionName,folderDirectoryPath,"folder").then(function(connection){return{name:connectionName,type:{provider:"folder",displayName:"scripteditor.dataconnectors.filedirectory",connectDialog:"scripteditor.views/fileconnectdialog/fileconnectdialog",selectDialog:"scripteditor.views/fileselectdialog/fileselectdialog",needsConnect:!1,isStandardConnector:!0},typeName:"folder",id:connection.qConnectionId,existedPreviously:!1}})})}function removeConnector(serversideConnectorProxy,name){return serversideConnectorProxy.getConnections().then(function(result){for(var i=0;i<result.qConnections.length;i++)if(result.qConnections[i].qName===name)return serversideConnectorProxy.removeConnection(result.qConnections[i].qId)})}function getLatestConnectorPath(serversideConnectorProxy){return serversideConnectorProxy.getConnections().then(function(result){for(var lastFolderConn,latestTimestamp=0,i=0;i<result.qConnections.length;i++){var conn=result.qConnections[i],modifiedTimestamp=Date.parse(conn.qModifiedDate.replace(" ","T"));"folder"===conn.qType&&modifiedTimestamp>latestTimestamp&&(lastFolderConn=conn,latestTimestamp=modifiedTimestamp)}return lastFolderConn?lastFolderConn.qConnectionString:void 0})}return{createConnector:createConnector,removeConnector:removeConnector,getLatestConnectorPath:getLatestConnectorPath}}),define("text!scripteditor.views/genericselectdialog/genericselectdialog.html",[],function(){return'<div tid="hdlm-generic-select">\r\n	<div ng-class="{\'qui-modalbackground\':!inlineMode, genericSelectDialogBackdrop:!inlineMode}">\r\n		<div ng-class="{\'qui-delayedModal\':!inlineMode, genericSelectDialog:\'true\', genericSelectPanel:inlineMode, \'showScriptPreview-false\':!showScriptPreview, \'showScriptPreview-true\':showScriptPreview, \'isTableListDisabled-true\':isTableListDisabled(), \'isFieldListDisabled-true\':isFieldListDisabled()}" data-selectedowner="{{selectedOwnerName}}">\r\n			<header class="dm-header">\r\n				<h1 ng-show="options.selectFromTitleName" q-translation="scripteditor.dataconnectors.dialog.titlewithname,{{options.selectFromTitleName}}"></h1>\r\n\r\n				<h1 ng-hide="options.selectFromTitleName" q-translation="scripteditor.dataconnectors.dialog.titlewithoutname"></h1>\r\n			</header>\r\n			<main class="dm-main maindialogarea" tabindex="-1">\r\n				<div class="databaseSetting" ng-show="options.databaseVisible">\r\n					<div class="title">{{options.databaseTitle | translate}}</div>\r\n					<qui-select qui-model="selectedDatabase" qui-options="database.name for database in databases" qui-disabled="isDatabaseDisabled()" qui-tid="selectedDatabase">\r\n						<option value="">{{options.databasePlaceholder | translate}}</option>\r\n					</qui-select>\r\n				</div>\r\n				<div class="ownerSetting" data-databaseisvisible="{{options.databaseVisible}}" ng-show="options.ownerVisible">\r\n					<div class="title">{{options.ownerTitle | translate}}</div>\r\n					<qui-select qui-model="selectedOwner" qui-options="owner as owner.label for owner in owners" qui-disabled="isOwnerDisabled() || cancelIsInProgress" qui-tid="selectedOwner">\r\n						<option ng-disabled="options.ownerPlaceholder.length==0" ng-hide="options.ownerPlaceholder.length==0" value="">{{options.ownerPlaceholder | translate}}</option>\r\n					</qui-select>\r\n				</div>\r\n				<div class="top-right" data-databaseisvisible="{{options.databaseVisible}}" ng-show="isSelectionsListShown()">\r\n					<div class="title"><span q-translation="scripteditor.dataconnectors.selectionsMade"> </span></div>\r\n					<div class="dbSelections">\r\n						<table>\r\n							<tr ng-repeat="dbownerentry in getExistingDatabaseSelections()">\r\n								<td class="database">\r\n									<a qva-activate="onDbOwnerEntryClick(dbownerentry)"> {{dbownerentry.database.name}} </a>\r\n								</td>\r\n								<td class="owner">\r\n									<a qva-activate="onDbOwnerEntryClick(dbownerentry)"> {{dbownerentry.owner.name}}</a>\r\n								</td>\r\n								<td class="columnCount">\r\n									<span q-translation="scripteditor.dataconnectors.selection.table|scripteditor.dataconnectors.selection.tables,{{dbownerentry.selectionStats.tableCount}}"></span>\r\n								</td>\r\n								<td class="columnCount">\r\n									<span q-translation="scripteditor.dataconnectors.selection.field|scripteditor.dataconnectors.selection.fields,{{dbownerentry.selectionStats.fieldCount}}"></span>\r\n								</td>\r\n							</tr>\r\n						</table>\r\n					</div>\r\n				</div>\r\n\r\n				<div class="{{options.tablesLocation}}" ng-show="options.tablesVisible">\r\n					<div class="title"> {{options.tablesTitle |translate}}</div>\r\n					<div class="qui-searchfield table-search">\r\n						<span class="magnifying-glass"></span>\r\n						<span q-title-translation="Common.Clear" class="clear-button" ng-show="tableFilter" qva-activate="tableFilter = \'\'"></span>\r\n						<input placeholder="Search" ng-model="tableFilter" q-placeholder="scripteditor.dataconnectors.tables.filter.placeholder" ng-disabled="isTableListDisabled() || cancelIsInProgress" maxlength="128" type="text">\r\n					</div>\r\n					<div class="table-panel borderbox">\r\n						<ul class="table-list borderbox" qva-delegated-click="li#onTableShowClick($event); input#onTableCheckboxClick($event)" vs-repeat>\r\n\r\n							<li ng-repeat="table in tables" class="fieldsChecked-{{table.fieldsChecked}} selected-{{isTableSelected(table)}}" tid="styledTableRow">\r\n								<div class="table-list-container ">\r\n\r\n									<label class="qui-checkboxicon" ng-disabled="isTableListDisabled()">\r\n										<input type="checkbox" ng-hide="options.forceSelectTables" qva-indeterminate="table.indeterminate" ng-checked="table.checked" tid="selectTable" ng-disabled="isTableListDisabled()"/>\r\n\r\n										<div class="check-wrap">\r\n											<span class="check"></span>\r\n										</div>\r\n									</label>\r\n\r\n									<div class="tableName" title="{{table.name}}" tid="tableNameInList">\r\n										<span gsd-highlight-term="tableFilter" gsd-highlight-content="table.name"></span>\r\n									</div>\r\n\r\n									<div class="tableInfo"> {{table.nbrOfCheckedFields}}</div>\r\n								</div>\r\n							</li>\r\n						</ul>\r\n					</div>\r\n				</div>\r\n				<div class="{{options.specialTableSettingsLocation}} special-table-settings-part">\r\n					<div gsd-include-addon-content component="options.specialTableSettings"\r\n						 database-name="selectedDatabaseName"\r\n						 owner-name="selectedOwnerName"\r\n						 table-name="selectedTableName"\r\n						 on-refresh="onSpecialTableSettingsUpdated()">\r\n					</div>\r\n				</div>\r\n				<div class="field-part" ng-class="{\'field-part-with-assocations\': selectedTable.hasAssociations(), \'field-part\':\'true\'}">\r\n					<div class="title" ng-class="{tweakfieldtitlefornotabs: !options.metadataVisible && !(!options.tablesVisible && options.fieldsAreSelectable)}">{{options.fieldsTitle |translate}}</div>\r\n					<div class="field-list-mode-buttons">\r\n						<div class="selectAllContainer" ng-show=\'!options.tablesVisible && options.fieldsAreSelectable\'>\r\n							<label class="qui-checkboxicon">\r\n								<input id="selectAllFields" type=\'checkbox\' indeterminate="selectedTable.indeterminate" ng-disabled="!selectedTable || cancelIsInProgress" ng-checked="selectedTable.checked" tid="selectAllFields" ng-click="onSelectAllFieldsCheckboxClick()">\r\n\r\n								<div class="check-wrap">\r\n									<span class="check"></span>\r\n								</div>\r\n\r\n								<label for=\'selectAllFields\' q-translation="scripteditor.dataconnectors.selectallfields"></label>\r\n								</input>\r\n\r\n							</label>\r\n						</div>\r\n						<button class="qui-button right-button" ng-class="{ \'qui-active\': !dataview }" ng-show="options.metadataVisible" qva-activate="onMetaDataClick()" q-translation="scripteditor.dataconnectors.metadata" ng-disabled="isFieldListDisabled()" tid="selectMetadata"></button>\r\n						<button class="qui-button left-button" ng-class="{ \'qui-active\' : dataview }" ng-if="!options.quickLoadContext || inlineMode" ng-show="options.metadataVisible" qva-activate="onDataPreviewClick()" q-translation="scripteditor.dataconnectors.datapreview" ng-disabled="isFieldListDisabled()" tid="selectPreview">Data</button>\r\n						<!-- options for the fixed width view -->\r\n						<button class="qui-button showfixedwidthguicanvas right-button" ng-class="{\'qui-active\':options.showfixedwidthguicanvas}" qva-activate="options.showfixedwidthguicanvas = true" q-translation="scripteditor.dataconnectors.showfixedwidthguicanvas" tid="selectedFixedWidthGUI"></button>\r\n						<button class="qui-button showfixedwidthguicanvas left-button" ng-class="{\'qui-active\':!options.showfixedwidthguicanvas}" qva-activate="options.showfixedwidthguicanvas = false" q-translation="scripteditor.dataconnectors.datapreview" tid="selectedFixedWidthDataPreview"></button>\r\n\r\n						<div class="after"></div>\r\n					</div>\r\n					<div class="field-list-mode-buttons" ng-hide="options.metadataVisible">\r\n					</div>\r\n					<div class="qui-searchfield field-search">\r\n						<span class="magnifying-glass"></span>\r\n						<span q-title-translation="Common.Clear" class="clear-button" ng-show="fieldFilter" qva-activate="fieldFilter = \'\'"></span>\r\n						<input ng-model="fieldFilter" q-placeholder="scripteditor.dataconnectors.fields.filter.placeholder" ng-disabled="isFieldListDisabled() || cancelIsInProgress" maxlength="128" type="text">\r\n					</div>\r\n					<div class="table-container-panel">\r\n						<div class="table-scroll-area" ng-class="{\'overflow-hidden\': showFieldDataLoader()}">\r\n							<table ng-show="dataview" class="datapreviewgrid" qva-delegated-click="th#onFieldClick($event);td#onFieldClick($event)">\r\n								<tr>\r\n									<th ng-repeat="field in fields" class="selected-{{field.checked}}" tid="styledDataViewFieldName">\r\n										<!--<input id="fieldcheckbox{{$index}}" type="checkbox" ng-checked="field.checked" tid="selectFieldInPreview" ng-show="options.fieldsAreSelectable"/>-->\r\n										<label class="qui-checkboxicon">\r\n											<input type="checkbox" id="fieldcheckbox{{$index}}" class="hidden-checkbox" ng-click="onFieldClick($event)" ng-checked="field.checked" tid="selectFieldInPreview" ng-show="options.fieldsAreSelectable">\r\n\r\n											<div class="check-wrap">\r\n												<span class="check"></span>\r\n											</div>\r\n										</label>\r\n\r\n										<div class="labelcontainer">\r\n											<div gsd-highlight-term="fieldFilter" gsd-highlight-content="field.alias">to be replaced</div>\r\n											<input maxlength="256" ng-model="field.alias" ng-attr-title="{{field.alias}}" qva-model-onblur size="{{field.alias.length+2}}" onclick="event.stopPropagation();" ng-show="options.allowFieldRename" ng-disabled="!options.allowFieldRename" tid=\'fieldAlias\'/>\r\n										</div>\r\n										<span class="icon" ng-show="field.key">\r\n											<i class="icon-primarykey"></i>\r\n										</span>\r\n									</th>\r\n								</tr>\r\n								<!-- Steve: Wired off for now (MS12 - need to revisit)\r\n												<tr ng-if="selectedTable.hasAssociations()">\r\n														<th ng-repeat="field in fields" class="selected-{{field.checked}}">\r\n															<div ng-repeat="associatedTable in field.associationInfo.tables" ng-show="associatedTable.key != selectedTable._loadModelTableEditor.data.key">\r\n																<div class="associated-table-tiny-box" ng-class="{\'selected-associated-table-tiny-box\':field.checked}">\r\n																	&#10149; {{associatedTable.tableName}}\r\n																</div>\r\n															</div>\r\n														</th>\r\n													</tr>\r\n								-->\r\n								<tr ng-repeat="row in preview track by row.rowNbr">\r\n									<td ng-attr-title="{{cell.v}}" ng-repeat="cell in row track by cell.cellNbr">{{cell.v}}&nbsp;</td>\r\n								</tr>\r\n							</table>\r\n							<div class="preview-too-large" ng-show="dataview && previewTooLarge" q-translation="scripteditor.dataconnectors.selection.preview-too-large"></div>\r\n							<table ng-hide="dataview" class="metadatagrid" qva-delegated-click="td.columnname#onFieldClick($event)">\r\n								<tr ng-show="fields.length > 0">\r\n									<th q-translation="scripteditor.dataconnectors.columname"></th>\r\n									<th q-translation="scripteditor.dataconnectors.primarykey"></th>\r\n								</tr>\r\n								<tr ng-repeat="field in fields">\r\n									<td class="columnname selected-{{field.checked}}" tid="styledMetadataFieldName">\r\n\r\n										<label class="qui-checkboxicon" ng-class="{\'qui-disabled\': isOkDisabled() }">\r\n											<input type="checkbox" ng-model="field.checked" tid="selectFieldInMetadata"/>\r\n\r\n											<div class="check-wrap">\r\n												<span class="check"></span>\r\n												<span gsd-highlight="fieldFilter">{{field.alias}}</span>\r\n											</div>\r\n										</label>\r\n									</td>\r\n									<td class="selected-{{field.checked}}" q-translation="{{field.key ? \'Common.Yes\' : \'Common.No\'}}"></td>\r\n								</tr>\r\n							</table>\r\n							<div class="field-loader" ng-show="showFieldDataLoader()">\r\n								<div class="qv-loader"></div>\r\n							</div>\r\n						</div>\r\n					</div>\r\n				</div>\r\n\r\n				<div class="scriptpreviewcontainer" ng-show="showScriptPreview">\r\n					<pre class="scriptpreview" ng-disabled="cancelIsInProgress">{{getScriptPreview()}}</pre>\r\n				</div>\r\n				<div id="fixedwidthguicontainer" class="fixedwidthguicontainer" ng-show="options.showfixedwidthguicanvas">\r\n					<!-- place holder for the fixed width gui canvas -->\r\n				</div>\r\n				<button class="qui-button scriptpreviewtoggle" ng-if="!options.quickLoadContext && !inlineMode" ng-class="{ \'qui-active\': showScriptPreview }" ng-disabled="cancelIsInProgress" qva-activate="onToggleScriptPreview()" q-translation="{{showScriptPreview ? \'scripteditor.dataconnectors.hidescriptpreview\' : \'scripteditor.dataconnectors.showscriptpreview\'}}"></button>\r\n			</main>\r\n			<footer class="dm-footer footer">\r\n				<div class="dialog-buttons">\r\n					<button class="qui-button" qva-activate="$event.preventDefault(); onOK()" ng-hide="inlineMode || options.quickLoadContext" q-translation="{{options.quickLoadContext? \'scripteditor.dataconnectors.quickdataimport\' : \'scripteditor.dataconnectors.addToScript\'}}" ng-disabled="isAddScriptButtonDisabled()" tid="closeGenericSelectDialog"></button>\r\n					<button class="qui-button" qva-activate="$event.preventDefault(); onCancel()" ng-hide="inlineMode" ng-disabled="cancelIsInProgress" qqva-focus="true" q-translation="Common.Cancel"></button>\r\n\r\n					<!-- beg of checkbox for load statement -->\r\n					<label class="qui-checkboxicon" ng-show="options.precedingLoadVisible && !inlineMode">\r\n						<input type="checkbox" tid="precedingLoad" ng-model="precedingLoad">\r\n\r\n						<div class="check-wrap">\r\n							<span class="check"></span>\r\n							<span class="check-text" q-translation="scripteditor.dataconnectors.precedingload">#precedingload#</span>\r\n						</div>\r\n					</label>\r\n					<!-- end of checkbox for load statement -->\r\n				</div>\r\n			</footer>\r\n		</div>\r\n	</div>\r\n</div>\r\n';
}),define("assets/scripteditor/services/fixedwidth/fixedwidth-gui-selector-service",["jquery","underscore","translator"],function($,underscore,translator){function FixedWidthGUIController(newOnChangeListener){function createCanvas(callbackFunction){var $canvas=$("#"+FIXED_WIDTH_GUI_CANVAS_ID);if(0===text.length)return void $canvas.hide();var height=25*(text.length+1),width=0;for(var r in text){var row=text[r];width=Math.max(width,row.length)}width=10*width+50,width=Math.max(MIN_CANVAS_WIDTH,width);var html='<canvas id="'+FIXED_WIDTH_GUI_CANVAS_ID+'" width="'+width+'" height="'+height+'"></canvas>';$("#"+FIXED_WIDTH_GUI_CANVAS_CONTAINER_ID).html(html).ready(function(){setTimeout(function(){canvas=document.getElementById(FIXED_WIDTH_GUI_CANVAS_ID),context=canvas.getContext("2d"),context.font="12px monospace",canvas.addEventListener("mousemove",onMouseMove),canvas.addEventListener("click",onClick),canvas.addEventListener("mouseout",onMouseOut),$canvas.show(),callbackFunction&&callbackFunction()},0)})}function onMouseMove(event){render(event)}function onClick(event){var mousePos=getMousePosition(canvas,event),charIndex=pixelToChar(mousePos.x);updateDelimiters(charIndex),1!==charIndex&&(onChangeListener&&onChangeListener(delimiters),lastMouseEvent=event,render(lastMouseEvent))}function onMouseOut(){lastMouseEvent=void 0,render()}function updateDelimiters(charIndex){var newDelimiters=[],removed=!1;for(var i in delimiters)delimiters[i]===charIndex?removed=!0:newDelimiters.push(delimiters[i]);removed||newDelimiters.push(charIndex),0===newDelimiters.length?delimiters=[1]:(newDelimiters.sort(function(a,b){return a-b}),delimiters=newDelimiters)}function render(mouseEvent){if(context){context.clearRect(0,0,canvas.width,canvas.height),renderText();for(var i in delimiters){var delimiterIndex=delimiters[i],x=charToPixel(delimiterIndex);drawVerticalLine(x,COLOR_EXISTING)}if(mouseEvent){var mousePosition=getMousePosition(canvas,mouseEvent),charIndex=pixelToChar(mousePosition.x),addDelimiter=!underscore.contains(delimiters,charIndex);renderIndexInfoBox(addDelimiter,charIndex,mousePosition.x,mousePosition.y,canvas.width);var pixelX=charToPixel(charIndex);addDelimiter?drawVerticalLine(pixelX,COLOR_MOUSE_CURSOR):drawVerticalLine(pixelX,COLOR_CONFLICT)}}}function pixelToChar(pixel){return Math.round(pixel/FONT_WIDTH)+1}function charToPixel(char){var x=(char-1)*FONT_WIDTH;return x=Math.min(x,canvas.width)}function renderText(){context.fillStyle=COLOR_TEXT;for(var r in text)for(var row=text[r],c=0;c<row.length;c++){var char=row.charAt(c);context.fillText(char,2+10*c,TEXT_OFFSET_Y+25*r)}}function renderIndexInfoBox(addDelimiter,charIndex,mouseX,mouseY,canvasWidth){var AVERAGE_INFO_BOX_LENGTH=330,distanceFromRight=canvasWidth-mouseX;AVERAGE_INFO_BOX_LENGTH>distanceFromRight&&(mouseX-=AVERAGE_INFO_BOX_LENGTH,0>mouseX&&(mouseX=-5));var text=translator.get("scripteditor.fixedwidth.delimiter."+(addDelimiter?"add":"remove"),charIndex);context.beginPath(),context.rect(OFFSET_X_INFOBOX+mouseX,OFFSET_Y_INFOBOX+mouseY,20+7*text.length,30),context.fillStyle="white",context.fill(),context.lineWidth=1,context.strokeStyle=addDelimiter?COLOR_MOUSE_CURSOR:COLOR_CONFLICT,context.stroke(),context.fillStyle=addDelimiter?COLOR_MOUSE_CURSOR:COLOR_CONFLICT,context.fillText(text,OFFSET_X_INFOBOX+10+mouseX,OFFSET_Y_INFOBOX+20+mouseY)}function getMousePosition(canvas,event){var rect=canvas.getBoundingClientRect();return{x:event.clientX-rect.left,y:event.clientY-rect.top}}function drawVerticalLine(x,color){context.setLineDash&&context.setLineDash([6,3]),context.beginPath(),context.moveTo(x+.5,0),context.lineTo(x+.5,canvas.height),context.strokeStyle=color,context.lineWidth=1,context.stroke()}var canvas,context,lastMouseEvent,FIXED_WIDTH_GUI_CANVAS_CONTAINER_ID="fixedwidthguicontainer",FIXED_WIDTH_GUI_CANVAS_ID="fixedwidthguicanvas",FONT_WIDTH=10,TEXT_OFFSET_Y=20,OFFSET_X_INFOBOX=20,OFFSET_Y_INFOBOX=0,MIN_CANVAS_WIDTH=325,COLOR_TEXT="#000000",COLOR_MOUSE_CURSOR="#009900",COLOR_EXISTING="#9B9B9B",COLOR_CONFLICT="#FF0000",text=[],delimiters=[],onChangeListener=newOnChangeListener;createCanvas(),this.setText=function(newText){newText.length>0&&(text=newText,createCanvas(function(){render(lastMouseEvent)}))},this.setDelimiters=function(newDelimiters){if("[object Array]"!==Object.prototype.toString.call(newDelimiters))throw new Error('Delimiters is not an array, but a "'+typeof newDelimiters+'":'+newDelimiters);for(var i in newDelimiters){var delimiter=newDelimiters[i];if(!underscore.isNumber(delimiter))throw new Error(delimiter+" is not a Number.")}delimiters=newDelimiters,render(lastMouseEvent)}}function invoke(newOnChangeListener){return new FixedWidthGUIController(newOnChangeListener)}return{invoke:invoke}}),define("scripteditor.views/genericselectdialog/genericselectdialog-directives",["qvangular","encoder"],function(qvangular,encoder){qvangular.componentDirective("gsdIncludeAddonContent",{onRefresh:"&",databaseName:"=",ownerName:"=",tableName:"="}),qvangular.directive("gsdHighlightTerm",["$parse",function(){return{scope:{gsdHighlightTerm:"=",gsdHighlightContent:"="},link:function(scope,element){function update(){var text=scope.gsdHighlightContent,highlight=scope.gsdHighlightTerm;if(element.text(scope.gsdHighlightContent),highlight){highlight.indexOf(":")>0&&(highlight=highlight.substring(highlight.indexOf(":")+1));var istart=text.toLowerCase().indexOf(highlight.toLowerCase()),iend=istart+highlight.length;if(istart>=0){var highlightedText="<span>"+encoder.encodeForHTML(text.substring(0,istart))+"</span><span class='searchhighlight'>"+encoder.encodeForHTML(text.substring(istart,iend))+"</span><span>"+encoder.encodeForHTML(text.substring(iend))+"</span>";element.html(highlightedText)}}}scope.$watch("gsdHighlightTerm",update),scope.$watch("gsdHighlightContent",update)}}}])}),define("scripteditor.views/genericselectdialog/genericselectdialog",["jquery","text!scripteditor.views/genericselectdialog/genericselectdialog.html","assets/scripteditor/services/fixedwidth/fixedwidth-gui-selector-service","scripteditor.services/local-storage-service","core.models/engine","general.views/confirm-dialog/confirm-dialog","core.models/app","general.controllers/route-controller","scripteditor.views/genericselectdialog/genericselectdialog-directives"],function($,template,fixedWidthGUISelectorService,localStorageService,engine,confirmDialog,App,RouteController){var MAXIMUM_NUMBER_OF_FIELDS_TO_PREVIEW=100,MAXIMUM_NUMBER_OF_FIELDS_TO_CAP_PREVIEW=50,CAPPED_NUMBER_OF_ROWS_IN_PREVIEW=10;return{template:template,scope:{dataSelectionModel:"=",associationsModel:"=",scriptGenerator:"=",scriptEditorProxy:"=",options:"=",dataconnectorInstance:"=",inlineMode:"=",qvDialogContext:"="},controller:["$scope","$timeout","dataSelectionModel","scriptGenerator","scriptEditorProxy","input","$element",function($scope,$timeout,dataSelectionModel,scriptGenerator,scriptEditorProxy,input,$element){function handleDatabaseError(){showSelectionBrokenMessage("quickdataload.EditSelections.DatabaseNoLongerExistsHeader","quickdataload.EditSelections.DatabaseNoLongerExistsContent",$scope.options.tableModelToEdit.data.databaseName)}function handleOwnerError(){showSelectionBrokenMessage("quickdataload.EditSelections.OwnerNoLongerExistsHeader","quickdataload.EditSelections.OwnerNoLongerExistsContent",$scope.options.tableModelToEdit.data.ownerName)}function handleTableError(){showSelectionBrokenMessage("quickdataload.EditSelections.TableNoLongerExistsHeader","quickdataload.EditSelections.TableNoLongerExistsContent",$scope.options.tableModelToEdit.data.tableName)}function showSelectionBrokenMessage(header,content,missingItemName){confirmDialog.confirmAction({header:header,headerParameter:missingItemName,content:content,showDeclineButton:!1,confirmButtonTitle:"Common.Close"}).resultPromise.then(function(){$scope.qvDialogContext.close()})}function getFirstSelectedTableIndex(){for(var i=0;i<$scope.tables.length;i++)if($scope.tables[i].checked)return i;return-1}function loadTableContent(forceReload){var selectedTableAtClick=$scope.selectedTable;allFields=[],allPreview=[],$scope.fields=[],$scope.preview=[],$scope.fieldFilter="",$scope.previewTooLarge=!1,$scope.capNumberOfRows=!1,$scope.loadingFields++,$timeout(function(){$scope.selectedTable.getFields(forceReload).then(function(fields){selectedTableAtClick===$scope.selectedTable?($scope.loadingFields=0,allFields=fields,computeFieldListContent(),$scope.selectedTable.checked===!0&&$scope.selectedTable.setAllSelected(!0),$scope.dataview&&(fields.length<=MAXIMUM_NUMBER_OF_FIELDS_TO_PREVIEW?(fields.length>=MAXIMUM_NUMBER_OF_FIELDS_TO_CAP_PREVIEW&&($scope.capNumberOfRows=!0),loadDataPreview()):$scope.previewTooLarge=!0)):$scope.loadingFields>0&&$scope.loadingFields--})})}function loadAssociationsPreview(selectedTable,preview){$scope.inline&&selectedTable.getAssociationsPreview(preview).then(function(result){$scope.associationsPreview=result})}function loadDataPreview(){function populatePreview(preview){$scope.dataview&&selectedTableAtClick===$scope.selectedTable?(allPreview=preview,computePreviewContent(),$scope.loadingPreview=0):$scope.loadingPreview>0&&$scope.loadingPreview--}var selectedTableAtClick=$scope.selectedTable;$scope.loadingPreview++,$scope.selectedTable.getDataPreview().then(function(preview){populatePreview(preview),loadAssociationsPreview($scope.selectedTable,preview)},function(){populatePreview([])})}function computeTableListContent(){$scope.selectedDatabase&&$scope.selectedOwner?$scope.tables=filterTables(allTables,$scope.tableFilter):$scope.tables=[]}function computeFieldListContent(){$scope.selectedDatabase&&$scope.selectedOwner&&$scope.selectedTable?$scope.fields=filterFields(allFields,$scope.fieldFilter):$scope.fields=[]}function convertCellValuesFromStringsIntoNamedParameters(rawPreview){var result=[],i=0;for(var row in rawPreview){if($scope.capNumberOfRows&&++i>=CAPPED_NUMBER_OF_ROWS_IN_PREVIEW)break;result[row]=[],result[row].rowNbr=row;for(var cell in rawPreview[row].qValues)result[row][cell]={v:rawPreview[row].qValues[cell],cellNbr:cell}}return result}function computePreviewContent(){var filteredPreview;filteredPreview=allPreview&&$scope.fieldFilter&&$scope.fields?filterPreview($scope.fields,allPreview):allPreview,$scope.preview=convertCellValuesFromStringsIntoNamedParameters(filteredPreview),sendToFixedWidthCanvas(allPreview)}function sendToFixedWidthCanvas(allPreview){var text=[],delimieters=[];for(var c in allPreview){for(var rowAsText="",row=allPreview[c].qValues,r=0;r<row.length;r++){var cell=row[r],value=cell;rowAsText+=value,delimieters.push(rowAsText.length)}text.push(rowAsText)}fixedWidthGUIController.setText(text)}function computeFieldAndPreviewContent(){computeFieldListContent(),computePreviewContent()}function filterTables(list,filter){if(list&&list.length>0){if(filter){if(filter.indexOf(":")>0){var filterParts=filter.split(":"),typeFilter=filterParts[0].toLowerCase(),nameFilter=filterParts[1].toLowerCase();return list.filter(function(item){return filterMatch(item.name,nameFilter)&&0===(item.type||"").toLowerCase().indexOf(typeFilter)})}return list.filter(function(item){return filterMatch(item.name,filter)||item.alias&&filterMatch(item.alias,filter)})}return list}return[]}function hasSelectedTable(tables){for(var i=0;i<tables.length;i++)if(tables[i].checked)return!0;return!1}function filterFields(list,filter){return list&&filter?list.filter(function(item){return filterMatch(item.name,filter)||item.aliasRealValue&&filterMatch(item.aliasRealValue,filter)}):list}function filterPreview(fieldsToShow,previewToFilter){for(var newRows=[],rowNbr=0;rowNbr<previewToFilter.length;rowNbr++){var newRow=[];for(var i in fieldsToShow){var originalIndex=fieldsToShow[i].index;newRow.push(previewToFilter[rowNbr].qValues[originalIndex])}newRows.push({qValues:newRow})}return newRows}function filterMatch(value,filter){return value.toLowerCase().indexOf(filter.toLowerCase())>=0}function getBooleanLocalSetting(id,defaultValue){var val=localStorageService.get("scripteditor.genericselectdialog."+id,{value:defaultValue});return"true"===val.value?!0:"false"===val.value?!1:val.value}function setLocalSetting(id,value,timeToLive){localStorageService.set("scripteditor.genericselectdialog."+id,{value:value},timeToLive)}function scrollToTableIndex(index){$scope.$$postDigest(function(){var tableEl=$element.find(".table-list"),firstEl=tableEl.find("li");firstEl.length>0&&index>=0&&(tableEl[0].scrollTop=firstEl[0].offsetHeight*index)})}var allPreview,fixedWidthGUIController,fixedWidthGUIControllerOnChangeListener,allTables=[],allFields=[];$scope.enableProfiling=!1,App.get().then(function(app){app.getLayout().then(function(layout){$scope.enableProfiling=!(layout.qIsOpenedWithoutData||RouteController.isSuffixInUse("noData"))})}),$scope.initializeGUI=function(){var attrname;fixedWidthGUIController=fixedWidthGUISelectorService.invoke(function(delimiters){fixedWidthGUIControllerOnChangeListener&&fixedWidthGUIControllerOnChangeListener(delimiters)}),$scope.options={},$scope.options.databaseTitle="scripteditor.dataconnectors.database",$scope.options.databasePlaceholder="scripteditor.dataconnectors.selectdatabase",$scope.options.ownerPlaceholder="scripteditor.dataconnectors.selectowner",$scope.options.ownerTitle="scripteditor.dataconnectors.owner",$scope.options.tablesTitle="scripteditor.dataconnectors.tables",$scope.options.fieldsTitle="Common.Fields",$scope.options.disableOwnerIfOnlyOneChoice=!1,$scope.options.tablesLocation="lower-left",$scope.options.specialTableSettingsLocation="none",$scope.options.databaseVisible=!0,$scope.options.showfixedwidthguicanvas=!1,$scope.options.ownerVisible=!0,$scope.options.tablesVisible=!0,$scope.options.precedingLoadVisible=!0,$scope.options.fieldsAreSelectable=!0,$scope.options.allowFieldRename=!0,$scope.options.showSelectionsSummary=!$scope.inlineMode,$scope.options.metadataVisible=!0,$scope.options.selectFromTitleName="",$scope.options.forceSelectTables=!1,$scope.options.quickLoadContext=!1;for(attrname in input.options)input.options.hasOwnProperty(attrname)&&($scope.options[attrname]=input.options[attrname]);$scope.specialTableSettingsOk=!0,$scope.databases=[],$scope.owners=[],$scope.tables=[],$scope.fields=[],$scope.preview=[],$scope.options.metadataVisible?$scope.dataview=getBooleanLocalSetting("dataview",!0):$scope.dataview=!0,$scope.selectedDatabase=void 0,$scope.selectedDatabaseName=void 0,$scope.selectedOwner=void 0,$scope.selectedOwnerName=void 0,$scope.selectedTable=void 0,$scope.selectedTableName=void 0,$scope.tableFilter="",$scope.fieldFilter="",$scope.showScriptPreview=$scope.options.quickLoadContext||$scope.inlineMode?!1:getBooleanLocalSetting("showScriptPreview",!0),$scope.showTables=getBooleanLocalSetting("showTables",!1),$scope.showViews=getBooleanLocalSetting("showViews",!1),$scope.precedingLoad=getBooleanLocalSetting("precedingLoad",!0),$scope.loadingFields=0,$scope.loadingPreview=0,$scope.gettingDatabases=!0,$scope.gettingOwners=!1,$scope.gettingDatasourceInfo=!1,$scope.gettingTables=!1,dataSelectionModel.getDatabases().then(function(databases){if($scope.databases=databases,$scope.gettingDatabases=!1,!$scope.selectedDatabase)if($scope.options.tableModelToEdit){var filteredDatabases=$scope.databases.filter(function(element){return element.name===$scope.options.tableModelToEdit.data.databaseName});filteredDatabases.length>0?$scope.selectedDatabase=filteredDatabases[0]:handleDatabaseError()}else $scope.selectedDatabase=dataSelectionModel.getDefaultDatabase();$scope.gettingDatasourceInfo=!0,dataSelectionModel.getDatasourceInfo().then(function(datasourceInfo){$scope.gettingDatasourceInfo=!1,$scope.datasourceInfo=datasourceInfo})},function(error){error.isHandled=!0,handleDatabaseError()})},$scope.onFixedWidthDelimitersInputChange=function(delimiters){if(delimiters){if("number"==typeof delimiters)delimiters=[delimiters];else if("string"==typeof delimiters){delimiters=delimiters.split(",");for(var i in delimiters)delimiters[i]=Number(delimiters[i])}fixedWidthGUIController.setDelimiters(delimiters)}},$scope.setFixedWidthGUIControllerOnChangeListener=function(listener){fixedWidthGUIControllerOnChangeListener=listener},$scope.onSpecialTableSettingsUpdated=function(){$scope.selectedTableName&&0===$scope.loadingFields&&0===$scope.loadingPreview&&loadTableContent(!0)},$scope.$watch("selectedDatabase",function(){var oldOwner=$scope.selectedOwner,selectedDatabaseAtClick=$scope.selectedDatabase;$scope.selectedOwner=void 0,$scope.selectedTableName=void 0,allTables=[],allFields=[],allPreview=[],$scope.owners=[],$scope.tables=[],$scope.fields=[],$scope.preview=[],$scope.tableFilter="",$scope.fieldFilter="",$scope.selectedDatabase?($scope.selectedDatabaseName=$scope.selectedDatabase.name,$scope.gettingOwners=!0,$scope.selectedDatabase.getOwners().then(function(owners){if($scope.gettingOwners=!1,selectedDatabaseAtClick===$scope.selectedDatabase)if($scope.owners=owners,$scope.options.tableModelToEdit){var filteredOwners=$scope.owners.filter(function(element){return element.name===$scope.options.tableModelToEdit.data.ownerName});filteredOwners.length>0?$scope.selectedOwner=filteredOwners[0]:handleOwnerError()}else $scope.selectedOwner=$scope.selectedDatabase.getDefaultOwner(oldOwner)},function(error){error.isHandled=!0,handleOwnerError()})):$scope.selectedDatabaseName=void 0}),$scope.$watch("selectedOwner",function(newSelectedOwner,oldSelectedOwner){oldSelectedOwner&&oldSelectedOwner.name&&0===oldSelectedOwner.name.indexOf("TYPE9_")&&oldSelectedOwner.setAllTablesSelected(!1),newSelectedOwner&&newSelectedOwner.name&&0===newSelectedOwner.name.indexOf("TYPE9_")&&($scope.options.tablesVisible=input.options.fileTypesWithTables.indexOf(newSelectedOwner.name)>-1);var selectedOwnerAtClick=$scope.selectedOwner;allTables=[],allFields=[],allPreview=[],$scope.tables=[],$scope.fields=[],$scope.preview=[],$scope.selectedTable=void 0,$scope.selectedTableName=void 0,$scope.tableFilter="",$scope.fieldFilter="",$scope.selectedOwner?($scope.selectedOwnerName=$scope.selectedOwner.name,$scope.gettingTables=!0,$scope.selectedOwner.getTables().then(function(tables){if($scope.gettingTables=!1,selectedOwnerAtClick===$scope.selectedOwner)if(allTables=tables,computeTableListContent(),$scope.options.tableModelToEdit){var filteredTables=tables.filter(function(element){return element.name===$scope.options.tableModelToEdit.data.tableName});filteredTables.length>0?(scrollToTableIndex(tables.indexOf(filteredTables[0])),$scope.onTableShow(filteredTables[0])):handleTableError()}else{$scope.options.forceSelectTables&&$scope.selectedOwner.setAllTablesSelected(!0),$scope.options.forceSelectFirstTable&&tables.length>0&&!hasSelectedTable(tables)&&tables[0].setAllSelected(!0),$scope.selectedOwner.getDefaultTable()&&$scope.onTableShow($scope.selectedOwner.getDefaultTable()),scrollToTableIndex(getFirstSelectedTableIndex());var tableIndex,table;for(tableIndex in $scope.selectedOwner.tables)if(table=$scope.selectedOwner.tables[tableIndex],table.checked||table.fieldsChecked){$scope.onTableShow(table);break}}},function(error){error.isHandled=!0,handleTableError()})):$scope.selectedOwnerName=void 0}),$scope.$watch("showTables",function(value){"undefined"!=typeof value&&setLocalSetting("showTables",value)}),$scope.$watch("showViews",function(value){"undefined"!=typeof value&&setLocalSetting("showViews",value)}),$scope.$watch("precedingLoad",function(value){"undefined"!=typeof value&&setLocalSetting("precedingLoad",value)}),$scope.$watch("fieldFilter",function(){computeFieldAndPreviewContent()}),$scope.$watch("tableFilter",function(){computeTableListContent()}),$scope.onTableShowClick=function($event){var table=$($event.target).scope().table;$scope.onTableShow(table)},$scope.onTableShow=function(table){table&&table!==$scope.selectedTable&&($scope.selectedTable=table,$scope.selectedTableName=table.name,loadTableContent())},$scope.onDbOwnerEntryClick=function(dbownerentry){$scope.selectedDatabase=dbownerentry.database,$scope.selectedOwner=dbownerentry.owner},$scope.onTableCheckboxClick=function($event){var table=$($event.target).scope().table;table.changeAllFieldsSelected()},$scope.onSelectAllFieldsCheckboxClick=function(){$scope.selectedTable.changeAllFieldsSelected()},$scope.onFieldClick=function($event){var $index=$($event.target).scope().$index,field=$scope.fields[$index];$scope.options.fieldsAreSelectable&&field.changeFieldSelection()},$scope.onDataPreviewClick=function(){$scope.dataview=!0,setLocalSetting("dataview",$scope.dataview),$scope.preview&&0!==$scope.preview.length||(allFields.length<=MAXIMUM_NUMBER_OF_FIELDS_TO_PREVIEW?(allFields.length>=MAXIMUM_NUMBER_OF_FIELDS_TO_CAP_PREVIEW&&($scope.capNumberOfRows=!0),loadDataPreview()):$scope.previewTooLarge=!0)},$scope.onMetaDataClick=function(){$scope.dataview=!1,setLocalSetting("dataview",$scope.dataview)},$scope.onToggleScriptPreview=function(){$scope.showScriptPreview=!$scope.showScriptPreview,setLocalSetting("showScriptPreview",$scope.showScriptPreview)},$scope.onOK=function(){if($scope.qvDialogContext&&$scope.qvDialogContext.finish)$scope.qvDialogContext.finish();else{var precedingLoad=$scope.precedingLoad&&$scope.options.precedingLoadVisible;scriptEditorProxy.insertCode(scriptGenerator.generateScriptForSelections(dataSelectionModel,$scope.datasourceInfo,precedingLoad,!$scope.options.fieldsAreSelectable),$scope.dataconnectorInstance||$scope.options.dataconnectorInstance,$scope.options.selectFromTitleName),$scope.destroyComponent()}},$scope.onCancel=function(){$scope.qvDialogContext&&$scope.qvDialogContext.cancel?$scope.qvDialogContext.cancel():($scope.cancelIsInProgress=!0,engine.global.abortAll().then(function(){$scope.destroyComponent()}))},$scope.qvDialogContext&&($scope.qvDialogContext.nextDisabled=function(){return!$scope.enableProfiling||$scope.isAddScriptButtonDisabled()},$scope.qvDialogContext.finishDisabled=function(){return $scope.isAddScriptButtonDisabled()}),$scope.onContinue=function(){$scope.next()},$scope.onBack=function(){engine.global.abortAll().then(function(){$scope.back()})},$scope.getScriptPreview=function(){var precedingLoad=$scope.precedingLoad&&$scope.options.precedingLoadVisible,script=scriptGenerator.generateScriptForSelections(dataSelectionModel,$scope.datasourceInfo,precedingLoad,!$scope.options.fieldsAreSelectable);return script},$scope.isTableSelected=function(table){return table===$scope.selectedTable},$scope.showFieldDataLoader=function(){return $scope.isLoadingFields()||$scope.loadingPreview>0},$scope.isLoadingFields=function(){return $scope.gettingDatabases||$scope.gettingOwners||$scope.gettingDatasourceInfo||$scope.gettingTables||$scope.loadingFields>0},$scope.isDatabaseDisabled=function(){return!$scope.databases||0===$scope.databases.length||1===$scope.databases.length&&!$scope.databases[0].name},$scope.isOwnerDisabled=function(){return!$scope.owners||0===$scope.owners.length||1===$scope.owners.length&&(!$scope.owners[0].name||$scope.options.disableOwnerIfOnlyOneChoice)},$scope.isTableListDisabled=function(){return!allTables||0===allTables.length},$scope.isFieldListDisabled=function(){return!allFields||0===allFields.length},$scope.isAddScriptButtonDisabled=function(){return!(dataSelectionModel.isAtLeastOneFieldSelected()||$scope.options.tableModelToEdit)||$scope.showFieldDataLoader()||!$scope.datasourceInfo||!$scope.specialTableSettingsOk},$scope.isSelectionsListShown=function(){return $scope.options.showSelectionsSummary&&dataSelectionModel.isAtLeastOneFieldSelected()},$scope.getExistingDatabaseSelections=function(){return dataSelectionModel.getFlatListOfSelectedDatabaseOwnerCombinations()},$scope.initializeGUI()}]}}),define("scripteditor.services/data-selection-model",["qvangular","translator","core.utils/deferred"],function(qvangular,translator){function DataSelectionModel(contentProvider,dataconnectionLoadModel){function DatabaseSelectionModel(name,isDefault,qOwners){this.name=name,this.isDefault=isDefault,qOwners&&qOwners.length&&(this.populateOwners(qOwners),this.ownersPromise=qvangular.promise(this.owners))}function OwnerSelectionModel(databaseName,ownerName,isDefault,qTables){this.databaseName=databaseName,this.name=ownerName,this.label=ownerName&&0===ownerName.indexOf("TYPE9_")?translator.get(("scripteditor.dataconnectors.selection.owner."+ownerName).toLowerCase()):ownerName,this.isDefault=isDefault,qTables&&qTables.length&&(this.populateTables(qTables),this.tablesPromise=qvangular.promise(this.tables))}function TableSelectionModel(databaseName,ownerName,tableName,isDefault,qFields){this.databaseName=databaseName,this.ownerName=ownerName,this.name=tableName,this.fields=[],this.checked=!1,this.isDefault=isDefault,this.indeterminate=!1,this.fieldsChecked=!1,this.nbrOfCheckedFields=0;var tableEditor=this.getLoadModelTableModelIfExists();if(tableEditor){var fieldsCount=tableEditor.fieldsCount();this.nbrOfCheckedFields=tableEditor.selectedFieldsCount(),this.indeterminate=fieldsCount>this.nbrOfCheckedFields&&this.nbrOfCheckedFields>0,this.checked=fieldsCount>0&&fieldsCount===this.nbrOfCheckedFields,this.fieldsChecked=this.nbrOfCheckedFields>0}qFields&&qFields.length&&(this.populateFieldList(qFields),this.fieldsPromise=qvangular.promise(this.fields))}function FieldSelectionModel(table,name,key,originalFieldName){this.table=table,this.name=name,this.checked=!1,this.key=key,this.originalFieldName=originalFieldName}function getSelectionsStatsForOwner(owner){var fields,tableSelected,tables=owner.tables,tableCount=0,fieldCount=0;if(tables)for(var k=0;k<tables.length;k++){if(tableSelected=!1,fields=tables[k].fields)for(var m=0;m<fields.length;m++)fields[m].checked&&(tableSelected=!0,fieldCount++);tableSelected&&tableCount++}return tableCount>0?{tableCount:tableCount,fieldCount:fieldCount}:void 0}var datamodel=this,flatListOfSelections=[];this.recalculate=function(){flatListOfSelections=this.computeFlatListOfSelectedDatabaseOwnerCombinations()},this.getDatasourceInfo=function(){var self=this;return self.infoPromise=self.infoPromise||when(contentProvider.getConnectionInfo()).then(function(info){return self.datasourceInfo=info,dataconnectionLoadModel&&dataconnectionLoadModel.setMetadataModelForConnection(info),info}),self.infoPromise},this.getDatabases=function(){var self=this;return self.databasesPromise=self.databasesPromise||when(contentProvider.getDatabases()).then(function(qDatabases){return qDatabases&&0!==qDatabases.length?self.databases=qDatabases.map(function(qDatabase){return new DatabaseSelectionModel(qDatabase.qName,qDatabase.qIsDefault,qDatabase.qOwners)}):self.databases=[new DatabaseSelectionModel("",!0,void 0)],self.databases}),self.databasesPromise},this.getDefaultDatabase=function(){var i;if(1===this.databases.length)return this.databases[0];if(!this.selectedDatabase)for(i=0;i<this.databases.length;i++)if(this.databases[i].isDefault)return this.databases[i];return void 0},DatabaseSelectionModel.prototype.populateOwners=function(qOwners){var self=this;return qOwners&&0!==qOwners.length?self.owners=qOwners.map(function(qOwner){return new OwnerSelectionModel(self.name,qOwner.qName,qOwner.qIsDefault,qOwner.qTables)}):self.owners=[new OwnerSelectionModel(self.name,"",!0,void 0)],self.owners},DatabaseSelectionModel.prototype.getOwners=function(){var self=this;return this.ownersPromise=this.ownersPromise||when(contentProvider.getOwners(this.name)).then(function(qOwners){return self.populateOwners(qOwners)}),self.ownersPromise},DatabaseSelectionModel.prototype.getDefaultOwner=function(oldOwner){var i;if(oldOwner)for(i=0;i<this.owners.length;i++)if(this.owners[i].name===oldOwner.name)return this.owners[i];if(1===this.owners.length)return this.owners[0];for(i=0;i<this.owners.length;i++)if(this.owners[i].isDefault)return this.owners[i];return void 0},OwnerSelectionModel.prototype.populateTables=function(qTables){var self=this;return qTables?self.tables=qTables.map(function(qTable){return new TableSelectionModel(self.databaseName,self.name,qTable.qName,qTable.qIsDefault,qTable.qFields)}):self.tables=[],self.tables},OwnerSelectionModel.prototype.getTables=function(){var self=this;return this.tablesPromise=this.tablesPromise||when(contentProvider.getTables(this.databaseName,this.name)).then(function(tables){return self.populateTables(tables)}),this.tablesPromise},OwnerSelectionModel.prototype.setAllTablesSelected=function(newValue){this.getTables().then(function(tables){var i;if(tables)for(i=0;i<tables.length;i++)tables[i].setAllSelected(newValue)})},OwnerSelectionModel.prototype.getDefaultTable=function(){if(1===this.tables.length)return this.tables[0];for(var i=0;i<this.tables.length;i++)if(this.tables[i].isDefault)return this.tables[i]},TableSelectionModel.prototype.getLoadModelTableModelIfExists=function(){return this._loadModelTableEditor?this._loadModelTableEditor:(this._loadModelTableEditor=dataconnectionLoadModel?dataconnectionLoadModel.getTableModelByDatabasePath(this.databaseName,this.ownerName,this.name):void 0,this._loadModelTableEditor)},TableSelectionModel.prototype.getOrCreateLoadModelTableModel=function(){return this._loadModelTableEditor?this._loadModelTableEditor:(this._loadModelTableEditor=dataconnectionLoadModel?dataconnectionLoadModel.getOrCreateTableModelByDatabasePath(this.databaseName,this.ownerName,this.name):void 0,this._loadModelTableEditor)},TableSelectionModel.prototype.populateFieldList=function(qFields){var i,tableEditor=this.getLoadModelTableModelIfExists(),self=this;if(self.fields&&self.fields.length===qFields.length)for(i in self.fields){var oldName=self.fields[i].name;self.fields[i].name=qFields[i].qName||"undefined",self.fields[i].originalFieldName=qFields[i].qOriginalFieldName,self.fields[i].key=!!qFields[i].qIsKey,tableEditor&&oldName!==self.fields[i].name&&tableEditor.registerFieldSourceRename(oldName,self.fields[i].name,self.fields[i].checked)}else{self.fields=qFields.map(function(qField){return new FieldSelectionModel(self,qField.qName||"undefined",!!qField.qIsKey,qField.qOriginalFieldName)});for(i in self.fields)self.fields[i].index=i;if(tableEditor){for(i in self.fields){self.fields[i].checked=tableEditor.isFieldSelected(self.fields[i].name);var fieldModel=tableEditor.getFieldByOriginalName(self.fields[i].name);fieldModel&&(self.fields[i].alias=fieldModel.alias)}tableEditor.pruneOtherFields(self.fields.map(function(field){return field.name}))}}if(tableEditor){var fieldsCount=self.fields.length;this.nbrOfCheckedFields=tableEditor.selectedFieldsCount(),this.indeterminate=fieldsCount>this.nbrOfCheckedFields&&this.nbrOfCheckedFields>0,this.checked=fieldsCount>0&&fieldsCount===this.nbrOfCheckedFields,this.fieldsChecked=this.nbrOfCheckedFields>0}return self.fields},TableSelectionModel.prototype.getFields=function(forceReload){var self=this;return forceReload&&(this.fieldsPromise=void 0),this.fieldsPromise=this.fieldsPromise||when(contentProvider.getFields(this.databaseName,this.ownerName,this.name)).then(function(fields){return self.populateFieldList(fields)}),this.fieldsPromise},TableSelectionModel.prototype.getDataPreview=function(){function previewDataIsInExpectedOrder(fieldList,fieldNameList){for(var i=0;i<fieldList.length;i++)if(fieldList[i].name!==fieldNameList.qValues[i])return!1;return!0}function sameNumberOfDataValuesAsColumns(fieldList,fieldNameList){return fieldList.length===fieldNameList.qValues.length}function reOrganizePreviewDataAccordingToFieldList(fieldList,preview){for(var newPreview=[],i=0;i<fieldList.length;i++){var fieldName=fieldList[i].name,indexOfFieldInThePreviewData=getIndexOfFieldInThePreviewData(fieldName,preview);-1!==indexOfFieldInThePreviewData&&(indexOfFieldInThePreviewData=i);for(var k=0;k<preview.length;k++){var valueFromOldPreviewWeShouldCopy=preview[k].qValues[indexOfFieldInThePreviewData];newPreview[k]||(newPreview[k]={qValues:[]}),newPreview[k].qValues.push(valueFromOldPreviewWeShouldCopy)}}return newPreview}function getIndexOfFieldInThePreviewData(fieldName,preview){var previewFieldList=preview[0].qValues;return previewFieldList.indexOf(fieldName);
}function shortenTooLongValues(preview){var MAX_CELL_LENGTH=500;for(var y in preview)for(var x in preview[y].qValues)preview[y].qValues[x]&&preview[y].qValues[x].length>MAX_CELL_LENGTH&&(preview[y].qValues[x]=preview[y].qValues[x].substring(0,MAX_CELL_LENGTH)+"...")}var self=this;return when(contentProvider.getPreview(this.databaseName,this.ownerName,this.name)).then(function(preview){var fieldList=self.fields,fieldNameList=preview.slice(0,1)[0];return preview&&preview.length>1&&sameNumberOfDataValuesAsColumns(fieldList,fieldNameList)?(previewDataIsInExpectedOrder(fieldList,fieldNameList)||(preview=reOrganizePreviewDataAccordingToFieldList(fieldList,preview)),shortenTooLongValues(preview),preview.slice(1)):[]},function(error){throw error})},TableSelectionModel.prototype.getAssociationsPreview=function(){return qvangular.promise({tables:[{name:"fakeTable"}]})},TableSelectionModel.prototype.changeAllFieldsSelected=function(){this.setAllSelected(!this.checked)},TableSelectionModel.prototype.setAllSelected=function(newValue){var self=this,hasDoneChange=!1;this.checked=newValue,this.getFields().then(function(){var i;for(i=0;i<self.fields.length;i++)if(self.fields[i].checked!==newValue){self.fields[i].checked=newValue;var tableEditor=self.getOrCreateLoadModelTableModel();tableEditor&&tableEditor.setFieldSelected(self.fields[i].name,self.fields[i].checked),hasDoneChange=!0}hasDoneChange&&(self.recalculate(),datamodel.computeFlatListOfSelectedDatabaseOwnerCombinations())})},TableSelectionModel.prototype.recalculate=function(){var i,allChecked=!0,atLeastOneChecked=!1,atLeastOneNotChecked=!1,checkedFieldCount=0;for(i=0;i<this.fields.length;i++)this.fields[i].checked?(atLeastOneChecked=!0,checkedFieldCount++):(allChecked=!1,atLeastOneNotChecked=!0);this.checked=atLeastOneChecked&&allChecked,this.indeterminate=atLeastOneChecked&&atLeastOneNotChecked,this.fieldsChecked=atLeastOneChecked,this.nbrOfCheckedFields=checkedFieldCount,datamodel.recalculate()},Object.defineProperty(FieldSelectionModel.prototype,"alias",{set:function(alias){this.aliasRealValue=alias.trim(),this.name===this.aliasRealValue&&(this.aliasRealValue="");var tableEditor=this.table.getOrCreateLoadModelTableModel();tableEditor&&tableEditor.setFieldAlias(this.name,this.alias)},get:function(){return this.aliasRealValue?this.aliasRealValue:this.name}}),FieldSelectionModel.prototype.changeFieldSelection=function(){this.checked=!this.checked;var tableEditor=this.table.getOrCreateLoadModelTableModel();tableEditor&&tableEditor.setFieldSelected(this.name,this.checked),this.table.recalculate()},this.getFlatListOfSelectedDatabaseOwnerCombinations=function(){return flatListOfSelections},this.computeFlatListOfSelectedDatabaseOwnerCombinations=function(){for(var owners,result=[],i=0;this.databases&&i<this.databases.length;i++)if(owners=this.databases[i].owners)for(var j=0;j<owners.length;j++){var selectionStats=getSelectionsStatsForOwner(owners[j]);selectionStats&&result.push({database:this.databases[i],owner:owners[j],selectionStats:selectionStats})}return result},this.isAtLeastOneFieldSelected=function(){for(var owners,tables,fields,i=0;this.databases&&i<this.databases.length;i++)if(owners=this.databases[i].owners)for(var j=0;j<owners.length;j++)if(tables=owners[j].tables)for(var k=0;k<tables.length;k++){fields=tables[k].fields;var loadModelTableEditor=tables[k].getLoadModelTableModelIfExists();if(loadModelTableEditor&&loadModelTableEditor.selectedFieldsCount()>0)return!0;if(fields)for(var m=0;m<fields.length;m++)if(fields[m].checked)return!0}return!1}}var when=qvangular.when;return DataSelectionModel}),define("assets/hldm/add-data-wizard/components/classic-select-dialog",["qvangular","scripteditor.views/genericselectdialog/genericselectdialog","scripteditor.services/data-selection-model","scripteditor.views/genericselectdialog/genericselectdialog-directives"],function(qvangular,genericSelectDialog,DataSelectionModel){qvangular.directive("qvGenericSelectDialog",function(){return{restrict:"E",replace:!0,template:"<div><qva-include data-component='genericSelectDialog' ng-if='!!provider && !!dataconnectionSelectionEditor' data-input='genericSelectDialogInput'/></div>",scope:{dataconnectionSelectionEditor:"=",provider:"=",options:"=",qvDialogContext:"=",qvInternals:"="},controller:["$scope",function($scope){var dataSelectionModel=new DataSelectionModel($scope.provider,$scope.dataconnectionSelectionEditor,$scope.qvInternals.newAssociationsModel,$scope.qvInternals.dataPreviewProvider),scriptEditorProxy={insertCode:function(){}},scriptGenerator={generateScriptForSelections:function(){}};$scope.destroyComponent=function(){$scope.close()},$scope.genericSelectDialog=genericSelectDialog,$scope.genericSelectDialogInput={dataSelectionModel:dataSelectionModel,scriptGenerator:scriptGenerator,scriptEditorProxy:scriptEditorProxy,associationsModel:$scope.qvInternals.newAssociationsModel,inlineMode:!0,options:$scope.provider.fileSelectOptions||$scope.provider.selectOptions||{},qvDialogContext:$scope.qvDialogContext,cancel:$scope.cancel},$scope.genericSelectDialogInput.options.quickLoadContext=!0}]}})}),define("assets/hldm/add-data-wizard/add-data-wizard",["qvangular","general.services/show-service/show-service","assets/hldm/views/wizard/wizard","core.models/engine","assets/hldm/add-data-wizard/select-kind-step-two/select-kind-step-two","scripteditor.services/dataconnector-service","scripteditor.services/quick-load-connector-service","scripteditor.utils/string-util","assets/hldm/add-data-wizard/align-tables-step/align-tables-step","translator","core.utils/deferred","assets/hldm/add-data-wizard/components/classic-select-dialog"],function(qvangular,showService,wizardView,Engine,selectKindStepMS12,dataconnectorService,quickLoadConnectorService,stringUtil,alignTablesStep,translator,Deferred){function _getFileDropStartStep(input){if(input.filePath)for(var i in input.dataconnectorsModel.connectors)if(input.dataconnectorsModel.connectors.hasOwnProperty(i)&&input.dataconnectorsModel.connectors[i].connectorMain.getInitialFileDropStep){var initialStep=input.dataconnectorsModel.connectors[i].connectorMain.getInitialFileDropStep(input.filePath);if(initialStep)return initialStep}return void 0}function start(getInput){var wizardControl={};showService.show(wizardView,{wizardControl:wizardControl});var finishingInProgress=!1;return $timeout(function(){getInput().then(function(input){function gotoAlignStep(){wizardControl.pushStep(alignTablesStep,{qvInternals:input.qvInternals,qvDialogContext:{finish:finish,hasNextStep:!1},analyzeAllTables:input.tableModelToEdit?!0:!1})}function finish(){return finishingInProgress?void 0:(finishingInProgress=!0,wizardControl.close(!0),input.existingLoadModel.overwriteContent(input.newLoadModel.serialize()),input.loadModelRunner.runMainLoadModelGraphically().then(function(){finishingInProgress=!1},function(){finishingInProgress=!1}))}function findIfConnectionExistWithoutError(serverside,id){var deferred=new Deferred;return serverside.getConnections().then(function(result){for(var i=0;i<result.qConnections.length;i++)result.qConnections[i].qId===id&&deferred.resolve(!0);deferred.resolve(!1)}),deferred.promise}function setupQvDialogContext(back,cleanup){var qvDialogContext={finish:finish};return back&&(qvDialogContext.back=back),cleanup&&(qvDialogContext.cleanup=cleanup),qvDialogContext.nextDisabled=function(){return!0},qvDialogContext.finishDisabled=function(){return!0},PROFILE_DATA_ENABLED?(qvDialogContext.nextText=translator.get("quickdataload.profileData"),qvDialogContext.next=gotoAlignStep):qvDialogContext.hasNextStep=!1,qvDialogContext}function selectFromConnection(selectedConnectorMain,connectorInstance,connectionInput){function cleanOnBack(){!connectionInput||connectionInput.usingExisting?wizardControl.popStep():findIfConnectionExistWithoutError(serverside,connectorInstance.id).then(function(result){result&&serverside.removeConnection(connectorInstance.id).then(function(){input.dataconnectorsModel.connections=input.dataconnectorsModel.connections.filter(function(con){return con.connectorInstance.id!==connectorInstance.id}),input.dataconnectorsModel.completeConnectionPromises[connectorInstance.name]&&delete input.dataconnectorsModel.completeConnectionPromises[connectorInstance.name],saveAppObjects().then(function(){wizardControl.popStep()})})}),input.qvDialogContext.runBeforeNewNextStep=function(){input.qvDialogContext.runOnQuit(),input.qvDialogContext.runBeforeNewNextStep=void 0}}function cleanup(isFinishing){isFinishing||(connectionInput&&!connectionInput.usingExisting&&findIfConnectionExistWithoutError(serverside,connectorInstance.id).then(function(result){result&&serverside.removeConnection(connectorInstance.id).then(function(){input.dataconnectorsModel.connections=input.dataconnectorsModel.connections.filter(function(con){return con.connectorInstance.id!==connectorInstance.id}),input.dataconnectorsModel.completeConnectionPromises[connectorInstance.name]&&delete input.dataconnectorsModel.completeConnectionPromises[connectorInstance.name],saveAppObjects()})}),input.qvDialogContext.runOnQuit())}input.qvDialogContext.runBeforeNewNextStep&&input.qvDialogContext.runBeforeNewNextStep(),input.qvDialogContext.runOnQuit=function(){input.newLoadModel.overwriteContent(input.existingLoadModel.serialize())};var initialSelectComponent=selectedConnectorMain.getInitialSelectStep(connectorInstance),serverside=input.dataconnectorsModel.getConnectionServersideProxy(connectorInstance.type,connectorInstance);wizardControl.pushStep(initialSelectComponent,{dataconnectorInstance:connectorInstance,connectionInput:connectionInput,serverside:serverside,dataconnectionSelectionEditor:input.newLoadModel.getDataconnectorSelectionEditor(connectorInstance),qvInternals:input.qvInternals,qvDialogContext:setupQvDialogContext(cleanOnBack,cleanup),runBeforeNewNextStep:!1})}function continueWithNewConnection(selectedConnectorMain,connectionInput){saveAppObjects().then(function(){input.dataconnectorsModel.getConnectionFromServer(connectionInput.connectionName,connectionInput.usingExisting).then(function(connectorInstance){input.dataconnectorsModel.getCompleteConnectionInstance(connectorInstance).then(function(connection){input.dataconnectorsModel.connections.indexOf(connection)<0&&input.dataconnectorsModel.connections.push(connection),selectFromConnection(selectedConnectorMain,connectorInstance,connectionInput)})})})}function saveAppObjects(){return qvangular.$rootScope.isPersonalMode?Engine.getCurrentApp().saveObjects():Deferred.resolve(!0)}var firstStep=_getFileDropStartStep(input);if(firstStep)quickLoadConnectorService.createConnector(dataconnectorService.getServersideConnectorProxy(),input.filePath).then(function(connectorInstance){saveAppObjects().then(function(){var inputForDrop={dataconnectorInstance:connectorInstance,connectionInput:{connectionName:connectorInstance.name,singleFileName:stringUtil.fileNameFromPath(input.filePath)},serverside:input.dataconnectorsModel.getConnectionServersideProxy(connectorInstance.type,connectorInstance),dataconnectionSelectionEditor:input.newLoadModel.getDataconnectorSelectionEditor(connectorInstance),qvInternals:input.qvInternals,qvDialogContext:setupQvDialogContext()};wizardControl.init({firstStep:firstStep,firstStepInput:inputForDrop})})});else if(input.tableModelToEdit){var connection=input.dataconnectorsModel.getConnectionFromModel(input.tableModelToEdit.data.dataconnectorName),connectorInstance=connection.connectorInstance,editTableInput={dataconnectorInstance:connectorInstance,serverside:input.dataconnectorsModel.getConnectionServersideProxy(connectorInstance.type,connectorInstance),dataconnectionSelectionEditor:input.newLoadModel.getDataconnectorSelectionEditor(connectorInstance),qvInternals:input.qvInternals,qvDialogContext:setupQvDialogContext(),tableModelToEdit:input.tableModelToEdit};wizardControl.init({firstStep:connection.connectorMain.getInitialSelectStep(),firstStepInput:editTableInput,wizardTitle:"quickdataload.DataManagement.EditSelections"})}else input.continueWithNewConnection=continueWithNewConnection,input.selectFromConnection=selectFromConnection,wizardControl.init({firstStep:selectKindStepMS12,firstStepInput:input})})}),wizardControl}var PROFILE_DATA_ENABLED=!0,$timeout=qvangular.getService("$timeout"),exports={start:start};return exports}),define("text!assets/hldm/data-connectors/native-file-connector/connect-step.ng.html",[],function(){return'<div class="native-file-connector-container flatfilechoosercontainer">\r\n	<div class="loading-screen" ng-show="isLoading">\r\n		<div class="qv-loader"></div>\r\n	</div>\r\n	<main class="dm-main" tid="hdlm-file-select">\r\n		<div class="text" q-translation="scripteditor.dataconnectors.fileconnect.path"></div>\r\n		<qv-file-path-input path="path" hover-path="currentHoverPath" isvalidpath="validpath" root-placeholder="rootPlaceholderName"></qv-file-path-input>\r\n		<p class="illegalpath" ng-class="{visible: !validpath }">{{invalidPathLabel}}</p>\r\n		<qv-file-browser-widget on-dbl-click="qvDialogContext.next()" path="path" hover-path="currentHoverPath" folderitems="folderitems" selected-file-name="selectedFileName" on-file-clicked="onFileClicked(path, name)"></qv-file-browser-widget>\r\n		<div class="text qs-ft" q-translation="scripteditor.flatfilechooser.filetype"></div>\r\n		<qui-select class="filetype" qui-model="selectedFileFilter" qui-options="option.title|translate for option in fileFilters"></qui-select>\r\n	</main>\r\n</div>\r\n'}),define("text!assets/scripteditor/directives/qvfilebrowser/qvfilebrowser.ng.html",[],function(){return'<div class="qvfilebrowser">\r\n	<ul class="qv-fb-ul" vs-repeat vs-scroll-parent=".qvfilebrowser">\r\n		<li class="qui-menu-item" ng-disabled="item.disabled || (item.isFile && isAddMode)" ng-repeat="item in folderitems" ng-class="{fileselected:( item.isFile && item.name == selectedFileName)}"\r\n			qva-activate="onItemClick(item);" qva-dblclick="onItemDblClick(item)" title="{{item.path}}">\r\n			<span data-isfile="{{item.isFile}}">{{item.name}}</span>\r\n			<span class="extra-info" ng-show="item.extraInfo">{{item.extraInfo}}</span>\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("assets/scripteditor/directives/qvfilebrowser/qvfilebrowser",["assets/qvangular/qvangular-core","text!assets/scripteditor/directives/qvfilebrowser/qvfilebrowser.ng.html","touche"],function(qvangular,template,Touche){qvangular.directive("qvFileBrowserWidget",function(){return{restrict:"EAC",replace:!0,scope:{path:"=",hoverPath:"=",folderitems:"=",onFileClicked:"&",selectedFileName:"=",isAddMode:"=",onDblClick:"&"},template:template,controller:["$scope","$element","$timeout",function($scope,$element){$scope.onItemClick=function(item){item.disabled||(item.isFile?$scope.onFileClicked&&$scope.onFileClicked({item:item,path:item.path,name:item.name}):($scope.path=item.path,$element.scrollTop(0)))},$scope.onItemDblClick=function(item){item.disabled||$scope.onDblClick()},$scope.onMouseEnter=function(path){$scope.hoverPath=path},$scope.onMouseLeave=function(path){$scope.hoverPath===path&&($scope.hoverPath=void 0)},$scope.isHovered=function(path){return $scope.hoverPath===path},$scope.isFileSelected=function(item){return item.isFile&&item.name===$scope.selectedFileName},Touche($element[0]).swipe({options:{preventDefault:!1},end:function(){Touche.preventGestures(this.gestureHandler)}})}]}})}),define("text!assets/scripteditor/directives/qvfilepathinput/qvfilepathinput.ng.html",[],function(){return'<div class="qvfilepathinputcontainer" tabindex="-1" ng-class="{ invalidpath: !isvalidpath }">\r\n	<div class="itemcontainer" onclick="$(\'input.qvfilepathinputcontainer-input\').focus();">\r\n		<div ng-repeat="item in items" class="item">\r\n			<div class="qui-button" ng-class="{hover:isHovered(item.path)}" ng-click="onItemClick(item.path, $event);" ng-mouseenter="onMouseEnter(item.path);" ng-mouseleave="onMouseLeave(item.path);" title="{{item.path}}">{{item.name}}</div>\r\n			<div class="icon-hub-next"></div>\r\n		</div>\r\n	</div>\r\n	<input class="qui-input qvfilepathinputcontainer-input" type="text" ng-model="path" qva-model-onblur="true" maxlength="500" onblur="/*QLIK-14545*/var t = this.value; this.value = \'\'; this.value = t;"/>\r\n</div>'}),define("assets/scripteditor/directives/qvfilepathinput/qvfilepathinput",["assets/qvangular/qvangular-core","text!assets/scripteditor/directives/qvfilepathinput/qvfilepathinput.ng.html","scripteditor.utils/string-util"],function(qvangular,template,stringUtil){qvangular.directive("qvFilePathInput",function(){return{restrict:"EA",scope:{path:"=",hoverPath:"=",isvalidpath:"=",rootPlaceholder:"=",hideRootPlaceholderInPath:"="},replace:!0,requires:["qvEnter"],template:template,controller:["$scope",function($scope){function insertRootPlaceholder(){$scope.items.unshift({name:$scope.rootPlaceholder,path:""})}function createItemsFromPath(){var folderNames,i,folderName,displayName,currentPath;if($scope.items=[],"\\\\"===$scope.path.substring(0,2)?(folderNames=stringUtil.removeSurroundingSlashes($scope.path.substring(2)||"").split("\\"),folderNames[0]="\\\\"+folderNames[0]):folderNames=stringUtil.removeSurroundingSlashes($scope.path||"").split("\\"),folderNames.length>0&&folderNames[0].length>0){currentPath="";for(i in folderNames)folderName=folderNames[i],displayName=folderNames[i],":"===displayName[displayName.length-1]&&(displayName=displayName.substring(0,displayName.length-1)),currentPath+=currentPath?"\\"+folderName:folderName,$scope.items.push({name:displayName,path:currentPath});$scope.rootPlaceholder&&!$scope.hideRootPlaceholderInPath&&insertRootPlaceholder()}else $scope.rootPlaceholder&&insertRootPlaceholder()}$scope.onItemClick=function(path,event){event.stopPropagation(),$scope.path=path,createItemsFromPath()},$scope.$watch("path",function(newValue){"undefined"!=typeof newValue&&($scope.path=newValue.trim(),createItemsFromPath())}),$scope.onMouseEnter=function(path){$scope.hoverPath=path},$scope.onMouseLeave=function(path){$scope.hoverPath===path&&($scope.hoverPath=void 0)},$scope.isHovered=function(path){return $scope.hoverPath===path}}]}})}),define("assets/hldm/data-connectors/native-file-connector/connect-step",["text!./connect-step.ng.html","scripteditor.utils/string-util","core.models/engine","scripteditor.services/file-formats","translator","core.utils/deferred","scripteditor.utils/directory-arranger","scripteditor.services/dataconnector-service","scripteditor.services/quick-load-connector-service","assets/scripteditor/directives/qvfilebrowser/qvfilebrowser","assets/scripteditor/directives/qvfilepathinput/qvfilepathinput"],function(template,stringUtil,engine,fileFormats,translator,Deferred,directoryArranger,dataconnectorService,quickLoadConnectorService){return{template:template,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"=",qvxSelectedEntrypoint:"=",dataconnectorInstance:"="},controller:["$scope","$q",function($scope){function updateFileBrowser(path){function updateFilesList(result){$scope.folderitems=directoryArranger.postProcessDirectoryListing(path,result.qFolderItems,$scope.selectedFileFilter.regexps),setPathIsValid(!0),$scope.isLoading=!1,updateFileValidity()}function handleErrorsFileList(error){error.isHandled=!0,setPathIsValid(!1,error.code),$scope.isLoading=!1,updateFileValidity()}$scope.folderitems=[],$scope.isLoading=!0,isQuickLoadContext()&&isInit&&!representsHomeFolder(path)?getLatestFilePath().then(function(result){return $scope.path=result.lastPath?result.lastPath:result.myDocs.qFolder,engine.global.getFolderItemsForPath($scope.path).then(updateFilesList,function(result){setPathIsValid(!0),$scope.isLoading=!1,$scope.folderitems=directoryArranger.postProcessDirectoryListing(path,result.qFolderItems,$scope.selectedFileFilter.regexps),updateFileValidity()},function(){$scope.isLoading=!1})}):isQuickLoadContext()?engine.global.getLogicalDriveStrings().then(function(results){$scope.isLoading=!1,$scope.folderitems=directoryArranger.postProcessDriveListing(results.qDrives),setPathIsValid(!0)},function(){$scope.isLoading=!1}):($scope.dataconnectorInstance?engine.currentApp.getFolderItemsForConnection({qConnectionId:$scope.dataconnectorInstance.id,qRelativePath:stringUtil.removeSurroundingSlashes(path)}).then(updateFilesList,handleErrorsFileList):engine.global.getFolderItemsForPath(path).then(updateFilesList,handleErrorsFileList),isInit=!1)}function representsHomeFolder(path){return path===HOME_FOLDER_CONSTANT}function setPreselectedFilter(){if($scope.qvxSelectedEntrypoint)for(var i=0;i<$scope.fileFilters.length;i++)if($scope.fileFilters[i].title===$scope.qvxSelectedEntrypoint.id){$scope.selectedFileFilter=$scope.fileFilters[i];break}}function setPathIsValid(valid,errorCode){$scope.validpath=valid,errorCode?$scope.invalidPathLabel=translator.get("ErrorCode."+errorCode):$scope.invalidPathLabel=$scope.invalidPathDefaultMessage}function isQuickLoadContext(){return!$scope.dataconnectorInstance&&""===$scope.path}function updateFileValidity(){$scope.validFilePathName=currentListingContainsFile($scope.selectedFileName)}function currentListingContainsFile(fileName){return $scope.folderitems&&$scope.folderitems.some(function(item){return!!item.isFile&&item.name===fileName})}function getLatestFilePath(){return Deferred.all({myDocs:engine.global.getMyDocumentsFolder()})}function nextDisabled(){return!$scope.validFilePathName}var isInit=!0,HOME_FOLDER_CONSTANT="";$scope.qvDialogContext.title=translator.get("scripteditor.dataconnectors.filechooser.title"),$scope.qvDialogContext.nextDisabled=nextDisabled,$scope.qvDialogContext.size="S",$scope.fileFilters=fileFormats.getFileFilters(),$scope.isLoading=!1,$scope.path="",$scope.validpath=!0,$scope.rootPlaceholderName=$scope.dataconnectorInstance?"<"+$scope.dataconnectorInstance.name+">":"",$scope.invalidPathDefaultMessage=translator.get("scripteditor.dataconnectors.fileconnect.illegalpath"),$scope.invalidPathLabel=$scope.invalidPathDefaultMessage,$scope.selectedFileFilter=$scope.fileFilters[0],setPreselectedFilter(),$scope.$watch("path + selectedFileFilter.title",function(){updateFileBrowser($scope.path)}),$scope.$watch("selectedFileName",function(){updateFileValidity()}),$scope.onFileClicked=function(path,name){$scope.selectedFileName=name},$scope.filePathName=function(){return $scope.path?stringUtil.combinePath($scope.path,$scope.selectedFileName):$scope.selectedFileName},$scope.qvDialogContext.next=function(){nextDisabled()||($scope.dataconnectorInstance?$scope.continueWithNewConnection({connectionName:$scope.dataconnectorInstance.name,singleFileName:stringUtil.removeSurroundingSlashes($scope.filePathName()),usingExisting:!0}):quickLoadConnectorService.createConnector(dataconnectorService.getServersideConnectorProxy(),$scope.filePathName()).then(function(result){result&&$scope.continueWithNewConnection({connectionName:result.name,singleFileName:$scope.selectedFileName,usingExisting:result.existedPreviously})}))},$scope.onEscape=$scope.onCancelClicked=function(){$scope.destroyComponent(),$scope.deferredResult.reject()}}]}}),define("text!assets/hldm/data-connectors/native-file-connector/select-step.ng.html",[],function(){return'<div class="native-file-connector-select">\r\n	<qv-generic-select-dialog ng-if="dataHasLoaded" data-provider="provider"\r\n							  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\r\n							  data-qv-dialog-context="qvDialogContext"\r\n							  data-qv-internals="qvInternals">\r\n	</qv-generic-select-dialog>\r\n</div>\r\n'}),define("scripteditor.services/delimiter-options",[],function(){function computeDelimiterOptions(){var allDelimiters=computeStandardDelimiters().concat(computeCustomDelimiterOptions());return allDelimiters}function computeStandardDelimiters(){var item,delimiters=[{number:"59",name:"scripteditor.dataconnectors.delimiter.semicolon",scriptCode:";",kind:"Common.Standard"},{number:"44",name:"scripteditor.dataconnectors.delimiter.comma",scriptCode:",",kind:"Common.Standard"},{number:"9",name:"scripteditor.dataconnectors.delimiter.tab",scriptCode:"\\t",kind:"Common.Standard"},{number:"32",name:"scripteditor.dataconnectors.delimiter.spaces",scriptCode:"spaces",multiple:!0,kind:"Common.Standard"}];for(item in delimiters)delimiters[item].title=delimiters[item].name;return delimiters}function computeCustomDelimiterOptions(){var i,ch,allcharsDelimiters=[];for(i=0;127>=i;i++)ch=String.fromCharCode(i),allcharsDelimiters[i]={number:""+i,name:ch,scriptCode:ch.match(/\w/)?"'"+ch+"'":"'\\x"+i.toString(16)+"'",kind:"Common.Custom"};return allcharsDelimiters[0].name="NUL",allcharsDelimiters[1].name="SOH",allcharsDelimiters[2].name="STX",allcharsDelimiters[3].name="ETX",allcharsDelimiters[4].name="EOT",allcharsDelimiters[5].name="ENQ",allcharsDelimiters[6].name="ACK",allcharsDelimiters[7].name="BEL",allcharsDelimiters[8].name="BS",allcharsDelimiters[9].name="scripteditor.dataconnectors.delimiter.tab",allcharsDelimiters[10].name="LF",allcharsDelimiters[11].name="VT",allcharsDelimiters[12].name="FF",allcharsDelimiters[13].name="CR",allcharsDelimiters[14].name="SO",allcharsDelimiters[15].name="SI",allcharsDelimiters[16].name="DLE",allcharsDelimiters[17].name="DC1 (XON)",allcharsDelimiters[18].name="DC2",allcharsDelimiters[19].name="DC3 (XOFF)",allcharsDelimiters[20].name="DC4",allcharsDelimiters[21].name="NAK",allcharsDelimiters[22].name="SYN",allcharsDelimiters[23].name="ETB",allcharsDelimiters[24].name="CAN",allcharsDelimiters[25].name="EM",allcharsDelimiters[26].name="SUB",allcharsDelimiters[27].name="ESC",allcharsDelimiters[28].name="FS",allcharsDelimiters[29].name="GS",allcharsDelimiters[30].name="RS",allcharsDelimiters[31].name="US",allcharsDelimiters[32].name="scripteditor.dataconnectors.delimiter.space",allcharsDelimiters[44].name="scripteditor.dataconnectors.delimiter.comma",allcharsDelimiters[59].name="scripteditor.dataconnectors.delimiter.semicolon",allcharsDelimiters[127].name="DEL",allcharsDelimiters[8].scriptCode="'\\b'",allcharsDelimiters[9].scriptCode="'\\t'",allcharsDelimiters[10].scriptCode="'\\n'",allcharsDelimiters[13].scriptCode="'\\r'",allcharsDelimiters[32].scriptCode="' '",allcharsDelimiters[39].scriptCode='"\'"',allcharsDelimiters[92].scriptCode="\\\\",allcharsDelimiters[32].scriptCode="' '",allcharsDelimiters.splice(33,0,{number:"32",name:"scripteditor.dataconnectors.delimiter.spaces",scriptCode:"spaces",multiple:!0,kind:"Common.Custom"}),allcharsDelimiters}return computeDelimiterOptions()}),define("assets/scripteditor/services/fixedwidth/filesettings-fixedwidthdelimiters-service",[],function(){function isValid(delimitersValue){var values,i,value,lastValue=0;if(delimitersValue=String(delimitersValue),0===delimitersValue.length)return!1;values=delimitersValue.split(",");for(i in values){if(value=values[i].trim(),0===value.length)return!1;if(isNaN(value))return!1;if(Number(value)<=Number(lastValue))return!1;lastValue=value}return!0}return{isValid:isValid}}),define("scripteditor.services/file-settings-model",["core.utils/class","scripteditor.services/delimiter-options","assets/scripteditor/services/fixedwidth/filesettings-fixedwidthdelimiters-service"],function(Class,delimiterOptions,fileSettingsFixedWidthDelimitersService){function bool(value){return value&&"false"!==value?!0:!1}function FileSettingsModel(datasourceInstance,codepageOptions,dataconnectionSelectionEditor){var fileSettingsForTable={},fileSettingsForFile={};this.getSettingsModelForFile=function(databaseName){return databaseName||(databaseName=""),fileSettingsForFile[databaseName]||(fileSettingsForFile[databaseName]=new FileSettings),fileSettingsForFile[databaseName]},this.getSettingsModelForTable=function(databaseName,ownerName,tableName){databaseName||(databaseName=""),ownerName||(ownerName=""),tableName||(tableName="");var combinedTableId=datasourceInstance.name+"/"+databaseName+"/"+ownerName+"/"+tableName;if(!fileSettingsForTable[combinedTableId]){var settings=this.getSettingsModelForFile(databaseName,ownerName).settingsGuess;if(dataconnectionSelectionEditor){var tableModel=dataconnectionSelectionEditor.getTableModelByDatabasePath(databaseName,ownerName,tableName);tableModel&&tableModel.data.fileFormatSettings&&(settings=tableModel.data.fileFormatSettings)}fileSettingsForTable[combinedTableId]=new TableSettings(settings,codepageOptions)}return fileSettingsForTable[combinedTableId]}}function findGuessedDelimiterOption(guessedDelimiter){return guessedDelimiter.qIsMultiple&&"false"!==guessedDelimiter.qIsMultiple?delimiterOptions.filter(function(item){return"spaces"===item.scriptCode})[0]:delimiterOptions.filter(function(item){return item.number===guessedDelimiter.qNumber.toString()})[0]}function findGuessedCodePageOption(codepageOptions,guessedCodePageNumber){return codepageOptions.filter(function(item){return item.number===guessedCodePageNumber})[0]}var LABEL_STRATEGY_OPTION_EMBEDDED_LABELS="embedded labels",LABEL_STRATEGY_OPTION_NO_LABELS="no labels",FileSettings=Class.extend("FileSettings",{init:function(){},setSettingsGuess:function(settingsGuess){this.settingsGuess=settingsGuess},getParamsForEngine:function(){return{}}}),TableSettings=Class.extend("TableSettings",{labelStrategyOptions:[LABEL_STRATEGY_OPTION_EMBEDDED_LABELS,LABEL_STRATEGY_OPTION_NO_LABELS],quotingOptions:["standard","msq","none"],delimiterOptions:delimiterOptions,init:function(settingsGuess,codepageOptions){this.codepageOptions=codepageOptions,settingsGuess&&"undefined"!=typeof settingsGuess.qHeaderSize?this.nbrOfHeaderLinesToRemove=""+settingsGuess.qHeaderSize:this.nbrOfHeaderLinesToRemove=0,settingsGuess&&"undefined"!=typeof settingsGuess.qTabSize?this.tabSize=settingsGuess.qTabSize:this.tabSize=1,this.formatSpec="undefined format spec",settingsGuess&&"undefined"!=typeof settingsGuess.qIgnoreEOF?this.ignoreEOF=settingsGuess.qIgnoreEOF:this.ignoreEOF=!1,settingsGuess&&"undefined"!=typeof settingsGuess.qFixedWidthDelimiters?this.fixedWidthDelimiters=settingsGuess.qFixedWidthDelimiters:this.fixedWidthDelimiters="1",this.fixedWidthDelimitersLastValid=this.fixedWidthDelimiters,settingsGuess&&"undefined"!=typeof settingsGuess.qRecordSize?this.recordSize=-settingsGuess.qRecordSize:this.recordSize=0,settingsGuess&&"undefined"!=typeof settingsGuess.qComment?this.comment=settingsGuess.qComment:this.comment="",settingsGuess&&settingsGuess.qLabel?settingsGuess.qType&&0===settingsGuess.qType.indexOf("TYPE9_EXCEL_")?this.labelStrategy=LABEL_STRATEGY_OPTION_EMBEDDED_LABELS:this.labelStrategy=settingsGuess.qLabel:this.labelStrategy=this.labelStrategyOptions[0],settingsGuess&&settingsGuess.qDelimiter?this.delimiter=findGuessedDelimiterOption(settingsGuess.qDelimiter):this.delimiter=delimiterOptions[0],settingsGuess&&settingsGuess.qQuote?this.quoting=settingsGuess.qQuote:this.quoting=this.quotingOptions[0],settingsGuess&&settingsGuess.qCodePage?this.codepage=findGuessedCodePageOption(this.codepageOptions,settingsGuess.qCodePage):this.codepage=this.codepageOptions[0],settingsGuess&&"undefined"!=typeof settingsGuess.qIgnoreEOF?this.ignoreEOF=bool(settingsGuess.qIgnoreEOF):this.ignoreEOF=!1},setFormatSpec:function(formatSpec){this.formatSpec=formatSpec},getFormatSpec:function(){return this.formatSpec},getCompiledSettings:function(){return JSON.stringify(this.getParamsForEngine())},getParamsForEngine:function(){return fileSettingsFixedWidthDelimitersService.isValid(this.fixedWidthDelimiters)&&(this.fixedWidthDelimitersLastValid=this.fixedWidthDelimiters),{qLabel:this.labelStrategy,qHeaderSize:parseInt(this.nbrOfHeaderLinesToRemove,10),qDelimiter:{qNumber:parseInt(this.delimiter.number,10),qIsMultiple:!!this.delimiter.multiple},qQuote:this.quoting,qCodePage:this.codepage.number,qIgnoreEOF:bool(this.ignoreEOF),qFixedWidthDelimiters:this.fixedWidthDelimitersLastValid,qTabSize:this.tabSize,qRecordSize:-1*this.recordSize,qComment:this.comment}}});return FileSettingsModel}),define("scripteditor.services/file-script-generator",["underscore","scripteditor.services/keywords"],function(underscore){
function quoteConnectionName(name){return-1===name.indexOf("[")&&-1===name.indexOf("]")?"["+name+"]":-1===name.indexOf('"')?'"'+name+'"':-1===name.indexOf("'")?"'"+name+"'":-1===name.indexOf("")?""+name+"":name}function createScriptGenerator(datasourceInstance,fileSettingsModel,bnfModel){function generateScriptForSelections(datasourceSelectionModel,datasourceInfo){var databases,selectedFields,script="",indent="    ";return datasourceInfo?(databases=datasourceSelectionModel.databases,databases&&databases.forEach(function(database){database.owners&&database.owners.length>0&&database.owners.forEach(function(owner){owner.tables&&owner.tables.length>0&&owner.tables.forEach(function(table){if(selectedFields=filterSelected(table.fields),selectedFields&&selectedFields.length>0){script+="\r\nLOAD\r\n";for(var m=0;m<selectedFields.length;m++){m>0&&(script+=",\r\n");var label=selectedFields[m].originalFieldName?selectedFields[m].originalFieldName:selectedFields[m].name;script+=selectedFields[m].alias&&selectedFields[m].name!==selectedFields[m].alias?indent+maybeQuote(label,datasourceInfo)+" as "+maybeQuote(selectedFields[m].alias,datasourceInfo):indent+maybeQuote(label,datasourceInfo)}script+="\r\nFROM "+createFromString(database.name,owner.name,table.name)+";\r\n"}})})}),script.trim()+"\r\n\r\n"):""}function filterSelected(list){return underscore.filter(list,function(x){return x.checked})}function createFromString(databaseName,ownerName,tableName){var qrsPath,result;return qrsPath="internet"!==datasourceInstance.type.provider?"lib://"+datasourceInstance.name+"/"+databaseName:"lib://"+datasourceInstance.name,result=quoteConnectionName(qrsPath)+"\r\n"+fileSettingsModel.getSettingsModelForTable(databaseName,ownerName,tableName).getFormatSpec()}function maybeQuote(name,dsInfo){return quoteCache[name]||containsSpecialChars(name,dsInfo.specialchars)||isKeyword(name,dsInfo.keywords)||startsWithDigit(name)?(quoteCache[name]=!0,-1===name.indexOf('"')?dsInfo.quoteprefix+name+dsInfo.quotesuffix:dsInfo.quoteprefixfordoublequotes+name+dsInfo.quotesuffixfordoublequotes):name}function containsSpecialChars(name,specialchars){for(var i=0;i<name.length;i++)if(-1!==specialchars.indexOf(name.charAt(i)))return!0;return!1}function startsWithDigit(name){if(name.length>0){var startingCharCode=name.charCodeAt(0);return startingCharCode>=48&&57>=startingCharCode}return!1}function isKeyword(name){return bnfModel.isKeyword(name)}var quoteCache={},scriptGenerator={generateScriptForSelections:generateScriptForSelections};return scriptGenerator}var exports={createScriptGenerator:createScriptGenerator,quoteConnectionName:quoteConnectionName};return exports}),define("scripteditor.services/codepage-options",["core.models/engine"],function(engine){function isStandard(codepage){return 1252===codepage||850===codepage||1e4===codepage||65001===codepage||1200===codepage}function removeCodepage(array,codepageNbr){return remove(array,function(codepage){return codepage.qNumber===codepageNbr})}function remove(array,filterFunction){var item=array.filter(filterFunction)[0],index=array.indexOf(item);return array.splice(index,1),item}function getCodepageOptionsPromise(){return engine.global.getSupportedCodePages().then(function(result){result.qCodePages.push({qDescription:"Unicode",qNumber:1200});var allexcepttoplist=result.qCodePages,toplist=[removeCodepage(allexcepttoplist,1252),removeCodepage(allexcepttoplist,850),removeCodepage(allexcepttoplist,1e4),removeCodepage(allexcepttoplist,65001),removeCodepage(allexcepttoplist,1200)],orderedList=toplist.concat(allexcepttoplist),resultList=orderedList.map(function(original){return{title:original.qDescription,number:original.qNumber,kind:isStandard(original.qNumber)?"Common.Standard":"Common.Custom"}});return resultList})}return{getCodepageOptionsPromise:getCodepageOptionsPromise}}),define("text!assets/scripteditor/views/filesettings/filesettings.html",[],function(){return'<div class="filesettings">\r\n	<div ng-switch="layout">\r\n\r\n		<!-- EXCEL SETTINGS -->\r\n		<div ng-switch-when="TYPE9_EXCEL_BIFF" class="row">\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\r\n			</div>\r\n		</div>\r\n\r\n		<!-- EXCEL SETTINGS -->\r\n		<div ng-switch-when="TYPE9_EXCEL_OOXML" class="row">\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\r\n			</div>\r\n		</div>\r\n\r\n		<!-- CSV SETTINGS -->\r\n		<div ng-switch-when="TYPE9_CSV" class="row">\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\r\n			</div>\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_delimiter\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_area_codepage\'"></div>\r\n			</div>\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_inline\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_area_oef\'"></div>\r\n			</div>\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_comment\'"></div>\r\n			</div>\r\n		</div>\r\n\r\n		<!-- FIXED FILES -->\r\n		<div ng-switch-when="TYPE9_FIX" class="row">\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\r\n			</div>\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_fixedwidth_delimiters\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_area_codepage\'"></div>\r\n			</div>\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_tab_size\'"></div>\r\n				<div class="settingArea" ng-include src="\'setting_recordsize\'"></div>\r\n			</div>\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_oef\'"></div>\r\n			</div>\r\n		</div>\r\n\r\n		<!-- HTML SETTINGS -->\r\n		<div ng-switch-when="TYPE9_HTML" class="row">\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\r\n			</div>\r\n			<div>\r\n				<div class="settingArea" ng-include src="\'setting_area_codepage\'"></div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n<!-- Templates -->\r\n\r\n<script type="text/ng-template" id="setting_area_labels">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.labels"></div>\r\n	<div class="setting">\r\n		<qui-select qui-model="currentSettings.labelStrategy" qui-options="option|translatelabelstrategy|translate for option in currentSettings.labelStrategyOptions" qui-disabled="tableFieldsDisabled"></qui-select>\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_area_headersize">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.headersize"></div>\r\n	<div class="headerSizeSetting">\r\n		<qui-input-number qui-model="currentSettings.nbrOfHeaderLinesToRemove" qui-disabled="tableFieldsDisabled" qui-min="0" qui-max="9999999" qui-with-buttons="true"></qui-input-number>\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_area_delimiter">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.delimiter"></div>\r\n	<div class="setting">\r\n		<qui-select qui-model="currentSettings.delimiter" qui-options="option|delimitertotitle group by option.kind|translate for option in currentSettings.delimiterOptions"></qui-select>\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_area_fixedwidth_delimiters">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.fixpositions"></div>\r\n	<div class="setting">\r\n		<input class="qui-input" ng-class="{ \'qui-invalid\': !isFixedWidthDelimitersValid() }" type="text" ng-model="currentSettings.fixedWidthDelimiters" ng-disabled="tableFieldsDisabled" maxlength="250"/>\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_area_codepage">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.codepage"></div>\r\n	<div class="setting">\r\n		<qui-select class="codepageselect" qui-model="currentSettings.codepage" qui-options="option.title group by option.kind|translate for option in currentSettings.codepageOptions">\r\n		</qui-select>\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_area_inline">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.quoting"></div>\r\n	<div class="setting">\r\n		<qui-select qui-model="currentSettings.quoting" qui-options="option|quotingvaluetolabelkey|translate for option in currentSettings.quotingOptions">\r\n		</qui-select>\r\n	</div>\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_area_oef">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.ignoreEOF"></div>\r\n	<div class="setting">\r\n		<label class="qui-checkboxicon ">\r\n			<input type="checkbox" ng-model="currentSettings.ignoreEOF">\r\n			<div class="check-wrap">\r\n				<span class="check"></span>\r\n				<!--<span class="check-text">For multi line text, set width of SPAN.check-text</span>-->\r\n			</div>\r\n		</label>\r\n		<!--<label checked="true" class="qui-checkboxicon">-->\r\n		<!--<input type="checkbox" ng-model="currentSettings.ignoreEOF">-->\r\n		<!--<i></i>-->\r\n		<!--</label>-->\r\n		<!--<input class="qui-checkboxicon" type="checkbox" ng-model="currentSettings.ignoreEOF"/>-->\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_area_comment">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.comment"></div>\r\n	<div class="setting">\r\n		<input class="qui-input-nr" type="text" ng-model="currentSettings.comment" qva-model-onblur maxlength="250" />\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_recordsize">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.recordsize"></div>\r\n	<div class="headerSizeSetting">\r\n		<qui-input-number qui-model="currentSettings.recordSize" qui-disabled="tableFieldsDisabled" qui-min="0" qui-max="9999999" qui-with-buttons="true"></qui-input-number>\r\n	</div>\r\n\r\n</script>\r\n\r\n<script type="text/ng-template" id="setting_tab_size">\r\n\r\n	<div class="title" q-translation="scripteditor.dataconnectors.tabsize"></div>\r\n	<div class="headerSizeSetting">\r\n		<qui-input-number qui-model="currentSettings.tabSize" qui-disabled="tableFieldsDisabled" qui-min="1" qui-max="9999999" qui-with-buttons="true"></qui-input-number>\r\n	</div>\r\n\r\n</script>\r\n'}),define("scripteditor.views/filesettings/filesettings",["qvangular","text!assets/scripteditor/views/filesettings/filesettings.html","translator","assets/scripteditor/services/fixedwidth/filesettings-fixedwidthdelimiters-service"],function(qvangular,template,translator,fileSettingsFixedWidthDelimitersService){function FileSettings(fileSettingsModel){this.template=template,this.controller=["$scope",function($scope){$scope.currentSettings={},$scope.tableFieldsDisabled=!0,$scope.$watch("ownerName",function(ownerName){$scope.layout=ownerName}),$scope.$watch("tableName",function(){$scope.currentSettings=fileSettingsModel.getSettingsModelForTable($scope.databaseName,$scope.ownerName,$scope.tableName),$scope.tableName&&($scope.tableFieldsDisabled=!1)}),$scope.settingsAsText=function(){return $scope.currentSettings.getCompiledSettings()},$scope.$watch("settingsAsText()",function(){$scope.tableName&&$scope.currentSettings&&$scope.onRefresh({})}),$scope.isFixedWidthDelimitersValid=function(){return fileSettingsFixedWidthDelimitersService.isValid($scope.currentSettings.fixedWidthDelimiters)},$scope.$parent.$parent.setFixedWidthGUIControllerOnChangeListener(function(delimiters){$scope.currentSettings.fixedWidthDelimiters=delimiters.join(","),$scope.$apply()}),$scope.$watch("currentSettings.fixedWidthDelimiters",function(){$scope.$parent.$parent.specialTableSettingsOk=$scope.isFixedWidthDelimitersValid(),$scope.isFixedWidthDelimitersValid()&&$scope.$parent.$parent.onFixedWidthDelimitersInputChange($scope.currentSettings.fixedWidthDelimiters)})}]}return qvangular.filter("translatelabelstrategy",function(){return function(input){return"scripteditor.dataconnectors.labelstrategy."+input.replace(" ","_")}}),qvangular.filter("quotingvaluetolabelkey",function(){return function(input){return"none"===input?"Common.None":"standard"===input?"Common.Standard":"scripteditor.dataconnectors.quoting."+input.replace(" ","_")}}),qvangular.filter("delimitertotitle",function(){return function(delimiter){return"Common.Standard"===delimiter.kind?translator.get(delimiter.name):delimiter.number+". "+translator.get(delimiter.name)}}),FileSettings}),define("assets/hldm/data-connectors/native-file-connector/native-file-provider",["core.models/engine","qvangular","core.utils/deferred","general.models/bnf-model","scripteditor.services/file-settings-model","scripteditor.services/file-script-generator","scripteditor.services/codepage-options","general.views/confirm-dialog/confirm-dialog","scripteditor.views/filesettings/filesettings"],function(engine,qvangular,Deferred,BnfModel,FileSettingsModel,FileScriptGenerator,codepageOptions,confirmDialog,FileSettings){function createNativeFileProvider(dataconnectorInstance,dataconnectionSelectionEditor,connectionInput,tableModelToEdit,qvDialogContext,isWebFile){function removeTYPE9(oldType){var newType=oldType.substring(oldType.indexOf("_")+1,oldType.length);return newType}function doSpecialParamModficationsBeforeSendingItToBackend(params){return"FIX"===params.qType&&(params.qFixedWidthDelimiters=params.qFixedWidthDelimiters.toString(),params.qLabel="no labels","1"!==params.qFixedWidthDelimiters&&0!==params.qFixedWidthDelimiters.indexOf("1,")&&(params.qFixedWidthDelimiters="1,"+params.qFixedWidthDelimiters)),params}function merge(){var i,obj,attrname,result={};for(i=0;i<arguments.length;i++){obj=arguments[i];for(attrname in obj)obj.hasOwnProperty(attrname)&&(result[attrname]=obj[attrname])}return result}function guessFileType(dataconnectorId,singleFileName){var guessPromise=singleFileName?engine.currentApp.guessFileType(dataconnectorId,singleFileName):engine.currentApp.guessFileType(dataconnectorId);return guessPromise}var bnfModel,codepageOptionsList,singleFileName,dataconnectorId=dataconnectorInstance.id;singleFileName=connectionInput?connectionInput.singleFileName:tableModelToEdit?tableModelToEdit.data.databaseName:void 0;var fileSettingsModel,fileScriptGenerator,hasTables,forceSelectTables,tablesTitle,allFileTypes=["TYPE9_FIX","TYPE9_EXCEL_OOXML","TYPE9_EXCEL_BIFF","TYPE9_HTML","TYPE9_XML","TYPE9_KML","TYPE9_CSV","TYPE9_QVD","TYPE9_QVX"],fileTypesWithTables=["TYPE9_EXCEL_OOXML","TYPE9_EXCEL_BIFF","TYPE9_HTML","TYPE9_XML","TYPE9_KML"];return Deferred.all({codepageOptions:codepageOptions.getCodepageOptionsPromise(),bnfModel:BnfModel.getReloadScriptBnfModel()}).then(function(response){codepageOptionsList=response.codepageOptions,bnfModel=response.bnfModel,fileSettingsModel=new FileSettingsModel(dataconnectorInstance,codepageOptionsList,dataconnectionSelectionEditor),fileScriptGenerator=new FileScriptGenerator.createScriptGenerator(dataconnectorInstance,fileSettingsModel,bnfModel);var providerPromise=guessFileType(dataconnectorId,singleFileName).then(function(guessResult){guessResult.qDataFormat.qType="TYPE9_"+guessResult.qDataFormat.qType,-1===allFileTypes.indexOf(guessResult.qDataFormat.qType)&&(guessResult.qDataFormat.qType="TYPE9_CSV"),fileSettingsModel.getSettingsModelForFile(singleFileName).setSettingsGuess(guessResult.qDataFormat),forceSelectTables=!tableModelToEdit&&("TYPE9_XML"===guessResult.qDataFormat.qType||"TYPE9_CSV"===guessResult.qDataFormat.qType||"TYPE9_QVD"===guessResult.qDataFormat.qType||"TYPE9_QVX"===guessResult.qDataFormat.qType||"TYPE9_JSON"===guessResult.qDataFormat.qType||"TYPE9_KML"===guessResult.qDataFormat.qType),hasTables=fileTypesWithTables.indexOf(guessResult.qDataFormat.qType)>-1,tablesTitle="scripteditor.dataconnectors."+("TYPE9_XML"===guessResult.qDataFormat.qType||"TYPE9_HTML"===guessResult.qDataFormat.qType?"tables":"sheets");var fileSelectDialogContentProvider={getConnectionInfo:function(){return qvangular.promise({dbusage:!1,ownerusage:!1,dbfirst:!1,specialchars:"! \"$&'()*+,-/:;<>`{}~[]\r\n	",dbseparator:"",ownerseparator:"",quotesuffix:'"',quoteprefix:'"',quotesuffixfordoublequotes:"]",quoteprefixfordoublequotes:"[",keywords:[]})},getDatabases:function(){return isWebFile?qvangular.promise([{qName:""}]):qvangular.promise([{qName:singleFileName}])},getOwners:function(){var i,owners=[];for(i=0;i<allFileTypes.length;i++)owners.push({qName:allFileTypes[i],qIsDefault:allFileTypes[i]===guessResult.qDataFormat.qType});return qvangular.promise(owners)},getTables:function(databaseName,ownerName){if(fileTypesWithTables.indexOf(ownerName)>-1){var newType=removeTYPE9(ownerName),qDataFormat={qType:newType},params={qConnectionId:dataconnectorId,qRelativePath:databaseName,qDataFormat:qDataFormat};return("TYPE9_XML"===ownerName||"TYPE9_JSON"===ownerName||"TYPE9_KML"===ownerName?engine.currentApp.getFileTablesEx(params):engine.currentApp.getFileTables(params)).then(function(result){if(result.qTables.length>0){if(forceSelectTables){for(var i=0;i<result.qTables.length;i++)if(dataconnectionSelectionEditor){var tableModel=dataconnectionSelectionEditor.getOrCreateTableModelByDatabasePath(databaseName,ownerName,result.qTables[i].qName),settingsModelForTable=fileSettingsModel.getSettingsModelForTable(databaseName,ownerName,result.qTables[i].qName);settingsModelForTable.setFormatSpec(result.qTables[i].qFormatSpec),tableModel.setFormatSpec(result.qTables[i].qFormatSpec)}else fileSettingsModel.getSettingsModelForTable(databaseName,ownerName,result.qTables[i].qName).setFormatSpec(result.qTables[i].qFormatSpec);result.qTables[0].qIsDefault=!0}return result.qTables}return[]},function(error){return 3002!==error.code&&(error.isHandled=!0),[]})}if(isWebFile)return qvangular.promise([{qName:dataconnectorInstance.name,qIsDefault:!0}]);var lastSlash=singleFileName.lastIndexOf("\\"),fileName=lastSlash>=0?singleFileName.substring(lastSlash+1):singleFileName,fileEndingDot=fileName.lastIndexOf("."),fileNameWithoutExtension=fileEndingDot>=0?fileName.substring(0,fileEndingDot):fileName;return qvangular.promise([{qName:fileNameWithoutExtension,qIsDefault:!0}])},getFields:function(databaseName,ownerName,tableName){hasTables=fileTypesWithTables.indexOf(ownerName)>-1;var newType=removeTYPE9(ownerName),standardParams={qType:newType},extraFileParams=fileSettingsModel.getSettingsModelForFile(databaseName).getParamsForEngine(),extraTableParams=fileSettingsModel.getSettingsModelForTable(databaseName,ownerName,tableName).getParamsForEngine(),qDataFormat=doSpecialParamModficationsBeforeSendingItToBackend(merge(standardParams,extraFileParams,extraTableParams)),params=hasTables?{qConnectionId:dataconnectorId,qRelativePath:databaseName,qTable:tableName,qDataFormat:qDataFormat}:{qConnectionId:dataconnectorId,qRelativePath:databaseName,qTable:"",qDataFormat:qDataFormat};return engine.currentApp.getFileTableFields(params).then(function(result){var fileSettingsForTable=fileSettingsModel.getSettingsModelForTable(databaseName,ownerName,tableName);if(fileSettingsForTable.setFormatSpec(result.qFormatSpec),dataconnectionSelectionEditor){var tableModel=dataconnectionSelectionEditor.getOrCreateTableModelByDatabasePath(databaseName,ownerName,tableName);tableModel.data.fileFormatSettings=fileSettingsForTable.getParamsForEngine(),tableModel.setFormatSpec(result.qFormatSpec)}return result.qFields},function(error){return error.isHandled=!0,[]})},getPreview:function(databaseName,ownerName,tableName){hasTables=fileTypesWithTables.indexOf(ownerName)>-1;var newType=removeTYPE9(ownerName),standardParams={qType:newType},extraFileParams=fileSettingsModel.getSettingsModelForFile(databaseName).getParamsForEngine(),extraTableParams=fileSettingsModel.getSettingsModelForTable(databaseName,ownerName,tableName).getParamsForEngine(),qDataFormat=doSpecialParamModficationsBeforeSendingItToBackend(merge(standardParams,extraFileParams,extraTableParams)),params=hasTables?{qConnectionId:dataconnectorId,qRelativePath:databaseName,qTable:tableName,qDataFormat:qDataFormat}:{qConnectionId:dataconnectorId,qRelativePath:databaseName,qTable:"",qDataFormat:qDataFormat};return engine.currentApp.getFileTablePreview(params).then(function(result){return result.qPreview},function(error){return error.isHandled=!0,[]})},selectOptions:{databaseTitle:"scripteditor.dataconnectors.file",databasePlaceholder:"scripteditor.dataconnectors.selectfile",tablesTitle:tablesTitle,ownerTitle:"scripteditor.dataconnectors.fileformat",ownerPlaceholder:"",metadataVisible:!1,tablesLocation:"full-height-left",specialTableSettingsLocation:"top-right",databaseVisible:!1,ownerVisible:!0,tablesVisible:!0,forceSelectTables:forceSelectTables,scriptGenerator:fileScriptGenerator,showSelectionsSummary:!1,specialTableSettings:new FileSettings(fileSettingsModel),precedingLoadVisible:!1,selectFromTitleName:singleFileName,fileTypesWithTables:fileTypesWithTables,dataconnectorInstance:dataconnectorInstance,forceSelectFirstTable:!tableModelToEdit,tableModelToEdit:tableModelToEdit}};return fileSelectDialogContentProvider},function(error){var header,headerParameter,content;return error.isHandled=!0,tableModelToEdit&&tableModelToEdit.data&&tableModelToEdit.data.databaseName?(header="quickdataload.EditSelections.FileNoLongerExistsHeader",headerParameter=tableModelToEdit.data.databaseName,content="quickdataload.EditSelections.FileNoLongerExistsContent"):(header="ErrorDialog.Title",content="ErrorCode."+error.code),confirmDialog.confirmAction({header:header,headerParameter:headerParameter,content:content,showDeclineButton:!1,confirmButtonTitle:"Common.Close"}).resultPromise.then(function(){qvDialogContext.back()}),!1});return providerPromise})}var exports={createNativeFileProvider:createNativeFileProvider};return exports}),define("assets/hldm/data-connectors/native-file-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-file-connector/native-file-provider","translator"],function(template,nativeFileProvider,translator){return{template:template,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",connectionInput:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope",function($scope){$scope.dataHasLoaded=!1,nativeFileProvider.createNativeFileProvider($scope.dataconnectorInstance,$scope.dataconnectionSelectionEditor,$scope.connectionInput,$scope.tableModelToEdit,$scope.qvDialogContext,!1).then(function(result){$scope.qvDialogContext.size="L",$scope.qvDialogContext.title=$scope.tableModelToEdit?translator.get("quickdataload.EditSelectionsFor",$scope.tableModelToEdit.data.tableName):translator.get("quickdataload.SelectData"),$scope.provider=result,$scope.dataHasLoaded=!0})}]}}),define("assets/hldm/data-connectors/native-file-connector/connector-main",["assets/hldm/data-connectors/native-file-connector/connect-step","assets/hldm/data-connectors/native-file-connector/select-step","scripteditor.services/file-formats","translator"],function(connectStep,selectStep,fileFormats,translator){function supportedName(name){switch(name){case"scripteditor.flatfilechooser.files.excel":case"scripteditor.flatfilechooser.files.delimited":case"scripteditor.flatfilechooser.files.all":return!0;default:return!1}}function create(){function getInitialSelectStep(){return selectStep}function getInitialFileDropStep(){return selectStep}var entrypoints=fileFormats.getFileFilters().filter(function(item){return supportedName(item.title)}).map(function(filter){return{id:filter.title,category:"file",name:translator.get(filter.titleShort),initialConnectStep:connectStep}}).sort(function(a){return"scripteditor.flatfilechooser.files.all"===a.id?-1:1}),connector={entrypoints:entrypoints,getInitialSelectStep:getInitialSelectStep,getInitialFileDropStep:getInitialFileDropStep};return connector}var exports={create:create};return exports}),define("text!assets/hldm/data-connectors/native-odbc-connector/connect-step.ng.html",[],function(){return'<div class="native-odbc-connector-connect">\r\n	<div class="loading-screen" ng-show="isLoading">\r\n		<div class="qv-loader"></div>\r\n	</div>\r\n	<main class="dm-main">\r\n		<div class="qui-buttongroup">\r\n			<button class="qui-button" ng-class="{ \'qui-active\': isDSNButtonActive(DSN_TYPE_USER) }" ng-disabled="isLoading" q-translation="scripteditor.dataconnectors.createdialog.label.userdsn" qva-activate="onDSNTypeClicked(DSN_TYPE_USER)" tid="selectUserOdbcDatasources"></button>\r\n			<button class="qui-button" ng-class="{ \'qui-active\': isDSNButtonActive(DSN_TYPE_SYSTEM) }" ng-disabled="isLoading" q-translation="scripteditor.dataconnectors.createdialog.label.systemdsn" qva-activate="onDSNTypeClicked(DSN_TYPE_SYSTEM)" tid="selectSystemOdbcDatasources"></button>\r\n		</div>\r\n		<div class="options" ng-class="{\'visible\': showFilter32Or64Bit()}">\r\n			<div ng-show="showFilter32Or64Bit();">\r\n				<qui-radiobuttongroup\r\n						qui-group-name="radioButton32or64"\r\n						qui-options=\'{ "{{BIT_TYPE_32_KEY}}": "{{BIT_TYPE_32}}", "{{BIT_TYPE_64_KEY}}": "{{BIT_TYPE_64}}"}\'\r\n						qui-selected-value="radioButton32or64"\r\n						qui-disabled="isLoading">\r\n				</qui-radiobuttongroup>\r\n			</div>\r\n		</div>\r\n		<div class="ds-list">\r\n			<ul class="datasource-list">\r\n				<li class="qui-menu-item" ng-repeat="datasource in datasources | filter: filter32Or64Bit | filter: filterUserOrSystem">\r\n					<div class="item" ng-class="{disabled: isDatasourceListDisabled(), selected: isSelected(datasource)}" qva-activate="onDatasourceClicked(datasource)" tid="selectDsnItem">\r\n						{{datasource.qName}}\r\n					</div>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n		<div class="options-force32" ng-class="{\'visible\': showForce32bit()}">\r\n			<div ng-show="showForce32bit();">\r\n				<label class="qui-checkboxicon">\r\n					<input type="checkbox" id="odbcForce32" ng-model="dataconnectorForce32" ng-disabled="isOkDisabled()">\r\n\r\n					<div class="check-wrap">\r\n						<span class="check"></span>\r\n						<span class="check-text" q-translation="scripteditor.dataconnectors.createdialog.label.force32bit">#force32#</span>\r\n					</div>\r\n				</label>\r\n			</div>\r\n		</div>\r\n		<div class="credent-list">\r\n			<table>\r\n				<tr>\r\n					<td>\r\n						<p q-translation="Common.Username"></p>\r\n					</td>\r\n					<td>\r\n						<p q-translation="Common.Password"></p>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td class="first">\r\n						<input class="qui-input odbctextfield" type="text" maxlength="128" ng-disabled="allowNameInput()" ng-model="dataconnectorUsername" ng-disabled="isLoading"/>\r\n					</td>\r\n					<td>\r\n						<input class="qui-input odbctextfield" type="password" maxlength="128" ng-disabled="allowNameInput()" ng-model="dataconnectorPassword" ng-disabled="isLoading"/>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td colspan="4">\r\n						<label for="dataconnectorName" q-translation="Common.Name"></label>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td colspan="4">\r\n						<input class="qui-input odbctextfield" id="dataconnectorName" name="dataconnectorName"\r\n							   type="text" ng-disabled="allowNameInput()" ng-model="dataconnectorName"\r\n							   ng-disabled="isLoading" invalid="{{isNameInvalid()}}" ng-change="onNameChanged()" maxlength="{{maxConnectionNameLength}}"/>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td colspan="4">\r\n						<span ng-style="{visibility: showNameValidationError() && \'visible\' || \'hidden\'}" class="errorlabel" q-translation="Common.InvalidCharacters"></span>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</main>\r\n</div>\r\n'}),define("assets/hldm/data-connectors/native-odbc-connector/connect-step",["text!./connect-step.ng.html","scripteditor.utils/string-util","core.models/engine","translator"],function(template,stringUtil,engine,translator){return{template:template,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"="},controller:["$scope",function($scope){function init(){engine.global.getOdbcDsns().then(function(result){$scope.datasources=result.qOdbcDsns,$scope.isEdit?serverside.getConnection($scope.id).then(function(result){$scope.isLoading=!1,$scope.dataconnectorName=result.qConnection.qName,setDatasourceInEditMode(result.qConnection.qConnectionString)}):$scope.isLoading=!1})}function nextDisabled(){return $scope.isLoading||!$scope.selectedDatasource||!$scope.dataconnectorName||!stringUtil.isValidConnectionName($scope.dataconnectorName)}function getConnectionType(){return selectedDSNType===$scope.DSN_TYPE_USER?$scope.dataconnectorForce32?CONN32:CONN64:$scope.radioButton32or64===$scope.BIT_TYPE_32?CONN32:CONN64}function getDsnNameFromConnectionString(connStr){var i,connArr=connStr.match(/"[^=]*"|[^;]+/g);for(i=0;i<connArr.length;i++)if(-1!==connArr[i].indexOf("DSN"))return connArr[i].split("=")[1];return""}function setDatasourceInEditMode(connStr){var dsnName=getDsnNameFromConnectionString(connStr);$scope.datasources.forEach(function(ds){return ds.qName===dsnName?($scope.selectedDatasource=ds,$scope.filter32Or64Bit(ds),selectedDSNType=ds.qUserOnly?$scope.DSN_TYPE_USER:$scope.DSN_TYPE_SYSTEM,void($scope.radioButton32or64=ds.qBit32?$scope.BIT_TYPE_32:$scope.BIT_TYPE_64)):void 0}),selectedDSNType===$scope.DSN_TYPE_USER&&($scope.dataconnectorForce32=stringUtil.startsWith(connStr,"ODBC "+CONN32))}var serverside=$scope.serverside,input=$scope.input;$scope.qvDialogContext.title=translator.get("scripteditor.dataconnectors.odbcconnect.title"),$scope.qvDialogContext.size="S",$scope.qvDialogContext.nextDisabled=nextDisabled,$scope.DSN_TYPE_USER="USER",$scope.DSN_TYPE_SYSTEM="SYSTEM",$scope.BIT_TYPE_32="32",$scope.BIT_TYPE_64="64",$scope.BIT_TYPE_32_KEY=translator.get("Common.32bit"),$scope.BIT_TYPE_64_KEY=translator.get("Common.64bit");var selectedDSNType=$scope.DSN_TYPE_SYSTEM,CONN32="CONNECT32",CONN64="CONNECT";$scope.isEdit=input.editMode,$scope.id=input.instanceId,$scope.isLoading=!0,$scope.dataconnectorName="",$scope.selectedDatasource="",$scope.dataconnectorUsername="",$scope.dataconnectorPassword="",$scope.dataconnectorForce32=!1,$scope.nameChangedAtLeastOnce=!1,$scope.radioButton32or64=$scope.BIT_TYPE_64,$scope.maxConnectionNameLength=stringUtil.MAX_CONNECTION_NAME_LENGTH,$scope.onDSNTypeClicked=function(type){selectedDSNType=type,$scope.resetSelection()},$scope.isDSNButtonActive=function(type){return selectedDSNType===type},$scope.isSelected=function(datasource){return datasource===$scope.selectedDatasource},$scope.showFilter32Or64Bit=function(){return selectedDSNType===$scope.DSN_TYPE_SYSTEM},$scope.showForce32bit=function(){return selectedDSNType===$scope.DSN_TYPE_USER},$scope.filter32Or64Bit=function(datasource){if(datasource.qUserOnly)return!0;var bitType=datasource.qBit32?$scope.BIT_TYPE_32:$scope.BIT_TYPE_64;return $scope.radioButton32or64===bitType},$scope.filterUserOrSystem=function(datasource){var DSNType=datasource.qUserOnly?$scope.DSN_TYPE_USER:$scope.DSN_TYPE_SYSTEM;return selectedDSNType===DSNType},$scope.isDatasourceListDisabled=function(){return $scope.isLoading},$scope.onDatasourceClicked=function(datasource){$scope.isDatasourceListDisabled()||($scope.selectedDatasource=datasource,$scope.isEdit||$scope.nameChangedAtLeastOnce||($scope.dataconnectorName=datasource.qName.replace(/[\\\/:\*\t\?"'<>\|]/g,"-")))},$scope.resetSelection=function(){$scope.selectedDatasource=void 0,$scope.isEdit||($scope.nameChangedAtLeastOnce||($scope.dataconnectorName=""),$scope.dataconnectorUsername="",$scope.dataconnectorPassword=""),$scope.dataconnectorForce32=!1},$scope.allowNameInput=function(){
return""===$scope.selectedDatasource},$scope.onNameChanged=function(){$scope.nameChangedAtLeastOnce=!0},$scope.isNameInvalid=function(){return $scope.dataconnectorName?!stringUtil.isValidConnectionName($scope.dataconnectorName):$scope.nameChangedAtLeastOnce},$scope.showNameValidationError=function(){return""!==$scope.dataconnectorName&&$scope.isNameInvalid()},$scope.buildConnectionString=function(){var connectionString="ODBC "+getConnectionType()+" TO ["+$scope.selectedDatasource.qName+"]";return connectionString},$scope.qvDialogContext.next=function(){if(!$scope.qvDialogContext.nextDisabled())if($scope.isLoading=!0,$scope.isEdit){var overrideCredentials=""!==$scope.dataconnectorUsername&&""!==$scope.dataconnectorPassword;serverside.modifyConnection($scope.id,$scope.dataconnectorName,$scope.buildConnectionString(),"ODBC",overrideCredentials,$scope.dataconnectorUsername,$scope.dataconnectorPassword).then(function(result){$scope.isLoading=!1,result&&$scope.destroyComponent()})}else serverside.createNewConnectionAPI($scope.dataconnectorName,$scope.buildConnectionString(),"ODBC",$scope.dataconnectorUsername,$scope.dataconnectorPassword).then(function(result){$scope.isLoading=!1,result&&$scope.continueWithNewConnection({connectionName:$scope.dataconnectorName})},function(){$scope.isLoading=!1})},$scope.onEscape=$scope.onCancelClicked=function(){$scope.close()},init()}]}}),define("text!assets/hldm/data-connectors/native-odbc-connector/select-step.ng.html",[],function(){return'<div class="native-odbc-connector-select">\r\n	<qv-generic-select-dialog data-provider="provider"\r\n							  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\r\n							  data-qv-dialog-context="qvDialogContext"\r\n							  data-qv-internals="qvInternals">\r\n	</qv-generic-select-dialog>\r\n</div>\r\n'}),define("assets/hldm/data-connectors/native-odbc-connector/odbc-provider",["core.models/engine"],function(engine){function bool(value){return value&&"false"!==value?!0:!1}function createNativeDatabaseProvider(connectionId,tableModelToEdit){function getConnectionInfo(){return engine.currentApp.getDatabaseInfo({qConnectionId:connectionId}).then(function(result){return{dbusage:bool(result.qInfo.qDBUsage),ownerusage:bool(result.qInfo.qOwnerUsage),dbfirst:bool(result.qInfo.qDBFirst),specialchars:result.qInfo.qSpecialChars,dbseparator:result.qInfo.qDBSeparator,defaultdatabase:result.qInfo.qDefaultDatabase,ownerseparator:result.qInfo.qOwnerSeparator,quotesuffix:result.qInfo.qQuoteSuffix||"",quoteprefix:result.qInfo.qQuotePreffix||result.qInfo.qQuotePrefix||"",dbmsname:result.qInfo.qDBMSName,keywords:result.qInfo.qKeywords}},function(error){return error.isHandled=!0,{dbusage:!1,ownerusage:!1,dbfirst:!1,specialchars:"",dbseparator:"",defaultdatabase:"",ownerseparator:"",quotesuffix:"",quoteprefix:"",dbmsname:"",keywords:""}})}function getDatabases(){return engine.currentApp.getDatabases({qConnectionId:connectionId}).then(function(result){return result.qDatabases},function(error){return error.isHandled=!0,[]})}function getOwners(databaseName){return engine.currentApp.getDatabaseOwners({qConnectionId:connectionId,qDatabase:databaseName}).then(function(result){return result.qOwners},function(error){return error.isHandled=!0,[]})}function getTables(databaseName,ownerName){return engine.currentApp.getDatabaseTables({qConnectionId:connectionId,qDatabase:databaseName,qOwner:ownerName}).then(function(result){return result.qTables},function(error){return error.isHandled=!0,[]})}function getFields(databaseName,ownerName,tableName){return engine.currentApp.getDatabaseTableFields({qConnectionId:connectionId,qDatabase:databaseName,qOwner:ownerName,qTable:tableName}).then(function(result){return result.qFields},function(error){return error.isHandled=!0,[]})}function getPreview(databaseName,ownerName,tableName){return engine.currentApp.getDatabaseTablePreview({qConnectionId:connectionId,qDatabase:databaseName,qOwner:ownerName,qTable:tableName}).then(function(result){return result.qPreview},function(error){return error.isHandled=!0,[]})}var odbcSelectDialogContentProvider={getConnectionInfo:getConnectionInfo,getDatabases:getDatabases,getOwners:getOwners,getTables:getTables,getFields:getFields,getPreview:getPreview,selectOptions:{tableModelToEdit:tableModelToEdit}};return odbcSelectDialogContentProvider}var exports={createNativeDatabaserProvider:createNativeDatabaseProvider};return exports}),define("assets/hldm/data-connectors/native-odbc-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-odbc-connector/odbc-provider","translator"],function(template,OdbcProvider,translator){return{template:template,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope",function($scope){$scope.qvDialogContext.size="L",$scope.qvDialogContext.title=$scope.tableModelToEdit?translator.get("quickdataload.EditSelectionsFor",$scope.tableModelToEdit.data.tableName):translator.get("quickdataload.SelectData"),$scope.provider=OdbcProvider.createNativeDatabaserProvider($scope.dataconnectorInstance.id,$scope.tableModelToEdit)}]}}),define("assets/hldm/data-connectors/native-odbc-connector/connector-main",["assets/hldm/data-connectors/native-odbc-connector/connect-step","assets/hldm/data-connectors/native-odbc-connector/select-step","translator"],function(connectStep,selectStep,translator){function create(){function getInitialSelectStep(){return selectStep}var entrypoints=[{id:"odbc",category:"database",name:translator.get("scripteditor.dataconnectors.ODBC"),initialConnectStep:connectStep}],connector={entrypoints:entrypoints,getInitialSelectStep:getInitialSelectStep};return connector}var exports={create:create};return exports}),define("text!assets/hldm/data-connectors/native-oledb-connector/connect-step.ng.html",[],function(){return'<div class="native-oledb-connector-connect">\r\n	<div class="loading-screen" ng-show="isLoading">\r\n		<div class="qv-loader"></div>\r\n	</div>\r\n	<main class="dm-main">\r\n		<div class="flex-cont">\r\n			<div ng-show="connectionInstance.isEdit" ng-class="{\'rawStr-edit\': connectionInstance.isEdit}">\r\n				<label for="rawConnectionString" q-translation="scripteditor.dataconnectors.connectionstring" maxlength="1000">Connection string</label>\r\n				<input class="qui-input oledbtextfield" data-size="tiny" name="rawConnectionString" id="rawConnectionString" type="text" ng-model="rawConnectionString" ng-disabled="isLoading" ng-change="onNameChanged()" maxlength="1000">\r\n			</div>\r\n\r\n			<div class="con-edit" ng-hide="connectionInstance.isEdit">\r\n				<label translate="title" q-translation="scripteditor.dataconnectors.provider">Provider</label>\r\n				<qui-select class="datasource-list" qui-model="connectionInstance.selectedDataprovider" qui-disabled="isLoading" qui-options="datasource.qDescription for datasource in datasources" qui-tid="oleDbProvider">\r\n					<option value="" q-translation="scripteditor.dataconnectors.selectprovider"></option>\r\n				</qui-select>\r\n			</div>\r\n\r\n			<div class="serversection">\r\n				<div ng-hide="connectionInstance.isEdit">\r\n					<label translate="title" q-translation="scripteditor.dataconnectors.servername">Server</label>\r\n					<input class="qui-input oledbtextfield" data-size="tiny" name="connectionInstance.serverName" type="text" ng-model="connectionInstance.serverName" ng-disabled="isLoading || connectionInstance.selectedDataprovider == \'\'" maxlength="200" tid="oleDbServerName">\r\n\r\n					<div class="choosesecuritysection">\r\n						<qui-radiobutton qui-name="choosesecuritysection" qui-label="{{ \'scripteditor.dataconnetors.integratedsecurity\' | translate }}" qui-value="integrated" qui-model="connectionInstance.serverOptions.security" qui-disabled="!hasSecurityOption(\'integrated\')"></qui-radiobutton>\r\n						<qui-radiobutton qui-name="choosesecuritysection" qui-label="{{ \'scripteditor.dataconnetors.specificsecurity\' | translate }}" qui-value="specific" qui-model="connectionInstance.serverOptions.security" qui-disabled="!hasSecurityOption(\'specific\')"></qui-radiobutton>\r\n					</div>\r\n				</div>\r\n				<div class="specificsecuritysection">\r\n					<label translate="title" q-translation="Common.Username">Username</label>\r\n					<input class="qui-input oledbtextfield" data-size="tiny" tid="6d9333" name="userName" type="text" ng-model="connectionInstance.serverOptions.username" ng-disabled="isLoading || (!connectionInstance.isEdit && !isSpecificSecurity())" maxlength="200">\r\n					<label translate="title" q-translation="Common.Password">Password</label>\r\n					<input class="qui-input oledbtextfield" data-size="tiny" tid="6d9332" name="password" type="password" ng-model="connectionInstance.serverOptions.password" ng-disabled="isLoading || (!connectionInstance.isEdit && !isSpecificSecurity())" maxlength="200">\r\n				</div>\r\n			</div>\r\n\r\n			<div class="test-container">\r\n				<span class="test-result-icon {{resultColorTheme}}" data-icon="{{testResultIcon}}"></span><span>{{connectionTestMessage}}</span>\r\n				<button class="qui-button tst-btn" qva-activate="$event.preventDefault(); onTestClicked()" q-translation="scripteditor.dataconnectors.testconnection" ng-disabled="isTestDisabled() || isLoading" tid="2e6841"></button>\r\n			</div>\r\n\r\n			<div class="db-container">\r\n				<label translate="title" ng-hide="connectionInstance.isEdit" q-translation="scripteditor.dataconnectors.database">Database</label>\r\n\r\n				<div ng-hide="connectionInstance.isEdit">\r\n					<button class="qui-button load-button" qva-activate="getDatabases()" ng-disabled="isLoadDisabled()" q-translation="scripteditor.dataconnectors.load" tid="loadDefaultDatabases">Load</button>\r\n					<qui-select class="database-list" qui-model="connectionInstance.selectedDatabase" qui-disabled="!databasesLoaded" qui-options="database.qName for database in databases" qui-tid="defaultDatabase">\r\n						<option value="" q-translation="scripteditor.dataconnectors.selectdatabase"></option>\r\n					</qui-select>\r\n				</div>\r\n			</div>\r\n\r\n			<div class="conName" ng-class="{\'error\': showCreateConnectionError}">\r\n				<label for="dataconnectorName" q-translation="Common.Name" class="name"></label>\r\n				<input class="qui-input oledbtextfield" data-size="tiny" tid="6e9333" name="dataconnectorName" id="dataconnectorName" type="text" ng-enabled="allowNameInput()" ng-model="connectionInstance.name" ng-disabled="isLoading" invalid="{{isNameInvalid()}}" ng-change="onNameChanged()" maxlength="{{maxConnectionNameLength}}">\r\n				<label ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</label>\r\n			</div>\r\n		</div>\r\n	</main>\r\n</div>'}),define("assets/hldm/data-connectors/native-oledb-connector/connect-step",["translator","text!./connect-step.ng.html","scripteditor.utils/string-util","core.models/engine"],function(translator,template,stringUtil,engine){return{template:template,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"="},controller:["$scope","serverside","input","$timeout",function($scope,serverside,input,$timeout){function init(){engine.global.getOleDbProviders().then(function(datasources){for(var i=0;i<datasources.qOleDbProviders.length;i++)datasources.qOleDbProviders[i].qBit32&&(datasources.qOleDbProviders[i].qDescription=datasources.qOleDbProviders[i].qDescription+"(32-bit)");$scope.datasources=datasources.qOleDbProviders,$scope.connectionInstance.isEdit?($scope.initializing=!0,serverside.getConnection($scope.connectionInstance.id).then(function(result){$scope.isLoading=!1,$scope.connectionInstance.name=result.qConnection.qName,$scope.rawConnectionString=result.qConnection.qConnectionString,setDatasourceInEditMode(result.qConnection.qConnectionString),setCredentialInfoInEditMode(result.qConnection.qConnectionString),extraConnectionParameters=getExtraConnectionParameters(result.qConnection.qConnectionString)})):($scope.connectionInstance.serverOptions={security:"specific",username:"",password:""},$scope.isLoading=!1)})}function nextDisabled(){return $scope.connectionInstance.isEdit?$scope.isLoading:$scope.isLoading||!$scope.connectionInstance.selectedDataprovider||!$scope.connectionInstance.name||!stringUtil.isValidConnectionName($scope.connectionInstance.name)||!$scope.connectionInstance.serverName||$scope.connectionInstance.serverName.length<1}function buildSecurityString(includePwd){return $scope.connectionInstance.serverOptions.security||$scope.connectionInstance.serverOptions.username?"integrated"===$scope.connectionInstance.serverOptions.security?"Integrated Security=SSPI;":includePwd?"User Id="+$scope.connectionInstance.serverOptions.username+";Password="+$scope.connectionInstance.serverOptions.password+";":"":""}function buildConnectionStringWithExtraParameters(){var mergedConnectionString,baseConnStr=buildConnectionString();return mergedConnectionString=baseConnStr.substring(0,baseConnStr.length-1)+extraConnectionParameters+"]"}function buildConnectionString(includePwd){var connect=$scope.connectionInstance.selectedDataprovider.qBit32?"CONNECT32":"CONNECT",security=buildSecurityString(includePwd),server="Data Source="+$scope.connectionInstance.serverName+";",database=""!==$scope.connectionInstance.databaseName?"Initial Catalog="+$scope.connectionInstance.databaseName+";":"",connStr="OLEDB "+connect+" TO [Provider="+$scope.connectionInstance.dataconnectorTypeName+";"+security+server+database+"]";return $scope.connectionInstance.isEdit&&(connStr=-1!==$scope.rawConnectionString.indexOf("Integrated Security=SSPI")?$scope.rawConnectionString:$scope.rawConnectionString.slice(0,$scope.rawConnectionString.lastIndexOf(";"))+";"+security+"]"),connStr}function setDatasourceInEditMode(connectionString){var provider=stringUtil.getValueFromConnectionString(connectionString,"provider"),datasource=stringUtil.getValueFromConnectionString(connectionString,"data source"),is32Bit=-1!==connectionString.toLowerCase().indexOf("oledb connect32");$scope.connectionInstance.serverName=datasource,setSelectedDatasource(provider,is32Bit)}function setSelectedDatasource(name,is32Bit){for(var i=0;i<$scope.datasources.length;i++)if($scope.datasources[i].qName===name&&(is32Bit===$scope.datasources[i].qBit32||!$scope.datasources[i].qBit32))return void($scope.connectionInstance.selectedDataprovider=$scope.datasources[i])}function setCredentialInfoInEditMode(connectionString){var securityMode=stringUtil.getValueFromConnectionString(connectionString,"integrated security");""!==securityMode?$scope.connectionInstance.serverOptions={security:"integrated",username:"",password:""}:$scope.connectionInstance.serverOptions={security:"specific",username:"",password:""}}function getExtraConnectionParameters(connectionString){var connectionStringTokens=stringUtil.tokenizeConnectionString(connectionString),resultParams="";return connectionStringTokens.forEach(function(token){"provider"!==token.key.toLowerCase()&&"data source"!==token.key.toLowerCase()&&"integrated security"!==token.key.toLowerCase()&&(resultParams+=token.key+"="+token.value+";")}),resultParams}$scope.connectionInstance={id:input.instanceId,isEdit:input.editMode,name:"",typeName:"",is32Bit:!1,databaseName:"",selectedDatabase:"",selectedDataprovider:"",serverName:"",serverOptions:{},connectionInputOK:!1,connectionTestOK:!1},$scope.qvDialogContext.title=translator.get("scripteditor.dataconnectors.oledbconnect.title"),$scope.qvDialogContext.nextDisabled=nextDisabled,$scope.qvDialogContext.size="S",$scope.qvDialogContext.customCss={},$scope.qvDialogContext.cstmClass={"native-oledb":!0},$scope.testResultIcon="",$scope.resultColorTheme="",$scope.isLoading=!0,$scope.initializing=!1,$scope.previousServerName="",$scope.nameChangedAtLeastOnce=!1,$scope.databases=[],$scope.databasesLoaded=!1,$scope.serverOK=!1,$scope.rawConnectionString="",$scope.providerCredentialSettings={"Microsoft.ACE.OLEDB.12.0":{integrated:!1,specific:!0},MSDASQL:{integrated:!1,specific:!0},"MSDASQL Enumerator":{integrated:!1,specific:!0},MSOLAP:{integrated:!0,specific:!0},SQLOLEDB:{integrated:!0,specific:!0},MSDataShape:{integrated:!0,specific:!0},SQLNCLI11:{integrated:!0,specific:!0},"SQLNCLI Enumerator":{integrated:!0,specific:!0},ADsDSOObject:{integrated:!0,specific:!0},SQLNCLI:{integrated:!0,specific:!0},"SQLNCLI11 Enumerator":{integrated:!0,specific:!0},"SQLOLEDB Enumerator":{integrated:!0,specific:!0},MSDAOSP:{integrated:!1,specific:!1},MSIDXS:{integrated:!0,specific:!1},"OraOLEDB.Oracle":{integrated:!1,specific:!0},MSDAORA:{integrated:!1,specific:!0}},$scope.maxConnectionNameLength=stringUtil.MAX_CONNECTION_NAME_LENGTH;var extraConnectionParameters="";$scope.getDatabases=function(){$scope.serverOK=!1,$scope.isLoading=!0,""===$scope.serverName?($scope.databases=[],$scope.connectionInstance.selectedDatabase=null,$scope.isLoading=!1):$scope.connectionInstance.selectedDataprovider&&engine.global.getDatabasesFromConnectionString({qConnectionString:buildConnectionString(!0)}).then(function(result){$scope.databasesLoaded=!0,$scope.isLoading=!1,result&&($scope.databases=result.qDatabases,$scope.serverOK=!0)},function(error){error.code=void 0,error.message=translator.get("scripteditor.dataconnectors.connecterror"),$scope.databasesLoaded=!1,$scope.isLoading=!1,$scope.serverOK=!1}),$scope.previousServerName=$scope.connectionInstance.serverName},$scope.isDatasourceListDisabled=function(){return $scope.isLoading},$scope.isSpecificSecurity=function(){return $scope.connectionInstance.serverOptions?"specific"===$scope.connectionInstance.serverOptions.security:!1},$scope.isTestDisabled=function(){return!$scope.connectionInstance.isEdit&&($scope.isLoading||!$scope.connectionInstance.selectedDataprovider||!$scope.connectionInstance.name||!$scope.connectionInstance.serverName||$scope.connectionInstance.serverName.length<1)},$scope.isLoadDisabled=function(){return""===$scope.connectionInstance.serverName||$scope.isLoading||!$scope.connectionInstance.selectedDataprovider},$scope.isNameInvalid=function(){return $scope.connectionInstance.name?!stringUtil.isValidConnectionName($scope.connectionInstance.name):$scope.nameChangedAtLeastOnce},$scope.$watch("connectionInstance.name",function(){$scope.showCreateConnectionError=!1,""!==$scope.connectionInstance.name&&$scope.isNameInvalid()&&($scope.errorContent=translator.get("Common.InvalidCharacters"),$scope.showCreateConnectionError=!0)}),$scope.allowNameInput=function(){return $scope.connectionInstance.isEdit||""===$scope.connectionInstance.selectedDataprovider},$scope.hasSecurityOption=function(type){if($scope.connectionInstance.selectedDataprovider&&""!==$scope.connectionInstance.selectedDataprovider){var providerSetting=$scope.providerCredentialSettings[$scope.connectionInstance.selectedDataprovider.qName];return providerSetting?providerSetting[type]:!0}return!1},$scope.$watch("connectionInstance.selectedDataprovider",function(newValue,oldValue){newValue!==oldValue&&($scope.connectionInstance.selectedDataprovider=newValue,$scope.connectionInstance.selectedDataprovider&&($scope.databasesLoaded=!1,$scope.databases=[],$scope.connectionInstance.dataconnectorTypeName=$scope.connectionInstance.selectedDataprovider.qName,$scope.is32Bit=$scope.connectionInstance.selectedDataprovider.qBit32,$scope.initializing||($scope.hasSecurityOption("integrated")&&!$scope.hasSecurityOption("specific")?$scope.connectionInstance.serverOptions.security="integrated":$scope.connectionInstance.serverOptions.security="specific",$scope.rawConnectionString=buildConnectionStringWithExtraParameters())),$scope.initializing&&$timeout(function(){$scope.initializing=!1}))}),$scope.$watch("connectionInstance.serverName",function(newValue,oldValue){newValue!==oldValue&&($scope.connectionInstance.serverName=newValue,$scope.connectionInstance.isEdit||$scope.nameChangedAtLeastOnce?!$scope.initializing&&$scope.connectionInstance.isEdit&&($scope.rawConnectionString=buildConnectionStringWithExtraParameters()):$scope.connectionInstance.name=$scope.connectionInstance.serverName.replace(/[\\\/:\*\t\?"'<>\|]/g,"-"))}),$scope.$watch("connectionInstance.selectedDatabase",function(){$scope.connectionInstance.selectedDatabase&&($scope.connectionInstance.databaseName=$scope.connectionInstance.selectedDatabase.qName)}),$scope.$watch("connectionInstance.isEdit",function(edit){function getCustomCss(maxsize,minsize){return{"max-height":maxsize,"min-height":minsize||maxsize}}edit&&($scope.qvDialogContext.customCss=getCustomCss("400px"))}),$scope.onNameChanged=function(){$scope.nameChangedAtLeastOnce=!0},$scope.handleErrors=function(error){$scope.errorContent=serverside.getErrorContent(error),$scope.showCreateConnectionError=!0,error.isHandled=!0,$scope.isLoading=!1},$scope.qvDialogContext.next=function(){if(!nextDisabled())if($scope.isLoading=!0,$scope.connectionInstance.isEdit){var overrideCredentials=""!==$scope.connectionInstance.serverOptions.username&&""!==$scope.connectionInstance.serverOptions.password;serverside.modifyConnection($scope.connectionInstance.id,$scope.connectionInstance.name,$scope.rawConnectionString,"OLEDB",overrideCredentials,$scope.connectionInstance.serverOptions.username,$scope.connectionInstance.serverOptions.password).then(function(result){$scope.isLoading=!1,result&&$scope.destroyComponent()},$scope.handleErrors)}else serverside.createNewConnectionAPI($scope.connectionInstance.name,buildConnectionString(),"OLEDB",$scope.connectionInstance.serverOptions.username,$scope.connectionInstance.serverOptions.password).then(function(result){$scope.isLoading=!1,result&&$scope.continueWithNewConnection({connectionName:$scope.connectionInstance.name})},$scope.handleErrors)},$scope.onTestClicked=function(){$scope.isLoading=!0,engine.global.isValidConnectionString({qConnectionString:buildConnectionString(!0)}).then(function(){$scope.isLoading=!1,$scope.connectionTestMessage=translator.get("scripteditor.dataconnectors.testconnection.succeeded"),$scope.testResultIcon="tick",$scope.resultColorTheme="test-ok"},function(error){error.isHandled=!0,$scope.isLoading=!1,$scope.connectionTestMessage=translator.get("scripteditor.dataconnectors.testconnection.failed"),$scope.testResultIcon="warning-triangle",$scope.resultColorTheme="test-failed"})},$scope.onCancelClicked=function(){$scope.isLoading||$scope.destroyComponent()},init()}]}}),define("text!assets/hldm/data-connectors/native-oledb-connector/select-step.ng.html",[],function(){return'<div class="native-oledb-connector-select">\r\n	<qv-generic-select-dialog data-provider="provider"\r\n							  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\r\n							  data-qv-dialog-context="qvDialogContext"\r\n							  data-qv-internals="qvInternals">\r\n	</qv-generic-select-dialog>\r\n</div>\r\n'}),define("assets/hldm/data-connectors/native-oledb-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-odbc-connector/odbc-provider","translator"],function(template,OdbcProvider,translator){return{template:template,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope",function($scope){$scope.qvDialogContext.size="L",$scope.qvDialogContext.title=$scope.tableModelToEdit?translator.get("quickdataload.EditSelectionsFor",$scope.tableModelToEdit.data.tableName):translator.get("quickdataload.SelectData"),$scope.provider=OdbcProvider.createNativeDatabaserProvider($scope.dataconnectorInstance.id,$scope.tableModelToEdit)}]}}),define("assets/hldm/data-connectors/native-oledb-connector/connector-main",["assets/hldm/data-connectors/native-oledb-connector/connect-step","assets/hldm/data-connectors/native-oledb-connector/select-step","translator"],function(connectStep,selectStep,translator){function create(){function getInitialSelectStep(){return selectStep}var entrypoints=[{id:"oledb",category:"database",name:translator.get("scripteditor.dataconnectors.OLEDB"),initialConnectStep:connectStep}],connector={entrypoints:entrypoints,getInitialSelectStep:getInitialSelectStep};return connector}var exports={create:create};return exports}),define("text!assets/hldm/data-connectors/native-webfile-connector/connect-step.ng.html",[],function(){return'<div class="native-webfile-connector-connect flatfilechoosercontainer">\r\n	<div class="loading-screen" ng-show="isLoading">\r\n		<div class="qv-loader"></div>\r\n	</div>\r\n\r\n	<main class="dm-main">\r\n		<div class="title" q-translation="Common.URL"/>\r\n		<input id="urlInput" list="recentList" maxlength="2000" class="qui-input textfield" ng-model="path" autocapitalize="off" autocorrect="off"/>\r\n		<datalist id="recentList">\r\n			<option ng-repeat="url in recentUrls track by $index" title="{{url}}" value="{{url}}"></option>\r\n		</datalist>\r\n		<div class="text" q-translation="Common.Name"/>\r\n		<input class="qui-input textfield" ng-model="name" maxlength="{{maxConnectionNameLength}}" invalid="{{isNameInvalid()}}"/>\r\n		<label ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</label>\r\n	</main>\r\n</div>'}),define("assets/hldm/data-connectors/native-webfile-connector/connect-step",["text!./connect-step.ng.html","scripteditor.utils/string-util","translator"],function(template,stringUtil,translator){return{template:template,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"="},controller:["$scope","serverside",function($scope,serverside){function pathPrefixedWithHttp(){return stringUtil.prefixHttpToUrl($scope.path)}function getRecentUrls(){var urls=[],value=localStorage.getItem("scripteditor.webfilechooser.recentUrls");return value&&(urls=JSON.parse(value)),urls}function updateRecentUrls(newUrl){if(stringUtil.isValidUrl(newUrl)){var i,urls=getRecentUrls(),alreadyVisited=!1;for(i=0;i<urls.length;i++)newUrl===urls[i]&&(alreadyVisited=!0,urls.splice(i,1));alreadyVisited||urls.length>4&&urls.splice(0,1),urls.push(newUrl),localStorage.setItem("scripteditor.webfilechooser.recentUrls",JSON.stringify(urls))}}$scope.isLoading=!1,$scope.showRecent=!1,$scope.maxConnectionNameLength=stringUtil.MAX_CONNECTION_NAME_LENGTH,$scope.path="",$scope.qvDialogContext.title=translator.get("scripteditor.dataconnectors.filechooser.urltitle"),$scope.qvDialogContext.size="S",$scope.nextDisabled=function(){return!stringUtil.isValidConnectionName($scope.name)||!stringUtil.isValidUrl(pathPrefixedWithHttp())||$scope.isLoading},$scope.$watch("name",function(){$scope.showCreateConnectionError=!1,""!==$scope.name&&$scope.isNameInvalid()&&($scope.nameChangedAtLeastOnce=!0,$scope.errorContent=translator.get("Common.InvalidCharacters"),$scope.showCreateConnectionError=!0)}),$scope.isNameInvalid=function(){return $scope.name?!stringUtil.isValidConnectionName($scope.name):$scope.nameChangedAtLeastOnce},$scope.handleErrors=function(error){$scope.errorContent=serverside.getErrorContent(error),$scope.showCreateConnectionError=!0,error.isHandled=!0,$scope.isLoading=!1},$scope.qvDialogContext.nextDisabled=$scope.nextDisabled,$scope.qvDialogContext.next=function(){$scope.nextDisabled()||($scope.isLoading=!0,updateRecentUrls(pathPrefixedWithHttp()),$scope.isEdit?serverside.modifyConnection($scope.id,$scope.name,pathPrefixedWithHttp(),"internet",!1,"","").then(function(){$scope.isLoading=!1},$scope.handleErrors):serverside.createNewRawConnection($scope.name,pathPrefixedWithHttp(),"internet").then(function(){$scope.isLoading=!1,$scope.continueWithNewConnection({connectionName:$scope.name})},$scope.handleErrors))},$scope.onEscape=$scope.onCancelClicked=function(){$scope.isLoading||$scope.destroyComponent(),$scope.close()}}]}}),define("text!assets/hldm/data-connectors/native-webfile-connector/select-step.ng.html",[],function(){return'<div class="native-webfile-connector-select">\r\n	<qv-generic-select-dialog ng-if="dataHasLoaded" data-provider="provider"\r\n							  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\r\n							  data-qv-dialog-context="qvDialogContext"\r\n							  data-qv-internals="qvInternals">\r\n	</qv-generic-select-dialog>\r\n</div>\r\n'}),define("assets/hldm/data-connectors/native-webfile-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-file-connector/native-file-provider","translator"],function(template,nativeFileProvider,translator){return{template:template,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",connectionInput:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope",function($scope){$scope.dataHasLoaded=!1,nativeFileProvider.createNativeFileProvider($scope.dataconnectorInstance,$scope.dataconnectionSelectionEditor,$scope.connectionInput,$scope.tableModelToEdit,$scope.qvDialogContext,!0).then(function(result){$scope.qvDialogContext.size="L",$scope.qvDialogContext.title=$scope.tableModelToEdit?translator.get("quickdataload.EditSelectionsFor",$scope.tableModelToEdit.data.tableName):translator.get("quickdataload.SelectData"),$scope.provider=result,$scope.dataHasLoaded=!0})}]}}),define("assets/hldm/data-connectors/native-webfile-connector/connector-main",["assets/hldm/data-connectors/native-webfile-connector/connect-step","assets/hldm/data-connectors/native-webfile-connector/select-step","translator"],function(connectStep,selectStep,translator){function create(){function getInitialSelectStep(){return selectStep}var entrypoints=[{id:"internet",category:"web",name:translator.get("scripteditor.dataconnectors.webfile"),initialConnectStep:connectStep}],connector={entrypoints:entrypoints,getInitialSelectStep:getInitialSelectStep};return connector}var exports={create:create};return exports}),define("assets/hldm/datamodel-initializer",["qvangular","scripteditor.services/explicit-save-service","general.views/confirm-dialog/confirm-dialog","core.utils/deferred","core.utils/environment","scripteditor.services/keywords","core.models/engine","assets/hldm/models/load-model","assets/hldm/models/associations-model","assets/hldm/models/load-model-traverser","assets/hldm/models/load-model-runner","assets/hldm/models/dataconnectors-model","assets/hldm/services/hldm-data-preview-service","assets/hldm/models/preview-model","assets/datamodelviewer/services/dmv-data-preview-service","assets/hldm/add-data-wizard/add-data-wizard","scripteditor.services/dataconnector-service","general.models/bnf-model","general.utils/responsive-state","assets/hldm/services/entrypoints","assets/hldm/data-connectors/native-file-connector/connector-main","assets/hldm/data-connectors/native-odbc-connector/connector-main","assets/hldm/data-connectors/native-oledb-connector/connector-main","assets/hldm/data-connectors/native-webfile-connector/connector-main"],function(qvangular,explicitSaveService,ConfirmDialog,Deferred,environment,keywordsForQuoting,engine,LoadModel,AssociationsModel,LoadModelTraverser,LoadModelRunner,DataconnectorsModel,dataPreviewProvider,PreviewModel,dataPreviewService,addDataWizard,dataconnectorService,BnfModel,ResponsiveState,entrypoints){function init(clientApp,appLayout){function invalid(){entrypoints.scriptEditorTabsUpdatedOnServerCallback&&entrypoints.scriptEditorTabsUpdatedOnServerCallback(),dataconnectorsModel.populateList()}function startupLoadModelMachinery(clientApp,environment,reloadScriptBnfModel,environmentInfo){function prerequisites(){return prerequisitesPromise||(prerequisitesPromise=DataconnectorsModel.createDataconnectorsModel(engine,clientApp.engineApp,dataconnectorService,createPrivilege,canCreateDataConnections).then(function(result){return keywordsForQuoting.setAllKeywords(reloadScriptBnfModel.getAllKeywords()),keywordsForQuoting.setAllKeywordsAsLowerCase(reloadScriptBnfModel.getAllKeywordsAsLowerCase()),dataconnectorsModel=result,dataconnectorsModel.populateList().then(function(){return clientApp.Invalidated.bind(function(){
dataconnectionsPotentialChangeCounter++}),LoadModel.getLoadModel(invalid).then(function(result){loadModel=result,loadModelRunner=LoadModelRunner.createLoadModelRunner(engine.global,engineApp,loadModel,dataconnectorsModel),engine.global.configureReload(!0,!0,!1)})})})),prerequisitesPromise.then(function(){return dataconnectionsPotentialChangeCounter!==lastDataconnectionsPotentialChangeCounter?(lastDataconnectionsPotentialChangeCounter=dataconnectionsPotentialChangeCounter,dataconnectorsModel.populateList()):void 0})}function openLoadWizard(filePath,tableModel){function getInput(){return prerequisites().then(function(){var newLoadModel=loadModel.clone(),previewModel=PreviewModel.createPreviewModel(newLoadModel,dataPreviewService);return{clientApp:clientApp,environmentInfo:environmentInfo,newLoadModel:newLoadModel,previewModel:previewModel,existingLoadModel:loadModel,qvInternals:{newAssociationsModel:AssociationsModel.createAssociationsModel(newLoadModel,LoadModelTraverser),dataPreviewProvider:dataPreviewProvider,previewModel:previewModel,newLoadModel:newLoadModel,dataconnectorsModel:dataconnectorsModel},qvDialogContext:{},dataconnectorsModel:dataconnectorsModel,loadModelRunner:loadModelRunner,filePath:filePath,tableModelToEdit:tableModel}})}explicitSaveService.isAppDirty()?ConfirmDialog.confirmAction({header:"quickdataimport.unsavedwarningdialog.header",content:"quickdataimport.unsavedwarningdialog.content",declineButtonTitle:"Common.Cancel",confirmButtonTitle:"quickdataimport.unsavedwarningdialog.proceed"}).resultPromise.then(function(){entrypoints.wizardControl=addDataWizard.start(getInput)}):entrypoints.wizardControl=addDataWizard.start(getInput)}var createPrivilege=appLayout.create,canCreateDataConnections=void 0===appLayout.canCreateDataConnections?!0:appLayout.canCreateDataConnections,dataconnectionsPotentialChangeCounter=0,lastDataconnectionsPotentialChangeCounter=0;entrypoints.openLoadWizard=openLoadWizard,entrypoints.getTableModelWithName=function(name){return prerequisites().then(function(){return loadModel.getTableModelWithName(name)})},entrypoints.quickLoadFile=function(filePath){return openLoadWizard(filePath)},entrypoints.getDataSpaceInput=function(){return prerequisites().then(function(){return{loadModel:loadModel,loadModelRunner:loadModelRunner,loadModelEditTable:entrypoints.editTable,dataconnectorsModel:dataconnectorsModel}})},entrypoints.resetLoadModel=function(){return prerequisites().then(function(){return LoadModel.resetLoadModel()})},entrypoints.editTable=function(tableModel){return openLoadWizard(void 0,tableModel)},entrypoints.reloadData=function(){return prerequisites().then(function(){return loadModel.removeAllTablesMarkedForRemoval(),loadModelRunner.runMainLoadModelGraphically().then(function(){return LoadModel.updateProperties(loadModel.serialize())})})},entrypoints.keepScriptModelUpdated=function(scriptModel,getCurrentTabFn,setCurrentTabFn){return prerequisites().then(function(){entrypoints.scriptEditorTabsUpdatedOnServerCallback=function(){engineApp.getScript().then(function(result){setCurrentTabFn(scriptModel.overwriteTabsWithRawScript(result.qScript,getCurrentTabFn())),qvangular.$rootScope.$broadcast("connectionListModified")})}})},entrypoints.getLoadModelDeferred=function(){return prerequisites().then(function(){return loadModel})},entrypoints.getDataSpaceInputDeferred=function(){return prerequisites().then(function(){return{loadModel:loadModel,loadModelRunner:loadModelRunner,loadModelEditTable:entrypoints.editTable,dataconnectorsModel:dataconnectorsModel}})},entrypoints.startPreparingForOpening=function(){prerequisites()},entrypointsResolvedDeferred.resolve()}function whenNotIsSmallDevice(){function responsiveViewListener(){ResponsiveState.isSmallDevice||(ResponsiveState.ViewChanged.unbind(responsiveViewListener),deferred.resolve())}var deferred=new Deferred;return ResponsiveState.isSmallDevice?ResponsiveState.ViewChanged.bind(responsiveViewListener):deferred.resolve(),deferred.promise}var loadModel,dataconnectorsModel,loadModelRunner,prerequisitesPromise,engineApp=clientApp.engineApp;Deferred.all({environment:environment.setup(clientApp.session),reloadScriptBnfModel:BnfModel.getReloadScriptBnfModel(),notIsSmallDevice:whenNotIsSmallDevice()}).then(function(result){appLayout.permissions.update&&!appLayout.qReadOnly&&startupLoadModelMachinery(clientApp,environment,result.reloadScriptBnfModel,result.environment)})}function getLoadModel(){return entrypointsResolvedDeferred.promise.then(function(){return entrypoints.getLoadModelDeferred()})}function getDataSpaceInput(){return entrypointsResolvedDeferred.promise.then(function(){return entrypoints.getDataSpaceInputDeferred()})}function quickLoadFile(filePath){return entrypointsResolvedDeferred.promise.then(function(){entrypoints.quickLoadFile(filePath)})}function keepScriptModelUpdated(scriptModel,getCurrentTabFn,setCurrentTabFn){return entrypointsResolvedDeferred.promise.then(function(){return entrypoints.keepScriptModelUpdated(scriptModel,getCurrentTabFn,setCurrentTabFn)})}function startPreparingForOpening(){return entrypointsResolvedDeferred.promise.then(function(){entrypoints.startPreparingForOpening()})}var entrypointsResolvedDeferred=Deferred();return{quickLoadFile:quickLoadFile,getLoadModel:getLoadModel,getDataSpaceInput:getDataSpaceInput,keepScriptModelUpdated:keepScriptModelUpdated,startPreparingForOpening:startPreparingForOpening,init:init}}),define("assets/general/services/quick-data-load-launcher/quick-data-load-launcher",["assets/hldm/datamodel-initializer"],function(qdl){function launch(filePath){return qdl.quickLoadFile(filePath)}function isEnabled(permissions,responsiveState){var basicPermissions=permissions.update&&!responsiveState.isSmallDevice;return basicPermissions}function startPreparingForOpening(){qdl.startPreparingForOpening&&qdl.startPreparingForOpening()}return{launch:launch,isEnabled:isEnabled,startPreparingForOpening:startPreparingForOpening}}),define("client.utils/drag-and-drop-file-service",["jquery","translator","require"],function($,translator,require){"use strict";function dragEnd(){$(overlayId).remove(),$(overlayTextId).remove()}function isAppFile(fileExtension){return"qvf"===fileExtension.toLowerCase()||"qvw"===fileExtension.toLowerCase()?!0:!1}var overlay="drag-and-drop-file-overlay",overlayId="#"+overlay,overlayText="drag-and-drop-file-text",overlayTextId="#"+overlayText;window.onFileDragEnter=function(path){var dropText="quickdataload.dragndropfilehere";0===$(overlayId).length&&(isAppFile(path.split(".").pop())&&(dropText="QVBrowser.DragAndDropFileHere"),$("body").append('<div id="'+overlayText+'"><span>'+translator.get(dropText)+'</span></div><div id="'+overlay+'"></div>'),$(overlayId).on("dragover",function(event){event.preventDefault(),event.stopPropagation()}),$(overlayId).on("dragleave",function(event){event.preventDefault(),event.stopPropagation(),dragEnd()}),$(overlayId).on("drop",function(event){event.preventDefault(),event.stopPropagation(),dragEnd();var fileExtension=path.split(".").pop();if(isAppFile(fileExtension.toLowerCase()))"undefined"!=typeof window.SendMessageToQvBrowser&&window.SendMessageToQvBrowser("OpenApp:"+path);else{var filePath=path.replace(/\//g,"\\");require(["assets/general/services/quick-data-load-launcher/quick-data-load-launcher"],function(qdlLauncher){qdlLauncher.launch(filePath)})}}),$(overlayId).click(dragEnd))}}),define("assets/hub/hub",["assets/general/require-config"],function(require){require(["jquery","qvangular","general.utils/responsive-state","hub.files/hub-state","translator","general.controllers/route-controller","assets/hub/hub-routing","util","text!assets/hub/hub.ng.html","assets/hub/hub-factory","general.services/fullscreen-message/fullscreen-message","client.views/app-overview/ao-hub-gestures","general.utils/touch-configuration-util","client.controllers/error-handler-controller","general.utils/qv-moment","general.utils/qv-events","client.controllers/error-handler-controller","hub.files/hub-toolbar/hub-toolbar","hub.files/content-toolbar/content-toolbar","hub.files/content/content","hub.files/sidemenu/sidemenu","hub.files/mobile-search/mobile-search","hub.files/getting-started/getting-started","assets/hub/getting-started/marketing-url","general.services/delayed-modal/delayed-modal","general.components/immidiate-contextual/immidiate-contextual","general.services/loader/loader","client.utils/drag-and-drop-file-service"],function($,qvangular,ResponsiveState,HubState,translator,RouteController,routing,util,template,hubFactory,fullscreenMsg,hubGestures,touchConfigUtil,errorHandler){function getStreamIdFromUri(){return util.getParameterByName("stream")||""}function reRouteClient(){routing.changeUrl(RouteController.buildUrl("my","work"))}function setActiveTitle(scope){scope.noItems="Hub.List.NoItemsInView",HubState.isGlobalSearch&&(scope.noItems="Common.NoMatchesForCurrentSearch",scope.pathTranslation="Hub.SearchResults"),scope.isPersonalMode?scope.pathTranslation="Hub.NavigationPanel.PersonalHub":scope.streamId?scope.streamsList.forEach(function(o){o.qId===scope.streamId&&(scope.pathTranslation=decodeURIComponent(o.qName))}):scope.pathTranslation="Hub.NavigationPanel.MyWork"}function setMobileView(view,scope){scope.isSmallDevice&&!scope.isPersonalMode&&(view===HubState.MobileView.home?(scope.hideSidebar=!1,HubState.setGlobalSearch(!1)):view===HubState.MobileView.instream&&(scope.hideSidebar=!0,HubState.setGlobalSearch(!1),scope.setGridListView()))}function initMobile(scope){var expandable=qvangular.getService("$$expandable");scope.isSmallDevice=ResponsiveState.isSmallDevice,scope.isPortrait=ResponsiveState.orientation===ResponsiveState.Orientation.portrait,setMobileView(HubState.view,scope),ResponsiveState.ViewChanged.bind(function(newValue){scope.isSmallDevice=newValue,scope.isGlobalSearch&&(scope.isSearch=!0,scope.toggleSearch()),scope.isSmallDevice||scope.isGlobalSearch||scope.isPersonalMode||(scope.hideSidebar=!1),scope.setGridListView(),errorHandler.isOpen()||qvangular.getService("$delayedModal").close(),qvangular.$apply(scope)}),ResponsiveState.OrientationChanged.bind(function(newValue){scope.isPortrait=newValue===ResponsiveState.Orientation.portrait,scope.isSmallDevice&&(expandable.forceClose(),scope.setGridListView()),qvangular.$apply(scope)}),HubState.ViewChanged.bind(function(view){setMobileView(view,scope)})}touchConfigUtil.configureTouchSupport();var errorCloseListenerFunc,$doc=$(document.body),saveViewMode=!0,ctrl={template:template,scope:"=",controller:["$scope","$element","qvLoader",function($scope,$element,qvLoader){function doNewSearch(){setActiveTitle($scope),HubState.isGlobalSearch?$scope.isGrid=!1:HubState.isGlobalSearch||($scope.isGrid=saveViewMode)}function showFullScreenError(errorMessage,actionButton){qvLoader.close(!0),fullscreenMsg.show({mode:"error",message:errorMessage,button:actionButton})}$scope.exp={},hubGestures.setup($element),errorCloseListenerFunc=$scope.$on("errorHandlerClosed",function(event,errorMessage,actionButton){showFullScreenError(errorMessage,actionButton)}),$scope.$on("newListReady",function(){hubFactory.checkIfStreamExist(getStreamIdFromUri,$scope.streamsList,reRouteClient),setActiveTitle($scope)}),$scope.$on("newRoute",function(){setActiveTitle($scope)}),$scope.$on("newSearch",function(){doNewSearch()}),$scope.$on("saveState",function(){HubState.isGlobalSearch&&(saveViewMode=$scope.isGrid)}),hubFactory.setup($scope).then(function(){qvLoader.close(),errorCloseListenerFunc(),routing.init($scope),$scope.$broadcast("newListReady")}),initMobile($scope),HubState.GlobalSearchChanged.bind(function(isGlobalSearch){$scope.isGlobalSearch=isGlobalSearch})}]};$(document).keydown(function(objEvent){return!objEvent.ctrlKey||65!==objEvent.keyCode&&97!==objEvent.keyCode||$(objEvent.target).is("input, textarea")?void 0:!1}),translator.setup(),translator.ready.then(function(){qvangular.getService("qvLoader").show({messageObj:{task:"Hub.IsLoading"}}),"undefined"!=typeof window.SendMessageToQvBrowser&&window.SendMessageToQvBrowser("HubTitle:"+translator.get("Hub.NavigationPanel.PersonalHub")),$doc.find(".qv-hub-container").showComponent(ctrl)})})});